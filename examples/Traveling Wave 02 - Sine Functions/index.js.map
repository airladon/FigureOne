{"version":3,"sources":["webpack://Fig/webpack/universalModuleDefinition","webpack://Fig/webpack/bootstrap","webpack://Fig/./src/index.js","webpack://Fig/./src/js/figure/Animation/Animation.js","webpack://Fig/./src/js/figure/Animation/AnimationBuilder.js","webpack://Fig/./src/js/figure/Animation/AnimationManager.js","webpack://Fig/./src/js/figure/Animation/AnimationStep.js","webpack://Fig/./src/js/figure/Animation/AnimationStep/CustomStep.js","webpack://Fig/./src/js/figure/Animation/AnimationStep/DelayStep.js","webpack://Fig/./src/js/figure/Animation/AnimationStep/ElementAnimationStep.js","webpack://Fig/./src/js/figure/Animation/AnimationStep/ElementAnimationStep/ColorAnimationStep.js","webpack://Fig/./src/js/figure/Animation/AnimationStep/ElementAnimationStep/OpacityAnimationStep.js","webpack://Fig/./src/js/figure/Animation/AnimationStep/ElementAnimationStep/PositionAnimationStep.js","webpack://Fig/./src/js/figure/Animation/AnimationStep/ElementAnimationStep/PulseAnimationStep.js","webpack://Fig/./src/js/figure/Animation/AnimationStep/ElementAnimationStep/PulseTransformAnimationStep.js","webpack://Fig/./src/js/figure/Animation/AnimationStep/ElementAnimationStep/RotationAnimationStep.js","webpack://Fig/./src/js/figure/Animation/AnimationStep/ElementAnimationStep/ScaleAnimationStep.js","webpack://Fig/./src/js/figure/Animation/AnimationStep/ElementAnimationStep/ScenarioAnimationStep.js","webpack://Fig/./src/js/figure/Animation/AnimationStep/ElementAnimationStep/TransformAnimationStep.js","webpack://Fig/./src/js/figure/Animation/AnimationStep/ParallelAnimationStep.js","webpack://Fig/./src/js/figure/Animation/AnimationStep/SerialAnimationStep.js","webpack://Fig/./src/js/figure/Animation/AnimationStep/TriggerStep.js","webpack://Fig/./src/js/figure/DrawContext2D.js","webpack://Fig/./src/js/figure/DrawingObjects/DrawingObject.js","webpack://Fig/./src/js/figure/DrawingObjects/HTMLObject/HTMLObject.js","webpack://Fig/./src/js/figure/DrawingObjects/TextObject/TextObject.js","webpack://Fig/./src/js/figure/DrawingObjects/VertexObject/VertexGeneric.js","webpack://Fig/./src/js/figure/DrawingObjects/VertexObject/VertexObject.js","webpack://Fig/./src/js/figure/DrawingObjects/VertexObject/VertexText.js","webpack://Fig/./src/js/figure/Element.js","webpack://Fig/./src/js/figure/Equation/Elements/BaseAnnotationFunction.js","webpack://Fig/./src/js/figure/Equation/Elements/BaseEquationFunction.js","webpack://Fig/./src/js/figure/Equation/Elements/Bounds.js","webpack://Fig/./src/js/figure/Equation/Elements/Container.js","webpack://Fig/./src/js/figure/Equation/Elements/Element.js","webpack://Fig/./src/js/figure/Equation/Elements/Fraction.js","webpack://Fig/./src/js/figure/Equation/Elements/Matrix.js","webpack://Fig/./src/js/figure/Equation/Elements/Scale.js","webpack://Fig/./src/js/figure/Equation/Equation.js","webpack://Fig/./src/js/figure/Equation/EquationForm.js","webpack://Fig/./src/js/figure/Equation/EquationFunctions.js","webpack://Fig/./src/js/figure/Equation/EquationSymbols.js","webpack://Fig/./src/js/figure/Equation/HTMLEquation.js","webpack://Fig/./src/js/figure/Equation/Symbols/AngleBracket.js","webpack://Fig/./src/js/figure/Equation/Symbols/Arrow.js","webpack://Fig/./src/js/figure/Equation/Symbols/Bar.js","webpack://Fig/./src/js/figure/Equation/Symbols/Box.js","webpack://Fig/./src/js/figure/Equation/Symbols/Brace.js","webpack://Fig/./src/js/figure/Equation/Symbols/Bracket.js","webpack://Fig/./src/js/figure/Equation/Symbols/Integral.js","webpack://Fig/./src/js/figure/Equation/Symbols/Line.js","webpack://Fig/./src/js/figure/Equation/Symbols/Product.js","webpack://Fig/./src/js/figure/Equation/Symbols/Radical.js","webpack://Fig/./src/js/figure/Equation/Symbols/SquareBracket.js","webpack://Fig/./src/js/figure/Equation/Symbols/Strike.js","webpack://Fig/./src/js/figure/Equation/Symbols/Sum.js","webpack://Fig/./src/js/figure/Equation/Symbols/SymbolNew.js","webpack://Fig/./src/js/figure/Equation/Symbols/Vinculum.js","webpack://Fig/./src/js/figure/Figure.js","webpack://Fig/./src/js/figure/FigureCollections/Angle.js","webpack://Fig/./src/js/figure/FigureCollections/Axis.js","webpack://Fig/./src/js/figure/FigureCollections/EqnNavigator.js","webpack://Fig/./src/js/figure/FigureCollections/EquationLabel.js","webpack://Fig/./src/js/figure/FigureCollections/FigureCollections.js","webpack://Fig/./src/js/figure/FigureCollections/Legend.js","webpack://Fig/./src/js/figure/FigureCollections/Line.js","webpack://Fig/./src/js/figure/FigureCollections/Plot.js","webpack://Fig/./src/js/figure/FigureCollections/PolyLine.js","webpack://Fig/./src/js/figure/FigureCollections/Rectangle.js","webpack://Fig/./src/js/figure/FigureCollections/SlideNavigator.js","webpack://Fig/./src/js/figure/FigureCollections/Trace.js","webpack://Fig/./src/js/figure/FigurePrimitives/FigurePrimitives.js","webpack://Fig/./src/js/figure/FigurePrimitives/Generic.js","webpack://Fig/./src/js/figure/FigurePrimitives/Text.js","webpack://Fig/./src/js/figure/Gesture.js","webpack://Fig/./src/js/figure/Recorder/Recorder.js","webpack://Fig/./src/js/figure/Recorder/parseState.js","webpack://Fig/./src/js/figure/Recorder/recorder.worker.js","webpack://Fig/./src/js/figure/Recorder/state.js","webpack://Fig/./src/js/figure/SlideNavigator.js","webpack://Fig/./src/js/figure/geometries/arrow.js","webpack://Fig/./src/js/figure/geometries/buffer.js","webpack://Fig/./src/js/figure/geometries/copy/copy.js","webpack://Fig/./src/js/figure/geometries/ellipse.js","webpack://Fig/./src/js/figure/geometries/line.js","webpack://Fig/./src/js/figure/geometries/lines/corners.js","webpack://Fig/./src/js/figure/geometries/lines/dashes.js","webpack://Fig/./src/js/figure/geometries/lines/lines.js","webpack://Fig/./src/js/figure/geometries/polygon/polygon.js","webpack://Fig/./src/js/figure/geometries/rectangle.js","webpack://Fig/./src/js/figure/geometries/triangle.js","webpack://Fig/./src/js/figure/webgl/GlobalAnimation.js","webpack://Fig/./src/js/figure/webgl/shaders.js","webpack://Fig/./src/js/figure/webgl/webgl.js","webpack://Fig/./src/js/tools/FunctionMap.js","webpack://Fig/./src/js/tools/color.js","webpack://Fig/./src/js/tools/colorNames.js","webpack://Fig/./src/js/tools/g2.js","webpack://Fig/./src/js/tools/getCssColors.js","webpack://Fig/./src/js/tools/getCssVariables.js","webpack://Fig/./src/js/tools/htmlGenerator.js","webpack://Fig/./src/js/tools/m2.js","webpack://Fig/./src/js/tools/math.js","webpack://Fig/./src/js/tools/styleSheets.js","webpack://Fig/./src/js/tools/tools.js","webpack://Fig/./src/js/tools/types.js"],"names":["tools","math","g2","color","css","html","misc","lines","Fig","Figure","Recorder","FunctionMap","GlobalFunctionMap","FigureElement","FigureElementCollection","FigureElementPrimitive","DrawContext2D","WebGLInstance","DrawingObject","VertexObject","TextObject","FigureText","FigureFont","HTMLObject","CollectionsAngle","CollectionsLine","CollectionsPolyline","EqnNavigator","EquationLabel","EquationForm","Equation","HTMLEquation","Animation","anim","Point","Line","Rect","Transform","Translation","Scale","Rotation","parsePoint","LineBounds","TransformBounds","RectBounds","RangeBounds","minAngleDiff","getTriangleCenter","polarToRect","rectToPolar","threePointAngle","threePointAngleMin","clipAngle","getPoint","getPoints","getScale","getLine","getRect","getTransform","round","range","randSign","randInt","rand","randElement","randElements","removeRandElement","AnimationBuilder","elementOrOptions","defaultOptions","customSteps","optionsToUse","options","joinObjects","element","_stepType","forEach","customStep","name","defOptions","optionsIn","o","then","step","idOrFn","args","fnMap","execOnMaps","map","exec","state","getElement","f1Type","getPath","animation","position","animations","scenarios","durationOrOptions","duration","delayOrOptions","triggerOrOptions","stepsOrOptions","steps","newBuilder","duplicateFromTo","AnimationManager","elementOrOptionsIn","finishedCallback","translation","subscriptions","SubscriptionManager","animationSpeed","push","animateNextFrame","speed","elements","getAllElementsWithScenario","target","simpleOptions","scenario","getState","delta","setTimeDelta","isAnimating","i","length","now","animationsToRemove","remaining","index","animationIsAnimating","stepRemaining","nextFrame","removeOnFinish","callback","publish","splice","force","cancelAll","cancel","cleanAnimations","how","startsWith","frame","GlobalAnimation","getWhen","startTime","frameTime","getFrameTime","startAll","start","finishIfZeroDuration","animationDuration","getTotalDuration","animationNames","remainingTime","names","indexOf","animationRemainingTime","getRemainingTime","nameOrStep","newManager","AnimationStep","onFinish","completeOnCancel","generateRandomString","delay","beforeFrame","afterFrame","precision","startDelay","startTimeOffset","add","definition","_getStateName","_getStateProperties","deltaTime","deltaTimeAfterDelay","setFrame","finish","totalDuration","globalAnim","cancelled","oldState","setToEnd","cancelledWithNoComplete","fnExec","CustomAnimationStep","AnimationStepOptionsIn","defaultPositionOptions","startPercent","progression","getPercentComplete","percentTime","percentComplete","invert","result","custom","DelayAnimationStep","numOrOptions","dup","numOrOptionsIn","ElementAnimationStep","defaultProgression","type","addColors","color1","color2","c","Math","min","subtractColors","ColorAnimationStep","ElementAnimationStepOptionsIn","deleteKeys","dissolve","copyKeysFromTo","dimColor","slice","setDefault","defaultColor","whenComplete","setColor","showAll","p","next","newColor","hide","DimAnimationStep","timeOrOptionsIn","dim","UndimAnimationStep","undim","OpacityAnimationStep","dissolveFromCurrent","opacity","setOpacity","isShown","DissolveInAnimationStep","dissolveIn","DissolveOutAnimationStep","dissolveOut","PositionAnimationStep","path","style","magnitude","offset","controlPoint","direction","maxDuration","velocity","pathOptions","getPosition","setPosition","sub","velocityToUse","getMaxTimeFromVelocity","translate","toDelta","PulseAnimationStep","scale","rotation","angle","frequency","xAlign","yAlign","num","space","done","when","stopAfterDuration","centerOn","pulse","toStart","stopPulsing","PulseTransformAnimationStep","defaultTransformOptions","rotDirection","clipRotationTo","zeroDurationThreshold","transform","transforms","toNum","spreadTransforms","startNum","ceil","endNum","floor","startTransform","_dup","endTransform","numTransforms","max","spread","order","deltaStep","startStep","targetStep","rotDiff","getDeltaAngle","r","constant","transformVelocity","t","s","x","y","pulseTransforms","identity","setStartAndTarget","calculateStartTargetDelta","getVelocityTransform","frozenPulseTransforms","clipRotation","RotationAnimationStep","clipTo","a","rotate","nextR","setRotation","updateRotation","setTransformCallback","ScaleAnimationStep","setScale","ScenarioAnimationStep","defaultScenarioOptions","allDurationsSame","colorVelocity","opacityVelocity","updateTranslation","updateScale","transformDuration","targetTransform","colorDuration","areColorsSame","deltaColor","abs","opacityDuration","opacityDelta","scenarioMaxTime","Error","getScenarioTarget","Object","keys","getCurrentScenario","getDuration","ParallelAnimationStep","TransformAnimationStep","setTransform","stepsOrOptionsIn","Array","isArray","startWaiting","forceToUse","stepDuration","inParallel","SerialAnimationStep","inSerial","TriggerAnimationStep","triggerOrOptionsIn","payload","trigger","canvas","ctx","getContext","bsr","webkitBackingStorePixelRatio","mozBackingStorePixelRatio","msBackingStorePixelRatio","oBackingStorePixelRatio","backingStorePixelRatio","dpr","window","devicePixelRatio","ratio","resize","width","clientWidth","height","clientHeight","location","textOrOptions","transformMatrix","canvasIndex","numPoints","getLocation","transformBy","drawingPrimitive","copy","parentDiv","id","document","getElementById","show","setBorder","lastMatrix","lastColor","border","b","parentRect","getBoundingClientRect","elementRect","left","right","top","bottom","boundary","glSpace","bottomLeft","pixelSpace","pixelToGLTransform","spaceToSpaceTransform","matrix","newHtml","lastDrawTransformMatrix","createElement","innerHTML","HTMLElement","appendChild","transformHtml","glLocation","pixelLocation","glToPixelSpace","w","h","currentStyle","getAttribute","setAttribute","isDifferent","family","size","weight","colorToUse","scalingFactor","font","thisColor","fillStyle","colorArrayToRGBA","FigureTextBase","drawContext2D","text","touchBorder","onClick","locationAligned","lastDraw","lastDrawRect","measureText","alignText","calcBounds","calcBorder","calcTouchBorder","measureAndAlignText","calcBorderAndBounds","newFont","constructor","setFontInContext","fontHeight","match","aWidth","parseFloat","ascent","descent","midAscentRe","midDecentRe","maxDescentRe","midAscentMatches","midDescentMatches","maxDescentMatches","measure","bounds","textBorder","isBuffer","textBorderBuffer","getBoundingBorder","FigureTextLine","inLine","followOffsetY","lSpace","rSpace","FigureTextLines","line","TextObjectBase","lastDrawTransform","calcScalingFactor","layoutText","isInPolygon","minSize","clear","setText","setTouchBorder","setFont","setTextLocations","contextIndex","save","sx","offsetWidth","sy","offsetHeight","tx","ty","glToPixelSpaceMatrix","tm","elementToGLMatrix","elementToPixelMatrix","m2","pixelToScaledPixelMatrix","elementToScaledPixelMatrix","cA","cB","cC","cD","cE","cF","figureText","setColorInContext","fillText","restore","clearRect","textArray","figureTextArray","textDefinition","textToUse","locationToUse","fontToUse","getBorder","fontDefinition","defaultTextTouchBorder","createLine","initialLocation","lastRight","maxY","minY","textMaxY","textMinY","align","locationAlignOffset","TextLineObject","offsetToUse","TextLinesObject","textLines","modifiers","lineDefinition","lineIndex","lineJustification","justify","lineLineSpace","lineSpace","lineToUse","lineFont","split","splitString","textFont","mod","createLines","maxLinesY","minLinesY","maxLinesWidth","VertexGeneric","webgl","textureLocation","textureVertexSpace","textureCoords","textureRepeat","vertices","texOptions","mapTo","mapFrom","repeat","texture","src","points","setupTexture","setupBuffer","drawType","glPrimitive","gl","LINES","TRIANGLE_STRIP","TRIANGLE_FAN","TRIANGLES","newVerts","copyPoints","v","resetBuffer","createTextureMap","vertexShader","fragmentShader","webglArray","z","buffer","programIndex","getProgram","glIndex","glTexture","image","isPowerOf2","value","textures","activeTexture","TEXTURE0","bindTexture","TEXTURE_2D","pixelStorei","UNPACK_FLIP_Y_WEBGL","texImage2D","RGBA","UNSIGNED_BYTE","generateMipmap","texParameteri","TEXTURE_WRAP_S","REPEAT","TEXTURE_WRAP_T","CLAMP_TO_EDGE","TEXTURE_MIN_FILTER","LINEAR","createBuffer","bindBuffer","ARRAY_BUFFER","bufferData","Float32Array","STATIC_DRAW","createTexture","addTexture","data","Uint8Array","Image","onLoad","executeOnLoad","bind","addEventListener","addTextureToBuffer","deleteBuffer","drawAngle","PI","drawLength","xMinGL","xMaxGL","yMinGL","yMaxGL","xMinTex","xMaxTex","yMinTex","yMaxTex","glWidth","glHeight","texWidth","texHeight","texNormX","texNormY","count","transformation","drawWithTransformMatrix","webglInstance","FLOAT","normalize","stride","locations","useProgram","UNPACK_PREMULTIPLY_ALPHA_WEBGL","blendFunc","SRC_ALPHA","ONE_MINUS_SRC_ALPHA","enableVertexAttribArray","a_position","vertexAttribPointer","uniformMatrix3fv","u_matrix","uniform1f","u_z","uniform4f","u_color","texSize","texType","texNormalize","texStride","texOffset","a_texcoord","uniform1i","u_use_texture","u_texture","drawArrays","disableVertexAttribArray","VertexText","textOptions","defaultTextOptions","generateUniqueId","drawTextIntoBuffer","pixelToVertexSpaceScale","calcAscentDescent","point","lowAscentRe","lowAscentMatches","pixelFontSize","endsWith","parseInt","figureFontSize","hBuffer","textAlign","textBaseline","startX","baselineHeightFromBottom","startY","resizeText","inputTransforms","copyTransforms","newTransforms","it","figureLimitsOrFigure","parent","uid","random","toString","dependantTransform","isMovable","isTouchable","touchPriority","isInteractive","undefined","hasTouchableElements","lastDrawOpacity","beforeDrawCallback","afterDrawCallback","internalSetTransformCallback","parentTransform","lastDrawPulseTransform","lastDrawElementTransformPosition","parentCount","elementCount","recorder","drawPriority","stateProperties","lastDrawTime","cancelSetTransform","onAdd","pulseDefault","pulseTransform","builder","figureLimits","figure","limits","move","sizeInBounds","maxVelocity","freely","zeroVelocityThreshold","deceleration","bounceLoss","canBeMovedAfterLosingTouch","transformClip","pulseTransformMethod","mag","d","cos","sin","pulseSettings","time","A","B","C","transformMethod","allowFreezeOnStop","isBeingMoved","isMovingFreely","movement","previousTime","previousTransform","zero","isPulsing","preparingToStop","interactiveLocation","animationFinishedCallback","animationFinished","tieToHTML","updateOnResize","isRenderedAsImage","unrenderNextDraw","renderedOnNextDraw","drawTransforms","typeOfAnimation","properties","exceptIn","except","cleanBounds","key","getBounds","bound","joinObjectsWithOptions","ignoreShown","_getStatePropertiesMin","setTouchable","setMovable","figureCanvas","tieToElement","tie","dWindow","cAspectRatio","dAspectRatio","tAspectRatio","wAspectRatio","topLeftPixels","bottomRightPixels","pixelToFigure","figureTransforms","topLeft","m","bottomRight","center","scaleString","trim","toLowerCase","scaleX","scaleY","figureToWindowScaleX","figureToWindowScaleY","em","getComputedStyle","fontSize","defaultFontScale","maxPixels","fitHeightScale","fitWidthScale","setFirstTransform","getParentLastDrawTransform","forceOverwrite","independentOnly","areColorsWithinDelta","stateTransform","isWithinDelta","scenarioAnimation","scenarioOptions","pulseAnimation","arePulseTransformsSame","startPulseTransforms","targetPulseTransforms","mergePulseTransforms","exceptions","statePulseTransforms","initialTransforms","execFunctionAndArgs","execFunc","pointOrX","currentTransform","scaleOrX","clip","getMoveBounds","decelerate","isZero","stopMovingFreely","willStartAnimating","scenarioIn","scenarioName","setScenario","getRotation","saveScenario","pLength","calcAndSetMatrix","unrender","recordEvent","newTransform","prevTransform","tBounds","getTranslation","calcVelocity","_state","currentTime","nextTransform","startMovingFreely","stopBeingMoved","clipMag","wasMovingFreely","getMovingFreelyEnd","pulseMag","pTransform","optionsOrDone","getPositionInBounds","spaceTransformMatrix","bStep","BArray","CArray","AArray","minMax","mid","startNormalized","asin","startPulsing","pulseScale","currentPosition","pulseScaleNow","e","pulseScaleRelativeToPoint","pulseScaleRelativeToElement","bArray","bMax","bMin","wasPulsing","toComplete","checkStop","stopAnimating","figureHTMLElement","updateHTMLElementTie","figureToVertex","getPixelToVertexSpaceScale","from","to","spaceTransforms","glToPixel","calcMatrix","pixelToGL","figureToGL","figureToPixel","glToFigure","fromSpace","toSpace","borderPoints","getBorderPoints","transformedBorders","transformedBorder","getBoundingRect","rect","figurePosition","figureSpace","figureToGLSpace","newLocation","setFigurePosition","local","setMoveBounds","boundaryIn","p0","p1","checkMoveBounds","isUnbounded","getRelativeBoundingRect","makeThisElementTouchable","movable","elementId","display","glPoint","isMoving","vertexLocation","borders","holeBorders","isTouched","cannotTouchHole","j","holeBorder","isBeingTouched","drawingObject","pointsToDraw","angleToDraw","lengthToDraw","pointsDefinition","setPointsFromDefinition","click","primitive","resizeHtmlObject","pixelToVertexScale","drawBorder","drawBorderBuffer","nextMovingFreelyFrame","parentOpacity","ttt","performance","pointCount","getPointCountForAngle","getPointCountForLength","getPulseTransforms","getDrawTransforms","clearRender","timeData","firstTransform","xMultiplierOrPoint","yMultiplier","xMulToUse","yMulToUse","drawOrder","eqns","collection","doNotDuplicate","elementsIn","newOrder","reverse","isAnyElementMoving","setFigure","nameOrElementOrElementDefinition","elementToAdd","addElementWithName","rootCollection","elementDefinition","addElementsKey","nameToUse","pathToUse","addElementsToUse","methodPathToUse","method","elementModsToUse","mods","firstScenario","collectionPath","methodPath","getMethod","newElement","setProperties","remainingPath","collections","shapes","primitives","methods","polyline","polygon","rectangle","ellipse","triangle","generic","grid","arrow","star","textLine","textGL","textHTML","htmlText","htmlImage","opolyline","oline","addEquation","equation","addNavigator","splitMethod","methodToUse","setupDraw","opacityToUse","ttt1","tArray","tttt","draw","ttt2","elementsToExec","elementToExec","optionsOrElementsOrDone","doneToUse","counter","combinedCallback","elementToPulse","elementPath","inputElementPath","ep","newParent","join","children","processPath","prefix","out","paths","child","toShow","getElements","hideAll","toHide","listToHide","shownOnly","getBorderFromChildren","childrenBorder","childrenToUse","updateLimits","container","touched","concat","getTouched","elementOnly","stop","nonNullColor","setDimColor","elementsToDim","elementsToHighlight","elementTransforms","sort","elemA","elemB","reorder","easeFunction","callbackMethod","timeToAnimate","isEqualTo","getAllPrimitives","getAllElements","getAllPossiblyInteractiveElements","elem","elems","classList","remove","newWebgl","setupWebGLBuffers","oldInstance","changeWebGLInstance","getLoadingElements","setPrimitiveColors","unrenderAll","onlyIfVisible","setScenarios","saveScenarios","elementDuration","animateToState","durationIn","dissolveInToState","thisElementResult","elementResult","isStateSame","clearFrozenPulseTransforms","freezePulseTransforms","elementName","includeChildren","copyAnnotation","annotation","namedCollection","xPosition","yPosition","content","inSize","fullContentBounds","copyAnnotations","annotations","copyGlyphs","glyphs","glyph","copyGlyph","getAllElementsFromAnnotations","getAllElementsFromGlyphs","setPositionsForAnnotations","setPositions","offsetLocationForAnnotations","offsetLocation","setPositionsForGlyphs","offsetLocationForGlyphs","BaseAnnotationFunction","contentCopy","glyphsCopy","annotationsCopy","loc","topSpace","bottomSpace","leftSpace","rightSpace","contentScale","useFullBounds","inSizeBounds","Bounds","fullBounds","contentBounds","calcSize","copyFrom","setAnnotationPosition","annotationBounds","growWithSameBaseline","fullSizeAnnotationBounds","annotationIndex","setLineGlyph","setEncompassGlyph","encompassBounds","encompassFullBounds","setVerticalGlyph","leftBounds","leftFullBounds","rightBounds","rightFullBounds","setHorizontalGlyph","topBounds","topFullBounds","bottomBounds","bottomFullBounds","xLocationOffset","topSpaceToUse","bottomSpaceToUse","leftSpaceToUse","rightSpaceToUse","fullSize","leftOffset","locationOffset","setSize","contentBoundsIn","encompass","spaceToUse","glyphBounds","fullAnnotationBounds","pStart","getPositionInRect","toRect","pEnd","spacedLine","pointAtLength","glyphName","overhang","minContentHeight","minContentDescent","minContentAscent","yOffset","annotationsOverContent","glyphHeight","contentX","glyphBottom","glyphDescent","glyphAscent","glyphAndAnnotationBounds","xOffset","glyphLength","contentY","contentToAnnotateBounds","locationContentToAnnotate","xPos","yPos","reference","ascentPercentage","ascentPercentHeight","descentPercentHeight","useFullSize","BaseEquationFunction","glyphElements","g","Element","contentArray","contents","glyphLocations","glyphWidths","glyphHeights","copyContent","newGlyphs","glyphLocation","Elements","boundsIn","defaultBounds","leftDelta","rightDelta","topDelta","bottomDelta","newBounds","baseline","Container","fit","scaleModifier","mainContent","containerBounds","newScale","contentLoc","BlankElement","updateLastDrawTransform","nonNullContent","des","asc","fullElementBounds","Fraction","incomingScale","vinculum","numerator","denominator","numeratorSpace","denominatorSpace","offsetY","vinculumBounds","numeratorBounds","denominatorBounds","getHeight","lineVAboveBaseline","numeratorLoc","denominatorLoc","baselineOffset","getMaxAscentDescent","numRows","numCols","rowAscents","rowDescents","rowHeights","maxAscent","maxDescent","maxHeight","row","rowMaxAscent","rowMaxDescent","col","rowMaxHeight","ascents","descents","heights","getMaxColWidth","colWidths","maxWidth","maxColWidth","elementWidth","Matrix","aboveBaseline","locs","elementBounds","rowBounds","maxDim","cumHeight","cumWidth","totalHeight","totalWidth","NextFormAnimationStep","GoToFormAnimationStep","defaultDimColor","defaultFont","formDefaults","alignment","fixTo","elementMods","forms","formRestart","eqn","currentForm","formSeries","base","currentFormSeries","currentFormSeriesName","functions","EquationFunctions","addElementFromKey","getExistingOrAddSymbol","symbols","EquationSymbols","descriptionElement","descriptionPosition","addElements","phrases","addPhrases","addForms","initialForm","defaultFormSeries","setFormSeries","goToForm","opt","getCurrentForm","showForm","form","getRemainingAnimationTime","nextForm","arrange","formName","arranged","layoutForms","updateText","defaultText","defaultFontDefinition","replace","symbol","getExistingOrAddSymbolFromKey","entries","params","existingElement","makeSymbolElem","cleanKey","get","ending","makeTextElem","figureElem","getTextFromKey","fullLineHeightPrimitive","createForm","contentToElement","fullLineHeight","phraseName","phrase","isFormString","isFormArray","isFormMethodDefinition","isFormElements","addFormNormal","formContent","addForm","addFormFullObject","description","fromForm","onShow","onTransition","getFigureElement","getChildren","showOnly","stopEquationAnimating","getElementTransforms","setElementTransforms","animateToTransforms","onStart","transformElementMods","newMods","figureElement","transformTranslation","trans","newTranslation","fromFormKey","f","checkFixTo","animationStop","showHide","applyElementMods","formOrName","getForm","setCurrentForm","render","prioritizeFormDuration","fromWhere","animate","ifAnimating","skipToTarget","cancelGoTo","formIndex","dissolveOutTime","dissolveInTime","blankTime","end","animatePositionsTo","moveFrom","showFormCallback","whenFinished","newEnd","allHideShow","formToGet","getFormIndex","prevForm","collectionMethods","namedElements","equationCopy","newContent","contentElement","spaceNum","elementsInCollection","elementsCurrentlyShowing","filter","fixPoint","completed","addTo","allElements","elementsShown","elementsShownTarget","elementsToHide","elementsToShow","hideShow","showTime","hideTime","getElementsToShowAndHide","dissolveElements","elementsToDelayShowing","elementsToShowAfterDissolve","cumTime","dissolveOutCallback","setProps","moveTime","dissolveInBeforeMove","currentTransforms","elementsToMove","toMoveStartTransforms","toMoveStopTransforms","currentT","nextT","toShowTransforms","moveTimeToUse","getMoveTime","moveCallback","dissolveInCallback","translationToUse","elementsObject","parseContent","elementFromKey","stringToElement","elementArray","eqnMethod","frac","strike","box","touchBox","root","brac","sup","supSub","topBar","bottomBar","annotate","bottomComment","topComment","bar","topStrike","bottomStrike","pad","sumProd","insideSpace","outsideSpace","forceOptions","side","defaultAnnotation","annotationsToProcess","fillAnnotation","ann","annCopy","fillAnnotations","anns","annsCopy","annotationsToUse","glyphsToUse","fillGlyphAnnotation","glyphSide","glyphAnnotationsToProcess","glyphAnnotationsToUse","optionsOrArray","rootScale","rootOffset","superscript","subscript","subscriptOffset","superscriptOffset","matrixContent","fromScale","toScale","fromOffset","toOffset","limitsPosition","limitsAroundContent","fromXPosition","fromYPosition","fromXAlign","fromYAlign","toXPosition","toYPosition","toXAlign","toYAlign","fullBoundsContent","comment","contentSpace","commentSpace","contentLineSpace","commentLineSpace","processComment","contentSpaceToUse","commentSpaceToUse","scaleToUse","EquationLine","optionsOrContent","processStrike","bracket","squareBracket","brace","angleBracket","radical","sum","product","integral","lineWidth","staticHeight","staticWidth","VinculumNew","fill","Box","dash","arrowWidth","arrowLength","Arrow","sides","Sum","Product","tipWidth","serif","serifSides","lineIntegralSides","Integral","staticSize","startHeight","startWidth","maxStartWidth","maxStartHeight","proportionalToHeight","Radical","Strike","Bracket","AngleBracket","Brace","Bar","radius","SquareBracket","makeDiv","classes","indent","indentStr","idStr","classString","HTMLElementProperties","HTMLElements","filteredContent","SuperSub","Subscript","Superscript","Root","widthIn","getVerticalDefaultValues","theta","acos","distance","beta","alpha","ang","tan","leftPoints","rightPoints","lengthIn","p2","p3","p4","p5","p6","heightIn","getDefaultValues","leftIn","bottomIn","heightLineWidthRatio","widthLineWidthRatio","widthLineWidth","heightLineWidth","spaceIn","drawingSpace","maxBounds","Symbol","outsideRadius","insideRadius","outsideStep","insideStep","insidePoints","outsidePoints","outsideAngle","insideAngle","getLeftPoints","newPointsLeft","newPointsRight","r1p","r2p","wInnerRadius","innerRadius","wOuterRadius","outerRadius","angleInner","stepAngleInner","angleOuter","stepAngleOuter","innerPoints","outerPoints","contentHeight","contentWidth","singleWidth","percentage","serifRadius","widthWithoutSerifs","xArray","targetY","k","log","bottomTheta","linePoints","prevLeft","prevRight","sigmoid","exp","derivative","atan","xDelta","yDelta","serifPoints","bottomCenter","topCenter","bottomSerifPoints","topSerifPoints","angleDelta","prevBottom","prevTop","lineIntegralEllipsePoints","getLineIntegralPoints","ellipseHeight","ellipseWidth","deltaAngle","prevOuter","prevInner","ellipseLineWidth","inner","outer","defaultLineWidth","defaultSingleWidth","defaultTotalWidth","makePolyLine","sidesToUse","thick1","thick2","p7","p8","p10","p11","p40","p41","p42","p50","p51","p52","p4Curve","quadBezierPoints","p5Curve","bottomCurve","p60","p61","p62","p6Curve","topCurve","leg","leg2","transition","tickWidth","tickHeight","downWidth","lineWidth2","line02","line24","line46","line68","line02Offset","line24Offset","line46Offset","line68Offset","intersectsWith","intersect","p9","contentWidthIn","contentHeightIn","getHeightFromContentHeight","widthStartWidthRatio","heightStartHeightRatio","widthStartWidth","heightStartHeight","radiusToUse","rOutside","rInside","lowCenter","highCenter","atan2","h0","h1","h2","h3","bottomTipAngle","topTipAngle","cBottom","cTop","bBottom","bTop","thick3","lineA","CxOffset","lineC","lineB","DxOffset","lineD","intersection","p12","p13","p30","p31","p32","bottomCurvePairs","p111","p110","p112","topCurvePairs","transformOrLocation","symbolOptions","vertexObject","initialT","isNotEqualTo","pointsNew","widthNew","heightNew","duplicate","updateSymbol","pointsIn","change","htmlId","fontScale","isPaused","scrolled","cursorElementName","setStateCallback","mockPreviousTouchPoint","HTMLCanvasElement","contains","canvasLow","canvasOffscreen","textCanvasLow","textCanvasOffscreen","htmlCanvas","canvasStyle","getElementsByTagName","backgroundColor","webglLow","webglOffscreen","draw2DLow","draw2DOffscreen","gestureCanvas","gesture","Gesture","previousCursorPoint","isTouchDown","setDefaultLineWidth","setDefaultLength","drawQueued","inTransition","beingMovedElements","beingTouchedElements","touchTopElementOnly","globalAnimation","bindRecorder","pauseTime","shapesLow","getShapes","collectionsLow","getObjects","createFigureElements","pause","preparingToSetState","stateTime","sizeHtmlText","isTouchDevice","initElements","waitForFrames","scrollingFast","scrollTimeoutId","drawTimeoutId","oldScroll","pageYOffset","drawAnimationFrames","cursorShown","SlideNavigator","onCursor","action","showCursor","onTouch","isCursorShown","onCursorMove","setCursor","moved","startBeingMoved","elementClick","eqnNavClick","clickNext","clickPrev","clickRefresh","addEventType","userInputLineWidth","userInputLength","defaultLength","scrollEvent","removeEventListener","stateIn","parseState","finishedFlag","finished","setState","defaultDuration","dissolveToState","dissolveInDuration","dissolveOutDuration","dissolveDuration","touchable","draw2D","FigurePrimitives","FigureCollections","containerRect","test","destroy","getExtension","loseContext","canvasRect","percentSpace","figureToCSSPercent","nowIn","elementRemainingTime","remainingPulseTime","getRemainingPulseTime","remainingMovingFreelyTime","getRemainingMovingFreelyTime","l","setSpaceTransforms","needClear","renderElementToTiedCanvas","clearContext","currentVisibility","elementToRender","oldPosition","oldScale","renderToCanvas","htmlCanvasElementOrId","HTMLImageElement","toDataURL","skipHTMLTie","oldWidth","renderAllElementsToTiedCanvases","cursor","up","down","clientPoint","pixelP","clientToPixel","figurePoint","unpause","pausePlayback","pixelPoint","pointer","previousClientPoint","currentClientPoint","centerFigureSpace","previousPixelPoint","currentPixelPoint","currentAngle","previousAngle","diffAngle","rot","newAngle","previousFigurePoint","currentFigurePoint","currentVertexSpacePoint","previousVertexSpacePoint","elementSpaceDelta","currentTranslation","previousMag","currentMag","currentScale","newScaleX","newScaleY","previousGLPoint","elementToMove","rotateElement","scaleElement","translateElement","stopped","preparingToStopCounter","checkAllStopped","completeState","clearColor","COLOR_BUFFER_BIT","pixelToClient","touchDownHandler","touchUpHandler","touchMoveHandler","clearTimeout","setTimeout","centerDrawingLens","t2","t3","console","fromTimeOut","viewPortHeight","innerHeight","documentElement","newTop","newTopInPx","queueNextFrame","clientLocation","lineOptions","startIndex","close","AngleLabel","labelText","curvePosition","showRealAngle","units","autoHide","autoHideMax","orientation","subLocation","label","startAngle","line21","nextStartAngle","nextPosition","curve","corner","sideStart","sideStop","pulseAngle","thick","largerTouchBorder","autoUpdateSubscriptionId","lastLabelRotationOffset","calculateAngleRotationPosition","setNextPositionAndRotation","side1","side2","_curve","addCurve","_arrow1","_arrow2","defaultArrowRadius","curveOverlap","arrowOptions","simplifyArrowOptions","defaultO","addArrow","addLabel","defaultSideLength","defaultSideWidth","defaultSideOptions","sideOptions","addSide","cornerOptions","addCorner","pulseAngleDefaults","toSetup","setAngle","update","rotationOffset","updateLabel","_corner","getCornerPoints","updatePoints","cornerStyle","defaultLabelOptions","setAutoUpdate","curveOptions","defaultCurveOptions","autoRightAngle","rightAngleRange","rightLength","curveRadius","lineEnd","getArrowLength","primaryCurveAngle","sideAngle","numSides","roundNum","labelRotationOffset","arrow1Hide","arrow2Hide","rotationForArrow1","fullCurveAngle","curveAngle","trueCurveAngle","arrow1Angle","arrow2Angle","arrowLengthAngle","curveToLine","_curveRight","updateCurve","_side1","_side2","updateMovePads","setRight","getText","_label","angleText","toFixed","lineOffsetAngle","labelPosition","lineAngle","oName","oScale","oThick","pulseOptions","defaultThick","movableOrOptions","movePadRadius","startArm","endArm","addRotPad","addAnglePad","addMovePad","_anglePad","_rotPad","percentLength","getLength","anglePad","transformToSet","currentR","deltaR","rotPad","_movePad","movePad","CollectionsAxis","axis","autoStep","auto","calcAuto","ticks","labels","showAxis","startValue","stopValue","drawToValueRatio","valueToDrawRatio","addLine","addTicks","addLabels","title","addTitle","optionsInOrBool","toBack","values","lengthSign","processTicks","valueToDraw","original","format","toExponential","log10","factor","newStart","newRange","drawValue","roundedValue","updateDescription","setClicks","monochrome","enableTouch","disableTouch","updateButtons","nav","includeNextPrevPrefix","nextPrefix","prevPrefix","refresh","prev","prevDescription","nextDescription","navType","nextIndex","prevIndex","updateButtonsDescriptionOnly","makeType3Line","prevMethod","refreshMethod","nextMethod","table","prevGroup","currentGroup","nextGroup","forceTwoLines","arrows","onclick","makeTypeDescriptionOnly","makeTypeOneButton","makeType1Line","nextArrow","prevArrow","makeType2Line","descriptionRows","navTypeOptions","interactive","connectToEquation","navigatorHTMLElement","assign","htmlElement","replayCurrentForm","_table","DEBUG","labelTextOrEquation","defaultEqnOptions","aOffset","textObject","textToReturn","offsetMag","parentAngleOffset","relativeToLine","startThetaAngle","endThetaAngle","offsetAngle","labelAngle","offsetTop","offsetBottom","offsetLeft","offsetRight","parentAngle","positionOffset","getOvalOffset","_debugEllipse","getR","sqrt","topCornerAngle","topCornerR","testR","ovalOffset","phi","R","sigma","transformOrPointOrOptions","moreOptions","CollectionsRectangle","CollectionsTrace","CollectionsPlot","CollectionsPlotLegend","navNameToUse","eqnOptions","navigator","fontColorIsLineColor","traces","getTracesToShow","getOffset","addTraces","addFrame","showToUse","traceIndex","getTraceIndex","hideToUse","offsetArray","trace","oTrace","oLine","markers","oMarker","marker","textOptionsToUse","colorOverride","oText","traceName","defaultFrameOptions","oFrame","surround","LineLabel","linePosition","makeStraightLine","straightLine","getLineFromOptions","pulseWidth","alignDraw","localXPosition","lastParentRotationOffset","pulseWidthOptions","oldCallback","oldTransformMethod","multiMove","midLength","includeLabelInTouchBoundary","scaleTransformMethodName","_line","scaleTransformMethod","showRealLength","setupLine","labelOptions","defaultMoveOptions","middleLength","moveOptions","pulseWidthDefaults","setLength","pulseWidthDoneCallbackName","arrow1","arrow2","setMultiMovable","middleLengthPercent","otherOptions","normAngle","labelToUse","current","newLen","set","pointAtPercent","straightLineLength","startOffset","midWidth","startPad","_startPad","getP1","getP2","cleanTraces","tracesIn","firstPoint","comparePoints","theme","xAxisShow","xAxis","yAxisShow","yAxis","axes","plotArea","addPlotArea","addAxes","legend","addLegend","__frame","frameSpace","axisOptions","axisType","getTheme","legendOptions","lineTextSpace","plotLegend","xAxisName","yAxisName","getAxis","drawToPoint","traceOptions","traceColors","gridLength","tickLength","gridDash","getNonTraceBoundingRect","processArray","toProcess","total","toProcessDefaults","showIndex","indexOptions","labelDefaults","showLine","makeValid","shape","minAngle","maxAngle","minSide","updatePointsCallback","addPads","addAngles","widthIs","cornerSize","cornerSides","minAutoCornerAngle","addSides","defaultPadOptions","pCount","padArray","padOptions","padShape","fnName","defaultAngleOptions","defaultAngleLabelOptions","angleArray","newP1","angleOptions","angleAnnotation","defaultSideLabelOptions","sideArray","sideLine","wasHidden","firstIndex","newPointsIn","doNotPublishUpdatePoints","newPoints","setEndPoints","updateAngles","makeValidTriangle","newPositionPointOrX","newPositionY","newPosition","newRotation","currentRotation","deltaMatrix","newScalePointOrX","setShow","updateAngleLabels","updateSideLabels","angle0","_angle0","angle1","_angle1","angle2","_angle2","side01","_side01","side12","_side12","side20","_side20","anglePrecision","sidePrecision","clipAngle0","getAngle","clipAngle1","clipAngle2","a0","a1","a2","s01","s12","s20","tot","diff","remainders","angles","indexToChange","reduce","iMax","arr","iMin","setLabel","checkLabelForRightAngle","hideAngles","leastSigStep","moreAccurate","_fill","labelOffset","addRect","addlabel","button","addButtonBehavior","startPosition","targetPosition","targetWidth","targetHeight","deltaPosition","deltaWidth","deltaHeight","getSurround","newWidth","newHeight","setSurround","onClickColors","currentColor","targetColor","ifCanceledThenComplete","rectOptions","CollectionsSlideNavigator","_nextButton","_prevButton","_text","prevButton","addButton","nextButton","addText","load","slides","equationDefaults","goToSlide","slideIndex","ignoreTransition","nextSlide","prevSlide","getArrowButton","getRectangleButton","defaultButtonOptions","buttonOptions","head","xSampleDistance","ySampleDistance","addMarkers","removeLine","removeMarkers","inAxis","withinLine","polylines","drawPoints","pointToDraw","sampling","lastPoint","drawIndexes","inX","inY","inAxes","parsePoints","keysToParsePointsOrPointArrays","parseKey","setupPulse","standard","Generic","updateGeneric","updateOptions","cornersOnly","cornerLength","linePrimitives","lineNum","simple","makeFastPolyLine","makePolyLineCorners","hole","getPolylineTris","sidesToDraw","getPolygonPoints","drawBorderOffset","dir","cornerAngle","getFill","skipConcave","bufferOffset","borderOptions","getBufferBorder","bufferOffsetToUse","polylineOptions","genericBase","getPolygonBorder","fillOptions","getTrisFillPolygon","getRectangleBorder","rectangleBorderToTris","getEllipseBorder","ellipseBorderToTris","getTriangleBorder","getTriangleDirection","tail","drawPosition","optionsWithDefaultArrow","defaultArrowOptions","getArrow","borderBuffer","getArrowTris","getTris","xStep","xNum","yStep","yNum","totWidth","totHeight","xLineStart","xLineStop","yLineStart","yLineStop","xTris","yTris","yLine","along","xLine","buf","joinedOptions","updatePolyline","updatedPoints","updatedBorder","updatedTouchBorder","Text","updateBorders","getBorderPointsSuper","parseTextOptions","loadText","genericTextPrimitive","parsed","oIn","oToUse","wrap","parentElement","hT","classArray","inside","setHTML","vertexText","free","touchFreeHandler","toggleCursor","binds","mouseDownHandler","mouseUpHandler","mouseMoveHandler","touchStartHandler","touchEndHandler","addEvent","enable","event","flag","mouseDown","previousPoint","disableEvent","preventDefault","touch","touches","startHandler","clientX","clientY","moveHandler","endHandler","removeEvent","getIndexOfEarliestTime","recordedData","same","prevTime","getIndexOfLatestTime","loop","getIndexRangeForTime","startSearch","endSearch","endTime","searchRange","midSearch","midTime","getNextIndexForTime","earliestTime","getPrevIndexForTime","singleton","instance","initialize","events","eventsCache","reset","stateTimeStep","audio","worker","pauseState","settings","play","timeStamp","videoToNowDelta","getCurrentTime","newTime","videoSeekTime","cache","eventsTime","eventsCacheTime","statesTime","statesCacheTime","audioTime","eventName","list","states","diffs","statesCache","isNaN","ObjectTracker","stateIndex","eventIndex","stopTimeouts","isAudioPlaying","setCurrentTime","lastRecordTimeCount","lastRecordTime","eventsToPlay","lastSeekTime","onloadedmetadata","calcDuration","encodedEventsList","isMinified","lists","decodeEvents","statesIn","isObjectForm","decodeStates","minifyEvents","minify","unminify","minifyStates","asObject","toObj","statesToUse","states1","setFromObj","baseReference","references","listOrDiffs","stopTime","stopIndex","newListOrDiffs","clearListOrDiffs","fromTime","whilePlaying","setVideoToNowDeltaTime","setToTime","setBaseReference","startWorker","postMessage","message","queueRecordState","startEventsPlayback","startAudioPlayback","startRecordingTime","startTimeUpdates","Worker","parseMessage","mergeEventsCache","mergeStatesCache","lastIndex","ref","referenceIndex","refName","basedOn","addReference","eventTime","eventListOrStatesDiff","cacheArray","sliceStart","sliceEnd","beforeEvents","afterEvents","allEventNames","eventsCacheList","eventsList","merged","getMergedCacheArray","timeoutID","timeUpdatesTimeoutID","playbackAction","setOnSeek","recordState","recordAndQueue","getIsInTransition","recordCurrentState","dateStr","Date","toISOString","pathname","encodedStates","encodeStates","encodedEvents","encodeEvents","download","JSON","stringify","toJsonHtml","obj","wnd","open","write","seek","timeIn","stopRecording","stateTimeCount","eventsToSetBeforeState","eventsToSetAfterState","timeCount","sortTimes","arrayToSort","playEvents","setEvent","cursorState","getCursorState","atTime","cursorMove","cursorIndex","touchIndex","cursorMoveIndex","touchUp","cursorPosition","cursorTime","cursorTimeCount","upOrDown","showOrHide","fromTimeIn","forceStart","stateToStartFrom","getStateForTime","areEventsPlaying","finishPlaying","onResume","startPlayback","audioEnded","nextEventName","getNextEvent","playbackEvent","nextTime","nextTimeCount","nextEvent","getFromIndex","assignAsLinkOnly","_assignAsLinkOnly","stateElement","_fromState","property","processValue","_def","dupArray","_stateKeys","keysToUse","_excludeStateKeys","excludedKeys","prop","currentState","currentObj","nextLevel","statePath","objPath","remainingProp","textElement","equations","setEquations","currentSlideIndex","equationsIn","indexIn","defaultValue","getProperty","hideOnly","slide","showForms","steadyState","setSteadyState","fromForms","getFromForm","commonMods","showCommon","hideCommon","fromToUse","leaveState","oldText","newText","showElements","hideElements","enterState","nextSlideIndex","prevSlideIndex","orientArrow","joinLength","newBorder","newTouchBorder","newTail","getTouchBorder","pnts","getTriangleArrowTail","headX","tailX","tailWidth","getTriangleArrowLength","getTriangleDefaults","getTriangleArrow","backIntersect","arrowBorder","joinTail","getTriangleTris","getReverseTriTail","hLine","headTop","getReverseTriLength","getReverseTriDefaults","getReverseTriangleArrow","vLine","topLine","getReverseTriangleTris","getBarbTail","barb","line1","back","getBarbLength","getBarbDefaults","getBarbArrow","getBarbTris","getRectTail","getRectLength","getRectDefaults","getBarDefaults","getRectArrow","getRectTris","getLineTail","topOutsideLine","topInsideLine","outsideIntersect","insideIntersect","zeroPoint","insideIntersectWithZero","isWithinLine","stubTail","getLineLength","getLineDefaults","getLineArrow","frontIntersect","outsideTop","insideTop","getLineTris","getPolygonTail","topTheta","topSideNum","bottomSideNum","topSide","bottomSide","hLineTop","hLineBottom","topIntersect","bottomIntersect","outline","getPolygonLength","getPolygonDefaults","getPolygonArrow","tailJoin","getPolygonTris","fullLength","defaults","arrowIn","includeTailByDefault","optionsForBoth","processEnd","startOrEnd","bordersIn","drawBorderBuffers","borderIn","borderIndex","prevPoint","nextPoint","offsetLines","prevLine","currentLine","borderPoint","borderToBuffer","perpLine","prevIntersect","nextIntersect","getPointsToCopy","startIn","endIn","marks","copyOffset","pointsToCopy","copyTransform","copyLinear","copyAngle","copyStep","copyStyle","chain","chainToUse","getEllipsePoints","borderToUse","touchBorderToUse","extendedLine","negOffset","posOffset","circleCorner","p2in","p3in","_2a","line12","_2b","lineC2","angleC2","magC2","ang12","deltaZero","cutCorner","line13","cut","p2Max","p3Max","cornerLine","makeCorner","forceLength","newP2","newP3","lineToCorners","corners","makeDashDefinition","dashes","cum","cycleLength","getDashElementAndRemainder","singleCycleOffset","makeDashes","cumDistance","remainder","onLine","totLength","dashLength","isOnLine","q1","q2","continues","lineToDash","dashToUse","dd","cumLength","lastContinue","processLine","dashLines","dashContinues","lineSegmentsToPoints","lineSegments","borderIs","holeIs","tris","positiveBorder","negativeBorder","lineSegment","negative","positive","nextLineSegment","nextNegative","nextPositive","joinLinesInPoint","lineNext","setP2","setP1","joinLinesInTangent","midNext","outside","outsideNext","tangent","intercept","interceptNext","joinLinesAcuteInside","insideNext","insideIntercept","joinLinesObtuseInside","makeLineSegments","isInside","numLines","idealLines","makeLine","segmentSides","neg","pos","makeOffset","minNegativeOffset","minPositiveOffset","prevAngle","minPrevAngle","minPrevOffset","distanceToPoint","minOffset","nextAngle","minNextAngle","minNextOffset","offsetLine","getWidthIs","numInsideNegativeAngles","totAngles","testAngle","makeThickLine","widthIsIn","widthIsInside","minAngleIn","widthToUse","joinLineSegments","currentIndex","lineSegmentNext","segmentSide","cornerFills","circleLineIntersection","lineIn","offsetToZero","x1","y1","x2","y2","dx","dy","dr","D","sgn","i1x","i2x","i1y","i2y","intersections","hasPointOn","shortenLineForArrows","shortenedPoints","startPoint","pointFound","distanceToEnd","endPoint","touchBorderBuffer","cornerStyleToUse","orderedPoints","dashedTris","onDash","closeDashes","widthIsBuffer","widthBuffer","pointsToUse","firstLine","lastLine","borderIsToUse","trisToUse","addArrows","holes","borderBuffers","drawBorderBufferToUse","dbb","startArrowIn","endArrowIn","existingTriangles","existingBorder","existingTouchBorder","updatedTriangles","startArrowLine","startLineMid","midPoint","startArrow","endArrowLine","endLineMid","endArrow","connection","len","half","orth","index1","index2","dx1","dx2","dy1","dy2","p21","p22","sidesMultiplier","getRectPoints","cx","cy","alignTriangle","rotationMatrix","sideRot","minX","maxX","s1Center","s2Center","s3Center","getASAPoints","ASA","s1","a3","s2","getSASPoints","SAS","getAASPoints","AAS","getSSSPoints","SSS","s3","requestNextAnimationFrame","requestAnimationFrame","mozRequestAnimationFrame","webkitRequestAnimationFrame","msRequestAnimationFrame","drawQueue","nextDrawQueue","lastFrame","debug","simulatedFPS","debugFrameTime","timers","timeoutId","updateSyncNow","manual","syncNow","synchronizedNow","syncNowTimer","cancelAnimationFrame","animationId","nowTime","queueNextDebugFrame","timeScale","nowSeconds","func","call","vertex","source","varNames","withTexture","fragment","getShaders","vName","fName","hasOwnProperty","vertexSource","fragmentSource","glMock","LINK_STATUS","VERTEX_SHADER","COMPILE_STATUS","FRAGMENT_SHADER","BLEND","attachShader","linkProgram","getProgramParameter","createProgram","deleteProgram","createShader","shaderSource","compileShader","getShaderParameter","getAttribLocation","getUniformLocation","disable","deleteShader","viewport","visibility","program","success","shader","createProgramFromScripts","vertexShaderSource","fragmentShaderSource","getGLLocations","locationsList","newLocations","autoResize","textureId","programs","shaders","newProgram","programDetails","lastUsedProgram","antialias","DEPTH_TEST","realToCSSPixels","displayWidth","displayHeight","drawingBufferWidth","drawingBufferHeight","GeneralFunctionMap","fn","mapsIn","maps","global","RGBToArray","colString","strArray","HexToArray","colHex","cssColorToArray","cssColorString","oNames","colorNames","colorValue","colorArrayToRGB","dC","aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgrey","darkgreen","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dimgrey","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","grey","green","greenyellow","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgrey","lightgreen","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightslategrey","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","rebeccapurple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","slategrey","snow","springgreen","steelblue","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen","quadraticBezier","P0","P1","P2","angleToClip","getPrecision","defaultPrecision","precisionToUse","pIn","onFail","onFailToUse","parse","parsedPoint","newRect","parseRect","rIn","parsedRect","_type","scalar","toPointIn","toPoint","clipValue","transformedPoint","bx","by","centerPoint","pt","pr","qr","dX","dY","shaddow","getShaddowOnLine","d1","d2","hasPointAlong","polygonVertices","windingNumber","n","popLastPoint","isLeft","pop","percent","translationStyle","translationOptions","pathPoint","translationPath","linearPath","curvedPath","magToUse","displacementLine","linePoint","normLineAngle","controlAngle","dist","pathType","pointinRect","q","deg","normAngleTo90","targetAngle","p2OrMag","ends","getYFromX","getXFromY","lineRounded","totalLength","p1ToP","line2","l1","l2","isNotWithinDelta","isAlongLine","withinEnds","normalizedAngle","det","perpendicular","p1ToShaddow","projection","alongLine","isParallelWith","xIntercept","getXIntercept","yIntercept","getYIntercept","defaultIntercept","lineIsWithin","li1","li2","hasLineWithin","line11","line22","checkOverlap","l11","l12","Vector","p1OrLine","parseLine","lIn","parsedLine","rotationAngle","rotToSub","rotToAdd","rotToMul","txOrTranslation","tyToUse","translationToSub","translationToAdd","translationToMul","sxOrScale","nameIn","syToUse","scaleToSub","scaleToAdd","scaleToMul","chainOrName","transformElement","xOrTranslation","xOrScale","transformNames","orderStart","orderEnd","orderEndToUse","mat","translationIndex","transformStep","yOrIndex","actualIndex","scaleIndex","calcTransform","stepStart","stepDelta","mul","rotationIndex","transformToCompare","isSimilarTo","compare","thisTrans","dR","transformToSubtract","transformToAdd","transformToMul","initialTransform","t1","minTransform","maxTransform","limitLine","clippedTransform","p1Dist","p2Dist","zeroThresholdTransform","vector","transformValueToArray","toPolar","clipM","zeroThreshold","decelerationIn","bounceLossIn","zeroVelocityThresholdIn","decelerateTransform","deltaTransform","parseTransform","inTransform","tToUse","teF1Type","parsedTransform","xScale","yScale","spaceToSpaceScale","currentMin","currentMax","getBuffer","input","pointArrays","pointOrArray","r12","r13","angle12","angle13","a12","a13","randomPoint","withinRect","randPoint","rand2D","stopTransform","velocityTransform","velocityTransformToUse","xTime","yTime","rTime","translationVelocity","rotationVelocity","scaleVelocity","startTransforms","stopTransforms","startT","stopT","reflection","clipped","optionsOrRect","pi","threePiOnTwo","piOnTwo","calcHBound","calcVBound","boundBottom","boundTop","boundLeft","boundRight","trajectory","getIntersect","boundLine","leftIntersect","rightIntersect","getClosestIntersect","intersect1","intersect2","closestIntersect","vIntersect","hIntersect","intersects","xMirror","yMirror","noIntersect","clipToLine","unitVector","unit","dotProduct","boundsArray","transformValue","createBounds","typeIndex","getBound","deceleratePoint","positionIn","velocityIn","deltaTimeIn","clipVelocity","stopFlag","v0","deltaV","distanceTravelled","v1","bounceScaler","intersectPoint","distanceToBound","reflectionAngle","acc","velocityAtIntersect","bounceVelocity","rectBounceVelocity","newStop","decelerateValue","decelerateIndependantPoint","xBounds","yBounds","xResult","yResult","newVOrder","newTransformation","newVTransformation","Ox","Oy","isParsablePoint","charAt","newValue","baseColors","shades","paletteColorNames","shade","figureColorNames","getCSSColors","customColorNames","colors","paletteColors","figureColors","body","getDefinedCSSVariables","palette","searchObject","results","newPath","includes","newResult","toCamelCase","rePrefix","RegExp","reCamelCase1","reCamelCase2","repl","str","toUpperCase","noPrefix","camelCase1","camelCase2","noDash","idOrElement","propertyNames","makeFlat","modifier","variables","propertyName","getPropertyValue","fValue","valueToAdd","Number","shortName","addToObject","getCSSVariables","numProperties","convertTextArrayToParagraphs","firstParagraphMargin","firstPStyle","withClass","classText","centerV","centerVH","centerH","marginLeft","marginRight","marginTop","marginLine","className","listStyleType","pFirst","li","ul","ol","itemSelector","items","selectorIndex","outStr","item","rad","toHTML","classStr","colorStr","replacementText","highlight","classesOrColor","link","linkStr","colorOrOptions","newTab","idToUse","textIn","highlightWord","addClass","addId","actionMethod","clickW","actionWord","modifyText","outText","expression","replacement","onClickId","additionalClassesToAdd","onClickFn","applyModifiers","highlightClass","setOnClicks","classesToAdd","modifiedText","translationMatrix","scaleMatrix","px","py","inverse","invdet","minv00","minv01","minv02","minv10","minv11","minv12","minv20","minv21","minv22","multiplier","objectIsPolyfill","arrayOrValue","maxValue","zeroT","maxV","minValue","getPositionVelocityFromDecAndTime","magDeceleration","decel","sign","newVelocity","newSign","zSign","linear","bias","phaseOffset","easeinout","percentDistance","easeout","power","easein","sinusoid","sinusoidAbs","minOrMax","plusOrMinus","inputArray","possibleIndeces","Console","classify","nonEmpty","withKey","joinStr","ObjectKeyPointer","object","apply","extractFrom","objectToExtractFrom","keyValues","keyPrefix","keySeparator","keyHeirarchy","prefixAndKey","kv","getFromObject","objectToGetFrom","keyPath","levelSeparator","levels","currentLevel","level","prototype","NaN","arrayDup","arrayElement","objectDup","assignObjectFromTo","fromObject","toObject","duplicateValues","parentPath","toValue","objects","exceptKeys","seed","randomString","seedToUse","idExists","newId","prefixes","mq","query","matchMedia","matches","DocumentTouch","loadRemote","scriptId","url","existingScript","script","onload","loadRemoteCSS","rel","href","cleanUIDs","objectToClean","genericUID","destination","UniqueMap","inverseMap","letters","undefinedCode","pathStr","unique","getNextUniqueString","uniqueStr","compressObject","strValues","uncompress","objKeys","obj2","uncompressObject","objectOrArray","minified","minObjectOrArray","uMap","makeInverseMap","objectToPaths","pathObj","getObjectDiff","obj1In","obj1","refAndDiffToObject","paths1","paths2","added","removed","key1","key2","updateObjFromPath","fullP","arrayStringIndeces","arrayIndeces","currentArray","pathsToObj","referenceIn","processPaths","diffsIn","diffIn","diffPathsToObj","diffObjToPaths","lastReferenceName","getDiffToReference","getReferenceChain","referenceChain","getObjFromDiffAndReference","Subscriber","subscribers","nextId","numberOfSubscriptions","subscribersToRemove","publishOk","idIn","subscriptionName","subscription","filename","encodeURIComponent","removeChild","token","escape","currentSplit","escaped","escapedEscape","tokenStringIndex","letter","newSplitString","preEscape","postEscape","doNothing"],"mappings":"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,QAArC,EAA+CrjB,QAA/C,CAAZ;AACD,OAFD,MAEO;AACLsjB,iBAAS,GAAGz4B,MAAM,CAACiN,eAAP,CAAuBurB,YAAvB,CAAZ;AACD;;AAEDC,eAAS,CAAC3rC,IAAV,IAAkBvI,KAAK,CAACsC,CAAxB;AACA4xC,eAAS,CAACxrC,MAAV,IAAoB1I,KAAK,CAACuC,CAA1B;AACA2xC,eAAS,CAACrtC,KAAV,IAAmB,IAAI7G,KAAK,CAACsC,CAA7B;AACA4xC,eAAS,CAACntC,MAAV,IAAoB,IAAI/G,KAAK,CAACuC,CAA9B;AACA2xC,eAAS,CAAC1rC,KAAV,GAAkB0rC,SAAS,CAAC3rC,IAAV,GAAiB2rC,SAAS,CAACrtC,KAA7C;AACAqtC,eAAS,CAACzrC,GAAV,GAAgByrC,SAAS,CAACxrC,MAAV,GAAmBwrC,SAAS,CAACntC,MAA7C;AAEA,WAAKrL,MAAL,CAAYm9B,OAAZ,CACE,IAAIvnC,+CAAJ,CAAU4iD,SAAS,CAAC3rC,IAApB,EAA0B2rC,SAAS,CAACxrC,MAApC,CADF,EAEEwrC,SAAS,CAACrtC,KAFZ,EAEmBqtC,SAAS,CAACntC,MAF7B,EAvBA,CA2BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACD,K,CAED;AACA;AACA;AACA;AACA;AACA;AACA;;;;;EA5M+BotC,kD;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACZjC;AAGA;;IAEqB7C,K;;;;;;;;;;;;;AACnB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA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ACwf,QAAJ,GAAe38C,OAAO,CAAC28C,QAAvB;AACD;;AACD,aAAOxf,GAAP;AACD;;;;EA/LkCojB,kD;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;CCJrC;AACA;AACA;;AACA;AAGA;;IAGqBxD,Q;;;;;;;;;;;;;AACnB;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;8BACU/8C,O,EAAiB2+C,O,EAAiBxrC,M,EAAgB;AAAA,UAExDqpC,KAFwD,GAGtDx8C,OAHsD,CAExDw8C,KAFwD;AAAA,UAEjDI,KAFiD,GAGtD58C,OAHsD,CAEjD48C,KAFiD;AAAA,UAE1CzwC,GAF0C,GAGtDnM,OAHsD,CAE1CmM,GAF0C;AAAA,UAErC9D,IAFqC,GAGtDrI,OAHsD,CAErCqI,IAFqC;AAAA,UAE/Bw0C,UAF+B,GAGtD78C,OAHsD,CAE/B68C,UAF+B;AAAA,UAEnBC,iBAFmB,GAGtD98C,OAHsD,CAEnB88C,iBAFmB;;AAAA,kCAInB,KAAK+C,gBAAL,CACrC1sC,MADqC,EAErCwrC,OAFqC,EAGrC3+C,OAHqC,CAJmB;AAAA,UAIlD87C,SAJkD,yBAIlDA,SAJkD;AAAA,UAIvC7oC,KAJuC,yBAIvCA,KAJuC;AAAA,UAIhC0pC,QAJgC,yBAIhCA,QAJgC;;AAS1D,UAAMsF,WAAW,GAAGhv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AACiT,KADT,EACgB,KADhB,EACuB,KADvB,EAC8B,MAD9B,EACsC,GADtC,EAE3B,CAF2B,EAExB,CAFwB,EAErBjT,OAAO,CAACo8C,IAFa,EAEP,KAFO,EAG3B,CAH2B,EAGxB,CAAC,EAAD,CAHwB,EAGlB,CAHkB,EAGf,CAAC,EAAD,CAHe,EAGTp8C,OAAO,CAAC+6B,KAHC,CAT2B;AAAA;AAAA,UASjD5b,MATiD,sBAexD;AACA;AACA;AACA;AACA;AACA;;;AACA,aAAO,CAACA,MAAD,EAASpT,KAAT,EAAgBzI,MAAhB,EAAwB,WAAxB,CAAP;AACD;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;EA1EwCi9C,kD;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACR1C;CAIA;;IAEqB7D,O;;;;;;;;;;;;;AACnB;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;8BACU18C,O,EAAiB2+C,O,EAAiBxrC,M,EAAgB;AAAA,UAClDypC,KADkD,GACjC58C,OADiC,CAClD48C,KADkD;AAAA,UAC3CJ,KAD2C,GACjCx8C,OADiC,CAC3Cw8C,KAD2C;;AAAA,kCAE7B,KAAKqD,gBAAL,CAC3B1sC,MAD2B,EAE3BwrC,OAF2B,EAG3B3+C,OAH2B,CAF6B;AAAA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xB,EAEqCC,KAAK,CAACF,WAF3C,EAGE,KAAKgQ,wBAHP,EAGiC,MAHjC,EAGyC,IAHzC,EAIE39D,IAAI,CAACwa,EAAL,GAAU,CAJZ,EAIexa,IAAI,CAACwa,EAJpB;AAMD,K,CAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;;AAEA;;;;;;8BAIE5f,M,EAEA;AAAA,UADAyZ,KACA,uEAD6C,KAAKopD,SAClD;AACA,UAAI6B,MAAM,GAAG1kE,MAAb;;AACA,UAAIA,MAAM,KAAK,CAAf,EAAkB;AAChB0kE,cAAM,GAAG,SAAT;AACD;;AACD,UAAIjrD,KAAK,KAAK,OAAd,EAAuB;AACrB,aAAKtD,IAAL,GAAY,IAAI9b,8CAAJ,CAAS,KAAK8b,IAAL,CAAUgc,EAAnB,EAAuBuyC,MAAvB,EAA+B,KAAKvuD,IAAL,CAAU1N,KAAV,EAA/B,CAAZ;AACD,OAFD,MAEO,IAAIgR,KAAK,KAAK,KAAd,EAAqB;AAC1B,aAAKtD,IAAL,GAAY,IAAI9b,8CAAJ,CACV,KAAK8b,IAAL,CAAUmsB,aAAV,CAAwB,KAAKnsB,IAAL,CAAUnW,MAAV,KAAqB0kE,MAA7C,CADU,EAEVA,MAFU,EAEF,KAAKvuD,IAAL,CAAU1N,KAAV,EAFE,CAAZ;AAID,OALM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CAAC0C,QAAD,CAA9C,EAA0D2K,MAA1D,EAAkED,MAAlE,CAAhB;;AACA,UAAIjM,OAAO,CAACrE,KAAR,IAAiB,IAArB,EAA2B;AACzBuE,eAAO,CAACqJ,QAAR,CAAiBvJ,OAAO,CAACrE,KAAzB;AACD;;AACD04E,gBAAU,CAACn0E,OAAD,EAAUF,OAAV,CAAV;AACA,aAAOE,OAAP;AACD,K,CAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAGA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;ACngIF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;CAIA;;AAGe,SAASq0E,OAAT,CACbh2D,KADa,EAEb;AACA;AACA;AACA;AACA;AACA5iB,KAPa,EAQb+tD,mBARa,EASbhgC,YATa,EAiBb;AAAA,MAPAlL,eAOA,uEAP0B,EAO1B;AAAA,MANAC,kBAMA,uEAN2B,IAAI7gB,8CAAJ,CAAS,CAAC,CAAV,EAAa,CAAC,CAAd,EAAiB,CAAjB,EAAoB,CAApB,CAM3B;AAAA,MALA8gB,aAKA,uEALsB,IAAI9gB,8CAAJ,CAAS,CAAT,EAAY,CAAZ,EAAe,CAAf,EAAkB,CAAlB,CAKtB;AAAA,MAJA+gB,aAIA,uEAJyB,KAIzB;AAAA,MAHAgE,MAGA,uEAHsB,IAGtB;AAAA,MADAriB,IACA,uEADe,EACf;AACA,MAAMu6B,OAAO,GAAG,IAAIvc,kFAAJ,CACdC,KADc,EAEd;AACA;AACA;AACA;AACA;AACAC,iBAPc,EAQdvf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AACyjF,YAAD,EAAeC,UAAf,EAA2B7sD,aAAa,CAAC,CAAD,CAAxC,CAAP;AACD;;AACD,UAAI4sD,YAAY,CAACE,SAAD,CAAZ,IAA2B,IAA/B,EAAqC;AACnCF,oBAAY,CAACE,SAAD,CAAZ,GAA0B,EAA1B,CADmC,CACL;AAC/B;;AACD,UAAID,UAAU,CAACC,SAAD,CAAV,IAAyB,IAA7B,EAAmC;AACjC,eAAO,IAAP;AACD;;AACD,aAAOhqD,WAAW,CAAC8pD,YAAY,CAACE,SAAD,CAAb,EAA0BD,UAAU,CAACC,SAAD,CAApC,EAAiD9sD,aAAa,CAAChxB,KAAd,CAAoB,CAApB,CAAjD,CAAlB;AACD,KAZD;;AAaA,QAAMtB,MAAM,GAAGo1B,WAAW,CAAC/7B,KAAD,EAAQoiF,GAAR,EAAawD,IAAI,CAAChpE,KAAL,CAAW,GAAX,CAAb,CAA1B;;AACA,QAAIjW,MAAM,IAAI,IAAd,EAAoB;AAClB;AACD;;AAjB+B,iCAkBYA,MAlBZ;AAAA,QAkBzBq/E,SAlByB;AAAA,QAkBdC,OAlBc;AAAA,QAkBLC,aAlBK;;AAmBhCF,aAAS,CAACE,aAAD,CAAT,GAA2Bb,YAAY,CAACY,OAAO,CAACC,aAAD,CAAR,CAAvC;AACD,GApBD;AAqBA,SAAOlmF,KAAP;AACD,C,CAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA,SAASouD,QAAT,CAAkBg0B,GAAlB,EAA+Bp0B,OAA/B,EAAgD;AAC9CjvD,kEAAW,CAACqjF,GAAD,EAAMp0B,OAAN,CAAX,CAD8C,CAE9C;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACD,C,CAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AChTA;AACA;CAOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;;;;;AA2OA;;;;;;;;;;;;;;;;;;;;;;;IAuBqBrB,c;AAcnB;;;;;;AAMA,4BAAuD;AAAA,QAA3C7tD,OAA2C,uEAAN,IAAM;;AAAA;;AACrD,QAAIA,OAAO,IAAI,IAAf,EAAqB;AACnB,WAAKqyE,IAAL,CAAUryE,OAAV;AACD;AACF;AAED;;;;;;;;;;;yBAOKA,O,EAA6B;AAAA;;AAChC,UAAMS,CAAC,GAAGT,OAAV;;AACA,UAAIS,CAAC,CAACg4B,UAAF,YAAwBn8B,gEAA5B,EAAqD;AACnD,aAAKm8B,UAAL,GAAkBh4B,CAAC,CAACg4B,UAApB;AACD,OAFD,MAEO,IAAIh4B,CAAC,CAACg4B,UAAF,IAAgB,IAAhB,IAAwBh4B,CAAC,CAACg4B,UAAF,CAAa71B,QAAb,IAAyB,IAArD,EAA2D;AAChE,aAAK61B,UAAL,GAAkBh4B,CAAC,CAACg4B,UAAF,CAAa71B,QAA/B;AACD;;AACD,UAAInC,CAAC,CAAC6xE,MAAF,IAAY,IAAhB,EAAsB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","file":"index.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"Fig\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"Fig\"] = factory();\n\telse\n\t\troot[\"Fig\"] = factory();\n})(window, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/index.js\");\n","// @flow\n\nimport * as g2 from './js/tools/g2';\nimport * as math from './js/tools/math';\nimport Figure from './js/figure/Figure';\nimport { Recorder } from './js/figure/Recorder/Recorder';\nimport { FunctionMap, GlobalFunctionMap } from './js/tools/FunctionMap';\nimport * as color from './js/tools/color';\nimport * as html from './js/tools/htmlGenerator';\nimport * as misc from './js/tools/tools';\nimport * as css from './js/tools/styleSheets';\nimport * as lines from './js/figure/geometries/lines/lines';\nimport {\n  FigureElement, FigureElementPrimitive, FigureElementCollection,\n} from './js/figure/Element';\nimport DrawContext2D from './js/figure/DrawContext2D';\nimport WebGLInstance from './js/figure/webgl/webgl';\nimport DrawingObject from './js/figure/DrawingObjects/DrawingObject';\nimport VertexObject from './js/figure/DrawingObjects/VertexObject/VertexObject';\nimport {\n  TextObject, FigureText, FigureFont,\n} from './js/figure/DrawingObjects/TextObject/TextObject';\nimport HTMLObject from './js/figure/DrawingObjects/HTMLObject/HTMLObject';\nimport HTMLEquation from './js/figure/Equation/HTMLEquation';\nimport CollectionsAngle from './js/figure/FigureCollections/Angle';\nimport CollectionsLine from './js/figure/FigureCollections/Line';\nimport CollectionsPolyline from './js/figure/FigureCollections/PolyLine';\nimport EqnNavigator from './js/figure/FigureCollections/EqnNavigator';\nimport EquationLabel from './js/figure/FigureCollections/EquationLabel';\nimport { Equation } from './js/figure/Equation/Equation';\nimport EquationForm from './js/figure/Equation/EquationForm';\n\nimport type { TypeRotationDirection, TypeParsablePoint } from './js/tools/g2';\nimport type {\n  COL_Line,\n  OBJ_LineLabel, TypeLabelledLine,\n} from './js/figure/FigureCollections/Line';\nimport type {\n  TypeLabelLocation, TypeLabelSubLocation, TypeLabelOrientation,\n} from './js/figure/FigureCollections/EquationLabel';\n\nimport type {\n  COL_Angle, TypeAngleLabelOptions,\n  TypeLabelledAngle,\n} from './js/figure/FigureCollections/Angle';\nimport type { OBJ_Figure } from './js/figure/Figure';\nimport type {\n  COL_Polyline, OBJ_PolylinePad,\n} from './js/figure/FigureCollections/PolyLine';\nimport * as anim from './js/figure/Animation/Animation';\n\n// This helps the docgen find the types file\n// eslint-disable-next-line\nimport doNothing from './js/tools/types';\n\nexport type {\n  TypeRotationDirection,\n  TypeLabelLocation, TypeLabelSubLocation, TypeLabelOrientation,\n  COL_Line,\n  COL_Angle, OBJ_Figure,\n  OBJ_LineLabel, TypeAngleLabelOptions,\n  COL_Polyline, OBJ_PolylinePad, TypeParsablePoint,\n  TypeLabelledAngle, TypeLabelledLine,\n};\n\n\n// /** Tools object that is so great\n// * @namespace tools\n// * @memberof module:Fig\n// * @property {object} math   - Math tools\n// * @property {object} g2     - 2D geometry tools\n// * @property {object} color  - Color tools\n// * @property {object} css    - CSS tools\n// */\nconst tools = {\n  math,\n  g2,\n  color,\n  css,\n  html,\n  misc,\n  lines,\n};\n\n/**\n * FigureOne entry point\n * @module Fig\n * @global\n * @property {class} {@link Figure}      - Figure Class\n */\nconst Fig = {\n  tools,\n  Figure,\n  Recorder,\n  FunctionMap,\n  GlobalFunctionMap,\n  //\n  FigureElement,\n  FigureElementCollection,\n  FigureElementPrimitive,\n  DrawContext2D,\n  WebGLInstance,\n  //\n  DrawingObject,\n  VertexObject,\n  TextObject,\n  FigureText,\n  FigureFont,\n  HTMLObject,\n  //\n  CollectionsAngle,\n  CollectionsLine,\n  CollectionsPolyline,\n  EqnNavigator,\n  EquationLabel,\n  //\n  EquationForm,\n  Equation,\n  //\n  HTMLEquation,\n  //\n  Animation: anim,\n  //\n  Point: g2.Point,\n  Line: g2.Line,\n  Rect: g2.Rect,\n  Transform: g2.Transform,\n  Translation: g2.Translation,\n  Scale: g2.Scale,\n  Rotation: g2.Rotation,\n  parsePoint: g2.getPoint,\n  LineBounds: g2.LineBounds,\n  TransformBounds: g2.TransformBounds,\n  RectBounds: g2.RectBounds,\n  RangeBounds: g2.RangeBounds,\n  minAngleDiff: g2.minAngleDiff,\n  getTriangleCenter: g2.getTriangleCenter,\n  polarToRect: g2.polarToRect,\n  rectToPolar: g2.rectToPolar,\n  threePointAngle: g2.threePointAngle,\n  threePointAngleMin: g2.threePointAngleMin,\n  clipAngle: g2.clipAngle,\n  getPoint: g2.getPoint,\n  getPoints: g2.getPoints,\n  getScale: g2.getScale,\n  getLine: g2.getLine,\n  getRect: g2.getRect,\n  getTransform: g2.getTransform,\n\n  // math\n  round: math.round,\n  range: math.range,\n  randSign: math.randSign,\n  randInt: math.randInt,\n  rand: math.rand,\n  randElement: math.randElement,\n  randElements: math.randElements,\n  removeRandElement: math.removeRandElement,\n};\n\nexport default Fig;\n","// @flow\nimport type {\n  OBJ_PositionAnimationStep,\n} from './AnimationStep/ElementAnimationStep/PositionAnimationStep';\nimport PositionAnimationStep from './AnimationStep/ElementAnimationStep/PositionAnimationStep';\n\nimport type {\n  OBJ_ScenarioAnimationStep,\n} from './AnimationStep/ElementAnimationStep/ScenarioAnimationStep';\nimport ScenarioAnimationStep from './AnimationStep/ElementAnimationStep/ScenarioAnimationStep';\n\n\nimport type {\n  OBJ_ColorAnimationStep,\n} from './AnimationStep/ElementAnimationStep/ColorAnimationStep';\nimport {\n  ColorAnimationStep, DimAnimationStep, UndimAnimationStep, dim,\n  undim,\n} from './AnimationStep/ElementAnimationStep/ColorAnimationStep';\n\n\nimport type {\n  OBJ_OpacityAnimationStep,\n} from './AnimationStep/ElementAnimationStep/OpacityAnimationStep';\nimport {\n  OpacityAnimationStep, DissolveInAnimationStep, dissolveIn,\n  DissolveOutAnimationStep, dissolveOut,\n} from './AnimationStep/ElementAnimationStep/OpacityAnimationStep';\n\n\nimport type {\n  OBJ_TransformAnimationStep,\n} from './AnimationStep/ElementAnimationStep/TransformAnimationStep';\nimport TransformAnimationStep from './AnimationStep/ElementAnimationStep/TransformAnimationStep';\n\nimport type {\n  OBJ_PulseTransformAnimationStep,\n} from './AnimationStep/ElementAnimationStep/PulseTransformAnimationStep';\nimport PulseTransformAnimationStep from './AnimationStep/ElementAnimationStep/PulseTransformAnimationStep';\n\nimport type {\n  OBJ_RotationAnimationStep,\n} from './AnimationStep/ElementAnimationStep/RotationAnimationStep';\nimport RotationAnimationStep from './AnimationStep/ElementAnimationStep/RotationAnimationStep';\n\nimport type {\n  OBJ_ScaleAnimationStep,\n} from './AnimationStep/ElementAnimationStep/ScaleAnimationStep';\nimport ScaleAnimationStep from './AnimationStep/ElementAnimationStep/ScaleAnimationStep';\n\nimport type {\n  OBJ_PulseAnimationStep,\n} from './AnimationStep/ElementAnimationStep/PulseAnimationStep';\nimport PulseAnimationStep from './AnimationStep/ElementAnimationStep/PulseAnimationStep';\n\nimport type {\n  OBJ_TriggerAnimationStep,\n} from './AnimationStep/TriggerStep';\nimport {\n  TriggerAnimationStep, trigger,\n} from './AnimationStep/TriggerStep';\n\nimport type {\n  OBJ_CustomAnimationStep,\n} from './AnimationStep/CustomStep';\nimport {\n  CustomAnimationStep, custom,\n} from './AnimationStep/CustomStep';\n\nimport type {\n  OBJ_ElementAnimationStep,\n} from './AnimationStep/ElementAnimationStep';\n\n\nimport type {\n  OBJ_ParallelAnimationStep,\n} from './AnimationStep/ParallelAnimationStep';\nimport {\n  ParallelAnimationStep, inParallel,\n} from './AnimationStep/ParallelAnimationStep';\n\nimport type {\n  OBJ_SerialAnimationStep,\n} from './AnimationStep/SerialAnimationStep';\nimport {\n  SerialAnimationStep, inSerial,\n} from './AnimationStep/SerialAnimationStep';\n\n// import type {\n//   OBJ_AnimationStep,\n// } from './AnimationStep/DelayAnimationStep';\nimport {\n  DelayAnimationStep, delay,\n} from './AnimationStep/DelayStep';\n\nimport type {\n  OBJ_AnimationStep,\n} from './AnimationStep';\nimport AnimationStep from './AnimationStep';\n\nimport type {\n  TypeAnimationManagerInputOptions,\n} from './AnimationManager';\n\n// eslint-disable-next-line import/no-cycle\nimport AnimationManager from './AnimationManager';\n\nimport type { OBJ_AnimationBuilder } from './AnimationBuilder';\n// eslint-disable-next-line import/no-cycle\nimport AnimationBuilder from './AnimationBuilder';\n\n\nexport type {\n  OBJ_PositionAnimationStep, OBJ_AnimationBuilder,\n  OBJ_ParallelAnimationStep, OBJ_SerialAnimationStep,\n  OBJ_TransformAnimationStep, OBJ_AnimationStep,\n  OBJ_TriggerAnimationStep,\n  OBJ_ColorAnimationStep, OBJ_CustomAnimationStep,\n  TypeAnimationManagerInputOptions, OBJ_RotationAnimationStep,\n  OBJ_ScaleAnimationStep, OBJ_PulseAnimationStep,\n  OBJ_OpacityAnimationStep, OBJ_ScenarioAnimationStep,\n  OBJ_PulseTransformAnimationStep, OBJ_ElementAnimationStep,\n};\nexport {\n  PositionAnimationStep, AnimationBuilder, ParallelAnimationStep, SerialAnimationStep,\n  TransformAnimationStep, AnimationStep, DelayAnimationStep, TriggerAnimationStep,\n  inParallel, inSerial, trigger, delay, ColorAnimationStep,\n  DissolveInAnimationStep, dissolveIn, DissolveOutAnimationStep, dissolveOut,\n  CustomAnimationStep, custom, AnimationManager, RotationAnimationStep,\n  ScaleAnimationStep, PulseAnimationStep, OpacityAnimationStep,\n  DimAnimationStep, dim, UndimAnimationStep, undim, ScenarioAnimationStep,\n  PulseTransformAnimationStep,\n};\n","// @flow\n// import * as tools from '../../tools/math';\n// eslint-disable-next-line import/no-cycle\nimport { FigureElement } from '../Element';\nimport type { OBJ_SerialAnimationStep } from './AnimationStep/SerialAnimationStep';\nimport type {\n  OBJ_PositionAnimationStep, OBJ_ParallelAnimationStep,\n  OBJ_AnimationStep, OBJ_TriggerAnimationStep,\n  OBJ_ColorAnimationStep, OBJ_CustomAnimationStep,\n  OBJ_TransformAnimationStep,\n  OBJ_RotationAnimationStep, OBJ_ScaleAnimationStep,\n  OBJ_PulseAnimationStep, OBJ_OpacityAnimationStep,\n  OBJ_PulseTransformAnimationStep,\n  AnimationStep, OBJ_ScenarioAnimationStep, OBJ_ElementAnimationStep,\n} from './Animation';\n// import PositionAnimationStep from './AnimationStep/ElementAnimationStep/PositionAnimationStep';\n// import SerialAnimationStep from './AnimationStep/SerialAnimationStep';\n// eslint-disable-next-line import/no-cycle\nimport * as animation from './Animation';\nimport { joinObjects, duplicateFromTo } from '../../tools/tools';\n// import { getState, setState } from '../state';\n// import type Figure from '../Figure';\n\n/**\n * Animation builder options object\n * @extends OBJ_SerialAnimationStep\n * @property {FigureElement} [element]\n */\nexport type OBJ_AnimationBuilder = {\n  element?: FigureElement;\n  customSteps?: Array<{\n    step: (Object) => AnimationStep,\n    name: string,\n  }>;\n} & OBJ_SerialAnimationStep;\n\n/**\n * Animation Builder\n *\n * Convenient way to build animation steps in serial. Each step returns the\n * same builder object, and so chaining in a fluent like API can be achieved.\n *\n * @extends SerialAnimationStep\n * @see <a href=\"#animationmanagernew\">AnimationManager.new</a>\n *\n * @example\n * p.animations.new()\n *   .delay(1)\n *   .position({ target: [1, 0], duration: 2 })\n *   .delay(1)\n *   .rotation({ target: Math.PI, duration: 2 })\n *   .start();\n */\nexport default class AnimationBuilder extends animation.SerialAnimationStep {\n  element: ?FigureElement;\n\n  /**\n   * @hideconstructor\n   */\n  constructor(\n    elementOrOptions: FigureElement | OBJ_AnimationBuilder = {},\n    ...options: Array<OBJ_AnimationBuilder>\n  ) {\n    const defaultOptions = {\n      customSteps: [],\n    };\n    let optionsToUse;\n    if (elementOrOptions instanceof FigureElement) {\n      optionsToUse = joinObjects({}, defaultOptions, ...options);\n      optionsToUse.element = elementOrOptions;\n    } else {\n      optionsToUse = joinObjects({}, defaultOptions, elementOrOptions, ...options);\n    }\n    super(optionsToUse);\n    this.element = optionsToUse.element;\n    this._stepType = 'builder';\n    optionsToUse.customSteps.forEach((customStep) => {  // $FlowFixMe\n      this[customStep.name] = (...optionsIn) => {\n        const defOptions = { element: this.element };\n        const o = joinObjects({}, defOptions, ...optionsIn);\n        this.then(customStep.step(o));\n        return this;\n      };\n    });\n    return this;\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  // _finishSetState(figure: Figure) {\n  //   if (this.element != null && typeof this.element === 'string') {\n  //     const element = figure.getElement(this.element);\n  //     if (element != null) {\n  //       this.element = element;\n  //     }\n  //   }\n  // }\n\n  // _getState() {\n  //   const state = super._getState();\n\n  //   // const state = getState(this, keys);\n  //   if (this.element != null) {\n  //     state.element = this.element.getPath();\n  //   }\n  //   return state;\n  // }\n\n  // fnExec(idOrFn: string | Function | null, ...args: any) {\n  //   const result = this.fnMap.exec(idOrFn, ...args);\n  //   if (result == null && this.element != null) {\n  //     return this.element.fnMap.exec(idOrFn, ...args);\n  //   }\n  //   return result;\n  // }\n  fnExec(idOrFn: string | Function | null, ...args: any) {\n    // const result = this.fnMap.exec(idOrFn, ...args);\n    // if (result == null && this.element != null) {\n    //   return this.element.fnMap.exec(idOrFn, ...args);\n    // }\n    // return result;\n    if (this.element != null) {\n      return this.fnMap.execOnMaps(\n        idOrFn, [this.element.fnMap.map], ...args,\n      );\n    }\n    return this.fnMap.exec(idOrFn, ...args);\n  }\n\n  _fromState(state: Object, getElement: ?(string) => FigureElement) {\n    // const obj = new this.constructor();\n    joinObjects(this, state);\n    if (this.element != null && typeof this.element === 'string' && getElement != null) {\n      this.element = getElement(this.element);\n    }\n    return this;\n  }\n\n  // _getStateProperties() {  // eslint-disable-line class-methods-use-this\n  //   return [...super._getStateProperties(),\n  //     'steps',\n  //   ];\n  // }\n\n  _getStateName() {  // eslint-disable-line class-methods-use-this\n    return 'animationBuilder';\n  }\n\n  _state(options: Object) {\n    const state = super._state(options);\n    // definition.f1Type = 'animationBuilder';\n    // if (this.element != null) {\n    //   definition.state.element = this.element.getPath();\n    // }\n    if (this.element != null) {\n      state.state.element = {\n        f1Type: 'de',\n        state: this.element.getPath(),\n      };\n    }\n    // if (this.steps.length > 0) {\n    //   definition.def.steps = getState()\n    // }\n    return state;\n  }\n\n  /**\n   * Add a custom animation step that uses this element by default\n   * @param {OBJ_CustomAnimationStep} options\n   * @return {AnimationBuilder}\n   */\n  custom(...optionsIn: Array<OBJ_CustomAnimationStep>) {\n    if (this.element != null) {\n      const defaultOptions = { element: this.element };\n      const options = joinObjects({}, defaultOptions, ...optionsIn);\n      this.then(new animation.CustomAnimationStep(options));\n    } else {\n      this.then(new animation.CustomAnimationStep(...optionsIn));\n    }\n    return this;\n  }\n\n  /**\n   * Add a rotation animation step that uses this element by default\n   * @param {OBJ_RotationAnimationStep} options\n   * @return {AnimationBuilder}\n   */\n  rotation(...options: Array<OBJ_RotationAnimationStep>) {\n    if (this.element != null) {\n      const defaultOptions = { element: this.element };\n      const optionsToUse = joinObjects({}, defaultOptions, ...options);\n      this.then(new animation.RotationAnimationStep(optionsToUse));\n    }\n    return this;\n  }\n\n\n  /**\n   * Add a position animation step that uses this element by default\n   * @param {OBJ_PositionAnimationStep} options\n   * @return {AnimationBuilder}\n   */\n  position(...options: Array<OBJ_PositionAnimationStep>) {\n    if (this.element != null) {\n      const defaultOptions = { element: this.element };\n      const optionsToUse = joinObjects({}, defaultOptions, ...options);\n      this.then(new animation.PositionAnimationStep(optionsToUse));\n    }\n    return this;\n  }\n\n  /**\n   * Add a translation animation step that uses this element by default\n   * @param {OBJ_PositionAnimationStep} options\n   * @return {AnimationBuilder}\n   */\n  translation(...options: Array<OBJ_PositionAnimationStep>) {\n    return this.position(...options);\n  }\n\n  /**\n   * Add a scale animation step that uses this element by default\n   * @param {OBJ_ScaleAnimationStep} options\n   * @return {AnimationBuilder}\n   */\n  scale(...options: Array<OBJ_ScaleAnimationStep>) {\n    if (this.element != null) {\n      const defaultOptions = { element: this.element };\n      const optionsToUse = joinObjects({}, defaultOptions, ...options);\n      this.then(new animation.ScaleAnimationStep(optionsToUse));\n    }\n    return this;\n  }\n\n  // moveTo(...optionsIn: Array<OBJ_PositionAnimationStep>) {\n  //   return this.moveToPosition(...optionsIn);\n  // }\n\n  // positionTo(...optionsIn: Array<OBJ_PositionAnimationStep>) {\n  //   return this.moveToPosition(...optionsIn);\n  // }\n\n  /**\n   * Add a transform animation step that uses this element by default\n   * @param {OBJ_ScaleAnimaOBJ_TransformAnimationStepionStep} options\n   * @return {AnimationBuilder}\n   */\n  transform(...options: Array<OBJ_TransformAnimationStep>) {\n    if (this.element != null) {\n      const defaultOptions = { element: this.element };\n      const optionsToUse = joinObjects({}, defaultOptions, ...options);\n      this.then(new animation.TransformAnimationStep(optionsToUse));\n    }\n    return this;\n  }\n\n  pulseTransforms(...options: Array<OBJ_PulseTransformAnimationStep>) {\n    if (this.element != null) {\n      const defaultOptions = { element: this.element };\n      const optionsToUse = joinObjects({}, defaultOptions, ...options);\n      this.then(new animation.PulseTransformAnimationStep(optionsToUse));\n    }\n    return this;\n  }\n\n  /**\n   * Add a scenario animation step that uses this element by default\n   * @param {OBJ_ScenarioAnimationStep} options\n   * @return {AnimationBuilder}\n   */\n  scenario(\n    ...options: Array<OBJ_ScenarioAnimationStep & { scenario: string }>\n  ) {\n    // if (this.element != null) {\n    //   const defaultOptions = { element: this.element };\n    //   const optionsToUse = joinObjects({}, defaultOptions, ...options);\n    //   this.then(optionsToUse.element.anim.scenario(optionsToUse));\n    // }\n    // return this;\n    if (this.element != null) {\n      const defaultOptions = { element: this.element };\n      const optionsToUse = joinObjects({}, defaultOptions, ...options);\n      this.then(new animation.ScenarioAnimationStep(optionsToUse));\n    }\n    return this;\n  }\n\n  /**\n   * Add a scenarios animation step that uses this element by default\n   * @param {OBJ_ScenariosAnimationStep} options\n   * @return {AnimationBuilder}\n   */\n  scenarios(    // eslint-disable-next-line max-len\n    ...options: Array<OBJ_TransformAnimationStep & OBJ_ParallelAnimationStep>\n  ) {\n    if (this.element != null) {\n      const defaultOptions = { element: this.element };\n      const optionsToUse = joinObjects({}, defaultOptions, ...options);\n      this.then(optionsToUse.element.animations.scenarios(optionsToUse));\n    }\n    return this;\n  }\n\n  /**\n   * Add a color animation step that uses this element by default\n   * @param {OBJ_ColorAnimationStep} options\n   * @return {AnimationBuilder}\n   */\n  color(...options: Array<OBJ_ColorAnimationStep>) {\n    if (this.element != null) {\n      const defaultOptions = { element: this.element };\n      const optionsToUse = joinObjects({}, defaultOptions, ...options);\n      this.then(new animation.ColorAnimationStep(optionsToUse));\n    }\n    return this;\n  }\n\n  /**\n   * Add an opacity animation step that uses this element by default\n   * @param {OBJ_OpacityAnimationStep} options\n   * @return {AnimationBuilder}\n   */\n  opacity(...options: Array<OBJ_OpacityAnimationStep>) {\n    if (this.element != null) {\n      const defaultOptions = { element: this.element };\n      const optionsToUse = joinObjects({}, defaultOptions, ...options);\n      this.then(new animation.OpacityAnimationStep(optionsToUse));\n    }\n    return this;\n  }\n\n  /**\n   * Add an dissolve out animation step that uses this element by default\n   * @param {OBJ_ElementAnimationStep} durationOrOptions\n   * @return {AnimationBuilder}\n   */\n  dissolveOut(\n    durationOrOptions: number | OBJ_ElementAnimationStep = {},\n    ...args: Array<OBJ_ElementAnimationStep>\n  ) {\n    const defaultOptions = { element: this.element };\n    let options;\n    if (typeof durationOrOptions === 'number') {\n      options = joinObjects({}, defaultOptions, { duration: durationOrOptions }, ...args);\n    } else {\n      options = joinObjects({}, defaultOptions, durationOrOptions, ...args);\n    }\n    this.then(animation.dissolveOut(options));\n    return this;\n  }\n\n  /**\n   * Add an dissolve in animation step that uses this element by default\n   * @param {OBJ_ElementAnimationStep} durationOrOptions\n   * @return {AnimationBuilder}\n   */\n  dissolveIn(\n    durationOrOptions: number | OBJ_ElementAnimationStep = {},\n    ...args: Array<OBJ_ElementAnimationStep>\n  ) {\n    const defaultOptions = { element: this.element };\n    let options;\n    if (typeof durationOrOptions === 'number') {\n      options = joinObjects({}, defaultOptions, { duration: durationOrOptions }, ...args);\n    } else {\n      options = joinObjects({}, defaultOptions, durationOrOptions, ...args);\n    }\n    this.then(animation.dissolveIn(options));\n    return this;\n  }\n\n  /**\n   * Add an dim animation step that uses this element by default\n   * @param {OBJ_ElementAnimationStep} durationOrOptions\n   * @return {AnimationBuilder}\n   */\n  dim(\n    durationOrOptions: number | OBJ_ElementAnimationStep = {},\n    ...args: Array<OBJ_ElementAnimationStep>\n  ) {\n    const defaultOptions = { element: this.element };\n    let options;\n    if (typeof durationOrOptions === 'number') {\n      options = joinObjects({}, defaultOptions, { duration: durationOrOptions }, ...args);\n    } else {\n      options = joinObjects({}, defaultOptions, durationOrOptions, ...args);\n    }\n    this.then(animation.dim(options));\n    return this;\n  }\n\n  /**\n   * Add an undim animation step that uses this element by default\n   * @param {OBJ_ElementAnimationStep} durationOrOptions\n   * @return {AnimationBuilder}\n   */\n  undim(\n    durationOrOptions: number | OBJ_ElementAnimationStep = {},\n    ...args: Array<OBJ_ElementAnimationStep>\n  ) {\n    const defaultOptions = { element: this.element };\n    let options;\n    if (typeof durationOrOptions === 'number') {\n      options = joinObjects({}, defaultOptions, { duration: durationOrOptions }, ...args);\n    } else {\n      options = joinObjects({}, defaultOptions, durationOrOptions, ...args);\n    }\n    this.then(animation.undim(options));\n    return this;\n  }\n\n  /**\n   * Add a delay animation step\n   * @param {OBJ_AnimationStep} durationOrOptions\n   * @return {AnimationBuilder}\n   */\n  delay(\n    delayOrOptions: number | OBJ_AnimationStep = {},\n    ...args: Array<OBJ_AnimationStep>\n  ) {\n    this.then(animation.delay(delayOrOptions, ...args));\n    return this;\n  }\n\n  /**\n   * Add a trigger animation step\n   * @param {OBJ_TriggerAnimationStep} triggerOrOptions\n   * @return {AnimationBuilder}\n   */\n  trigger(\n    triggerOrOptions: Function | OBJ_TriggerAnimationStep = {},\n    ...args: Array<OBJ_TriggerAnimationStep>\n  ) {\n    if (this.element != null) {\n      const defaultOptions = { element: this.element };\n      const optionsToUse = joinObjects({}, defaultOptions, ...args);\n      this.then(animation.trigger(triggerOrOptions, optionsToUse));\n    } else {\n      this.then(animation.trigger(triggerOrOptions, ...args));\n    }\n    // this.then(animation.trigger(triggerOrOptionsIn, ...optionsIn));\n    return this;\n  }\n\n  /**\n   * Add a parallel animation step\n   * @param {Array<AnimationStep | null> | OBJ_ParallelAnimationStep} stepsOrOptions\n   * @return {AnimationBuilder}\n   */\n  inParallel(\n    stepsOrOptions: Array<animation.AnimationStep | null>\n                      | OBJ_ParallelAnimationStep = {},\n    ...options: Array<OBJ_ParallelAnimationStep>\n  ) {\n    this.then(animation.inParallel(stepsOrOptions, ...options));\n    return this;\n  }\n\n  /**\n   * Add a serial animation step\n   * @param {Array<AnimationStep | null> | OBJ_SerialAnimationStep} stepsOrOptions\n   * @return {AnimationBuilder}\n   */\n  inSerial(\n    stepsOrOptions: Array<animation.AnimationStep> | OBJ_SerialAnimationStep = {},\n    ...options: Array<OBJ_SerialAnimationStep>\n  ) {\n    this.then(animation.inSerial(stepsOrOptions, ...options));\n    return this;\n  }\n\n  pulse(...optionsIn: Array<OBJ_PulseAnimationStep>) {\n    const defaultOptions = { element: this.element };\n    const options = joinObjects({}, defaultOptions, ...optionsIn);\n    this.then(new animation.PulseAnimationStep(options));\n    return this;\n  }\n\n  reset() {\n    this.steps = [];\n    this.state = 'idle';\n  }\n\n  // whenFinished(callback: (boolean) => void) {\n  //   super.whenFinished(callback);\n  //   return this;\n  // }\n\n  _dup() {\n    const newBuilder = new AnimationBuilder();\n    duplicateFromTo(this, newBuilder, ['element']);\n    newBuilder.element = this.element;\n    return newBuilder;\n  }\n}\n","// @flow\n// import * as tools from '../../tools/math';\n// eslint-disable-next-line import/no-cycle\nimport { FigureElement } from '../Element';\n// import type { OBJ_SerialAnimationStep } from './AnimationStep/SerialAnimationStep';\n// import type {\n//   OBJ_PositionAnimationStep, OBJ_ParallelAnimationStep,\n//   OBJ_AnimationStep, OBJ_TriggerAnimationStep,\n//   OBJ_ColorAnimationStep, OBJ_CustomAnimationStep,\n// } from './Animation';\n// eslint-disable-next-line import/no-cycle\nimport * as anim from './Animation';\nimport type {\n  AnimationStep, OBJ_AnimationBuilder, OBJ_AnimationStep,\n  OBJ_RotationAnimationStep, OBJ_ScaleAnimationStep, OBJ_TriggerAnimationStep,\n  OBJ_PositionAnimationStep, OBJ_ColorAnimationStep, OBJ_OpacityAnimationStep,\n  OBJ_TransformAnimationStep, OBJ_PulseTransformAnimationStep,\n  OBJ_PulseAnimationStep, OBJ_ElementAnimationStep,\n  OBJ_ScenarioAnimationStep, OBJ_ParallelAnimationStep,\n} from './Animation';\n// eslint-disable-next-line import/no-cycle\n// import {\n//   AnimationStep,\n// } from './Animation';\nimport GlobalAnimation from '../webgl/GlobalAnimation';\nimport { joinObjects, duplicateFromTo, SubscriptionManager } from '../../tools/tools';\nimport { getState } from '../Recorder/state';\nimport { FunctionMap } from '../../tools/FunctionMap';\nimport type { TypeWhen } from '../webgl/GlobalAnimation';\n// import type { OBJ_AnimationStep } from './AnimationStep';\nimport type { TypeParsablePoint } from '../../tools/g2';\n// import type Figure from '../Figure';\n\n/**\n * Scenarios animation step options object\n * @extends OBJ_AnimationStep\n * @property {string} target name of scenario\n */\nexport type OBJ_ScenariosAnimationStep = {\n  target: string;\n} & OBJ_AnimationStep;\n\n/**\n * Animation start time options.\n *\n * {@link TypeWhen} | number | null\n *\n * When multiple animations need to be started, it is often\n * desirable to synchronise their start times.\n *\n * `'nextFrame'` will start the animation on the\n * next animation frame. Starting several animations with `nextFrame`\n * will ensure they are all synchronized to that frame time.\n *\n * Similarly `'prevFrame'` starts the animation on the last animation\n * frame.\n *\n * `'syncNow'` will start an animation at a synchronized 'now' time. The\n * first time 'syncNow' is used, the current time will be stored and used\n * for all subsequent calls to 'syncNow'. 'syncNow' is reset every\n * time a new animation frame is drawn.\n *\n * Alternately, `'now'` can be used which will use the current time as\n * the animation start time. As javascript is single threaded, using `'now`\n * on multiple animations will result in them all having slightly different\n * start times.\n *\n * A custom time can be used if a `number` is defined.\n *\n * `null` will result in `'nextFrame'` being used\n * @typedef {TypeWhen | number | null} AnimationStartTime\n */\nexport type AnimationStartTime = TypeWhen | number | null;\n\n/**\n * Start animation options object.\n *\n * @property {null | string} [name] name of animation to start - f null, then\n * all animations associated with this animation manager will start (`null`)\n * @property {AnimationStartTime} startTime when to\n * start the animation\n */\nexport type OBJ_AnimationStart = {\n  name?: string,\n  // startTIme?: 'nextFrame' | 'prevFrame' | 'now' | 'syncNow',\n  startTime: AnimationStartTime,\n};\n\nexport type TypeAnimationManagerInputOptions = {\n  element?: FigureElement;\n  finishedCallback?: ?(string | (() => void)),\n};\n\n/* eslint-disable max-len */\n/**\n * Animation Manager\n *\n * This class manages animations and creates animation steps for use in\n * animations.\n *\n * Each {@link FigureElement} has its own `AnimationManager` in the\n * `animations` property, though any\n * animation manager can animate any other element. Therefore all parallel\n * animations can go through the same manager, or be spread throughout\n * different element's animation managers. Spread animations out between\n * elements, or keeping them all in one `AnimationManager` can change how\n * readable code is, how convenient it is to cancel running animations, and\n * what order the animations are performed in (`AnimationManager`s tied\n * to elements drawn earlier will perform their animation steps before those\n * tied to elements drawn later). `AnimationManager`s will only be processed\n * on each animation frame if the element they are tied to is not hidden.\n *\n * The `animations` property within `AnimationManager` is simply an array that\n * contains a number {@link AnimationStep}s that are executed in parallel.\n * Typically, these steps would themselves be {@link SerialAnimationStep}s or a\n * series of animations. This means the animation manager is running a number of\n * animation series in parallel.\n *\n *\n * The `AnimationManager`s on {@link FigureElement}s should be used instead\n * of instantiating this class separately, as those on `FigureElements` will\n * be automatically processed every animation frame.\n *\n * @param\n * @property {'animating' | 'idle' | 'waitingToStart'} state\n * @property {Array<AnimationStep>} animations\n * @property {SubscriptionManager} subscriptions\n * @see {@link FigureElement}\n * @see {@link AnimationBuilder}\n * @example\n * // At its heart the `AnimationManager` is just executing\n * // an array of animation steps.\n *\n * // Create animation steps\n * const position = new Fig.Animation.PositionAnimationStep({\n *   element: p,\n *   target: [1, 0],\n *   duration: 2,\n * });\n * const rotation = new Fig.Animation.RotationAnimationStep({\n *   element: p,\n *   target: Math.PI,\n *   duration: 2,\n * });\n *\n * // Combine the animations into a SerialAnimationStep\n * const series = new Fig.Animation.SerialAnimationStep([\n *   position,\n *   rotation,\n * ]);\n *\n * // Add the animations to the animation manager and start\n * p.animations.animations.push(series);\n * p.animations.start();\n *\n * @example\n * // Using the `new` method in `AnimationManager` creates a convenient\n * // `AnimationBuilder` which extends a `SerialAnimationStep` by using\n * // a fluent API pattern\n * //\n * // Create animation steps\n * const position = new Fig.Animation.PositionAnimationStep({\n *   element: p,\n *   target: [1, 0],\n *   duration: 2,\n * });\n * const rotation = new Fig.Animation.RotationAnimationStep({\n *   element: p,\n *   target: Math.PI,\n *   duration: 2,\n * });\n *\n * // Build and start the animation\n * p.animations.new()\n *   .then(position)\n *   .then(rotation)\n *   .start();\n *\n * @example\n * // `AnimationStep`s can also be created from the `AnimationManager`\n * // with the added convenience that the `FigureElement` that\n * // has the `AnimationManager` will be used as the default\n * // `element` property. This combined with the `AnimationBuilder`\n * // makes defining most animations clean and readable code\n *\n * // Build and start the animation\n * p.animations.new()\n *   .position({ target: [1, 0], duration: 2 })\n *   .rotation({ target: Math.PI, duration: 2 })\n *   .start();\n *\n * @example\n * // Parallel animations however still need to use explicit animation steps.\n * // Creating the steps from the `AnimationManager` means the `element` doesn't\n * // need to be defined.\n * //\n * p.animations.new()\n *   .inParallel([\n *     p.animations.position({ target: [1, 0], duration: 2 }),\n *     p.animations.rotation({ target: Math.PI, duration: 2 })\n *   ])\n *   .start();\n */\nexport default class AnimationManager {\n  element: ?FigureElement;\n  animations: Array<anim.AnimationStep>;\n  state: 'animating' | 'idle' | 'waitingToStart';\n  fnMap: FunctionMap;\n  finishedCallback: ?(string | (() => void));\n  subscriptions: SubscriptionManager;\n  options: {\n    translation?: {\n      style: 'curve' | 'linear',\n      angle: number,\n      magnitude: number,\n      offset: number,\n      controlPoint: TypeParsablePoint | null,\n      direction: 'positive' | 'negative' | 'up' | 'down' | 'left' | 'right',\n    },\n  };\n\n  animationSpeed: number;\n\n  customSteps: Array<{\n    step: (Object) => AnimationStep,\n    name: string,\n  }>;\n\n  /* eslint-enable max-len */\n\n  /**\n   * @hideconstructor\n   */\n  constructor(\n    elementOrOptionsIn: FigureElement | TypeAnimationManagerInputOptions = {},\n    ...optionsIn: Array<TypeAnimationManagerInputOptions>\n  ) {\n    const defaultOptions = {\n      finishedCallback: null,\n    };\n    let options;\n    if (elementOrOptionsIn instanceof FigureElement) {\n      options = joinObjects({}, defaultOptions, ...optionsIn);\n      options.element = elementOrOptionsIn;\n    } else {\n      options = joinObjects({}, defaultOptions, elementOrOptionsIn, ...optionsIn);\n    }\n    this.element = options.element;\n    this.animations = [];\n    this.state = 'idle';      // $FlowFixMe\n    this.options = { translation: {} };\n    this.fnMap = new FunctionMap();\n    this.finishedCallback = options.finishedCallback;\n    this.subscriptions = new SubscriptionManager();\n    this.customSteps = [];\n    this.animationSpeed = 1;\n    // this.setupAnimationSteps();\n    return this;\n  }\n\n  /**\n   * New animation builder attached to this animation manager\n   * @return AnimationBuilder\n   * @example\n   * p.animations.new()\n   *   .position({ target: [0.5, 0], duration: 2 })\n   *   .rotation({ target: Math.PI, duration: 2 })\n   *   .start();\n   *\n   */\n  new(name: ?string) {\n    const options = {\n      customSteps: this.customSteps,\n    };\n    if (this.element != null) { // $FlowFixMe\n      options.element = this.element;\n    }\n    if (name != null) { // $FlowFixMe\n      options.name = name;\n    }\n    const animation = new anim.AnimationBuilder(options);\n    this.animations.push(animation);\n    if (this.element != null) {\n      this.element.animateNextFrame();\n    }\n    return animation;\n  }\n\n  /**\n   * Set time speed of animation relative to real time, where 1 is real time,\n   * <1 is slower than real time and >1 is faster than real time.\n   *\n   * @param {number} speed\n   */\n  setTimeSpeed(speed: number = 1) {\n    this.animationSpeed = speed;\n  }\n\n  /**\n   * Animation builder object\n   * @param {OBJ_AnimationBuilder} options\n   * @return {AnimationBuilder}\n   */\n  // eslint-disable-next-line max-len\n  builder(...options: Array<OBJ_AnimationBuilder>) {  // $FlowFixMe\n    return new anim.AnimationBuilder(this, {\n      customSteps: this.customSteps,\n    }, ...options);\n  }\n\n  /**\n   * Create a Rotation animation step that uses this element by default\n   * @param {OBJ_RotationAnimationStep} options\n   * @return {RotationAnimationStep}\n   * @example\n   * const rot = p.animations.rotation({ target: Math.PI, duration: 2 });\n   * p.animations.new()\n   *   .then(rot)\n   *   .start();\n   */\n  rotation(...options: Array<OBJ_RotationAnimationStep>) {\n    const optionsToUse = joinObjects({}, { element: this.element }, ...options);\n    return new anim.RotationAnimationStep(optionsToUse);\n  }\n\n  /**\n   * Create a Scale animation step tied to this element\n   * @param {OBJ_ScaleAnimationStep} options\n   * @return {ScaleAnimationStep}\n   */\n  scale(...options: Array<OBJ_ScaleAnimationStep>) {\n    const optionsToUse = joinObjects({}, { element: this.element }, ...options);\n    return new anim.ScaleAnimationStep(optionsToUse);\n  }\n\n  /**\n   * Create a Trigger animation step\n   * @param {OBJ_TriggerAnimationStep | function(): void} options\n   * @return {TriggerAnimationStep}\n   */\n  // eslint-disable-next-line class-methods-use-this\n  trigger(options: (() => void) | Array<OBJ_TriggerAnimationStep>) {\n    return new anim.TriggerAnimationStep(options);\n  }\n\n  /**\n   * Create a Delay animation step\n   * Use the `duration` value in `options` to define delay duration\n   * @param {number | OBJ_AnimationStep} delayOrOptions\n   * @return {DelayAnimationStep}\n   */\n  // eslint-disable-next-line class-methods-use-this\n  delay(\n    delayOrOptions: number | OBJ_AnimationStep = {},\n    // ...args: Array<OBJ_AnimationStep>\n  ) {\n    // let optionsToUse;\n    // if (typeof delayOrOptions === 'number') {\n    //   optionsToUse = joinObjects({}, { duration: delayOrOptions }, ...args);\n    // } else {\n    //   optionsToUse = joinObjects({}, delayOrOptions, ...args);\n    // }\n    return new anim.DelayAnimationStep(delayOrOptions);\n  }\n\n  /**\n   * Create a Translation or Position animation step tied to this element\n   * @param {OBJ_PositionAnimationStep} options\n   * @return {PositionAnimationStep}\n   */\n  translation(...options: Array<OBJ_PositionAnimationStep>) {\n    const optionsToUse = joinObjects({}, { element: this.element }, ...options);\n    return new anim.PositionAnimationStep(optionsToUse);\n  }\n\n  /**\n   * Create a Translation or Position animation step tied to this element\n   * @param {OBJ_PositionAnimationStep} options\n   * @return {PositionAnimationStep}\n   */\n  position(...options: Array<OBJ_PositionAnimationStep>) {\n    const optionsToUse = joinObjects({}, { element: this.element }, ...options);\n    return new anim.PositionAnimationStep(optionsToUse);\n  }\n\n  /**\n   * Create a Color animation step tied to this element\n   * @param {OBJ_ColorAnimationStep} options\n   * @return {ColorAnimationStep}\n   */\n  color(...options: Array<OBJ_ColorAnimationStep>) {\n    const optionsToUse = joinObjects({}, { element: this.element }, ...options);\n    return new anim.ColorAnimationStep(optionsToUse);\n  }\n\n  /**\n   * Create a Opacity animation step tied to this element\n   * @param {OBJ_OpacityAnimationStep} options\n   * @return {OpacityAnimationStep}\n   */\n  opacity(...options: Array<OBJ_OpacityAnimationStep>) {\n    const optionsToUse = joinObjects({}, { element: this.element }, ...options);\n    return new anim.OpacityAnimationStep(optionsToUse);\n  }\n\n  /**\n   * Create a Transform animation step tied to this element\n   * @param {OBJ_TransformAnimationStep} options\n   * @return {TransformAnimationStep}\n   */\n  transform(...options: Array<OBJ_TransformAnimationStep>) {\n    const optionsToUse = joinObjects({}, { element: this.element }, ...options);\n    return new anim.TransformAnimationStep(optionsToUse);\n  }\n\n  pulseTransform(...options: Array<OBJ_PulseTransformAnimationStep>) {\n    const optionsToUse = joinObjects({}, { element: this.element }, ...options);\n    return new anim.PulseTransformAnimationStep(optionsToUse);\n  }\n\n  pulse(...options: Array<OBJ_PulseAnimationStep>) {\n    const optionsToUse = joinObjects({}, { element: this.element }, ...options);\n    return new anim.PulseAnimationStep(optionsToUse);\n  }\n\n  /**\n   * Create a Dissolve in animation step\n   * Use the `duration` value in `options` to define dissolving duration\n   * @param {number | OBJ_ElementAnimationStep} timeOrOptions\n   * @return {DissolveInAnimationStep}\n   */\n  dissolveIn(durationOrOptions: number | OBJ_ElementAnimationStep = {}) {\n    const defaultOptions = { element: this.element };\n    let optionsToUse;\n    if (typeof durationOrOptions === 'number') {\n      optionsToUse = joinObjects({}, defaultOptions, { duration: durationOrOptions });\n    } else {\n      optionsToUse = joinObjects({}, defaultOptions, durationOrOptions);\n    }\n    return new anim.DissolveInAnimationStep(optionsToUse);\n  }\n\n  /**\n   * Create a Dissolve out animation step\n   * Use the `duration` value in `options` to define dissolving duration\n   * @param {number | OBJ_ElementAnimationStep} durationOrOptions\n   * @return {DissolveOutAnimationStep}\n   */\n  dissolveOut(durationOrOptions: number | OBJ_ElementAnimationStep = {}) {\n    const defaultOptions = { element: this.element };\n    let optionsToUse;\n    if (typeof durationOrOptions === 'number') {\n      optionsToUse = joinObjects({}, defaultOptions, { duration: durationOrOptions });\n    } else {\n      optionsToUse = joinObjects({}, defaultOptions, durationOrOptions);\n    }\n    return new anim.DissolveOutAnimationStep(optionsToUse);\n  }\n\n  /**\n   * Create a Dim color animation step\n   * Use the `duration` value in `options` to define dimming duration\n   * @param {number | OBJ_ElementAnimationStep} durationOrOptions\n   * @return {DimAnimationStep}\n   */\n  dim(durationOrOptions: number | OBJ_ElementAnimationStep = {}) {\n    const defaultOptions = { element: this.element };\n    let optionsToUse;\n    if (typeof durationOrOptions === 'number') {\n      optionsToUse = joinObjects({}, defaultOptions, { duration: durationOrOptions });\n    } else {\n      optionsToUse = joinObjects({}, defaultOptions, durationOrOptions);\n    }\n    return new anim.DimAnimationStep(optionsToUse);\n  }\n\n  /**\n   * Create a Undim color animation step\n   * Use the `duration` value in `options` to define undimming duration\n   * @param {number | OBJ_ElementAnimationStep} durationOrOptions\n   * @return {UndimAnimationStep}\n   */\n  undim(durationOrOptions: number | OBJ_ColorAnimationStep = {}) {\n    const defaultOptions = { element: this.element };\n    let optionsToUse;\n    if (typeof durationOrOptions === 'number') {\n      optionsToUse = joinObjects({}, defaultOptions, { duration: durationOrOptions });\n    } else {\n      optionsToUse = joinObjects({}, defaultOptions, durationOrOptions);\n    }\n    return new anim.UndimAnimationStep(optionsToUse);\n  }\n\n  /**\n   * Create a Scenario animation step tied to this element\n   * @param {OBJ_ScenarioAnimationStep} options\n   * @return {ScenarioAnimationStep}\n   */\n  scenario(...options: Array<OBJ_ScenarioAnimationStep>) {\n    const optionsToUse = joinObjects({}, { element: this.element }, ...options);\n    return new anim.ScenarioAnimationStep(optionsToUse);\n  }\n\n  /**\n   * Create a Parallel animation step that animates\n   * all child elements with the target scenario name\n   * @param {OBJ_ScenariosAnimationStep} options\n   * @return {ParallelAnimationStep}\n   */\n  scenarios(...options: Array<OBJ_ParallelAnimationStep & OBJ_TransformAnimationStep>) {\n    const defaultOptions = { element: this.element };\n    const optionsToUse = joinObjects({}, defaultOptions, ...options);\n    const elements = optionsToUse.element.getAllElementsWithScenario(optionsToUse.target);\n    const steps = [];\n    const simpleOptions = {};\n    duplicateFromTo(optionsToUse, simpleOptions, ['steps', 'element']);\n    elements.forEach((element) => {\n      steps.push(element.animations.scenario(simpleOptions));\n    });\n    return new anim.ParallelAnimationStep(simpleOptions, { steps });\n  }\n\n  _state(options: Object) {\n    const state = getState(this, [\n      'animations',\n      'state',\n      'options',\n    ], options);\n    if (this.element != null) {\n      state.element = {\n        f1Type: 'de',\n        state: this.element.getPath(),\n      };\n    }\n    return state;\n  }\n\n  // _finishSetState(figure: Figure) {\n  //   for (let i = 0; i < this.animations.length; i += 1) {\n  //     const animationStepState = this.animations[i];\n  //     let animationStep = {};\n  //     if (animationStepState._stepType === 'builder') {\n  //       animationStep = new anim.AnimationBuilder();\n  //     }\n  //     if (animationStepState._stepType === 'position') {\n  //       animationStep = new anim.PositionAnimationStep();\n  //     }\n  //     joinObjects(animationStep, animationStepState);\n  //     animationStep._finishSetState(figure);\n  //     this.animations[i] = animationStep;\n  //   }\n  //   // this.animations.forEach((animation) => {\n  //   //   let animationStep = {};\n  //   //   if (animation.type === 'builder') {\n  //   //     animationStep = new anim.AnimationBuilder();\n  //   //   }\n  //   //   if (animation.type === 'position') {\n  //   //     animationStep = new anim.PositionAnimationStep();\n  //   //   }\n  //   //   joinObjects(animationStep, animation);\n  //   //   animation._finishSetState(figure);\n  //   //   // }\n  //   // });\n  // }\n\n  setTimeDelta(delta: number) {\n    this.animations.forEach((animation) => {\n      animation.setTimeDelta(delta);\n    });\n  }\n\n  willStartAnimating() {\n    if (this.state === 'animating') {\n      return true;\n    }\n\n    let isAnimating = false;\n    this.animations.forEach((animation) => {\n      if (animation.state === 'waitingToStart' || animation.state === 'animating') {\n        isAnimating = true;\n      }\n    });\n    return isAnimating;\n  }\n\n  isAnimating() {\n    if (this.state === 'animating' || this.state === 'waitingToStart') {\n      return true;\n    }\n    for (let i = 0; i < this.animations.length; i += 1) {\n      const animation = this.animations[i];\n      if (animation.state === 'waitingToStart' || animation.state === 'animating') {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  nextFrame(now: number) {\n    // console.log('animation manager', now)\n    // console.log(this.element.name, this.state, this.animations)\n    const animationsToRemove = [];\n    let remaining = null;\n    let isAnimating = false;\n    this.animations.forEach((animation, index) => {\n      let animationIsAnimating = false;\n      // console.log(this.element.name, animation.state)\n      if (animation.state === 'waitingToStart' || animation.state === 'animating') {\n        const stepRemaining = animation.nextFrame(now, this.animationSpeed);\n        if (remaining === null) {\n          remaining = stepRemaining;\n        }\n        if (stepRemaining < remaining) {\n          remaining = stepRemaining;\n        }\n        animationIsAnimating = true;\n      }\n      if (animation.state === 'finished' && animation.removeOnFinish) {\n        animationIsAnimating = false;\n        animationsToRemove.push(index);\n      }\n      if (animationIsAnimating) {\n        isAnimating = true;\n      }\n    });\n\n    let callback = null;\n    if (isAnimating) {\n      this.state = 'animating';\n    } else {\n      if (this.state === 'animating') {\n        this.state = 'idle';\n        callback = this.finishedCallback;\n        this.subscriptions.publish('finished');\n        // this.fnMap.exec(this.finishedCallback);\n      }\n      this.state = 'idle';\n    }\n    for (let i = animationsToRemove.length - 1; i >= 0; i -= 1) {\n      this.animations.splice(animationsToRemove[i], 1);\n    }\n    // if (callback != null) {\n    //   console.log('finished', this.element.name, callback)\n    // }\n    this.fnMap.exec(callback);\n    return remaining;\n  }\n\n  cleanAnimations() {\n    const animationsToRemove = [];\n    let isAnimating = false;\n    for (let i = 0; i < this.animations.length; i += 1) {\n      const animation = this.animations[i];\n      if (animation.state === 'finished' && animation.removeOnFinish) {\n        animationsToRemove.push(i);\n      } else if (animation.state === 'animating' || animation.state === 'waitingToStart') {\n        isAnimating = true;\n      }\n    }\n    for (let i = animationsToRemove.length - 1; i >= 0; i -= 1) {\n      this.animations.splice(animationsToRemove[i], 1);\n    }\n    if (isAnimating) {\n      this.state = 'animating';\n    } else {\n      if (this.state === 'animating') {\n        this.state = 'idle';\n        // console.log('clean finished', this.element.name, this.finishedCallback)\n        this.fnMap.exec(this.finishedCallback);\n        this.subscriptions.publish('finished');\n      }\n      this.state = 'idle';\n    }\n  }\n\n  // Cancel all primary animations with the name\n  // animations will be cleaned up on next frame\n  /**\n   * Cancel one or all animations managed by this manager (in the `animations`\n   * array).\n   * @param {null | string} name name of animation or `null` to cancel all\n   * (`null`)\n   * @param {null | 'complete' | 'freeze'} force force the animation to complete\n   * or freeze - `null` will perform the default operation (`null`)\n   */\n  cancel(name: ?string, force: ?'complete' | 'freeze' = null) {\n    if (name == null) {\n      this.cancelAll(force);\n    } else {\n      for (let i = 0; i < this.animations.length; i += 1) {\n        const animation = this.animations[i];\n        if (animation.name === name) {\n          animation.cancel(force);\n        }\n      }\n      this.cleanAnimations();\n    }\n  }\n\n  cancelAll(how: ?'complete' | 'freeze' = null, force: boolean = false) {\n    for (let i = 0; i < this.animations.length; i += 1) {\n      if (force || !this.animations[i].name.startsWith('_noStop_')) {\n        this.animations[i].cancel(how);\n      }\n    }\n    this.cleanAnimations();\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  getFrameTime(frame: 'nextFrame' | 'prevFrame' | 'now' | 'syncNow') {\n    new GlobalAnimation().getWhen(frame);\n  }\n\n  /**\n   * Start one or all animations managed by this manager (in the `animations`\n   * array).\n   *\n   * @param {OBJ_AnimationStart} [options]\n   */\n  start(options: OBJ_AnimationStart) {\n    const optionsToUse = joinObjects({}, options, { name: null, startTime: 'nextFrame' });\n    const { name, startTime } = optionsToUse;\n    const frameTime = this.getFrameTime(startTime);\n    if (name == null) {\n      this.startAll(startTime);\n    } else {\n      for (let i = 0; i < this.animations.length; i += 1) {\n        const animation = this.animations[i];\n        if (animation.name === name) {\n          if (animation.state !== 'animating') {\n            animation.start(frameTime);\n            animation.finishIfZeroDuration();\n            if (animation.state === 'animating') {\n              this.state = 'animating';\n            }\n          }\n        }\n      }\n    }\n    if (this.state === 'idle') {\n      this.fnMap.exec(this.finishedCallback);\n      this.subscriptions.publish('finished');\n    }\n    if (this.element != null) {\n      this.element.animateNextFrame();\n    }\n  }\n\n  startAll(optionsIn: { startTime?: AnimationStartTime}) {\n    const options = joinObjects({}, optionsIn, { startTime: 'nextFrame' });\n    const { startTime } = options;\n    const frameTime = this.getFrameTime(startTime);\n    for (let i = 0; i < this.animations.length; i += 1) {\n      const animation = this.animations[i];\n      if (animation.state !== 'animating') {\n        animation.start(frameTime);\n        animation.finishIfZeroDuration();\n        if (animation.state === 'animating') {\n          this.state = 'animating';\n        }\n      }\n    }\n    if (this.state === 'idle') {\n      this.fnMap.exec(this.finishedCallback);\n      this.subscriptions.publish('finished');\n    }\n    if (this.element != null) {\n      this.element.animateNextFrame();\n    }\n  }\n\n  getTotalDuration() {\n    let duration = 0;\n    this.animations.forEach((animation) => {\n      const animationDuration = animation.getTotalDuration();\n      if (animationDuration > duration) {\n        duration = animationDuration;\n      }\n    });\n    return duration;\n  }\n\n  /**\n   * Get remaining duration of all animations\n   * @param {number} now define this if you want remaining duration from a\n   * custom time\n   */\n  getRemainingTime(\n    animationNames: Array<string> | string = [],\n    now: number = new GlobalAnimation().now() / 1000,\n  ) {\n    let remainingTime = 0;\n    let names: Array<string> = [];\n    if (typeof animationNames === 'string') {\n      names = [animationNames];\n    } else {\n      names = animationNames;\n    }\n    this.animations.forEach((animation) => {\n      if (names.length > 0 && names.indexOf(animation.name) === -1) {\n        return;\n      }\n      const animationRemainingTime = animation.getRemainingTime(now);\n      if (animationRemainingTime > remainingTime) {\n        remainingTime = animationRemainingTime;\n      }\n    });\n    // console.log(this.element.name, remainingTime, this.animations);\n    return remainingTime;\n  }\n\n  addTo(name: string) {\n    for (let i = 0; i < this.animations.length; i += 1) {\n      const animation = this.animations[i];\n      if (animation.name === name) {\n        return animation;\n      }\n    }\n    return this.new(name);\n  }\n\n  newFromStep(nameOrStep: anim.AnimationStep) {\n    this.animations.push(nameOrStep);\n    return nameOrStep;\n  }\n\n  _dup() {\n    const newManager = new AnimationManager();\n    duplicateFromTo(this, newManager, ['element']);\n    newManager.element = this.element;\n    return newManager;\n  }\n}\n","// @flow\n// import {\n//   Transform, Point,\n//   Rotation, getDeltaAngle, getMaxTimeFromVelocity,\n// } from '../tools/g2';\n// import * as tools from '../tools/math';\n// import type { pathOptionsType } from '../tools/g2';\n// eslint-disable-next-line import/no-cycle\n// import { FigureElement } from './Element';\nimport {\n  joinObjects, duplicateFromTo, generateRandomString,\n} from '../../tools/tools';\nimport * as math from '../../tools/math';\nimport { getState } from '../Recorder/state';\nimport type { FigureElement } from '../Element';\nimport { FunctionMap } from '../../tools/FunctionMap';\nimport GlobalAnimation from '../webgl/GlobalAnimation';\nimport type { AnimationStartTime } from './AnimationManager';\n// import * as anim from './Animation';\n\n/**\n * Animation Step options object\n *\n * @property {number} [duration] in seconds (`0`)\n * @property {number} [delay] delay before animation starts in seconds (`0`)\n * @property {string} [name] animation name identifier (a random string)\n * @property {null | (boolean) => void} [onFinish] called when animation is\n * finished - a `true` parameter is passed to the callback if the animation was\n * cancelled\n * @property {boolean} [removeOnFinish] `true` to remove the animation from the\n * animation manager when it is finished (`true`)\n * @property {null | boolean} [completeOnCancel] `true` to skip to end of\n * animation on cancel (`null`)\n * @property {number} [precision] precision to do calculations to (`8`)\n */\nexport type OBJ_AnimationStep = {\n  onFinish?: ?(boolean) => void;\n  completeOnCancel?: ?boolean;    // true: yes, false: no, null: no preference\n  removeOnFinish?: boolean;\n  name?: string;\n  duration?: number;\n  delay?: number;\n  precision?: number;\n};\n\n/**\n * Animation step base class. All animation steps extend this class.\n *\n * @property {number} duration in seconds\n * @property {number} startDelay delay before animation starts in seconds\n * @property {string} name animation name identifier\n * @property {null | (boolean) => void} [onFinish] called when animation is\n * finished - a `true` parameter is passed to the callback if the animation was\n * cancelled\n * @property {null | boolean} [completeOnCancel] `true` to skip to end of\n * animation on cancel\n * @property {boolean} [removeOnFinish] `true` to remove the animation from the\n * animation manager when it is finished (`true`)\n * @property {number} [precision] precision to do calculations to (`8`)\n * @property {'animating' | 'waitingToStart' | 'idle' | 'finished'} state\n */\nexport default class AnimationStep {\n  startTime: ?number;\n  duration: number;\n  // animations: Array<AnimationStep>;\n  // onFinish: ?(boolean) => void;\n  onFinish: ?(string | (boolean) => void);\n  completeOnCancel: ?boolean;\n  state: 'animating' | 'waitingToStart' | 'idle' | 'finished';\n  startTimeOffset: number;\n  removeOnFinish: boolean;\n  name: string;\n  startDelay: number;\n  beforeFrame: ?(number) => void;\n  afterFrame: ?(number) => void;\n  _stepType: string;\n  fnMap: FunctionMap;\n  precision: number;\n\n  constructor(optionsIn: OBJ_AnimationStep = {}) {\n    const defaultOptions = {\n      onFinish: null,\n      completeOnCancel: null,\n      removeOnFinish: true,\n      name: generateRandomString(),\n      duration: 0,\n      delay: 0,\n      beforeFrame: null,\n      afterFrame: null,\n      precision: 8,\n    };\n    const options = joinObjects({}, defaultOptions, optionsIn);\n    this.onFinish = options.onFinish;\n    this.completeOnCancel = options.completeOnCancel;\n    this.duration = options.duration;\n    this.startTime = null;\n    this.state = 'idle';\n    this.name = options.name;\n    this.afterFrame = options.afterFrame;\n    this.beforeFrame = options.beforeFrame;\n    this.startDelay = options.delay;\n    this.precision = options.precision;\n    // This is only for it this step is a primary path in an Animation Manager\n    this.removeOnFinish = options.removeOnFinish;\n    // Each animation frame will typically calculate a percent complete,\n    // which is based on the duration, and from the percent complete calculate\n    // the position of the current animation.\n    // However, if you want to start an animation not from 0 percent, then this\n    // value can be used. When startTimeOffset != 0, then the first frame\n    // will be calculated at this.progression(startTimeOffset). The animation\n    // will still go to 1, but will be reduced in duration by startTimeOffset.\n    // When progressions aren't linear, then this time is non-trival.\n    this.startTimeOffset = 0;\n    this.fnMap = new FunctionMap();\n    this.fnMap.add('tools.math.easein', math.easein);\n    this.fnMap.add('tools.math.easeout', math.easeout);\n    this.fnMap.add('tools.math.easeinout', math.easeinout);\n    this.fnMap.add('tools.math.linear', math.linear);\n    this.fnMap.add('tools.math.sinusoid', math.sinusoid);\n    return this;\n  }\n\n  // _getStateProperties(): Array<string> {  // eslint-disable-line class-methods-use-this\n  //   return Object.keys(this);\n  // }\n  // _getState() {\n  //   const keys = [];\n  //   Object.keys(this).forEach((key) => {\n  //     if (key !== 'element') {\n  //       keys.push(key);\n  //     }\n  //   });\n  //   console.log(keys)\n  //   const state = getState(this, keys);\n  //   return state;\n  // }\n\n  // eslint-disable-next-line no-unused-vars\n  _fromDef(definition: Object, getElement: ?(string) => FigureElement = null) {\n    joinObjects(this, definition);\n    return this;\n  }\n\n  fnExec(idOrFn: string | Function | null, ...args: any) {\n    return this.fnMap.exec(idOrFn, ...args);\n  }\n  // _finishSetState(figure: Figure) {\n  //   if (this.element != null && typeof this.element === 'string') {\n  //     const element = figure.getElement(this.element);\n  //     if (element != null) {\n  //       this.element = element;\n  //     }\n  //   }\n  //   if (this.steps != null) {\n  //     for (let i = 0; i < this.steps.length; i += 1) {\n  //       const animationStepState = this.steps[i];\n  //       let animationStep = {};\n  //       if (animationStepState._stepType === 'builder') {\n  //         animationStep = new anim.AnimationBuilder();\n  //       }\n  //       if (animationStepState._stepType === 'position') {\n  //         animationStep = new anim.PositionAnimationStep();\n  //       }\n  //       joinObjects(animationStep, animationStepState);\n  //       animationStep._finishSetState(figure);\n  //       this.steps[i] = animationStep;\n  //     }\n  //   }\n  // }\n\n  // eslint-disable-next-line class-methods-use-this, no-unused-vars\n  // _finishSetState(figure: Figure) {\n  // }\n\n  // execFn(fn: string | Function | null, ...args: Array<any>) {\n  //   // if (fn == null) {\n  //   //   return null;\n  //   // }\n  //   // if (typeof fn === 'string') {\n  //   //   return this.fnMap.exec(fn, ...args);\n  //   // }\n  //   // console.log(fn)\n  //   // return fn(...args);\n  //   return this.fnMap.exec(fn, ...args);\n  // }\n\n  setTimeDelta(delta: number) {\n    if (this.startTime != null) {\n      this.startTime += delta;\n    }\n    // if (this.steps != null) {\n    //   this.steps.forEach((step) => {\n    //     step.setTimeDelta(delta);\n    //   });\n    // }\n  }\n\n  _getStateProperties() {  // eslint-disable-line class-methods-use-this\n  // console.log('animationStep')\n    return [\n      'startTime',\n      'duration',\n      'onFinish',\n      'completeOnCancel',\n      'state',\n      'startTimeOffset',\n      'removeOnFinish',\n      'name',\n      'startDelay',\n      'beforeFrame',\n      'afterFrame',\n      '_stepType',\n    ];\n  }\n\n  _getStateName() {  // eslint-disable-line class-methods-use-this\n    return 'animationStep';\n  }\n\n  _state(options: Object) {\n    return {\n      f1Type: this._getStateName(),\n      // def: {\n      //   startTime: this.startTime,\n      //   duration: this.duration,\n      //   onFinish: this.onFinish,\n      //   completeOnCancel: this.completeOnCancel,\n      //   state: this.state,\n      //   startTimeOffset: this.startTimeOffset,\n      //   removeOnFinish: this.removeOnFinish,\n      //   name: this.name,\n      //   startDelay: this.startDelay,\n      //   beforeFrame: this.beforeFrame,\n      //   afterFrame: this.afterFrame,\n      //   _stepType: this._stepType,\n      // },\n      state: getState(this, this._getStateProperties(), options),\n    };\n  }\n\n  // eslint-disable-next-line no-unused-vars\n  _fromState(state: Object, getElement: ?(string) => FigureElement) {\n    joinObjects(this, state);\n    return this;\n  }\n\n  // returns remaining time if this step completes\n  // Return of 0 means this step is still going\n  nextFrame(now: number, speed: number = 1) {\n    if (this.startTime == null) {\n      // console.log('new Start', this.startTime, now, this.startTimeOffset)\n      this.startTime = now - this.startTimeOffset;\n    }\n    const deltaTime = (now - this.startTime) * speed;\n    // console.log(now, this.startTime, deltaTime, this.startDelay);\n    let remainingTime = math.round(-(this.duration + this.startDelay - deltaTime), this.precision);\n    if (deltaTime >= this.startDelay) {\n      let deltaTimeAfterDelay = deltaTime - this.startDelay;\n      if (deltaTimeAfterDelay >= this.duration) {\n        remainingTime = deltaTimeAfterDelay - this.duration;\n        deltaTimeAfterDelay = this.duration;\n      }\n      if (this.beforeFrame) {\n        this.beforeFrame(deltaTimeAfterDelay / this.duration);\n      }\n      // console.log(deltaTimeAfterDelay)\n      this.setFrame(deltaTimeAfterDelay);\n      if (this.afterFrame) {\n        this.afterFrame(deltaTimeAfterDelay / this.duration);\n      }\n      if (remainingTime >= 0) {\n        this.finish();\n      }\n    }\n    return remainingTime;\n  }\n\n  /**\n   * Get remaining duration of the animation.\n   * @param {number} now define this if you want remaining duration from a\n   * custom time\n   */\n  getRemainingTime(now: number = new GlobalAnimation().now() / 1000) {\n    const totalDuration = this.getTotalDuration();\n    if (this.startTime == null) {\n      if (this.state === 'animating' || this.state === 'waitingToStart') {\n        return totalDuration;\n      }\n      return 0;\n    }\n    const deltaTime = now - this.startTime;\n    return this.duration + this.startDelay - deltaTime;\n  }\n\n  // getRemainingTime(now: number = performance.now()){\n  //   if (this.startTime == null) {\n  //     return 0;\n  //   }\n  //   const deltaTime = now - this.startTime;\n  //   return this.duration + this.startDelay - deltaTime;\n  // }\n\n  getTotalDuration() {\n    return this.duration + this.startDelay;\n  }\n\n  // eslint-disable-next-line class-methods-use-this, no-unused-vars\n  setFrame(deltaTime: number) {\n  }\n\n  startWaiting() {\n    this.state = 'waitingToStart';\n  }\n\n  /**\n   * Start animation\n   * @param {AnimationStartTime} startTime\n   */\n  start(startTime: ?AnimationStartTime = null) {\n    this.state = 'animating';\n    if (typeof startTime === 'number' || startTime == null) {\n      this.startTime = startTime;\n      return;\n    }\n    if (startTime === 'nextFrame') {\n      this.startTime = null;\n      return;\n    }\n    const globalAnim = new GlobalAnimation();\n    this.startTime = globalAnim.getWhen(startTime) / 1000;\n    // if (startTime === 'prev') {\n    //   this.startTime = new GlobalAnimation().lastFrame;\n    // }\n    // this.startTime = new GlobalAnimation().now() / 1000;\n  }\n\n  finishIfZeroDuration() {\n    if (this.duration === 0 && this.startDelay === 0) {\n      this.finish();\n    }\n  }\n\n  // eslint-disable-next-line class-methods-use-this, no-unused-vars\n  setToEnd() {\n  }\n\n  // eslint-disable-next-line class-methods-use-this, no-unused-vars\n  finish(cancelled: boolean = false, force: ?'complete' | 'freeze' = null) {\n    // this.startTime = -2;\n    // this.onFinish(false);\n    if (this.state === 'idle' || this.state === 'finished') {\n      return;\n    }\n    const oldState = this.state;\n    this.state = 'finished';\n    if (cancelled) {\n      if (force === 'complete') {\n        if (oldState === 'waitingToStart') {\n          this.start();\n        }\n        this.setToEnd();\n      } else if (force == null && this.completeOnCancel === true) {\n        if (oldState === 'waitingToStart') {\n          this.start();\n        }\n        this.setToEnd();\n      } else if (oldState === 'waitingToStart') {\n        this.cancelledWithNoComplete();\n      }\n    }\n\n    if (cancelled === false) {\n      if (oldState === 'waitingToStart') {\n        this.start();\n      }\n      this.setToEnd();\n    }\n\n    if (this.onFinish != null) {\n      this.fnExec(this.onFinish, cancelled);\n      // this.onFinish(cancelled);\n    }\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  cancelledWithNoComplete() {\n  }\n\n  cancel(force: ?'complete' | 'freeze' = null) {\n    this.finish(true, force);\n  }\n\n  _dup() {\n    const step = new AnimationStep();\n    duplicateFromTo(this, step);\n    return step;\n  }\n\n  whenFinished(callback: string | (boolean) => void) {\n    this.onFinish = callback;\n    return this;\n  }\n\n  ifCanceledThenComplete() {\n    this.completeOnCancel = true;\n    return this;\n  }\n\n  ifCancelled(then: 'complete' | 'freeze' = 'freeze') {\n    if (then === 'complete') {\n      this.completeOnCancel = true;\n    } else {\n      this.completeOnCancel = false;\n    }\n    return this;\n  }\n\n  ifCanceledThenStop() {\n    this.completeOnCancel = false;\n    return this;\n  }\n}\n","// @flow\n// import * as tools from '../../../tools/math';\nimport {\n  joinObjects, duplicateFromTo,\n} from '../../../tools/tools';\nimport type {\n  OBJ_AnimationStep,\n} from '../AnimationStep';\nimport AnimationStep from '../AnimationStep';\nimport type { FigureElement } from '../../Element';\n\n/**\n * {@link CustomAnimationStep} options object\n *\n * @extends OBJ_AnimationStep\n *\n * @property {string | function(int): void} callback function to run each\n * animation frame\n * @property {number} [startPercent] percent to start animation at (`0`)\n * @property {'linear' | 'easeinout' | 'easein' | 'easeout' | AnimationProgression} [progression]\n */\nexport type OBJ_CustomAnimationStep = {\n  callback?: string | ((number) => void);\n  startPercent?: number;\n  progression?: 'linear' | 'easeinout' | 'easein' | 'easeout' | (number) => number;\n} & OBJ_AnimationStep;\n\n/**\n * Custom animation step\n *\n * ![](./apiassets/custom_animation.gif)\n *\n * Custom animation steps are useful for orchestrating complex animations, or\n * performing non-linear animations.\n *\n * This step will execute a custom callback function on each animation frame\n * for the duration of the animation. The callback function will be passed the\n * percentage progress of the animation.\n *\n * The percentage progress can either be linear with time, or non-linear.\n * Built-in non-linear progressions are `'easeinout'`, `'easein`' and\n * `'easeout'` which will slow progress at the start or end of the animation.\n * A function to create a custom non-linear progressor can also be used.\n *\n * @extends AnimationStep\n *\n * @param {OBJ_CustomAnimationStep} options\n *\n * @see To test examples, append them to the\n * <a href=\"#animation-boilerplate\">boilerplate</a>\n *\n * @example\n * // Move an object through a sine wave of wavelength 1 from\n * // x = -1 to x = 1\n * function sine(percentComplete) {\n *   const x = -1 + percentComplete * 2;\n *   const y = 0.5 * Math.sin(Math.PI * 2 * x);\n *   p.setPosition(x, y);\n * }\n *\n * p.animations.new()\n *   .custom({ callback: sine, duration: 5 })\n *   .start();\n */\nexport class CustomAnimationStep extends AnimationStep {\n  element: ?Object;\n  callback: ?(number) => void;\n  startPercent: ?number;\n  progression: string | ((number, ?boolean) => number);\n\n  /**\n   * @hideconstructor\n   */\n  constructor(...optionsIn: Array<OBJ_CustomAnimationStep>) {\n    const AnimationStepOptionsIn = joinObjects({}, ...optionsIn);\n    super(AnimationStepOptionsIn);\n    const defaultPositionOptions = {\n      element: null,\n      callback: null,\n      startPercent: 0,\n      progression: 'linear',\n    };\n    const options = joinObjects({}, defaultPositionOptions, ...optionsIn);\n    this.element = options.element;\n    this.progression = options.progression;\n    if (this.progression === 'linear') {\n      this.progression = 'tools.math.linear';\n    } else if (options.progression === 'easein') {\n      this.progression = 'tools.math.easein';\n    } else if (options.progression === 'easeout') {\n      this.progression = 'tools.math.easeout';\n    } else if (options.progression === 'easeinout') {\n      this.progression = 'tools.math.easeinout';\n    }\n    this.callback = options.callback;\n    this.startPercent = options.startPercent;\n    // if (typeof this.progression === 'function') {\n    //   this.startTimeOffset = this.progression(options.startPercent, true) * options.duration;\n    // }\n    this.startTimeOffset = this.getPercentComplete(options.startPercent, true) * options.duration;\n    this.duration = options.duration;\n  }\n\n  // fnExec(idOrFn: string | Function | null, ...args: any) {\n  //   const result = this.fnMap.exec(idOrFn, ...args);\n  //   if (result == null && this.element != null) {\n  //     return this.element.fnMap.exec(idOrFn, ...args);\n  //   }\n  //   return result;\n  // }\n  fnExec(idOrFn: string | Function | null, ...args: any) {\n    // const result = this.fnMap.exec(idOrFn, ...args);\n    // if (result == null && this.element != null) {\n    //   return this.element.fnMap.exec(idOrFn, ...args);\n    // }\n    // return result;\n    if (this.element != null) {\n      return this.fnMap.execOnMaps(\n        idOrFn, [this.element.fnMap.map], ...args,\n      );\n    }\n    return this.fnMap.exec(idOrFn, ...args);\n  }\n\n  _getStateProperties() {  // eslint-disable-line class-methods-use-this\n    return [...super._getStateProperties(),\n      'callback',\n      'startPercent',\n      'progression',\n    ];\n  }\n\n  _fromState(state: Object, getElement: ?(string) => FigureElement) {\n    joinObjects(this, state);\n    if (this.element != null && typeof this.element === 'string' && getElement != null) {\n      this.element = getElement(this.element);\n    }\n    return this;\n  }\n\n  _state(options: Object) {\n    const state = super._state(options);\n    if (this.element != null) {\n      state.state.element = {\n        f1Type: 'de',\n        state: this.element.getPath(),\n      };\n    }\n    return state;\n  }\n\n  _getStateName() {  // eslint-disable-line class-methods-use-this\n    return 'customAnimationStep';\n  }\n\n  setFrame(deltaTime: number) {\n    const percentTime = deltaTime / this.duration;\n    const percentComplete = this.getPercentComplete(percentTime);\n    this.fnExec(this.callback, percentComplete);\n  }\n\n  getPercentComplete(percentTime: number, invert: boolean = false) {\n    if (typeof this.progression === 'string') {\n      const result = this.fnExec(this.progression, percentTime, invert);\n      if (result == null) {\n        return 0;\n      }\n      return result;\n    }\n    if (typeof this.progression === 'function') {\n      return (this.progression(percentTime));\n    }\n    return 0;\n  }\n\n  setToEnd() {\n    this.fnExec(this.callback, 1);\n  }\n\n  _dup() {\n    const step = new CustomAnimationStep();\n    duplicateFromTo(this, step);\n    return step;\n  }\n}\n\nexport function custom(...optionsIn: Array<OBJ_CustomAnimationStep>) {\n  return new CustomAnimationStep(...optionsIn);\n}\n\n","// @flow\n// import * as tools from '../../tools/math';\n// import { FigureElement } from '../Element';\nimport type { OBJ_AnimationStep } from '../AnimationStep';\nimport AnimationStep from '../AnimationStep';\nimport { joinObjects, duplicateFromTo } from '../../../tools/tools';\n\n\n// export type OBJ_AnimationStep = {\n//   duration?: number;\n// } & OBJ_AnimationStep;\n\n/**\n * Delay animation step\n *\n * While all animations steps accept a delay property,\n * having this step sometimes makes the animation seem\n * more readable.\n *\n * @param {number | OBJ_AnimationStep} delayOrOptions\n * @extends AnimationStep\n */\nexport class DelayAnimationStep extends AnimationStep {\n  /**\n   * @hideconstructor\n   */\n  constructor(\n    numOrOptions: number | OBJ_AnimationStep = {},\n    ...args: Array<OBJ_AnimationStep>\n  ) {\n    let options = {};\n    const defaultOptions = { duration: 0 };\n    if (typeof numOrOptions === 'number') {\n      options = joinObjects({}, defaultOptions, { duration: numOrOptions }, ...args);\n    } else {\n      options = joinObjects({}, defaultOptions, numOrOptions, ...args);\n    }\n    super(options);\n    // this.duration = options.duration;\n  }\n\n  _dup() {\n    const dup = new DelayAnimationStep();\n    duplicateFromTo(this, dup);\n    return dup;\n  }\n\n  // _getStateProperties() {  // eslint-disable-line class-methods-use-this\n  //   return [...super._getStateProperties(),\n  //     'callback',\n  //     'startPercent',\n  //     'progression',\n  //   ];\n  // }\n\n  _getStateName() {  // eslint-disable-line class-methods-use-this\n    return 'delayAnimationStep';\n  }\n}\n\nexport function delay(\n  numOrOptionsIn: number | OBJ_AnimationStep = {},\n  ...args: Array<OBJ_AnimationStep>\n) {\n  return new DelayAnimationStep(numOrOptionsIn, ...args);\n}\n","// @flow\n// import * as tools from '../../../tools/math';\n// import { FigureElement } from '../../Element';\nimport type { OBJ_AnimationStep } from '../AnimationStep';\nimport AnimationStep from '../AnimationStep';\nimport { joinObjects, duplicateFromTo } from '../../../tools/tools';\nimport type { FigureElement } from '../../Element';\nimport type { AnimationStartTime } from '../AnimationManager';\n\n/**\n * Animation progression function.\n *\n * As the animation time progresses, a percentage of the total animation\n * duration will be passed to this function.\n *\n * This function then calculates and returns the percent progress of the\n * animation.\n *\n * This function can be used to make non-linear progressions of an animation.\n * For instance, it could be used to create a progression that is slowed\n * at the start or end of the animation.\n *\n * @param {number} percent percentage of duration\n * @return {number} percent of animation complete\n */\nexport type AnimationProgression = (number) => number;\n\n/**\n * {@link ElementAnimationStep} options object\n *\n * @extends OBJ_AnimationStep\n * @property {FigureElement} [element]\n * @property {'linear' | 'easeinout' | 'easein' | 'easeout' | AnimationProgression} [progression]\n * how the animation progresses - defaults to `linear` for color, opacity and\n * custom animations and `easeinout` for others\n */\nexport type OBJ_ElementAnimationStep = {\n  element?: FigureElement; // Can't use FigureElement as importing it makes a loop\n  type?: 'transform' | 'color' | 'custom' | 'position' | 'rotation' | 'scale' | 'opacity';\n  progression?: 'linear' | 'easeinout' | 'easein' | 'easeout' | (number) => number; // default is easeinout except color and custom which is linear\n} & OBJ_AnimationStep;\n\n/**\n * Animation Step tied to an element\n *\n * Default values for the animation step will then come from this element.\n *\n * @extends AnimationStep\n */\nexport default class ElementAnimationStep extends AnimationStep {\n  element: ?FigureElement;\n  type: 'transform' | 'color' | 'custom' | 'position' | 'setPosition' | 'opacity';\n  duration: number;\n  progression: ((number, ?boolean) => number) | string;\n\n  constructor(optionsIn: OBJ_ElementAnimationStep = {}) {\n    super(optionsIn);\n    let defaultProgression = 'easeinout';\n    if (optionsIn.type === 'color' || optionsIn.type === 'custom' || optionsIn.type === 'opacity') {\n      defaultProgression = 'linear';\n    }\n    const defaultOptions = {\n      element: null,\n      type: 'custom',\n      progression: defaultProgression,\n      duration: 0,\n    };\n\n    const options = joinObjects({}, defaultOptions, optionsIn);\n    this.element = options.element;\n    this.type = options.type;\n    this.onFinish = options.onFinish;\n    this.duration = options.duration;\n    this.progression = options.progression;\n    if (this.progression === 'linear') {\n      this.progression = 'tools.math.linear';\n    } else if (options.progression === 'easein') {\n      this.progression = 'tools.math.easein';\n    } else if (options.progression === 'easeout') {\n      this.progression = 'tools.math.easeout';\n    } else if (options.progression === 'easeinout') {\n      this.progression = 'tools.math.easeinout';\n    } else {\n      this.progression = options.progression;\n    }\n  }\n\n  fnExec(idOrFn: string | Function | null, ...args: any) {\n    // const result = this.fnMap.exec(idOrFn, ...args);\n    // if (result == null && this.element != null) {\n    //   return this.element.fnMap.exec(idOrFn, ...args);\n    // }\n    // return result;\n    if (this.element != null) {\n      return this.fnMap.execOnMaps(\n        idOrFn, [this.element.fnMap.map], ...args,\n      );\n    }\n    return this.fnMap.exec(idOrFn, ...args);\n  }\n\n  _getStateProperties() {  // eslint-disable-line class-methods-use-this\n    // console.log('elementstep');\n    return [...super._getStateProperties(),\n      // 'element',\n      'type',\n      // 'duration',\n      'progression',\n    ];\n  }\n\n  _fromState(state: Object, getElement: ?(string) => FigureElement) {\n    // const obj = new this.constructor();\n    joinObjects(this, state);\n    if (this.element != null && typeof this.element === 'string' && getElement != null) {\n      this.element = getElement(this.element);\n    }\n    return this;\n  }\n\n  _state(options: Object) {\n    const state = super._state(options);\n    if (this.element != null) {\n      state.state.element = {\n        f1Type: 'de',\n        state: this.element.getPath(),\n      };\n    }\n    // if (this.element != null) {\n    //   definition.state.element = this.element.getPath();\n    // }\n    return state;\n  }\n\n  getPercentComplete(percentTime: number) {\n    if (typeof this.progression === 'string') {\n      const result = this.fnExec(this.progression, percentTime);\n      if (result == null) {\n        return 0;\n      }\n      return result;\n    }\n    if (typeof this.progression === 'function') {\n      return (this.progression(percentTime));\n    }\n    return 0;\n  }\n\n  start(startTime: ?AnimationStartTime = null) {\n    super.start(startTime);\n    if (this.element != null) {\n      this.element.animateNextFrame();\n    }\n  }\n\n  _dup() {\n    const step = new ElementAnimationStep();\n    duplicateFromTo(this, step, ['element']);\n    step.element = this.element;\n    return step;\n  }\n}\n","// @flow\n// import {\n//   Transform, Point, getMaxTimeFromVelocity,\n// } from '../../../../tools/g2';\nimport {\n  joinObjects, duplicateFromTo, deleteKeys, copyKeysFromTo,\n} from '../../../../tools/tools';\n// import * as tools from '../../../../tools/math';\nimport type { OBJ_ElementAnimationStep } from '../ElementAnimationStep';\nimport type { OBJ_OpacityAnimationStep } from './OpacityAnimationStep';\nimport ElementAnimationStep from '../ElementAnimationStep';\nimport type { TypeColor } from '../../../../tools/types';\nimport type { AnimationStartTime } from '../../AnimationManager';\n// type TypeColor = Array<number>;\n\n/**\n * {@link ColorAnimationStep} options object\n *\n * @extends OBJ_ElementAnimationStep\n * @property {Array<number>} [start]\n * @property {Array<number> | 'dim' | 'undim'} [target] use `dim` to animate to\n * element's `dimColor`, and `undim` to animate to element's `defaultColor`\n * @property {Array<number>} [delta]\n *\n */\nexport type OBJ_ColorAnimationStep = {\n  start?: TypeColor;      // default is element transform\n  target?: TypeColor | 'dim' | 'undim';     // Either target or delta must be defined\n  delta?: TypeColor;      // delta overrides target if both are defined\n  dissolve?: 'in' | 'out' | null\n} & OBJ_ElementAnimationStep;\n\nconst addColors = (color1, color2) => color1.map((c, index) => Math.min(c + color2[index], 1));\n\nconst subtractColors = (color1, color2) => color1.map((c, index) => c - color2[index]);\n\n/**\n * Color animation Step\n *\n * ![](./apiassets/color_animation.gif)\n *\n * By default, the color will start with the element's current color.\n *\n * Use either `delta` or `target` to define the end color\n *\n * In an interactive figure, it is often useful to highlight elements of the\n * figure by coloring them and greying out, or dimming the elements not of\n * interest. As such, a {@link FigureElement} has several color attributes:\n * - color - current color\n * - dimColor - color to dim to\n * - defaultColor - color to undim to\n *\n * The `target` property can accept `'dim'` and `'undim'` as shortcuts to dim\n * or undim the element.\n *\n * In addition, the {@link DimAnimationStep} and {@link UndimAnimationStep} can\n * be used to do the same, which is especially useful when trying to build\n * easy to read code in a complex animation.\n *\n * @extends ElementAnimationStep\n * @param {OBJ_ColorAnimationStep} options\n *\n * @see To test examples, append them to the\n * <a href=\"#animation-boilerplate\">boilerplate</a>\n *\n * @example\n * // Using duration\n * p.animations.new()\n *   .color({ target: [0, 0, 1, 1], duration: 1 })\n *   .color({ target: [0, 0.8, 0, 1], duration: 1 })\n *   .color({ target: [1, 0, 0, 1], duration: 1 })\n *   .start();\n *\n * @example\n * // dim and undim an element using dim and undim animation steps\n * p.animations.new()\n *   .dim(1)\n *   .delay(1)\n *   .undim(1)\n *   .start();\n *\n * @example\n * // Different ways to create a stand-alone step\n * const step1 = p.animations.color({\n *   target: [0, 0, 1, 1],\n *   duration: 2,\n * });\n * const step2 = new Fig.Animation.ColorAnimationStep({\n *   element: p,\n *   target: [0, 0.8, 0, 1],\n *   duration: 2,\n * });\n *\n * p.animations.new()\n *   .then(step1)\n *   .then(step2)\n *   .start();\n */\nexport class ColorAnimationStep extends ElementAnimationStep {\n  color: {\n    start: TypeColor;     // null means use element color\n    delta: TypeColor;\n    target: TypeColor;\n    whenComplete: TypeColor;  // Color after dissolving\n    dissolve?: 'in' | 'out' | null;\n    setDefault?: boolean;\n  };\n\n  /**\n   * @hideconstructor\n   */\n  constructor(...options: Array<OBJ_ColorAnimationStep>) {\n    const ElementAnimationStepOptionsIn =\n      joinObjects({}, ...options, { type: 'color' });\n    deleteKeys(ElementAnimationStepOptionsIn, [\n      'start', 'delta', 'target', 'dissolve',\n    ]);\n    super(ElementAnimationStepOptionsIn);\n    const defaultPositionOptions = {\n      start: null,\n      target: null,\n      delta: null,\n      dissolve: null,\n    };\n    const optionsToUse = joinObjects({}, defaultPositionOptions, ...options);\n    // $FlowFixMe\n    this.color = {};\n    copyKeysFromTo(optionsToUse, this.color, [\n      'start', 'delta', 'target', 'dissolve',\n    ]);\n    if (this.color.target === 'dim') {\n      if (this.element != null) {\n        this.color.target = this.element.dimColor.slice();\n      }\n      this.color.setDefault = false;\n    } else if (this.color.target === 'undim') {\n      if (this.element != null) {\n        this.color.target = this.element.defaultColor.slice();\n      }\n      this.color.setDefault = false;\n    } else {\n      this.color.setDefault = true;\n    }\n  }\n\n\n  _getStateProperties() {  // eslint-disable-line class-methods-use-this\n    return [...super._getStateProperties(),\n      'color',\n    ];\n  }\n\n  _getStateName() {  // eslint-disable-line class-methods-use-this\n    return 'colorAnimationStep';\n  }\n\n  // On start, calculate the duration, target and delta if not already present.\n  // This is done here in case the start is defined as null meaning it is\n  // going to start from present transform.\n  // Setting a duration to 0 will effectively skip this animation step\n  start(startTime: ?AnimationStartTime = null) {\n    const { element } = this;\n    // console.log('starting', element)\n    if (element != null) {\n      super.start(startTime);\n      if (this.color.start == null) {\n        this.color.start = element.color.slice();\n      }\n      if (this.color.delta == null && this.color.target == null) {\n        this.color.target = this.color.start.slice();\n      } else if (this.color.delta != null) {\n        this.color.target = addColors(this.color.start, this.color.delta);\n      }\n      this.color.whenComplete = this.color.target.slice();\n\n      if (this.color.dissolve === 'out') {\n        this.color.target[3] = 0.001;\n      }\n      if (this.color.dissolve === 'in') {\n        this.color.start[3] = 0.001;\n        element.setColor(this.color.start, this.color.setDefault);\n        element.showAll();\n      }\n      this.color.delta = subtractColors(this.color.target, this.color.start);\n    } else {\n      this.duration = 0;\n    }\n  }\n\n  setFrame(deltaTime: number) {\n    const percentTime = deltaTime / this.duration;\n    const percentComplete = this.getPercentComplete(percentTime);\n    const p = percentComplete;\n    const next = this.color.start.map((c, index) => {\n      let newColor = c + this.color.delta[index] * p;\n      if (newColor > 1) {\n        newColor = 1;\n      }\n      if (newColor < 0) {\n        newColor = 0;\n      }\n      return newColor;\n    });\n    if (this.element != null) {\n      // console.log(this.element.name, next)\n      this.element.setColor(next, this.color.setDefault);\n    }\n  }\n\n  setToEnd() {\n    const { element } = this;\n    if (element != null) {\n      // console.log(this.name, this.color.whenComplete)\n      element.setColor(this.color.whenComplete, this.color.setDefault);\n      if (this.color.dissolve === 'out') {\n        element.hide();\n      }\n    }\n  }\n\n  _dup() {\n    const step = new ColorAnimationStep();\n    duplicateFromTo(this, step, ['element']);\n    step.element = this.element;\n    return step;\n  }\n}\n\n\n/**\n * Dim color animation step\n *\n * ![](./apiassets/dim_animation.gif)\n *\n * Animates color of element to the `dimColor` property of {@link FigureElement}\n *\n * @extends ColorAnimationStep\n * @param {number | OBJ_ElementAnimationStep} durationOrOptions\n *\n * @see To test examples, append them to the\n * <a href=\"#animation-boilerplate\">boilerplate</a>\n *\n * @example\n * // Simple dim\n * p.animations.new()\n *   .dim(2)\n *   .start();\n *\n * @example\n * // Dim using options object\n * p.animations.new()\n *   .dim({ delay: 1, duration: 2 })\n *   .start();\n *\n * @example\n * // Different ways to create a stand-alone step\n * const step1 = p.animations.dim(2);\n * const step2 = new Fig.Animation.DimAnimationStep({\n *   element: p,\n *   duration: 2,\n * });\n *\n * p.animations.new()\n *   .then(step1)\n *   .undim(1)\n *   .then(step2)\n *   .start();\n */\nexport class DimAnimationStep extends ColorAnimationStep {\n  /**\n   * @hideconstructor\n   */\n  constructor(\n    timeOrOptionsIn: number | OBJ_ElementAnimationStep = {},\n    ...args: Array<OBJ_ElementAnimationStep>\n  ) {\n    let options = {};\n    const defaultOptions = { duration: 1, target: 'dim', completeOnCancel: true };\n    if (typeof timeOrOptionsIn === 'number') {\n      options = joinObjects({}, defaultOptions, { duration: timeOrOptionsIn }, ...args);\n    } else {\n      options = joinObjects({}, defaultOptions, timeOrOptionsIn, ...args);\n    }\n    super(options);\n  }\n}\n\nexport function dim(\n  timeOrOptionsIn: number | OBJ_OpacityAnimationStep = {},\n  ...args: Array<OBJ_OpacityAnimationStep>\n) {\n  return new DimAnimationStep(timeOrOptionsIn, ...args);\n}\n\n/**\n * Undim color animation step\n *\n * ![](./apiassets/undim_animation.gif)\n *\n * Animates color of element to the `defaultColor` property of {@link FigureElement}\n *\n * @extends ColorAnimationStep\n * @param {number | OBJ_ElementAnimationStep} durationOrOptions\n *\n * @see To test examples, append them to the\n * <a href=\"#animation-boilerplate\">boilerplate</a>\n *\n * @example\n * // Simple undim\n * p.dim();\n * p.animations.new()\n *   .undim(2)\n *   .start();\n *\n * @example\n * // Undim using options object\n * p.dim();\n * p.animations.new()\n *   .undim({ delay: 1, duration: 2 })\n *   .start();\n *\n * @example\n * // Different ways to create a stand-alone step\n * const step1 = p.animations.undim(2);\n * const step2 = new Fig.Animation.UndimAnimationStep({\n *   element: p,\n *   duration: 2,\n * });\n *\n * p.dim();\n * p.animations.new()\n *   .then(step1)\n *   .dim(1)\n *   .then(step2)\n *   .start();\n */\nexport class UndimAnimationStep extends ColorAnimationStep {\n  /**\n   * @hideconstructor\n   */\n  constructor(\n    timeOrOptionsIn: number | OBJ_ElementAnimationStep = {},\n    ...args: Array<OBJ_ElementAnimationStep>\n  ) {\n    let options = {};\n    const defaultOptions = { duration: 1, target: 'undim', completeOnCancel: true };\n    if (typeof timeOrOptionsIn === 'number') {\n      options = joinObjects({}, defaultOptions, { duration: timeOrOptionsIn }, ...args);\n    } else {\n      options = joinObjects({}, defaultOptions, timeOrOptionsIn, ...args);\n    }\n    super(options);\n  }\n}\n\nexport function undim(\n  timeOrOptionsIn: number | OBJ_OpacityAnimationStep = {},\n  ...args: Array<OBJ_OpacityAnimationStep>\n) {\n  return new UndimAnimationStep(timeOrOptionsIn, ...args);\n}\n\n// export class DissolveInAnimationStep extends ColorAnimationStep {\n//   constructor(\n//     timeOrOptionsIn: number | OBJ_ElementAnimationStep = {},\n//     ...args: Array<OBJ_ElementAnimationStep>\n//   ) {\n//     let options = {};\n//     const defaultOptions = { duration: 1, dissolve: 'in', completeOnCancel: true };\n//     if (typeof timeOrOptionsIn === 'number') {\n//       options = joinObjects({}, defaultOptions, { duration: timeOrOptionsIn }, ...args);\n//     } else {\n//       options = joinObjects({}, defaultOptions, timeOrOptionsIn, ...args);\n//     }\n//     super(options);\n//   }\n// }\n\n// export function dissolveIn(\n//   timeOrOptionsIn: number | OBJ_ColorAnimationStep = {},\n//   ...args: Array<OBJ_ColorAnimationStep>\n// ) {\n//   return new DissolveInAnimationStep(timeOrOptionsIn, ...args);\n// }\n\n// export class DissolveOutAnimationStep extends ColorAnimationStep {\n//   constructor(\n//     timeOrOptionsIn: number | OBJ_ElementAnimationStep = {},\n//     ...args: Array<OBJ_ElementAnimationStep>\n//   ) {\n//     let options = {};\n//     const defaultOptions = { duration: 1, dissolve: 'out', completeOnCancel: true };\n//     if (typeof timeOrOptionsIn === 'number') {\n//       options = joinObjects({}, defaultOptions, { duration: timeOrOptionsIn }, ...args);\n//     } else {\n//       options = joinObjects({}, defaultOptions, timeOrOptionsIn, ...args);\n//     }\n//     super(options);\n//   }\n// }\n\n// export function dissolveOut(\n//   timeOrOptionsIn: number | OBJ_ColorAnimationStep = {},\n//   ...args: Array<OBJ_ColorAnimationStep>\n// ) {\n//   return new DissolveOutAnimationStep(timeOrOptionsIn, ...args);\n// }\n","// @flow\n// import {\n//   Transform, Point, getMaxTimeFromVelocity,\n// } from '../../../../tools/g2';\n// import * as tools from '../../../../tools/math';\nimport {\n  joinObjects, duplicateFromTo, deleteKeys, copyKeysFromTo,\n} from '../../../../tools/tools';\nimport type {\n  OBJ_ElementAnimationStep,\n} from '../ElementAnimationStep';\nimport ElementAnimationStep from '../ElementAnimationStep';\nimport type { AnimationStartTime } from '../../AnimationManager';\n\n/**\n * {@link OpacityAnimationStep} options object\n *\n * @extends OBJ_ElementAnimationStep\n *\n * @property {number} [start]\n * @property {number} [target]\n * @property {number} [delta]\n * @property {null | 'in' | 'out'} dissolve will override target opacity if not\n * `null` (`null`)\n * @property {boolean} dissolveFromCurrent (`false`)\n */\nexport type OBJ_OpacityAnimationStep = {\n  start?: number;      // default is element transform\n  target?: number;     // Either target or delta must be defined\n  delta?: number;      // delta overrides target if both are defined\n  dissolve?: 'in' | 'out' | null,\n  dissolveFromCurrent?: boolean,\n} & OBJ_ElementAnimationStep;\n\n/**\n * Opacity Animation Step\n *\n * ![](./apiassets/opacity_animation.gif)\n *\n * A {@link FigureElement} has `color` and `opacity` properties. The `color`\n * property has an alpha channel that defines opacity, but it should be used\n * as a base color definition, and not used to dissolve an element in and out.\n *\n * Therefore, to animate an element's opacity or temporarily dissolve in or out\n * an element, use an opacity animation step.\n *\n * The `opacity` is multiplied by the\n * `color` alpha channel to get the final opacity of the element.\n *\n * By default, the opacity will start with the {@link FigureElement}'s current\n * opacity unless dissolving. If dissolving, the opacity will start at `0` if\n * dissolving in, or `1` if dissolving out unless `dissolveFromCurrent` is\n * `true` in which case the opacity will start from the current opacity.\n *\n * The {@link DissolveInAnimationStep} and {@link DissolveOutAnimationStep}\n * extend the `OpacityAnimationStep` to make it even more convenient to\n * dissolve.\n *\n * @extends ElementAnimationStep\n * @param {OBJ_OpacityAnimationStep} options\n *\n * @see To test examples, append them to the\n * <a href=\"#animation-boilerplate\">boilerplate</a>\n *\n * @example\n * // Using numerical values for opacity\n * p.animations.new()\n *   .opacity({ target: 0.4, duration: 2 })\n *   .opacity({ target: 1, duration: 2 })\n *   .start();\n *\n * @example\n * // Dissolve out then in\n * p.animations.new()\n *   .opacity({ dissolve: 'out', duration: 2 })\n *   .opacity({ dissolve: 'in', duration: 2 })\n *   .start();\n *\n * @example\n * // Using the dissolve animation step\n * p.animations.new()\n *   .dissolveOut(2)\n *   .dissolveIn({ delay: 1, duration: 2 })\n *   .start();\n *\n * @example\n * // Different ways to create a stand-alone step\n * const step1 = p.animations.opacity({\n *   target: 0,\n *   duration: 2,\n * });\n * const step2 = new Fig.Animation.OpacityAnimationStep({\n *   element: p,\n *   target: 1,\n *   duration: 2,\n * });\n * const step3 = p.animations.dissolveOut({\n *   duration: 2,\n * });\n * const step4 = new Fig.Animation.DissolveInAnimationStep({\n *   element: p,\n *   duration: 2,\n * });\n *\n * p.animations.new()\n *   .then(step1)\n *   .then(step2)\n *   .then(step3)\n *   .then(step4)\n *   .start();\n */\nexport class OpacityAnimationStep extends ElementAnimationStep {\n  opacity: {\n    start: number;     // null means use element color\n    delta: number;\n    target: number;\n    whenComplete: number;  // Color after dissolving\n    dissolve?: 'in' | 'out' | null;\n    dissolveFromCurrent: boolean,\n  };\n\n  /**\n   * @hideconstructor\n   */\n  constructor(...optionsIn: Array<OBJ_OpacityAnimationStep>) {\n    const ElementAnimationStepOptionsIn =\n      joinObjects({}, ...optionsIn, { type: 'opacity' });\n    deleteKeys(ElementAnimationStepOptionsIn, [\n      'start', 'delta', 'target', 'dissolve', 'dissolveFromCurrent',\n    ]);\n    super(ElementAnimationStepOptionsIn);\n    const defaultPositionOptions = {\n      start: null,\n      target: null,\n      delta: null,\n      dissolve: null,\n      dissolveFromCurrent: false,\n    };\n    const options = joinObjects({}, defaultPositionOptions, ...optionsIn);\n    // $FlowFixMe\n    this.opacity = {};\n    copyKeysFromTo(options, this.opacity, [\n      'start', 'delta', 'target', 'dissolve', 'dissolveFromCurrent',\n    ]);\n  }\n\n  _getStateProperties() {  // eslint-disable-line class-methods-use-this\n    return [...super._getStateProperties(),\n      'opacity',\n    ];\n  }\n\n  _getStateName() {  // eslint-disable-line class-methods-use-this\n    return 'opacityAnimationStep';\n  }\n\n  // On start, calculate the duration, target and delta if not already present.\n  // This is done here in case the start is defined as null meaning it is\n  // going to start from present transform.\n  // Setting a duration to 0 will effectively skip this animation step\n  start(startTime: ?AnimationStartTime = null) {\n    const { element } = this;\n    if (element != null) {\n      super.start(startTime);\n      if (this.opacity.start == null) {\n        // eslint-disable-next-line prefer-destructuring\n        this.opacity.start = element.opacity;\n      } else if (startTime === 'now' || startTime === 'prevFrame') {\n        element.setOpacity(this.opacity.start);\n      }\n      if (this.opacity.delta == null && this.opacity.target == null) {\n        this.opacity.target = this.opacity.start;\n      } else if (this.opacity.delta != null) {\n        this.opacity.target = this.opacity.start + this.opacity.delta;\n      }\n      this.opacity.whenComplete = this.opacity.target;\n\n      if (this.opacity.dissolve === 'out') {\n        if (this.opacity.dissolveFromCurrent) {\n          if (element.isShown) {\n            this.opacity.start = element.opacity;\n          } else {\n            this.opacity.start = 1;\n          }\n        } else {\n          this.opacity.start = 1;\n        }\n        this.opacity.target = 0.001;\n        this.opacity.whenComplete = 1;\n        element.setOpacity(this.opacity.start);\n      }\n      if (this.opacity.dissolve === 'in') {\n        if (this.opacity.dissolveFromCurrent) {\n          if (element.isShown) {\n            this.opacity.start = element.opacity;\n          } else {\n            this.opacity.start = 0.001;\n          }\n        } else {\n          this.opacity.start = 0.001;\n        }\n        // this.opacity.start = 0.001;\n        this.opacity.target = 1;\n        this.opacity.whenComplete = 1;\n        element.showAll();\n        element.setOpacity(this.opacity.start);\n      }\n      this.opacity.delta = this.opacity.target - this.opacity.start;\n    } else {\n      this.duration = 0;\n    }\n  }\n\n  cancelledWithNoComplete() {\n    const { element } = this;\n    if (element != null) {\n      if (element.opacity === 0.001) {\n        element.hide();\n        element.opacity = 1;\n      }\n    }\n  }\n\n  setFrame(deltaTime: number) {\n    const percentTime = deltaTime / this.duration;\n    const percentComplete = this.getPercentComplete(percentTime);\n    const p = percentComplete;\n    let next = this.opacity.start + this.opacity.delta * p;\n    if (next > 1) {\n      next = 1;\n    }\n    if (next < 0) {\n      next = 0;\n    }\n    if (this.element != null) {\n      this.element.setOpacity(next);\n    }\n  }\n\n  // cancelledWithNoComplete() {\n  //   const { element } = this;\n  //   console.log('cancel with no complete')\n  //   if (element != null) {\n  //     if (this.color.fullOpacity) {\n  //       element.setColor([...element.color.slice(0, 3), 1]);\n  //     }\n  //   }\n  // }\n\n  setToEnd() {\n    const { element } = this;\n    if (element != null) {\n      // console.log(this.name, this.color.whenComplete)\n      element.setOpacity(this.opacity.whenComplete);\n      if (this.opacity.dissolve === 'out') {\n        element.hide();\n      }\n    }\n  }\n\n  _dup() {\n    const step = new OpacityAnimationStep();\n    duplicateFromTo(this, step, ['element']);\n    step.element = this.element;\n    return step;\n  }\n}\n\n/**\n * Dissolve in animation step\n *\n * ![](./apiassets/dissolvein_animation.gif)\n *\n * Animates opacity of element to dissolve in.\n *\n * @extends OpacityAnimationStep\n * @param {number | OBJ_ElementAnimationStep} durationOrOptions\n *\n * @see To test examples, append them to the\n * <a href=\"#animation-boilerplate\">boilerplate</a>\n *\n * @example\n * // Simple dissolve in\n * p.setOpacity(0)\n * p.animations.new()\n *   .dissolveIn(2)\n *   .start();\n *\n * @example\n * // Dissolve in using options object\n * p.setOpacity(0);\n * p.animations.new()\n *   .dissolveIn({ delay: 1, duration: 2 })\n *   .start();\n *\n * @example\n * // Different ways to create a stand-alone step\n * const step1 = p.animations.dissolveIn(2);\n * const step2 = new Fig.Animation.DissolveInAnimationStep({\n *   element: p,\n *   duration: 2,\n * });\n *\n * p.setOpacity(0);\n * p.animations.new()\n *   .then(step1)\n *   .dissolveOut(1)\n *   .then(step2)\n *   .start();\n */\nexport class DissolveInAnimationStep extends OpacityAnimationStep {\n  /**\n   * @hideconstructor\n   */\n  constructor(\n    timeOrOptionsIn: number | OBJ_ElementAnimationStep = {},\n    ...args: Array<OBJ_ElementAnimationStep>\n  ) {\n    let options = {};\n    const defaultOptions = { duration: 1, dissolve: 'in', completeOnCancel: true };\n    if (typeof timeOrOptionsIn === 'number') {\n      options = joinObjects({}, defaultOptions, { duration: timeOrOptionsIn }, ...args);\n    } else {\n      options = joinObjects({}, defaultOptions, timeOrOptionsIn, ...args);\n    }\n    super(options);\n  }\n}\n\nexport function dissolveIn(\n  timeOrOptionsIn: number | OBJ_OpacityAnimationStep = {},\n  ...args: Array<OBJ_OpacityAnimationStep>\n) {\n  return new DissolveInAnimationStep(timeOrOptionsIn, ...args);\n}\n\n/**\n * Dissolve out animation step\n *\n * ![](./apiassets/dissolveout_animation.gif)\n *\n * Animates opacity of element to dissolve out.\n *\n * @extends OpacityAnimationStep\n * @param {number | OBJ_ElementAnimationStep} durationOrOptions\n *\n * @see To test examples, append them to the\n * <a href=\"#animation-boilerplate\">boilerplate</a>\n *\n * @example\n * // Simple dissolve out\n * p.animations.new()\n *   .dissolveOut(2)\n *   .start();\n *\n * @example\n * // Dissolve out using options object\n * p.animations.new()\n *   .dissolveOut({ delay: 1, duration: 2 })\n *   .start();\n *\n * @example\n * // Different ways to create a stand-alone step\n * const step1 = p.animations.dissolveOut(2);\n * const step2 = new Fig.Animation.DissolveOutAnimationStep({\n *   element: p,\n *   duration: 2,\n * });\n *\n * p.animations.new()\n *   .then(step1)\n *   .dissolveIn(1)\n *   .then(step2)\n *   .start();\n */\nexport class DissolveOutAnimationStep extends OpacityAnimationStep {\n  /**\n   * @hideconstructor\n   */\n  constructor(\n    timeOrOptionsIn: number | OBJ_ElementAnimationStep = {},\n    ...args: Array<OBJ_ElementAnimationStep>\n  ) {\n    let options = {};\n    const defaultOptions = { duration: 1, dissolve: 'out', completeOnCancel: true };\n    if (typeof timeOrOptionsIn === 'number') {\n      options = joinObjects({}, defaultOptions, { duration: timeOrOptionsIn }, ...args);\n    } else {\n      options = joinObjects({}, defaultOptions, timeOrOptionsIn, ...args);\n    }\n    super(options);\n  }\n}\n\nexport function dissolveOut(\n  timeOrOptionsIn: number | OBJ_OpacityAnimationStep = {},\n  ...args: Array<OBJ_OpacityAnimationStep>\n) {\n  return new DissolveOutAnimationStep(timeOrOptionsIn, ...args);\n}\n","// @flow\nimport {\n  Transform, Point, getMaxTimeFromVelocity, getPoint,\n} from '../../../../tools/g2';\nimport type { OBJ_TranslationPath } from '../../../../tools/g2';\nimport {\n  joinObjects, duplicateFromTo, deleteKeys, copyKeysFromTo,\n  // joinObjectsWithOptions,\n} from '../../../../tools/tools';\nimport type {\n  OBJ_ElementAnimationStep,\n} from '../ElementAnimationStep';\nimport ElementAnimationStep from '../ElementAnimationStep';\nimport type { AnimationStartTime } from '../../AnimationManager';\n// import type { OBJ_QuadraticBezier } from\n// import type { FigureElement } from '../../../Element';\n\n/**\n * {@link PositionAnimationStep} options object\n *\n * @extends OBJ_ElementAnimationStep\n *\n * @property {TypeParsablePoint} [start] start position - if undefined then\n * current position is used\n * @property {TypeParsablePoint} [target] target position - if undefined then\n * `delta` is used\n * @property {TypeParsablePoint} [delta] target delta - only used if `target`\n * is undefined\n * @property {null | TypeParsablePoint} [velocity] velocity of\n * position overrides `duration` - `null` to use `duration` (`null`)\n * @property {number} [null | maxDuration] maximum duration to cap to -\n * `null` for no cap (`null`)\n * @property {OBJ_TranslationPath} [path] (`{ style: 'linear' }`)\n * @property {number | null} [maxDuration] maximum duration to clip animation\n * to where `null` is unlimited (`null`)\n *\n * @see {@link PositionAnimationStep} for description and examples\n */\nexport type OBJ_PositionAnimationStep = {\n  start?: Point;      // default is element transform\n  target?: Point;     // Either target or delta must be defined\n  delta?: Point;      // delta overrides target if both are defined\n  // path?: 'linear' | 'curved'; // default is linear\n  // pathOptions?: pathOptionsType;\n  path?: OBJ_TranslationPath;\n  velocity?: Point;\n  maxDuration?: number;\n} & OBJ_ElementAnimationStep;\n\n/**\n * Position animation step\n *\n * ![](./apiassets/position_animation.gif)\n *\n * The position animation step animates the first {@link Translation} transform\n * in the {@link FigureElement}'s {@link Transform}.\n *\n * By default, the position will start with the element's current position.\n *\n * Use either `delta` or `target` to define it's end point.\n *\n * The path of travel between `start` and `target` can either be a straight\n * line (`'linear'`) or a quadratic bezier curve (`'curve'`)\n *\n * For custom paths, the {@link CustomAnimationStep} can be used.\n *\n *\n * @extends ElementAnimationStep\n *\n * @param {OBJ_PositionAnimationStep} options\n *\n * @see To test examples, append them to the\n * <a href=\"#animation-boilerplate\">boilerplate</a>\n *\n * @example\n * // Using duration\n * p.animations.new()\n *   .position({ target: [1, 0], duration: 2 })\n *   .start()\n *\n * @example\n * // Using velocity\n * p.animations.new()\n *   .position({ target: [1, 0], velocity: 0.5 })\n *   .start()\n *\n * @example\n * // Linear and curved path\n * p.animations.new()\n *   .delay(1)\n *   .position({ target: [1, 0], duration: 2 })\n *   .position({\n *     target: [0, 0],\n *     duration: 2,\n *     path: {\n *       style: 'curve',\n *       magnitude: 0.8,\n *       direction: 'up',\n *     },\n *   })\n *   .start();\n *\n * @example\n * // Different ways to create a stand-alone step\n * const step1 = p.animations.position({ target: [1, 0], duration: 2 });\n * const step2 = new Fig.Animation.PositionAnimationStep({\n *   element: p,\n *   target: [0, 0],\n *   duration: 2,\n * });\n *\n * p.animations.new()\n *   .then(step1)\n *   .then(step2)\n *   .start();\n */\nexport default class PositionAnimationStep extends ElementAnimationStep {\n  position: {\n    start: ?Point;  // null means use element transform when unit is started\n    delta: ?Point;\n    target: ?Point;\n    // rotDirection: 0 | 1 | -1 | 2;\n    path: OBJ_TranslationPath;\n    // pathOptions: OBJ_QuadraticBezier;\n    velocity: ?Point;\n    maxDuration: ?number;\n  };\n\n  /**\n   * @hideconstructor\n   */\n  constructor(...optionsIn: Array<OBJ_PositionAnimationStep>) {\n    const ElementAnimationStepOptionsIn =\n      joinObjects({}, { type: 'position' }, ...optionsIn);\n    deleteKeys(ElementAnimationStepOptionsIn, [\n      'start', 'delta', 'target', 'path', 'pathOptions',\n      'velocity', 'maxDuration',\n    ]);\n    super(ElementAnimationStepOptionsIn);\n    this._stepType = 'position';\n    const defaultPositionOptions = {\n      start: null,\n      target: null,\n      delta: null,\n      path: {\n        style: 'linear',\n        magnitude: 0.5,\n        offset: 0.5,\n        controlPoint: null,\n        direction: 'positive',\n      },\n      maxDuration: null,\n      velocity: null,\n    };\n    if (this.element && this.element.animations.options.translation) {\n      const pathOptions = this.element.animations.options.translation;\n      joinObjects(defaultPositionOptions.path, pathOptions);\n    }\n    const options = joinObjects({}, defaultPositionOptions, ...optionsIn);\n    if (options.start != null) {\n      options.start = getPoint(options.start);\n    }\n    if (options.target != null) {\n      options.target = getPoint(options.target);\n    }\n    if (options.delta != null) {\n      options.delta = getPoint(options.delta);\n    }\n    // $FlowFixMe\n    this.position = { path: {} };\n    copyKeysFromTo(options, this.position, [\n      'start', 'delta', 'target', 'path',\n      'velocity', 'maxDuration',\n    ]);\n    // duplicateFromTo(options.path, this.position.path);\n  }\n\n  _getStateProperties() {  // eslint-disable-line class-methods-use-this\n    return [...super._getStateProperties(),\n      'position',\n    ];\n  }\n\n  _getStateName() {  // eslint-disable-line class-methods-use-this\n    return 'positionAnimationStep';\n  }\n\n  // On start, calculate the duration, target and delta if not already present.\n  // This is done here in case the start is defined as null meaning it is\n  // going to start from present transform.\n  // Setting a duration to 0 will effectively skip this animation step\n  start(startTime: ?AnimationStartTime = null) {\n    super.start(startTime);\n    if (this.position.start == null) {\n      if (this.element != null) {\n        this.position.start = this.element.getPosition();\n      } else {\n        this.duration = 0;\n        return;\n      }\n    } else if (startTime === 'now' || startTime === 'prevFrame') {\n      if (this.element != null) {\n        this.element.setPosition(getPoint(this.position.start));\n      }\n    }\n    // if delta is null, then calculate it from start and target\n    if (this.position.delta == null\n      && this.position.target != null\n      && this.position.start != null\n    ) {\n      const delta = this.position.target.sub(this.position.start);\n      this.position.delta = delta;\n    } else if (this.position.delta != null && this.position.start != null) {\n      this.position.target = this.position.start.add(this.position.delta);\n    } else {\n      this.duration = 0;\n    }\n\n    // If Velocity is defined, then use it to calculate duration\n    const { target, start, velocity } = this.position;\n    if (velocity != null && start != null && target != null) {\n      const velocityToUse = getPoint(velocity);\n      this.duration = getMaxTimeFromVelocity(\n        new Transform().translate(start),\n        new Transform().translate(target),\n        new Transform().translate(velocityToUse),\n      );\n    }\n    if (this.position.maxDuration != null) {\n      if (this.duration > this.position.maxDuration) {\n        this.duration = this.position.maxDuration;\n      }\n    }\n  }\n\n  setFrame(deltaTime: number) {\n    // console.log('setFrame', deltaTime);\n    const percentTime = deltaTime / this.duration;\n    const percentComplete = this.getPercentComplete(percentTime);\n    const p = percentComplete;\n\n    if (this.position.delta != null && this.position.start != null) {\n      const next = this.position.start.toDelta(\n        this.position.delta, p,\n        this.position.path.style,\n        this.position.path,\n      );\n      if (this.element != null) {\n        this.element.setPosition(next);\n      }\n    }\n  }\n\n  setToEnd() {\n    if (this.element != null && this.position.target != null) {\n      this.element.setPosition(this.position.target);\n    }\n  }\n\n  _dup() {\n    const step = new PositionAnimationStep();\n    duplicateFromTo(this, step, ['element']);\n    step.element = this.element;\n    return step;\n  }\n}\n","// @flow\nimport {\n  joinObjects, duplicateFromTo, deleteKeys, copyKeysFromTo,\n} from '../../../../tools/tools';\nimport type {\n  TypeParsablePoint,\n} from '../../../../tools/g2';\nimport type {\n  OBJ_ElementAnimationStep,\n} from '../ElementAnimationStep';\nimport ElementAnimationStep from '../ElementAnimationStep';\nimport type { TypeWhen } from '../../../webgl/GlobalAnimation';\nimport type { FigureElement } from '../../../Element';\n\n/**\n * {@link PulseAnimationStep} options object\n *\n * @extends OBJ_ElementAnimationStep\n * @property {number} [frequency] pulse frequency in Hz - a frequency of zero\n * will set the frequency so just one cycle will be performed in the duration\n * (`0`)\n * @property {number} [scale] maximum scale value to pulse to (`1.5`)\n * @property {number} [rotation] maximum rotation value to pulse to\n * @property {number} [translation] maximum translation displacment value to\n * pulse to (`1.5`)\n * @property {number} [angle] translation angle (`0`)\n * @property {number} [min] minimum value to pulse to\n * @property {null | FigureElement | TypeParsablePoint} [centerOn] center\n * of scale or rotation pulse. By default, the element calling the pulse\n * will be the default `centerOn`.\n * @property {'left' | 'center' | 'right' | 'location' | number} [xAlign]\n * if `centerOn` is a {@link FigureElement} then this property can be used to\n * horizontally align the pulse center with the element. `'location'` is the\n * (0, 0) draw space coordinate of the element. `number` defines the percent\n * width from the left of the element (`'center'`)\n * @property {'bottom' | 'middle' | 'top' | 'location' | number} [yAlign]\n * if `centerOn` is a {@link FigureElement} then this property can be used to\n * vertically align the pulse center with the element. `'location'` is the\n * (0, 0) draw space coordinate of the element. `number` defines the percent\n * width from the left of the element (`'center'`)\n * @property {'figure' | 'gl' | 'local' | 'draw' | 'pixel'} [space]\n * if `centerOn` is a point, use this to define the space the point is in\n * (`'figure'`)\n * @property {number} [num] the number of draw copies of the pulse to make (`1`)\n * @property {null | string | function(): void} [done] callback when pulse is\n * finished. If `string` then the element's {@link FunctionMap} `fnMap` will be\n * used (`null`)\n * @property {TypeWhen} [when] when to start the pulse (`'syncNow'`)\n *\n */\nexport type OBJ_PulseAnimationStep = {\n  // scale: ?number;\n  // numLines: ?number;\n  // frequency: ?number;\n  stopAfterDuration: ?boolean;\n\n  frequency?: number,\n  scale?: number,\n  rotation?: number,\n  translation?: number,\n  angle?: number,\n  min?: number,\n  centerOn?: null | FigureElement | TypeParsablePoint,\n  x?: 'left' | 'center' | 'right' | 'origin' | number,\n  y?: 'bottom' | 'middle' | 'top' | 'origin' | number,\n  space?: 'figure' | 'gl' | 'local' | 'draw',\n  done?: ?(mixed) => void,\n  num?: number,\n  when?: TypeWhen,\n} & OBJ_ElementAnimationStep;\n\n/**\n * Pulse animation step\n *\n * ![](./apiassets/pulse_animation.gif)\n *\n * The pulse animation step animates a pulse.\n *\n * The options are the same as those in the * <a href=\"#figureelementpulse\">pulse</a> method.\n *\n * @extends ElementAnimationStep\n * @param {OBJ_RotationAnimationStep} options\n *\n *\n * @see To test examples, append them to the\n * <a href=\"#animation-boilerplate\">boilerplate</a>\n *\n * @example\n * // Scale pulse, rotation pulse and translation pulse\n * p.animations.new()\n *   .pulse({\n *     scale: 1.5,\n *     duration: 1,\n *   })\n *   .pulse({\n *     duration: 1,\n *     rotation: 0.15,\n *     frequency: 4,\n *   })\n *   .pulse({\n *     duration: 1,\n *     translation: 0.02,\n *     min: -0.02,\n *     frequency: 4,\n *   })\n *   .start();\n *\n * @example\n * // Different ways to create a stand-alone step\n * const step1 = p.animations.pulse({\n *   scale: 1.5,\n *   duration: 1,\n * });\n * const step2 = new Fig.Animation.PulseAnimationStep({\n *   element: p,\n *   rotation: 0.15,\n *   frequency: 4,\n * });\n * p.animations.new()\n *   .then(step1)\n *   .then(step2)\n *   .start();\n */\nexport default class PulseAnimationStep extends ElementAnimationStep {\n  // scale: number;\n  // numLines: number;\n  // frequency: number;\n  pulse: {\n    frequency: number;\n    scale: number;\n    rotation?: number;\n    translation?: number;\n    angle: number;\n    min: number;\n    centerOn: null | FigureElement | TypeParsablePoint;\n    x: 'left' | 'center' | 'right' | 'origin' | number;\n    y: 'bottom' | 'middle' | 'top' | 'origin' | number;\n    space: 'figure' | 'gl' | 'local' | 'draw';\n    done: ?(mixed) => void;\n    num: number;\n    when: TypeWhen;\n    stopAfterDuration: boolean;\n  };\n\n  toStart: boolean;\n\n  constructor(...optionsIn: Array<OBJ_PulseAnimationStep>) {\n    const ElementAnimationStepOptionsIn =\n      joinObjects({}, { type: 'position' }, ...optionsIn);\n    deleteKeys(ElementAnimationStepOptionsIn, [\n      'stopAfterDuration', 'frequency', 'scale', 'rotation', 'translation',\n      'angle', 'min', 'centerOn', 'x', 'y', 'space', 'done', 'num', 'when',\n      'stopAfterDuration', 'velocity', 'maxDuration',\n    ]);\n    super(ElementAnimationStepOptionsIn);\n    this._stepType = 'pulse';\n    // const ElementAnimationStepOptionsIn =\n    //   joinObjects({}, { type: 'pulse' }, ...optionsIn);\n    // super(ElementAnimationStepOptionsIn);\n    const defaultOptions = {\n      scale: 2,\n      rotation: null,\n      translation: null,\n      angle: 0,\n      duration: 1,\n      frequency: 0,\n      xAlign: 'center',\n      yAlign: 'middle',\n      // centerOn: this,\n      num: 1,\n      space: 'figure',\n      done: null,\n      progression: 'sinusoid',\n      when: 'syncNow',\n      // scale: 1.5,\n      // numLines: 1,\n      type: 'pulse',\n      // duration: 1,\n      // frequency: 0,\n      stopAfterDuration: true,\n    };\n    const options = joinObjects({}, defaultOptions, ...optionsIn);\n    if (options.centerOn == null && this.element != null) {\n      options.centerOn = this.element;\n    }\n    this.pulse = {};\n    copyKeysFromTo(options, this.pulse, [\n      'stopAfterDuration', 'frequency', 'scale', 'rotation', 'translation',\n      'angle', 'min', 'centerOn', 'x', 'y', 'space', 'done', 'num', 'when',\n      'stopAfterDuration', 'velocity', 'maxDuration', 'duration',\n    ]);\n    this.pulse.centerOn = options.centerOn;\n    this.duration = options.duration;\n    this.toStart = true;\n  }\n\n  _getStateProperties() {  // eslint-disable-line class-methods-use-this\n    return [...super._getStateProperties(),\n      'scale',\n      'numLines',\n      'frequency',\n      'stopAfterDuration',\n      'toStart',\n    ];\n  }\n\n  _getStateName() {  // eslint-disable-line class-methods-use-this\n    return 'pulseAnimationStep';\n  }\n\n  setFrame() {\n    if (this.toStart) {\n      const { element } = this;\n      if (element != null) {\n        element.pulse(this.pulse);\n      }\n      this.toStart = false;\n    }\n  }\n\n  setToEnd() {\n    if (this.element != null) {\n      if (this.pulse.stopAfterDuration) {\n        this.element.stopPulsing();\n      }\n    }\n  }\n\n  _dup() {\n    const step = new PulseAnimationStep();\n    duplicateFromTo(this, step, ['element']);\n    step.element = this.element;\n    return step;\n  }\n}\n","// @flow\nimport {\n  Transform, getScale, getTransform,\n  Rotation, getDeltaAngle, getMaxTimeFromVelocity,\n  Scale, Translation,\n} from '../../../../tools/g2';\nimport type {\n  TypeParsablePoint, TypeParsableTransform, OBJ_TranslationPath,\n} from '../../../../tools/g2';\nimport {\n  joinObjects, duplicateFromTo, deleteKeys, copyKeysFromTo,\n} from '../../../../tools/tools';\nimport {\n  round,\n} from '../../../../tools/math';\nimport type {\n  OBJ_ElementAnimationStep,\n} from '../ElementAnimationStep';\nimport ElementAnimationStep from '../ElementAnimationStep';\nimport type { AnimationStartTime } from '../../AnimationManager';\n\nexport type OBJ_PulseTransformAnimationStep = {\n  start?: Array<Transform>;      // default is element transform\n  target?: Array<Transform>;     // Either target or delta must be defined\n  // delta?: Transform;      // delta overrides target if both are defined\n  path?: OBJ_TranslationPath;       // default is linear\n  rotDirection: 0 | 1 | -1 | 2;\n  clipRotationTo: '0to360' | '-180to180' | null;\n  velocity: ?Transform | number | {\n    position?: TypeParsablePoint | number,\n    translation?: TypeParsablePoint | number,\n    rotation?: number,\n    scale?: TypeParsablePoint | number,\n    transform?: TypeParsableTransform,\n  };\n  maxDuration?: number;\n  zeroDurationThreshold?: Number;\n  // minDuration?: number;\n} & OBJ_ElementAnimationStep;\n\n// A transform animation unit manages a transform animation on an element.\n//\n// The start transform can either be defined initially, or null. Null means\n// the start transform is whatever the current element transform is when the\n// unit is started with start().\n//\n// The transform target is defined with either the target or delta properties.\n// Target is used to predefine the target.\n// Delta is used to calculate the target when the unit is started with start()\n//\nexport default class PulseTransformAnimationStep extends ElementAnimationStep {\n  transform: {\n    start: Array<Transform>;  // null means use element transform when unit is started\n    delta: Array<Transform>;\n    target: Array<Transform>;\n    rotDirection: 0 | 1 | -1 | 2;\n    path: OBJ_TranslationPath;\n    velocity: ?Transform | number | {\n      position?: TypeParsablePoint | number,\n      translation?: TypeParsablePoint | number,\n      rotation?: number,\n      scale?: TypeParsablePoint | number,\n      transform?: TypeParsableTransform,\n    };\n    clipRotationTo: '0to360' | '-180to180' | null;\n    maxDuration: ?number;\n    // minDuration: number;\n    zeroDurationThreshold: number;\n  };\n\n  constructor(...optionsIn: Array<OBJ_PulseTransformAnimationStep>) {\n    const ElementAnimationStepOptionsIn =\n      joinObjects({}, { type: 'transform' }, ...optionsIn);\n    deleteKeys(ElementAnimationStepOptionsIn, [\n      'start', 'delta', 'target', 'rotDirection', 'path',\n      'velocity', 'clipRotationTo', 'maxDuration',\n      'zeroDurationThreshold', // 'minDuration',\n    ]);\n    super(ElementAnimationStepOptionsIn);\n    const defaultTransformOptions = {\n      start: null,\n      target: null,\n      delta: [],\n      path: {\n        style: 'linear',\n        magnitude: 0.5,\n        offset: 0.5,\n        controlPoint: null,\n        direction: 'positive',\n      },\n      rotDirection: 0,\n      velocity: null,\n      clipRotationTo: null,\n      maxDuration: null,\n      // minDuration: 0,\n      zeroDurationThreshold: 0,\n    };\n    if (this.element && this.element.animations.options.translation) {\n      const pathOptions = this.element.animations.options.translation;\n      joinObjects(defaultTransformOptions.path, pathOptions);\n    }\n    const options = joinObjects({}, defaultTransformOptions, ...optionsIn);\n    // $FlowFixMe\n    this.transform = {};\n    copyKeysFromTo(options, this.transform, [\n      'start', 'delta', 'target', 'path',\n      'velocity', 'rotDirection', 'clipRotationTo', 'maxDuration',\n      'zeroDurationThreshold',  // 'minDuration',\n    ]);\n  }\n\n  // If spreading to more transforms, add transforms to before start and after finish.\n  // If adding an odd number, more will be added to before start.\n  // If spreading to less transforms, subtract transforms from middle. If all but one\n  // is being subtracted, then the start transform will be retained.\n\n  // eslint-disable-next-line class-methods-use-this\n  spread(transforms: Array<Transform>, toNum: number) {\n    if (toNum === transforms.length) {\n      return transforms;\n    }\n    if (toNum <= 1) {\n      return [transforms[0]];\n    }\n    const spreadTransforms = [];\n    if (toNum > transforms.length) {\n      const delta = toNum - transforms.length;\n      const startNum = Math.ceil(delta / 2);\n      const endNum = Math.floor(delta / 2);\n      const startTransform = transforms[0]._dup();\n      const endTransform = transforms[transforms.length - 1]._dup();\n      for (let i = 0; i < startNum; i += 1) {\n        spreadTransforms.push(startTransform._dup());\n      }\n      for (let i = 0; i < transforms.length; i += 1) {\n        spreadTransforms.push(transforms[i]._dup());\n      }\n      for (let i = 0; i < endNum; i += 1) {\n        spreadTransforms.push(endTransform._dup());\n      }\n      return spreadTransforms;\n    }\n    const delta = transforms.length - toNum;\n    const startNum = Math.ceil((transforms.length - delta) / 2);\n    const endNum = Math.floor((transforms.length - delta) / 2);\n\n    for (let i = 0; i < startNum; i += 1) {\n      spreadTransforms.push(transforms[i]._dup());\n    }\n    for (let i = transforms.length - endNum; i < transforms.length; i += 1) {\n      spreadTransforms.push(transforms[i]._dup());\n    }\n    return spreadTransforms;\n  }\n\n  setStartAndTarget() {\n    const { start, target } = this.transform;\n    const numTransforms = Math.max(start.length, target.length);\n    this.transform.start = this.spread(this.transform.start, numTransforms);\n    this.transform.target = this.spread(this.transform.target, numTransforms);\n  }\n\n  calculateStartTargetDelta() {\n    if (this.transform.start.length !== this.transform.target.length) {\n      this.transform.delta = [];\n      return;\n    }\n    this.transform.delta = [];\n    for (let i = 0; i < this.transform.start.length; i += 1) {\n      const start = this.transform.start[i];\n      const target = this.transform.target[i];\n      const delta = target.sub(start);\n      delta.order.forEach((deltaStep, index) => {\n        const startStep = start.order[index];\n        const targetStep = target.order[index];\n        if (deltaStep instanceof Rotation\n          && startStep instanceof Rotation\n          && targetStep instanceof Rotation) {\n          const rotDiff = getDeltaAngle(\n            startStep.r,\n            targetStep.r,\n            this.transform.rotDirection,\n          );\n          // eslint-disable-next-line no-param-reassign\n          deltaStep.r = rotDiff;\n        }\n      });\n      this.transform.delta.push(delta);\n    }\n  }\n\n  _getStateProperties() {  // eslint-disable-line class-methods-use-this\n    return [...super._getStateProperties(),\n      'transform',\n    ];\n  }\n\n  _getStateName() {  // eslint-disable-line class-methods-use-this\n    return 'transformAnimationStep';\n  }\n\n  getVelocityTransform() {\n    // const { element } = this;\n    // if (element == null) {\n    //   return new Transform();\n    // }\n    const { velocity } = this.transform;\n    if (velocity == null) {\n      return new Transform();\n    }\n\n    if (velocity instanceof Transform) {\n      return velocity;\n    }\n\n    if (typeof velocity === 'number') {\n      return this.transform.start[0]._dup().constant(velocity);\n    }\n\n    let transformVelocity = this.transform.start[0]._dup().constant(1);\n\n    if (velocity.transform != null) {\n      transformVelocity = getTransform(velocity.transform)._dup();\n    }\n\n    for (let i = 0; i < transformVelocity.order.length; i += 1) {\n      const t = transformVelocity.order[i];\n      if (t instanceof Scale && velocity.scale != null) {\n        const s = getScale(velocity.scale);\n        t.x = s.x;\n        t.y = s.y;\n      }\n      if (t instanceof Translation && velocity.translation != null) {\n        const s = getScale(velocity.translation);\n        t.x = s.x;\n        t.y = s.y;\n      }\n      if (t instanceof Translation && velocity.position != null) {\n        const s = getScale(velocity.position);\n        t.x = s.x;\n        t.y = s.y;\n      }\n      if (t instanceof Rotation && velocity.rotation != null) {\n        t.r = velocity.rotation;\n      }\n    }\n    // if (velocity.position != null) {\n    //   transformVelocity.updateTranslation(getScale(velocity.position));\n    // }\n    // if (velocity.translation != null) {\n    //   transformVelocity.updateTranslation(getScale(velocity.translation));\n    // }\n    // if (velocity.scale != null) {\n    //   transformVelocity.updateScale(getScale(velocity.scale));\n    // }\n    // if (velocity.rotation != null) {\n    //   transformVelocity.updateRotation(velocity.rotation);\n    // }\n    return transformVelocity;\n  }\n\n  // On start, calculate the duration, target and delta if not already present.\n  // This is done here in case the start is defined as null meaning it is\n  // going to start from present transform.\n  // Setting a duration to 0 will effectively skip this animation step\n  start(startTime: ?AnimationStartTime = null) {\n    super.start(startTime);\n    // console.log(this.element.name, this.transform.start[0].order)\n    // console.log(this.transform.target[0].order)\n    if (this.transform.start == null || this.transform.start.length === 0) {\n      if (this.element != null) {\n        if (this.element.pulseTransforms.length > 0) {\n          this.transform.start = this.element.pulseTransforms.map(t => t._dup());\n        } else {\n          this.transform.start = [this.transform.target[0].identity()];\n        }\n      } else {\n        this.duration = 0;\n        return;\n      }\n    }\n\n    if (this.transform.start.length === 0 && this.element != null) {\n      this.transform.start = [this.element.transform._dup()];\n    }\n\n    this.setStartAndTarget();\n\n    // if delta is null, then calculate it from start and target\n    this.calculateStartTargetDelta();\n    if (this.transform.delta.length === 0) {\n      this.duration = 0;\n    }\n    // console.log(this.transform)\n    // If Velocity is defined, then use it to calculate duration\n    if (this.transform.velocity != null) {\n      const velocity = this.getVelocityTransform();\n      for (let i = 0; i < this.transform.start.length; i += 1) {\n        const start = this.transform.start[i];\n        const target = this.transform.target[i];\n        const duration = getMaxTimeFromVelocity(\n          start,\n          target,\n          velocity,\n          this.transform.rotDirection,\n        );\n        // console.log(duration, start, target, velocity)\n        if (duration > this.duration) {\n          this.duration = duration;\n        }\n        // if (duration > 0) {\n        //   this.duration = duration;\n        // }\n      }\n    }\n    if (this.transform.maxDuration != null) {\n      if (this.duration > this.transform.maxDuration) {\n        this.duration = this.transform.maxDuration;\n      }\n    }\n    if (this.duration <= this.transform.zeroDurationThreshold) {\n      this.duration = 0;\n    }\n    // if (this.duration < this.transform.minDuration) {\n    //   this.duration = this.transform.minDuration;\n    // }\n    this.duration = round(this.duration, this.precision);\n    if (startTime === 'now' || startTime === 'prevFrame') {\n      this.setFrame(0);\n    }\n  }\n\n  setFrame(deltaTime: number) {\n    // const start = phase.startTransform._dup();\n    // const delta = phase.deltaTransform._dup();\n    const percentTime = deltaTime / this.duration;\n    const percentComplete = this.getPercentComplete(percentTime);\n    const p = percentComplete;\n    // let next = delta._dup().constant(p);\n\n    // next = start.add(delta.mul(next));\n    if (this.element == null) {\n      return;\n    }\n    const { element } = this;\n    element.frozenPulseTransforms = [];\n    for (let i = 0; i < this.transform.start.length; i += 1) {\n      const next = this.transform.start[i].toDelta(\n        this.transform.delta[i], p,\n        this.transform.path.style,\n        this.transform.path,\n      );\n      if (this.transform.clipRotationTo !== null) {\n        next.clipRotation(this.transform.clipRotationTo);\n      }\n      element.frozenPulseTransforms.push(next);\n    }\n  }\n\n  setToEnd() {\n    if (this.element == null) {\n      return;\n    }\n    const { element } = this;\n    element.frozenPulseTransforms = [];\n    this.transform.target.forEach((t) => {\n      element.frozenPulseTransforms.push(t._dup());\n    });\n  }\n\n  _dup() {\n    const step = new PulseTransformAnimationStep();\n    duplicateFromTo(this, step, ['element']);\n    step.element = this.element;\n    return step;\n  }\n}\n","// @flow\nimport {\n  Transform, getDeltaAngle, getMaxTimeFromVelocity, clipAngle,\n} from '../../../../tools/g2';\nimport {\n  joinObjects, duplicateFromTo, deleteKeys, copyKeysFromTo,\n} from '../../../../tools/tools';\nimport type {\n  OBJ_ElementAnimationStep,\n} from '../ElementAnimationStep';\nimport ElementAnimationStep from '../ElementAnimationStep';\nimport type { AnimationStartTime } from '../../AnimationManager';\n\n/**\n * {@link RotationAnimationStep} step options object\n *\n * @extends OBJ_ElementAnimationStep\n *\n * @property {number} [start] start rotation - current rotation used if\n * undefined\n * @property {number} [target] target rotation - will overwrite `delta` rotation\n * @property {number} [delta] delta rotation that can be used instead of `target`\n * @property {null | number} [velocity] velocity of rotation overrides\n * `duration` - `null` to use `duration` (`null`)\n * @property {0 | 1 | -1 | 2} [direction] where `0` is quickest direction, `1`\n * is positive of CCW direction, `-1` is negative of CW direction and `2` is\n * whichever direction doesn't pass through angle 0 (`0`).\n * @property {'0to360' | '-180to180' | null} [clipTo] (`null`)\n * @property {number | null} [maxDuration] maximum duration to clip animation\n * to where `null` is unlimited (`null`)\n *\n * @see {@link RotationAnimationStep} for description and examples\n */\nexport type OBJ_RotationAnimationStep = {\n  start?: number;      // default is element transform\n  target?: number;     // Either target or delta must be defined\n  delta?: number;      // delta overrides target if both are defined\n  // 1 is CCW, -1 is CW, 0 is fastest, 2 is not through 0\n  direction: 0 | 1 | -1 | 2;\n  clipTo: '0to360' | '-180to180' | null;\n  velocity?: ?number,\n  maxDuration?: ?number;\n} & OBJ_ElementAnimationStep;\n\n// A transform animation unit manages a transform animation on an element.\n//\n// The start transform can either be defined initially, or null. Null means\n// the start transform is whatever the current element transform is when the\n// unit is started with start().\n//\n// The transform target is defined with either the target or delta properties.\n// Target is used to predefine the target.\n// Delta is used to calculate the target when the unit is started with start()\n//\n\n/**\n * Rotation animation step\n *\n * ![](./apiassets/rotation_animation.gif)\n *\n * The rotation animation step animates the first {@link Rotation} transform\n * in the {@link FigureElement}'s {@link Transform}.\n *\n * By default, the rotation will start with the element's current rotation.\n *\n * Use either `delta` or `target` to define it's end point\n *\n * `clipTo` will clip the element's rotation during animation\n *\n * @extends ElementAnimationStep\n * @param {OBJ_RotationAnimationStep} options\n *\n *\n * @see To test examples, append them to the\n * <a href=\"#animation-boilerplate\">boilerplate</a>\n *\n * @example\n * // Using duration\n * p.animations.new()\n *   .rotation({ target: Math.PI, duration: 2 })\n *   .start();\n *\n * @example\n * // Using velocity\n * p.animations.new()\n *   .rotation({ target: Math.PI, velocity: Math.PI / 2 })\n *   .start();\n *\n * @example\n * // Different ways to create a stand-alone step\n * const step1 = p.animations.rotation({ target: Math.PI, duration: 2 });\n * const step2 = new Fig.Animation.RotationAnimationStep({\n *   element: p,\n *   target: 0,\n *   direction: -1,\n *   duration: 2,\n * });\n *\n * p.animations.new()\n *   .then(step1)\n *   .then(step2)\n *   .start();\n */\nexport default class RotationAnimationStep extends ElementAnimationStep {\n  rotation: {\n    start: number;  // null means use element transform when unit is started\n    delta: number;\n    target: number;\n    direction: 0 | 1 | -1 | 2;\n    velocity: ?number;\n    maxDuration: ?number;\n    clipTo: '0to360' | '-180to180' | null;\n  };\n\n  /**\n   * @hideconstructor\n   */\n  constructor(...optionsIn: Array<OBJ_RotationAnimationStep>) {\n    const ElementAnimationStepOptionsIn =\n      joinObjects({}, { type: 'rotation' }, ...optionsIn);\n    deleteKeys(ElementAnimationStepOptionsIn, [\n      'start', 'delta', 'target', 'direction', 'velocity', 'clipTo', 'maxDuration',\n    ]);\n    super(ElementAnimationStepOptionsIn);\n    const defaultTransformOptions = {\n      start: null,\n      target: null,\n      delta: null,\n      direction: 0,\n      velocity: null,\n      clipTo: null,\n      maxDuration: null,\n    };\n    const options = joinObjects({}, defaultTransformOptions, ...optionsIn);\n    // $FlowFixMe\n    this.rotation = {};\n    copyKeysFromTo(options, this.rotation, [\n      'start', 'delta', 'target', 'velocity', 'direction', 'clipTo',\n      'maxDuration',\n    ]);\n  }\n\n  _getStateProperties() {  // eslint-disable-line class-methods-use-this\n    const a = [...super._getStateProperties(),\n      'rotation',\n    ];\n    // console.log('rotationStep')\n    return a;\n  }\n\n  _getStateName() {  // eslint-disable-line class-methods-use-this\n    return 'rotationAnimationStep';\n  }\n\n  // On start, calculate the duration, target and delta if not already present.\n  // This is done here in case the start is defined as null meaning it is\n  // going to start from present transform.\n  // Setting a duration to 0 will effectively skip this animation step\n  start(startTime: ?AnimationStartTime = null) {\n    super.start(startTime);\n    if (this.rotation.start === null) {\n      if (this.element != null) {\n        this.rotation.start = this.element.transform.r() || 0;\n      } else {\n        this.duration = 0;\n        return;\n      }\n    }\n    // if delta is null, then calculate it from start and target\n    if (this.rotation.delta == null && this.rotation.target != null) {\n      const delta = getDeltaAngle(\n        this.rotation.start,\n        this.rotation.target,\n        this.rotation.direction,\n      );\n      this.rotation.delta = delta;\n      // this.rotation.delta = this.rotation.target - this.rotation.start;\n    } else if (this.rotation.delta != null) {\n      this.rotation.target = this.rotation.start + this.rotation.delta;\n    } else {\n      this.duration = 0;\n    }\n\n    // If Velocity is defined, then use it to calculate duration\n    const { velocity } = this.rotation;\n    if (velocity != null) {\n      this.duration = getMaxTimeFromVelocity(\n        new Transform().rotate(this.rotation.start),\n        new Transform().rotate(this.rotation.target),\n        new Transform().rotate(velocity),\n        this.rotation.direction,\n      );\n    }\n\n    if (this.rotation.maxDuration != null) {\n      if (this.duration > this.rotation.maxDuration) {\n        this.duration = this.rotation.maxDuration;\n      }\n    }\n    if (startTime === 'now' || startTime === 'prevFrame') {\n      this.setFrame(0);\n    }\n  }\n\n  setFrame(deltaTime: number) {\n    const percentTime = deltaTime / this.duration;\n    const percentComplete = this.getPercentComplete(percentTime);\n    const p = percentComplete;\n    let nextR = this.rotation.start + this.rotation.delta * p;\n    nextR = clipAngle(nextR, this.rotation.clipTo);\n    const { element } = this;\n    if (element != null) {\n      element.setRotation(nextR);\n    }\n  }\n\n  setToEnd() {\n    const { element } = this;\n    if (element != null) {\n      element.transform.updateRotation(clipAngle(\n        this.rotation.target, this.rotation.clipTo,\n      ));\n      this.fnExec(element.setTransformCallback, element.transform);\n    }\n  }\n\n  _dup() {\n    const step = new RotationAnimationStep();\n    duplicateFromTo(this, step, ['element']);\n    step.element = this.element;\n    return step;\n  }\n}\n","// @flow\nimport {\n  Transform, Point, getMaxTimeFromVelocity, getPoint,\n} from '../../../../tools/g2';\nimport {\n  joinObjects, duplicateFromTo, deleteKeys, copyKeysFromTo,\n} from '../../../../tools/tools';\nimport type {\n  OBJ_ElementAnimationStep,\n} from '../ElementAnimationStep';\nimport ElementAnimationStep from '../ElementAnimationStep';\nimport type { AnimationStartTime } from '../../AnimationManager';\n\n/**\n * {@link ScaleAnimationStep} options object\n *\n * @extends OBJ_ElementAnimationStep\n *\n * @property {TypeParsablePoint | number} [start]\n * @property {TypeParsablePoint | number} [target]\n * @property {TypeParsablePoint | number} [delta]\n * @property {null | TypeParsablePoint | number} [velocity] velocity of scale\n * overrides `duration` - `null` to use `duration` (`null`)\n * @property {number | null} [maxDuration] maximum duration to clip animation\n * to where `null` is unlimited (`null`)\n */\nexport type OBJ_ScaleAnimationStep = {\n  start?: Point | number;      // default is element transform\n  target?: Point | number;     // Either target or delta must be defined\n  delta?: Point | number;      // delta overrides target if both are defined\n  velocity?: Point | number;\n  maxDuration: ?number;\n} & OBJ_ElementAnimationStep;\n\n/**\n * Scale Animation Step\n *\n * ![](./apiassets/scale_animation.gif)\n *\n * The scale animation step animates the first {@link Scale} transform\n * in the {@link FigureElement}'s {@link Transform}.\n *\n * By default, the scale will start with the element's current scale.\n *\n * Use either `delta` or `target` to define it's end point.\n *\n * Scale can be defined as either a point or number. If number,\n * both x and y scale terms will be the same.\n *\n * @extends ElementAnimationStep\n * @param {OBJ_ScaleAnimationStep} options\n *\n * @see To test examples, append them to the\n * <a href=\"#animation-boilerplate\">boilerplate</a>\n *\n * @example\n * // Using duration\n * p.animations.new()\n *   .scale({ target: 2, duration: 2 })\n *   .start();\n *\n * @example\n * // Using velocity\n * p.animations.new()\n *   .scale({ target: 2, velocity: 0.5 })\n *   .start();\n *\n * @example\n * // Different ways to create a stand-alone step\n * const step1 = p.animations.scale({ target: 1.5, duration: 2 });\n * const step2 = new Fig.Animation.ScaleAnimationStep({\n *   element: p,\n *   target: 1,\n *   duration: 2,\n * });\n *\n * p.animations.new()\n *   .then(step1)\n *   .then(step2)\n *   .start();\n */\nexport default class ScaleAnimationStep extends ElementAnimationStep {\n  scale: {\n    start: ?Point;  // null means use element transform when unit is started\n    delta: ?Point;\n    target: ?Point;\n    velocity: ?Point;\n    maxDuration: ?number;\n  };\n\n  /**\n   * @hideconstructor\n   */\n  constructor(...optionsIn: Array<OBJ_ScaleAnimationStep>) {\n    const ElementAnimationStepOptionsIn =\n      joinObjects({}, { type: 'position' }, ...optionsIn);\n    deleteKeys(ElementAnimationStepOptionsIn, [\n      'start', 'delta', 'target', 'velocity', 'maxDuration',\n    ]);\n    super(ElementAnimationStepOptionsIn);\n    const defaultPositionOptions = {\n      start: null,\n      target: null,\n      delta: null,\n      velocity: null,\n      maxDuration: null,\n    };\n    const options = joinObjects({}, defaultPositionOptions, ...optionsIn);\n    // $FlowFixMe\n    this.scale = {};\n    if (options.start != null) {\n      options.start = getPoint(options.start);\n    }\n    if (options.target != null) {\n      options.target = getPoint(options.target);\n    }\n    if (options.delta != null) {\n      options.delta = getPoint(options.delta);\n    }\n\n    copyKeysFromTo(options, this.scale, [\n      'start', 'delta', 'target', 'path',\n      'velocity', 'maxDuration',\n    ]);\n  }\n\n  _getStateProperties() {  // eslint-disable-line class-methods-use-this\n    return [...super._getStateProperties(),\n      'scale',\n    ];\n  }\n\n  _getStateName() {  // eslint-disable-line class-methods-use-this\n    return 'scaleAnimationStep';\n  }\n\n  // On start, calculate the duration, target and delta if not already present.\n  // This is done here in case the start is defined as null meaning it is\n  // going to start from present transform.\n  // Setting a duration to 0 will effectively skip this animation step\n  start(startTime: ?AnimationStartTime = null) {\n    super.start(startTime);\n    if (this.scale.start === null) {\n      if (this.element != null) {\n        this.scale.start = this.element.getScale();\n      } else {\n        this.duration = 0;\n        return;\n      }\n    }\n    // if delta is null, then calculate it from start and target\n    if (this.scale.delta == null\n      && this.scale.target != null\n      && this.scale.start != null\n    ) {\n      const delta = this.scale.target.sub(this.scale.start);\n      this.scale.delta = delta;\n    } else if (this.scale.delta != null && this.scale.start != null) {\n      this.scale.target = this.scale.start.add(this.scale.delta);\n    } else {\n      this.duration = 0;\n    }\n\n    // If Velocity is defined, then use it to calculate duration\n    const { target, start, velocity } = this.scale;\n    if (velocity != null\n      && target != null\n      && start != null\n    ) {\n      const velocityToUse = getPoint(velocity);\n      // if (typeof velocity === 'number') {\n      //   velocityToUse = new Point(velocity, velocity);\n      // }\n      this.duration = getMaxTimeFromVelocity(\n        new Transform().scale(start),\n        new Transform().scale(target),\n        new Transform().scale(velocityToUse),\n      );\n    }\n    if (this.scale.maxDuration != null) {\n      if (this.duration > this.scale.maxDuration) {\n        this.duration = this.scale.maxDuration;\n      }\n    }\n    if (startTime === 'now' || startTime === 'prevFrame') {\n      this.setFrame(0);\n    }\n  }\n\n  setFrame(deltaTime: number) {\n    const percentTime = deltaTime / this.duration;\n    const percentComplete = this.getPercentComplete(percentTime);\n    const p = percentComplete;\n\n    if (this.scale.start != null && this.scale.delta != null) {\n      const next = this.scale.start.toDelta(this.scale.delta, p);\n      if (this.element != null) {\n        this.element.setScale(next);\n      }\n    }\n  }\n\n  setToEnd() {\n    if (this.element != null && this.scale.target != null) {\n      this.element.setScale(this.scale.target);\n    }\n  }\n\n  _dup() {\n    const step = new ScaleAnimationStep();\n    duplicateFromTo(this, step, ['element']);\n    step.element = this.element;\n    return step;\n  }\n}\n","// @flow\nimport {\n  Transform, getMaxTimeFromVelocity, getScale, getTransform,\n} from '../../../../tools/g2';\nimport type {\n  OBJ_TranslationPath, TypeParsableTransform, TypeParsablePoint,\n\n} from '../../../../tools/g2';\nimport {\n  joinObjects, duplicateFromTo, deleteKeys, copyKeysFromTo,\n  // joinObjectsWithOptions,\n} from '../../../../tools/tools';\nimport type {\n  OBJ_ElementAnimationStep, AnimationProgression,\n} from '../ElementAnimationStep';\n// import ElementAnimationStep from '../ElementAnimationStep';\n// import type { FigureElement } from '../../../Element';\nimport { areColorsSame } from '../../../../tools/color';\nimport { ParallelAnimationStep } from '../ParallelAnimationStep';\nimport type { FigureElement, OBJ_Scenario } from '../../../Element';\nimport type { AnimationStartTime } from '../../AnimationManager';\nimport type { TypeColor } from '../../../../tools/types';\n\n/**\n * Transform, color and visbility scenario definition\n *\n * `translation` will overwirte `position`, and `translation, `position`,\n * rotation` and `scale` overwrite the first equivalent transforms in\n * `transform`\n *\n * @property {TypeParsablePoint} [position]\n * @property {TypeParsablePoint} [translation]\n * @property {TypeParsablePoint | number} [scale]\n * @property {number} [rotation]\n * @property {TypeParsableTransform} [transform]\n * @property {TypeColor} [color]\n * @property {number} [opacity]\n */\nexport type OBJ_ScenarioVelocity = {\n  position?: TypeParsablePoint | number,\n  translation?: TypeParsablePoint | number,\n  rotation?: number,\n  scale?: TypeParsablePoint | number,\n  transform?: TypeParsableTransform,\n  color?: number,\n  opacity?: number,\n};\n\n/**\n * {@link ScenarioAnimationStep} options object\n *\n * @extends OBJ_ElementAnimationStep\n *\n * @property {string | OBJ_Scenario} [start]\n * @property {string | OBJ_Scenario} [target]\n * @property {null | string | OBJ_ScenarioVelocity} [velocity] velocity\n * will override duration with a calculated duration based on\n * the `start`, `target` and `velocity`. If `null` is used\n * then `duration` will not be overriden. Any scenario velocity elements that\n * are undefined will default to 1 (`null`)\n * @property {number | null} [maxDuration] maximum duration to clip animation\n * to where `null` is unlimited (`null`)\n * @property {number} [zeroDurationThreshold] value considered 0 to stop\n * animation - this is useful when numbers get very small and rounding problems\n * with javascripts floating point implementation arise\n * @property {OBJ_TranslationPath} [path] translation path style and options\n * (`{ style: 'linear' }`)\n * @property {0 | 1 | -1 | 2} [rotDirection] where `0` is quickest direction,\n * `1` is positive of CCW direction, `-1` is negative of CW direction and `2` is\n * whichever direction doesn't pass through angle 0.\n * @property {'0to360' | '-180to180' | null} [clipRotationTo]\n * @property {'linear' | 'easeinout' | 'easein' | 'easeout' | AnimationProgression} [progression]\n * (`'easeinout'`)\n */\nexport type OBJ_ScenarioAnimationStep = {\n  start?: string | OBJ_Scenario;\n  target?: string | OBJ_Scenario;\n  velocity?: OBJ_ScenarioVelocity;\n  // minDuration?: number,\n  maxDuration?: number,\n  zeroDurationThreshold?: number,\n  allDurationsSame?: boolean,\n  path?: OBJ_TranslationPath,\n  rotDirection: 0 | 1 | -1 | 2;\n  clipRotationTo: '0to360' | '-180to180' | null;\n  progression: 'linear' | 'easeinout' | 'easein' | 'easeout' | AnimationProgression;\n} & OBJ_ElementAnimationStep;\n\n/**\n * Scenario Animation Step\n *\n * ![](./apiassets/scenario_animation.gif)\n *\n * A scenario defines an element's transform and color and can be used to make\n * code more readable and reusable.\n *\n * By default, the scenario will start with the element's current transform and\n * color.\n *\n * @extends ElementAnimationStep\n * @param {OBJ_ScenarioAnimationStep} options\n *\n * @see To test examples, append them to the\n * <a href=\"#animation-boilerplate\">boilerplate</a>\n *\n * @example\n * // NOTE - use these scenario definitions for all examples below\n * p.scenarios['center'] = { position: [0, 0], scale: [1, 1], color: [1, 0, 0, 1] };\n * p.scenarios['right'] = { position: [1, 0], scale: [2, 1], color: [0, 0, 1, 1] };\n * p.scenarios['bottom'] = { position: [0, -0.5], scale: [0.5, 1], color: [0, 0.5, 0, 1] };\n *\n * @example\n * // Using duration\n * p.animations.new()\n *   .scenario({ target: 'right', duration: 2 })\n *   .scenario({ target: 'bottom', duration: 2 })\n *   .scenario({ target: 'center', duration: 2 })\n *   .start();\n *\n * @example\n * // Using velocity\n * p.animations.new()\n *   .scenario({\n *     target: 'right',\n *     velocity: { position: 0.5, scale: 0.2 },\n *   })\n *   .scenario({ target: 'bottom', velocity: { position: 0.5 } })\n *   .scenario({ target: 'center', velocity: { color: 0.2 } })\n *   .start();\n *\n * @example\n * // Different ways to create a stand-alone step\n * const step1 = p.animations.scenario({\n *   target: 'right',\n *   duration: 2,\n * });\n * const step2 = new Fig.Animation.ScenarioAnimationStep({\n *   element: p,\n *   target: 'bottom',\n *   duration: 2,\n * });\n *\n * p.animations.new()\n *   .then(step1)\n *   .then(step2)\n *   .start();\n */\nexport default class ScenarioAnimationStep extends ParallelAnimationStep {\n  element: ?FigureElement;\n  scenario: {\n    start: ?(string | OBJ_Scenario);  // null means use element props when unit is started\n    target: ?(string | OBJ_Scenario);\n    rotDirection: 0 | 1 | -1 | 2;\n    path: OBJ_TranslationPath;\n    velocity: ?OBJ_ScenarioVelocity;\n    maxDuration: ?number;\n    allDurationsSame: boolean;\n    zeroDurationThreshold: number;\n    clipRotationTo: '0to360' | '-180to180' | null;\n    progression: ((number, ?boolean) => number) | string;\n    // minDuration: number;\n  };\n\n  /**\n   * @hideconstructor\n   */\n  constructor(...optionsIn: Array<OBJ_ScenarioAnimationStep>) {\n    const AnimationStepOptionsIn =\n      joinObjects({}, { type: 'scenario' }, ...optionsIn);\n    deleteKeys(AnimationStepOptionsIn, [\n      'start', 'target', 'path',\n      'velocity', 'maxDuration', 'allDurationsSame', 'rotDirection',\n      'clipRotationTo', 'element', 'progression', // 'minDuration',\n    ]);\n    super(AnimationStepOptionsIn);\n    this._stepType = 'position';\n\n    const defaultScenarioOptions = {\n      element: null,\n      start: null,\n      target: null,\n      path: {\n        style: 'linear',\n        magnitude: 0.5,\n        offset: 0.5,\n        controlPoint: null,\n        direction: 'positive',\n      },\n      rotDirection: 0,\n      clipRotationTo: null,\n      velocity: null,\n      maxDuration: null,\n      allDurationsSame: true,\n      zeroDurationThreshold: 0,\n      progression: 'tools.math.easeinout',\n      // minDuration: 0,\n    };\n    if (this.element && this.element.animations.options.translation) {\n      const pathOptions = this.element.animations.options.translation;\n      joinObjects(defaultScenarioOptions.path, pathOptions);\n    }\n    const options = joinObjects({}, defaultScenarioOptions, ...optionsIn);\n    this.element = options.element;\n\n    // $FlowFixMe\n    this.scenario = {};\n    copyKeysFromTo(options, this.scenario, [\n      'start', 'target', 'path',\n      'velocity', 'maxDuration', 'allDurationsSame', 'zeroDurationThreshold',\n      'rotDirection', 'clipRotationTo', 'progression', // 'minDuration',\n    ]);\n  }\n\n  _getStateProperties() {  // eslint-disable-line class-methods-use-this\n    return [...super._getStateProperties(),\n      'scenario',\n    ];\n  }\n\n  _getStateName() {  // eslint-disable-line class-methods-use-this\n    return 'scenarioAnimationStep';\n  }\n\n  getDuration(\n    start: { transform?: Transform, color?: TypeColor, isShown?: boolean, opacity?: number },\n    target: { transform?: Transform, color?: TypeColor, isShown?: boolean },\n  ) {\n    const { element } = this;\n    const { velocity } = this.scenario;\n    // console.log(velocity)\n    // console.log(this.duration)\n    // console.log(element)\n    if (velocity == null || element == null) {\n      return [this.duration, this.duration, this.duration];\n    }\n\n    let transformVelocity = element.transform._dup().constant(1);\n    const colorVelocity = velocity.color == null ? 1 : velocity.color;\n    const opacityVelocity = velocity.opacity == null ? 1 : velocity.opacity;\n\n    if (velocity.transform != null) {\n      transformVelocity = getTransform(velocity.transform)._dup();\n    }\n    if (velocity.position != null) {\n      transformVelocity.updateTranslation(getScale(velocity.position));\n    }\n    if (velocity.translation != null) {\n      transformVelocity.updateTranslation(getScale(velocity.translation));\n    }\n    if (velocity.scale != null) {\n      transformVelocity.updateScale(getScale(velocity.scale));\n    }\n    if (velocity.rotation != null) {\n      transformVelocity.updateRotation(velocity.rotation);\n    }\n    // if (velocity.color != null) {\n    //   colorVelocity = velocity.color;\n    // }\n\n    // if (velocity.opacity != null) {\n    //   opacityVelocity = velocity.color;\n    // }\n\n    let transformDuration = 0;\n    const startTransform = start.transform;\n    const targetTransform = target.transform;\n    if (startTransform != null && targetTransform != null) {\n      transformDuration = getMaxTimeFromVelocity(\n        startTransform._dup(), targetTransform._dup(),\n        transformVelocity, this.scenario.rotDirection,\n      );\n    }\n\n    let colorDuration = 0;\n    if (\n      start.color != null\n      && target.color != null\n      && !areColorsSame(target.color, start.color)\n    ) {\n      const deltaColor = Math.max(\n        Math.abs(target.color[0] - start.color[0]),  // $FlowFixMe\n        Math.abs(target.color[1] - start.color[1]),  // $FlowFixMe\n        Math.abs(target.color[2] - start.color[2]),  // $FlowFixMe\n        Math.abs(target.color[3] - start.color[3]),\n      );\n      // const deltaColor = Math.abs(target.color - start.color);\n      colorDuration = deltaColor / colorVelocity;\n    }\n    let opacityDuration = 0;\n    if (start.isShown != null && target.isShown != null) {\n      if (start.opacity != null && target.isShown === true) {\n        const opacityDelta = 1 - start.opacity;\n        opacityDuration = opacityDelta / opacityVelocity;\n      } else if (start.opacity != null && target.isShown === false) {\n        opacityDuration = start.opacity / opacityVelocity;\n      } else if (start.isShown !== target.isShown) {\n        opacityDuration = 1 / opacityVelocity;\n      }\n    }\n\n    const scenarioMaxTime = this.scenario.maxDuration;\n    if (scenarioMaxTime != null) {\n      colorDuration = Math.min(colorDuration, scenarioMaxTime);\n      opacityDuration = Math.min(opacityDuration, scenarioMaxTime);\n      transformDuration = Math.min(transformDuration, scenarioMaxTime);\n    }\n\n    if (colorDuration <= this.scenario.zeroDurationThreshold) {\n      colorDuration = 0;\n    }\n\n    if (colorDuration < this.duration) {\n      colorDuration = this.duration;\n    }\n\n    if (opacityDuration <= this.scenario.zeroDurationThreshold) {\n      opacityDuration = 0;\n    }\n\n    if (opacityDuration < this.duration) {\n      opacityDuration = this.duration;\n    }\n\n    if (transformDuration <= this.scenario.zeroDurationThreshold) {\n      transformDuration = 0;\n    }\n\n    if (transformDuration < this.duration) {\n      transformDuration = this.duration;\n    }\n\n    if (this.scenario.allDurationsSame) {\n      const maxDuration = Math.max(colorDuration, opacityDuration, transformDuration);\n      colorDuration = maxDuration;\n      opacityDuration = maxDuration;\n      transformDuration = maxDuration;\n    }\n    return [transformDuration, colorDuration, opacityDuration];\n  }\n\n  // On start, calculate the duration, target and delta if not already present.\n  // This is done here in case the start is defined as null meaning it is\n  // going to start from present transform.\n  // Setting a duration to 0 will effectively skip this animation step\n  start(startTime: AnimationStartTime = null) {\n    super.start(startTime);\n    const { element } = this;\n    if (element == null) {\n      throw new Error('Missing Element in animation');\n    }\n    let target = element.getScenarioTarget(this.scenario.target);\n    if (Object.keys(target).length === 0) {\n      target = element.getCurrentScenario();\n    }\n\n    let start = {};\n    if (this.scenario.start != null) {\n      start = element.getScenarioTarget(this.scenario.start);\n    }\n    if (Object.keys(start).length === 0) {\n      start = element.getCurrentScenario();\n      if (element.opacity !== 1) {\n        start.opacity = element.opacity;\n      }\n    }\n\n    // let animateOpacity = false;\n    let dissolve = null;\n    let dissolveFromCurrent = false;\n    if (start.isShown === false && target.isShown === true && start.opacity == null) {\n      dissolve = 'in';\n    } else if (target.isShown === true && start.opacity != null) {\n      dissolve = 'in';\n      dissolveFromCurrent = true;\n    } else if (start.isShown === true && target.isShown === false && start.opacity == null) {\n      dissolve = 'out';\n    } else if (target.isShown === false && start.opacity != null) {\n      dissolve = 'out';\n      dissolveFromCurrent = true;\n    }\n\n    // $FlowFixMe\n    const [transformDuration, colorDuration, opacityDuration] = this.getDuration(start, target);\n    // console.log(transformDuration, colorDuration, opacityDuration);\n    const steps = [];\n    if (target.transform != null) {\n      steps.push(element.anim.transform({\n        start: start.transform,\n        target: target.transform,\n        duration: transformDuration,\n        rotDirection: this.scenario.rotDirection,\n        path: this.scenario.path,\n        clipRotationTo: this.scenario.clipRotationTo,\n        progression: this.scenario.progression,\n      }));\n    }\n\n    if (target.color != null) {\n      steps.push(element.anim.color({\n        start: start.color,\n        target: target.color,\n        duration: colorDuration,\n        progression: this.scenario.progression,\n      }));\n    }\n\n    if (dissolve != null) {\n      steps.push(element.anim.opacity({\n        dissolve,\n        dissolveFromCurrent,\n        duration: opacityDuration,\n        progression: this.scenario.progression,\n      }));\n    }\n    this.steps = steps;\n    super.start(startTime);\n    // if (startTime === 'now' || startTime === 'prev') {\n    //   this.setFrame(0);\n    // }\n  }\n\n  _dup() {\n    const step = new ScenarioAnimationStep();\n    duplicateFromTo(this, step, ['element']);\n    step.element = this.element;\n    return step;\n  }\n}\n","// @flow\nimport {\n  Transform,\n  Rotation, getDeltaAngle, getMaxTimeFromVelocity,\n  getTransform,\n} from '../../../../tools/g2';\nimport type { OBJ_TranslationPath } from '../../../../tools/g2';\nimport {\n  joinObjects, duplicateFromTo, deleteKeys, copyKeysFromTo,\n} from '../../../../tools/tools';\nimport type {\n  OBJ_ElementAnimationStep,\n} from '../ElementAnimationStep';\nimport ElementAnimationStep from '../ElementAnimationStep';\nimport type { AnimationStartTime } from '../../AnimationManager';\n\n/**\n * {@link TransformAnimationStep} options object\n *\n * @extends OBJ_ElementAnimationStep\n *\n * @property {TypeParsableTransform} [start]\n * @property {TypeParsableTransform} [target]\n * @property {TypeParsableTransform} [delta]\n * @property {null | TypeParsableTransform} [velocity] velocity of\n * transform overrides `duration` - `null` to use `duration` (`null`)\n * @property {OBJ_TranslationPath} [path] translation path style and options\n * (`{ style: 'linear' }`)\n * @property {0 | 1 | -1 | 2} [rotDirection] where `0` is quickest direction,\n * `1` is positive of CCW direction, `-1` is negative of CW direction and `2` is\n * whichever direction doesn't pass through angle 0 (`0`).\n * @property {'0to360' | '-180to180' | null} [clipRotationTo]\n * @property {number | null} [maxDuration] maximum duration to clip animation\n * to where `null` is unlimited (`null`)\n */\nexport type OBJ_TransformAnimationStep = {\n  start?: Transform;      // default is element transform\n  target?: Transform;     // Either target or delta must be defined\n  delta?: Transform;      // delta overrides target if both are defined\n  path?: OBJ_TranslationPath;       // default is linear\n  rotDirection: 0 | 1 | -1 | 2;\n  clipRotationTo: '0to360' | '-180to180' | null;\n  velocity: ?Transform | number;\n  maxDuration?: number;\n} & OBJ_ElementAnimationStep;\n\n// A transform animation unit manages a transform animation on an element.\n//\n// The start transform can either be defined initially, or null. Null means\n// the start transform is whatever the current element transform is when the\n// unit is started with start().\n//\n// The transform target is defined with either the target or delta properties.\n// Target is used to predefine the target.\n// Delta is used to calculate the target when the unit is started with start()\n//\n\n/**\n * Transform Animation Step\n *\n * ![](./apiassets/transform_animation.gif)\n *\n * By default, the transform will start with the element's current transform.\n *\n * A {@link Transform} chains many transform links where each link might be\n * a {@link Rotation}, {@link Scale} or {@link Translation} transform.\n *\n * `start`, `target` and `delta` should have the same order of transform links\n * as the `element`'s transform.\n *\n * The {@link TransformAnimationStep} will animate each of these links with the\n * same duration. If `velocity` is used to calculate the duration, then the link\n * with the longest duration will define the duration of the animation.\n * `velocity` can either be a transform with the same order of transform links\n * as the `element` or it can be a constant value, which will be applied to\n * all transform links. `velocity` cannot be 0.\n *\n * Use either `delta` or `target` to define it's end point of the animation.\n *\n * @extends ElementAnimationStep\n * @param {OBJ_TransformAnimationStep} options\n *\n * @see To test examples, append them to the\n * <a href=\"#animation-boilerplate\">boilerplate</a>\n *\n * @example\n * // Using duration\n * p.animations.new()\n *   .transform({\n *     target: new Fig.Transform().scale(2, 2).rotate(0.5).translate(1, 0),\n *     duration: 2,\n *   })\n *   .start();\n *\n * @example\n * // Using velocity as a transform\n * p.animations.new()\n *   .transform({\n *     target: new Fig.Transform().scale(2, 2).rotate(0.5).translate(1, 0),\n *     velocity: new Fig.Transform().scale(0.5, 0.5).rotate(0.25).translate(0.5, 0.5),\n *   })\n *   .start();\n *\n * @example\n * // Using velocity as a number\n * p.animations.new()\n *   .transform({\n *     target: new Fig.Transform().scale(2, 2).rotate(0.5).translate(1, 0),\n *     velocity: 0.5,\n *   })\n *   .start();\n *\n * @example\n * // Using TypeParsableTransform as transform definition\n * p.animations.new()\n *   .transform({\n *     target: [['s', 1.5, 1.5], ['r', 0.5], ['t', 1, 0]],\n *     duration: 2,\n *   })\n *   .start();\n *\n * @example\n * // Different ways to create a stand-alone step\n * const step1 = p.animations.transform({\n *   target: [['s', 1.5, 1.5], ['r', 1], ['t', 1, 0]],\n *   duration: 2,\n * });\n * const step2 = new Fig.Animation.TransformAnimationStep({\n *   element: p,\n *   target: [['s', 1, 1], ['r', 0], ['t', 0, 0]],\n *   duration: 2,\n * });\n *\n * p.animations.new()\n *   .then(step1)\n *   .then(step2)\n *   .start();\n */\nexport default class TransformAnimationStep extends ElementAnimationStep {\n  transform: {\n    start: Transform;  // null means use element transform when unit is started\n    delta: Transform;\n    target: Transform;\n    rotDirection: 0 | 1 | -1 | 2;\n    path: OBJ_TranslationPath;\n    velocity: ?Transform | number;\n    clipRotationTo: '0to360' | '-180to180' | null;\n    maxDuration: ?number;\n  };\n\n  /**\n   * @hideconstructor\n   */\n  constructor(...optionsIn: Array<OBJ_TransformAnimationStep>) {\n    const ElementAnimationStepOptionsIn =\n      joinObjects({}, { type: 'transform' }, ...optionsIn);\n    deleteKeys(ElementAnimationStepOptionsIn, [\n      'start', 'delta', 'target', 'rotDirection', 'path',\n      'velocity', 'clipRotationTo', 'maxDuration',\n    ]);\n    super(ElementAnimationStepOptionsIn);\n    const defaultTransformOptions = {\n      start: null,\n      target: null,\n      delta: null,\n      rotDirection: 0,\n      path: {\n        style: 'linear',\n        magnitude: 0.5,\n        offset: 0.5,\n        controlPoint: null,\n        direction: 'positive',\n      },\n      velocity: null,\n      clipRotationTo: null,\n      maxDuration: null,\n    };\n    if (this.element && this.element.animations.options.translation) {\n      const pathOptions = this.element.animations.options.translation;\n      joinObjects(defaultTransformOptions.path, pathOptions);\n    }\n    const options = joinObjects({}, defaultTransformOptions, ...optionsIn);\n    if (options.start != null) {\n      options.start = getTransform(options.start);\n    }\n    if (options.target != null) {\n      options.target = getTransform(options.target);\n    }\n    if (options.delta != null) {\n      options.delta = getTransform(options.delta);\n    }\n    if (options.velocity != null && typeof options.velocity !== 'number') {\n      options.velocity = getTransform(options.velocity);\n    }\n    // $FlowFixMe\n    this.transform = {};\n    copyKeysFromTo(options, this.transform, [\n      'start', 'delta', 'target', 'path',\n      'velocity', 'rotDirection', 'clipRotationTo', 'maxDuration',\n    ]);\n  }\n\n  _getStateProperties() {  // eslint-disable-line class-methods-use-this\n    return [...super._getStateProperties(),\n      'transform',\n    ];\n  }\n\n  _getStateName() {  // eslint-disable-line class-methods-use-this\n    return 'transformAnimationStep';\n  }\n\n  // On start, calculate the duration, target and delta if not already present.\n  // This is done here in case the start is defined as null meaning it is\n  // going to start from present transform.\n  // Setting a duration to 0 will effectively skip this animation step\n  start(startTime: ?AnimationStartTime = null) {\n    super.start(startTime);\n    if (this.transform.start === null) {\n      if (this.element != null) {\n        this.transform.start = this.element.transform._dup();\n      } else {\n        this.duration = 0;\n        return;\n      }\n    }\n    // if delta is null, then calculate it from start and target\n    if (this.transform.delta == null && this.transform.target != null) {\n      const delta = this.transform.target.sub(this.transform.start);\n      delta.order.forEach((deltaStep, index) => {\n        const startStep = this.transform.start.order[index];\n        const targetStep = this.transform.target.order[index];\n        if (deltaStep instanceof Rotation\n          && startStep instanceof Rotation\n          && targetStep instanceof Rotation) {\n          const rotDiff = getDeltaAngle(\n            startStep.r,\n            targetStep.r,\n            this.transform.rotDirection,\n          );\n          // eslint-disable-next-line no-param-reassign\n          deltaStep.r = rotDiff;\n        }\n      });\n      this.transform.delta = delta;\n    } else if (this.transform.delta != null) {\n      this.transform.target = this.transform.start.add(this.transform.delta);\n    } else {\n      this.duration = 0;\n    }\n\n    // If Velocity is defined, then use it to calculate duration\n    if (this.transform.velocity != null) {\n      this.duration = getMaxTimeFromVelocity(\n        this.transform.start,\n        this.transform.target,\n        this.transform.velocity,\n        this.transform.rotDirection,\n      );\n    }\n    if (this.transform.maxDuration != null) {\n      if (this.duration > this.transform.maxDuration) {\n        this.duration = this.transform.maxDuration;\n      }\n    }\n    if (startTime === 'now' || startTime === 'prevFrame') {\n      this.setFrame(0);\n    }\n  }\n\n  setFrame(deltaTime: number) {\n    // const start = phase.startTransform._dup();\n    // const delta = phase.deltaTransform._dup();\n    const percentTime = deltaTime / this.duration;\n    const percentComplete = this.getPercentComplete(percentTime);\n    const p = percentComplete;\n    // let next = delta._dup().constant(p);\n\n    // next = start.add(delta.mul(next));\n    const next = this.transform.start.toDelta(\n      this.transform.delta, p,\n      this.transform.path.style,\n      this.transform.path,\n    );\n\n    if (this.transform.clipRotationTo !== null) {\n      next.clipRotation(this.transform.clipRotationTo);\n    }\n    if (this.element != null) {\n      this.element.setTransform(next);\n    }\n  }\n\n  setToEnd() {\n    if (this.element != null) {\n      this.element.setTransform(this.transform.target);\n    }\n  }\n\n  _dup() {\n    const step = new TransformAnimationStep();\n    duplicateFromTo(this, step, ['element']);\n    step.element = this.element;\n    return step;\n  }\n}\n","// @flow\n// import * as tools from '../../tools/math';\n// import { FigureElement } from '../Element';\nimport type { OBJ_AnimationStep } from '../AnimationStep';\nimport AnimationStep from '../AnimationStep';\nimport { joinObjects, duplicateFromTo } from '../../../tools/tools';\nimport GlobalAnimation from '../../webgl/GlobalAnimation';\nimport type { AnimationStartTime } from '../AnimationManager';\n\n\n/**\n * Parallel animation step options object\n * @extends OBJ_AnimationStep\n * @property {Array<AnimationStep>} steps animation steps to perform in parallel\n */\nexport type OBJ_ParallelAnimationStep = {\n  steps?: Array<AnimationStep>;\n} & OBJ_AnimationStep;\n\n/**\n * Execute an array of `{@link AnimationStep}`s in parallel.\n *\n * ![](./apiassets/parallel_animation.gif)\n *\n * The parallel animation step will not complete till all steps are finished.\n *\n * @param {Array<AnimationStep> | OBJ_SerialAnimationStep} steps\n * animation steps to perform in serial\n * @extends AnimationStep\n * @see To test examples, append them to the\n * <a href=\"#animation-boilerplate\">boilerplate</a>\n *\n * @example\n * p.animations.new()\n *   .inParallel([\n *     p.animations.position({ target: [1, 0], duration: 2 }),\n *     p.animations.scale({ target: 2, duration: 2 }),\n *   ])\n *   .start();\n *\n * @example\n * // One of the parallel steps is a series of steps\n * p.animations.new()\n *   .delay(1)\n *   .inParallel([\n *     p.animations.builder()\n *       .scale({ target: 0.5, duration: 1 })\n *       .scale({ target: 2, duration: 1 })\n *       .scale({ target: 1, duration: 2 }),\n *     p.animations.color({ target: [0, 0, 1, 1], duration: 4 }),\n *     p.animations.rotation({ target: Math.PI, duration: 4 }),\n *   ])\n *   .start();\n */\n// Animations get started from a parent, but finish themselves\nexport class ParallelAnimationStep extends AnimationStep {\n  steps: Array<AnimationStep>;\n\n  /**\n   * @hideconstructor\n   */\n  constructor(\n    stepsOrOptionsIn: Array<AnimationStep | null> | OBJ_ParallelAnimationStep = {},\n    ...optionsIn: Array<OBJ_ParallelAnimationStep>\n  ) {\n    const defaultOptions = { steps: [] };\n    let options;\n    if (Array.isArray(stepsOrOptionsIn)) {\n      options = joinObjects({}, defaultOptions, ...optionsIn);\n      options.steps = stepsOrOptionsIn;\n    } else {\n      options = joinObjects({}, defaultOptions, stepsOrOptionsIn, ...optionsIn);\n    }\n    super(options);\n    this.steps = [];\n    let steps = [];\n    if (!Array.isArray(options.steps) && options.steps != null) {\n      steps = [options.steps];\n    } else if (options.steps != null) {\n      ({ steps } = options);\n    }\n    this.steps = [];\n    steps.forEach((step) => {\n      if (step != null) {\n        this.steps.push(step);\n      }\n    });\n  }\n\n  _getStateProperties() {  // eslint-disable-line class-methods-use-this\n    return [...super._getStateProperties(),\n      'steps',\n    ];\n  }\n\n  _getStateName() {  // eslint-disable-line class-methods-use-this\n    return 'parallelAnimationStep';\n  }\n\n  setTimeDelta(delta: number) {\n    super.setTimeDelta(delta);\n    if (this.steps != null) {\n      this.steps.forEach((step) => {\n        step.setTimeDelta(delta);\n      });\n    }\n  }\n\n  with(step: AnimationStep) {\n    if (step != null) {\n      this.steps.push(step);\n    }\n    return this;\n  }\n\n  nextFrame(now: number, speed: number) {\n    if (this.startTime === null) {\n      this.startTime = now - this.startTimeOffset;\n    }\n    let remaining = null;\n    if (this.beforeFrame != null) { // $FlowFixMe - as this has been confirmed\n      this.beforeFrame(now - this.startTime);\n    }\n    this.steps.forEach((step) => {\n      // console.log(step.state, step)\n      if (step.state === 'animating' || step.state === 'waitingToStart') {\n        const stepRemaining = step.nextFrame(now, speed);\n        // console.log(step.element.uid, stepRemaining)\n        if (remaining === null) {\n          remaining = stepRemaining;\n        }\n        if (stepRemaining < remaining) {\n          remaining = stepRemaining;\n        }\n      }\n    });\n    if (this.afterFrame != null) { // $FlowFixMe - as this has been confirmed\n      this.afterFrame(now - this.startTime);\n    }\n    if (remaining === null) {\n      remaining = 0;\n    }\n    if (remaining >= 0) {\n      this.finish();\n    }\n    return remaining;\n  }\n\n  finishIfZeroDuration() {\n    let state = 'finished';\n    this.steps.forEach((step) => {\n      if (step.state !== 'finished') {\n        state = 'animating';\n      }\n    });\n    if (state === 'finished') {\n      this.finish();\n    }\n  }\n\n  startWaiting() {\n    super.startWaiting();\n    this.steps.forEach((step) => {\n      step.startWaiting();\n    });\n  }\n\n  start(startTime: ?AnimationStartTime = null) {\n    this.startWaiting();\n    super.start(startTime);\n    this.steps.forEach((step) => {\n      step.start(startTime);\n      step.finishIfZeroDuration();\n    });\n  }\n\n  finish(cancelled: boolean = false, force: ?'complete' | 'freeze' = null) {\n    if (this.state === 'idle' || this.state === 'finished') {\n      return;\n    }\n    // super.finish(cancelled, force);\n    this.state = 'finished';\n    let forceToUse = null;\n    if (this.completeOnCancel === true) {\n      forceToUse = 'complete';\n    }\n    if (this.completeOnCancel === false) {\n      forceToUse = 'freeze';\n    }\n    if (force != null) {\n      forceToUse = force;\n    }\n    this.steps.forEach((step) => {\n      if (step.state !== 'idle' && step.state !== 'finished') {\n        step.finish(cancelled, forceToUse);\n      }\n    });\n    if (this.onFinish != null) {\n      this.fnExec(this.onFinish, cancelled);\n    }\n  }\n\n  getTotalDuration() {\n    let totalDuration = 0;\n    this.steps.forEach((step) => {\n      const stepDuration = step.getTotalDuration();\n      if (stepDuration > totalDuration) {\n        totalDuration = stepDuration;\n      }\n    });\n    return totalDuration;\n  }\n\n  getRemainingTime(now: number = new GlobalAnimation().now() / 1000) {\n    const totalDuration = this.getTotalDuration();\n    if (this.startTime == null) {\n      if (this.state === 'animating' || this.state === 'waitingToStart') {\n        return totalDuration;\n      }\n      return 0;\n    }\n    const deltaTime = now - this.startTime;\n    return totalDuration - deltaTime;\n  }\n\n  _dup() {\n    const step = new ParallelAnimationStep();\n    duplicateFromTo(this, step);\n    return step;\n  }\n}\n\nexport function inParallel(\n  stepsOrOptionsIn: Array<AnimationStep | null> | OBJ_ParallelAnimationStep = {},\n  ...optionsIn: Array<OBJ_ParallelAnimationStep>\n) {\n  return new ParallelAnimationStep(stepsOrOptionsIn, ...optionsIn);\n}\n","// @flow\n// import * as tools from '../../tools/math';\n// import { FigureElement } from '../Element';\nimport type { OBJ_AnimationStep } from '../AnimationStep';\nimport AnimationStep from '../AnimationStep';\nimport { joinObjects, duplicateFromTo } from '../../../tools/tools';\nimport GlobalAnimation from '../../webgl/GlobalAnimation';\nimport type { AnimationStartTime } from '../AnimationManager';\n\n/**\n * Serial animation step options object\n *\n * @extends OBJ_AnimationStep\n * @property {Array<AnimationStep>} [steps] animation steps to execute in series\n */\nexport type OBJ_SerialAnimationStep = {\n  steps?: Array<AnimationStep>;\n} & OBJ_AnimationStep;\n\n/**\n * Execute an array of {@link AnimationStep}s in series.\n *\n * ![](./apiassets/serial_animation.gif)\n *\n * Often the {@link AnimationBuilder} class which extends\n * `SerialAnimationStep` can be used to create serial animations\n * in a more clean way.\n *\n * @param {Array<AnimationStep> | OBJ_SerialAnimationStep} steps\n * animation steps to perform in serial\n * @extends AnimationStep\n * @see To test examples, append them to the\n * <a href=\"#animation-boilerplate\">boilerplate</a>\n *\n * @example\n * // Using a SerialAnimation step can be cumbersome, but\n * // can be useful if modularizing animations between files\n * const Rot = Fig.Animation.RotationAnimationStep;\n * const Delay = Fig.Animation.DelayAnimationStep;\n * const Pos = Fig.Animation.PositionAnimationStep;\n *\n * const series = new Fig.Animation.SerialAnimationStep([\n *   new Rot({ element: p, target: Math.PI / 2, duration: 2 }),\n *   new Delay({ duration: 0.2 }),\n *   new Rot({ element: p, target: Math.PI, duration: 2 }),\n *   new Delay({ duration: 0.2 }),\n *   new Rot({ element: p, target: 0, direction: -1, duration: 1.3, progression: 'easein' }),\n *   new Pos({ element: p, target: [1, 0], duration: 2, progression: 'easeout' }),\n * ]);\n *\n * p.animations.animations.push(series);\n * p.animations.start()\n *\n * @example\n * // Same animation but with `AnimationBuilder` (which is an extension of\n * // `SerialAnimationStep`)\n * p.animations.new()\n *   .rotation({ target: Math.PI / 2, duration: 2 })\n *   .delay(0.2)\n *   .rotation({ target: Math.PI, duration: 2 })\n *   .delay(0.2)\n *   .rotation({ target: 0, duration: 1, direction: -1, progression: 'easein' })\n *   .position({ target: [1, 0], duration: 2, progression: 'easeout' })\n *   .start();\n */\nexport class SerialAnimationStep extends AnimationStep {\n  steps: Array<AnimationStep>;\n  index: number;\n\n  /**\n   * @hideconstructor\n   */\n  constructor(\n    stepsOrOptionsIn: Array<AnimationStep> | OBJ_SerialAnimationStep = {},\n    ...optionsIn: Array<OBJ_SerialAnimationStep>\n  ) {\n    const defaultOptions = { steps: [] };\n    let options;\n    if (Array.isArray(stepsOrOptionsIn)) {\n      options = joinObjects({}, defaultOptions, ...optionsIn);\n      options.steps = stepsOrOptionsIn;\n    } else {\n      options = joinObjects({}, defaultOptions, stepsOrOptionsIn, ...optionsIn);\n    }\n    super(options);\n    this.index = 0;\n    this.steps = [];\n    if (!Array.isArray(options.steps) && options.steps != null) {\n      this.steps = [options.steps];\n    } else if (options.steps != null) {\n      this.steps = options.steps;\n    }\n  }\n\n  _getStateProperties() {  // eslint-disable-line class-methods-use-this\n    return [...super._getStateProperties(),\n      'steps',\n      'index',\n    ];\n  }\n\n  _getStateName() {  // eslint-disable-line class-methods-use-this\n    return 'serialAnimationStep';\n  }\n\n  // constructor(optionsIn: OBJ_SerialAnimationStep = {}) {\n  //   super(optionsIn);\n  //   this.index = 0;\n  //   const defaultOptions = {};\n  //   const options = joinObjects({}, defaultOptions, optionsIn);\n  //   this.steps = [];\n  //   if (!Array.isArray(options.steps) && options.steps != null) {\n  //     this.steps = [options.steps];\n  //   } else if (options.steps != null) {\n  //     this.steps = options.steps;\n  //   }\n  //   return this;\n  // }\n\n  setTimeDelta(delta: number) {\n    super.setTimeDelta(delta);\n    if (this.steps != null) {\n      this.steps.forEach((step) => {\n        step.setTimeDelta(delta);\n      });\n    }\n  }\n\n  then(step: ?AnimationStep) {\n    if (step != null) {\n      this.steps.push(step);\n    }\n    return this;\n  }\n\n  startWaiting() {\n    super.startWaiting();\n    this.steps.forEach((step) => {\n      step.startWaiting();\n    });\n  }\n\n  // $FlowFixMe\n  start(startTime: ?AnimationStartTime = null) {\n    if (this.state !== 'animating') {\n      this.startWaiting();\n      super.start(startTime);\n      this.index = 0;\n      if (this.steps.length > 0) {\n        this.steps[0].start(startTime);\n        this.steps[0].finishIfZeroDuration();\n      }\n    }\n    this.finishIfZeroDuration();\n  }\n\n  finishIfZeroDuration() {\n    let i = 0;\n    let step = this.steps[0];\n    while (i < this.steps.length && step.state === 'finished') {\n      i += 1;\n      if (i < this.steps.length) {\n        this.index = i;\n        step = this.steps[i];\n        step.start(this.steps[i - 1].startTime);\n        step.finishIfZeroDuration();\n      }\n    }\n    if (i === this.steps.length) {\n      this.finish();\n    }\n  }\n\n  nextFrame(now: number, speed: number) {\n    if (this.startTime === null) {\n      this.startTime = now - this.startTimeOffset;\n    }\n    let remaining = -1;\n    if (this.beforeFrame != null) { // $FlowFixMe - as this has been confirmed\n      this.beforeFrame(now - this.startTime);\n    }\n    if (this.index <= this.steps.length - 1) {\n      remaining = this.steps[this.index].nextFrame(now, speed);\n      if (this.afterFrame != null) { // $FlowFixMe - as this has been confirmed\n        this.afterFrame(now - this.startTime);\n      }\n      // console.log('serial', now, this.index, remaining)\n      if (remaining >= 0) {\n        if (this.index === this.steps.length - 1) {\n          this.finish();\n          return remaining;\n        }\n        this.index += 1;\n        this.steps[this.index].start(now - remaining);\n        return this.nextFrame(now, speed);\n      }\n    }\n    return remaining;\n  }\n\n  finish(cancelled: boolean = false, force: ?'complete' | 'freeze' = null) {\n    if (this.state === 'idle' || this.state === 'finished') {\n      return;\n    }\n    // super.finish(cancelled, force);\n    this.state = 'finished';\n    let forceToUse = null;\n    if (this.completeOnCancel === true) {\n      forceToUse = 'complete';\n    }\n    if (this.completeOnCancel === false) {\n      forceToUse = 'freeze';\n    }\n    if (force != null) {\n      forceToUse = force;\n    }\n    this.steps.forEach((step) => {\n      if (step.state !== 'idle' && step.state !== 'finished') {\n        step.finish(cancelled, forceToUse);\n      }\n    });\n    if (this.onFinish != null) {\n      this.fnExec(this.onFinish, cancelled);\n    }\n  }\n\n  getTotalDuration() {\n    let totalDuration = 0;\n    this.steps.forEach((step) => {\n      totalDuration += step.getTotalDuration();\n    });\n    return totalDuration;\n  }\n\n  getRemainingTime(now: number = new GlobalAnimation().now() / 1000) {\n    const totalDuration = this.getTotalDuration();\n    if (this.startTime == null) {\n      if (this.state === 'animating' || this.state === 'waitingToStart') {\n        return totalDuration;\n      }\n      return 0;\n    }\n    const deltaTime = now - this.startTime;\n    return totalDuration - deltaTime;\n  }\n\n  _dup() {\n    const step = new SerialAnimationStep();\n    duplicateFromTo(this, step);\n    return step;\n  }\n}\n\nexport function inSerial(\n  stepsOrOptionsIn: Array<AnimationStep> | OBJ_SerialAnimationStep = {},\n  ...optionsIn: Array<OBJ_SerialAnimationStep>\n) {\n  return new SerialAnimationStep(stepsOrOptionsIn, ...optionsIn);\n}\n\n","// @flow\nimport { joinObjects, duplicateFromTo } from '../../../tools/tools';\nimport type {\n  OBJ_AnimationStep,\n} from '../AnimationStep';\nimport AnimationStep from '../AnimationStep';\nimport type { FigureElement } from '../../Element';\n\n/**\n * {@link TriggernAnimationStep} options object\n *\n * @extends OBJ_AnimationStep\n *\n * @property {string | function(any): number | void} callback if desired, return\n * a number from `callback` to update the duration of the trigger animation\n * step. Doing so will make any previous calculations of remaining animation\n * time incorrect. Make sure to initialize this step with a non-zero duration\n * for this to work.\n * @property {any} [payload] payload to pass to callback (`null`)\n * @property {FigureElement} element {@link FigureElement} to associate with\n * callback - if the `callback` is a string then this element's\n * {@link FunctionMap} will be searched for the corresponding function\n *\n */\nexport type OBJ_TriggerAnimationStep = {\n  callback?: Function;      // default is element transform\n  payload?: any;\n} & OBJ_AnimationStep;\n\n/**\n * Trigger Animation Step\n *\n * ![](./apiassets/trigger_animation.gif)\n *\n * A trigger step executes a custom function\n *\n * A `delay` will delay the triggering of the custom function\n * while `duration` will pad time at the end of the trigger before\n * the animation step finishes.\n *\n * @extends AnimationStep\n * @param {OBJ_TriggerAnimationStep | function(): void} options\n *\n * @see To test examples, append them to the\n * <a href=\"#animation-boilerplate\">boilerplate</a>\n *\n * @example\n * // Simple trigger\n * p.animations.new()\n *   .position({ target: [1, 0], duration: 2 })\n *   .trigger(() => { console.log('arrived at (1, 0)') })\n *   .position({ target: [0, 0], duration: 2 })\n *   .trigger(() => { console.log('arrived at (0, 0)') })\n *   .start();\n *\n * @example\n * // Trigger with delay, duration and payload\n * const printPosition = (pos) => {\n *   console.log(`arrived at ${pos}`);\n * };\n *\n * p.animations.new()\n *   .position({ target: [1, 0], duration: 2 })\n *   .trigger({\n *     delay: 1,\n *     callback: printPosition,\n *     payload: '(1, 0)',\n *     duration: 1,\n *   })\n *   .position({ target: [0, 0], duration: 2 })\n *   .trigger({ callback: printPosition, payload: '(0, 0)' })\n *   .start();\n *\n * @example\n * // Different ways to create a stand-alone step\n * const step1 = p.animations.trigger({\n *   callback: () => { console.log('arrived at (1, 0)') },\n * });\n * const step2 = new Fig.Animation.TriggerAnimationStep({\n *   callback: () => { console.log('arrived at (0, 0)') },\n * });\n *\n * p.animations.new()\n *   .position({ target: [1, 0], duration: 2 })\n *   .then(step1)\n *   .position({ target: [0, 0], duration: 2 })\n *   .then(step2)\n *   .start();\n */\nexport class TriggerAnimationStep extends AnimationStep {\n  element: ?Object;\n  callback: ?(string | Function);\n  payload: ?Object;\n\n  /**\n   * @hideconstructor\n   */\n  constructor(\n    triggerOrOptionsIn: Function | OBJ_TriggerAnimationStep = {},\n    ...optionsIn: Array<OBJ_TriggerAnimationStep>\n  ) {\n    const defaultOptions = {\n      payload: null,\n      duration: 0,\n    };\n    let options;\n    if (\n      typeof triggerOrOptionsIn === 'function'\n      || typeof triggerOrOptionsIn === 'string'\n    ) {\n      options = joinObjects({}, defaultOptions, ...optionsIn);\n      options.callback = triggerOrOptionsIn;\n    } else {\n      options = joinObjects({}, defaultOptions, triggerOrOptionsIn, ...optionsIn);\n    }\n    super(options);\n    this.element = options.element;\n    this.callback = options.callback;\n    this.payload = options.payload;\n    this.duration = options.duration;\n  }\n\n  // fnExec(idOrFn: string | Function | null, ...args: any) {\n  //   const result = this.fnMap.exec(idOrFn, ...args);\n  //   if (result == null && this.element != null) {\n  //     return this.element.fnMap.exec(idOrFn, ...args);\n  //   }\n  //   return result;\n  // }\n  fnExec(idOrFn: string | Function | null, ...args: any) {\n    // const result = this.fnMap.exec(idOrFn, ...args);\n    // if (result == null && this.element != null) {\n    //   return this.element.fnMap.exec(idOrFn, ...args);\n    // }\n    // return result;\n    if (this.element != null) {\n      return this.fnMap.execOnMaps(\n        idOrFn, [this.element.fnMap.map], ...args,\n      );\n    }\n    return this.fnMap.exec(idOrFn, ...args);\n  }\n\n  _fromState(state: Object, getElement: ?(string) => FigureElement) {\n    joinObjects(this, state);\n    if (this.element != null && typeof this.element === 'string' && getElement != null) {\n      this.element = getElement(this.element);\n    }\n    return this;\n  }\n\n  _state(options: Object) {\n    const state = super._state(options);\n    if (this.element != null) {\n      state.state.element = {\n        f1Type: 'de',\n        state: this.element.getPath(),\n      };\n    }\n    return state;\n  }\n\n  _getStateProperties() {  // eslint-disable-line class-methods-use-this\n    return [...super._getStateProperties(),\n      'callback',\n      'payload',\n    ];\n  }\n\n  _getStateName() {  // eslint-disable-line class-methods-use-this\n    return 'triggerAnimationStep';\n  }\n\n  setFrame() {\n    // if (this.callback != null && this.payload != null) {\n    //   console.log(this.payload)\n    // }\n    const remainingTime = this.fnExec(this.callback, this.payload);\n    if (remainingTime != null && typeof remainingTime === 'number') {\n      this.duration = remainingTime;\n    }\n    this.callback = null;\n    // if (this.callback != null) {\n    //   this.callback(this.payload);\n    //   this.callback = null;\n    // }\n  }\n\n  setToEnd() {\n    // if (this.callback != null) {\n    //   this.callback(this.payload);\n    //   this.callback = null;\n    // }\n    this.fnExec(this.callback, this.payload);\n    this.callback = null;\n  }\n\n  _dup() {\n    const step = new TriggerAnimationStep();\n    duplicateFromTo(this, step, ['element']);\n    return step;\n  }\n}\n\nexport function trigger(\n  triggerOrOptionsIn: Function | OBJ_TriggerAnimationStep = {},\n  ...optionsIn: Array<OBJ_TriggerAnimationStep>\n) {\n  return new TriggerAnimationStep(triggerOrOptionsIn, ...optionsIn);\n}\n","// @flow\n\nclass DrawContext2D {\n  canvas: HTMLCanvasElement;\n  ctx: CanvasRenderingContext2D;\n  ratio: number;\n\n  constructor(canvas: HTMLCanvasElement) {\n    this.canvas = canvas;\n    this.ctx = this.canvas.getContext('2d');\n\n    /* $FlowFixMe */\n    const bsr = this.ctx.webkitBackingStorePixelRatio\n              /* $FlowFixMe */\n              || this.ctx.mozBackingStorePixelRatio\n              /* $FlowFixMe */\n              || this.ctx.msBackingStorePixelRatio\n              /* $FlowFixMe */\n              || this.ctx.oBackingStorePixelRatio\n              /* $FlowFixMe */\n              || this.ctx.backingStorePixelRatio || 1;\n\n    let dpr = window.devicePixelRatio || 1;\n    if (dpr === 1) {\n      dpr = 2;\n    }\n\n    if (typeof bsr === 'number') {\n      this.ratio = dpr / bsr;\n    } else {\n      this.ratio = 1;\n    }\n    this.resize();\n  }\n\n  resize() {\n    this.ctx.setTransform(1, 0, 0, 1, 0, 0);\n    this.canvas.width = this.canvas.clientWidth * this.ratio;\n    this.canvas.height = this.canvas.clientHeight * this.ratio;\n    this.ctx.scale(this.ratio, this.ratio);\n  }\n\n  _dup() {\n    return this;\n  }\n}\n\nexport default DrawContext2D;\n","// @flow\n\nimport {\n  Point, // Rect, getBoundingRect,\n} from '../../tools/g2';\n// import type {\n//   TypeParsablePoint\n// } from '../../tools/g2';\nimport { getState } from '../Recorder/state';\nimport type { TypeColor } from '../../tools/types';\nimport type { CPY_Step } from '../geometries/copy/copy';\nimport type { OBJ_TextDefinition } from '../FigurePrimitives/FigurePrimitives';\n\n// A Drawing object can be:\n//  - GL primitive vertices\n//  - Text object for 2D drawing contexts\n//  - HTML Object in the figure_html div\n//\n// It must have:\n//\n//   Properties:\n//     - location     A reference location where relative boundaries are\n//                    calculated from\n//     - border       Array of borders in Figure Units\n//\n//   Methods:\n//     - drawWithTransformMatrix(transformMatrix)\n//     - calcBorder(lastDrawTransformMatrix, glToFigureTransform)\n//\n\n// function getBounds(borderIn: null | Array<Array<Point>>, transformMatrix: Array<number> | null) {\n//   if (transformMatrix == null) {\n//     return borderIn;\n//   }\n//   if (\n//     borderIn == null\n//     || (borderIn.length === 1 && borderIn[0].length === 0)\n//     || borderIn.length === 0\n//   ) {\n//     return [];\n//   }\n\n//   const boundaries = [];\n//   borderIn.forEach((boundary) => {\n//     const border = [];\n//     boundary.forEach((point) => {\n//       border.push(point.transformBy(transformMatrix));\n//     });\n//     boundaries.push(border);\n//   });\n//   return boundaries;\n// }\n\n/**\n * Drawing Object\n *\n * Manages drawing an element to a WebGL or Context 2D canvas. Can also\n * be used to manage a HTML element on the screen.\n *\n * @property {Array<Array<Point>>} border each array of points defines a\n * closed boundary or border of the element. An element may have multiple\n * closed borders. A border defines where a shape can be touched, or how it\n * bounces of figure boundaries\n * @property {Array<Array<Point>>} holeBorder areas where a shape cannot be\n * touched\n * @see {@link FigureElementPrimitive}\n */\nclass DrawingObject {\n  // numPoints: number;           // Number of primative vertices\n  location: Point;\n  border: Array<Array<Point>>; // Border vertices\n  textBorder: Array<Array<Point>>; // Border vertices\n  textBorderBuffer: Array<Array<Point>>;\n  // touchBorder: Array<Array<Point>>;\n  // hole: Array<Array<Point>>;  // Border of any holes inside of main border\n  // +change: (any, any, any) => void;\n  // onLoad: Function | null;   // Only used for drawing objects with asynchronous\n  //                            loading (like textures)\n  type: string;\n  state: 'loading' | 'loaded';\n\n  constructor() {\n    // this.numPoints = 0;\n    this.location = new Point(0, 0);\n    // this.border = [[]];\n    // this.touchBorder = [[]];\n    // this.hole = [[]];\n    // this.onLoad = null;\n    this.type = 'drawingObject';\n    // this.state = 'loading';\n  }\n\n  _dup() {\n    return this;\n  }\n\n  // // Helper function hack used in TextObject\n  // // eslint-disable-next-line class-methods-use-this, no-unused-vars\n  // transformBorder(\n  //   borderIn: null | Array<Array<Point>>,\n  //   transformMatrix: Array<number> | null,\n  // ) {\n  //   return getBounds(borderIn, transformMatrix);\n  // }\n\n  // eslint-disable-next-line class-methods-use-this, no-unused-vars\n  setText(textOrOptions: string | OBJ_TextDefinition, index: number = 1) {\n  }\n\n  // eslint-disable-next-line class-methods-use-this, no-unused-vars\n  update(options: Object) {\n  }\n\n\n  // getBoundaries(transformMatrix: null | Array<number> = null): Array<Array<Point>> {\n  //   return getBounds(this.border, transformMatrix);\n  // }\n\n  // getTouchBoundaries(transformMatrix: null | Array<number> = null): Array<Array<Point>> {\n  //   return getBounds(this.touchBorder, transformMatrix);\n  // }\n\n  // getBoundaryHoles(transformMatrix: null | Array<number> = null): Array<Array<Point>> {\n  //   return getBounds(this.hole, transformMatrix);\n  // }\n  /* eslint-enable */\n\n  /* eslint-disable class-methods-use-this, no-unused-vars */\n  drawWithTransformMatrix(\n    transformMatrix: Array<number>,\n    color: TypeColor,\n    canvasIndex: number,\n    numPoints: number,\n  ) {\n  }\n  /* eslint-enable */\n\n  // getBoundingRect(transformMatrix: Array<number> | null = null): Rect {\n  //   const boundaries = this.getBoundaries(transformMatrix);\n  //   return getBoundingRect(boundaries);\n  // }\n\n  getLocation(transformMatrix: Array<number> | null = null): Point {\n    if (transformMatrix == null) {\n      return this.location;\n    }\n    return this.getLocation().transformBy(transformMatrix);\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  getPointCountForAngle() {\n    return 0;\n  }\n\n  // getRelativeBoundingRect(transformMatrix: Array<number> | null = null): Rect {\n  //   const location = this.getLocation(transformMatrix);\n  //   const absoluteBoundaries =\n  //     this.getBoundingRect(transformMatrix);\n  //   const relativeBoundaries = new Rect(\n  //     absoluteBoundaries.left - location.x,\n  //     absoluteBoundaries.bottom - location.y,\n  //     absoluteBoundaries.width,\n  //     absoluteBoundaries.height,\n  //   );\n  //   return relativeBoundaries;\n  // }\n\n  // getRelativeVertexSpaceBoundingRect() {\n  //   const absoluteBoundaries =\n  //     this.getVertexSpaceBoundingRect();\n  //   const relativeBoundaries = new Rect(\n  //     absoluteBoundaries.left - this.location.x,\n  //     absoluteBoundaries.bottom - this.location.y,\n  //     absoluteBoundaries.width,\n  //     absoluteBoundaries.height,\n  //   );\n  //   return relativeBoundaries;\n  // }\n\n  /* eslint-disable no-unused-vars, class-methods-use-this */\n  change(\n    drawingPrimitive: any,\n    // border: Array<Array<Point>> | 'points' | 'rect',\n    // touchBorder: Array<Array<Point>> | 'border' | 'rect' | 'none',\n    // holes: Array<Array<Point>> | 'none',\n    copy: Array<CPY_Step> = [],\n  ) {\n  }\n  /* eslint-enable no-unused-vars, class-methods-use-this */\n\n  _getStateProperties() {  // eslint-disable-line class-methods-use-this\n    return [];\n  }\n\n  _state(options: Object) {\n    return getState(this, this._getStateProperties(), options);\n  }\n}\n\nexport default DrawingObject;\n","// @flow\n\n// import * as m2 from '../tools/m2';\nimport {\n  Point, spaceToSpaceTransform,\n} from '../../../tools/g2';\nimport { round } from '../../../tools/math';\nimport DrawingObject from '../DrawingObject';\nimport type { TypeColor } from '../../../tools/types';\n\n\nclass HTMLObject extends DrawingObject {\n  border: Array<Array<Point>>;\n  id: string;\n  location: Point;\n  // figureLimits: Rect;\n  element: HTMLElement;\n  parentDiv: HTMLElement;\n  xAlign: 'left' | 'right' | 'center';\n  yAlign: 'top' | 'bottom' | 'middle';\n  show: boolean;\n  lastMatrix: Array<number>;\n  lastColor: Array<number>;\n\n  copy: () => HTMLObject;\n  // +change: (string | HTMLElement, Array<number>) => void;\n\n  constructor(\n    parentDiv: HTMLElement,\n    id: string,\n    location: Point,\n    yAlign: 'top' | 'bottom' | 'middle' = 'middle',\n    xAlign: 'left' | 'right' | 'center' = 'center',\n  ) {\n    super();\n    const element = document.getElementById(id);\n    if (element) {\n      this.element = element;\n    }\n    this.id = id;\n    this.location = location;\n    this.yAlign = yAlign;\n    this.xAlign = xAlign;\n    this.parentDiv = parentDiv;\n    this.show = true;\n    this.setBorder();\n    this.lastMatrix = [0, 0, 0, 0, 0, 0, 0, 0, 0];\n    this.lastColor = [-1, -1, -1, -1];\n  }\n\n  _dup() {\n    const c = new HTMLObject(\n      this.parentDiv, this.id,\n      this.location._dup(), this.yAlign, this.xAlign,\n    );\n    c.show = this.show;\n    c.border = this.border.map(b => b.map(p => p._dup()));\n    return c;\n  }\n\n  setBorder() {\n    const parentRect = this.parentDiv.getBoundingClientRect();\n    const elementRect = this.element.getBoundingClientRect();\n    const left = elementRect.left - parentRect.left;\n    const right = left + elementRect.width;\n    const top = elementRect.top - parentRect.top;\n    const bottom = top + elementRect.height;\n\n    const boundary = [];\n    boundary.push(new Point(left, top));\n    boundary.push(new Point(right, top));\n    boundary.push(new Point(right, bottom));\n    boundary.push(new Point(left, bottom));\n    this.border = [];\n    this.border.push(boundary);\n  }\n\n  getBoundaries(): Array<Array<Point>> {\n    const parentRect = this.parentDiv.getBoundingClientRect();\n    const glSpace = {\n      x: { bottomLeft: -1, width: 2 },\n      y: { bottomLeft: -1, height: 2 },\n    };\n    const pixelSpace = {\n      x: { bottomLeft: 0, width: parentRect.width },\n      y: { bottomLeft: parentRect.height, height: -parentRect.height },\n    };\n    const pixelToGLTransform = spaceToSpaceTransform(pixelSpace, glSpace);\n\n    const elementRect = this.element.getBoundingClientRect();\n    const left = elementRect.left - parentRect.left;\n    const right = left + elementRect.width;\n    const top = elementRect.top - parentRect.top;\n    const bottom = top + elementRect.height;\n\n    const boundary = [];\n    boundary.push(new Point(left, top));\n    boundary.push(new Point(right, top));\n    boundary.push(new Point(right, bottom));\n    boundary.push(new Point(left, bottom));\n\n    return [boundary.map(p => p.transformBy(pixelToGLTransform.matrix()))];\n  }\n\n  glToPixelSpace(p: Point) {\n    const x = (p.x - -1) / 2 * this.parentDiv.clientWidth;\n    const y = (1 - p.y) / 2 * this.parentDiv.clientHeight;\n    return new Point(x, y);\n  }\n\n  // $FlowFixMe\n  change(newHtml: string | HTMLElement, lastDrawTransformMatrix: Array<number>) {\n    let element = newHtml;\n    if (typeof newHtml === 'string') {\n      element = document.createElement('div');\n      element.innerHTML = newHtml;\n    }\n    if (element instanceof HTMLElement) {\n      this.element.innerHTML = '';\n      this.element.appendChild(element);\n      this.transformHtml(lastDrawTransformMatrix);\n    }\n  }\n\n  transformHtml(transformMatrix: Array<number>, opacity: number = 1) {\n    if (this.show) {\n      // this.element.style.visibility = 'visible';\n      const glLocation = this.location.transformBy(transformMatrix);\n      const pixelLocation = this.glToPixelSpace(glLocation);\n\n      const w = this.element.clientWidth;\n      const h = this.element.clientHeight;\n      // console.log(w, h, this.element.id)\n      let left = 0;\n      let top = 0;\n      if (this.xAlign === 'center') {\n        left = -w / 2;\n      } else if (this.xAlign === 'right') {\n        left = -w;\n      }\n      if (this.yAlign === 'middle') {\n        top = -h / 2;\n      } else if (this.yAlign === 'bottom') {\n        top = -h;\n      }\n      const x = pixelLocation.x + left;\n      const y = pixelLocation.y + top;\n      // this.element.style.position = 'absolute';\n      // this.element.style.left = `${x}px`;\n      // this.element.style.top = `${y}px`;\n      // this.element.style.visibility = 'visible';\n      // this.element.style.opacity = opacity;\n      const style = `position: absolute; left: ${x}px; top: ${y}px; visibility: visible; opacity: ${opacity};`;\n      const currentStyle = this.element.getAttribute('style');\n      if (style !== currentStyle) {\n        this.element.setAttribute('style', style);\n      }\n      // this.element.classList.remove('figure__hidden');\n    } else {\n      this.element.setAttribute(\n        'style',\n        `position: absolute; left: -10000px; top: -10000px; visibility: hidden; opacity: ${opacity};`,\n      );\n      // this.element.style.position = 'absolute';\n      // this.element.style.left = '-10000px';\n      // this.element.style.top = '-10000px';\n      // // this.element.classList.add('figure__hidden');\n      // this.element.style.visibility = 'hidden';\n      // // this.element.style.visibility = 'hidden';\n      // // console.trace()\n    }\n  }\n\n  drawWithTransformMatrix(transformMatrix: Array<number>, color: TypeColor) {\n    let isDifferent = false;\n    for (let i = 0; i < transformMatrix.length; i += 1) {\n      if (round(transformMatrix[i], 8) !== this.lastMatrix[i]) {\n        isDifferent = true;\n      }\n    }\n    if (isDifferent || this.lastColor[3] !== round(color[3], 8)) {\n      this.transformHtml(transformMatrix, color[3]);\n      this.lastMatrix = round(transformMatrix, 8);\n      this.lastColor = round(color, 8);\n    }\n  }\n}\n\nexport default HTMLObject;\n// Transform -1 to 1 space to 0 to width/height space\n","// @flow\n\nimport * as m2 from '../../../tools/m2';\nimport {\n  Point, getPoint, Rect, getBoundingBorder, getBorder, isBuffer,\n} from '../../../tools/g2';\nimport type { TypeParsablePoint, TypeParsableBuffer } from '../../../tools/g2';\nimport DrawingObject from '../DrawingObject';\nimport DrawContext2D from '../../DrawContext2D';\nimport { joinObjects, splitString } from '../../../tools/tools';\nimport { colorArrayToRGBA } from '../../../tools/color';\nimport type {\n  OBJ_Font, TypeColor,\n} from '../../../tools/types';\nimport type {\n  FunctionMap,\n} from '../../../tools/FunctionMap';\nimport type {\n  OBJ_TextDefinition,\n} from '../../FigurePrimitives/FigurePrimitives';\n\n\n/* eslint-enable max-len */\n\n// FigureFont defines the font properties to be used in a TextObject\nclass FigureFont {\n  size: number;\n  weight: 'normal' | 'bold' | 'lighter' | 'bolder' | '100' | '200' | '300' | '400' | '500' | '600' | '700' | '800' | '900';\n  style: 'normal' | 'italic';\n  family: string;\n  color: TypeColor | null;\n  opacity: number;\n\n  constructor(optionsIn: OBJ_Font | FigureFont = {}) {\n    if (optionsIn instanceof FigureFont) {\n      this.family = optionsIn.family;\n      this.style = optionsIn.style;\n      this.size = optionsIn.size;\n      this.weight = optionsIn.weight;\n      this.opacity = optionsIn.opacity;\n      this.setColor(optionsIn.color);\n      return;\n    }\n    const defaultOptions = {\n      family: 'Times New Roman',\n      style: 'normal',\n      size: 1,\n      weight: '200',\n      color: null,\n      opacity: 1,\n    };\n    const options = joinObjects({}, defaultOptions, optionsIn);\n    this.family = options.family;\n    this.style = options.style;\n    this.size = options.size;\n    this.weight = options.weight;\n    this.opacity = options.opacity;\n    this.setColor(options.color);\n  }\n\n  setColor(color: TypeColor | null = null) {\n    if (color == null) {\n      this.color = color;\n    } else {\n      this.color = color.slice();\n    }\n  }\n\n  definition() {\n    const { color } = this;\n    let colorToUse;\n    if (color == null) {\n      colorToUse = color;\n    } else {\n      colorToUse = color.slice();\n    }\n    return {\n      family: this.family,\n      style: this.style,\n      size: this.size,\n      weight: this.weight,\n      color: colorToUse,\n      opacity: this.opacity,\n    };\n  }\n\n  setFontInContext(ctx: CanvasRenderingContext2D, scalingFactor: number = 1) {\n    ctx.font = `${this.style} ${this.weight} ${this.size * scalingFactor}px ${this.family}`;\n  }\n\n  setColorInContext(ctx: CanvasRenderingContext2D, color: TypeColor | null) {\n    const thisColor = this.color;\n    let { opacity } = this;\n    if (color != null) {\n      opacity *= color[3];\n    }\n    if (thisColor != null) {\n      const c = [\n        ...thisColor.slice(0, 3),\n        thisColor[3] * opacity,\n      ];\n      ctx.fillStyle = colorArrayToRGBA(c);\n    } else if (color != null) {\n      ctx.fillStyle = colorArrayToRGBA(color);\n    }\n  }\n\n  _dup() {\n    return new FigureFont({\n      family: this.family,\n      style: this.style,\n      size: this.size,\n      weight: this.weight,\n      color: this.color,\n      opacity: this.opacity,\n    });\n  }\n}\n\n// FigureText is a single text element of the figure that is drawn at\n// once and referenced to the same location\nclass FigureTextBase {\n  drawContext2D: Array<DrawContext2D>\n  location: Point;\n  locationAligned: Point;\n  text: string;\n  font: FigureFont;\n  xAlign: 'left' | 'center' | 'right';\n  yAlign: 'top' | 'bottom' | 'middle' | 'alphabetic' | 'baseline';\n  lastDrawRect: Rect;\n  bounds: Rect;\n  // borderSetup: 'rect' | Array<Point>;\n  textBorder: Array<Point>;\n  textBorderBuffer: Array<Point>;\n  // touchBorder: number | Array<Point>;\n  touchBorder: TypeParsableBuffer | Array<Point>;\n  // touchBorderSetup: 'rect' | number | 'border' | Array<Point>;\n  // touchBorderSetup: 'rect'\n  onClick: null | (() => void) | string;\n  measure: {\n    ascent: number,\n    descent: number,\n    width: number,\n  };\n\n  lastDraw: {\n    x: number,\n    y: number,\n    width: number,\n    height: number,\n  } | null;\n\n  constructor(\n    drawContext2D: Array<DrawContext2D> | DrawContext2D,\n    location: TypeParsablePoint = new Point(0, 0),\n    text: string = '',\n    font: OBJ_Font = new FigureFont().definition(),\n    xAlign: 'left' | 'center' | 'right' = 'left',\n    yAlign: 'top' | 'bottom' | 'middle' | 'alphabetic' | 'baseline' = 'baseline',\n    // border: 'rect' | Array<Point> = 'rect',\n    // number | Array<Point>\n    // touchBorder: 'rect' | number | 'border' | Array<Point> = 'border',\n    touchBorder: TypeParsableBuffer | Array<Point> = 0,\n    onClick?: string | (() => void) | null = null,\n    // runUpdate: boolean = true,\n  ) {\n    this.location = getPoint(location)._dup();\n    this.locationAligned = this.location._dup();\n    this.text = text.slice();\n    this.font = new FigureFont(font);\n    this.xAlign = xAlign;\n    this.yAlign = yAlign;\n    this.lastDraw = null;\n    this.lastDrawRect = new Rect(0, 0, 1, 1);\n    if (Array.isArray(drawContext2D)) {\n      this.drawContext2D = drawContext2D;\n    } else {\n      this.drawContext2D = [drawContext2D];\n    }\n    // this.touchBorderSetup = touchBorder;\n    this.touchBorder = touchBorder;\n    // this.borderSetup = border;\n    this.onClick = onClick;\n  }\n\n  measureAndAlignText() {\n    this.measureText();\n    this.alignText();\n  }\n\n  calcBorderAndBounds() {\n    this.calcBounds();\n    this.calcBorder();\n    this.calcTouchBorder();\n  }\n\n  setText(options: string | OBJ_TextDefinition) {\n    if (typeof options === 'string') {\n      this.text = options.slice();\n    } else {\n      if (options.location != null) {\n        // eslint-disable-next-line no-param-reassign\n        options.location = getPoint(options.location);\n      }\n      joinObjects(this, options);\n    }\n    this.measureAndAlignText();\n    this.calcBorderAndBounds();\n  }\n\n  // deprecated\n  // setText(text: string) {\n  //   this.text = text.slice();\n  //   this.measureAndAlignText();\n  //   this.calcBorderAndBounds();\n  // }\n\n  setFont(font: OBJ_Font) {\n    const newFont = joinObjects({}, this.font.definition(), font);\n    this.font = new FigureFont(newFont);\n    this.measureAndAlignText();\n  }\n\n  // // deprecated\n  // setXAlign(xAlign: 'left' | 'center' | 'right') {\n  //   this.xAlign = xAlign;\n  //   this.alignText();\n  //   this.calcBounds();\n  //   this.calcBorder();\n  //   this.calcTouchBorder();\n  // }\n\n  // // deprecated\n  // setYAlign(yAlign: 'top' | 'bottom' | 'middle' | 'alphabetic' | 'baseline') {\n  //   this.yAlign = yAlign;\n  //   this.alignText();\n  //   this.calcBounds();\n  //   this.calcBorder();\n  //   this.calcTouchBorder();\n  // }\n\n  _dup() {\n    return new this.constructor(\n      this.drawContext2D,\n      this.location,\n      this.text,\n      this.font.definition(),\n      this.xAlign,\n      this.yAlign,\n    );\n  }\n\n  // This method is used instead of the actual ctx.measureText because\n  // Firefox and Chrome don't yet support it's collections features.\n  // Estimates are made for height based on width.\n  // eslint-disable-next-line class-methods-use-this\n  measureText(\n    ctx: CanvasRenderingContext2D = this.drawContext2D[0].ctx,\n    scalingFactor: number = 20 / this.font.size,\n  ) {\n    this.font.setFontInContext(ctx, scalingFactor);\n    const fontHeight = ctx.font.match(/[^ ]*px/);\n    let aWidth;\n    if (fontHeight != null) {\n      aWidth = parseFloat(fontHeight[0]) / 2;\n    } else {\n      aWidth = ctx.measureText('a').width;\n    }\n    // console.log(aWidth)\n    // Estimations of FONT ascent and descent for a baseline of \"alphabetic\"\n    let ascent = aWidth * 1.4;\n    let descent = aWidth * 0.08;\n\n    // Uncomment below and change above consts to lets if more resolution on\n    // actual text boundaries is needed\n\n    // const maxAscentRe =\n    //   /[ABCDEFGHIJKLMNOPRSTUVWXYZ1234567890!#%^&()@$Qbdtfhiklj]/g;\n    const midAscentRe = /[acemnorsuvwxz*gyqp]/g;\n    const midDecentRe = /[;,$]/g;\n    let maxDescentRe = /[gjyqp@Q(){}[\\]|]/g;\n    if (this.font.family === 'Times New Roman') {\n      if (this.font.style === 'italic') {\n        maxDescentRe = /[gjyqp@Q(){}[\\]|f]/g;\n      }\n    }\n\n    const midAscentMatches = this.text.match(midAscentRe);\n    if (Array.isArray(midAscentMatches)) {\n      if (midAscentMatches.length === this.text.length) {\n        ascent = aWidth * 0.95;\n      }\n    }\n\n    const midDescentMatches = this.text.match(midDecentRe);\n    if (Array.isArray(midDescentMatches)) {\n      if (midDescentMatches.length > 0) {\n        descent = aWidth * 0.2;\n      }\n    }\n\n    const maxDescentMatches = this.text.match(maxDescentRe);\n    if (Array.isArray(maxDescentMatches)) {\n      if (maxDescentMatches.length > 0) {\n        descent = aWidth * 0.5;\n      }\n    }\n    // const height = ascent + descent;\n\n    const { width } = ctx.measureText(this.text);\n    this.measure = {\n      ascent: ascent / scalingFactor,\n      descent: descent / scalingFactor,\n      width: width / scalingFactor,\n    };\n    return this.measure;\n  }\n\n  alignText() {\n    const location = this.location._dup();\n    if (this.xAlign === 'center') {\n      location.x -= this.measure.width / 2;\n    } else if (this.xAlign === 'right') {\n      location.x -= this.measure.width;\n    }\n    if (this.yAlign === 'bottom') {\n      location.y += this.measure.descent;\n    } else if (this.yAlign === 'middle') {\n      location.y += this.measure.descent - (this.measure.ascent + this.measure.descent) / 2;\n    } else if (this.yAlign === 'top') {\n      location.y -= this.measure.ascent;\n    }\n    this.locationAligned = location._dup();\n  }\n\n  calcBounds() {\n    this.bounds = new Rect(\n      this.locationAligned.x,\n      this.locationAligned.y - this.measure.descent,\n      this.measure.width,\n      this.measure.ascent + this.measure.descent,\n    );\n  }\n\n  getBoundary(\n    transformMatrix: Array<number> | null,\n  ): Array<Point> {\n    if (transformMatrix == null) {\n      return this.textBorder;\n    }\n    const boundary = [];\n    this.textBorder.forEach((p) => {\n      boundary.push(p.transformBy(transformMatrix));\n    });\n    return boundary;\n  }\n\n  calcBorder() {\n    // if (this.borderSetup === 'rect') {\n    this.textBorder = [\n      new Point(this.bounds.left, this.bounds.bottom),\n      new Point(this.bounds.right, this.bounds.bottom),\n      new Point(this.bounds.right, this.bounds.top),\n      new Point(this.bounds.left, this.bounds.top),\n    ];\n    // } else {\n    //   this.border = this.borderSetup;\n    // }\n  }\n\n  calcTouchBorder() {\n    if (isBuffer(this.touchBorder)) { // $FlowFixMe\n      this.textBorderBuffer = getBoundingBorder(this.textBorder, this.touchBorder);\n    // }\n    // if (\n    //   typeof this.touchBorder === 'number'\n    //   || (\n    //     Array.isArray(this.touchBorder)\n    //     && typeof (this.touchBorder[0]) === 'number'\n    //   )\n    // ) {\n    //   this.textBorderBuffer = getBoundingBorder(this.textBorder, this.touchBorder);\n    } else { // $FlowFixMe\n      this.textBorderBuffer = this.touchBorder;\n    }\n  }\n}\n\n// FigureText is a single text element of the figure that is drawn at\n// once and referenced to the same location\nclass FigureText extends FigureTextBase {\n  constructor(\n    drawContext2D: Array<DrawContext2D> | DrawContext2D,\n    location: TypeParsablePoint = new Point(0, 0),\n    text: string = '',\n    font: OBJ_Font = new FigureFont().definition(),\n    xAlign: 'left' | 'center' | 'right' = 'left',\n    yAlign: 'top' | 'bottom' | 'middle' | 'alphabetic' | 'baseline' = 'baseline',\n    // border: 'rect' | Array<Point> = 'rect',\n    // touchBorder: 'rect' | number | 'border' | Array<Point> = 'border',\n    touchBorder: TypeParsableBuffer | Array<Point> = 0,\n    onClick?: string | (() => void) | null = null,\n    // runUpdate: boolean = true,\n  ) {\n    super(drawContext2D, location, text, font, xAlign, yAlign, touchBorder, onClick);\n    this.measureAndAlignText();\n    this.calcBorderAndBounds();\n  }\n}\n\nclass FigureTextLine extends FigureTextBase {\n  offset: Point;\n  inLine: boolean;\n  followOffsetY: boolean;\n  rSpace: number;\n  lSpace: number;\n\n  constructor(\n    drawContext2D: Array<DrawContext2D> | DrawContext2D,\n    location: TypeParsablePoint = new Point(0, 0),\n    text: string = '',\n    font: OBJ_Font = new FigureFont().definition(),\n    offset: TypeParsablePoint = new Point(0, 0),\n    inLine: boolean = true,\n    // border: 'rect' | Array<Point> = 'rect',\n    // touchBorder: 'rect' | number | 'border' | Array<Point> = 'border',\n    touchBorder: TypeParsableBuffer | Array<Point> = 0,\n    onClick?: string | (() => void) | null = null,\n    followOffsetY?: boolean = false,\n    lSpace?: number = 0,\n    rSpace?: number = 0,\n  ) {\n    super(drawContext2D, location, text, font, 'left', 'baseline', touchBorder, onClick);\n    this.offset = getPoint(offset);\n    this.inLine = inLine;\n    this.followOffsetY = followOffsetY;\n    this.lSpace = lSpace;\n    this.rSpace = rSpace;\n    this.measureAndAlignText();\n    this.calcBorderAndBounds();\n  }\n\n  alignText() {\n    const location = this.location._dup();\n    this.locationAligned = location.add(this.offset);\n  }\n\n  _dup() {\n    return new FigureTextLine(\n      this.drawContext2D,\n      this.location,\n      this.text,\n      this.font.definition(),\n      this.offset,\n      this.inLine,\n      this.touchBorder,\n      this.onClick,\n      this.followOffsetY,\n      this.rSpace,\n      this.lSpace,\n    );\n  }\n}\n\nclass FigureTextLines extends FigureTextLine {\n  line: number;\n\n  constructor(\n    drawContext2D: Array<DrawContext2D> | DrawContext2D,\n    location: TypeParsablePoint = new Point(0, 0),\n    text: string = '',\n    font: OBJ_Font = new FigureFont().definition(),\n    offset: TypeParsablePoint = new Point(0, 0),\n    inLine: boolean = true,\n    line: number,\n    // border: 'rect' | Array<Point> = 'rect',\n    // touchBorder: 'rect' | number | 'border' | Array<Point> = 'border',\n    touchBorder: TypeParsableBuffer | Array<Point> = 0,\n    onClick?: string | (() => void) | null = null,\n    followOffsetY?: boolean = false,\n    lSpace?: number = 0,\n    rSpace?: number = 0,\n  ) {\n    super(\n      drawContext2D, location, text, font, offset, inLine, touchBorder,\n      onClick, followOffsetY, lSpace, rSpace,\n    );\n    this.line = line;\n    // this.update();\n  }\n\n  _dup() {\n    return new FigureTextLines(\n      this.drawContext2D,\n      this.location,\n      this.text,\n      this.font.definition(),\n      this.offset,\n      this.inLine,\n      this.line,\n      this.touchBorder,\n      this.onClick,\n      this.followOffsetY,\n      this.lSpace,\n      this.rSpace,\n    );\n  }\n}\n\n// Order of definition:\n// * Constructor - setup empty structures\n// * loadText\n//    - calculateScalingFactor\n//    - setTextLocations - lays out text from location property or in line\n//    - calcBoundsAndBorder\nclass TextObjectBase extends DrawingObject {\n  drawContext2D: Array<DrawContext2D>\n  text: Array<FigureTextBase>;\n  scalingFactor: number;\n  lastDrawTransform: Array<number>;\n\n  textBorder: Array<Array<Point>>;\n  textBorderBuffer: Array<Array<Point>>;\n  // borderSetup: 'text' | 'rect' | Array<Point>;\n  // touchBorderSetup: 'text' | 'rect' | 'border' | number | Array<Point>;\n\n  constructor(\n    drawContext2D: Array<DrawContext2D> | DrawContext2D,\n  ) {\n    super();\n\n    if (Array.isArray(drawContext2D)) {\n      this.drawContext2D = drawContext2D;\n    } else {\n      this.drawContext2D = [drawContext2D];\n    }\n    this.lastDrawTransform = [1, 0, 0, 0, 1, 0, 0, 0, 1];\n    this.text = [];\n    // this.state = 'loaded';\n  }\n\n  // eslint-disable-next-line no-unused-vars\n  loadText(options: Object) {\n    // Assign text to this.text here\n    // this.text = options.text\n    // Calculate Scaling Factor\n    this.calcScalingFactor();\n    // Layout text and calculat boundaries\n    this.layoutText();\n  }\n\n  // calcTextBounds() {\n  //   this.text.forEach((t) => {\n  //     t.calcBorderAndBounds();\n  //   });\n  // }\n\n  // eslint-disable-next-line class-methods-use-this\n  setTextLocations() {\n  }\n\n  click(p: Point, fnMap: FunctionMap) {\n    this.text.forEach((text) => {\n      if (text.onClick != null) {\n        // console.log(text.touchBorder, lastDrawTransformMatrix)\n        // const glBorder = this.transformBorder([text.touchBorder], lastDrawTransformMatrix);\n        // console.log(glBorder)\n        if (p.isInPolygon(text.textBorderBuffer)) {\n          fnMap.exec(text.onClick, fnMap);\n        }\n      }\n    });\n  }\n\n  calcScalingFactor() {\n    let scalingFactor = 1;\n    if (this.text.length > 0) {\n      let minSize = this.text[0].font.size;\n      this.text.forEach((t) => {\n        if (t.font.size > 0 && t.font.size < minSize) {\n          minSize = t.font.size;\n        }\n      });\n      scalingFactor = 20 / minSize;\n    }\n    this.scalingFactor = scalingFactor;\n  }\n\n  setText(textOrOptions: string | OBJ_TextDefinition, index: number = 0) {\n    this.clear();\n    this.text[index].setText(textOrOptions);\n    this.setBorder();\n    this.setTouchBorder();\n    // this.layoutText();\n  }\n\n  // setText(text: string, index: number = 0) {\n  //   this.text[index].setText(text);\n  //   this.setBorder();\n  //   this.setTouchBorder();\n  // }\n\n  _dup() {\n    const c = new TextObjectBase(this.drawContext2D);\n    return c;\n  }\n\n  setFont(font: OBJ_Font, index: null | number = 0) {\n    this.clear();\n    if (index === null) {\n      for (let i = 0; i < this.text.length; i += 1) {\n        this.text[i].setFont(font);\n      }\n    } else {\n      this.text[index].setFont(font);\n    }\n    this.layoutText();\n  }\n\n  setOpacity(opacity: number, index: null | number = 0) {\n    this.clear();\n    if (index === null) {\n      for (let i = 0; i < this.text.length; i += 1) {\n        this.setFont({ opacity }, i);\n      }\n    } else {\n      this.setFont({ opacity }, index);\n    }\n  }\n\n  setColor(color: TypeColor, index: null | number = null) {\n    if (index === null) {\n      for (let i = 0; i < this.text.length; i += 1) {\n        this.text[i].font.color = color.slice();\n      }\n    } else {\n      this.text[index].font.color = color.slice();\n    }\n  }\n\n  layoutText() {\n    this.setTextLocations();\n    this.text.forEach((t) => {\n      t.calcBorderAndBounds();\n    });\n    this.setBorder();\n    this.setTouchBorder();\n  }\n\n  // setGenericBorder(name: string) {\n  //   // $FlowFixMe\n  //   if (Array.isArray(this[`${name}Setup`])) {  // $FlowFixMe\n  //     this[name] = this[`${name}Setup`];\n  //     return;\n  //   }\n  //   const border = [];\n  //   this.text.forEach((text) => {\n  //     border.push(  // $FlowFixMe\n  //       text[name],\n  //     );\n  //   }); // $FlowFixMe\n  //   if (this[`${name}Setup`] === 'text') {  // $FlowFixMe\n  //     this[name] = border;\n  //     return;\n  //   }  // $FlowFixMe\n  //   const bounds = getBoundingRect(border);  // $FlowFixMe\n  //   if (this[`${name}Setup`] === 'rect') {  // $FlowFixMe\n  //     this[name] = [[\n  //       new Point(bounds.left, bounds.bottom),\n  //       new Point(bounds.right, bounds.bottom),\n  //       new Point(bounds.right, bounds.top),\n  //       new Point(bounds.left, bounds.top),\n  //     ]];\n  //     return;\n  //   }  // $FlowFixMe\n  //   const buffer = this[`${name}Setup`];  // $FlowFixMe\n  //   this[name] = [[\n  //     new Point(bounds.left - buffer, bounds.bottom - buffer),\n  //     new Point(bounds.right + buffer, bounds.bottom - buffer),\n  //     new Point(bounds.right + buffer, bounds.top + buffer),\n  //     new Point(bounds.left - buffer, bounds.top + buffer),\n  //   ]];\n  // }\n\n  setBorder() {\n    // this.setGenericBorder('border');\n    this.textBorder = [];\n    this.text.forEach((text) => {\n      this.textBorder.push(text.textBorder);\n    });\n  }\n\n  setTouchBorder() {\n    this.textBorderBuffer = [];\n    this.text.forEach((text) => {\n      this.textBorderBuffer.push(text.textBorderBuffer);\n    });\n\n    // if (this.touchBorderSetup === 'border') {\n    //   this.touchBorder = this.border;\n    //   return;\n    // }\n    // this.setGenericBorder('touchBorder');\n    // console.log(this.touchBorderSetup, this.touchBorder)\n  }\n\n  // getBoundaries(\n  //   transformMatrix: Array<number>,\n  // ): Array<Array<Point>> {\n  //   const boundaries: Array<Array<Point>> = [];\n  //   this.text.forEach((t) => {\n  //     boundaries.push(t.getBoundary(transformMatrix));\n  //   });\n  //   return boundaries;\n  // }\n\n  // Text is drawn in pixel space which is 0, 0 in the left hand top corner on\n  // a canvas of size canvas.offsetWidth x canvas.offsetHeight.\n  //\n  // Font size and text location is therefore defined in pixels in Context2D.\n  //\n  // However, in a Figure, the text canvas is overlaid on the figure GL\n  // canvas and we want to think about the size and location of text in\n  // Figure Space or Element Space (if the element has a specific transform).\n  //\n  // For example, if we have a figure with limits: min: (0, 0), max(2, 1)\n  // with a canvas of 1000 x 500 then:\n  //    1) Transform pixel space (1000 x 500) to be GL Space (2 x 2). i.e.\n  //         - Magnify pixel space by 500 so one unit in the 2D drawing\n  //           context is equivalent to 1 unit in GL Space.\n  //         - Translate pixel space so 0, 0 is in the middle of the canvas\n  //    2) Transform GL Space to Element Space\n  //         - The transform matrix in the input parameters includes the\n  //           transform to Figure Space and then Element Space.\n  //         - Now one unit in the 2D drawing context is equivalent to 1 unit\n  //           in Element Space - i.e. the canvas will have limits of min(0, 0)\n  //           and max(2, 1).\n  //    3) Plot out all text\n  //\n  // However, when font size is defined in Element Space, and ends up being\n  // <1 Element Space units, we have a problem. This is because font size is\n  // still in pixels (just now it's super scaled up). Therefore, a scaling\n  // factor is needed to make sure the font size can stay well above 1. This\n  // scaling factor scales the final space, so a larger font size can be used.\n  // Then all locations defined in Element Space also need to be scaled by\n  // this scaling factor.\n  //\n  // The scaling factor can be number that is large enough to make it so the\n  // font size is >>1. In the TextObject constructor, the scaling factor is\n  // designed to ensure drawn text always is >20px.\n  //\n  // Therefore the different spaces are:\n  //   - pixelSpace - original space of the 2D canvas\n  //   - elementSpace - space of the FigureElementPrimitive that holds text\n  //   - scaledPixelSpace\n  //\n  drawWithTransformMatrix(\n    transformMatrix: Array<number>,\n    color: TypeColor = [1, 1, 1, 1],\n    contextIndex: number = 0,\n  ) {\n    const drawContext2D = this.drawContext2D[contextIndex];\n    const { ctx } = this.drawContext2D[contextIndex];\n    ctx.save();\n\n    // Scaling factor used to ensure font size is >> 1 pixel\n    const { scalingFactor } = this;\n\n    // Find the scaling factor between GL space (width 2, height 2) and canvas\n    // pixel space (width offsetWidth, height offsetHeight)\n    // This is how much we will zoom in on our ctx so one GL unit is\n    // one pixel unit\n    const sx = drawContext2D.canvas.offsetWidth / 2;\n    const sy = drawContext2D.canvas.offsetHeight / 2;\n\n    // GL space (0, 0) is the center of the canvas, and Pixel Space (0, 0)\n    // is the top left of the canvas. Therefore, translate pixel space so\n    // if we put in (0, 0) we actually draw to the center of the canvas\n    const tx = drawContext2D.canvas.offsetWidth / 2;\n    const ty = drawContext2D.canvas.offsetHeight / 2;\n\n    // So our GL to Pixel Space matrix is now:\n    const glToPixelSpaceMatrix = [\n      sx, 0, tx,\n      0, sy, ty,\n      0, 0, 1,\n    ];\n\n    // The incoming transform matrix transforms elementSpace to glSpace.\n    // Modify the incoming transformMatrix to be compatible with\n    // pixel space\n    //   - Flip the y translation\n    //   - Reverse rotation\n    const tm = transformMatrix;\n    const elementToGLMatrix = [\n      tm[0], -tm[1], tm[2],\n      -tm[3], tm[4], tm[5] * -1,\n      0, 0, 1,\n    ];\n\n    // Combine the elementToGL transform and glToPixel transforms\n    // A X B is apply B then apply A, so apply element to GL, then GL to Pixel\n    const elementToPixelMatrix = m2.mul(glToPixelSpaceMatrix, elementToGLMatrix);\n\n    // At this point in time the ctx will be zoomed in such that every 1 unit\n    // of element space is 1 pixel/unit in ctx space. But because font sizes\n    // need to be >1px, we are going to scale out so we can use a font size of\n    // ~20px.\n    const pixelToScaledPixelMatrix = [\n      1 / scalingFactor, 0, 0,\n      0, 1 / scalingFactor, 0,\n      0, 0, 1,\n    ];\n\n    const elementToScaledPixelMatrix = m2.mul(\n      elementToPixelMatrix, pixelToScaledPixelMatrix,\n    );\n\n    // The ctx transform is defined in a different order:\n    const cA = elementToScaledPixelMatrix[0];\n    const cB = elementToScaledPixelMatrix[3];\n    const cC = elementToScaledPixelMatrix[1];\n    const cD = elementToScaledPixelMatrix[4];\n    const cE = elementToScaledPixelMatrix[2];\n    const cF = elementToScaledPixelMatrix[5];\n\n    // Apply the transform to the ctx. We are now in Scaled\n    ctx.transform(cA, cB, cC, cD, cE, cF);\n    this.lastDrawTransform = elementToScaledPixelMatrix.slice();\n\n    // Some bug I don't understand in webgl is effectively cubing the alph\n    // channel. So make the same here to fade-ins happen at same rate\n    const c = color.slice();\n    c[3] *= c[3] * c[3];\n\n    // Fill in all the text\n    this.text.forEach((figureText) => {\n      // eslint-disable-next-line no-param-reassign\n      figureText.lastDraw = {\n        x: (figureText.locationAligned.x) * scalingFactor,\n        y: (figureText.locationAligned.y) * -scalingFactor,\n        width: figureText.bounds.width * scalingFactor,\n        height: figureText.bounds.height * scalingFactor,\n      };\n      figureText.font.setFontInContext(ctx, scalingFactor);\n      figureText.font.setColorInContext(ctx, c);\n      ctx.fillText(\n        figureText.text,\n        (figureText.locationAligned.x) * scalingFactor,\n        (figureText.locationAligned.y) * -scalingFactor,\n      );\n    });\n    ctx.restore();\n  }\n\n  clear(contextIndex: number = 0) {\n    const { ctx } = this.drawContext2D[contextIndex];\n    const t = this.lastDrawTransform;\n    ctx.save();\n    ctx.transform(t[0], t[3], t[1], t[4], t[2], t[5]);\n    // console.log('start clear');\n    this.text.forEach((figureText) => {\n      // const x = figureText.locationAligned.x * this.scalingFactor;\n      // const y = figureText.locationAligned.y * -this.scalingFactor;\n      // const width = figureText.bounds.width * this.scalingFactor;\n      // const height = figureText.bounds.height * this.scalingFactor;\n      if (figureText.lastDraw != null) {\n        const {\n          x, y, width, height,\n        } = figureText.lastDraw;\n        ctx.clearRect(\n          x - width * 0.5, y + height * 0.5, width * 2, -height * 2,\n          // x - width * 1,\n          // y + height * 1,\n          // width * 3,\n          // -height * 3,\\\n        );\n        // ctx.rect(\n        //   x - width * 0.5, y + height * 0.5, width * 2, -height * 2,\n        //   // (figureText.locationAligned.x) * scalingFactor,\n        //   // (figureText.locationAligned.y) * -scalingFactor,\n        // );\n        // ctx.fill();\n        // eslint-disable-next-line no-param-reassign\n        figureText.lastDraw = null;\n      }\n    });\n    ctx.restore();\n  }\n\n  _getStateProperties() {  // eslint-disable-line class-methods-use-this\n    return [\n      ...super._getStateProperties(),\n    ];\n  }\n}\n\n// TextObject is the DrawingObject used in the FigureElementPrimitive.\n// TextObject will draw an array of FigureText objects.\nclass TextObject extends TextObjectBase {\n  loadText(\n    options: {\n      text: string\n        | {\n            text: string,\n            font?: OBJ_Font,\n            location?: TypeParsablePoint,\n            xAlign?: 'left' | 'right' | 'center',\n            yAlign?: 'bottom' | 'baseline' | 'middle' | 'top',\n            // border?: 'rect' | Array<Point>,\n            // touchBorder?: 'rect' | number | 'border' | Array<Point>,\n            touchBorder?: TypeParsableBuffer | Array<Point>,\n            onClick?: string | () => void,\n        }\n        | Array<string | {\n        text: string,\n        font?: OBJ_Font,\n        location?: TypeParsablePoint,\n        xAlign?: 'left' | 'right' | 'center',\n        yAlign?: 'bottom' | 'baseline' | 'middle' | 'top',\n        // border?: 'rect' | Array<Point>,\n        // touchBorder?: 'rect' | number | 'border' | Array<Point>,\n        touchBorder?: TypeParsableBuffer | Array<Point>,\n        onClick?: string | () => void,\n      }>;\n      font: OBJ_Font,                    // default font\n      xAlign: 'left' | 'right' | 'center',                // default xAlign\n      yAlign: 'bottom' | 'baseline' | 'middle' | 'top',   // default yAlign\n      // border?: 'text' | 'rect' | Array<Point>,\n      // touchBorder?: 'text' | 'rect' | number | 'border' | Array<Point>,\n      defaultTextTouchBorder?: number,\n      color: TypeColor\n    },\n  ) {\n    let textArray = options.text;\n    if (!Array.isArray(textArray)) {\n      textArray = [textArray];\n    }\n    const figureTextArray = [];\n    textArray.forEach((textDefinition) => {\n      let font;\n      let location;\n      let xAlign;\n      let yAlign;\n      let textToUse;\n      // let border;\n      let touchBorder;\n      let onClick;\n      if (typeof textDefinition === 'string') {\n        textToUse = textDefinition;\n      } else {\n        ({\n          font, location, xAlign, yAlign, touchBorder, onClick,\n        } = textDefinition);\n        textToUse = textDefinition.text;\n        // if (Array.isArray(border)) {  // $FlowFixMe\n        //   border = getPoints(border);\n        // }\n        // if (Array.isArray(touchBorder)) {  // $FlowFixMe\n        //   touchBorder = getPoints(touchBorder);\n        // }\n      }\n      let locationToUse;\n      if (location == null) {\n        locationToUse = new Point(0, 0);\n      } else {\n        locationToUse = getPoint(location);\n      }\n      let fontToUse = options.font;\n      if (font != null) {\n        fontToUse = font;\n      }\n      if (\n        touchBorder != null\n        && Array.isArray(touchBorder)\n        && !isBuffer(touchBorder)\n      ) { // $FlowFixMe\n        [touchBorder] = getBorder(touchBorder);\n      }\n      const fontDefinition = joinObjects({}, options.font, fontToUse);\n      figureTextArray.push(new FigureText(\n        this.drawContext2D,\n        locationToUse,  // $FlowFixMe\n        textToUse,\n        fontDefinition,\n        xAlign || options.xAlign,\n        yAlign || options.yAlign, // $FlowFixMe\n        touchBorder || options.defaultTextTouchBorder,\n        onClick,\n      ));\n    });\n    this.text = figureTextArray;\n    // super.loadText();\n    this.calcScalingFactor();\n    // this.borderSetup = options.border || [];\n    // this.touchBorderSetup = options.touchBorder || [];\n    this.layoutText();\n  }\n\n  _dup() {\n    const c = new TextObject(this.drawContext2D); // $FlowFixMe\n    c.text = this.text.map(t => t._dup());\n    c.scalingFactor = this.scalingFactor;\n    c.layoutText();\n    return c;\n  }\n}\n\nfunction createLine(\n  textArray: Array<FigureTextLine> | Array<FigureTextLines>,\n  initialLocation = new Point(0, 0),\n) {\n  let lastRight = initialLocation;\n  let maxY = 0;\n  let minY = 0;\n  textArray.forEach((text) => {  // eslint-disable-next-line no-param-reassign\n    text.location = lastRight.add(text.offset).add(text.lSpace);\n    if (text.inLine) {\n      if (text.followOffsetY) {\n        lastRight = text.location.add(text.measure.width + text.rSpace, 0);\n      } else {\n        lastRight = text.location.add(text.measure.width + text.rSpace, -text.offset.y);\n      }\n      const textMaxY = text.location.y + text.measure.ascent;\n      const textMinY = text.location.y - text.measure.descent;\n      if (textMaxY > maxY) {\n        maxY = textMaxY;\n      }\n      if (textMinY < minY) {\n        minY = textMinY;\n      }\n    }\n  });\n  const width = lastRight.x - 0;\n  return { width, minY, maxY };\n}\n\nfunction align(\n  textArray: Array<FigureTextLine> | Array<FigureTextLines>,\n  xAlign: 'left' | 'center' | 'right',\n  yAlign: 'bottom' | 'baseline' | 'alphabetic' | 'middle' | 'top',\n  width: number,\n  minY: number,\n  maxY: number,\n  // useLocation: boolean = false,\n) {\n  const locationAlignOffset = new Point(0, 0);\n  if (xAlign === 'center') {\n    locationAlignOffset.x -= width / 2;\n  } else if (xAlign === 'right') {\n    locationAlignOffset.x -= width;\n  }\n  if (yAlign === 'bottom') {\n    locationAlignOffset.y -= minY;\n  } else if (yAlign === 'middle') {\n    locationAlignOffset.y += -minY - (maxY - minY) / 2;\n  } else if (yAlign === 'top') {\n    locationAlignOffset.y -= maxY;\n  }\n  textArray.forEach((text) => {  // eslint-disable-next-line no-param-reassign\n    text.locationAligned = text.location.add(locationAlignOffset);\n  });\n}\n\nclass TextLineObject extends TextObjectBase {\n  // $FlowFixMe\n  text: Array<FigureTextLine>;\n  xAlign: 'left' | 'right' | 'center';                // default xAlign\n  yAlign: 'bottom' | 'baseline' | 'middle' | 'top';   // default yAlign\n\n  // $FlowFixMe\n  loadText(\n    options: {\n      text: Array<string | {\n        text: string,\n        font?: OBJ_Font,\n        offset?: TypeParsablePoint,\n        inLine?: boolean,\n        // onClick?: () => void,\n        // border?: 'rect' | Array<Point>,\n        // touchBorder?: 'rect' | number | Array<Point>,\n        // border?: 'rect' | Array<Point>,\n        touchBorder?: number | Array<Point>,\n        onClick?: string | () => void,\n        followOffsetY?: boolean,\n        lSpace?: number,\n        rSpace?: number,\n      }>;\n      font: OBJ_Font,                    // default font\n      xAlign: 'left' | 'right' | 'center',                // default xAlign\n      yAlign: 'bottom' | 'baseline' | 'middle' | 'top',   // default yAlign\n      color: TypeColor,\n      defaultTextTouchBorder?: TypeParsableBuffer,\n      // border?: 'rect' | Array<Point>,\n      // touchBorder?: 'rect' | number | 'border' | Array<Point>,\n      // onClick?: string | () => void,\n    },\n  ) {\n    let textArray = options.text;\n    if (!Array.isArray(textArray)) {\n      textArray = [textArray];\n    }\n    const figureTextArray = [];\n    textArray.forEach((textDefinition) => {\n      let font;\n      let offset;\n      let inLine;\n      let followOffsetY;\n      let textToUse;\n      // let border;\n      let touchBorder;\n      let onClick;\n      let lSpace;\n      let rSpace;\n      if (typeof textDefinition === 'string') {\n        textToUse = textDefinition;\n      } else {\n        ({\n          font, offset, inLine, touchBorder, onClick, followOffsetY,\n          lSpace, rSpace,\n        } = textDefinition);\n        textToUse = textDefinition.text;\n        // if (Array.isArray(border)) {  // $FlowFixMe\n        //   border = getPoints(border);\n        // }\n        // if (Array.isArray(touchBorder)) {  // $FlowFixMe\n        //   touchBorder = getBorder(touchBorder);\n        // }\n        if (\n          touchBorder != null\n          && Array.isArray(touchBorder)\n          && !isBuffer(touchBorder)\n        ) { // $FlowFixMe\n          [touchBorder] = getBorder(touchBorder);\n        }\n      }\n      let offsetToUse;\n      if (offset == null) {\n        offsetToUse = new Point(0, 0);\n      } else {\n        offsetToUse = getPoint(offset);\n      }\n      let fontToUse = options.font;\n      if (font != null) {\n        fontToUse = font;\n      }\n      const fontDefinition = joinObjects({}, options.font, fontToUse);\n      if (fontDefinition.color == null && options.color != null) {\n        fontDefinition.color = options.color;\n      }\n\n      figureTextArray.push(new FigureTextLine(\n        this.drawContext2D,\n        new Point(0, 0),\n        textToUse,\n        fontDefinition,\n        offsetToUse,\n        inLine, // $FlowFixMe\n        touchBorder || options.defaultTextTouchBorder,\n        onClick,\n        followOffsetY,\n        lSpace,\n        rSpace,\n      ));\n    });\n    this.text = figureTextArray;\n    this.xAlign = options.xAlign;\n    this.yAlign = options.yAlign;\n    this.calcScalingFactor();\n    // this.borderSetup = options.border || [];\n    // this.touchBorderSetup = options.touchBorder || [];\n    this.layoutText();\n  }\n\n  setText(textOrOptions: string | OBJ_TextDefinition, index: number = 1) {\n    // if (textOrOptions.text.startsWith('abc')) {\n    // }\n    this.text[index].setText(textOrOptions);\n    this.layoutText();\n    // this.setBorder();\n    // this.setTouchBorder();\n  }\n\n  setTextLocations() {\n    const { width, minY, maxY } = createLine(this.text);\n    align(this.text, this.xAlign, this.yAlign, width, minY, maxY);\n  }\n\n  _dup() {\n    const c = new TextLineObject(this.drawContext2D);\n    c.text = this.text.map(t => t._dup());\n    c.scalingFactor = this.scalingFactor;\n    c.xAlign = this.xAlign;\n    c.yAlign = this.yAlign;\n    c.layoutText();\n    return c;\n  }\n}\n\nclass TextLinesObject extends TextObjectBase {\n  // $FlowFixMe\n  line: Array<FigureTextLines>;\n  xAlign: 'left' | 'right' | 'center';                // default xAlign\n  yAlign: 'bottom' | 'baseline' | 'middle' | 'top';   // default yAlign\n  lines: Array<{\n    justify: 'left' | 'right' | 'center',\n    space: number,\n    text: Array<FigureTextLines>;\n    width: number,\n  }>;\n\n  modifiers: {\n    [modifierName: string]: {\n      text?: string,\n        offset?: TypeParsablePoint,\n        inLine?: boolean,\n        font?: OBJ_Font,\n        // border?: 'rect' | Array<Point>,\n        // touchBorder?: 'border' | 'rect' | number | Array<Point>,\n        touchBorder?: TypeParsableBuffer | Array<Point>,\n        onClick?: () => void,\n        lSpace?: number,\n        rSpace?: number,\n        followOffsetY?: boolean,\n    },\n  };\n\n  // $FlowFixMe\n  loadText(\n    options: {\n    text: Array<string | {\n      text: string,\n      font?: OBJ_Font,\n      justify?: 'left' | 'center' | 'right',\n      lineSpace?: number\n    }>,\n    modifiers: {\n      [modifierName: string]: {\n        text?: string,\n        offset?: TypeParsablePoint,\n        inLine?: boolean,\n        font?: OBJ_Font,\n        // border?: 'rect' | Array<Point>,\n        touchBorder?: TypeParsableBuffer | Array<Point>,\n        onClick?: () => void,\n        followOffsetY?: boolean,\n        lSpace?: number,\n        rSpace?: number,\n      },\n    },\n    defaultTextTouchBorder?: number,\n    font: OBJ_Font,\n    justify: 'left' | 'center' | 'right',\n    lineSpace: number,\n    xAlign: 'left' | 'right' | 'center',\n    yAlign: 'bottom' | 'baseline' | 'middle' | 'top',\n    color: TypeColor,\n    // border?: 'rect' | Array<Point>,\n    // touchBorder?: 'rect' | number | 'border' | Array<Point>,\n  },\n  ) {\n    // console.log('asdfasdf')\n    // let { lines } = options;\n    let textLines = options.text;\n    if (typeof textLines === 'string') {\n      textLines = [textLines];\n    }\n    this.modifiers = options.modifiers || {};\n    this.lines = [];\n    const figureTextArray = [];\n\n    textLines.forEach((lineDefinition, lineIndex) => {\n      let lineJustification = options.justify;\n      let lineLineSpace = options.lineSpace;\n      let lineToUse;\n      let lineFont = options.font;\n      if (typeof lineDefinition !== 'string') {\n        const {\n          font, justify, lineSpace,\n        } = lineDefinition;\n        lineToUse = lineDefinition.text;\n        if (font != null) {\n          lineFont = joinObjects({}, options.font, font);\n        }\n        if (lineSpace != null) {\n          lineLineSpace = lineSpace;\n        }\n        if (justify != null) {\n          lineJustification = justify;\n        }\n      } else {\n        lineToUse = lineDefinition;\n      }\n      const line = [];\n\n      const split = splitString(lineToUse, '|', '/');\n      split.forEach((s) => {\n        let text = s;\n        let textFont = lineFont;\n        let offset = new Point(0, 0);\n        let inLine = true;\n        // let border;\n        let touchBorder;\n        let onClick;\n        let followOffsetY = false;\n        let rSpace = 0;\n        let lSpace = 0;\n        if (this.modifiers[s] != null) {\n          const mod = this.modifiers[s];\n          if (mod.text != null) {\n            ({ text } = mod);\n          }\n          if (mod.font != null) {\n            textFont = joinObjects({}, lineFont, mod.font);\n          }\n          if (mod.inLine != null) { inLine = mod.inLine; }\n          if (mod.offset != null) { offset = mod.offset; }\n          // if (mod.border != null) {\n          //   border = mod.border;\n          // }\n          if (mod.touchBorder != null) {\n            touchBorder = mod.touchBorder;\n            if (\n              touchBorder != null\n              && Array.isArray(touchBorder)\n              && !isBuffer(touchBorder)\n            ) { // $FlowFixMe\n              [touchBorder] = getBorder(touchBorder);\n            }\n          }\n          if (mod.onClick != null) { onClick = mod.onClick; }\n          if (mod.followOffsetY != null) { followOffsetY = mod.followOffsetY; }\n          if (mod.lSpace != null) { lSpace = mod.lSpace; }\n          if (mod.rSpace != null) { rSpace = mod.rSpace; }\n          // if (Array.isArray(border)) {  // $FlowFixMe\n          //   border = getPoints(border);\n          // }\n          // if (Array.isArray(touchBorder)) {  // $FlowFixMe\n          //   touchBorder = getBorder(touchBorder);\n          // }\n        }\n        const t = new FigureTextLines(\n          this.drawContext2D,\n          new Point(0, 0),\n          text,\n          textFont,\n          offset,\n          inLine,\n          lineIndex, // $FlowFixMe\n          touchBorder || options.defaultTextTouchBorder,\n          onClick,\n          followOffsetY,\n          lSpace,\n          rSpace,\n        );\n        figureTextArray.push(t);\n        line.push(t);\n      });\n      this.lines.push({\n        justify: lineJustification,\n        space: lineLineSpace,\n        text: line,\n        width: 0,\n      });\n    });\n    this.text = figureTextArray;\n    this.xAlign = options.xAlign;\n    this.yAlign = options.yAlign;\n    // super.super.loadText();\n    this.calcScalingFactor();\n    // this.borderSetup = options.border || [];\n    // this.touchBorderSetup = options.touchBorder || [];\n    this.layoutText();\n  }\n\n  setText(textOrOptions: string | OBJ_TextDefinition, index: number = 0) {\n    this.text[index].setText(textOrOptions);\n    this.layoutText();\n  }\n\n  setTextLocations() {\n    const { width, minY, maxY } = this.createLines(); // $FlowFixMe\n    align(this.text, this.xAlign, this.yAlign, width, minY, maxY);\n  }\n\n  createLines() {\n    let maxLinesY = 0;\n    let minLinesY = 0;\n    let maxLinesWidth = 0;\n    let y = 0;\n    this.lines.forEach((line, index) => {\n      if (index > 0 && line.text.length > 0) {\n        y -= line.space;\n      } else if (index > 0 && line.text.length === 0) {\n        y -= line.space / 3;\n      }\n      const { width, minY, maxY } = createLine(line.text, new Point(0, y));\n      minLinesY = minY < minLinesY ? minY : minLinesY;\n      maxLinesY = maxY > maxLinesY ? maxY : maxLinesY;\n      maxLinesWidth = width > maxLinesWidth ? width : maxLinesWidth;\n      line.width = width;   // eslint-disable-line no-param-reassign\n    });\n    // justify lines\n    this.lines.forEach((line) => {\n      const locationAlignOffset = new Point(0, 0);\n      if (line.justify === 'center') {\n        locationAlignOffset.x += maxLinesWidth / 2 - line.width / 2;\n      } else if (line.justify === 'right') {\n        locationAlignOffset.x += maxLinesWidth - line.width;\n      }\n      line.text.forEach((text) => {\n        // eslint-disable-next-line no-param-reassign\n        text.location = text.location.add(locationAlignOffset);\n      });\n    });\n    return {\n      width: maxLinesWidth,\n      minY: minLinesY,\n      maxY: maxLinesY,\n    };\n  }\n\n  _dup() {\n    const c = new TextLineObject(this.drawContext2D);\n    c.text = this.text.map(t => t._dup());\n    c.scalingFactor = this.scalingFactor;\n    c.xAlign = this.xAlign;\n    c.yAlign = this.yAlign;\n    c.layoutText();\n    return c;\n  }\n}\n\nexport {\n  FigureFont, FigureText, TextObject, TextLineObject,\n  TextLinesObject, TextObjectBase,\n};\n","// @flow\nimport {\n  Point, Rect, getRect, // getPoints,\n} from '../../../tools/g2';\n// import type { TypeParsablePoint } from '../../../tools/g2';\nimport { joinObjects } from '../../../tools/tools';\nimport WebGLInstance from '../../webgl/webgl';\nimport VertexObject from './VertexObject';\nimport { copyPoints } from '../../geometries/copy/copy';\nimport type { CPY_Step } from '../../geometries/copy/copy';\n\n\nclass VertexGeneric extends VertexObject {\n  width: number;\n  close: boolean;\n  copy: Array<CPY_Step>;\n  vertices: Array<Point>;\n  texOptions: {\n    location: string,\n    mapFrom: Rect,\n    mapTo: Rect,\n    repeat: boolean,\n  };\n\n  // borderToPoint: TypeBorderToPoint;\n\n  constructor(\n    webgl: Array<WebGLInstance>,\n    // vertices: Array<Point>,\n    // drawType: 'triangles' | 'strip' | 'fan' | 'lines',\n    textureLocation: string = '',\n    textureVertexSpace: Rect = new Rect(-1, -1, 2, 2),\n    textureCoords: Rect = new Rect(0, 0, 1, 1),\n    textureRepeat: boolean = false,\n    // copy: Array<CPY_Step> = [],\n  ): void {\n    if (textureLocation !== '') {\n      super(webgl, 'withTexture', 'withTexture');\n    } else {\n      super(webgl);\n    }\n    this.vertices = [];\n    this.copy = [];\n    // this.change({\n    //   points: vertices,\n    //   copy,\n    //   drawType,\n    // });\n\n    // this.setupTexture(textureLocation, textureVertexSpace, textureCoords, textureRepeat);\n    if (textureLocation !== '') {\n      this.texOptions = {\n        location: textureLocation,\n        mapTo: textureVertexSpace,\n        mapFrom: textureCoords,\n        repeat: textureRepeat,\n      };\n      this.texture = {\n        id: this.texOptions.location,\n        src: this.texOptions.location,\n        type: 'image',\n        points: [],\n        repeat: this.texOptions.repeat,\n      };\n      this.setupTexture(\n        // textureLocation, textureVertexSpace, textureCoords, textureRepeat\n      );\n    }\n\n    this.setupBuffer();\n  }\n\n  // $FlowFixMe\n  change(options: {\n    points?: Array<Point>,\n    copy?: Array<CPY_Step>,\n    drawType?: 'triangles' | 'strip' | 'fan' | 'lines',\n    texture?: {\n      location?: string,\n      mapFrom?: Rect,\n      mapTo?: Rect,\n      repeat?: boolean,\n    }\n  }) {\n    const {\n      points, drawType, copy, texture,\n    } = options;\n\n    if (points != null) {\n      this.vertices = points;\n    }\n    if (drawType != null) {\n      if (drawType === 'lines') {\n        this.glPrimitive = this.gl[0].LINES;\n      } else if (drawType === 'strip') {\n        this.glPrimitive = this.gl[0].TRIANGLE_STRIP;\n      } else if (drawType === 'fan') {\n        this.glPrimitive = this.gl[0].TRIANGLE_FAN;\n      } else {\n        this.glPrimitive = this.gl[0].TRIANGLES;\n      }\n    }\n    if (copy != null) {\n      this.copy = copy;\n    }\n    const newVerts = copyPoints(this.vertices, this.copy);\n    this.points = [];\n    newVerts.forEach((v) => {\n      this.points.push(v.x);\n      this.points.push(v.y);\n    });\n    if (texture != null) {\n      if (texture.mapTo != null) {\n        texture.mapTo = getRect(texture.mapTo);\n      }\n      if (texture.mapFrom != null) {\n        texture.mapFrom = getRect(texture.mapFrom);\n      }\n      this.texOptions = joinObjects({}, this.texOptions, texture);\n      this.setupTexture();\n    }\n\n    this.resetBuffer();\n  }\n\n  setupTexture(\n    // textureLocation: string = '',\n    // textureVertexSpace: Rect = new Rect(-1, -1, 2, 2),\n    // textureCoords: Rect = new Rect(0, 0, 1, 1),\n    // textureRepeat: boolean = false,\n  ) {\n    if (this.texOptions.location) {\n      // this.texture = {\n      //   id: textureLocation,\n      //   src: textureLocation,\n      //   type: 'image',\n      //   points: [],\n      //   repeat: textureRepeat,\n      // };\n\n      this.createTextureMap(\n        this.texOptions.mapTo.left, this.texOptions.mapTo.right,\n        this.texOptions.mapTo.bottom, this.texOptions.mapTo.top,\n        this.texOptions.mapFrom.left, this.texOptions.mapFrom.right,\n        this.texOptions.mapFrom.bottom, this.texOptions.mapFrom.top,\n      );\n    }\n  }\n\n  // setupPoints(\n  // ) {\n  //   const newVerts = copyPoints(this.vertices, this.copy);\n  //   this.points = [];\n  //   newVerts.forEach((v) => {\n  //     this.points.push(v.x);\n  //     this.points.push(v.y);\n  //   });\n  //   // let bounds;\n  //   // if (border === 'rect' || touchBorder === 'rect') {\n  //   //   const boundingRect = getBoundingRect(newVerts);\n  //   //   bounds = [\n  //   //     new Point(boundingRect.left, boundingRect.bottom),\n  //   //     new Point(boundingRect.right, boundingRect.bottom),\n  //   //     new Point(boundingRect.right, boundingRect.top),\n  //   //     new Point(boundingRect.left, boundingRect.top),\n  //   //   ];\n  //   // }\n  //   // if (border === 'rect') {  // $FlowFixMe\n  //   //   this.border = [bounds];\n  //   // } else if (border === 'points') {\n  //   //   this.border = [newVerts];\n  //   // } else {\n  //   //   this.border = border;\n  //   // }\n  //   // if (touchBorder === 'none') {\n  //   //   this.touchBorder = [];\n  //   // } else if (touchBorder === 'rect') {   // $FlowFixMe\n  //   //   this.touchBorder = [bounds];\n  //   // } else if (touchBorder === 'border') {  // $FlowFixMe\n  //   //   this.touchBorder = this.border;\n  //   // } else {\n  //   //   this.touchBorder = touchBorder;\n  //   // }\n  //   // if (holeBorder === 'none') {\n  //   //   this.hole = [];\n  //   // } else {\n  //   //   this.hole = holeBorder;\n  //   // }\n  // }\n}\n\nexport default VertexGeneric;\n","// @flow\n\n// import * as g2 from '../g2';\nimport * as m2 from '../../../tools/m2';\nimport WebGLInstance from '../../webgl/webgl';\nimport { Point } from '../../../tools/g2';\n// import type { TypeParsablePoint } from '../../../tools/g2';\nimport DrawingObject from '../DrawingObject';\nimport type { CPY_Step } from '../../geometries/copy/copy';\nimport type { TypeColor } from '../../../tools/types';\n\n// Base clase of all shape objects made from verteces for webgl.\n// The job of a VertexObject is to:\n//  - Have the points of a object/shape\n//  - Have the shape's border (used to determine whether a location is\n//    within the shape)\n//  - Setup the webgl buffer\n//  - Draw the shape\nclass VertexObject extends DrawingObject {\n  gl: Array<WebGLRenderingContext>;    // shortcut for the webgl context\n  webgl: Array<WebGLInstance>;         // webgl instance for a html canvas\n  glPrimitive: number;                  // primitive tyle (e.g. TRIANGLE_STRIP)\n  buffer: Array<WebGLBuffer>;          // Vertex buffer\n  // textureBuffer: WebGLBuffer;\n\n  points: Array<number>;        // Primitive vertices of shape\n  numPoints: number;            // Number of primative vertices\n  // border: Array<Array<Point>>; // Border vertices\n\n  z: number;\n  texture: ?{\n    id: string;\n    src?: ?string;\n    data?: ?Object;\n    points: Array<number>;\n    buffer?: Array<WebGLBuffer>;\n    type: 'canvasText' | 'image';\n    repeat?: boolean;\n  };\n\n  state: 'loading' | 'loaded';\n\n  // +change: (Array<Point>) => void;\n  programIndex: Array<number>;\n  onLoad: ?(() => void);\n\n  constructor(\n    webgl: Array<WebGLInstance> | WebGLInstance,\n    vertexShader: string = 'simple',\n    fragmentShader: string = 'simple',\n  ) {\n    super();\n    this.numPoints = 0;\n    let webglArray;\n    if (Array.isArray(webgl)) {\n      webglArray = webgl;\n    } else {\n      webglArray = [webgl];\n    }\n    this.gl = webglArray.map(w => w.gl);\n    this.webgl = webglArray;\n    this.glPrimitive = webglArray[0].gl.TRIANGLES;\n    this.points = [];\n    this.z = 0;\n    this.buffer = webglArray.map(() => null);\n    // this.textureLocation = '';\n    // this.texturePoints = [];\n    this.texture = null;\n    this.programIndex = webglArray.map(w => w.getProgram(vertexShader, fragmentShader));\n    this.type = 'vertexPrimitive';\n  }\n\n  addTextureToBuffer(\n    glIndex: number,\n    glTexture: WebGLTexture,\n    image: Object, // image data\n    repeat?: boolean,\n  ) {\n    function isPowerOf2(value) {\n      // eslint-disable-next-line no-bitwise\n      return (value & (value - 1)) === 0;\n    }\n    const gl = this.gl[glIndex];\n    const webgl = this.webgl[glIndex];\n    const { texture } = this;\n    if (texture != null) {\n      const { index } = webgl.textures[texture.id];\n      gl.activeTexture(gl.TEXTURE0 + index);\n      gl.bindTexture(gl.TEXTURE_2D, glTexture);\n      gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, 1);\n      gl.texImage2D(\n        gl.TEXTURE_2D, 0, gl.RGBA,\n        gl.RGBA, gl.UNSIGNED_BYTE, image,\n      );\n      // Check if the image is a power of 2 in both dimensions.\n      if (isPowerOf2(image.width) && isPowerOf2(image.height)) {\n        // Yes, it's a power of 2. Generate mips.\n        gl.generateMipmap(gl.TEXTURE_2D);\n        if (repeat != null && repeat === true) {\n          gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.REPEAT);\n          gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.REPEAT);\n        } else {\n          gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n          gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n        }\n      } else {\n        // No, it's not a power of 2. Turn off mips and set wrapping to clamp to edge\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n      }\n    }\n  }\n\n  setupBuffer(numPoints: number = 0) {\n    for (let glIndex = 0; glIndex < this.webgl.length; glIndex += 1) {\n      // console.log(glIndex)\n      const gl = this.gl[glIndex];\n      const webgl = this.webgl[glIndex];\n      // const texture = this.texture[glIndex];\n      // const buffer = this.buffer[glIndex];\n      this.state = 'loaded';\n      if (numPoints === 0) {\n        this.numPoints = this.points.length / 2.0;\n      } else {\n        this.numPoints = numPoints;\n      }\n\n      // if (this.texture && this.texture.points == null) {\n      //   this.texture.points = [];\n      //   this.createTextureMap();\n      // }\n\n      const { texture } = this;\n      if (texture != null) {\n        if (texture.points == null) {\n          texture.points = [];\n        }\n        if (texture.points.length === 0) {\n          this.createTextureMap();\n        }\n        if (texture.buffer == null) {\n          texture.buffer = this.gl.map(() => null);\n        }\n        // $FlowFixMe\n        texture.buffer[glIndex] = gl.createBuffer();\n        // $FlowFixMe\n        gl.bindBuffer(gl.ARRAY_BUFFER, texture.buffer[glIndex]);\n        gl.bufferData(\n          gl.ARRAY_BUFFER,\n          new Float32Array(texture.points),\n          gl.STATIC_DRAW,\n        );\n        if (\n          !(texture.id in webgl.textures)\n          || (\n            texture.id in webgl.textures\n            && webgl.textures[texture.id].glTexture == null\n          )\n        ) {\n          const glTexture = gl.createTexture();\n          webgl.addTexture(texture.id, glTexture, texture.type);\n          gl.activeTexture(\n            gl.TEXTURE0 + webgl.textures[texture.id].index,\n          );\n          gl.bindTexture(gl.TEXTURE_2D, glTexture);\n          const { src } = texture;\n          if (src && texture.data == null) {\n            // Fill the texture with a 1x1 blue pixel.\n            gl.texImage2D(\n              gl.TEXTURE_2D, 0, gl.RGBA, 1, 1, 0,\n              gl.RGBA, gl.UNSIGNED_BYTE, new Uint8Array([0, 0, 255, 100]),\n            );\n            const image = new Image();\n            image.src = src;\n\n            this.state = 'loading';\n            webgl.textures[texture.id].state = 'loading';\n            webgl.textures[texture.id].onLoad.push(this.executeOnLoad.bind(this));\n            image.addEventListener('load', () => {\n              // Now that the image has loaded make copy it to the texture.\n              texture.data = image;\n              this.addTextureToBuffer(\n                glIndex, glTexture, texture.data, texture.repeat,\n              );\n              // if (this.onLoad != null) {\n              webgl.onLoad(texture.id);\n              // this.onLoad();\n              // }\n              this.state = 'loaded';\n              webgl.textures[texture.id].state = 'loaded';\n            });\n          } else if (texture.data != null) {\n            this.addTextureToBuffer(\n              glIndex, glTexture, texture.data, texture.repeat,\n            );\n          }\n        } else if (texture.id in webgl.textures) {\n          if (webgl.textures[texture.id].state === 'loading') {\n            this.state = 'loading';\n            webgl.textures[texture.id].onLoad.push(this.executeOnLoad.bind(this));\n          } else {\n            this.state = 'loaded';\n          }\n        }\n      }\n\n      this.buffer[glIndex] = gl.createBuffer();\n      gl.bindBuffer(gl.ARRAY_BUFFER, this.buffer[glIndex]);\n      gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(this.points), gl.STATIC_DRAW);\n    }\n  }\n\n  executeOnLoad() {\n    if (this.onLoad != null) {\n      this.onLoad();\n    }\n  }\n\n  resetBuffer(numPoints: number = 0) {\n    for (let glIndex = 0; glIndex < this.webgl.length; glIndex += 1) {\n      const gl = this.gl[glIndex];\n      const webgl = this.webgl[glIndex];\n      const { texture } = this;\n      if (texture) {\n        // this.gl.activeTexture(this.gl.TEXTURE0 + texture.index);\n        // this.gl.bindTexture(this.gl.TEXTURE_2D, null);\n        if (webgl.textures[texture.id].glTexture != null) {\n          gl.activeTexture(gl.TEXTURE0 + webgl.textures[texture.id].index);\n          gl.bindTexture(gl.TEXTURE_2D, null);\n          // gl.deleteTexture(webgl.textures[texture.id].glTexture);\n          webgl.textures[texture.id].glTexture = null;\n        }\n        if (texture.buffer != null) {\n          gl.deleteBuffer(texture.buffer[glIndex]);\n          // $FlowFixMe\n          texture.buffer[glIndex] = null;\n        }\n        // texture.glTexture = null;\n      }\n      // this.gl.bindBuffer(this.gl.ARRAY_BUFFER, null);\n      gl.deleteBuffer(this.buffer[glIndex]);\n      this.setupBuffer(numPoints);\n    }\n  }\n\n  /* eslint-disable no-unused-vars */\n  change(options: {\n    points?: Array<Point>,\n    copy?: Array<CPY_Step>,\n    drawType?: 'triangles' | 'strip' | 'fan' | 'lines',\n  }) {\n    this.resetBuffer();\n  }\n  /* eslint-enable no-unused-vars */\n\n  // eslint-disable-next-line no-unused-vars\n  update(options: Object) {\n    this.resetBuffer();\n  }\n\n  _getStateProperties() {  // eslint-disable-line class-methods-use-this\n    return [...super._getStateProperties(),\n    ];\n  }\n\n  // Abstract method - should be reimplemented for any vertexObjects that\n  // eslint-disable-next-line no-unused-vars\n  getPointCountForAngle(drawAngle: number = Math.PI * 2) {\n    // return this.numPoints * drawAngle / (Math.PI * 2);\n    return this.numPoints;\n  }\n\n  // Abstract method - should be reimplemented for any vertexObjects that\n  // eslint-disable-next-line no-unused-vars\n  getPointCountForLength(drawLength: number) {\n    return this.numPoints;\n  }\n\n  // A texture map is a texture coords point that lines up with the texture\n  // vertex point. So, if the vertex shape is rectangular, centered at the\n  // origin and wants to incorporate the entire texture, then the map would\n  // be:\n  // vertex space            texture space\n  // this.points         this.texture.points\n  //    -1,  -1,                  0,  0\n  //    -1,   1,                  0,  1\n  //     1,   1,                  1,  1\n  //     1,  -1,                  1,  0\n  createTextureMap(\n    xMinGL: number = -1,\n    xMaxGL: number = 1,\n    yMinGL: number = -1,\n    yMaxGL: number = 1,\n    xMinTex: number = 0,\n    xMaxTex: number = 1,\n    yMinTex: number = 0,\n    yMaxTex: number = 1,\n  ) {\n    const glWidth = xMaxGL - xMinGL;\n    const glHeight = yMaxGL - yMinGL;\n    const texWidth = xMaxTex - xMinTex;\n    const texHeight = yMaxTex - yMinTex;\n    const { texture } = this;\n    if (texture != null) {\n      texture.points = [];\n      for (let i = 0; i < this.points.length; i += 2) {\n        const x = this.points[i];\n        const y = this.points[i + 1];\n        const texNormX = (x - xMinGL) / glWidth;\n        const texNormY = (y - yMinGL) / glHeight;\n        texture.points.push(texNormX * texWidth + xMinTex);\n        texture.points.push(texNormY * texHeight + yMinTex);\n      }\n    }\n  }\n\n  draw(\n    translation: Point,\n    rotation: number,\n    scale: Point,\n    count: number,\n    color: TypeColor,\n    glIndex: number = 0,\n    // webGLInstance: WebGLInstance = this.webgl,\n  ) {\n    let transformation = m2.identity();\n    transformation = m2.translate(transformation, translation.x, translation.y);\n    transformation = m2.rotate(transformation, rotation);\n    transformation = m2.scale(transformation, scale.x, scale.y);\n    this.drawWithTransformMatrix(m2.t(transformation), color, glIndex, count);\n  }\n\n  drawWithTransformMatrix(\n    transformMatrix: Array<number>,\n    color: TypeColor,\n    glIndex: number,\n    count: number,\n    // webglInstance: WebGLInstance = this.webgl,\n  ) {\n    // if (window.asdf) {\n    //   console.log(transformMatrix, color, glIndex, count);\n    // }\n    const gl = this.gl[glIndex];\n    const webglInstance = this.webgl[glIndex];\n\n    const size = 2;         // 2 components per iteration\n    const type = gl.FLOAT;   // the data is 32bit floats\n    const normalize = false;    // don't normalize the data\n    // 0 = move forward size * sizeof(type) each iteration to get\n    // the next position\n    const stride = 0;\n    const offset = 0;       // start at the beginning of the buffer\n\n    const locations = webglInstance.useProgram(this.programIndex[glIndex]);\n\n    if (\n      this.texture\n      && webglInstance.textures[this.texture.id].type === 'canvasText'\n    ) {\n      // this.gl.pixelStorei(this.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, true);\n      // this.gl.blendFunc(this.gl.ONE, this.gl.ONE_MINUS_SRC_ALPHA);\n      gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, 0);\n      gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);\n    } else {\n      gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, 0);\n      gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);\n    }\n    // Turn on the attribute\n    gl.enableVertexAttribArray(locations.a_position);\n\n    // Bind it to ARRAY_BUFFER (think of it as ARRAY_BUFFER = positionBuffer)\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.buffer[glIndex]);\n    // Tell the attribute how to get data out of positionBuffer (ARRAY_BUFFER)\n    gl.vertexAttribPointer(\n      locations.a_position,\n      size, type, normalize, stride, offset,\n    );\n\n    gl.uniformMatrix3fv(\n      locations.u_matrix,\n      false,\n      m2.t(transformMatrix),\n    );  // Translate\n\n    gl.uniform1f(locations.u_z, this.z);\n\n    gl.uniform4f(\n      locations.u_color,\n      color[0], color[1], color[2], color[3],\n    );  // Translate\n\n    const { texture } = this;\n    if (texture != null) {\n      // Textures\n      // Tell the position attribute how to get data out of positionBuffer (ARRAY_BUFFER)\n      const texSize = 2;          // 2 components per iteration\n      const texType = gl.FLOAT;   // the data is 32bit floats\n      const texNormalize = false; // don't normalize the data\n      const texStride = 0;\n      // 0 = move forward size * sizeof(type) each iteration to get\n      // the next position\n      const texOffset = 0;        // start at the beginning of the buffer\n\n      gl.enableVertexAttribArray(locations.a_texcoord);\n      // $FlowFixMe\n      gl.bindBuffer(gl.ARRAY_BUFFER, texture.buffer[glIndex]);\n      gl.vertexAttribPointer(\n        locations.a_texcoord, texSize, texType,\n        texNormalize, texStride, texOffset,\n      );\n    }\n    if (texture) {\n      gl.uniform1i(locations.u_use_texture, 1);\n      const { index } = webglInstance.textures[texture.id];\n      // console.log(texture.id, index, webglInstance.textures)\n      gl.uniform1i(locations.u_texture, index);\n    } else {\n      gl.uniform1i(locations.u_use_texture, 0);\n    }\n\n    gl.drawArrays(this.glPrimitive, offset, count);\n\n    if (texture) {\n      gl.disableVertexAttribArray(locations.a_texcoord);\n    }\n  }\n\n  transform(transformMatrix: Array<number>) {\n    for (let i = 0; i < this.points.length; i += 2) {\n      let p = new Point(this.points[i], this.points[i + 1]);\n      p = p.transformBy(transformMatrix);\n      this.points[i] = p.x;\n      this.points[i + 1] = p.y;\n    }\n    for (let b = 0; b < this.border.length; b += 1) {\n      for (let p = 0; p < this.border[b].length; p += 1) {\n        this.border[b][p] = this.border[b][p].transformBy(transformMatrix);\n      }\n    }\n  }\n\n  // calcBorder(lastDrawTransformMatrix: Array<number>) {\n  //   const glBorders = [];\n  //   this.border.forEach(border => {\n  //     const glBorder = [];\n  //     border.forEach(p => {\n  //       glBorder.push(p.transformBy(lastDrawTransformMatrix));\n  //     })\n  //     glBorders.push(glBorder);\n  //   });\n  //   return glBorders;\n  // }\n}\n\nexport default VertexObject;\n","// @flow\n\nimport {\n  Point,\n} from '../../../tools/g2';\nimport WebGLInstance from '../../webgl/webgl';\nimport VertexObject from './VertexObject';\nimport { generateUniqueId, joinObjects } from '../../../tools/tools';\nimport { round } from '../../../tools/math';\n// import { identity } from '../../../tools/m2';\n\ntype TypeVertexInputTextOptions = {\n  text: ?string;\n  size: ?number;\n  family: ?string;\n  weight: ?number;\n  style: ?'normal' | 'italic',\n  xAlign: ?'left' | 'center' | 'right',\n  yAlign: ?'top' | 'bottom' | 'middle' | 'baseline',\n};\n\n// type TypeTextOptions = {\n//   text: string;\n//   size: number;\n//   family: string;\n//   weight: number;\n//   style: 'normal' | 'italic',\n//   xAlign: 'left' | 'center' | 'right',\n//   yAlign: 'top' | 'bottom' | 'middle' | 'baseline',\n// };\n\nclass VertexText extends VertexObject {\n  glPrimitive: number;  // WebGL primitive used\n  text: number;       // radius from center to outside of polygon\n  center: Point;        // center point\n  dAngle: number;       // angle between adjacent verteces to center lines\n  ctx: Object;\n  figureToPixelSpaceScale: Point;\n  figureToGLSpaceTransformMatrix: Array<number>;\n  text: string;\n  size: number | string;\n  family: string;\n  weight: number;\n  style: 'normal' | 'italic';\n  xAlign: 'left' | 'center' | 'right';\n  yAlign: 'top' | 'bottom' | 'middle' | 'baseline';\n  canvas: HTMLCanvasElement;\n  ascent: number;\n  descent: number;\n  height: number;\n  width: number;\n\n  constructor(\n    webgl: Array<WebGLInstance>,\n    textOptions: TypeVertexInputTextOptions,\n  ) {\n    super(webgl, 'withTexture', 'text');\n    this.glPrimitive = webgl[0].gl.TRIANGLE_FAN;\n\n    const defaultTextOptions = {\n      text: 'DEFAULT_TEXT',\n      size: '20px',               // Text in pixels, or in vertex space units.\n      family: 'Helvetica',\n      style: 'normal',\n      weight: 400,\n      xAlign: 'center',\n      yAlign: 'alphabetic',\n      id: generateUniqueId('vertexText'),\n    };\n    const options = joinObjects({}, defaultTextOptions, textOptions);\n    this.size = options.size;\n    this.text = options.text;\n    this.family = options.family;\n    this.xAlign = options.xAlign;\n    this.yAlign = options.yAlign;\n    this.style = options.style;\n    this.weight = options.weight;\n    this.canvas = document.createElement('canvas');\n    this.canvas.id = options.id;\n    this.ctx = this.canvas.getContext('2d');\n    this.texture = {\n      id: options.id,\n      points: [],\n      type: 'canvasText',\n    };\n    this.type = 'vertexText';\n    this.drawTextIntoBuffer();\n  }\n\n\n  // Text is positioned such that the text baseline will be at\n  // vertex space y = 0.\n  // The border will then cover the ascent and descent of the text.\n  resizeText(\n    pixelToVertexSpaceScale: Point = new Point(1, 1),\n  ) {\n    const width = this.canvas.width * pixelToVertexSpaceScale.x;\n    const height = this.canvas.height * pixelToVertexSpaceScale.y;\n    const start = new Point(0, 0);\n    if (this.xAlign === 'center') {\n      start.x = -width / 2;\n    } else if (this.xAlign === 'right') {\n      start.x = -width;\n    }\n    if (this.yAlign === 'baseline') {\n      start.y = -height * 0.25;\n    } else if (this.yAlign === 'top') {\n      start.y = -height;\n    } else if (this.yAlign === 'middle') {\n      start.y = -height / 2;\n    }\n\n\n    const points = [\n      start,\n      new Point(start.x, start.y + height),\n      new Point(start.x + width, start.y + height),\n      new Point(start.x + width, start.y),\n    ];\n\n    this.width = width;\n    this.height = height;\n    this.calcAscentDescent();\n\n    this.points = [];\n    points.forEach((point) => {\n      this.points.push(point.x);\n      this.points.push(point.y);\n    });\n\n    this.border = [[\n      new Point(start.x, -this.descent),\n      new Point(start.x, this.ascent),\n      new Point(start.x + width, this.ascent),\n      new Point(start.x + width, -this.descent),\n    ]];\n\n    const { texture } = this;\n    if (texture != null) {\n      texture.points = [\n        0, 0,\n        0, 1,\n        1, 1,\n        1, 0,\n      ];\n      texture.data = this.ctx.canvas;\n      if (texture.buffer) {\n        this.resetBuffer();\n      } else {\n        this.setupBuffer();\n      }\n    }\n  }\n\n  calcAscentDescent() {\n    // const aWidth = this.ctx.measureText('a').width;\n\n    // Estimations of FONT ascent and descent for a baseline of \"alphabetic\"\n    let ascent = 0.75;\n    let descent = 0;\n\n    const lowAscentRe = /[,.]/g;\n    const midAscentRe = /[acemnorsuvwxz*gyq:><;p=]/g;\n    const midDecentRe = /[;,$]/g;\n    const maxDescentRe = /[gjyqp@Q(){}[\\]|]/g;\n\n    const lowAscentMatches = this.text.match(lowAscentRe);\n    if (Array.isArray(lowAscentMatches)) {\n      if (lowAscentMatches.length === this.text.length) {\n        ascent = 0.1;\n      }\n    }\n\n    const midAscentMatches = this.text.match(midAscentRe);\n    if (Array.isArray(midAscentMatches)) {\n      if (midAscentMatches.length === this.text.length) {\n        ascent = 0.5;\n      }\n    }\n\n    const midDescentMatches = this.text.match(midDecentRe);\n    if (Array.isArray(midDescentMatches)) {\n      if (midDescentMatches.length > 0) {\n        descent = 0.1;\n      }\n    }\n\n    const maxDescentMatches = this.text.match(maxDescentRe);\n    if (Array.isArray(maxDescentMatches)) {\n      if (maxDescentMatches.length > 0) {\n        descent = 0.25;\n      }\n    }\n    this.ascent = ascent * this.height;\n    this.descent = descent * this.height;\n  }\n\n  // If font size is defined in pixels, then the size will always be the size\n  // in pixels independent of how the figure window or scaling changes\n  // If the font size is defined in vertex space units, then the font size\n  // will always be scaled to look like the vertex space size, but a new canvas\n  // will be drawn each time to minimize aliasing.\n  drawTextIntoBuffer(\n    pixelToVertexSpaceScale: Point = new Point(1, 1),\n  ) {\n    let pixelFontSize = 20;\n    if (typeof this.size === 'string' && this.size.endsWith('px')) {\n      pixelFontSize = parseInt(this.size, 10);\n    } else {\n      let figureFontSize;\n      if (typeof this.size === 'string') {\n        figureFontSize = parseFloat(this.size);\n      } else {\n        figureFontSize = this.size;\n      }\n      pixelFontSize = round(figureFontSize / pixelToVertexSpaceScale.x, 0);\n    }\n\n    if (pixelFontSize < 1) {\n      pixelFontSize = 1;\n    }\n\n    this.ctx.font = `${this.style} ${this.weight} ${pixelFontSize}px ${this.family}`;\n    const hBuffer = 0.3;\n    const width = this.ctx.measureText(this.text).width\n                  + pixelFontSize * hBuffer;\n    const height = pixelFontSize * 1.15;\n    this.canvas.width = Math.max(width, 1);\n    this.canvas.height = Math.max(height, 1);\n    this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\n    // need to reset font after a canvas resize\n    this.ctx.font = `${this.style} ${this.weight} ${pixelFontSize}px ${this.family}`;\n    this.ctx.textAlign = 'left';\n    this.ctx.textBaseline = 'alphabetic';\n    // this.ctx.fillStyle = 'white';\n    this.ctx.fillStyle = 'white';\n    // this.ctx.fillStyle = 'rgba(200,200,200,255)';   // debug only\n    // this.ctx.fillStyle = 'blue';\n\n    const startX = pixelFontSize * hBuffer / 2;\n    const baselineHeightFromBottom = 0.25;\n    const startY = this.canvas.height * (1 - baselineHeightFromBottom);\n    this.ctx.fillText(this.text, startX, startY);\n\n    this.resizeText(pixelToVertexSpaceScale);\n  }\n}\n\nexport default VertexText;\n\n","// @flow\n\nimport {\n  Transform, Point, Rect,\n  spaceToSpaceTransform, getBoundingRect,\n  clipAngle, getPoint, getTransform, getScale,\n  TransformBounds, RectBounds, RangeBounds, getBounds,\n  getBoundingBorder, isBuffer, getBorder,\n} from '../tools/g2';\nimport { round } from '../tools/math';\n// import { areColorsSame } from '../tools/color';\nimport { getState } from './Recorder/state';\nimport type {\n  TypeParsablePoint, TypeParsableTransform,\n  TypeTransformValue, TypeTransformBoundsDefinition,\n  TypeBorder, TypeParsableBuffer,\n} from '../tools/g2';\nimport { Recorder } from './Recorder/Recorder';\nimport * as m2 from '../tools/m2';\n// import type { pathOptionsType, TypeRotationDirection } from '../tools/g2';\nimport * as math from '../tools/math';\nimport HTMLObject from './DrawingObjects/HTMLObject/HTMLObject';\nimport DrawingObject from './DrawingObjects/DrawingObject';\nimport VertexObject from './DrawingObjects/VertexObject/VertexObject';\nimport { TextObjectBase } from './DrawingObjects/TextObject/TextObject';\n// import type { OBJ_Font } from './DrawingObjects/TextObject/TextObject';\nimport {\n  duplicateFromTo, joinObjects, joinObjectsWithOptions, SubscriptionManager,\n  generateUniqueId,\n} from '../tools/tools';\nimport { colorArrayToRGBA, areColorsWithinDelta } from '../tools/color';\nimport GlobalAnimation from './webgl/GlobalAnimation';\nimport type { TypeWhen } from './webgl/GlobalAnimation';\n// import DrawContext2D from './DrawContext2D';\n\nimport type Figure, { OBJ_SpaceTransforms, OBJ_FigureForElement } from './Figure';\nimport type {\n  OBJ_PositionAnimationStep, OBJ_AnimationBuilder,\n  OBJ_ColorAnimationStep, OBJ_TransformAnimationStep,\n  OBJ_RotationAnimationStep, OBJ_ScaleAnimationStep,\n  OBJ_PulseAnimationStep, OBJ_OpacityAnimationStep,\n  OBJ_ParallelAnimationStep, OBJ_TriggerAnimationStep,\n  OBJ_AnimationStep, OBJ_PulseTransformAnimationStep,\n  OBJ_ScenarioAnimationStep,\n} from './Animation/Animation';\n// eslint-disable-next-line import/no-cycle\nimport * as animations from './Animation/Animation';\nimport WebGLInstance from './webgl/webgl';\n// import type Figure from './Figure';\nimport { FunctionMap } from '../tools/FunctionMap';\nimport type {\n  OBJ_Font, TypeColor,\n} from '../tools/types';\n// import type FigurePrimitives from './FigurePrimitives/FigurePrimitives';\nimport type FigureCollections from './FigureCollections/FigureCollections';\n\n// eslint-disable-next-line import/no-cycle\n// import {\n//   AnimationPhase, ColorAnimationPhase, CustomAnimationPhase,\n// } from './AnimationPhase';\n\n// function checkCallback(callback: ?(boolean) => void): (boolean) => void {\n//   let callbackToUse = () => {};\n//   if (typeof callback === 'function') {\n//     callbackToUse = callback;\n//   }\n//   return callbackToUse; + width\n// }\n\nexport type TypeSpace = 'draw' | 'local' | 'figure' | 'gl' | 'pixel';\n\n/**\n * Add element Object\n */\nexport type OBJ_AddElement = {\n  path?: string,\n  name?: string,\n  method?: string,\n  options?: {},   // eslint-disable-next-line no-use-before-define\n  elements?: Array<OBJ_AddElement | FigureElement>,\n  mods?: {},\n  scenario?: string,\n};\n\n/**\n * Transform, color and visbility scenario definition\n *\n * `translation` will overwirte `position`, and `translation, `position`,\n * rotation` and `scale` overwrite the first equivalent transforms in\n * `transform`\n *\n * @property {TypeParsablePoint} position\n * @property {TypeParsablePoint} translation\n * @property {TypeParsablePoint | number} scale\n * @property {number} rotation\n * @property {TypeParsableTransform} transform\n * @property {Array<number>} color\n * @property {boolean} isShown\n */\nexport type OBJ_Scenario = {\n  position?: TypeParsablePoint,\n  translation?: TypeParsablePoint,\n  rotation?: number,\n  scale?: TypeParsablePoint | number,\n  transform?: TypeParsableTransform,\n  color?: TypeColor,\n  isShown?: boolean,\n};\n\n/**\n * Path to a {@link FigureElement} within a {@link FigureElementCollection}.\n *\n * `string | {[name: string]: TypeElementPath } | `{@link FigureElement}` | Array<TypeElementPath>}`\n *\n * Consider a collection with the below heirachy. The collection has two\n * children `diagram` and `description` of which `diagram` is another\n * collection:\n * - diagram\n *   - lineA\n *   - lineB\n *   - lines\n *     - lineC\n *     - lineD\n * - description\n *\n * The ways to define lineC, lineD and description are:\n *\n * - `['description', 'diagram.lines.lineC', 'diagram.lines.lineD']`\n * - `['description', { diagram: ['lines.lineC', 'lines.lineD'] }]`\n * - `['description', { 'diagram.lines': ['lineC', 'lineD'] }]`\n */\n/* eslint-disable no-use-before-define */\nexport type TypeElementPath = string\n                              | { [name: string]: TypeElementPath }\n                              | FigureElement\n                              | Array<TypeElementPath>;\n/* eslint-enable no-use-before-define */\n\nconst transformBy = (inputTransforms: Array<Transform>, copyTransforms: Array<Transform>) => {\n  const newTransforms = [];\n  if (copyTransforms.length === 0) {\n    return inputTransforms.map(t => t._dup());\n  }\n  inputTransforms.forEach((it) => {\n    copyTransforms.forEach((t) => {\n      newTransforms.push(getTransform(it).transform(getTransform(t)));\n    });\n  });\n  if (newTransforms.length > 0) {\n    // TODO Test without duping this\n    return newTransforms.map(t => t._dup());\n    // return newTransforms;\n  }\n  return inputTransforms.map(t => t._dup());\n};\n\n/* eslint-disable no-use-before-define */\n\n/**\n * Pulse options object\n *\n * ![](./apiassets/pulse.gif)\n *\n * Pulsing can be useful to highlight a figure element to a user, without\n * changing its underlying properties.\n *\n * When an element is pulsed, it will be scaled, translated or rotated from\n * a start value (1 for scale, 0 for rotation and translation),\n * to a maximum value (`scale`, `translate` or `rotate`),\n * to a `min` value, and then back to the `start` value. An element can\n * be pulsed through this cycle `frequency` times per second, over some\n * `duration`.\n *\n * The pulse does not change the {@link FigureElement}.transform property, and\n * only changes the draw transform.\n *\n * By default, a scale or rotation pulse will scale or rotate around the the\n * center of the rectangle encompassing the border of the element. `centerOn`\n * can be used to define a different {@link FigureElement} or point to center\n * on. If centering on a {@link FigureElement}, `xAlign` and `yAlign` can be\n * used to center on a point aligned within it. For instance, `xAlign: 'left'`\n * will center on a point on the left edte of the {@link FigureElement}.\n *\n * The pulse can also draw multiple copies of the element with pulse transforms\n * distributed between the `min` and maximum pulse values. This is particularly\n * useful for shapes with outlines that have a regular spacing from a center\n * point (such as regular polygons) as it will look like the thickness of the\n * outlines are becomming thicker.\n *\n * @property {number} [duration] pulse duration in seconds (`1`)\n * @property {number} [frequency] pulse frequency in Hz - a frequency of zero\n * will set the frequency so just one cycle will be performed in the duration\n * (`0`)\n * @property {number} [scale] maximum scale value to pulse to (`1.5`)\n * @property {number} [rotation] maximum rotation value to pulse to\n * @property {number} [translation] maximum translation displacment value to\n * pulse to (`1.5`)\n * @property {number} [angle] translation angle (`0`)\n * @property {number} [min] minimum value to pulse to\n * @property {null | FigureElement | TypeParsablePoint | string} [centerOn] center\n * of scale or rotation pulse. By default, the element calling the pulse\n * will be the default `centerOn`.\n * @property {'left' | 'center' | 'right' | 'location' | number} [xAlign]\n * if `centerOn` is a {@link FigureElement} then this property can be used to\n * horizontally align the pulse center with the element. `'location'` is the\n * (0, 0) draw space coordinate of the element. `number` defines the percent\n * width from the left of the element (`'center'`)\n * @property {'bottom' | 'middle' | 'top' | 'location' | number} [yAlign]\n * if `centerOn` is a {@link FigureElement} then this property can be used to\n * vertically align the pulse center with the element. `'location'` is the\n * (0, 0) draw space coordinate of the element. `number` defines the percent\n * width from the left of the element (`'center'`)\n * @property {'figure' | 'gl' | 'local' | 'draw' | 'pixel'} [space]\n * if `centerOn` is a point, use this to define the space the point is in\n * (`'figure'`)\n * @property {number} [num] the number of draw copies of the pulse to make (`1`)\n * @property {null | string | function(): void} [done] callback when pulse is\n * finished. If `string` then the element's {@link FunctionMap} `fnMap` will be\n * used (`null`)\n * @property {TypeWhen} [when] when to start the pulse (`'syncNow'`)\n * @property {'sinusoid' | 'triangle'} [progression] function that defines\n * how the scale should progress over time (`sinusoid`)\n *\n * @example\n * // For all examples below, use this to add an element to the figure\n * figure.add({\n *   name: 'p',\n *   method: 'polygon',\n *   options: {\n *     radius: 0.3,\n *     line: { width: 0.05, },\n *   },\n * });\n *\n * const p = figure.getElement('p');\n *\n * @example\n * // Scale pulse\n * p.pulse({\n *   duration: 1,\n *   scale: 1.3\n * });\n *\n * @example\n * // Rotation pulse\n * p.pulse({\n *   duration: 1,\n *   rotation: 0.15,\n *   frequency: 4,\n * });\n *\n * @example\n * // Translation pulse\n * p.pulse({\n *   duration: 1,\n *   translation: 0.02,\n *   min: -0.02,\n *   frequency: 4,\n * });\n *\n * @example\n * // Thick pulse\n * p.pulse({\n *   duration: 1,\n *   scale: 1.1,\n *   min: 0.9,\n *   num: 7,\n * });\n */\nexport type OBJ_Pulse = {\n  duration?: number,\n  frequency?: number,\n  scale?: number,\n  rotation?: number,\n  translation?: number,\n  angle?: number,\n  min?: number,\n  centerOn?: null | FigureElement | TypeParsablePoint | string,\n  x?: 'left' | 'center' | 'right' | 'origin' | number,\n  y?: 'bottom' | 'middle' | 'top' | 'origin' | number,\n  space?: 'figure' | 'gl' | 'local' | 'draw',\n  done?: ?(mixed) => void,\n  num?: number,\n  when?: TypeWhen,\n  done: string | () => void | null,\n  progression?: string | (number) => number,\n};\n\n/**\n * Figure element move freely parameters\n *\n * If a figure element is released from moving with some velocity\n * then these parameters will define how it continues to move freely\n *\n * @property {TypeTransformValue} zeroVelocityThreshold used to overcome\n * limitations of floating point numbers not reaching 0\n * @property {TypeTransformValue} deceleration amount to decelerate in local\n * space units per second squared\n * @property {TypeTransformValue} bounceLoss 0.5 results in 50% velocity loss\n * if bouncing of boundary\n * @property {?(string | ((boolean) => void))} callback called each frame of\n * free movement\n */\ntype OBJ_ElementMoveFreely = {\n  zeroVelocityThreshold: TypeTransformValue,  // Velocity considered 0\n  deceleration: TypeTransformValue,           // Deceleration\n  bounceLoss: TypeTransformValue,\n  callback: ?(string | ((boolean) => void)),\n}\n\n/**\n * Figure element move parameters\n *\n * @property {TransformBounds} bounds rectangle to limit movement within\n * @property {string | (?(Transform) => Transform)} transformClip user\n * defined method to clip velocity per frame\n * @property {TypeTransformValue} maxVelocity maximum velocity allowed (5)\n * @property {OBJ_ElementMoveFreely} freely free movement parameters\n * @property {boolean} canBeMovedAfterLosingTouch touch or mouse dragging will\n * continue to move element even after the touch/cursor position is outside\n * the element boundary\n * @property {FigureElement | null} element\n */\ntype OBJ_ElementMove = {\n  bounds: TransformBounds | 'none' | 'figure',\n  // boundsToUse: TransformBounds,\n  sizeInBounds: boolean,\n  // limits: TransformBounds,\n  // includeSize: boolean,\n  transformClip: string | (?(Transform) => Transform);\n  maxVelocity: TypeTransformValue;\n  freely: OBJ_ElementMoveFreely,\n  canBeMovedAfterLosingTouch: boolean;\n  type: 'rotation' | 'translation' | 'scaleX' | 'scaleY' | 'scale';\n  element: FigureElement | null;\n};\n\n/* eslint-enable no-use-before-define */\n\n// A figure is composed of multiple figure elements.\n//\n// A figure element can either be a:\n//  - Primitive: a basic element that has the webGL vertices, color\n//  - Collection: a group of elements (either primitives or collections)\n//\n// A figure element can be:\n//  - transformed (resized, offset, rotated)\n//  - animated (planned transform over time)\n//  - moved with control (like dragging)\n//  - moving freely (dragged then let go with an initial velocity)\n//  - Pulsed\n//\n// This class manages:\n//  - The figure element\n//  - Its current transformation\n//  - Its animation plan, animation control and animation state\n//  - Its movement state\n//  - Its pulsing parameters\n//\n// A figure element has an associated persistant transform that describes how\n// to draw it. The transform includes any translation, rotation and/or scaling\n// the element should be transformed by before drawing.\n//\n// If the figure element is a collection of elements, then this transform is\n// applied to all the child elements. Each child element will have it's own\n// transform as well, and it will be multiplied by the parent transform.\n//\n// Whenever an element animated or moved, it's persistant transform is updated.\n//\n// Pulsing does not update an element's persistant transform, but does alter\n// the element's current transform used for drawing itself and any children\n// elements it has.\n//\n\n/**\n * All scenarios set to element.\n *\n * Scenarios are preset transforms, color and visibility settings that can be\n * easily animated to.\n *\n * This is an object where the keys are scenario names and values are\n * {@link OBJ_Scenario} objects defining the scenario.\n *\n * @property {OBJ_Scenario} scenarioName where scenarioName can be any\n * string that names the scenario\n */\ntype Scenarios = {\n  [scenarioName: string]: OBJ_Scenario,\n};\n\n/**\n * Element movement state\n */\ntype ElementMovementState = {\n  previousTime: ?number,\n  previousTransform: Transform,\n  velocity: Transform,           // current velocity - will be clipped\n                                    // at max if element is being moved\n                                    // faster than max.\n};\n\n/**\n * Element pulse state\n */\ntype ElementPulseState = {\n  startTime: ?number,\n};\n\n/**\n * Element state\n */\ntype ElementState = {\n  isBeingMoved: boolean,\n  isMovingFreely: boolean,\n  movement: ElementMovementState,\n  isPulsing: boolean,\n  pulse: ElementPulseState,\n  preparingToStop: boolean;\n}\n\n/**\n * Figure Element base class\n *\n * The set of properties and methods shared by all figure elements\n *\n * A figure element has several color related properties. Color is\n * defined as an RGBA array with values between 0 and 1. The alpha\n * channel defines the transparency or opacity of the color where\n * 1 is fully opaque and 0 is fully transparent.\n *\n * The `color` property stores the element's current color, while the\n * `defaultColor` property stores the element's color when not dimmed or\n * dissolving. Color should only be set using the `setColor` method.\n *\n * An element can be \"dimmed\" or \"undimmed\". For instance,\n * a red element might turn grey when dimmed. The property\n * `dimColor` stores the desired color to dim to and should be set with\n * `setDimColor()`\n *\n * An element can be dissolved in or out with animation. Dissolving\n * an element out transitions its opacity from its current value to 0.\n * The `opacity` property is used when dissolving. The opacity is multiplied by\n * the alpha channel of `color` to net a final opacity. Opacity should not be\n * set directly as it will be overwritten by dissolve animations.\n * @class\n * @property {string} name reference name of element\n * @property {boolean} isShown if `false` then element will not be processed on\n * next draw\n * @property {Transform} transform transform to apply element\n * @property {Transform} lastDrawTransform transform last used for drawing -\n * includes cascade or all parent transforms\n * @property {FigureElement | null} parent parent figure element - `null` if\n * at top level of figure\n * @property {boolean} isTouchable must be `true` to move or execute `onClick`\n * @property {boolean} isMovable must be `true` to move\n * @property {string | () => void} onClick callback if touched or clicked\n * @property {[number, number, number, number]} color element's current\n * color defined as red, green, blue, alpha with range 0 to 1\n * @property {[number, number, number, number]} dimColor color to use when\n * dimming element\n * @property {number} opacity number between 0 and 1 that is multiplied with\n * `color` alpha channel to get final opacity\n * @property {OBJ_ElementMove} move movement parameters\n * @property {Scenarios} scenarios scenario presets\n * @property {AnimationManager} animations element animation manager\n * @property {SubscriptionManager} subscriptions subscription manager for\n * element\n */\nclass FigureElement {\n  transform: Transform;\n  pulseTransforms: Array<Transform>;\n  frozenPulseTransforms: Array<Transform>;\n  copyTransforms: Array<Transform>;\n  drawTransforms: Array<Transform>;\n\n  lastDrawTransform: Transform; // Transform matrix used in last draw\n  lastDrawPulseTransform: Transform; // Transform matrix used in last draw\n  parentTransform: Transform;\n  // lastDrawParentTransform: Transform;\n  // lastDrawElementTransform: Transform;\n  // lastDrawPulseTransform: Transform;\n  lastDrawElementTransformPosition: {parentCount: number, elementCount: number};\n\n  lastDrawOpacity: number;\n\n  parent: FigureElement | null;\n\n  isShown: boolean;                  // True if should be shown in figure\n  name: string;                   // Used to reference element in a collection\n\n  isMovable: boolean;             // Element is able to be moved\n  isTouchable: boolean;           // Element can be touched\n  touchPriority: boolean;\n  isInteractive: ?boolean;         // Touch event is not processed by Figure\n  hasTouchableElements: boolean;\n  // touchInBoundingRect: boolean | number;\n\n  drawPriority: number;\n  cancelSetTransform: boolean;\n\n  // Callbacks\n  onClick: string | (?(?mixed) => void);\n  setTransformCallback: ?(string | ((Transform) => void)); // element.transform is updated\n  internalSetTransformCallback: ?(string | ((Transform) => void));\n  beforeDrawCallback: string | (?(number) => void);\n  afterDrawCallback: string | (?(number) => void);\n  // redrawElements: Array<FigureElement>;\n\n  color: TypeColor;           // For the future when collections use color\n  defaultColor: Array<number>;\n  dimColor: Array<number>;\n  opacity: number;\n  // noRotationFromParent: boolean;\n\n  interactiveLocation: Point;   // this is in vertex space\n  // recorder: Recorder;\n  figure: OBJ_FigureForElement;\n  // move: {\n  //   bounds: TransformBounds,\n  //   transformClip: string | (?(Transform) => Transform);\n  //   maxVelocity: TypeTransformValue;            // Maximum velocity allowed\n  //   // When moving freely, the velocity decelerates until it reaches a threshold,\n  // // then it is considered 0 - at which point moving freely ends.\n  //   freely: {                 // Moving Freely properties\n  //     zeroVelocityThreshold: TypeTransformValue,  // Velocity considered 0\n  //     deceleration: TypeTransformValue,           // Deceleration\n  //     bounceLoss: TypeTransformValue,\n  //     callback: ?(string | ((boolean) => void)),\n  //   };\n  //   // bounce: boolean;\n  //   canBeMovedAfterLosingTouch: boolean;\n  //   type: 'rotation' | 'translation' | 'scaleX' | 'scaleY' | 'scale';\n  //   // eslint-disable-next-line no-use-before-define\n  //   element: FigureElementCollection | FigureElementPrimitive | null;\n  // };\n  move: OBJ_ElementMove;\n\n  onAdd: null | 'string' | () => void;\n  // scenarios: {\n  //   [scenarioName: string]: OBJ_Scenario;\n  // };\n  scenarios: Scenarios;\n\n  type: 'collection' | 'primitive';\n\n  pulseSettings: {\n    time: number,\n    frequency: number,\n    A: number | Array<number>,\n    B: number | Array<number>,\n    C: number | Array<number>,\n    progression: string | ((number, number, number, number, number) => number),\n    num: number,\n    delta: TypeParsablePoint,\n    transformMethod: string | ((number, ?Point) => Transform),\n    callback: ?(string | ((mixed) => void));\n    allowFreezeOnStop: boolean,\n    type: 'scale' | 'rotation' | number,\n    // clearFrozenTransforms: boolean,\n  };\n\n  pulseDefault: string | ((?() => void) => void) | {\n    scale: null | number | Point,\n    rotation: null | number,\n    translation: null | number | Point,\n    angle: number,\n    duration: number,\n    frequency: number,\n    // thick?: {\n    //   num: number,\n    //   min?: number | Point,\n    //   max?: number | Point,\n    // },\n    num: number,\n    // min: number | Point,\n    xAlign: 'center' | 'left' | 'right' | number,\n    yAlign: 'middle' | 'bottom' | 'top' | number,\n    centerOn: null | FigureElement | string,\n    space: TypeSpace,\n    done: null | () => void,\n    progression: string | (number) => number,\n    when: TypeWhen,\n  };\n\n\n  figureLimits: Rect;\n  figureTransforms: OBJ_SpaceTransforms;\n\n  // Current animation/movement state of element\n  state: ElementState;\n\n  animations: animations.AnimationManager;\n  animationFinishedCallback: ?(string | (() => void));\n\n  // pulse: Object;                  // Pulse animation state\n\n  uid: string;\n\n  // Rename to animate in future\n  anim: Object;\n\n  // pulse: (mixed) => void;\n  // pulse: (?Array<string | FigureElement> | mixed) => void;\n  +pulse: (any, ?any) => void;\n  +exec: (any, any) => void;\n  +getElement: (any) => ?FigureElement;\n  +getElements: (any) => Array<FigureElement>;\n  +highlight: (any) => void;\n  // +pulse: (Array<string | FigureElement>) => void;\n\n  // This will scale and position this element such that the center of the\n  // figure limits will will look like it is centered on a html element\n  // when this figurone element is drawn.\n  // Scale can be:\n  //  1em: figure units will be scaled so 0.2 figure units (default\n  //       font size) looks like 1em of the element font size in pixels\n  //  100px: figure units will be scaled so that the max figure limit\n  //         with be the pixel count\n  //  stretch: figure units be stretched so figure limits extend to\n  //           element dimensions independently in x and y\n  //  max: -1 to 1 figure units will be scaled to max dimension of element\n  //  fit: figure units will be scaled so that figure limits aspect ratio\n  //       fits within the element aspect ratio\n  //  '': defaults to fit keeping aspect ratio.\n  tieToHTML: {\n    element: string | null;\n    scale: string;   // 1em, 100px, stretch, max, fit\n    window: Rect;\n    updateOnResize: boolean;\n  };\n\n  isRenderedAsImage: boolean;\n  renderedOnNextDraw: boolean;\n  unrenderNextDraw: boolean;\n\n  custom: { [string]: any };\n\n  stateProperties: Array<string>\n  fnMap: FunctionMap;\n  // isPaused: boolean;\n\n  // finishAnimationOnPause: boolean;\n\n  subscriptions: SubscriptionManager;\n\n  lastDrawTime: number;\n\n  // pauseSettings: TypePauseSettings;\n\n  dependantTransform: boolean;\n\n  recorder: Recorder;\n  // scenarioSet: {\n  //   quiz1: [\n  //     { element: xyz, position: (), scale: (), rotation: (), length: () }\n  //     { element: abc, position: (), }\n  //   ],\n  // };\n  //  element1.scenarioSet['quiz'] = [\n  //     { element: abc, position: [1, 2], scale: 2 },\n  //     { element: xyz, position: [2, 2]},\n  //  ];\n  //  element.setScenarios('center', evenIfNotShown\n  //  element.moveToScenarios('center', 1, callback))\n\n  // element.animations.new()\n  //    .parallel()\n  //\n\n  /**\n   * @hideconstructor\n   */\n  constructor(\n    transform: Transform = new Transform(),\n    figureLimitsOrFigure: Figure | Rect = new Rect(-1, -1, 2, 2),\n    parent: FigureElement | null = null,\n    name: string = generateUniqueId('element_'),\n  ) {\n    // This may be updated if element is added to a collection with a different\n    // name\n    this.name = name;\n    this.uid = (Math.random() * 1e18).toString(36);\n    this.isShown = true;\n    this.transform = transform._dup();\n    this.dependantTransform = false;\n    this.fnMap = new FunctionMap();\n    this.subscriptions = new SubscriptionManager(this.fnMap);\n    this.isMovable = false;\n    this.isTouchable = false;\n    this.touchPriority = false;\n    // this.touchInBoundingRect = false;\n    this.isInteractive = undefined;\n    this.hasTouchableElements = false;\n    this.color = [1, 1, 1, 1];\n    this.lastDrawOpacity = 1;\n    this.dimColor = [0.5, 0.5, 0.5, 1];\n    this.defaultColor = this.color.slice();\n    this.opacity = 1;\n    this.setTransformCallback = null;\n    this.beforeDrawCallback = null;\n    this.afterDrawCallback = null;\n    this.internalSetTransformCallback = null;\n    this.lastDrawTransform = this.transform._dup();\n    this.parentTransform = new Transform();\n    this.lastDrawPulseTransform = this.transform._dup();\n    this.onClick = null;\n    this.lastDrawElementTransformPosition = {\n      parentCount: 0,\n      elementCount: 0,\n    };\n    // this.redrawElements = [];\n    // this.figure = null;\n    this.recorder = new Recorder(true);\n    this.custom = {};\n    this.parent = parent;\n    this.drawPriority = 1;\n    this.stateProperties = [];\n    // this.finishAnimationOnPause = false;\n    this.lastDrawTime = 0;\n    this.cancelSetTransform = false;\n    this.onAdd = null;\n    // this.border = 'draw';\n    // this.touchBorder = 'border';\n    // this.holeBorder = [[]];\n    // this.drawBorder = [[]];\n    // this.drawBorderBuffer = [[]];\n    // this.drawRect = [];\n    // this.noRotationFromParent = false;\n    // this.pulseDefault = (callback: ?() => void = null) => {\n    //   this.pulseScaleNow(1, 2, 0, callback);\n    // };\n    this.pulseDefault = {\n      scale: 2,\n      rotation: null,\n      translation: null,\n      angle: 0,\n      duration: 1,\n      frequency: 0,\n      xAlign: 'center',\n      yAlign: 'middle',\n      centerOn: 'this',\n      num: 1,\n      space: 'figure',\n      done: null,\n      progression: 'sinusoid',\n      when: 'syncNow',\n    };\n    // this.isPaused = false;\n    // this.copies = [];\n\n    // this.pauseSettings = {};\n\n    // Rename to animate in future\n    this.anim = {\n      rotation: (...optionsIn: Array<OBJ_RotationAnimationStep>) => {\n        const options = joinObjects({}, { element: this }, ...optionsIn);\n        return new animations.RotationAnimationStep(options);\n      },\n      scale: (...optionsIn: Array<OBJ_ScaleAnimationStep>) => {\n        const options = joinObjects({}, { element: this }, ...optionsIn);\n        return new animations.ScaleAnimationStep(options);\n      },\n      trigger: (...optionsIn: Array<OBJ_TriggerAnimationStep>) => {\n        const options = joinObjects({}, ...optionsIn);\n        return new animations.TriggerAnimationStep(options);\n      },\n      delay: (...optionsIn: Array<OBJ_AnimationStep>) => {\n        const options = joinObjects({}, ...optionsIn);\n        return new animations.DelayAnimationStep(options);\n      },\n      translation: (...optionsIn: Array<OBJ_PositionAnimationStep>) => {\n        const options = joinObjects({}, { element: this }, ...optionsIn);\n        return new animations.PositionAnimationStep(options);\n      },\n      position: (...optionsIn: Array<OBJ_PositionAnimationStep>) => {\n        const options = joinObjects({}, { element: this }, ...optionsIn);\n        return new animations.PositionAnimationStep(options);\n      },\n      color: (...optionsIn: Array<OBJ_ColorAnimationStep>) => {\n        const options = joinObjects({}, { element: this }, ...optionsIn);\n        return new animations.ColorAnimationStep(options);\n      },\n      opacity: (...optionsIn: Array<OBJ_OpacityAnimationStep>) => {\n        const options = joinObjects({}, { element: this }, ...optionsIn);\n        return new animations.OpacityAnimationStep(options);\n      },\n      transform: (...optionsIn: Array<OBJ_TransformAnimationStep>) => {\n        const options = joinObjects({}, { element: this }, ...optionsIn);\n        return new animations.TransformAnimationStep(options);\n      },\n      pulseTransform: (...optionsIn: Array<OBJ_PulseTransformAnimationStep>) => {\n        const options = joinObjects({}, { element: this }, ...optionsIn);\n        return new animations.PulseTransformAnimationStep(options);\n      },\n      pulse: (...optionsIn: Array<OBJ_PulseAnimationStep>) => {\n        const options = joinObjects({}, { element: this }, ...optionsIn);\n        return new animations.PulseAnimationStep(options);\n      },\n      // eslint-disable-next-line max-len\n      dissolveIn: (timeOrOptionsIn: number | OBJ_OpacityAnimationStep = {}, ...args: Array<OBJ_OpacityAnimationStep>) => {\n        const defaultOptions = { element: this };\n        let options;\n        if (typeof timeOrOptionsIn === 'number') {\n          options = joinObjects({}, defaultOptions, { duration: timeOrOptionsIn }, ...args);\n        } else {\n          options = joinObjects({}, defaultOptions, timeOrOptionsIn, ...args);\n        }\n        return new animations.DissolveInAnimationStep(options);\n      },\n      // eslint-disable-next-line max-len\n      dissolveOut: (timeOrOptionsIn: number | OBJ_OpacityAnimationStep = {}, ...args: Array<OBJ_OpacityAnimationStep>) => {\n        const defaultOptions = { element: this };\n        let options;\n        if (typeof timeOrOptionsIn === 'number') {\n          options = joinObjects({}, defaultOptions, { duration: timeOrOptionsIn }, ...args);\n        } else {\n          options = joinObjects({}, defaultOptions, timeOrOptionsIn, ...args);\n        }\n        return new animations.DissolveOutAnimationStep(options);\n      },\n      // eslint-disable-next-line max-len\n      dim: (timeOrOptionsIn: number | OBJ_ColorAnimationStep = {}, ...args: Array<OBJ_ColorAnimationStep>) => {\n        const defaultOptions = { element: this };\n        let options;\n        if (typeof timeOrOptionsIn === 'number') {\n          options = joinObjects({}, defaultOptions, { duration: timeOrOptionsIn }, ...args);\n        } else {\n          options = joinObjects({}, defaultOptions, timeOrOptionsIn, ...args);\n        }\n        return new animations.DimAnimationStep(options);\n      },\n      // eslint-disable-next-line max-len\n      undim: (timeOrOptionsIn: number | OBJ_ColorAnimationStep = {}, ...args: Array<OBJ_ColorAnimationStep>) => {\n        const defaultOptions = { element: this };\n        let options;\n        if (typeof timeOrOptionsIn === 'number') {\n          options = joinObjects({}, defaultOptions, { duration: timeOrOptionsIn }, ...args);\n        } else {\n          options = joinObjects({}, defaultOptions, timeOrOptionsIn, ...args);\n        }\n        return new animations.UndimAnimationStep(options);\n      },\n      // eslint-disable-next-line max-len\n      builder: (...optionsIn: Array<OBJ_AnimationBuilder>) => new animations.AnimationBuilder(this, ...optionsIn),\n      scenario: (...optionsIn: Array<OBJ_ScenarioAnimationStep>) => {\n        const options = joinObjects({}, { element: this }, ...optionsIn);\n        return new animations.ScenarioAnimationStep(options);\n      },\n      // eslint-disable-next-line max-len\n      // scenario: (...optionsIn: Array<OBJ_TransformAnimationStep\n      //                             & {\n      //                                 start?: OBJ_Scenario,\n      //                                 target: OBJ_Scenario,\n      //                                }>) => {\n      //   const defaultOptions = { element: this, delay: 0 };\n      //   const options = joinObjects({}, defaultOptions, ...optionsIn);\n\n      //   // Retrieve the target scenario\n      //   if (options.target != null) {\n      //     const target = options.element.getScenarioTarget(options.target);\n      //     if (Object.keys(target).length > 0) {\n      //       options.target = target;\n      //     }\n      //   }\n      //   // Retrieve the start scenario (if it doesn't exist, then the element's values\n      //   // at the time the animation starts will be used).\n      //   if (options.start != null) {\n      //     const start = options.element.getScenarioTarget(options.start);\n      //     if (Object.keys(start).length > 0) {\n      //       options.start = start;\n      //     }\n      //   }\n\n      //   const { start, target, element } = options;\n      //   const steps = [];\n      //   const duration = this.getTimeToMoveToScenario(target, options, start || '');\n      //   options.duration = duration;\n      //   const timeOptions = { delay: options.delay, duration: options.duration };\n      //   options.delay = 0;\n      //   options.velocity = undefined;\n      //   let startColor;\n      //   let startTransform;\n      //   let startIsShown;\n\n      //   if (start != null) {\n      //     if (start.color != null) {\n      //       startColor = start.color.slice();\n      //     }\n      //     if (start.transform != null) {\n      //       startTransform = start.transform._dup();\n      //     }\n      //     if (start.isShown != null) {\n      //       startIsShown = start.isShown;\n      //     }\n      //   }\n\n      //   if (target.color != null) {\n      //     steps.push(element.anim.color({\n      //       start: startColor,\n      //       target: target.color,\n      //       duration: options.duration,\n      //     }));\n      //   }\n\n      //   if (target.transform != null) {\n      //     steps.push(element.anim.transform(options, {\n      //       start: startTransform,\n      //       target: target.transform,\n      //     }));\n      //   }\n      //   if (target.isShown != null) {\n      //     if (startIsShown != null) {\n      //       if (target.isShown === true && startIsShown === true) {\n      //         steps.push(element.anim.dissolveIn({ duration: 0 }));\n      //       }\n      //       if (target.isShown === false && startIsShown === false) {\n      //         steps.push(element.anim.dissolveOut({ duration: 0 }));\n      //       }\n      //       if (target.isShown === false && startIsShown === true) {\n      //         steps.push(element.anim.dissolveOut({ duration: options.duration }));\n      //       }\n      //       if (target.isShown === true && startIsShown === false) {\n      //         steps.push(element.anim.dissolveIn({ duration: options.duration }));\n      //       }\n      //     } else {\n      //       let dissolveFromCurrent = true;\n      //       if (options.dissolveFromCurrent != null && options.dissolveFromCurrent === false) {\n      //         dissolveFromCurrent = false;\n      //       }\n      //       if (target.isShown) {\n      //         steps.push(element.anim.opacity({\n      //           duration: options.duration,\n      //           dissolve: 'in',\n      //           dissolveFromCurrent,\n      //         }));\n      //       } else {\n      //         steps.push(element.anim.opacity({\n      //           duration: options.duration,\n      //           dissolve: 'out',\n      //           dissolveFromCurrent,\n      //         }));\n      //       }\n      //     }\n      //   }\n      //   return new animations.ParallelAnimationStep(timeOptions, { steps });\n      // },\n      // scenarioLegacy: (...optionsIn: Array<OBJ_TransformAnimationStep\n      //                          & { scenario: string }>) => {\n      //   const defaultOptions = { element: this };\n      //   const options = joinObjects({}, defaultOptions, ...optionsIn);\n      //   if (options.target != null\n      //     && options.target in options.element.scenarios\n      //   ) {\n      //     const target = options.element.getScenarioTargetLegacy(options.target);\n      //     options.target = target;\n      //   }\n      //   if (options.start != null\n      //     && options.start in options.element.scenarios\n      //   ) {\n      //     const start = options.element.getScenarioTargetLegacy(options.start);\n      //     options.start = start;\n      //   }\n      //   if (options.delta != null\n      //     && options.delta in options.element.scenarios\n      //   ) {\n      //     const delta = options.element.getScenarioTargetLegacy(options.delta);\n      //     options.delta = delta;\n      //   }\n      //   return new animations.TransformAnimationStep(options);\n      // },\n      // eslint-disable-next-line max-len\n      scenarios: (...optionsIn: Array<OBJ_ParallelAnimationStep & OBJ_TransformAnimationStep>) => {\n        const defaultOptions = {};\n        const options = joinObjects({}, defaultOptions, ...optionsIn);\n        const elements = this.getAllElementsWithScenario(options.target);\n        const steps = [];\n        const simpleOptions = {};\n        duplicateFromTo(options, simpleOptions, ['steps', 'element']);\n        elements.forEach((element) => {\n          steps.push(element.anim.scenario(simpleOptions));\n        });\n        return new animations.ParallelAnimationStep(simpleOptions, { steps });\n      },\n    };\n    if (figureLimitsOrFigure instanceof Rect) {\n      this.figureLimits = figureLimitsOrFigure;\n    } else if (figureLimitsOrFigure != null) {\n      this.figureLimits = this.figure.limits._dup();\n    }\n    this.move = {\n      // maxTransform: this.transform.constant(1000),\n      // minTransform: this.transform.constant(-1000),\n      bounds: 'none',\n      sizeInBounds: false,\n      // boundsToUse: new TransformBounds(this.transform),\n      // bounds: { scale: null, rotation: null, position: null },\n      // boundary: null,\n      maxVelocity: 5,\n      // maxVelocity: new TransformLimit(5, 5, 5),\n      freely: {\n        zeroVelocityThreshold: 0.0001,\n        deceleration: 5,\n        callback: null,\n        bounceLoss: 0.5,\n      },\n      // bounce: true, // deprecate\n      canBeMovedAfterLosingTouch: true,\n      type: 'translation',\n      element: null,\n      // limitLine: null,\n      transformClip: null,\n    };\n\n    this.scenarios = {};\n\n    const pulseTransformMethod = (mag, d, type) => {\n      // if (type === 'scale' && (d == null || (d.x === 0 && d.y === 0))) {\n      // if (type === 'scale' && d == null) {\n      //   return new Transform().scale(mag, mag);\n      // }\n      if (type === 'scale') {\n        if (d == null) {\n          return new Transform()\n            .translate(0, 0)\n            .scale(mag, mag)\n            .translate(0, 0);\n        }\n        return new Transform()\n          .translate(-d.x, -d.y)\n          .scale(mag, mag)\n          .translate(d.x, d.y);\n      }\n      if (type === 'rotation') {\n        return new Transform()\n          .translate(-d.x, -d.y)\n          .rotate(mag)\n          .translate(d.x, d.y);\n      }\n      const x = mag * Math.cos(type);\n      const y = mag * Math.sin(type);\n      // const s = this.getScale();\n      return new Transform().translate(x, y);\n    };\n    this.fnMap.add('_elementPulseSettingsTransformMethod', pulseTransformMethod);\n    this.fnMap.add('tools.math.easeinout', math.easeinout);\n    this.fnMap.add('tools.math.linear', math.linear);\n    this.fnMap.add('tools.math.sinusoid', math.sinusoid);\n    this.fnMap.add('tools.math.sinusoidAbs', math.sinusoidAbs);\n    this.fnMap.add('tools.math.triangle', math.triangle);\n    this.pulseSettings = {\n      time: 1,\n      frequency: 0.5,\n      A: 1,\n      B: 0.5,\n      C: 0,\n      progression: 'tools.math.sinusoid',\n      num: 1,\n      delta: new Point(0, 0),\n      transformMethod: '_elementPulseSettingsTransformMethod',\n      callback: () => {},\n      allowFreezeOnStop: false,\n      type: 'scale',\n    };\n\n    this.state = {\n      isBeingMoved: false,\n      isMovingFreely: false,\n      movement: {\n        previousTime: null,\n        previousTransform: this.transform._dup(),\n        velocity: this.transform.zero(),\n      },\n\n      isPulsing: false,\n      pulse: {\n        startTime: null,\n      },\n      preparingToStop: false,\n    };\n    this.interactiveLocation = new Point(0, 0);\n    this.animationFinishedCallback = null;\n    this.animations = new animations.AnimationManager({\n      element: this,\n      finishedCallback: this.animationFinished.bind(this),\n    });\n    this.tieToHTML = {\n      element: null,\n      scale: 'fit',\n      window: this.figureLimits,\n      updateOnResize: true,\n    };\n    this.isRenderedAsImage = false;\n    this.unrenderNextDraw = false;\n    this.renderedOnNextDraw = false;\n    this.pulseTransforms = [];\n    this.frozenPulseTransforms = [];\n    this.copyTransforms = [];\n    this.drawTransforms = [];\n  }\n\n  animationFinished(typeOfAnimation: 'pulse' | 'movingFreely' | 'animation' = 'animation') {\n    // console.log('element', this.name, this.animationFinishedCallback)\n    this.fnMap.exec(this.animationFinishedCallback);\n    this.subscriptions.publish('animationFinished', typeOfAnimation);\n  }\n\n  // animationsFinishedCallback(element: FigureElement) {\n  //   if (this.parent != null) {\n  //     this.parent.animationsFinishedCallback(element);\n  //   }\n  // }\n\n  animateNextFrame() {\n    if (this.figure != null) {\n      this.figure.animateNextFrame();\n    }\n  }\n\n  setProperties(properties: Object, exceptIn: Array<string> | string = []) {\n    let except = exceptIn;\n    if (properties.move != null) {\n      const cleanBounds = (key) => {\n        if (typeof except === 'string') {\n          except = [except, `move.${key}`];\n        } else {\n          except.push(`move.${key}`);\n        }\n        const bounds = getBounds(properties.move[key], 'transform', this.transform);\n        if (bounds instanceof TransformBounds) {\n          for (let i = 0; i < bounds.boundary.length; i += 1) {\n            const bound = bounds.boundary[i];\n            const order = bounds.order[i];\n            if (\n              bounds.boundary[i] != null\n              && bound instanceof RangeBounds\n              && (order === 't' || order === 's')\n            ) {\n              bounds.boundary[i] = new RectBounds({\n                left: bound.boundary.min,\n                bottom: bound.boundary.min,\n                right: bound.boundary.max,\n                top: bound.boundary.max,\n              });\n            }\n          }\n          this.move[key] = bounds;\n        }\n      };\n      // if (properties.move.boundsToUse != null) {\n      //   cleanBounds('boundsToUse');\n      // }\n      if (\n        properties.move.bounds != null\n        && properties.move.bounds !== 'figure'\n        && properties.move.bounds !== 'none'\n      ) {\n        cleanBounds('bounds');\n      }\n    }\n    joinObjectsWithOptions({\n      except,\n    }, this, properties);\n  }\n\n\n  _getStateProperties(options: { ignoreShown?: boolean }) {\n    let { ignoreShown } = options;\n    if (ignoreShown == null) {\n      ignoreShown = false;\n    }\n    if (this.isShown || ignoreShown) {\n      return [\n        'animations',\n        'color',\n        'opacity',\n        'dimColor',\n        'defaultColor',\n        'transform',\n        'isShown',\n        'isMovable',\n        'isTouchable',\n        'state',\n        'pulseSettings',\n        'setTransformCallback',\n        'move',\n        'subscriptions',\n        // 'finishAnimationOnPause',\n        'pulseTransforms',\n        'frozenPulseTransforms',\n        // 'lastDrawTime',\n        ...this.stateProperties,\n      ];\n    }\n    return [\n      'isShown',\n      'transform',\n    ];\n  }\n\n  _getStatePropertiesMin() {\n    if (this.isShown) {\n      return [\n        'color',\n        'transform',\n        'isShown',\n      ];\n    }\n    return [\n      'isShown',\n    ];\n  }\n\n  _state(options: { precision?: number, ignoreShown?: boolean, min?: boolean } = {}) {\n    if (options.min) {\n      return getState(this, this._getStatePropertiesMin(), options);\n    }\n    return getState(this, this._getStateProperties(options), options);\n  }\n\n  // execFn(fn: string | Function | null, ...args: Array<any>) {\n  //   if (fn == null) {\n  //     return null;\n  //   }\n  //   if (typeof fn === 'string') {\n  //     return this.fnMap.exec(fn, ...args);\n  //   }\n  //   return fn(...args);\n  // }\n\n  setFigure(figure: OBJ_FigureForElement) {\n    this.figure = figure;\n    if (figure != null) {\n      this.recorder = figure.recorder;\n      this.animationFinishedCallback = figure.animationFinished;\n    }\n    if (this.isTouchable) {\n      this.setTouchable();\n    }\n    if (this.isMovable) {\n      this.setMovable();\n    }\n  }\n\n  setTimeDelta(delta: number) {\n    if (this.animations.state === 'animating') {\n      this.animations.setTimeDelta(delta);\n    }\n    if (this.state.isPulsing && this.state.pulse.startTime != null) {\n      this.state.pulse.startTime += delta;\n    }\n    if (this.state.movement.previousTime != null) {\n      this.state.movement.previousTime += delta;\n    }\n  }\n\n\n  // Space definition:\n  //   * Pixel space: css pixels\n  //   * GL Space: x,y = -1 to 1\n  //   * Figure Space: x,y = figure limits\n  //   * Element space: Combination of element transform and its\n  //     parent transform's\n\n  // A figure element primitive vertex object lives in GL SPACE.\n  //\n  // A figure element has its own FIGURE ELEMENT SPACE, which is\n  // the GL space transformed by `this.transform`.\n  //\n  // A figure element is drawn in the FIGURE SPACE, by transforming\n  // the FIGURE ELEMENT SPACE by an incoming transformation matrix in the draw\n  // method. This incoming transformation matrix originates in the figure\n  // and waterfalls through each parent figure collection element to the\n  // current figure element.\n  //\n  // this.lastDrawTransformationMatrix captures how a vertex was drawn in\n  // the last frame, in FIGURE space as:\n  //   vertex\n  //     transformed by: FIGURE ELEMENT SPACE\n  //     transfromed by: FIGURE SPACE transform\n  //\n  // By default, webgl clip space is a unit space from (-1, 1) to (1, 1)\n  // independent of the aspect ratio of the canvas it is drawn on.\n  //\n  // A figure object can have its own clip space with arbitrary limits. e.g.:\n  //    * (-1, -1) to (1, 1)    similar to gl clip space\n  //    * (0, 0) to (2, 2)      similar to gl clip space but offset\n  //    * (0, 0) to (4, 2)      for rectangular aspect ratio figure\n  //\n  // The figure object clip space definition is stored in this.figureLimits.\n  //\n  // To therefore transform a vertex (from GL SPACE) to FIGURE CLIP SPACE:\n  //   * Take the vertex\n  //   * Transform it to FIGURE SPACE (by transforming it with the\n  //     lastDrawTransformMatrix)\n  //   * Transform it to FIGURE CLIP SPACE by scaling and offsetting it\n  //     to the clip space.\n  //\n  // Each figure element holds a FIGURE ELMENT CLIP space\n\n  updateHTMLElementTie(\n    figureCanvas: HTMLElement,\n  ) {\n    let tieToElement;\n    if (typeof this.tieToHTML.element === 'string') {\n      tieToElement = document.getElementById(this.tieToHTML.element);\n    }\n    if (tieToElement != null) {\n      const tie = tieToElement.getBoundingClientRect();\n      const canvas = figureCanvas.getBoundingClientRect();\n      const figure = this.figureLimits;\n      const dWindow = this.tieToHTML.window;\n      const cAspectRatio = canvas.width / canvas.height;\n      const dAspectRatio = figure.width / figure.height;\n      const tAspectRatio = tie.width / tie.height;\n      const wAspectRatio = dWindow.width / dWindow.height;\n\n      const topLeftPixels = new Point(\n        tie.left - canvas.left,\n        tie.top - canvas.top,\n      );\n      const bottomRightPixels = topLeftPixels.add(new Point(\n        tie.width, tie.height,\n      ));\n\n      const { pixelToFigure } = this.figureTransforms;\n      const topLeft = topLeftPixels.transformBy(pixelToFigure.m());\n      const bottomRight = bottomRightPixels.transformBy(pixelToFigure.m());\n      const width = bottomRight.x - topLeft.x;\n      const height = topLeft.y - bottomRight.y;\n      const center = topLeft.add(new Point(width / 2, -height / 2));\n\n      const scaleString = this.tieToHTML.scale.trim().toLowerCase();\n\n      let scaleX = 1;\n      let scaleY = 1;\n      const figureToWindowScaleX = figure.width / dWindow.width;\n      const figureToWindowScaleY = figure.height / dWindow.height;\n\n      // Window has no scaling impact on em, it only has impact on translation\n      if (scaleString.endsWith('em')) {\n        const scale = parseFloat(scaleString);\n        const em = parseFloat(getComputedStyle(tieToElement).fontSize);\n        // 0.2 is default font size in figure units\n        const defaultFontScale = figure.width / 0.2;\n        scaleX = scale * em * defaultFontScale / canvas.width;\n        scaleY = scale * em * defaultFontScale / dAspectRatio / canvas.height;\n      }\n\n      // Scale the maximum dimension of the window to the pixel value\n      if (scaleString.endsWith('px')) {\n        const maxPixels = parseFloat(scaleString);\n        if (wAspectRatio > 1) {\n          const scale = maxPixels / canvas.width;\n          scaleX = scale * figureToWindowScaleX;\n          scaleY = scale * cAspectRatio / dAspectRatio * figureToWindowScaleX;\n        } else {\n          const scale = maxPixels / canvas.height;\n          scaleX = scale / cAspectRatio * dAspectRatio * figureToWindowScaleY;\n          scaleY = scale * figureToWindowScaleY;\n        }\n      }\n\n      // Scale the window x to tie x, and window y to tie y\n      if (scaleString === 'stretch') {\n        scaleX = tie.width / canvas.width * figureToWindowScaleX;\n        scaleY = tie.height / canvas.height * figureToWindowScaleY;\n      }\n\n      // Scale so window either fits within the tie element, or fits only\n      // within the max dimension of the tie element\n      if (scaleString === 'max' || scaleString === 'fit') {\n        const fitHeightScale = new Point(\n          tie.height / canvas.height / cAspectRatio * dAspectRatio * figureToWindowScaleY,\n          tie.height / canvas.height * figureToWindowScaleY,\n        );\n\n        const fitWidthScale = new Point(\n          tie.width / canvas.width * figureToWindowScaleX,\n          tie.width / canvas.width * cAspectRatio / dAspectRatio * figureToWindowScaleX,\n        );\n\n        if (\n          (scaleString === 'max' && tAspectRatio > wAspectRatio)\n          || (scaleString === 'fit' && tAspectRatio < wAspectRatio)\n        ) {\n          scaleX = fitWidthScale.x;\n          scaleY = fitWidthScale.y;\n        } else {\n          scaleX = fitHeightScale.x;\n          scaleY = fitHeightScale.y;\n        }\n      }\n\n      this.setScale(scaleX, scaleY);\n\n      // Offset the element relative to the tie\n      this.setPosition(\n        center.x - scaleX * (this.tieToHTML.window.left + this.tieToHTML.window.width / 2),\n        center.y - scaleY * (this.tieToHTML.window.bottom + this.tieToHTML.window.height / 2),\n      );\n      this.setFirstTransform(this.getParentLastDrawTransform());\n    }\n  }\n\n  // eslint-disable-next-line no-unused-vars, class-methods-use-this\n  setFirstTransform(parentTransform: Transform) {\n  }\n\n  // animateToPulseTransforms(pulseTranforms: Array<Transform>) {\n  //   let startTransforms = this.pulseTransforms;\n  //   if (pulseTransforms.length != this.startTransforms.length) {\n  //     startTransforms = [];\n  //     for (let i = 0; i < pulseTranforms.length; i += 1) {\n  //       startTransforms.push(this.transform._dup());\n  //     }\n  //   }\n  // }\n\n  clearFrozenPulseTransforms() {\n    this.frozenPulseTransforms = [];\n  }\n\n  freezePulseTransforms(forceOverwrite: boolean = true) {\n    if (\n      (forceOverwrite && this.pulseTransforms.length === 0)\n      || (!forceOverwrite && this.pulseTransforms.length > 0)\n    ) {\n      this.frozenPulseTransforms = this.pulseTransforms.map(t => t._dup());\n    }\n  }\n\n  animateToState(\n    state: Object,\n    options: Object,\n    independentOnly: boolean = false,\n    startTime: ?number | 'now' | 'prevFrame' | 'nextFrame' = null,\n  ) {\n    // if (this.name === 'a') {\n    //   console.log(this.frozenPulseTransforms)\n    // }\n    const target = {};\n    if (\n      (this.isShown !== state.isShown && this.opacity === 1)\n      || this.opacity !== 1\n    ) {\n      // console.log('shown animation', this.getPath(), this.isShown, state.isShown)\n      target.isShown = state.isShown;\n    }\n    if (!areColorsWithinDelta(this.color, state.color, 0.001)) {\n      target.color = state.color;\n    }\n    const stateTransform = getTransform(state.transform);\n    if (\n      !this.transform.isWithinDelta(stateTransform, 0.001)\n      && (\n        this.dependantTransform === false\n        || independentOnly === false\n      )\n    ) {\n      target.transform = stateTransform;\n    }\n\n    let scenarioAnimation = null;\n    let duration = 0;\n    if (Object.keys(target).length > 0) {\n      const scenarioOptions = joinObjects({}, options, { target });\n      scenarioAnimation = this.anim.scenario(scenarioOptions);\n    }\n    // let pulseTrigger = null;\n    // let pulseDelay = null;\n    // let delay = 0;\n    let pulseAnimation = null;\n    if (!this.arePulseTransformsSame(state, 0.001)) {\n      let startPulseTransforms = this.pulseTransforms.map(t => t._dup());\n      if (this.pulseTransforms.length === 0) {\n        startPulseTransforms = this.frozenPulseTransforms.map(t => t._dup());\n      }\n      let targetPulseTransforms = state.pulseTransforms.map(t => getTransform(t));\n      if (targetPulseTransforms.length === 0 && state.frozenPulseTransforms.length > 0) {\n        targetPulseTransforms = state.frozenPulseTransforms.map(t => getTransform(t));\n      }\n      if (targetPulseTransforms.length === 0 && startPulseTransforms.length > 0) {\n        targetPulseTransforms = [startPulseTransforms[0].identity()];\n      }\n\n      pulseAnimation = this.anim.pulseTransform(joinObjects({}, options, {\n        start: startPulseTransforms,\n        target: targetPulseTransforms,\n      }));\n    }\n\n    if (scenarioAnimation != null || pulseAnimation != null) {\n      this.animations.new()\n        .inParallel([\n          scenarioAnimation,\n          pulseAnimation,\n        ])\n        // .then(scenarioAnimation)\n        // .then(pulseTrigger)\n        // .then(pulseDelay)\n        .start(startTime);\n    }\n\n    // if (this.animations.animations.length > 0) {\n    //   console.log(this.getPath(), this.animations.animations[0]._dup());\n    // }\n    if (scenarioAnimation != null) {\n      duration = Math.max(duration, scenarioAnimation.getTotalDuration());\n    }\n    if (pulseAnimation != null) {\n      duration = Math.max(duration, pulseAnimation.getTotalDuration());\n    }\n    // if (this.name === 'a') {\n    //   console.log(this.frozenPulseTransforms)\n    // }\n\n    return duration;\n  }\n\n  dissolveInToState(\n    state: Object,\n    duration: number = 0.8,\n    startTime: ?number | 'now' | 'prevFrame' | 'nextFrame' = null,\n  ) {\n    if (state.isShown === false) {\n      return 0;\n    }\n    // const target = {};\n    this.transform = getTransform(state.transform);\n    this.color = state.color.slice();\n    this.frozenPulseTransforms = [];\n    state.pulseTransforms.forEach(t => this.frozenPulseTransforms.push(getTransform(t)));\n    this.show();\n    this.animations.new()\n      .opacity({\n        target: state.opacity,\n        start: 0.001,\n        duration,\n      })\n      .trigger({\n        callback: () => {\n          this.frozenPulseTransforms = [];\n        },\n      })\n      .start(startTime);\n    return duration;\n  }\n\n  isStateSame(\n    state: Object,\n    mergePulseTransforms: boolean = false,\n    exceptions: Array<string> = [],\n  ) {\n    const p = this.getPath();\n    if (exceptions.indexOf(p) > -1) {\n      return true;\n    }\n    if (this.isShown !== state.isShown || Math.abs(this.opacity - state.opacity) > 0.001) {\n      return false;\n    }\n    if (!areColorsWithinDelta(this.color, state.color, 0.001)) {\n      return false;\n    }\n    if (!this.transform.isWithinDelta(getTransform(state.transform), 0.001)) {\n      return false;\n    }\n\n    if (mergePulseTransforms) {\n      if (!this.arePulseTransformsSame(state, 0.001)) {\n        return false;\n      }\n      return true;\n    }\n    if (state.pulseTransforms.length !== this.pulseTransforms.length) {\n      return false;\n    }\n    for (let i = 0; i < this.pulseTransforms.length; i += 1) {\n      if (!this.pulseTransforms[i].isWithinDelta(getTransform(state.pulseTransforms[i]), 0.001)) {\n        return false;\n      }\n    }\n    return true;\n  }\n\n  arePulseTransformsSame(state: Object, delta: number = 0.001) {\n    let statePulseTransforms = [];\n    let pulseTransforms = [];\n    statePulseTransforms = transformBy([this.transform._dup()], state.pulseTransforms);\n    statePulseTransforms = transformBy(statePulseTransforms, state.frozenPulseTransforms);\n\n    pulseTransforms = transformBy([this.transform._dup()], this.pulseTransforms);\n    pulseTransforms = transformBy(pulseTransforms, this.frozenPulseTransforms);\n\n    if (pulseTransforms.length !== statePulseTransforms.length) {\n      return false;\n    }\n    for (let i = 0; i < pulseTransforms.length; i += 1) {\n      if (!pulseTransforms[i].isWithinDelta(statePulseTransforms[i], delta)) {\n        return false;\n      }\n    }\n    return true;\n  }\n\n  getDrawTransforms(initialTransforms: Array<Transform>) {\n    // let drawTransforms = [transform];\n    let drawTransforms = transformBy(initialTransforms, this.copyTransforms);\n    drawTransforms = transformBy(drawTransforms, this.pulseTransforms);\n    drawTransforms = transformBy(drawTransforms, this.frozenPulseTransforms);\n    return drawTransforms;\n  }\n\n  exec(\n    execFunctionAndArgs: string | Array<string | Object>,\n  ) {\n    // if (elementsToExec == null || typeof elementsToExec === 'function') {\n    let execFunc;\n    let args;\n    if (Array.isArray(execFunctionAndArgs)) {\n      [execFunc, ...args] = execFunctionAndArgs;\n    } else {\n      execFunc = execFunctionAndArgs;\n    }\n\n    // $FlowFixMe\n    if (this[execFunc] != null && typeof this[execFunc] === 'function') {\n      if (args === undefined) {\n        // $FlowFixMe\n        this[execFunc]();\n      } else {\n        // $FlowFixMe\n        this[execFunc](...args);\n      }\n    }\n  }\n\n  // pulseScaleRelativeTo(\n  //   e: FigureElement | TypeParsablePoint | null,\n  //   x: 'left' | 'center' | 'right' | 'origin' | number,\n  //   y: 'bottom' | 'middle' | 'top' | 'origin' | number,\n  //   space: 'figure' | 'gl' | 'draw' | 'local',\n  //   time: number,\n  //   scale: number,\n  //   frequency: number = 0,\n  //   callback: ?(?mixed) => void = null,\n  // ) {\n  //   if (e == null || e instanceof FigureElement) {\n  //     this.pulseScaleRelativeToElement(e, x, y, space, time, scale, frequency, callback);\n  //   } else {\n  //     this.pulseScaleRelativeToPoint(e, space, time, scale, frequency, callback)\n  //   }\n  // }\n\n\n  // pulseLegacy(done: ?(mixed) => void = null) {\n  //   if (\n  //     typeof this.pulseDefault === 'function'\n  //     || typeof this.pulseDefault === 'string'\n  //   ) {\n  //     this.execFn(this.pulseDefault, done);\n  //   } else {\n  //     const { frequency, time, scale } = this.pulseDefault;\n  //     this.pulseScaleNow(time, scale, frequency, done);\n  //   }\n  // }\n\n  getElement() {\n    return this;\n  }\n\n  getElements() {\n    return [this];\n  }\n\n  // eslint-disable-next-line no-unused-vars, class-methods-use-this\n  highlight() {\n    this.undim();\n  }\n\n\n  /**\n   * Conveniently set the first `translation` of the element's `transform`.\n   * @param {TypeParsablePoint | number} pointOrX x coordinate or full point\n   * definition\n   * @param {number} y y coordinate if `pointOrX` is just the x coordinate (`0`)\n   */\n  setPosition(pointOrX: TypeParsablePoint | number, y: number = 0) {\n    let position;\n    if (typeof pointOrX === 'number') {\n      position = new Point(pointOrX, y);\n    } else {\n      position = getPoint(pointOrX);\n    }\n    // let position = getPoint(pointOrX);\n    // if (typeof pointOrX === 'number') {\n    //   position = new Point(pointOrX, y);\n    // }\n    const currentTransform = this.transform._dup();\n    currentTransform.updateTranslation(position);\n    this.setTransform(currentTransform);\n  }\n\n  /**\n   * Conveniently set the first `rotation` of the element's `transform`.\n   * @param {number} rotation\n   */\n  setRotation(rotation: number) {\n    const currentTransform = this.transform._dup();\n    currentTransform.updateRotation(rotation);\n    this.setTransform(currentTransform);\n  }\n\n  /**\n   * Conveniently set the first `scale` of the element's `transform`.\n   * @param {TypeParsablePoint | number} scaleOrX horizontal scale - either\n   * define as full x-y point, or as a number. If scaleOrX is a `number` and\n   * `y` is null, then both `x` and `y` will be equally scaled\n   * @param {number | null} y y coordinate if `scaleOrX` is a `number` (`null`)\n   */\n  setScale(scaleOrX: TypeParsablePoint | number, y: ?number = null) {\n    let scale;\n    if (typeof scaleOrX === 'number') {\n      if (typeof y === 'number') {\n        scale = new Point(scaleOrX, y);\n      } else {\n        scale = new Point(scaleOrX, scaleOrX);\n      }\n    } else {\n      scale = getPoint(scaleOrX);\n    }\n    // let scale = getPoint(scaleOrX);\n    // if (typeof scaleOrX === 'number') {\n    //   if (y == null) {\n    //     scale = new Point(scaleOrX, scaleOrX);\n    //   } else {\n    //     scale = new Point(scaleOrX, y);\n    //   }\n    // }\n    const currentTransform = this.transform._dup();\n    currentTransform.updateScale(scale);\n    this.setTransform(currentTransform);\n  }\n\n  // Use this method to set the element's transform in case a callback has been\n  // connected that is tied to an update of the transform.\n  /**\n   * Set transform of element. Setting through this method will ensure\n   * `setTransfrom` subscription will publish, and transform will be\n   * appropriately clipped.\n   * @param {Transform} transform\n   */\n  setTransform(transform: Transform): void {\n    if (this.move.transformClip != null) {\n      const clip = this.fnMap.exec(this.move.transformClip, transform);\n      if (clip instanceof Transform) {\n        this.subscriptions.publish('beforeSetTransform', [clip]);\n        if (this.cancelSetTransform === false) {\n          this.transform = clip;\n        } else {\n          this.cancelSetTransform = false;\n        }\n      }\n    } else {\n      // this.checkMoveBounds();\n      const bounds = this.getMoveBounds();\n      // console.log(bounds)\n      // if (this.move.bounds instanceof TransformBounds) {\n      // this.subscriptions.publish('beforeSetTransform', [clip]);\n      // $FlowFixMe\n      const clip = bounds.clip(transform);\n      this.subscriptions.publish('beforeSetTransform', [clip]);\n      if (this.cancelSetTransform === false) {\n        this.transform = clip;\n      } else {\n        this.cancelSetTransform = false;\n      }\n      // } else {\n      //   this.transform = transform._dup();\n      // }\n      // }\n    }\n    if (this.internalSetTransformCallback) {\n      this.fnMap.exec(this.internalSetTransformCallback, this.transform);\n    }\n    this.subscriptions.publish('setTransform', [this.transform]);\n    this.fnMap.exec(this.setTransformCallback, this.transform);\n    this.animateNextFrame();\n  }\n\n  // Set the next transform (and velocity if moving freely) for the next\n  // animation frame.\n  //\n  // If animating, this transform will be the next frame determined by\n  // the currently executing animation phase. If time exceeds the current\n  // phase, then either the next phase will be started, or if there are no\n  // more phases, the animation will complete.\n  //\n  // If moving freely, this method will set the next velocity and transform\n  // based on the current velocity, current transform, elapsed time,\n  // deceleration (in freelyProperties) and zeroVelocityThreshold.\n  // Once the velocity goes to zero, this metho will stop the element moving\n  // freely.\n  nextMovingFreelyFrame(now: number): void {\n    // If the element is moving freely, then calc it's next velocity and\n    // transform. Save the new velocity into state.movement and return the\n    // transform.\n    if (this.state.isMovingFreely) {\n      // If this is the first frame of moving freely, then record the current\n      // time so can calculate velocity on next frame\n      if (this.state.movement.previousTime == null) {\n        this.state.movement.previousTime = now;\n        return;\n      }\n      // If got here, then we are now after the first frame, so calculate\n      // the delta time from this frame to the previous\n      const deltaTime = now - this.state.movement.previousTime;\n      // Calculate the new velocity and position\n      const next = this.decelerate(deltaTime);\n      this.state.movement.velocity = next.velocity;\n      this.state.movement.previousTime = now;\n\n      // If the velocity is 0, then stop moving freely and return the current\n      // transform\n      if (this.state.movement.velocity.isZero()) {\n        this.state.movement.velocity = this.state.movement.velocity.zero();\n        this.stopMovingFreely('complete');\n      }\n      this.setTransform(next.transform);\n    }\n  }\n\n  // Used only to clear 2D context\n  // eslint-disable-next-line class-methods-use-this\n  clear() {\n  }\n\n  willStartAnimating() {\n    if (this.animations.willStartAnimating()) {\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   Set element color.\n   @param {[number, number, number, number]} color RGBA color from 0 to 1\n   @param {boolean} [setDefault] also set the default color to this color\n   */\n  setColor(color: TypeColor, setDefault: boolean = true) {\n    this.color = color != null ? color.slice() : [0, 0, 0, 0];\n    if (setDefault) {\n      this.defaultColor = this.color.slice();\n    }\n    this.animateNextFrame();\n  }\n\n  /**\n   * Set element color to `dimColor`\n   */\n  dim() {\n    this.setColor(this.dimColor, false);\n  }\n\n  /**\n   * Set `dimColor` property\n   */\n  setDimColor(color: TypeColor) {\n    this.dimColor = color != null ? color.slice() : [0, 0, 0, 0];\n  }\n\n  /**\n   * Set element color to `defaultColor`\n   */\n  undim() {\n    this.setColor(this.defaultColor, true);\n  }\n\n  setOpacity(opacity: number) {\n    // this.color[3] = opacity;\n    this.opacity = opacity;\n    this.animateNextFrame();\n  }\n\n  // getScenarioTargetLegacy(\n  //   scenarioName: string,\n  // ) {\n  //   let target = this.transform._dup();\n  //   if (scenarioName in this.scenarios) {\n  //     const scenario = this.scenarios[scenarioName];\n  //     if (scenario.transform != null) {\n  //       target = getTransform(scenario.transform);\n  //     }\n  //     if (scenario.position != null) {\n  //       target.updateTranslation(getPoint(scenario.position));\n  //     }\n\n  //     if (scenario.rotation != null) {\n  //       target.updateRotation(scenario.rotation);\n  //     }\n  //     if (scenario.scale != null) {\n  //       target.updateScale(getScale(scenario.scale));\n  //     }\n  //   }\n  //   return target;\n  // }\n\n  // retrieve a scenario\n  getScenarioTarget(\n    scenarioIn: ?string | OBJ_Scenario,\n  ): { transform?: Transform, color?: TypeColor, isShown?: boolean } {\n    let transform;\n    let color;\n    let isShown;\n    let scenario;\n    if (scenarioIn == null) {\n      return {};\n    }\n    if (typeof scenarioIn === 'string') {\n      if (scenarioIn in this.scenarios) {\n        scenario = this.scenarios[scenarioIn];\n      } else {\n        scenario = {};\n      }\n    } else {\n      scenario = scenarioIn;\n    }\n\n    if (scenario.transform != null) {\n      transform = getTransform(scenario.transform);\n    }\n    if (scenario.position != null) {\n      if (transform == null) {\n        transform = this.transform._dup();\n      }\n      transform.updateTranslation(getPoint(scenario.position));\n    }\n\n    if (scenario.translation != null) {\n      if (transform == null) {\n        transform = this.transform._dup();\n      }\n      transform.updateTranslation(getPoint(scenario.translation));\n    }\n\n    if (scenario.rotation != null) {\n      if (transform == null) {\n        transform = this.transform._dup();\n      }\n      transform.updateRotation(scenario.rotation);\n    }\n    if (scenario.scale != null) {\n      if (transform == null) {\n        transform = this.transform._dup();\n      }\n      transform.updateScale(getScale(scenario.scale));\n    }\n    if (scenario.color) {\n      color = scenario.color.slice();\n    }\n    if (scenario.isShown != null) {\n      ({ isShown } = scenario);\n    }\n    return {\n      transform,\n      color,\n      isShown,\n    };\n  }\n\n  /**\n   * Set transform, color and/or visibility to a predefined scenario.\n   *\n   * @param {string | Array<string>} [scenarioName] name of the scenario to\n   * set. Use an array of names to set multiple scenarios in the array's order.\n   * @param {boolean} [onlyIfVisible] `true` to only set scenario if element is\n   * visible\n   */\n  setScenario(scenario: string | OBJ_Scenario) {\n    const target = this.getScenarioTarget(scenario);\n    if (target.transform != null) {\n      this.setTransform(target.transform._dup());\n    }\n    // this.setColor(target.color.slice());\n    if (target.isShown != null) {\n      if (target.isShown) {\n        this.show();\n      } else {\n        this.hide();\n      }\n    }\n    if (target.color != null) {\n      this.setColor(target.color);\n    }\n  }\n\n  setScenarios(scenarioName: string | Array<string>) {\n    let scenarios = scenarioName;\n    if (!Array.isArray(scenarios)) {\n      scenarios = [scenarios];\n    }\n    scenarios.forEach((scenario) => {\n      if (this.scenarios[scenario] != null) {\n        this.setScenario(scenario);\n      }\n    });\n  }\n\n  /**\n   * Save the current transform, color and/or visibility to a scenario.\n   */\n  saveScenario(\n    scenarioName: string,\n    keys: Array<string> = ['transform', 'color', 'isShown'],\n  ) {\n    const scenario = this.getCurrentScenario(keys);\n    if (Object.keys(scenario).length > 0) {\n      this.scenarios[scenarioName] = scenario;\n    }\n  }\n\n  getCurrentScenario(\n    keys: Array<string> = ['transform', 'color', 'isShown'],\n  ) {\n    const scenario = {};\n    keys.forEach((key) => {\n      if (key === 'transform') {\n        scenario.transform = this.transform._dup();\n      } else if (key === 'position') {\n        scenario.position = this.getPosition();\n      } else if (key === 'rotation') {\n        scenario.rotation = this.getRotation();\n      } else if (key === 'scale') {\n        scenario.scale = this.getScale();\n      } else if (key === 'color') {\n        scenario.color = this.color.slice();\n      } else if (key === 'isShown') {\n        scenario.isShown = this.isShown;\n      }\n    });\n    return scenario;\n  }\n\n  saveScenarios(scenarioName: string, keys: Array<string>) {\n    this.saveScenario(scenarioName, keys);\n  }\n\n  // animateToScenario() {\n\n  // }\n\n  getAllElementsWithScenario(scenarioName: string) {\n    if (this.scenarios[scenarioName] != null) {\n      return [this];\n    }\n    return [];\n  }\n\n  getMovingFreelyEnd() {\n    return this.decelerate(null);\n  }\n\n  getRemainingMovingFreelyTime() {\n    if (this.state.isMovingFreely) {\n      return this.decelerate(null).duration;\n    }\n    return 0;\n  }\n\n  // Decelerate over some time when moving freely to get a new element\n  // transform and movement velocity\n  decelerate(deltaTime: number | null = null): Object {\n    // let bounds;\n    // if (!this.move.bounds instanceof TransformBounds) {\n    //   this.setMoveBounds();\n    // }\n    // if (!this.move.bounds instanceof TransformBounds) {\n    //   bounds = new TransformBounds(this.transform);\n    // } else {\n    //   ({ bounds } = this.move);\n    // }\n    // this.checkMoveBounds();\n    // const { bounds } = this.move;\n    const bounds = this.getMoveBounds();\n\n    const next = this.transform.decelerate(\n      this.state.movement.velocity,\n      this.move.freely.deceleration,\n      deltaTime,  // $FlowFixMe\n      bounds,\n      this.move.freely.bounceLoss,\n      this.move.freely.zeroVelocityThreshold,\n    );\n    return {\n      velocity: next.velocity,\n      transform: next.transform,\n      duration: next.duration,\n    };\n  }\n\n  // getMoveBoundsRelativeToSize() {\n  //   if (this.move.includeSizeInBounds) {\n  //     const size = this.getBoundingRect('figure');\n  //     //asdfasdf\n  //   }\n  //   return this.move.bound\n  // }\n\n  updateLastDrawTransform() {\n    const { parentCount } = this.lastDrawElementTransformPosition;\n    const pLength = this.lastDrawTransform.order.length;\n    const transform = this.getTransform();\n    transform.order.forEach((t, index) => {\n      this.lastDrawTransform.order[pLength - parentCount - index - 1] = t._dup();\n    });\n    this.lastDrawTransform.calcAndSetMatrix();\n  }\n\n  getParentLastDrawTransform() {\n    const { parentCount } = this.lastDrawElementTransformPosition;\n    return new Transform(this.lastDrawTransform.order.slice(-parentCount));\n  }\n\n  /**\n   * Return figure path of element\n   * @return {string} path of element relative to figure\n   */\n  getPath() {\n    if (this.parent == null) {\n      return this.name;\n    }\n    if (this.parent.name === 'figureRoot' || this.parent.parent == null) {\n      return this.name;\n    }\n    return `${this.parent.getPath()}.${this.name}`;\n  }\n\n  // getPause() {\n  //   return this.state.pause;\n  // }\n\n  // Being Moved\n  startBeingMoved(): void {\n    // this.stopAnimating();\n    this.animations.cancelAll('freeze');\n    this.stopMovingFreely('freeze');\n    this.state.movement.velocity = this.transform.zero();\n    this.state.movement.previousTransform = this.transform._dup();\n    this.state.movement.previousTime = new GlobalAnimation().now() / 1000;\n    this.state.isBeingMoved = true;\n    this.unrender();\n    this.subscriptions.publish('startBeingMoved');\n    if (this.recorder.state === 'recording') {\n      this.recorder.recordEvent('startBeingMoved', [this.getPath()]);\n    }\n  }\n\n  moved(newTransform: Transform): void {\n    const prevTransform = this.transform._dup();\n    this.setTransform(newTransform._dup());\n    let tBounds;\n    if (this.move.bounds != null) {  // $FlowFixMe\n      tBounds = this.move.bounds.getTranslation();\n    }\n    // In a finite rect bounds, if we calculate the velocity from the clipped\n    // transform, the object will skip along the wall if the user lets the\n    // object go after intersecting with the wall\n    if (\n      tBounds instanceof RectBounds\n      && tBounds.boundary.right > tBounds.boundary.left\n      && tBounds.boundary.top > tBounds.boundary.bottom\n    ) {\n      this.calcVelocity(prevTransform, newTransform);\n    } else {\n      this.calcVelocity(prevTransform, this.transform);\n    }\n    // if (\n    //   this.move.bounds.getTranslation instanceof LineBounds\n    //   || this.move.bounds.getTranslation()\n    // ) {\n    //   this.calcVelocity(prevTransform, this.transform);\n    // } else {\n    //   this.calcVelocity(prevTransform, newTransform);\n    // }\n    if (this.recorder.state === 'recording') {\n      this.recorder.recordEvent(\n        'moved',\n        [\n          this.getPath(),\n          this.transform.round(this.recorder.precision)._state(),\n        ],\n        // this.state.movement.velocity.toString(),\n      );\n    }\n  }\n\n  stopBeingMoved(): void {\n    if (!this.state.isBeingMoved) {\n      return;\n    }\n    const currentTime = new GlobalAnimation().now() / 1000;\n    // Check wether last movement was a long time ago, if it was, then make\n    // velocity 0 as the user has stopped moving before releasing touch/click\n    if (this.state.movement.previousTime != null) {\n      if ((currentTime - this.state.movement.previousTime) > 0.05) {\n        this.state.movement.velocity = this.transform.zero();\n      }\n    }\n    this.subscriptions.publish('stopBeingMoved');\n    if (this.recorder.state === 'recording' && this.state.isBeingMoved) {\n      this.recorder.recordEvent(\n        'stopBeingMoved',\n        [\n          this.getPath(),\n          this.transform._state(),\n          this.state.movement.velocity._state(),\n        ],\n        // this.state.movement.velocity.toString(),\n      );\n    }\n    this.state.isBeingMoved = false;\n    this.state.movement.previousTime = null;\n  }\n\n  calcVelocity(prevTransform: Transform, nextTransform: Transform): void {\n    const currentTime = new GlobalAnimation().now() / 1000;\n    if (this.state.movement.previousTime == null) {\n      this.state.movement.previousTime = currentTime;\n      return;\n    }\n    // console.log(currentTime, this.state.movement.previousTime)\n    const deltaTime = currentTime - this.state.movement.previousTime;\n\n    // If the time is too small, weird calculations may happen\n    if (deltaTime < 0.0001) {\n      return;\n    }\n    this.state.movement.velocity = nextTransform.velocity(\n      prevTransform,\n      deltaTime,\n      this.move.freely.zeroVelocityThreshold,\n      this.move.maxVelocity,\n    );\n    this.state.movement.previousTime = currentTime;\n  }\n\n  simulateStartMovingFreely(transform: Transform, velocity: Transform) {\n    this.transform = transform;\n    this.state.movement.velocity = velocity;\n    this.startMovingFreely();\n  }\n\n  // Moving Freely\n  startMovingFreely(callback: ?(string | ((boolean) => void)) = null): void {\n    // this.stopAnimating();\n    this.animations.cancelAll('freeze');\n    this.stopBeingMoved();\n    if (callback) {\n      // this.animate.transform.callback = callback;\n      this.move.freely.callback = callback;\n    }\n    this.state.isMovingFreely = true;\n    // this.state.movement.previousTime = null;\n    this.state.movement.previousTime = new GlobalAnimation().now() / 1000;\n    this.state.movement.velocity = this.state.movement.velocity.clipMag(\n      this.move.freely.zeroVelocityThreshold,\n      this.move.maxVelocity,\n    );\n    if (this.recorder.state === 'recording') {\n      this.recorder.recordEvent(\n        'startMovingFreely',\n        [\n          this.getPath(),\n          this.transform._state(),\n          this.state.movement.velocity._state(),\n        ],\n        // this.state.movement.velocity.toString(),\n      );\n    }\n  }\n\n  stopMovingFreely(how: 'freeze' | 'cancel' | 'complete' | 'animateToComplete' | 'dissolveToComplete' = 'cancel'): void {\n    if (how === 'animateToComplete') {\n      return;\n    }\n    // console.log(how)\n    let wasMovingFreely = false;\n    if (this.state.isMovingFreely === true) {\n      wasMovingFreely = true;\n    }\n    if (how === 'complete' && wasMovingFreely) {\n      const result = this.getMovingFreelyEnd();\n      this.setTransform(result.transform);\n    }\n\n    this.state.isMovingFreely = false;\n    this.state.movement.previousTime = null;\n    if (this.move.freely.callback) {\n      this.fnMap.exec(this.move.freely.callback, how);\n      this.move.freely.callback = null;\n    }\n    if (wasMovingFreely) {\n      this.fnMap.exec(this.animationFinishedCallback);\n      this.animationFinished('movingFreely');\n      this.subscriptions.publish('stopMovingFreely');\n    }\n  }\n\n  getRemainingPulseTime(now: number = new GlobalAnimation().now() / 1000) {\n    if (this.state.isPulsing === false) {\n      return 0;\n    }\n    if (this.state.pulse.startTime == null) {\n      return this.pulseSettings.time;\n    }\n    return this.pulseSettings.time - (now - this.state.pulse.startTime);\n  }\n\n  // Take an input transform matrix, and output a list of transform matrices\n  // that have been transformed by a pulse. The first matrix in the list\n  // will be the largest, so when saving lastDrawTransformMatrix it can be\n  // used to determine if a touch has occured in the object.\n  //\n  // When an object is animated or moved, it's new transform is saved as the\n  // new transform of the object. In contrast, pulsing is not saved as the\n  // current transform of the object, and is used only in the current draw\n  // of the element.\n  getPulseTransforms(now: number): Array<Transform> {\n    const pulseTransforms = [];    // To output list of transform matrices\n    // If the figure element is currently pulsing, the calculate the current\n    // pulse magnitude, and transform the input matrix by the pulse\n    if (this.state.isPulsing) {\n      // If this is the first pulse frame, then set the startTime\n      if (this.state.pulse.startTime == null) {\n        this.state.pulse.startTime = now;\n      }\n      // Calculate how much time has elapsed between this frame and the first\n      // pulse frame\n      let deltaTime = now - this.state.pulse.startTime;\n      // If the elapsed time is larger than the planned pulse time, then\n      // clip the elapsed time to the pulse time, and end pulsing (after this\n      // draw). If the pulse time is 0, that means pulsing will loop\n      // indefinitely.\n      if (deltaTime >= this.pulseSettings.time && this.pulseSettings.time !== 0) {\n        // this.state.isPulsing = false;\n        this.stopPulsing('complete');\n        deltaTime = this.pulseSettings.time;\n      }\n\n      // Go through each pulse matrix planned, and transform the input matrix\n      // with the pulse.\n      for (let i = 0; i < this.pulseSettings.num; i += 1) {\n        // Get the current pulse magnitude\n        const pulseMag = this.fnMap.exec(\n          this.pulseSettings.progression,\n          deltaTime,\n          this.pulseSettings.frequency,\n          this.pulseSettings.A instanceof Array ? this.pulseSettings.A[i] : this.pulseSettings.A,\n          this.pulseSettings.B instanceof Array ? this.pulseSettings.B[i] : this.pulseSettings.B,\n          this.pulseSettings.C instanceof Array ? this.pulseSettings.C[i] : this.pulseSettings.C,\n        );\n\n        // Use the pulse magnitude to get the current pulse transform\n        const pTransform = this.fnMap.exec(\n          this.pulseSettings.transformMethod,\n          pulseMag,\n          getPoint(this.pulseSettings.delta),\n          this.pulseSettings.type,\n        );\n        // console.log(this.name, this.transform._dup(), pTransform.matrix());\n        // if (this.name === 'p2') {\n        //   console.log(pTransform._dup(), pulseMag)\n        // }\n        // if(this.name === '_radius') {\n        // }\n        // Transform the current transformMatrix by the pulse transform matrix\n        // const pMatrix = m2.mul(m2.copy(transform), pTransform.matrix());\n\n        // Push the pulse transformed matrix to the array of pulse matrices\\\n        if (pTransform != null) {\n          pulseTransforms.push(pTransform);\n        }\n      }\n    // If not pulsing, then make no changes to the transformMatrix.\n    }\n    return pulseTransforms;\n  }\n\n  /**\n   * Pulse element.\n   *\n   * An element can be pulsed in scale, a rotation or a translation.\n   *\n   * The scale pulse can either be a single pulse, or a number of copies with a\n   * range of scales - which has the effect of making regular polygons thick.\n   *\n   * Either pass in a callback, or an options object defining the pulse and\n   * callback.\n   *\n   * @param {null | OBJ_Pulse | () => void} optionsOrDone\n   */\n  pulse(optionsOrDone: null | OBJ_Pulse | () => void = null) {\n    if (\n      typeof this.pulseDefault === 'function'\n      || typeof this.pulseDefault === 'string'\n    ) {\n      let done = null;\n      if (typeof optionsOrDone === 'function') {\n        done = optionsOrDone;\n      } else if (optionsOrDone != null && optionsOrDone.done != null) {\n        ({ done } = optionsOrDone);\n      }\n      this.fnMap.exec(this.pulseDefault, done);\n      return;\n    }\n\n    const defaultOptions = this.pulseDefault;\n    let done = null;\n    let options;\n\n    if (typeof optionsOrDone === 'function' || typeof optionsOrDone === 'string') {\n      options = joinObjects({}, defaultOptions);\n      done = optionsOrDone;\n    } else if (optionsOrDone == null) {\n      options = joinObjects({}, defaultOptions);\n      done = null;\n    } else {\n      options = joinObjects({}, defaultOptions, optionsOrDone);\n      ({ done } = options);\n    }\n\n    if (options.progression === 'sinusoid') {\n      options.progression = 'tools.math.sinusoid';\n    } else if (options.progression === 'sinusoidAbs') {\n      options.progression = 'tools.math.sinusoidAbs';\n    } else if (options.progression === 'triangle') {\n      options.progression = 'tools.math.triangle';\n    }\n\n    const {\n      centerOn, xAlign, yAlign, space,\n    } = options;\n\n    let delta;\n    if (centerOn == null) {\n      delta = new Point(0, 0);\n    } else if (centerOn === 'this') {\n      delta = this.getPositionInBounds('figure', xAlign, yAlign)\n        .transformBy(this.spaceTransformMatrix('figure', 'draw'));\n    } else if (centerOn instanceof FigureElement) {\n      delta = centerOn.getPositionInBounds('figure', xAlign, yAlign)\n        .transformBy(this.spaceTransformMatrix('figure', 'draw'));\n    } else {\n      delta = getPoint(centerOn)\n        .transformBy(this.spaceTransformMatrix(space, 'draw'));\n    }\n\n    const {\n      duration, scale, progression, when, num, rotation, angle, translation,\n    } = options;\n    let {\n      min, start, frequency,\n    } = options;\n\n    if (frequency === 0 || frequency == null) {\n      frequency = duration === 0 ? 1 : 1 / duration;\n    }\n\n    let max;\n    if (translation != null) {\n      start = start == null ? 0 : start;\n      max = translation;\n    } else if (rotation != null) {\n      start = start == null ? 0 : start;\n      max = rotation;\n    } else {\n      start = start == null ? 1 : start;\n      max = scale;\n    }\n\n    min = min == null ? start : min;\n    const range = max - min;\n\n    if (num > 1) {\n      const bStep = range / (num - 1);\n      const BArray = [];\n      const CArray = [];\n      const AArray = [];\n      for (let i = 0; i < num; i += 1) {\n        const minMax = max - i * bStep;\n        if (minMax < start) {\n          const r = start - minMax;\n          CArray.push(Math.PI / 2);\n          AArray.push(start - r / 2);\n          BArray.push(r / 2);\n        } else {\n          const r = minMax - start;\n          CArray.push(-Math.PI / 2);\n          AArray.push(start + r / 2);\n          BArray.push(r / 2);\n        }\n      }\n      this.pulseSettings.A = AArray;\n      this.pulseSettings.B = BArray;\n      this.pulseSettings.C = CArray;\n    } else {\n      const mid = range / 2 + min;\n      const startNormalized = range !== 0 ? (start - mid) / (range / 2) : start;\n      this.pulseSettings.A = mid;\n      this.pulseSettings.B = range / 2;\n      this.pulseSettings.C = Math.asin(round(startNormalized, 10));\n      // console.log(this.name, this.pulseSettings, range, min, mid, start, startNormalized)\n    }\n\n    this.pulseSettings.time = duration;\n    this.pulseSettings.frequency = frequency;\n    this.pulseSettings.num = num;\n    this.pulseSettings.delta = delta;\n    this.pulseSettings.callback = done;\n    this.pulseSettings.progression = progression;\n    this.pulseSettings.type = 'scale';\n    if (rotation != null) {\n      this.pulseSettings.type = 'rotation';\n    }\n    if (translation != null) {\n      this.pulseSettings.type = angle;\n    }\n    this.startPulsing(when);\n    // console.log(this.figure)\n    // this.figure.animateNextFrame();\n  }\n\n  // deprecate\n  pulseScaleNow(\n    time: number, scale: number,\n    frequency: number = 0, callback: ?(string | ((?mixed) => void)) = null,\n    delta: TypeParsablePoint = new Point(0, 0),\n    progression: string | (number) => number = 'tools.math.sinusoid',\n  ) {\n    this.pulseScale({\n      duration: time,\n      scale,\n      frequency,\n      callback,\n      delta,\n      progression,\n      when: 'nextFrame',\n    });\n  }\n\n  // deprecate\n  pulseScale(optionsIn: {\n    duration?: number,\n    scale?: number,\n    callback?: ?(string | ((?mixed) => void)),\n    delta?: TypeParsablePoint,\n    when?: TypeWhen,\n    progression?: string | (number) => number,\n  }) {\n    const options = joinObjects({}, {\n      duration: 1,\n      scale: 2,\n      callback: null,\n      delta: [0, 0],\n      when: 'syncNow',\n      progression: 'tools.math.sinusoid',\n    }, optionsIn);\n\n    if (\n      options.frequency == null\n      || (options.frequency === 0 && options.duration !== 0)\n    ) {\n      options.frequency = 1 / (options.duration * 2);\n    }\n    if (options.frequency === 0 && options.duration === 0) {\n      options.frequency = 1;\n    }\n    this.pulseSettings.time = options.duration;\n    this.pulseSettings.frequency = options.frequency;\n    this.pulseSettings.A = 1;\n    this.pulseSettings.B = options.scale - 1;\n    this.pulseSettings.C = 0;\n    this.pulseSettings.num = 1;\n    this.pulseSettings.delta = getPoint(options.delta);\n    // this.pulseSettings.transformMethod = s => new Transform().scale(s, s);\n    this.pulseSettings.callback = options.callback;\n    this.pulseSettings.progression = options.progression;\n    this.startPulsing(options.when);\n  }\n\n  // deprecate\n  pulseScaleRelativeToPoint(\n    p: TypeParsablePoint,\n    space: 'figure' | 'gl' | 'draw' | 'local',\n    time: number,\n    scale: number,\n    frequency: number = 0,\n    callback: ?(string | ((?mixed) => void)) = null,\n    progression: string | (number) => number = 'tools.math.sinusoid',\n  ) {\n    const currentPosition = this.getPosition(space);\n    const delta = getPoint(p).sub(currentPosition);\n    this.pulseScaleNow(time, scale, frequency, callback, delta, progression);\n  }\n\n  // deprecate\n  pulseScaleRelativeToElement(\n    e: ?FigureElement,\n    x: 'left' | 'center' | 'right' | 'location' | number,\n    y: 'bottom' | 'middle' | 'top' | 'location' | number,\n    space: 'figure' | 'gl' | 'draw' | 'local',\n    time: number,\n    scale: number,\n    frequency: number = 0,\n    callback: ?(string | ((?mixed) => void)) = null,\n    progression: string | (number) => number = 'tools.math.sinusoid',\n  ) {\n    let p;\n    if (e == null) {\n      p = this.getPositionInBounds(space, x, y);\n    } else {\n      p = e.getPositionInBounds(space, x, y);\n    }\n    this.pulseScaleRelativeToPoint(p, space, time, scale, frequency, callback, progression);\n  }\n\n  // deprecate\n  pulseScaleRelativeTo(\n    e: FigureElement | TypeParsablePoint | null,\n    x: 'left' | 'center' | 'right' | 'origin' | number,\n    y: 'bottom' | 'middle' | 'top' | 'origin' | number,\n    space: 'figure' | 'gl' | 'draw' | 'local',\n    time: number,\n    scale: number,\n    frequency: number = 0,\n    callback: ?(string | ((?mixed) => void)) = null,\n    progression: string | (number) => number = 'tools.math.sinusoid',\n  ) {\n    if (e == null || e instanceof FigureElement) {\n      this.pulseScaleRelativeToElement(  // $FlowFixMe\n        e, x, y, space, time, scale, frequency, callback, progression,\n      );\n    } else {\n      this.pulseScaleRelativeToPoint(\n        e, space, time, scale, frequency, callback, progression,\n      );\n    }\n  }\n\n  // deprecate\n  pulseThickNow(\n    time: number, scale: number,\n    num: number = 3, callback: ?(string | ((?mixed) => void)) = null,\n  ) {\n    let bArray = [scale];\n    this.pulseSettings.num = num;\n    if (this.pulseSettings.num > 1) {\n      const b = Math.abs(1 - scale);\n      const bMax = b;\n      const bMin = -b;\n      const range = bMax - bMin;\n      const bStep = range / (this.pulseSettings.num - 1);\n      bArray = [];\n      for (let i = 0; i < this.pulseSettings.num; i += 1) {\n        bArray.push(bMax - i * bStep);\n      }\n    }\n    this.pulseSettings.time = time;\n    this.pulseSettings.frequency = 1 / (time * 2);\n    this.pulseSettings.A = 1;\n    this.pulseSettings.B = bArray;\n    this.pulseSettings.C = 0;\n    this.pulseSettings.callback = callback;\n    this.startPulsing();\n  }\n\n  // deprecate\n  pulseThick(optionsIn: {\n    duration: number,\n    scale: number,\n    num: number,\n    callback: ?(string | ((?mixed) => void)),\n    when: TypeWhen,\n  }) {\n    const options = joinObjects({}, {\n      duration: 1,\n      scale: 2,\n      callback: null,\n      // delta: [0, 0],\n      when: 'syncNow',\n      num: 3,\n    }, optionsIn);\n    let bArray = [options.scale];\n    this.pulseSettings.num = options.num;\n    if (this.pulseSettings.num > 1) {\n      const b = Math.abs(1 - options.scale);\n      const bMax = b;\n      const bMin = -b;\n      const range = bMax - bMin;\n      const bStep = range / (this.pulseSettings.num - 1);\n      bArray = [];\n      for (let i = 0; i < this.pulseSettings.num; i += 1) {\n        bArray.push(bMax - i * bStep);\n      }\n    }\n    this.pulseSettings.time = options.duration;\n    this.pulseSettings.frequency = 1 / (options.duration * 2);\n    this.pulseSettings.A = 1;\n    this.pulseSettings.B = bArray;\n    this.pulseSettings.C = 0;\n    this.pulseSettings.callback = options.callback;\n    this.startPulsing(options.when);\n  }\n\n  startPulsing(when: TypeWhen = 'nextFrame') {\n    this.state.isPulsing = true;\n    const time = new GlobalAnimation().getWhen(when);\n    this.state.pulse.startTime = time == null ? time : time / 1000;\n    this.unrender();\n    this.frozenPulseTransforms = [];\n    this.animateNextFrame();\n  }\n\n  stopPulsing(\n    how: 'freeze' | 'cancel' | 'complete' | 'animateToComplete'\n         | 'dissolveToComplete' = 'cancel',\n  ) {\n    const wasPulsing = this.state.isPulsing;\n    if (how === 'animateToComplete') {\n      return;\n    }\n    if (how === 'freeze' && this.state.isPulsing) {\n      this.frozenPulseTransforms = this.pulseTransforms.map(t => t._dup());\n      this.pulseTransforms = [];\n    }\n    if (how === 'cancel' || how === 'complete') {\n      this.pulseTransforms = [];\n    }\n    this.state.isPulsing = false;\n    this.pulseSettings.num = 1;\n    if (this.pulseSettings.callback) {\n      const { callback } = this.pulseSettings;\n      this.pulseSettings.callback = null;\n      this.fnMap.exec(callback, how);\n    }\n    if (wasPulsing) {\n      // this.subscriptions.publish('animationFinished', )\n      this.animationFinished('pulse');\n      this.subscriptions.publish('stopPulsing');\n    }\n  }\n\n  // isAnimating() {\n  //   if (this.state.isPulsing) {\n  //     return true;\n  //   }\n  //   if (this.state.isMovingFreely) {\n  //     return true;\n  //   }\n  //   if (this.animations.isAnimating()) {\n  //     return true;\n  //   }\n  //   return false;\n  // }\n\n  stop(how: 'freeze' | 'cancel' | 'complete' | 'animateToComplete' | 'dissolveToComplete' = 'cancel') {\n    let toComplete = 0;\n    const checkStop = () => {\n      toComplete -= 1;\n      if (toComplete <= 0) {\n        this.state.preparingToStop = false;\n        this.subscriptions.publish('stopped');\n      }\n    };\n    if (how === 'animateToComplete' || how === 'dissolveToComplete') {\n      if (this.animations.isAnimating()) {\n        this.state.preparingToStop = true;\n        toComplete += 1;\n        this.animations.subscriptions.add('finished', checkStop, 1);\n      }\n      if (this.state.isPulsing) {\n        this.state.preparingToStop = true;\n        toComplete += 1;\n        this.subscriptions.add('stopPulsing', checkStop, 1);\n      }\n      if (this.state.isMovingFreely) {\n        this.state.preparingToStop = true;\n        toComplete += 1;\n        this.subscriptions.add('stopMovingFreely', checkStop, 1);\n      }\n    }\n    if (this.state.preparingToStop) {\n      this.subscriptions.publish('preparingToStop');\n    }\n    this.stopAnimating(how);\n    this.stopMovingFreely(how);\n    this.stopBeingMoved();\n    this.stopPulsing(how);\n  }\n\n\n  stopAnimating(\n    how: 'freeze' | 'cancel' | 'complete' | 'animateToComplete' | 'dissolveToComplete' = 'cancel',\n    name: string | null = null,\n  ) {\n    if (how === 'freeze') {\n      this.animations.cancel(name, 'freeze');\n    } else if (how === 'cancel') {\n      this.animations.cancel(name, null);\n    } else if (how === 'complete') {\n      this.animations.cancel(name, 'complete');\n    }\n  }\n\n  getRemainingAnimationTime(\n    animationNames: Array<string> | string = [],\n  ) {\n    return this.animations.getRemainingTime(animationNames);\n  }\n\n\n  updateLimits(\n    limits: Rect,\n    transforms: OBJ_SpaceTransforms = this.figureTransforms,\n  ) {\n    this.figureLimits = limits;\n    this.figureTransforms = transforms;\n  }\n\n\n  resize(figureHTMLElement: ?HTMLElement = null) {\n    if (figureHTMLElement && this.tieToHTML.updateOnResize) {\n      this.updateHTMLElementTie(figureHTMLElement);\n    }\n  }\n\n\n  getPixelToVertexSpaceScale() {\n    const pixelToFigure = this.figureTransforms.pixelToFigure.matrix();\n    const figureToVertex = this.spaceTransformMatrix('figure', 'draw');\n    const scaleX = pixelToFigure[0] * figureToVertex[0];\n    const scaleY = pixelToFigure[4] * figureToVertex[4];\n    return new Point(scaleX, scaleY);\n  }\n\n  getVertexToPixelSpaceScale() {\n    const pixelToVertexSpaceScale = this.getPixelToVertexSpaceScale();\n    return new Point(\n      1 / pixelToVertexSpaceScale.x,\n      1 / pixelToVertexSpaceScale.y,\n    );\n  }\n\n  spaceTransformMatrix(from: string, to: string) {\n    // All Vertex related conversions\n    if (from === to) {\n      return new Transform().identity().matrix();\n    }\n    if (from === 'draw' && to === 'pixel') {\n      return m2.mul(\n        this.figure.spaceTransforms.glToPixel.matrix(),\n        this.lastDrawTransform.matrix(),\n      );\n    }\n    if (from === 'draw' && to === 'gl') {\n      return this.lastDrawTransform.matrix();\n    }\n    if (from === 'draw' && to === 'figure') {\n      return this.lastDrawTransform.calcMatrix(0, -3);\n    }\n    if (from === 'draw' && to === 'local') {\n      return this.getTransform().matrix();\n    }\n    if (from === 'pixel' && to === 'draw') {\n      return m2.mul(\n        m2.inverse(this.lastDrawTransform.matrix()),\n        this.figure.spaceTransforms.pixelToGL.matrix(),\n      );\n    }\n    if (from === 'gl' && to === 'draw') {\n      return m2.inverse(this.lastDrawTransform.matrix());\n    }\n    if (from === 'figure' && to === 'draw') {\n      return m2.inverse(this.lastDrawTransform.calcMatrix(0, -3));\n    }\n    if (from === 'local' && to === 'draw') {\n      return m2.inverse(this.getTransform().matrix());\n    }\n\n    // Remaining Local related conversions\n    if (from === 'local' && to === 'pixel') {\n      return m2.mul(\n        this.figure.spaceTransforms.glToPixel.matrix(),\n        this.lastDrawTransform.calcMatrix(this.transform.order.length),\n      );\n    }\n    if (from === 'local' && to === 'gl') {\n      return this.lastDrawTransform.calcMatrix(this.transform.order.length);\n    }\n    if (from === 'local' && to === 'figure') {\n      return this.lastDrawTransform.calcMatrix(this.transform.order.length, -3);\n    }\n    if (from === 'pixel' && to === 'local') {\n      return m2.mul(\n        m2.inverse(this.lastDrawTransform.calcMatrix(this.transform.order.length)),\n        this.figure.spaceTransforms.pixelToGL.matrix(),\n      );\n    }\n    if (from === 'gl' && to === 'local') {\n      return m2.inverse(this.lastDrawTransform.calcMatrix(this.transform.order.length));\n    }\n    if (from === 'figure' && to === 'local') {\n      return m2.inverse(this.lastDrawTransform.calcMatrix(this.transform.order.length, -3));\n    }\n\n    // Remaining Figure related conversions\n    if (from === 'figure' && to === 'gl') {\n      return this.figure.spaceTransforms.figureToGL.matrix();\n    }\n    if (from === 'figure' && to === 'pixel') {\n      return this.figure.spaceTransforms.figureToPixel.matrix();\n    }\n    if (from === 'gl' && to === 'figure') {\n      return this.figure.spaceTransforms.glToFigure.matrix();\n    }\n    if (from === 'pixel' && to === 'figure') {\n      return this.figure.spaceTransforms.pixelToFigure.matrix();\n    }\n\n    // Remaining GL related conversions\n    if (from === 'gl' && to === 'pixel') {\n      return this.figure.spaceTransforms.glToPixel.matrix();\n    }\n    if (from === 'pixel' && to === 'gl') {\n      return this.figure.spaceTransforms.pixelToGL.matrix();\n    }\n    return new Transform().identity().matrix();\n  }\n\n  pointFromSpaceToSpace(\n    point: TypeParsablePoint,\n    fromSpace: TypeSpace,\n    toSpace: TypeSpace,\n  ) {\n    return getPoint(point).transformBy(this.spaceTransformMatrix(fromSpace, toSpace));\n  }\n\n  /* eslint-disable class-methods-use-this, no-unused-vars */\n  getBorderPoints(\n    border: 'border' | 'touchBorder' | 'holeBorder' = 'border',\n  ): TypeBorder {\n    return [[]];\n  }\n  /* eslint-enable class-methods-use-this, no-unused-vars */\n\n  // A DrawingObject has borders, touchBorders and and holeBorders\n  //\n  // A FigureElement's border is then the DrawingObject's border transformed by\n  // the element's transform\n  //\n  // Something can have borders, bounds and a boundingRect\n  // * Borders: the points defining the enclosing border\n  // * Bounds: The expanse of the object from a drawingSpace of 0, 0\n  // * BoundingRect: The rectangle enclosing all the border points\n  // * BoundingRectBorder: The perimeter of the boundingRect\n  /* eslint-disable class-methods-use-this, no-unused-vars */\n  getBorder(\n    space: TypeSpace = 'local',\n    border: 'border' | 'touchBorder' | 'holeBorder' = 'border',\n  ) {\n    // if (this.name === 'c' && border === 'touchBorder') {\n    //   debugger;\n    // }\n    const borderPoints = this.getBorderPoints(border);\n    if (space === 'draw') {\n      return borderPoints;\n    }\n    const transformedBorders = [];\n    let matrix;\n    if (Array.isArray(space)) {\n      matrix = m2.mul(space, this.getTransform().matrix());\n    } else {\n      matrix = this.spaceTransformMatrix('draw', space);\n    }\n\n    borderPoints.forEach((b) => {\n      transformedBorders.push(\n        b.map(p => p.transformBy(matrix)),\n      );\n    });\n    return transformedBorders;\n  }\n  /* eslint-enable class-methods-use-this, no-unused-vars */\n\n  getBoundingRect(\n    space: TypeSpace = 'local',\n    border: 'border' | 'touchBorder' | 'holeBorder' = 'border',\n  ) {\n    const transformedBorder = this.getBorder(space, border);  // $FlowFixMe\n    return getBoundingRect(transformedBorder);\n  }\n\n  // ***************************************************************\n  // Size\n  // ***************************************************************\n  getRelativeBoundingRect(\n    space: TypeSpace = 'local',\n    border: 'border' | 'touchBorder' | 'holeBorder' = 'border',\n  ) {\n    const rect = this.getBoundingRect(space, border);\n    const position = this.getPosition(space);\n    return new Rect(\n      rect.left - position.x,\n      rect.bottom - position.y,\n      rect.width,\n      rect.height,\n    );\n  }\n\n  getCenterFigurePosition() {\n    const rect = this.getBoundingRect('figure', 'border');\n    // const rect = this.getFigureBoundingRect();\n    return new Point(\n      rect.left + rect.width / 2,\n      rect.bottom + rect.height / 2,\n    );\n  }\n\n  /**\n   * Return the first scale in the element's transform. Will return\n   * `[1, 1]` if element's transform doesn't have a scale.\n   *\n   * @return {Point} scale\n   */\n  getScale() {\n    const s = this.transform.s();\n    let scale = new Point(1, 1);\n    if (s != null) {\n      scale = s._dup();\n    }\n    return scale;\n  }\n\n  /**\n   * Return the first rotation in the element's transform. Will return\n   * `0` if the element's transform doesn't have a rotation.\n   *\n   * @param {'0to360' | '-180to180' | ''} normalize how to normalize the\n   * returned angle where `''` returns the raw angle\n   * @return {Point} scale\n   */\n  getRotation(normalize: '0to360' | '-180to180' | '' = '') {\n    const r = this.transform.r();\n    let rotation = 0;\n    if (r != null) {\n      rotation = r;\n    }\n    if (normalize !== '' && r != null) {\n      rotation = clipAngle(r, normalize);\n    }\n    return rotation;\n  }\n\n  // /**\n  //  * Get position relative to bounding rect.\n  //  *\n  //  * @return {Point} position\n  //  */\n  getPositionInBounds(\n    space: TypeSpace = 'local',\n    xAlign: 'center' | 'left' | 'right' | 'location' | number = 'location',\n    yAlign: 'middle' | 'top' | 'bottom' | 'location' | number = 'location',\n    border: 'border' | 'touchBorder' | 'holeBorder' = 'border',\n  ) {\n    const bounds = this.getBoundingRect(space, border);\n    const p = this.getPosition(space);\n    if (xAlign === 'left') {\n      p.x = bounds.left;\n    } else if (xAlign === 'right') {\n      p.x = bounds.right;\n    } else if (xAlign === 'center') {\n      p.x = bounds.left + bounds.width / 2;\n    } else if (typeof xAlign === 'number') {\n      p.x = bounds.left + bounds.width * xAlign;\n    }\n    if (yAlign === 'top') {\n      p.y = bounds.top;\n    } else if (yAlign === 'bottom') {\n      p.y = bounds.bottom;\n    } else if (yAlign === 'middle') {\n      p.y = bounds.bottom + bounds.height / 2;\n    } else if (typeof yAlign === 'number') {\n      p.y = bounds.bottom + bounds.height * yAlign;\n    }\n    return p;\n  }\n\n  /**\n   * Get position of element\n   *\n   * By default the first translation of the element's transform is returned.\n   * This is effectively the element's location in 'local' coordinates.\n   *\n   * The position of the element relative to its horizontal and vertical bounds\n   * can also be returned. Use `xAlign` to find the x coordinate of the left,\n   * center, right or percentage width from left of the element. Use `yAlign`\n   * to find the bottom, middle, top or percentage height from bottom of the\n   * element.\n   *\n   * @param {'local' | 'figure' | 'gl' | 'draw'} space the space to return\n   * the position in\n   * @param {'center' | 'left' | 'right' | 'location' | number} xAlign\n   * horizontal alignment of position. Use a `number` to define the horizontal\n   * position in percentage width from the left.\n   * @param {'middle' | 'top' | 'bottom' | 'location' | number} yAlign\n   * vertical alignment of position. Use a `number` to define the vertical\n   * position in percentage height from the bottom.\n   */\n  getPosition(\n    space: TypeSpace = 'local',\n    xAlign: 'center' | 'left' | 'right' | 'location' | number = 'location',\n    yAlign: 'middle' | 'top' | 'bottom' | 'location' | number = 'location',\n  ) {\n    if (xAlign !== 'location' || yAlign !== 'location') {\n      return this.getPositionInBounds(space, xAlign, yAlign);\n    }\n    // vertex space position doesn't mean much as it will always be 0, 0\n    if (space === 'draw') {\n      return new Point(0, 0);\n    }\n    return new Point(0, 0).transformBy(this.spaceTransformMatrix('draw', space));\n  }\n\n  setFigurePosition(figurePosition: Point) {\n    const glSpace = {\n      x: { bottomLeft: -1, width: 2 },\n      y: { bottomLeft: -1, height: 2 },\n    };\n    const figureSpace = {\n      x: {\n        bottomLeft: this.figureLimits.left,\n        width: this.figureLimits.width,\n      },\n      y: {\n        bottomLeft: this.figureLimits.bottom,\n        height: this.figureLimits.height,\n      },\n    };\n    const figureToGLSpace = spaceToSpaceTransform(figureSpace, glSpace);\n    const glLocation = figurePosition.transformBy(figureToGLSpace.matrix());\n    const t = new Transform(this.lastDrawTransform.order.slice(this.transform.order.length));\n    const newLocation = glLocation.transformBy(m2.inverse(t.matrix()));\n    this.setPosition(newLocation._dup());\n  }\n\n  setFigurePositionToElement(element: FigureElement) {\n    const p = element.getPosition('figure');\n    this.setFigurePosition(p._dup());\n  }\n\n  setPositionToElement(\n    element: FigureElement,\n    // space: 'local' | 'figure' = 'figure',\n  ) {\n    if (element.parent === this.parent) {\n    // if (space === 'local') {\n      const p = element.transform.t();\n      if (p != null) {\n        this.setPosition(p._dup());\n      }\n      return;\n    }\n    const figurePosition = element.getPosition('figure');\n    const local = figurePosition.transformBy(\n      this.spaceTransformMatrix('figure', 'local'),\n    );\n    // const figure = this.getPosition('figure');\n    // const local = this.getPosition('local');\n    // const p = element.getPosition('figure');\n    // const deltaFigure = p.sub(figure);\n    // this.setPosition(local.add(deltaFigure));\n    this.setPosition(local);\n  }\n\n  checkMoveBounds() {\n    if (this.move.bounds === 'figure') {\n      this.setMoveBounds('figure');\n      return;\n    }\n    if (this.move.bounds === 'none' || this.move.bounds === null) {\n      this.setMoveBounds('none');\n      return;\n    }\n    if (!(this.move.bounds instanceof TransformBounds)) {\n      this.setMoveBounds(this.move.bounds);\n    }\n    // if (!(this.move.bounds instanceof TransformBounds)) {\n    //   bounds = new TransformBounds(this.transform);\n    // } else {\n    //   ({ bounds } = this.move);\n    // }\n  }\n\n  setMoveBounds(\n    boundaryIn: TransformBounds | TypeTransformBoundsDefinition | 'figure' | 'none' = 'none',\n  ): void {\n    if (boundaryIn instanceof TransformBounds) {\n      this.move.bounds = boundaryIn;\n      return;\n    }\n\n    if (boundaryIn === null || boundaryIn === 'none') {\n      this.move.bounds = new TransformBounds(this.transform);\n      return;\n    }\n\n    // console.log(boundaryIn)\n    if (boundaryIn === 'figure') {\n      if (!(this.move.bounds instanceof TransformBounds)) {\n        this.move.bounds = new TransformBounds(this.transform);\n      }\n      this.move.sizeInBounds = true;\n      const m = this.spaceTransformMatrix('figure', 'local');\n      const p0 = new Point(this.figureLimits.left, this.figureLimits.bottom).transformBy(m);\n      // const p1 = new Point(this.figureLimits.right, p0.y).transformBy(m);\n      const p1 = new Point(this.figureLimits.right, this.figureLimits.top).transformBy(m);\n      // $FlowFixMe\n      this.move.bounds.updateTranslation(new RectBounds({\n        // left: this.figureLimits.left,\n        // bottom: this.figureLimits.bottom,\n        // right: this.figureLimits.right,\n        // top: this.figureLimits.top,\n        left: p0.x,\n        bottom: p0.y,\n        right: p1.x,\n        top: p1.y,\n      }));\n      return;\n    }\n    const bounds = getBounds(boundaryIn, 'transform', this.transform);\n    if (bounds instanceof TransformBounds) {\n      this.move.bounds = bounds;\n    }\n    // if (includeSize) {\n    //   const rect = this.getRelativeBoundingRect('figure');\n    //   const b = this.move.bounds.getTranslation();\n    //   if (b != null) {\n    //     b.boundary.left -= rect.left;\n    //     b.boundary.bottom -= rect.bottom;\n    //     b.boundary.right -= rect.right;\n    //     b.boundary.top -= rect.top;\n    //     this.move.bounds.updateTranslation(b);\n    //   }\n    // }\n  }\n\n  getMoveBounds() {\n    this.checkMoveBounds();  // $FlowFixMe\n    if (this.move.bounds.isUnbounded()) {\n      return this.move.bounds;\n    }\n\n    if (this.move.sizeInBounds) {\n      const rect = this.getRelativeBoundingRect('local');\n      // $FlowFixMe\n      const dup = this.move.bounds._dup();\n      const b = dup.getTranslation();\n      // console.log(rect)\n      if (b != null) {\n        b.boundary.left -= rect.left;\n        b.boundary.bottom -= rect.bottom;\n        b.boundary.right -= rect.right;\n        b.boundary.top -= rect.top;\n        dup.updateTranslation(b);\n        return dup;\n      }\n    }\n    return this.move.bounds;\n  }\n\n  /**\n   * Show element\n   */\n  show() {\n    this.isShown = true;\n    this.setOpacity(1);\n    if (this.parent != null) {\n      if (!this.parent.isShown) {\n        this.parent.show();\n      }\n    }\n    this.animateNextFrame();\n  }\n\n  // /**\n  //  * `true` set this element as touchable and configures all parent elements\n  //  * to accept touches for their children\n  //  *\n  //  * `false` makes this element not touchable.\n  //  */\n  // setTouchable(touchable: boolean) {\n  //   if (touchable === false) {\n  //     this.isTouchable = false;\n  //     return;\n  //   }\n  //   this.setTouchable();\n  // }\n\n  // /**\n  //  * Make the touchable border of this element a rect encompassing it\n  //  * plus some `touchable` buffer on all sides.\n  //  */\n  // // eslint-disable-next-line no-unused-vars\n  // setTouchableRect(touchable: number = 0) {\n  //   // this.touchInBoundingRect = touchable;\n  //   this.setTouchable();\n  // }\n\n  /**\n   * `true` set this element as touchable and configures all parent elements\n   * to accept touches for their children\n   *\n   * `false` makes this element not touchable.\n   */\n  setTouchable(makeThisElementTouchable: boolean = true) {\n    if (makeThisElementTouchable) {\n      this.isTouchable = true;\n    } else {\n      this.hasTouchableElements = true;\n    }\n    if (this.parent != null) {\n      this.parent.setTouchable(false);\n    }\n  }\n\n  /**\n   * Configure all parents to make this element touchable, and\n   * make this element touchable and movable\n   * @param {boolean} movable `true` to make movable, `false` to not\n   */\n  setMovable(movable: boolean = true) {\n    if (movable) {\n      this.isMovable = true;\n      this.setTouchable(true);\n    } else {\n      this.isMovable = false;\n      this.isTouchable = false;\n    }\n  }\n\n  clearRender() {\n    let tieToElement;\n    let elementId = '';\n    if (typeof this.tieToHTML.element === 'string') {\n      elementId = this.tieToHTML.element;\n      tieToElement = document.getElementById(this.tieToHTML.element);\n    }\n\n    if (tieToElement) {\n      const w = document.getElementById(`${elementId}_webgl`);\n      if (w != null) {\n        // w.style.visibility = 'hidden';\n        w.style.display = 'none';\n      }\n      const d = document.getElementById(`${elementId}_2d`);\n      if (d != null) {\n        // d.style.visibility = 'hidden';\n        d.style.display = 'none';\n      }\n    }\n  }\n\n  setRenderedOnNextDraw() {\n    this.renderedOnNextDraw = true;\n  }\n\n  unrender(): void {\n    if (this.isRenderedAsImage) {\n      this.unrenderNextDraw = true;\n      this.isRenderedAsImage = false;\n    }\n    if (this.parent != null) {\n      this.parent.unrender();\n    }\n  }\n\n  showAll(): void {\n    this.show();\n  }\n\n  /**\n   * Hide element\n   */\n  hide(): void {\n    this.isShown = false;\n    this.animateNextFrame();\n  }\n\n  hideAll(): void {\n    this.hide();\n  }\n\n  /**\n   * Toggle hide/show of element\n   */\n  toggleShow() {\n    if (this.isShown) {\n      this.hide();\n    } else {\n      this.show();\n    }\n  }\n\n  // eslint-disable-next-line no-unused-vars\n  click(glPoint: Point) {\n    if (this.onClick != null) {\n      if (this.recorder.state === 'recording') {\n        this.recorder.recordEvent('elementClick', [this.getPath()]);\n      }\n      this.fnMap.exec(this.onClick, this);\n    }\n    this.subscriptions.publish('onClick');\n  }\n\n  // setMovable(movable: boolean = true) {\n  //   if (movable) {\n  //     this.isTouchable = true;\n  //     this.isMovable = true;\n  //   }\n  // }\n\n  /**\n   * Get current transform of element.\n   * @return {Transform}\n   */\n  getTransform() {\n    return this.transform;\n  }\n\n  // isAnimating(): boolean {\n  //   // console.log(this.name, this.isShown, this.animations.isAnimating())\n  //   if (this.isShown === false) {\n  //     return false;\n  //   }\n  //   return this.animations.isAnimating();\n  // }\n\n  /**\n   * @return {boolean} `true` if element is moving\n   */\n  isMoving(): boolean {\n    if (this.isShown === false) {\n      return false;\n    }\n    if (this.isAnimating()) {\n      return true;\n    }\n    if (this.state.isBeingMoved) {\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * @return {boolean} `true` if element is animating\n   */\n  isAnimating(): boolean {\n    if (this.isShown === false) {\n      return false;\n    }\n    if (\n      this.state.isMovingFreely\n      || this.state.isPulsing\n      || this.animations.isAnimating()\n    ) {\n      return true;\n    }\n    return false;\n  }\n\n  // isAnyElementAnimating() {\n  //   return this.isAnimating();\n  // }\n\n  isAnyElementMoving() {\n    return this.isMoving();\n  }\n\n  isBeingTouched(glLocation: Point): boolean {\n    if (!this.isTouchable) {\n      return false;\n    }\n    // if (this.drawingObject.touchBorder == null) {\n    //   return false;\n    // }\n    const vertexLocation = glLocation.transformBy(this.spaceTransformMatrix('gl', 'draw'));\n    const borders = this.getBorder('draw', 'touchBorder');\n    // if (this.touchInBoundingRect !== false) {\n    //   let buffer = 0;\n    //   if (typeof this.touchInBoundingRect === 'number') {\n    //     buffer = this.touchInBoundingRect;\n    //   }\n    //   const boundingRect = getBoundingRect(borders, buffer);\n    //   const {\n    //     left, bottom, right, top,\n    //   } = boundingRect;\n    //   borders = [[\n    //     new Point(left, bottom),\n    //     new Point(right, bottom),\n    //     new Point(right, top),\n    //     new Point(left, top),\n    //   ]];\n    // }\n    // console.log(this.name, this.parent)\n    // console.log(vertexLocation)\n    // console.log(borders)\n    const holeBorders = this.getBorder('draw', 'holeBorder');\n    for (let i = 0; i < borders.length; i += 1) {\n      const border = borders[i];\n      if (border.length > 2) {\n        if (vertexLocation.isInPolygon(border)) {\n          let isTouched = true;\n          // $FlowFixMe\n          if (this.cannotTouchHole) {\n            for (let j = 0; j < holeBorders.length; j += 1) {\n              const holeBorder = holeBorders[j];\n              if (holeBorder.length > 2) {\n                if (Array.isArray(holeBorder) && holeBorder.length > 2) {\n                  if (vertexLocation.isInPolygon(holeBorder)) {\n                    isTouched = false;\n                    j = holeBorders.length;\n                  }\n                }\n              }\n            }\n          }\n          if (isTouched) {\n            return true;\n          }\n        }\n      }\n    }\n    return false;\n  }\n\n  getTouched(glLocation: Point): Array<FigureElement> {\n    if (!this.isTouchable) {\n      return [];\n    }\n    if (this.isBeingTouched(glLocation)) {\n      return [this];\n    }\n    return [];\n  }\n}\n\n\n/*\n..........########..########..####.##.....##\n..........##.....##.##.....##..##..###...###\n..........##.....##.##.....##..##..####.####\n..........########..########...##..##.###.##\n..........##........##...##....##..##.....##\n..........##........##....##...##..##.....##\n..........##........##.....##.####.##.....##\n*/\n// ***************************************************************\n// Geometry Object\n// ***************************************************************\n\n/**\n * Primitive figure element\n *\n * A primitive figure element is one that handles an object (`drawingObject`)\n * that draws to the screen. This object may be a {@link VertexObject}, a\n * {@link TextObject} or a {@link {HTMLObject}}.\n *\n * @class\n * @extends FigureElement\n */\nclass FigureElementPrimitive extends FigureElement {\n  drawingObject: DrawingObject;\n  // color: TypeColor;\n  // opacity: number;\n  pointsToDraw: number;\n  angleToDraw: number;\n  lengthToDraw: number;\n  cannotTouchHole: boolean;\n  pointsDefinition: Object;\n  setPointsFromDefinition: ?(() => void);\n  border: TypeBorder | 'draw' | 'buffer' | 'rect' | number;\n  touchBorder: TypeBorder | 'border' | number | 'rect' | 'draw' | 'buffer';\n  holeBorder: TypeBorder;\n  drawBorder: TypeBorder;\n  drawBorderBuffer: TypeBorder;\n  // +pulse: (?(mixed) => void) => void;\n\n  /**\n   * Primitive figure element.\n   *\n   * This type of element is responsible for drawing something\n   * to the screen, or managing a HTML element in the DOM\n   *\n   * @param {DrawingObject} drawingObject an object that handles drawing\n   * to the screen or manages a HTML element\n   * @param {Transform} transform initial transform to set\n   * @param {[number, number, number, number]} color color to set\n   * @param {Rect} figureLimits limits of figure\n   * @param {FigureElement | null} parent parent element\n   * @param\n   */\n  constructor(\n    drawingObject: DrawingObject,\n    transform: Transform = new Transform(),\n    color: TypeColor = [0.5, 0.5, 0.5, 1],\n    figureLimits: Rect = new Rect(-1, -1, 2, 2),\n    parent: FigureElement | null = null,\n    name: string = generateUniqueId('element_'),\n  ) {\n    super(transform, figureLimits, parent, name);\n    this.drawingObject = drawingObject;\n    this.color = color != null ? color.slice() : [0, 0, 0, 0];\n    this.defaultColor = this.color.slice();\n    this.dimColor = [0.5, 0.5, 0.5, 1];\n    this.pointsToDraw = -1;\n    this.angleToDraw = -1;\n    this.lengthToDraw = -1;\n    this.cannotTouchHole = false;\n    this.type = 'primitive';\n    this.pointsDefinition = {};\n    this.setPointsFromDefinition = null;\n    this.border = 'draw';\n    this.touchBorder = 'draw';\n    this.holeBorder = [[]];\n    // this.setMoveBounds();\n  }\n\n  _getStateProperties(options: { ignoreShown?: boolean }) {\n    let { ignoreShown } = options;\n    if (ignoreShown == null) {\n      ignoreShown = false;\n    }\n    if (this.isShown || ignoreShown) {\n      return [...super._getStateProperties(options),\n        'pointsToDraw',\n        'angleToDraw',\n        'lengthToDraw',\n        'cannotTouchHole',\n        'drawingObject',\n        'pointsDefinition',\n      ];\n    }\n    return super._getStateProperties(options);\n  }\n\n  /**\n   * Set angle to draw.\n   *\n   * Some primitive elements can be partially drawn to some angle.\n   *\n   * An angle of -1 represents the maximum angle allowed by the primitive.\n   *\n   * @param {number} angle Angle to draw\n   */\n  setAngleToDraw(angle: number = -1) {\n    this.angleToDraw = angle;\n  }\n\n  // setScenario(scenarioName: string) {\n  //   super.setScenario(scenarioName);\n  //   if (this.scenarios[scenarioName] != null) {\n  //     const target = this.getScenarioTarget(scenarioName);\n  //     if (target.color != null) {\n  //       this.setColor(target.color.slice());\n  //     }\n  //   }\n  // }\n\n  click(glPoint: Point) {\n    super.click(glPoint);\n    if (this.drawingObject instanceof TextObjectBase) {\n      this.drawingObject.click(\n        glPoint.transformBy(this.spaceTransformMatrix('gl', 'draw')),\n        // this.lastDrawTransform.matrix(),\n        this.fnMap,\n      );\n      if (this.recorder.state === 'recording') {\n        this.recorder.recordEvent('elementTextClick', [this.getPath()]);\n      }\n    }\n  }\n\n  // updateContext(context: DrawContext2D) {\n  //   if (this.drawingObject instanceof TextObject) {\n  //     this.drawingObject.drawContext2D = context;\n  //   }\n  // }\n\n  _dup(transform: Transform | null = null) {\n    // const vertices = this.drawingObject._dup();\n    const primitive = new FigureElementPrimitive(this.drawingObject._dup());\n    // const primitive = new FigureElementPrimitive(\n    //   vertices,\n    //   transform,\n    //   color,\n    //   this.figureLimits._dup(),\n    // );\n    // primitive.pointsToDraw = this.pointsToDraw;\n    // primitive.angleToDraw = this.angleToDraw;\n    // primitive.copyFrom(this);\n    duplicateFromTo(this, primitive, ['parent', 'figure', 'recorder', 'pulseDefault.centerOn']);\n    if (transform != null) {\n      primitive.transform = transform._dup();\n    }\n    // primitive.pulseDefault = {};\n    // duplicateFromTo(primitive.pulseDefault, this.pulseDefault, ['centerOn']);\n    if (\n      typeof this.pulseDefault !== 'string'\n      && typeof this.pulseDefault !== 'function'\n    ) { // $FlowFixMe\n      primitive.pulseDefault.centerOn = this.pulseDefault.centerOn;\n    } else {\n      primitive.pulseDefault = this.pulseDefault;\n    }\n    primitive.recorder = this.recorder;\n    return primitive;\n  }\n\n  clear(canvasIndex: number = 0) {\n    if (this.drawingObject instanceof TextObjectBase) {\n      // $FlowFixMe\n      this.drawingObject.clear(canvasIndex, this.pulseTransforms);\n    }\n  }\n\n  resize(figureHTMLElement: ?HTMLElement = null) {\n    this.resizeHtmlObject();\n    super.resize(figureHTMLElement);\n    // If gl canvas is resized, webgl text will need to be updated.\n    if (this.drawingObject.type === 'vertexText') {\n      const pixelToVertexScale = this.getPixelToVertexSpaceScale();\n      // $FlowFixMe\n      this.drawingObject.drawTextIntoBuffer(\n        new Point(pixelToVertexScale.x, Math.abs(pixelToVertexScale.y)),\n      );\n    }\n  }\n\n  setColor(color: TypeColor, setDefault: boolean = true) {\n    this.color = color != null ? color.slice() : [0, 0, 0, 0];\n    if (setDefault) {\n      this.defaultColor = this.color.slice();\n    }\n    if (this instanceof FigureElementPrimitive) {\n      if (this.drawingObject instanceof TextObjectBase) {\n        this.drawingObject.setColor(this.color);\n      }\n      if (this.drawingObject instanceof HTMLObject) {\n        // $FlowFixMe\n        this.drawingObject.element.style.color = colorArrayToRGBA(this.color);\n      }\n    }\n  }\n\n  setOpacity(opacity: number) {\n    // this.color[3] = opacity;\n    this.opacity = opacity;\n    if (this instanceof FigureElementPrimitive) {\n      if (this.drawingObject instanceof TextObjectBase) {\n        this.drawingObject.setOpacity(opacity);\n      }\n      if (this.drawingObject instanceof HTMLObject) {\n        // this.drawingObject.element.style.color =\n        // colorArrayToRGBA([...this.color.slice(0, 2), opacity]);\n        // console.log(this.drawingObject.element)\n        this.drawingObject.element.style.opacity = `${opacity}`;\n      }\n    }\n    this.animateNextFrame();\n  }\n\n  show() {\n    super.show();\n    if (this.drawingObject instanceof HTMLObject) {\n      this.drawingObject.show = true;\n\n      // This line is a challenge.\n      // It will show a html element immediately before the next draw frame\n      // meaning the draw matrix will be old.\n      // If this line is removed, it causes a blanking between lesson pages\n      // for html elements that are always on screen\n      // Therefore, should use figure.setFirstTransform before using this,\n      // or in the future remove this line, and the line in hide(), and\n      // somehow do the hide in the draw call\n      this.drawingObject.transformHtml(this.lastDrawTransform.matrix());\n    }\n  }\n\n  // showAll() {\n  //   this.show();\n  // }\n\n  hide() {\n    super.hide();\n    if (this.drawingObject instanceof HTMLObject) {\n      this.drawingObject.show = false;\n      this.drawingObject.transformHtml(this.lastDrawTransform.matrix());\n    }\n  }\n\n  // hideAll() {\n  //   this.hide();\n  // }\n\n  // getBorder(\n  //   space: TypeSpace | Array<number> = 'local',\n  //   border: 'touchBorder' | 'border' | 'holeBorder' = 'border',\n  // ) {\n  //   let bordersToUse = this.drawingObject.border;\n  //   // if (border === 'border') {\n  //   //   if (this.border !== 'draw') {\n  //   //     bordersToUse = this.border;\n  //   // } else if (border === 'touchBorder') {\n\n  //   // }\n  //   if (border === 'touchBorder') {\n  //     bordersToUse = this.drawingObject.touchBorder;\n  //   }\n  //   if (border === 'holeBorder') {\n  //     bordersToUse = this.drawingObject.hole;\n  //   }\n  //   if (space === 'draw') {\n  //     return bordersToUse;\n  //   }\n  //   const transformedBorders = [];\n  //   let matrix;\n  //   if (Array.isArray(space)) {\n  //     matrix = m2.mul(space, this.getTransform().matrix());\n  //   } else {\n  //     matrix = this.spaceTransformMatrix('draw', space);\n  //   }\n  //   bordersToUse.forEach((b) => {\n  //     transformedBorders.push(\n  //       b.map(p => p.transformBy(matrix)),\n  //     );\n  //   });\n  //   return transformedBorders;\n  // }\n\n\n  setFont(font: OBJ_Font, index: number = 0) {\n    if (this.drawingObject instanceof TextObjectBase) {\n      this.drawingObject.setFont(font, index);\n    }\n  }\n\n  resizeHtmlObject() {\n    if (this.drawingObject instanceof HTMLObject) {\n      this.drawingObject.transformHtml(this.lastDrawTransform.matrix());\n    }\n  }\n\n  getBorderPoints(\n    border: 'border' | 'touchBorder' | 'holeBorder' = 'border',\n  ): TypeBorder {\n    if (border === 'border') {\n      if (this.border === 'draw') {\n        return this.drawBorder;\n      }\n      if (this.border === 'buffer') {\n        return this.drawBorderBuffer;\n      }\n      if (this.border === 'rect') {\n        return [getBoundingBorder(this.drawBorder)];\n      }\n      if (isBuffer(this.border)) {\n      // if (typeof this.border === 'number') {\n        // $FlowFixMe\n        return [getBoundingBorder(this.drawBorder, this.border)];\n      } // $FlowFixMe\n      return this.border;\n    }\n\n    if (border === 'touchBorder') {\n      if (this.touchBorder === 'draw') {\n        return this.drawBorder;\n      }\n      if (this.touchBorder === 'buffer') {\n        return this.drawBorderBuffer;\n      }\n      if (this.touchBorder === 'border') {\n        return this.getBorderPoints('border');\n      }\n      if (this.touchBorder === 'rect') {\n        const b = this.getBorderPoints('border');\n        return [getBoundingBorder(b)];\n      }\n      // if (typeof this.touchBorder === 'number') {\n      if (isBuffer(this.touchBorder)) {\n        const b = this.getBorderPoints('border'); // $FlowFixMe\n        return [getBoundingBorder(b, this.touchBorder)];\n      } // $FlowFixMe\n      return this.touchBorder;\n    }\n    return this.holeBorder;\n  }\n\n  setupDraw(now: number = 0) {\n    if (this.isShown) {\n      this.lastDrawTime = now;\n      if (this.isRenderedAsImage === true) {\n        if (this.willStartAnimating()) {\n          this.unrender();\n        } else {\n          return;\n        }\n      }\n      this.subscriptions.publish('beforeDraw', [now]);\n      if (this.beforeDrawCallback != null) {\n        this.fnMap.exec(this.beforeDrawCallback, now);\n      }\n\n      this.animations.nextFrame(now);\n      this.nextMovingFreelyFrame(now);\n    }\n  }\n\n  draw(\n    now: number,\n    parentTransform: Array<Transform> = [new Transform()],\n    parentOpacity: number = 1,\n    canvasIndex: number = 0,\n  ) {\n    if (this.isShown) {\n      const ttt = performance.now();\n      let pointCount = -1;\n      if (this.drawingObject instanceof VertexObject) {\n        pointCount = this.drawingObject.numPoints;\n        if (this.angleToDraw !== -1) {\n          pointCount = this.drawingObject.getPointCountForAngle(this.angleToDraw);\n        }\n        if (this.lengthToDraw !== -1) {\n          pointCount = this.drawingObject.getPointCountForLength(this.lengthToDraw);\n        }\n        if (this.pointsToDraw !== -1) {\n          pointCount = this.pointsToDraw;\n        }\n      } else {\n        pointCount = 1;\n      }\n\n      const colorToUse = [...this.color.slice(0, 3), this.color[3] * this.opacity * parentOpacity];\n      // eslint-disable-next-line prefer-destructuring\n      this.lastDrawOpacity = colorToUse[3];\n      // if (this.getPath().endsWith('eqn.elements._1')) {\n      // console.log(this.getPath(), this.opacity, colorToUse);\n      // colorToUse = [1, 0, 0, 1];\n      // }\n      const transform = this.getTransform();\n      const newTransforms = transformBy(parentTransform, [transform]);\n\n      this.lastDrawElementTransformPosition = {\n        parentCount: parentTransform[0].order.length,\n        elementCount: this.transform.order.length,\n      };\n\n      // const newTransform = parentTransform.transform(this.getTransform());\n      // this.parentTransform = parentTransform._dup();\n      // const newTransform = parentTransform.transform(this.getTransform());\n      this.pulseTransforms = this.getPulseTransforms(now);\n      this.drawTransforms = this.getDrawTransforms(newTransforms);\n      this.lastDrawTransform = parentTransform[0].transform(transform)._dup();\n      // eslint-disable-next-line prefer-destructuring\n      this.lastDrawPulseTransform = this.drawTransforms[0];\n      if (pointCount > 0) {\n        // console.log(this.pulseTransforms, pointCount)\n        this.drawTransforms.forEach((t) => {\n          // let t = t2;\n          // console.log(t.matrix().slice(), t._dup().matrix().slice())\n          // const m = t._dup().matrix();\n          // if (this.getPath() === 'circle.line1.line') {\n          //   // colorToUse = [1, 0, 0, 1];\n          //   // t = t2._dup();\n          //   console.log(t.matrix().slice(), t._dup().matrix().slice())\n          // }\n          // console.log(t.matrix(), colorToUse, canvasIndex, pointCount)\n          this.drawingObject.drawWithTransformMatrix(\n            // m, colorToUse, canvasIndex, pointCount,\n            t.matrix(), colorToUse, canvasIndex, pointCount,\n          );\n          // window.asdf = false;\n        });\n      }\n      if (this.unrenderNextDraw) {\n        this.clearRender();\n        this.unrenderNextDraw = false;\n      }\n      if (this.renderedOnNextDraw) {\n        this.isRenderedAsImage = true;\n        this.renderedOnNextDraw = false;\n      }\n      // this.redrawElements.forEach((element) => {\n      //   element.draw(element.getParentLastDrawTransform(), now);\n      // })\n      this.subscriptions.publish('afterDrawDraw', [now]);\n      if (this.afterDrawCallback != null) {\n        this.fnMap.exec(this.afterDrawCallback, now);\n      }\n      window.timeData.push([this.name, round(performance.now() - ttt, 2)]);\n    }\n  }\n\n  setFirstTransform(parentTransform: Transform = new Transform()) {\n    this.lastDrawElementTransformPosition = {\n      parentCount: parentTransform.order.length,\n      elementCount: this.transform.order.length,\n    };\n    // const finalParentTransform = this.processParentTransform(parentTransform);\n    const firstTransform = parentTransform.transform(this.getTransform());\n    this.lastDrawTransform = firstTransform._dup();\n    if (this.drawingObject instanceof HTMLObject) {\n      this.drawingObject.transformHtml(firstTransform.matrix());\n    }\n    // this.setMoveBounds();\n    this.checkMoveBounds();\n  }\n\n  increaseBorderSize(\n    xMultiplierOrPoint: number | Point = 1,\n    yMultiplier: number | null = null,\n  ) {\n    let xMulToUse;\n    let yMulToUse;\n    if (xMultiplierOrPoint instanceof Point) {\n      xMulToUse = xMultiplierOrPoint.x;\n      yMulToUse = xMultiplierOrPoint.y;\n    } else {\n      xMulToUse = xMultiplierOrPoint;\n      if (yMultiplier == null) {\n        yMulToUse = xMulToUse;\n      } else {\n        yMulToUse = yMultiplier;\n      }\n    }\n    if (this.drawingObject instanceof VertexObject) {\n      for (let b = 0; b < this.drawingObject.border.length; b += 1) {\n        const border = this.drawingObject.border[b];\n        for (let i = 0; i < border.length; i += 1) {\n          border[i].x *= xMulToUse;\n          border[i].y *= yMulToUse;\n        }\n      }\n    }\n  }\n}\n\n/*\n...........######...#######..##.......##......\n..........##....##.##.....##.##.......##......\n..........##.......##.....##.##.......##......\n..........##.......##.....##.##.......##......\n..........##.......##.....##.##.......##......\n..........##....##.##.....##.##.......##......\n...........######...#######..########.########\n*/\n// ***************************************************************\n// Collection of Geometry Objects or Collections\n// ***************************************************************\n\n/**\n * {@link FigureElementCollection} options object.\n * @property {TypeParsableTransform} [transform]\n * @property {TypeParsablePoint} [position] if defined, will overwrite first\n * translation of `transform`\n * @property {Rect} [limits] figure limits\n * @property {TypeColor} [color] default color\n * @property {FigureElement | null} [parent] parent of collection\n * @property {TypeBorder | 'children' | 'rect' | number} [border]\n * @property {TypeBorder | 'border' | number | 'rect'} [touchBorder]\n * @property {TypeBorder} [holeBorder]\n */\nexport type OBJ_FigureElementCollection = {\n  transform?: TypeParsableTransform,\n  position?: TypeParsablePoint,\n  limits?: Rect,\n  color?: TypeColor,\n  parent?: FigureElement | null,\n  border?: TypeBorder | 'children' | 'rect' | number,\n  touchBorder?: TypeBorder | 'border' | number | 'rect',\n  holeBorder?: TypeBorder,\n};\n\n/**\n * Collection figure element\n *\n * A collection manages a number of children {@link FigureElements}, be they\n * primitives or collections.\n *\n * A collection's transform will be passed onto all the children elements.\n *\n * @class\n * @extends FigureElement\n */\nclass FigureElementCollection extends FigureElement {\n  elements: Object;\n  drawOrder: Array<string>;\n  // touchInBoundingRect: boolean;\n  border: TypeBorder | 'children' | 'rect' | number;\n  // $FlowFixMe\n  touchBorder: TypeParsableBuffer | TypeBorder | 'border' | 'children' | 'rect' | number;\n  // border is whatever border is\n  // children is touch borders of children\n  // rect is rect of children touchBorder\n  // number is buffer of rect of children touch border\n  // $FlowFixMe\n  holeBorder: TypeBorder | 'children';\n  eqns: Object;\n  // +pulse: (?({\n  //     x?: 'left' | 'center' | 'right' | 'origin' | number,\n  //     y?: 'bottom' | 'middle' | 'top' | 'origin' | number,\n  //     space?: TypeSpace,\n  //     centerOn?: null | FigureElement | TypeParsablePoint,\n  //     frequency?: number,\n  //     time?: number,\n  //     scale?: number,\n  //     done?: ?(mixed) => void,\n  //     elements?: Array<string | FigureElement>\n  //   } | Array<string | FigureElement> | ((mixed) => void)), ?(mixed) => void) => void;\n  // primitives: FigurePrimitives;\n  collections: FigureCollections;\n\n  +getElement: (?(string | FigureElement)) => ?FigureElement;\n  +getElements: (TypeElementPath) => Array<FigureElement>;\n  +exec: (string | Array<string | Object>, ?Array<string | FigureElement>) => void;\n  +highlight: (elementsToDim: ?Array<string | FigureElement>) => void;\n\n  /**\n   * @param {OBJ_FigureElementCollection} options\n   */\n  constructor(options: OBJ_FigureElementCollection = {}): void {\n    const defaultOptions = {\n      transform: new Transform(),\n      // position: [0, 0],\n      limits: new Rect(-1, 1, 2, 2),\n      parent: null,\n      border: 'children',\n      touchBorder: 'children',\n      holeBorder: [[]],\n      color: [0, 0, 0, 1],\n      name: generateUniqueId('collection_'),\n    };\n    const o = joinObjects({}, defaultOptions, options);\n    // console.log(o)\n    super(getTransform(o.transform), o.limits, o.parent, o.name);\n    if (o.position != null) {\n      this.transform.updateTranslation(getPoint(o.position));\n    }\n    this.elements = {};\n    this.drawOrder = [];\n    // this.touchInBoundingRect = false;\n    this.eqns = {};\n    this.type = 'collection';\n    // this.border = o.border;\n    // this.touchBorder = o.touchBorder;\n    // this.holeBorder = o.holeBorder;\n    this.setColor(o.color);\n\n    // if (transformOrPointOrOptions instanceof Point) {\n    //   defaultOptions.transform.updateTranslation(transformOrPointOrOptions);\n    //   optionsToUse = joinObjects({}, defaultOptions, ...moreOptions);\n    // } else if (transformOrPointOrOptions instanceof Transform) {\n    //   defaultOptions.transform = transformOrPointOrOptions._dup();\n    //   optionsToUse = joinObjects({}, defaultOptions, ...moreOptions);\n    // } else {\n    //   optionsToUse = joinObjects({}, defaultOptions, transformOrPointOrOptions, ...moreOptions);\n    // }\n    if (o.border != null) {\n      if (!isBuffer(o.border)) { // $FlowFixMe\n        this.border = getBorder(o.border);\n      } else {\n        this.border = o.border;\n      }\n    }\n    if (o.touchBorder != null) {\n      if (!isBuffer(o.touchBorder)) { // $FlowFixMe\n        this.touchBorder = getBorder(o.touchBorder);\n      } else {\n        this.touchBorder = o.touchBorder;\n      }\n    }\n    if (o.holeBorder != null) { // $FlowFixMe\n      this.holeBorder = getBorder(o.holeBorder);\n    }\n  }\n\n  _getStateProperties(options: { ignoreShown?: boolean }) {\n    let { ignoreShown } = options;\n    if (ignoreShown == null) {\n      ignoreShown = false;\n    }\n    if (this.isShown || ignoreShown) {\n      return [...super._getStateProperties(options),\n        // 'touchInBoundingRect',\n        'elements',\n        'hasTouchableElements',\n      ];\n    }\n    return [\n      ...super._getStateProperties(options),\n      'elements',\n    ];\n  }\n\n  _getStatePropertiesMin() {\n    return [\n      ...super._getStatePropertiesMin(),\n      'elements',\n    ];\n  }\n\n  _dup(exceptions: Array<string> = []) {\n    const collection = new FigureElementCollection({\n    });\n    // collection.touchInBoundingRect = this.touchInBoundingRect;\n    // collection.copyFrom(this);\n    const doNotDuplicate = this.drawOrder.map(e => `_${e}`);\n    duplicateFromTo(this, collection, [\n      'elements', 'drawOrder', 'parent', 'recorder', 'figure',\n      'collections', 'pulseDefault.centerOn',\n      ...doNotDuplicate, ...exceptions,\n    ]);\n    for (let i = 0; i < this.drawOrder.length; i += 1) {\n      const name = this.drawOrder[i];\n      collection.add(name, this.elements[name]._dup());\n    }\n    collection.recorder = this.recorder;\n    // collection.pulseDefault = {};\n    // duplicateFromTo(collection.pulseDefault, this.pulseDefault, ['centerOn']);\n    if (\n      typeof this.pulseDefault !== 'string'\n      && typeof this.pulseDefault !== 'function'\n    ) { // $FlowFixMe\n      collection.pulseDefault.centerOn = this.pulseDefault.centerOn;\n    } else {\n      collection.pulseDefault = this.pulseDefault;\n    }\n\n    return collection;\n  }\n\n  /**\n   * Move child elements to end of draw order - effectively moving to the start\n   * of the drawn collection. Later elements in the array will be further forward.\n   * @param {Array<string | FigureElement> | string | FigureElement} elements\n   */\n  toFront(elementsIn: Array<string | FigureElement> | string | FigureElement) {\n    let elements = elementsIn;\n    if (!Array.isArray(elementsIn) || typeof elementsIn === 'string') {\n      elements = [elementsIn];\n    }\n    const names = [];\n    // $FlowFixMe\n    elements.forEach((element) => {\n      if (typeof element === 'string') {\n        names.push(element);\n      } else {\n        names.push(element.name);\n      }\n    });\n    const newOrder = [];\n    this.drawOrder.forEach((element) => {\n      if (names.indexOf(element) === -1) {\n        newOrder.push(element);\n      }\n    });\n    this.drawOrder = [...newOrder, ...names];\n  }\n\n  /**\n   * Move child elements to start of draw order - effectively moving them to\n   * the back of the drawn collection. Later elements in the `elements` array\n   * will be drawn further back.\n   * @param {Array<string | FigureElement> | string | FigureElement} elements\n   */\n  toBack(elementsIn: Array<string | FigureElement> | string | FigureElement) {\n    let elements = elementsIn;\n    if (typeof elementsIn === 'string' || !Array.isArray(elementsIn)) {\n      elements = [elementsIn];\n    }\n    const names = [];\n    // $FlowFixMe\n    elements.forEach((element) => {\n      if (typeof element === 'string') {\n        names.push(element);\n      } else {\n        names.push(element.name);\n      }\n    });\n    const newOrder = [];\n    this.drawOrder.forEach((element) => {\n      if (names.indexOf(element) === -1) {\n        newOrder.push(element);\n      }\n    });\n    this.drawOrder = [...names.reverse(), ...newOrder];\n  }\n\n  isAnyElementMoving(): boolean {\n    if (this.isShown === false) {\n      return false;\n    }\n    if (this.isMoving()) {\n      return true;\n    }\n    for (let i = 0; i < this.drawOrder.length; i += 1) {\n      const element = this.elements[this.drawOrder[i]];\n      if (element.isAnyElementMoving()) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  /**\n   * Add a figure element to the collection.\n   *\n   * @param {string} name reference name of element\n   * @param {FigureElement} element element to add\n   * @param {number} index index to add in the `drawOrder` where -1 appends the\n   * element to the end of the draw order,\n   */\n  addLegacy(\n    name: string,\n    element: FigureElementPrimitive | FigureElementCollection,\n    index: number = -1,\n  ) {\n    // eslint-disable-next-line no-param-reassign\n    element.parent = this;\n    this.elements[name] = element;\n    this.elements[name].name = name;\n    // $FlowFixMe\n    this[`_${name}`] = this.elements[name];\n    if (index !== -1) {\n      this.drawOrder = [\n        ...this.drawOrder.slice(0, index),\n        name,\n        ...this.drawOrder.slice(index),\n      ];\n    } else {\n      this.drawOrder.push(name);\n    }\n    if (this.figure != null) {\n      element.setFigure(this.figure);\n    }\n    element.setFirstTransform(this.lastDrawTransform);\n    this.animateNextFrame();\n  }\n\n  addElementWithName(\n    name: string,\n    element: FigureElement,\n    index: number = -1,\n  ) {\n    // eslint-disable-next-line no-param-reassign\n    element.parent = this;\n    this.elements[name] = element;\n    this.elements[name].name = name;\n    // $FlowFixMe\n    this[`_${name}`] = this.elements[name];\n    if (index !== -1) {\n      this.drawOrder = [\n        ...this.drawOrder.slice(0, index),\n        name,\n        ...this.drawOrder.slice(index),\n      ];\n    } else {\n      this.drawOrder.push(name);\n    }\n    if (this.figure != null) {\n      element.setFigure(this.figure);\n    }\n    element.setFirstTransform(this.lastDrawTransform);\n    this.animateNextFrame();\n  }\n\n\n  /**\n   * Add a figure element to the collection.\n   *\n   * @param {string} name reference name of element\n   * @param {FigureElement} element element to add\n   * @param {number} index index to add in the `drawOrder` where -1 appends the\n   * element to the end of the draw order,\n   */\n  add(\n    nameOrElementOrElementDefinition: string\n        | FigureElement | OBJ_AddElement\n        | Array<FigureElement | OBJ_AddElement>,\n    elementToAdd: FigureElement,\n  ) {\n    if (typeof nameOrElementOrElementDefinition === 'string') {\n      this.addElementWithName(nameOrElementOrElementDefinition, elementToAdd);\n      return;\n    }\n    let elements;\n    if (!Array.isArray(nameOrElementOrElementDefinition)) {\n      elements = [nameOrElementOrElementDefinition];\n    } else {\n      elements = nameOrElementOrElementDefinition;\n    }\n\n    const rootCollection = this;\n    elements.forEach((elementDefinition, index) => {\n      if (elementDefinition instanceof FigureElement) {\n        this.add(elementDefinition.name, elementDefinition);\n        return;\n      }\n      // Extract the parameters from the layout object\n      if (elementDefinition == null) {\n        throw Error(`Add elements index ${index} does not exist in layout`);\n      }\n      const addElementsKey = 'elements';\n      const nameToUse = elementDefinition.name;\n      const pathToUse = elementDefinition.path;\n      const optionsToUse = elementDefinition.options;\n      const addElementsToUse = elementDefinition[addElementsKey];\n      const methodPathToUse = elementDefinition.method;\n      const elementModsToUse = elementDefinition.mods;\n      const firstScenario = elementDefinition.scenario;\n\n      let collectionPath;\n      if (pathToUse == null || pathToUse === '') {\n        collectionPath = rootCollection;\n      } else {\n        collectionPath = rootCollection.getElement(pathToUse);\n      }\n      // Check for critical errors\n      if (nameToUse == null || nameToUse === '') {\n        // $FlowFixMe\n        throw new Error(`Figure addElement ERROR  at index ${index} in collection ${rootCollection.name}: missing name property in ${elementDefinition}`);\n      }\n      if (methodPathToUse == null || methodPathToUse === '') {\n        // $FlowFixMe\n        throw new Error(`Figure addElement ERROR  at index ${index} in collection ${rootCollection.name}: missing method property in ${elementDefinition}`);\n      }\n      if (!(collectionPath instanceof FigureElementCollection)) {\n        // $FlowFixMe\n        throw new Error(`Figure addElement ERROR at index ${index} in collection ${rootCollection.name}: missing or incorrect path property in ${elementDefinition}`);\n      }\n\n      const methodPath = methodPathToUse.split('/');\n\n      const method = this.getMethod(methodPathToUse);\n\n      if (typeof method !== 'function') {\n        return;\n      }\n\n      if (typeof method !== 'function') {\n        throw new Error(`Layout addElement at index ${index} in collection ${rootCollection.name}: incorrect method property`);\n      }\n\n      let newElement;\n      if (methodPath.slice(-1)[0].startsWith('add')) {\n        newElement = method(collectionPath, nameToUse, optionsToUse);\n        if (newElement == null) {\n          return;\n        }\n        if (elementModsToUse != null && elementModsToUse !== {}) {\n          newElement.setProperties(elementModsToUse);\n        }\n      } else {\n        if (Array.isArray(optionsToUse)) {\n          newElement = method(...optionsToUse);\n        } else {\n          newElement = method(optionsToUse);\n        }\n        if (newElement == null) {\n          return;\n        }\n        if (elementModsToUse != null && elementModsToUse !== {}) {\n          newElement.setProperties(elementModsToUse);\n        }\n        if (collectionPath instanceof FigureElementCollection) {\n          collectionPath.add(nameToUse, newElement);\n        }\n      }\n\n      // element.setProperties(elementDefinition, [\n      //   'mods', 'name', 'method', 'scenario', 'addElementsKey', 'options', 'path',\n      // ]);\n      if (firstScenario != null && firstScenario in newElement.scenarios) {\n        newElement.setScenario(firstScenario);\n      }\n\n      if (`_${nameToUse}` in rootCollection\n          && (addElementsToUse != null && addElementsToUse !== {})\n      ) {\n        newElement.add(addElementsToUse);\n      }\n    });\n  }\n\n  getMethod(method: string) {\n    const getPath = (e: {}, remainingPath: Array<string>) => {\n      if (!(remainingPath[0] in e)) {\n        return null;\n      }\n      if (remainingPath.length === 1) {          // $FlowFixMe\n        return e[remainingPath[0]];\n      }                                          // $FlowFixMe\n      return getPath(e[remainingPath[0]], remainingPath.slice(1));\n    };\n    const { collections } = this;\n    const shapes = collections.primitives;\n    const methods = {\n      collection: collections.collection.bind(collections),\n      polyline: shapes.polyline.bind(shapes),\n      polygon: shapes.polygon.bind(shapes),\n      rectangle: shapes.rectangle.bind(shapes),\n      ellipse: shapes.ellipse.bind(shapes),\n      triangle: shapes.triangle.bind(shapes),\n      generic: shapes.generic.bind(shapes),\n      grid: shapes.grid.bind(shapes),\n      arrow: shapes.arrow.bind(shapes),\n      line: shapes.line.bind(shapes),\n      star: shapes.star.bind(shapes),\n      //\n      text: shapes.text.bind(shapes),\n      textLine: shapes.textLine.bind(shapes),\n      textLines: shapes.textLines.bind(shapes),\n      'text.line': shapes.textLine.bind(shapes),\n      'text.lines': shapes.textLines.bind(shapes),\n      //\n      textGL: shapes.textGL.bind(shapes),\n      textHTML: shapes.htmlText.bind(shapes),\n      htmlImage: shapes.htmlImage.bind(shapes),\n      //\n      opolyline: collections.polyline.bind(collections),\n      oline: collections.line.bind(collections),\n      angle: collections.angle.bind(collections),\n      //\n      addEquation: collections.addEquation.bind(collections),\n      equation: collections.equation.bind(collections),\n      addNavigator: collections.addNavigator.bind(collections),\n    };\n    if (method in methods) {\n      return methods[method];\n    }\n    const figure = {\n      primitives: shapes,\n      shapes,\n      collections,\n    };\n    const splitMethod = method.split('.');\n    let methodToUse = getPath(figure, splitMethod);\n    if (methodToUse == null) {\n      return null;\n    }\n    methodToUse = methodToUse.bind(getPath(figure, splitMethod.slice(0, -1)));\n    return methodToUse;\n  }\n\n  setFigure(figure: OBJ_FigureForElement) {\n    super.setFigure(figure);\n    if (this.onAdd != null) {\n      this.fnMap.exec(this.onAdd);\n    }\n    for (let i = 0, j = this.drawOrder.length; i < j; i += 1) {\n      const element = this.elements[this.drawOrder[i]];\n      element.setFigure(figure);\n      if (element.onAdd != null) {\n        this.fnMap.exec(element.onAdd);\n      }\n    }\n  }\n\n  willStartAnimating() {\n    const result = super.willStartAnimating();\n    if (result) {\n      return true;\n    }\n    for (let i = 0, j = this.drawOrder.length; i < j; i += 1) {\n      if (this.elements[this.drawOrder[i]].willStartAnimating()) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  setupDraw(\n    // parentTransform: Transform = new Transform(),\n    now: number = 0,\n    canvasIndex: number = 0,\n  ) {\n    // console.log('draw', this.name)\n    if (this.isShown) {\n      this.lastDrawTime = now;\n      // if (this.pulseSettings.clearFrozenTransforms) {\n      //   this.frozenPulseTransforms = [];\n      //   this.pulseSettings.clearFrozenTransforms = false;\n      // }\n      if (this.isRenderedAsImage === true) {\n        if (this.willStartAnimating()) {\n          this.unrender();\n        } else {\n          return;\n        }\n      }\n      if (this.beforeDrawCallback != null) {\n        this.fnMap.exec(this.beforeDrawCallback, now);\n      }\n\n      // console.l^ *consoleog(this.name, now);\n      this.animations.nextFrame(now);\n      this.nextMovingFreelyFrame(now);\n\n      // set next color can end up hiding an element when disolving out\n      if (!this.isShown) {\n        return;\n      }\n\n      // this.lastDrawElementTransformPosition = {\n      //   parentCount: parentTransform.order.length,\n      //   elementCount: this.transform.order.length,\n      // };\n      // const newTransform = parentTransform.transform(this.getTransform());\n      // this.lastDrawTransform = newTransform._dup();\n      // this.pulseTransforms = this.getPulseTransforms(now);\n      // this.drawTransforms = this.getDrawTransforms(newTransform);\n      // // this.pulseTransforms\n      // // eslint-disable-next-line prefer-destructuring\n      // this.lastDrawPulseTransform = this.drawTransforms[0];\n      // this.lastDrawTransform = pulseTransforms[0];\n\n      // this.lastDrawPulseTransform = pulseTransforms[0]._dup();\n\n      // for (let k = 0; k < this.drawTransforms.length; k += 1) {\n      for (let i = 0, j = this.drawOrder.length; i < j; i += 1) {\n        this.elements[this.drawOrder[i]].setupDraw(now, canvasIndex);\n      }\n      // }\n      // if (this.unrenderNextDraw) {\n      //   this.clearRender();\n      //   this.unrenderNextDraw = false;\n      // }\n      // if (this.renderedOnNextDraw) {\n      //   this.isRenderedAsImage = true;\n      //   this.renderedOnNextDraw = false;\n      // }\n      // // this.redrawElements.forEach((element) => {\n      // //   element.draw(element.getParentLastDrawTransform(), now);\n      // // })\n      // if (this.afterDrawCallback != null) {\n      //   // this.afterDrawCallback(now);\n      //   this.fnMap.exec(this.afterDrawCallback, now);\n      // }\n    }\n  }\n\n  draw(\n    now: number,\n    parentTransform: Array<Transform> = [new Transform()],\n    parentOpacity: number = 1,\n    canvasIndex: number = 0,\n  ) {\n    if (this.isShown) {\n      const ttt = performance.now()\n      // if (this.name === 'eqn') {\n      //   console.log('start eqn')\n      // }\n      // for (let k = 0; k < this.pulseTransforms.length; k += 1) {\n      this.lastDrawElementTransformPosition = {\n        parentCount: parentTransform[0].order.length,\n        elementCount: this.transform.order.length,\n      };\n      const transform = this.getTransform();\n      const newTransforms = transformBy(parentTransform, [transform]);\n      // this.lastDrawTransform = transform._dup();\n      this.lastDrawTransform = parentTransform[0].transform(transform)._dup();\n      this.pulseTransforms = this.getPulseTransforms(now);\n      this.drawTransforms = this.getDrawTransforms(newTransforms);\n      // this.pulseTransforms\n      // eslint-disable-next-line prefer-destructuring\n      this.lastDrawPulseTransform = this.drawTransforms[0];\n\n      const opacityToUse = this.color[3] * this.opacity * parentOpacity;\n      this.lastDrawOpacity = opacityToUse;\n      // console.log()\n      // let cum = performance.now() - ttt;\n      // console.log('cum start', round(cum, 2))\n      const ttt1 = performance.now()\n      const tArray = [];\n      for (let i = 0, j = this.drawOrder.length; i < j; i += 1) {\n        const tttt = performance.now()\n        this.elements[this.drawOrder[i]].draw(\n          now, this.drawTransforms, opacityToUse, canvasIndex,\n        );\n        tArray.push([this.elements[this.drawOrder[i]].name, performance.now() - tttt])\n        // const delta = performance.now() - tttt;\n        // cum += delta;\n        // console.log('---', this.elements[this.drawOrder[i]].name, round(delta, 2))\n      }\n      const ttt2 = performance.now()\n      // console.log(round(performance.now() - ttt, 2), round(cum, 2))\n      // }\n      if (this.unrenderNextDraw) {\n        this.clearRender();\n        this.unrenderNextDraw = false;\n      }\n      if (this.renderedOnNextDraw) {\n        this.isRenderedAsImage = true;\n        this.renderedOnNextDraw = false;\n      }\n      // this.redrawElements.forEach((element) => {\n      //   element.draw(element.getParentLastDrawTransform(), now);\n      // })\n      if (this.afterDrawCallback != null) {\n        // this.afterDrawCallback(now);\n        this.fnMap.exec(this.afterDrawCallback, now);\n      }\n      // console.log('>>', this.name, round(performance.now() - ttt, 2),\n      //   round(ttt1 - ttt, 2), round(ttt2 - ttt1, 2), round(performance.now() - ttt2, 2), tArray\n      // )\n      window.timeData.push(['>>', this.name, round(performance.now() - ttt, 2),\n        round(ttt1 - ttt, 2), round(ttt2 - ttt1, 2), round(performance.now() - ttt2, 2), tArray])\n    }\n  }\n\n  exec(\n    execFunctionAndArgs: string | Array<string | Object>,\n    elementsToExec: ?Array<string | FigureElement> = null,\n  ) {\n    if (elementsToExec == null) {\n      super.exec(execFunctionAndArgs);\n      return;\n    }\n\n    if (Array.isArray(elementsToExec) && elementsToExec.length === 0) {\n      return;\n    }\n\n    elementsToExec.forEach((elementToExec) => {\n      let element: ?FigureElement;\n      if (typeof elementToExec === 'string') {\n        element = this.getElement(elementToExec);\n      } else {\n        element = elementToExec;\n      }\n      if (element != null) {\n        element.exec(execFunctionAndArgs);\n      }\n    });\n  }\n\n  pulse(\n    optionsOrElementsOrDone: ?(\n      OBJ_Pulse & { elements?: Array<string | FigureElement> }\n      | Array<string | FigureElement>\n      | ((mixed) => void)\n    ) = null,\n    done: ?((mixed) => void) = null,\n  ) {\n    if (optionsOrElementsOrDone == null\n      || typeof optionsOrElementsOrDone === 'function'\n      || typeof optionsOrElementsOrDone === 'string'\n    ) {\n      super.pulse(optionsOrElementsOrDone);\n      return;\n    }\n\n    if (\n      !Array.isArray(optionsOrElementsOrDone)\n      && optionsOrElementsOrDone.centerOn != null\n      && typeof optionsOrElementsOrDone.centerOn === 'string'\n    ) {\n      const e = this.getElement(optionsOrElementsOrDone.centerOn);\n      if (e != null) {\n        // eslint-disable-next-line no-param-reassign\n        optionsOrElementsOrDone.centerOn = e;\n      }\n    }\n\n    if (\n      !Array.isArray(optionsOrElementsOrDone)\n      && (\n        optionsOrElementsOrDone.elements == null\n        || optionsOrElementsOrDone.elements.length === 0\n      )\n    ) {\n      super.pulse(optionsOrElementsOrDone);\n      return;\n    }\n    // const defaultOptions = this.pulseDefault;\n\n    let doneToUse;\n    let options;\n    let elements;\n    if (Array.isArray(optionsOrElementsOrDone)) {\n      options = {};\n      doneToUse = done;\n      elements = optionsOrElementsOrDone;\n    } else {\n      options = joinObjects({}, optionsOrElementsOrDone);\n      ({ elements } = options);\n      doneToUse = options.done;\n      if (optionsOrElementsOrDone.scale == null) {\n        options.scale = undefined;\n      }\n      if (optionsOrElementsOrDone.frequency == null) {\n        options.frequency = undefined;\n      }\n      if (optionsOrElementsOrDone.duration == null) {\n        options.duration = undefined;\n      }\n    }\n    options.elements = null;\n    // if (elements == null || elements.length === 0) {\n    //   super.pulse(optionsOrElementsOrDone);\n    //   return;\n    // }\n\n    let counter = 0;\n    const combinedCallback = () => {\n      counter += 1;\n      if (counter === elements.length) {\n        if (doneToUse != null) {\n          doneToUse();\n        }\n      }\n    };\n    // $FlowFixMe\n    options.done = combinedCallback;\n    // let doneToUse = done;\n    elements.forEach((elementToPulse) => {\n      let element: ?FigureElement;\n      if (typeof elementToPulse === 'string') {\n        element = this.getElement(elementToPulse);\n      } else {\n        element = elementToPulse;\n      }\n      if (element != null) {\n        // element.pulseDefault(doneToUse);\n        element.pulse(options);\n        // doneToUse = null;\n      }\n    });\n    // if (doneToUse != null) {\n    //   doneToUse();\n    // }\n\n    // if (typeof this.pulseDefault === 'function') {\n    //   this.pulseDefault(done);\n    // } else {\n    //   // const { frequency, time, scale } = this.pulseDefault;\n    //   // this.pulseScaleNow(time, scale, frequency, done);\n    //   this.pulseScaleRelativeTo(\n    //     options.centeredOn,\n    //     options.x,\n    //     options.y,\n    //     options.space,\n    //     options.time,\n    //     options.scale,\n    //     options.frequency,\n    //     done,\n    //   );\n    // }\n  }\n\n  /**\n   * Get element from an element path with '.' separators.\n   *\n   * For instance, if a collection has a child collection 'a', which\n   * has a child primitive 'b', then the path would be: 'a.b'.\n   *\n   * @see <a href=\"#figureelementcollectiongetelement\">element.getElement</a>\n   *\n   * @param {null | string} elementPath\n   * @return {FigureElement | null } element at path. If `elementPath`\n   * is `null`, then this element is returned. If `elementPath` is invalid\n   * then `null` is returned.\n   *\n   * @example\n   * // Get all the elements from a figure\n   * figure.add(\n   *   {\n   *     name: 'c',\n   *     method: 'collection',\n   *     elements: [\n   *       {\n   *         name: 'tri',\n   *         method: 'triangle',\n   *         options: {\n   *           height: 0.4,\n   *           width: 0.4,\n   *         },\n   *       },\n   *       {\n   *         name: 'text',\n   *         method: 'text',\n   *         options: {\n   *           text: 'triangle',\n   *           position: [0, -0.4],\n   *           xAlign: 'center',\n   *         },\n   *       },\n   *     ],\n   *   },\n   * );\n   *\n   * const c = figure.getElement('c');\n   * // Elements within collections can be found with dot notation\n   * const tri = figure.getElement('c.tri');\n   * // Or the collection can be queried directly\n   * const text = c.getElement('text');\n   */\n  getElement(elementPath: ?(string | FigureElement) = null) {\n    if (elementPath == null) {\n      return this;\n    }\n    if (typeof elementPath !== 'string') {\n      return elementPath;\n    }\n    if (elementPath instanceof FigureElement) {\n      return elementPath;\n    }\n    const getElement = (inputElementPath, parent) => {\n      const ep = inputElementPath.split('.');\n      let newParent = parent.elements[ep[0]];\n      if (newParent == null) {\n        // $FlowFixMe\n        newParent = parent[ep[0]];\n      }\n      if (newParent == null) {\n        return undefined;\n      }\n      if (ep.length > 1) {\n        return getElement(ep.slice(1).join('.'), newParent);\n      }\n      return newParent;\n    };\n    return getElement(elementPath, this);\n  }\n\n  /**\n   * Returns an array of result from\n   * [getElement](#figureelementcollectiongetelement) calls on an\n   * array of paths.\n   *\n   * @param {TypeElementPath} children\n   * @return {Array<FigureElement>} Array of\n   * [getElement](#figureelementcollectiongetelement) results\n   */\n  getElements(children: TypeElementPath) {\n    // const paths = [];\n    const processPath = (path, prefix = '') => {\n      if (typeof path === 'string') {\n        return [`${prefix}${path}`];\n      }\n      if (path instanceof FigureElement) {\n        return [path];\n      }\n      if (Array.isArray(path)) {\n        const out = [];\n        path.forEach((p) => {\n          out.push(...processPath(p, prefix));\n        });\n        return out;\n      }\n      const out = [];\n      Object.keys(path).forEach((p) => {\n        out.push(...processPath(path[p], `${prefix}${p}.`));\n      });\n      return out;\n    };\n    const paths = processPath(children);\n    const elements = [];\n    paths.forEach((child) => {\n      const element = this.getElement(child);\n      if (element != null) {\n        elements.push(element);\n      }\n    });\n    return elements;\n  }\n\n\n  /**\n   * Show collection or specific elements within the collection\n   */\n  show(toShow: TypeElementPath = []): void {\n    super.show();\n    this.getElements(toShow).forEach((element) => {\n      element.showAll();\n    });\n    // // if (toShow == null) {\n    // //   this.showAll();\n    // //   return;\n    // // }\n    // let listToShow = toShow;\n    // if (!Array.isArray(listToShow)) {\n    //   listToShow = [toShow];\n    // }\n    // listToShow.forEach((elementOrName) => {\n    //   let element = elementOrName;\n    //   if (typeof elementOrName === 'string') {\n    //     element = this.getElement(elementOrName);\n    //   }\n    //   element.showAll();\n    //   // if (element instanceof FigureElementCollection) {\n    //   //   element.showAll();\n    //   // } else {\n    //   //   element.show();\n    //   // }\n    // });\n  }\n\n  showOnly(\n    toShow: TypeElementPath = [],\n  ): void {\n    this.hideAll();\n    this.show(toShow);\n  }\n\n  showAll(): void {\n    super.show();\n    for (let i = 0, j = this.drawOrder.length; i < j; i += 1) {\n      const element = this.elements[this.drawOrder[i]];\n      element.showAll();\n    }\n  }\n\n  /**\n   * Hide collection or specific elements within the collection\n   */\n  hide(\n    toHide: TypeElementPath | null = null,\n  ): void {\n    if (toHide == null) {\n      super.hide();\n      return;\n    }\n    this.getElements(toHide).forEach((element) => {\n      element.hide();\n    });\n    // let listToHide = toHide;\n    // if (!Array.isArray(listToHide)) {\n    //   listToHide = [toHide];\n    // }\n    // if (listToHide.length === 0) {\n    //   super.hide();\n    //   return;\n    // }\n    // listToHide.forEach((elementOrName) => {\n    //   let element = elementOrName;\n    //   if (typeof elementOrName === 'string') {\n    //     element = this.getElement(elementOrName);\n    //   }\n    //   if (element instanceof FigureElementCollection) {\n    //     element.hideAll();\n    //   } else {\n    //     element.hide();\n    //   }\n    // });\n  }\n\n  hideAll(): void {\n    this.hide();\n    for (let i = 0, j = this.drawOrder.length; i < j; i += 1) {\n      const element = this.elements[this.drawOrder[i]];\n      element.hide();\n      if (typeof element.hideAll === 'function') {\n        element.hideAll();\n      }\n    }\n  }\n\n  hideOnly(listToHide: TypeElementPath): void {\n    this.showAll();\n    this.hide(listToHide);\n    // for (let i = 0, j = listToHide.length; i < j; i += 1) {\n    //   const element = listToHide[i];\n    //   element.hide();\n    // }\n  }\n\n  // // This will only search elements within the collection for a touch\n  // // if the collection is touchable. Note, the elements can be queried\n  // // directly still, and will return if they are touched if they themselves\n  // // are touchable.\n  // isBeingTouched(glLocation: Point) {\n  //   if (!this.isTouchable) {\n  //     return false;\n  //   }\n  //   const vertexLocation = glLocation.transformBy(this.spaceTransformMatrix('gl', 'draw'));\n  //   if (this.touchInBoundingRect !== false) {\n  //     let buffer = 0;\n  //     if (typeof this.touchInBoundingRect === 'number') {\n  //       buffer = this.touchInBoundingRect;\n  //     }\n  //     const boundingRect = this.getBoundingRect('draw');\n  //     if (vertexLocation.x >= boundingRect.left - buffer\n  //       && vertexLocation.x <= boundingRect.right + buffer\n  //       && vertexLocation.y <= boundingRect.top + buffer\n  //       && vertexLocation.y >= boundingRect.bottom - buffer\n  //     ) {\n  //       return true;\n  //     }\n  //   }\n  //   for (let i = 0, j = this.drawOrder.length; i < j; i += 1) {\n  //     const element = this.elements[this.drawOrder[i]];\n  //     if (element.isShown === true) {\n  //       if (element.isBeingTouched(glLocation)) {\n  //         return true;\n  //       }\n  //     }\n  //   }\n  //   return false;\n  // }\n\n  resizeHtmlObject() {\n    for (let i = 0; i < this.drawOrder.length; i += 1) {\n      const element = this.elements[this.drawOrder[i]];\n      element.resizeHtmlObject();\n    }\n  }\n\n  resize(figureHTMLElement: ?HTMLElement = null) {\n    super.resize(figureHTMLElement);\n    for (let i = 0; i < this.drawOrder.length; i += 1) {\n      const element = this.elements[this.drawOrder[i]];\n      element.resize(figureHTMLElement);\n    }\n  }\n\n  clear(canvasIndex: number = 0) {\n    for (let i = 0; i < this.drawOrder.length; i += 1) {\n      const element = this.elements[this.drawOrder[i]];\n      element.clear(canvasIndex);\n    }\n  }\n\n  setFirstTransform(parentTransform: Transform = new Transform()) {\n    // const finalParentTransform = this.processParentTransform(parentTransform);\n    const firstTransform = parentTransform.transform(this.getTransform());\n    this.lastDrawTransform = firstTransform._dup();\n\n    for (let i = 0; i < this.drawOrder.length; i += 1) {\n      const element = this.elements[this.drawOrder[i]];\n      element.setFirstTransform(firstTransform);\n    }\n    this.checkMoveBounds();\n  }\n\n  // border is whatever border is\n  // children is touch borders of children\n  // rect is rect of children touchBorder\n  // number is buffer of rect of children touch border\n  getBorderPoints(\n    border: 'border' | 'touchBorder' | 'holeBorder' = 'border',\n    children: Array<string | FigureElement> | null = null,\n    shownOnly: boolean = true,\n  ): TypeBorder {\n    const getBorderFromChildren = (b) => {\n      const childrenBorder = [];\n      let childrenToUse = children;\n      if (childrenToUse == null) {\n        childrenToUse = Object.keys(this.elements);\n      }\n      if (childrenToUse.length === 0) {\n        return [[]];\n      }\n      childrenToUse.forEach((child) => {\n        const e = this.getElement(child);\n        if (\n          e == null\n          || (shownOnly && e.isShown === false)\n        ) {\n          return;\n        }\n        // $FlowFixMe\n        childrenBorder.push(...e.getBorder('local', b, null, shownOnly));\n      });\n      return childrenBorder;\n    };\n\n    if (border === 'border') {\n      if (this.border === 'children') {\n        return getBorderFromChildren('border');\n      }\n      if (this.border === 'rect') { // $FlowFixMe\n        return [getBoundingBorder(getBorderFromChildren('border'))];\n      }\n      if (isBuffer(this.border)) { // $FlowFixMe\n        return [getBoundingBorder(getBorderFromChildren('border'), this.border)];\n      } // $FlowFixMe\n      return this.border;\n    }\n    if (border === 'touchBorder') {\n      if (this.touchBorder === 'border') {\n        return this.getBorderPoints('border', children, shownOnly);\n      }\n      if (this.touchBorder === 'children') {\n        return getBorderFromChildren('touchBorder');\n      }\n      if (this.touchBorder === 'rect') { // $FlowFixMe\n        return [getBoundingBorder(getBorderFromChildren('touchBorder'))];\n      }\n      if (isBuffer(this.touchBorder)) { // $FlowFixMe\n        return [getBoundingBorder(getBorderFromChildren('touchBorder'), this.touchBorder)];\n      } // $FlowFixMe\n      return this.touchBorder;\n    }\n    if (this.holeBorder === 'children') {\n      return getBorderFromChildren('holeBorder');\n    }\n    return this.holeBorder;\n  }\n\n  getBorder(\n    space: TypeSpace | Array<number> = 'local',\n    border: 'touchBorder' | 'border' | 'holeBorder' = 'border',\n    children: ?Array<string | FigureElement> = null,\n    shownOnly: boolean = true,\n  ) {\n    if (shownOnly && this.isShown === false) {\n      return [[]];\n    }\n    let matrix;\n    if (Array.isArray(space)) {\n      matrix = m2.mul(space, this.getTransform().matrix());\n    } else {\n      matrix = this.spaceTransformMatrix('draw', space);\n    }\n    const borderPoints = this.getBorderPoints(border, children, shownOnly);\n    return borderPoints.map(b => b.map(p => getPoint(p).transformBy(matrix)));\n  }\n\n  getBoundingRect(\n    space: TypeSpace = 'local',\n    border: 'touchBorder' | 'border' | 'holeBorder' = 'border',\n    children: ?Array<string | FigureElement> = null,\n    shownOnly: boolean = true,\n  ) {\n    const transformedBorder = this.getBorder(space, border, children, shownOnly);\n    // console.log(space, border, children, shownOnly)\n    // console.log(transformedBorder)\n    // $FlowFixMe\n    return getBoundingRect(transformedBorder);\n  }\n\n  getRelativeBoundingRect(\n    space: TypeSpace = 'local',\n    border: 'border' | 'touchBorder' | 'holeBorder' = 'border',\n    children: ?Array<string | FigureElement> = null,\n    shownOnly: boolean = true,\n  ) {\n    const rect = this.getBoundingRect(space, border, children, shownOnly);\n    const position = this.getPosition(space);\n    return new Rect(\n      rect.left - position.x,\n      rect.bottom - position.y,\n      rect.width,\n      rect.height,\n    );\n  }\n\n  getPositionInBounds(\n    space: TypeSpace = 'local',\n    xAlign: 'center' | 'left' | 'right' | 'location' | number = 'location',\n    yAlign: 'middle' | 'top' | 'bottom' | 'location' | number = 'location', // $FlowFixMe\n    children: ?Array<string | FigureElement> = null,\n    border: 'border' | 'touchBorder' | 'holeBorder' = 'border',\n    shownOnly: boolean = true,\n  ) {\n    const bounds = this.getBoundingRect(space, border, children, shownOnly);\n    const p = this.getPosition(space);\n    if (xAlign === 'left') {\n      p.x = bounds.left;\n    } else if (xAlign === 'right') {\n      p.x = bounds.right;\n    } else if (xAlign === 'center') {\n      p.x = bounds.left + bounds.width / 2;\n    } else if (typeof xAlign === 'number') {\n      p.x = bounds.left + bounds.width * xAlign;\n    }\n    if (yAlign === 'top') {\n      p.y = bounds.top;\n    } else if (yAlign === 'bottom') {\n      p.y = bounds.bottom;\n    } else if (yAlign === 'middle') {\n      p.y = bounds.bottom + bounds.height / 2;\n    } else if (typeof yAlign === 'number') {\n      p.y = bounds.bottom + bounds.height * yAlign;\n    }\n    return p;\n  }\n\n  updateLimits(\n    limits: Rect,\n    transforms: OBJ_SpaceTransforms = this.figureTransforms,\n  ) {\n    for (let i = 0; i < this.drawOrder.length; i += 1) {\n      const element = this.elements[this.drawOrder[i]];\n      element.updateLimits(limits, transforms);\n    }\n    this.figureLimits = limits;\n    this.figureTransforms = transforms;\n  }\n\n  updateHTMLElementTie(\n    container: HTMLElement,\n  ) {\n    super.updateHTMLElementTie(\n      container,\n    );\n    for (let i = 0; i < this.drawOrder.length; i += 1) {\n      const element = this.elements[this.drawOrder[i]];\n      element.updateHTMLElementTie(\n        container,\n      );\n    }\n  }\n\n  // Returns an array of touched elements.\n  // In a collection, elements defined later in the collection.order\n  // array are on top of earlier elements. The touched array\n  // is sorted to have elements on top first, where the collection containing\n  // the elements will be before it's elements. For example, the array\n  // would be ordered as:\n  //  0: top collection\n  //  1 to n: n top elements in collection\n  //  n+1: second top collection\n  //  n+2 to m: top elements in second top colleciton.\n  getTouched(glLocation: Point): Array<FigureElement> {\n    if (!this.isTouchable && !this.hasTouchableElements) {\n      return [];\n    }\n    let touched = [];\n    // if (this.touchInBoundingRect !== false || this.isTouchable) {\n    //   if (this.isBeingTouched(glLocation)) {\n    //     touched.push(this);\n    //   }\n    // }\n    if (this.isTouchable) {\n      return super.getTouched(glLocation);\n    }\n    for (let i = this.drawOrder.length - 1; i >= 0; i -= 1) {\n      const element = this.elements[this.drawOrder[i]];\n      if (element.isShown === true) {\n        touched = touched.concat(element.getTouched(glLocation));\n      }\n\n      // If there is an element that is touched, then this collection should\n      // also be touched.\n      // if (touched.length > 0 && this.isTouchable) {\n      //   touched = [this].concat(touched);\n      // }\n    }\n    return touched;\n  }\n\n  stop(\n    how: 'freeze' | 'cancel' | 'complete' | 'animateToComplete' | 'dissolveToComplete' = 'cancel',\n    elementOnly: boolean = false,\n  ) {\n    super.stop(how);\n    if (elementOnly) {\n      return;\n    }\n    for (let i = 0; i < this.drawOrder.length; i += 1) {\n      const element = this.elements[this.drawOrder[i]];\n      element.stop(how, elementOnly);\n      // element.cancel(forceSetToEndOfPlan);\n    }\n  }\n\n  setFont(fontSize: number) {\n    for (let i = 0; i < this.drawOrder.length; i += 1) {\n      const element = this.elements[this.drawOrder[i]];\n      element.setFont(fontSize);\n    }\n  }\n\n  setColor(color: TypeColor = [0, 0, 0, 1], setDefault: boolean = true) {\n    const nonNullColor = color != null ? color : [0, 0, 0, 0];\n    for (let i = 0; i < this.drawOrder.length; i += 1) {\n      const element = this.elements[this.drawOrder[i]];\n      element.setColor(nonNullColor, setDefault);\n    }\n    this.color = nonNullColor.slice();\n    if (setDefault) {\n      this.defaultColor = this.color.slice();\n    }\n    // this.color = [color[0], color[1], color[2], color[3]];\n  }\n\n  setDimColor(color: TypeColor = [0, 0, 0, 1]) {\n    const nonNullColor = color != null ? color : [0, 0, 0, 0];\n    for (let i = 0; i < this.drawOrder.length; i += 1) {\n      const element = this.elements[this.drawOrder[i]];\n      element.setDimColor(nonNullColor);\n    }\n    this.dimColor = nonNullColor.slice();\n  }\n\n  undim() {\n    this.color = this.defaultColor.slice();\n    for (let i = 0; i < this.drawOrder.length; i += 1) {\n      const element = this.elements[this.drawOrder[i]];\n      element.undim();\n    }\n  }\n\n  dim(elementsToDim: ?Array<string | FigureElement>) {\n    if (elementsToDim == null\n      || (Array.isArray(elementsToDim) && elementsToDim.length === 0)) {\n      // super.dim();\n      this.color = this.dimColor.slice();\n      for (let i = 0; i < this.drawOrder.length; i += 1) {\n        const element = this.elements[this.drawOrder[i]];\n        element.dim();\n      }\n      return;\n    }\n    this.exec('dim', elementsToDim);\n  }\n\n  highlight(elementsToHighlight: ?Array<string | FigureElement> = null) {\n    if (elementsToHighlight == null) {\n      this.undim();\n      return;\n    }\n\n    if (Array.isArray(elementsToHighlight) && elementsToHighlight.length === 0) {\n      return;\n    }\n\n    this.dim();\n    this.exec('undim', elementsToHighlight);\n  }\n\n  // setOpacity(opacity: number) {\n  //   // for (let i = 0; i < this.drawOrder.length; i += 1) {\n  //   //   const element = this.elements[this.drawOrder[i]];\n  //   //   element.setOpacity(opacity);\n  //   // }\n  //   // this.color[3] = opacity;\n  //   this.opacity = opacity;\n  // }\n\n  getElementTransforms() {\n    const out = {};\n    for (let i = 0; i < this.drawOrder.length; i += 1) {\n      const element = this.elements[this.drawOrder[i]];\n      out[element.name] = element.transform._dup();\n    }\n    return out;\n  }\n\n  setElementTransforms(elementTransforms: Object) {\n    for (let i = 0; i < this.drawOrder.length; i += 1) {\n      const element = this.elements[this.drawOrder[i]];\n      if (element.name in elementTransforms) {\n        element.transform = elementTransforms[element.name];\n        if (element.internalSetTransformCallback) {\n          this.fnMap.exec(element.internalSetTransformCallback, element.transform);\n        }\n      }\n    }\n  }\n\n  reorder() {\n    this.drawOrder.sort((a, b) => {\n      const elemA = this.elements[a];\n      const elemB = this.elements[b];\n      return elemB.drawPriority - elemA.drawPriority;\n    });\n    // this.elements.sort((a, b) => {\n    //   const elemA\n    //   b.z - a.z});\n    for (let i = 0; i < this.drawOrder.length; i += 1) {\n      const element = this.elements[this.drawOrder[i]];\n      if (element instanceof FigureElementCollection) {\n        element.reorder();\n      }\n    }\n  }\n\n  // }\n  animateToTransforms(\n    elementTransforms: Object,\n    time: number = 1,\n    delay: number = 0,\n    rotDirection: number = 0,\n    callback: ?(string | ((?mixed) => void)) = null,\n    name: string = '',\n    easeFunction: string | ((number) => number) = 'tools.math.easeinout',\n    // translationPath: (Point, Point, number) => Point = linearPath,\n  ) {\n    let callbackMethod = callback;\n    let timeToAnimate = 0;\n    for (let i = 0; i < this.drawOrder.length; i += 1) {\n      const element = this.elements[this.drawOrder[i]];\n      if (element.name in elementTransforms) {\n        if (element.isShown) {\n          if (!elementTransforms[element.name].isEqualTo(element.transform)) {\n            element.animations.new(name)\n              .delay(delay)\n              .transform({\n                target: elementTransforms[element.name],\n                duration: time,\n                rotDirection,\n                progression: easeFunction,\n                onFinish: callbackMethod,\n              })\n              .start();\n            // only want to send callback once\n            callbackMethod = null;\n            timeToAnimate = time + delay;\n          }\n        } else {\n          element.transform = elementTransforms[element.name]._dup();\n          if (element.internalSetTransformCallback) {\n            this.fnMap.exec(element.internalSetTransformCallback, element.transform);\n          }\n        }\n      }\n    }\n    if (timeToAnimate === 0 && callbackMethod != null) {\n      this.fnMap.exec(callbackMethod, true);\n      // callbackMethod(true);\n    }\n    return timeToAnimate;\n  }\n\n  /**\n   * Get all elements within the collection that are primitives, including\n   * any primitives that are children of this element, and any primitives that\n   * are children of this element's children and so forth.\n   *\n   * @return {Array<FigureElement>}\n   */\n  getAllPrimitives() {\n    let elements = [];\n    for (let i = 0; i < this.drawOrder.length; i += 1) {\n      const element = this.elements[this.drawOrder[i]];\n      if (element instanceof FigureElementCollection) {\n        elements = [...elements, ...element.getAllPrimitives()];\n      } else {\n        elements.push(element);\n      }\n    }\n    return elements;\n  }\n\n  /**\n   * Get an array of all elements of in this collection, including this element,\n   * children, children of children and so forth.\n   *\n   * @return {Array<FigureElement>}\n   */\n  getAllElements() {\n    const elements = [this];\n    for (let i = 0; i < this.drawOrder.length; i += 1) {\n      const element = this.elements[this.drawOrder[i]];\n      // elements.push(element);\n      if (element instanceof FigureElementCollection) {\n        elements.push(...element.getAllElements());\n      } else {\n        elements.push(element);\n      }\n    }\n    return elements;\n  }\n\n  /**\n   * Get array of all children elements.\n   *\n   * @return {Array<FigureElement>}\n   */\n  getChildren() {\n    const elements = [];\n    for (let i = 0; i < this.drawOrder.length; i += 1) {\n      const element = this.elements[this.drawOrder[i]];\n      elements.push(element);\n    }\n    return elements;\n  }\n\n  getAllElementsWithScenario(scenario: string) {\n    let elements = super.getAllElementsWithScenario(scenario);\n    for (let i = 0; i < this.drawOrder.length; i += 1) {\n      const element = this.elements[this.drawOrder[i]];\n      if (element.scenarios[scenario] != null) {\n        elements.push(element);\n      }\n      if (element instanceof FigureElementCollection) {\n        elements = [...elements, ...element.getAllElementsWithScenario(scenario)];\n      }\n    }\n    return elements;\n  }\n\n  getRemainingAnimationTime(\n    animationNames: Array<string> | string = [],\n  ) {\n    const elements = this.getAllElements();\n    let remainingTime = super.getRemainingAnimationTime(animationNames);\n    elements.forEach((element) => {\n      const duration = element.animations.getRemainingTime(animationNames);\n      if (duration > remainingTime) {\n        remainingTime = duration;\n      }\n    });\n    return remainingTime;\n  }\n\n  // // Get all ineractive elemnts, but only go as deep as a\n  // // FigureElementColleciton if it is touchable or movable\n  // getAllCurrentlyInteractiveElements() {\n  //   let elements = [];\n  //   for (let i = 0; i < this.drawOrder.length; i += 1) {\n  //     const element = this.elements[this.drawOrder[i]];\n  //     // if (element.isShown) {\n  //     if (element instanceof FigureElementCollection) {\n  //       if (!element.isTouchable\n  //         && !element.isMovable\n  //         && element.hasTouchableElements\n  //         && (!element.isInteractive || element.isInteractive == null)\n  //       ) {\n  //         elements = [...elements, ...element.getAllCurrentlyInteractiveElements()];\n  //       }\n  //     }\n  //     if (element.isInteractive !== false\n  //       && (element.isTouchable || element.isMovable || element.isInteractive)) {\n  //       elements.push(element);\n  //     }\n  //     // }\n  //   }\n  //   return elements;\n  // }\n\n  // Get all ineractive elemnts, but only go as deep as a\n  // FigureElementColleciton if it is touchable or movable\n  getAllPossiblyInteractiveElements() {\n    let elements = [];\n    for (let i = 0; i < this.drawOrder.length; i += 1) {\n      const element = this.elements[this.drawOrder[i]];\n      // if (element.isShown) {\n      if (element instanceof FigureElementCollection) {\n        if (!element.isTouchable\n          && !element.isMovable\n          && element.hasTouchableElements\n          && (!element.isInteractive || element.isInteractive == null)\n        ) {\n          elements = [...elements, ...element.getAllPossiblyInteractiveElements()];\n        }\n      }\n      if (element.isInteractive !== undefined\n        || element.isTouchable\n        || element.isMovable\n      ) {\n        elements.push(element);\n      }\n    }\n    return elements;\n  }\n\n  // This method is here as a convenience method for content item selectors\n  // eslint-disable-next-line class-methods-use-this\n  goToStep(step: number) {\n    const elem = document.getElementById('id__figureone_item_selector_0');\n    const elems = [];\n    if (elem != null) {\n      if (elem.children.length > 0) {\n        for (let i = 0; i < elem.children.length; i += 1) {\n          elems.push(elem.children[i]);\n        }\n      }\n    }\n    elems.forEach((e, index) => {\n      if (index === step) {\n        e.classList.add('figureone__item_selector_selected');\n      } else {\n        e.classList.remove('figureone__item_selector_selected');\n      }\n    });\n  }\n\n  setMovable(movable: boolean = true) {\n    super.setMovable(movable);\n    if (movable) {\n      this.hasTouchableElements = true;\n      // this.isMovable = true;\n    }\n  }\n\n  // updateContext(context: DrawContext2D) {\n  //   for (let i = 0; i < this.drawOrder.length; i += 1) {\n  //     const element = this.elements[this.drawOrder[i]];\n  //     element.updateContext(context);\n  //   }\n  // }\n\n  setupWebGLBuffers(newWebgl: WebGLInstance) {\n    for (let i = 0; i < this.drawOrder.length; i += 1) {\n      const element = this.elements[this.drawOrder[i]];\n      element.setupWebGLBuffers(newWebgl);\n    }\n  }\n\n  changeWebGLInstance(newWebgl: WebGLInstance) {\n    let oldInstance;\n    for (let i = 0; i < this.drawOrder.length; i += 1) {\n      const element = this.elements[this.drawOrder[i]];\n      oldInstance = element.changeWebGLInstance(newWebgl);\n    }\n    return oldInstance;\n  }\n\n  getLoadingElements() {\n    let elems = [];\n    for (let i = 0; i < this.drawOrder.length; i += 1) {\n      const element = this.elements[this.drawOrder[i]];\n      if (element instanceof FigureElementPrimitive) {\n        if (element.drawingObject.state === 'loading') {\n          elems.push(element);\n        }\n      } else {\n        elems = [...elems, ...element.getLoadingElements()];\n      }\n    }\n    return elems;\n  }\n\n  setPointsFromDefinition() {\n    for (let i = 0; i < this.drawOrder.length; i += 1) {\n      const element = this.elements[this.drawOrder[i]];\n      if (element.setPointsFromDefinition != null) {\n        element.setPointsFromDefinition();\n      }\n    }\n  }\n\n  setPrimitiveColors() {\n    for (let i = 0; i < this.drawOrder.length; i += 1) {\n      const element = this.elements[this.drawOrder[i]];\n      if (element instanceof FigureElementPrimitive) {\n        element.setColor(element.color);\n        element.setOpacity(element.opacity);\n      } else {\n        element.setPrimitiveColors();\n      }\n      // if (element.setPointsFromDefinition != null) {\n      //   element.setPointsFromDefinition();\n      // }\n    }\n  }\n\n  unrenderAll() {\n    this.unrender();\n    for (let i = 0; i < this.drawOrder.length; i += 1) {\n      const element = this.elements[this.drawOrder[i]];\n      if (element instanceof FigureElementPrimitive) {\n        element.unrender();\n      } else {\n        element.unrenderAll();\n      }\n    }\n  }\n\n  // setScenario(scenarioName: string) {\n  //   super.setScenario(scenarioName);\n  //   if (this.scenarios[scenarioName] != null) {\n  //     const target = this.getScenarioTarget(scenarioName);\n  //     this.color = target.color.slice();\n  //   }\n  // }\n\n  /**\n   * Set transform, color and/or visibility to a predefined scenario.\n   *\n   * @param {string | Array<string>} [scenarioName] name of the scenario to\n   * set. Use an array of names to set multiple scenarios in the array's order.\n   * @param {boolean} [onlyIfVisible] `true` to only set scenario if element is\n   * visible\n   */\n  setScenarios(\n    scenarioName: string | Array<string>,\n    onlyIfVisible: boolean = false,\n  ) {\n    super.setScenarios(scenarioName);\n    for (let i = 0; i < this.drawOrder.length; i += 1) {\n      const element = this.elements[this.drawOrder[i]];\n      if ((onlyIfVisible && element.isShown) || onlyIfVisible === false) {\n        element.setScenarios(scenarioName, onlyIfVisible);\n      }\n    }\n  }\n\n  saveScenarios(scenarioName: string, keys: Array<string>) {\n    super.saveScenarios(scenarioName, keys);\n    for (let i = 0; i < this.drawOrder.length; i += 1) {\n      const element = this.elements[this.drawOrder[i]];\n      element.saveScenarios(scenarioName, keys);\n    }\n  }\n\n  animateToState(\n    state: Object,\n    options: Object,\n    independentOnly: boolean = false,\n    startTime: ?number | 'now' | 'prevFrame' | 'nextFrame' = null,\n    // lastDrawTime: number,\n    // countStart: () => void,\n    // countEnd: () => void,\n  ) {\n    let duration = 0;\n    duration = super.animateToState(\n      state, options, independentOnly, startTime,\n    );\n    if (\n      this.dependantTransform === false\n      || independentOnly === false\n    ) {\n      for (let i = 0; i < this.drawOrder.length; i += 1) {\n        const element = this.elements[this.drawOrder[i]];\n        if (state.elements != null && state.elements[this.drawOrder[i]] != null) {\n          const elementDuration = element.animateToState(\n            state.elements[this.drawOrder[i]], options,\n            independentOnly, // countStart, countEnd,\n            startTime,\n          );\n          if (elementDuration > duration) {\n            duration = elementDuration;\n          }\n        }\n      }\n    }\n    return duration;\n  }\n\n  dissolveInToState(\n    state: Object,\n    durationIn: number = 0.8,\n    startTime: ?number | 'now' | 'prevFrame' | 'nextFrame' = null,\n  ) {\n    let duration = 0;\n    duration = super.dissolveInToState(state, durationIn, startTime);\n    if (duration === 0) {\n      return 0;\n    }\n    for (let i = 0; i < this.drawOrder.length; i += 1) {\n      const element = this.elements[this.drawOrder[i]];\n      if (state.elements != null && state.elements[this.drawOrder[i]] != null) {\n        const elementDuration = element.dissolveInToState(\n          state.elements[this.drawOrder[i]], durationIn, startTime,\n        );\n        if (elementDuration > duration) {\n          duration = elementDuration;\n        }\n      }\n    }\n    return duration;\n  }\n\n  // _finishSetState(figure: Figure) {\n  //   super._finishSetState(figure);\n  //   for (let i = 0; i < this.drawOrder.length; i += 1) {\n  //     const element = this.elements[this.drawOrder[i]];\n  //     element._finishSetState(figure);\n  //   }\n  // }\n\n  setTimeDelta(delta: number) {\n    super.setTimeDelta(delta);\n    for (let i = 0; i < this.drawOrder.length; i += 1) {\n      const element = this.elements[this.drawOrder[i]];\n      element.setTimeDelta(delta);\n    }\n  }\n\n  isStateSame(\n    state: Object,\n    mergePulseTransforms: boolean = false,\n    exceptions: Array<string> = [],\n  ) {\n    const thisElementResult = super.isStateSame(state, mergePulseTransforms, exceptions);\n    if (thisElementResult === false) {\n      return false;\n    }\n    for (let i = 0; i < this.drawOrder.length; i += 1) {\n      const element = this.elements[this.drawOrder[i]];\n      if (state.elements != null && state.elements[this.drawOrder[i]] != null) {\n        const elementResult = element.isStateSame(\n          state.elements[this.drawOrder[i]], mergePulseTransforms, exceptions,\n        );\n        if (elementResult === false) {\n          return false;\n        }\n      }\n    }\n    return true;\n  }\n\n  clearFrozenPulseTransforms() {\n    super.clearFrozenPulseTransforms();\n    for (let i = 0; i < this.drawOrder.length; i += 1) {\n      const element = this.elements[this.drawOrder[i]];\n      element.clearFrozenPulseTransforms();\n    }\n  }\n\n  freezePulseTransforms(forceOverwrite: boolean = true) {\n    super.freezePulseTransforms(forceOverwrite);\n    for (let i = 0; i < this.drawOrder.length; i += 1) {\n      const element = this.elements[this.drawOrder[i]];\n      element.freezePulseTransforms(forceOverwrite);\n    }\n  }\n\n  isAnimating(): boolean {\n    // const result = super.isAnimating();\n    // if (result) {\n    //   return true;\n    // }\n    // for (let i = 0; i < this.drawOrder.length; i += 1) {\n    //   const element = this.elements[this.drawOrder[i]];\n    //   const r = element.isAnimating();\n    //   if (r) {\n    //     return true;\n    //   }\n    // }\n    // return false;\n    if (this.isShown === false) {\n      return false;\n    }\n    if (super.isAnimating()) {\n      return true;\n    }\n    for (let i = 0; i < this.drawOrder.length; i += 1) {\n      const element = this.elements[this.drawOrder[i]];\n      if (element.isAnimating()) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  remove(elementName: string) {\n    if (this.elements[elementName] == null) {\n      return;\n    }\n    const element = this.elements[elementName];\n    element.animations.cancelAll('freeze', true);\n    element.stop();\n    element.parent = null;\n    element.animations = null;\n    element.move.element = null;\n    element.recorder = null;\n    element.figure = null;\n    delete this.elements[`_${elementName}`];\n    delete this.elements[elementName];\n    const index = this.drawOrder.indexOf(elementName);\n    if (index !== -1) {\n      this.drawOrder.splice(index, 1);\n    }\n  }\n\n  stopAnimating(\n    how: 'freeze' | 'cancel' | 'complete' | 'animateToComplete' | 'dissolveToComplete' = 'cancel',\n    name: string | null = null,\n    includeChildren: boolean = true,\n  ) {\n    super.stopAnimating(how, name);\n    if (includeChildren) {\n      for (let i = 0; i < this.drawOrder.length; i += 1) {\n        const element = this.elements[this.drawOrder[i]];\n        element.stopAnimating(how, name, includeChildren);\n      }\n    }\n  }\n\n  align(\n    xAlign: 'left' | 'center' | 'right' | number,\n    yAlign: 'bottom' | 'middle' | 'top' | number,\n  ) {\n    const bounds = this.getBoundingRect('draw');\n    const offset = new Point(0, 0);\n    if (xAlign === 'left') {\n      offset.x = -bounds.left;\n    } else if (xAlign === 'center') {\n      offset.x = -bounds.left + bounds.width / 2;\n    } else if (xAlign === 'right') {\n      offset.x = -bounds.right;\n    } else {\n      offset.x = -bounds.left + bounds.width * xAlign;\n    }\n    if (yAlign === 'bottom') {\n      offset.y = -bounds.bottom;\n    } else if (yAlign === 'middle') {\n      offset.y = -bounds.bottom + bounds.height / 2;\n    } else if (yAlign === 'top') {\n      offset.y = -bounds.top;\n    } else {\n      offset.y = -bounds.bottom + bounds.height * yAlign;\n    }\n    for (let i = 0; i < this.drawOrder.length; i += 1) {\n      const element = this.elements[this.drawOrder[i]];\n      const p = element.transform.t();\n      element.transform.updateTranslation(p.add(offset));\n    }\n  }\n}\n\nexport {\n  FigureElementPrimitive, FigureElementCollection,\n  FigureElement,\n};\n","// @flow\nimport {\n  Point, getPoint, getPositionInRect, Line,\n} from '../../../tools/g2';\n// import { Elements } from './Element';\nimport Bounds from './Bounds';\n// import BaseEquationFunction from './BaseEquationFunction';\n// import type { TypeParsablePoint } from '../../../../tools/g2';\n// import type {EQN_Annotation } from './Base'\n\n// import {\n//   FigureElementPrimitive, FigureElementCollection,\n// } from '../../../Element';\nimport { duplicateFromTo } from '../../../tools/tools';\n// import { Element, Elements } from './Element';\n\nimport type { ElementInterface } from './Element';\n// import Symbol from '../Symbols/Symbol';\nimport SymbolNew from '../Symbols/SymbolNew';\nimport { FunctionMap } from '../../../tools/FunctionMap';\n// eslint-disable-next-line import/no-cycle\n// import type { TypeEquationPhrase } from '../EquationFunctions';\n\nexport type EQN_Annotation = {\n  xPosition: 'left' | 'center' | 'right' | number,\n  yPosition: 'bottom' | 'baseline' | 'middle' | 'top' | number,\n  xAlign: 'left' | 'center' | 'right' | number,\n  yAlign: 'bottom' | 'baseline' | 'middle' | 'top' | number,\n  offset: Point,\n  scale: number,\n  content: ElementInterface,\n  inSize: boolean,\n  fullContentBounds: boolean,\n  reference?: string,\n};\n\nexport type EQN_EncompassGlyph = {\n  symbol?: string,\n  annotations?: Array<EQN_Annotation>,\n  space: number;\n  topSpace?: number;\n  leftSpace?: number;\n  bottomSpace?: number;\n  rightSpace?: number;\n};\n\nexport type EQN_LineGlyph = {\n  symbol?: string,\n  annotationIndex: number,\n  content: {\n    xAlign: 'left' | 'center' | 'right' | number | string,\n    yAlign: 'bottom' | 'baseline' | 'middle' | 'top' | number | string,\n    space: number,\n  };\n  annotation: {\n    xAlign: 'left' | 'center' | 'right' | number | string,\n    yAlign: 'bottom' | 'baseline' | 'middle' | 'top' | number | string,\n    space: number,\n  };\n};\n\nexport type EQN_LeftRightGlyph = {\n  symbol?: string,\n  annotations?: Array<EQN_Annotation>,\n  space: number;\n  overhang: number,\n  topSpace?: number;\n  bottomSpace?: number;\n  minContentHeight?: number,\n  minContentDescent?: number;\n  minContentAscent?: number,\n  descent?: number,\n  height?: number,\n  yOffset: number,\n  annotationsOverContent?: boolean,\n};\n\nexport type EQN_TopBottomGlyph = {\n  symbol?: string,\n  annotations?: Array<EQN_Annotation>,\n  space: number;\n  overhang: number,\n  width?: number,\n  leftSpace?: number,\n  rightSpace?: number,\n  xOffset: number,\n  annotationsOverContent?: boolean,\n};\n\nexport type TypeAnnotatedGlyph = {\n  glyph: SymbolNew,\n  annotations: Array<EQN_Annotation>,\n  width: number,\n  height: number,\n  location: Point,\n};\n\n// export type EQN_EncompassGlyph = {\n//   space: number,\n//   leftSpace: number,\n//   bottomSpace: number,\n//   topSpace: number,\n//   rightSpace: number,\n// } & TypeAnnotatedGlyph;\n\nexport type EQN_Glyphs = {\n  left?: TypeAnnotatedGlyph & EQN_LeftRightGlyph;\n  right?: TypeAnnotatedGlyph & EQN_LeftRightGlyph;\n  top?: TypeAnnotatedGlyph & EQN_TopBottomGlyph;\n  bottom?: TypeAnnotatedGlyph & EQN_TopBottomGlyph;\n  encompass?: TypeAnnotatedGlyph & EQN_EncompassGlyph;\n  line?: TypeAnnotatedGlyph & EQN_LineGlyph;\n};\n\n// export type EQN_GlyphsIn = {\n//   left?: TypeAnnotatedGlyph;\n//   right?: TypeAnnotatedGlyph;\n//   top?: TypeAnnotatedGlyph;\n//   bottom?: TypeAnnotatedGlyph;\n//   encompass?: EQN_EncompassGlyphIn;\n// };\n\nfunction copyAnnotation(annotation: EQN_Annotation, namedCollection?: Object) {\n  return {\n    xPosition: annotation.xPosition,\n    yPosition: annotation.yPosition,\n    xAlign: annotation.xAlign,\n    yAlign: annotation.yAlign,\n    offset: annotation.offset._dup(),\n    scale: annotation.scale,\n    content: annotation.content._dup(namedCollection),\n    inSize: annotation.inSize,\n    fullContentBounds: annotation.fullContentBounds,\n  };\n}\n\nfunction copyAnnotations(\n  annotations: Array<EQN_Annotation>,\n  namedCollection?: Object,\n) {\n  const copy = [];\n  annotations.forEach((annotation) => {\n    copy.push(copyAnnotation(annotation, namedCollection));\n  });\n  return copy;\n}\n\nfunction copyGlyphs(\n  glyphs: EQN_Glyphs,\n  namedCollection?: Object,\n) {\n  const copy = {};\n  Object.keys(glyphs).forEach((key) => {\n    if (glyphs[key] == null) {\n      return;\n    }\n    const glyph = glyphs[key];\n    const copyGlyph = {};\n    duplicateFromTo(glyph, copyGlyph, ['glyph', 'annotations']);\n    if (namedCollection != null) {\n      copyGlyph.glyph = namedCollection[glyph.glyph.name];\n    } else {\n      copyGlyph.glyph = glyph.glyph;\n    }\n    copyGlyph.annotations = copyAnnotations(glyph.annotations, namedCollection);\n    copy[key] = copyGlyph;\n  });\n  return copy;\n}\n\nfunction getAllElementsFromAnnotations(annotations: Array<EQN_Annotation>) {\n  let elements = [];\n  annotations.forEach((annotation) => {\n    elements = [...elements, ...annotation.content.getAllElements()];\n  });\n  return elements;\n}\n\nfunction getAllElementsFromGlyphs(glyphs: EQN_Glyphs) {\n  let elements = [];\n  Object.keys(glyphs).forEach((key) => {\n    const glyph = glyphs[key];\n    if (glyph == null) {\n      return;\n    }\n    elements = [\n      ...elements,\n      glyph.glyph,\n      ...getAllElementsFromAnnotations(glyph.annotations),\n    ];\n  });\n  return elements;\n}\n\nfunction setPositionsForAnnotations(annotations: Array<EQN_Annotation>) {\n  annotations.forEach((annotation) => {\n    annotation.content.setPositions();\n  });\n}\n\nfunction offsetLocationForAnnotations(annotations: Array<EQN_Annotation>, offset: Point) {\n  annotations.forEach((annotation) => {\n    annotation.content.offsetLocation(offset);\n  });\n}\n\nfunction setPositionsForGlyphs(glyphs: EQN_Glyphs) {\n  Object.keys(glyphs).forEach((key) => {\n    if (glyphs[key] == null) {\n      return;\n    }\n    const glyph = glyphs[key];\n    const t = glyph.glyph.transform._dup();\n    t.updateScale(glyph.width, glyph.height);\n    t.updateTranslation(glyph.location.x, glyph.location.y);\n    glyph.glyph.setTransform(t);\n    setPositionsForAnnotations(glyph.annotations);\n  });\n}\n\nfunction offsetLocationForGlyphs(glyphs: EQN_Glyphs, offset: Point) {\n  Object.keys(glyphs).forEach((key) => {\n    if (glyphs[key] == null) {\n      return;\n    }\n    const glyph = glyphs[key];\n    glyph.location = glyph.location.add(offset);\n    offsetLocationForAnnotations(glyph.annotations, offset);\n  });\n}\n\nexport default class BaseAnnotationFunction implements ElementInterface {\n  ascent: number;\n  descent: number;\n  width: number;\n  location: Point;\n  height: number;\n  scale: number;\n  fullSize: {\n    leftOffset: number,\n    width: number,\n    descent: number,\n    ascent: number,\n    height: number,\n  };\n\n  fnMap: FunctionMap;\n\n  content: ElementInterface;\n  annotations: Array<EQN_Annotation>;\n  glyphs: EQN_Glyphs;\n  options: Object;\n\n  constructor(\n    content: ElementInterface,\n    annotations: Array<EQN_Annotation>,\n    glyphs: EQN_Glyphs,\n    options: Object,\n  ) {\n    this.glyphs = glyphs;\n    this.content = content;\n    this.annotations = annotations;\n    this.options = options;\n    this.fnMap = new FunctionMap();\n  }\n\n  _dup(namedCollection?: Object) {\n    const contentCopy = this.content._dup(namedCollection);\n    const glyphsCopy = copyGlyphs(this.glyphs);\n    const annotationsCopy = copyAnnotations(this.annotations);\n    const copy = new this.constructor(  // $FlowFixMe\n      contentCopy, annotationsCopy, glyphsCopy, this.options,\n    );\n    duplicateFromTo(\n      this, copy,\n      ['content', 'glyphs', 'annotations'],\n    );\n    return copy;\n  }\n\n  getAllElements() {\n    return [\n      ...this.content.getAllElements(),\n      ...getAllElementsFromAnnotations(this.annotations),\n      ...getAllElementsFromGlyphs(this.glyphs),\n    ];\n  }\n\n  setPositions() {\n    this.content.setPositions();\n    setPositionsForAnnotations(this.annotations);\n    setPositionsForGlyphs(this.glyphs);\n  }\n\n  offsetLocation(offset: Point = new Point(0, 0)) {\n    this.location = this.location.add(offset);\n    this.content.offsetLocation(offset);\n    offsetLocationForAnnotations(this.annotations, offset);\n    offsetLocationForGlyphs(this.glyphs, offset);\n  }\n\n\n  //                               Top Glyph\n  //                  GGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGG\n  //                  GGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGG     Encompassing Glyph\n  //                                                      /\n  //                                                    /\n  //        GGG       GGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGG        GGG\n  //        GGG       GGG                           GGG        GGG\n  //        GGG       GGG     CCCCCCCCCCCCCCCCC     GGG        GGG\n  //        GGG       GGG     CCCCCCCCCCCCCCCCC     GGG        GGG\n  // Left   GGG       GGG     CCCCCCCCCCCCCCCCC     GGG        GGG   Right\n  // Glyph  GGG       GGG     CCCCCCCCCCCCCCCCC     GGG        GGG   Glyph\n  //        GGG       GGG     CCCCCCCCCCCCCCCCC     GGG        GGG\n  //        GGG       GGG     CCCCCCCCCCCCCCCCC     GGG        GGG\n  //        GGG       GGG     CCCCCCCCCCCCCCCCC     GGG        GGG\n  //        GGG       GGG                           GGG        GGG\n  //        GGG       GGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGG        GGG\n  //\n  //\n  //                  GGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGG\n  //                  GGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGG\n  //                            Bottom Glyph\n  //\n  //\n  //\n  //\n  // |                          GGGGGGGGGGGGGGGGGGGGGGGG\n  // |                          GGGGGGGGGGGGGGGGGGGGGGGG\n  // |                          GGG                  GGG\n  // |                          GGG                  GGG\n  // |        GGG               GGG   CCCCCCCCCCCC   GGG               GGG\n  // |        GGG               GGG   CCCCCCCCCCCC   GGG               GGG\n  // |        GGG               GGG   CCCCCCCCCCCC   GGG               GGG\n  // |  AAA   GGG   AAA   AAA   GGG   CCCCCCCCCCCC   GGG   AAA   AAA   GGG   AAA\n  // |  AAA   GGG   AAA   AAA   GGG   CCCCCCCCCCCC   GGG   AAA   AAA   GGG   AAA\n  // |  AAA   GGG   AAA   AAA   GGG   CCCCCCCCCCCC   GGG   AAA   AAA   GGG   AAA\n  // |  AAA   GGG   AAA   AAA   GGG   CCCCCCCCCCCC   GGG   AAA   AAA   GGG   AAA\n  // |  AAA   GGG   AAA   AAA   GGG   CCCCCCCCCCCC   GGG   AAA   AAA   GGG   AAA\n  // | |   |  GGG  |   | |   |  GGG   CCCCCCCCCCCC   GGG               GGG\n  // | |   |  GGG  |   | |   |  GGG   CCCCCCCCCCCC   GGG               GGG\n  // | |   |  GGG  |   | |   |  GGG   CCCCCCCCCCCC   GGG               GGG\n  // | |   |  |  | |   | |   |  GGG   |              GGG\n  // | |   |  |  | |   | |   |  GGG   |              GGG\n  // | |   |  |  | |   | |   |  GGGGGGGGGGGGGGGGGGGGGGGG\n  // | |   |  |  | |   | |   |  GGGGGGGGGGGGGGGGGGGGGGGG\n  // | |   |  |  | |   | |   |  |  |  |\n  // | |   |  |  | |   | |   |  |  |--|<----  contentEncompassGlyph Space\n  // | |   |  |  | |   | |   |  |\n  // | |   |  |  | |   | |   |--|<----- EncompassGlyphAnnotation Space\n  // | |   |  |  | |   | |\n  // | |   |  |  | |   |-|<----- ContentAnnotationGlyphInsideAnnotation Space\n  // | |   |  |  | |\n  // | |   |  |  |-|<------- GlyphInsideAnnotationGlyph Space\n  // | |   |  |\n  // | |  >|--|<------ GlypgGlyphOutsideAnnotation Space\n  // | |\n  // |-|<------ Outside Space\n\n\n  calcSize(location: Point, scale: number) {\n    this.location = location._dup();\n    const loc = location._dup();\n    // const [encompassGlyph, leftGlyph, bottomGlyph, rightGlyph, topGlyph] = this.glyphs;\n    const { content, annotations } = this;\n    const {\n      inSize, space, topSpace, bottomSpace, leftSpace, rightSpace,\n      contentScale, useFullBounds, fullContentBounds,\n    } = this.options;\n    const inSizeBounds = new Bounds();\n    const fullBounds = new Bounds();\n\n    const contentBounds = new Bounds();\n    content.calcSize(loc._dup(), scale * contentScale);\n    contentBounds.copyFrom(content.getBounds(fullContentBounds));\n    inSizeBounds.copyFrom(contentBounds);\n    fullBounds.copyFrom(contentBounds);\n\n    annotations.forEach((annotation, index) => {\n      annotation.content.calcSize(loc, scale * annotation.scale);\n      this.setAnnotationPosition(contentBounds, annotation, scale);\n      const annotationBounds = annotation.content.getBounds();\n      inSizeBounds.growWithSameBaseline(annotationBounds);\n      const fullSizeAnnotationBounds = annotation.content.getBounds(true);\n      fullBounds.growWithSameBaseline(fullSizeAnnotationBounds);\n      if (\n        this.glyphs.line != null\n        && this.glyphs.line.annotationIndex === index\n      ) {\n        this.setLineGlyph(annotationBounds, contentBounds);\n        // inSizeBounds.growWithSameBaseline(encompassBounds);\n        // fullBounds.growWithSameBaseline(encompassFullBounds);\n      }\n    });\n    const [encompassBounds, encompassFullBounds] = this.setEncompassGlyph(scale, contentBounds);\n    inSizeBounds.growWithSameBaseline(encompassBounds);\n    fullBounds.growWithSameBaseline(encompassFullBounds);\n\n    const [leftBounds, leftFullBounds] = this.setVerticalGlyph(scale, contentBounds, 'left');\n    inSizeBounds.growWithSameBaseline(leftBounds);\n    fullBounds.growWithSameBaseline(leftFullBounds);\n    const [rightBounds, rightFullBounds] = this.setVerticalGlyph(scale, contentBounds, 'right');\n    inSizeBounds.growWithSameBaseline(rightBounds);\n    fullBounds.growWithSameBaseline(rightFullBounds);\n\n    const [topBounds, topFullBounds] = this.setHorizontalGlyph(scale, contentBounds, 'top');\n    inSizeBounds.growWithSameBaseline(topBounds);\n    fullBounds.growWithSameBaseline(topFullBounds);\n\n    const [bottomBounds, bottomFullBounds] = this.setHorizontalGlyph(scale, contentBounds, 'bottom');\n    inSizeBounds.growWithSameBaseline(bottomBounds);\n    fullBounds.growWithSameBaseline(bottomFullBounds);\n\n    let xLocationOffset = 0;\n\n    const topSpaceToUse = (topSpace != null ? topSpace : (space || 0)) * scale;\n    const bottomSpaceToUse = (bottomSpace != null ? bottomSpace : (space || 0)) * scale;\n    const leftSpaceToUse = (leftSpace != null ? leftSpace : (space || 0)) * scale;\n    const rightSpaceToUse = (rightSpace != null ? rightSpace : (space || 0)) * scale;\n    inSizeBounds.offset(topSpaceToUse, rightSpaceToUse, -bottomSpaceToUse, -leftSpaceToUse);\n    fullBounds.growWithSameBaseline(inSizeBounds);\n\n    if (useFullBounds) {\n      inSizeBounds.copyFrom(fullBounds);\n    }\n\n    if (inSize) {\n      this.width = inSizeBounds.width;\n      this.ascent = inSizeBounds.ascent;\n      this.descent = inSizeBounds.descent;\n      this.height = inSizeBounds.height;\n      xLocationOffset = loc.x - inSizeBounds.left;\n    } else {\n      this.width = contentBounds.width;\n      this.ascent = contentBounds.ascent;\n      this.descent = contentBounds.descent;\n      this.height = contentBounds.height;\n    }\n    this.fullSize = {\n      leftOffset: this.location.x - fullBounds.left,\n      width: fullBounds.width,\n      ascent: fullBounds.ascent,\n      descent: fullBounds.descent,\n      height: fullBounds.height,\n    };\n    if (xLocationOffset !== 0 && content != null) {\n      const locationOffset = new Point(xLocationOffset, 0);\n      content.offsetLocation(locationOffset);\n      annotations.forEach((annotation) => {\n        annotation.content.offsetLocation(locationOffset);\n      });\n      Object.keys(this.glyphs).forEach((key) => {\n        const glyph = this.glyphs[key];\n        if (glyph == null) {\n          return;\n        }\n        glyph.location = glyph.location.add(locationOffset);\n        glyph.glyph.custom.setSize(glyph.location, glyph.width, glyph.height);\n        glyph.annotations.forEach((annotation) => {\n          annotation.content.offsetLocation(locationOffset);\n        });\n      });\n    }\n  }\n\n  setEncompassGlyph(scale: number, contentBoundsIn: Bounds) {\n    if (this.glyphs.encompass == null) {\n      const fullBounds = new Bounds();\n      fullBounds.copyFrom(contentBoundsIn);\n      return [contentBoundsIn, fullBounds];\n    }\n    const {\n      leftSpace, rightSpace, bottomSpace, topSpace, space,\n    } = this.glyphs.encompass;\n    const glyph = this.glyphs.encompass;\n    const spaceToUse = space != null ? space : 0;\n    const left = leftSpace != null ? leftSpace : spaceToUse;\n    const right = rightSpace != null ? rightSpace : spaceToUse;\n    const top = topSpace != null ? topSpace : spaceToUse;\n    const bottom = bottomSpace != null ? bottomSpace : spaceToUse;\n    const contentBounds = new Bounds();\n    contentBounds.copyFrom(contentBoundsIn);\n    contentBounds.offset(top * scale, right * scale, -bottom * scale, -left * scale);\n    const glyphBounds = glyph.glyph.getBounds(\n      glyph.glyph.custom.options,\n      contentBounds.left,\n      contentBounds.bottom,\n      contentBounds.width,\n      contentBounds.height,\n    );\n    const inSizeBounds = new Bounds();\n    const fullBounds = new Bounds();\n    inSizeBounds.copyFrom(contentBounds);\n    inSizeBounds.growWithSameBaseline(glyphBounds);\n    fullBounds.copyFrom(inSizeBounds);\n    glyph.width = glyphBounds.width;\n    glyph.height = glyphBounds.height;\n    glyph.location = new Point(glyphBounds.left, glyphBounds.bottom);\n    glyph.glyph.custom.setSize(glyph.location, glyph.width, glyph.height);\n    glyph.annotations.forEach((annotation) => {\n      annotation.content.calcSize(glyph.location, scale * annotation.scale);\n      this.setAnnotationPosition(glyphBounds, annotation, scale);\n      const annotationBounds = annotation.content.getBounds();\n      inSizeBounds.growWithSameBaseline(annotationBounds);\n      const fullAnnotationBounds = annotation.content.getBounds(true);\n      fullBounds.growWithSameBaseline(fullAnnotationBounds);\n    });\n    return [inSizeBounds, fullBounds];\n  }\n\n  setLineGlyph(annotationBounds: Bounds, contentBounds: Bounds) {\n    if (this.glyphs.line == null) {\n      return;\n    }\n    const { // $FlowFixMe\n      content, annotation,\n    } = this.glyphs.line;\n    const glyph = this.glyphs.line;\n    const pStart = getPositionInRect( // $FlowFixMe\n      contentBounds.toRect(), content.xAlign, content.yAlign,\n    );\n    const pEnd = getPositionInRect( // $FlowFixMe\n      annotationBounds.toRect(), annotation.xAlign, annotation.yAlign,\n    );\n\n    const line = new Line(pStart, pEnd);\n    const spacedLine = new Line(\n      line.pointAtLength(content.space),\n      line.pointAtLength(line.length() - annotation.space),\n    );\n    // console.log(spacedLine)\n\n    glyph.width = spacedLine.angle();\n    glyph.height = spacedLine.length();\n    glyph.location = spacedLine.p1._dup();\n    glyph.glyph.custom.setSize(glyph.location, glyph.width, glyph.height);\n\n    // glyph.glyph.custom.options.spacedLine = spacedLine._dup();\n    // glyph.location = new Point(0, 0);\n    // const sp1 = spacedLine.p1._dup();\n    // const sp2 = spacedLine.p2._dup();\n    // const glyphBounds = new Bounds({\n    //   left: Math.min(sp1.x, sp2.x),\n    //   bottom: Math.min(sp1.y, sp2.y),\n    //   width: Math.abs(sp1.x - sp2.x),\n    //   height: Math.abs(sp1.y - sp2.y),\n    // });\n    // glyph.width = glyphBounds.width;\n    // glyph.height = glyphBounds.height;\n    // glyph.glyph.custom.setSize(glyph.location, glyph.width, glyph.height);\n  }\n\n  setVerticalGlyph(scale: number, contentBounds: Bounds, glyphName: 'left' | 'right') {\n    if (this.glyphs[glyphName] == null) {\n      const fullBounds = new Bounds();\n      fullBounds.copyFrom(contentBounds);\n      return [contentBounds, fullBounds];\n    }\n    const {\n      space, overhang, topSpace, bottomSpace, minContentHeight,\n      minContentDescent, minContentAscent,\n      descent, height, yOffset,\n      annotationsOverContent,\n    } = this.glyphs[glyphName];\n\n    const glyph = this.glyphs[glyphName];\n    // const contentBounds = new Bounds();\n    // contentBounds.copyFrom(contentBounds);\n    let glyphHeight = contentBounds.height;\n    let contentX = contentBounds.left;\n    let glyphBottom = contentBounds.bottom;\n    // let glyphTop = contentBounds.top;\n    let glyphDescent = contentBounds.descent;\n    let glyphAscent = contentBounds.ascent;\n\n    if (minContentDescent != null) {\n      glyphDescent = Math.max(minContentDescent, glyphDescent);\n      glyphHeight = contentBounds.ascent + glyphDescent;\n    }\n    if (minContentAscent != null) {\n      glyphAscent = Math.max(minContentAscent, glyphAscent);\n      glyphHeight = glyphAscent + glyphDescent;\n    }\n    if (minContentHeight != null) {\n      glyphAscent = -glyphDescent\n                             + Math.max(minContentHeight, glyphHeight);\n    }\n    const topSpaceToUse = topSpace != null ? topSpace : overhang;\n    const bottomSpaceToUse = bottomSpace != null ? bottomSpace : overhang;\n    glyphDescent += scale * bottomSpaceToUse;\n    if (descent != null) {\n      glyphDescent = descent;\n    }\n    glyphAscent += scale * topSpaceToUse;\n    glyphHeight = glyphDescent + glyphAscent;\n    if (height != null) {\n      glyphHeight = height;\n      glyphAscent = glyphHeight - glyphDescent;\n    }\n\n    glyphBottom = contentBounds.bottom\n                           - (glyphDescent - contentBounds.descent);\n\n    // glyphTop = contentBoundsIn.top + (glyphAscent - contentBoundsIn.ascent);\n\n    // glyphLeft = contentBounds.left;\n    if (glyphName === 'left') {\n      contentX -= space * scale;\n    } else {\n      contentX = contentBounds.left + contentBounds.width + space * scale;\n    }\n\n    // let glyphBottom = contentBounds.bottom;\n    if (descent == null && bottomSpace == null && height != null) {\n      glyphBottom = contentBounds.bottom + contentBounds.height / 2 - height / 2;\n    }\n\n    const glyphBounds = glyph.glyph.getBounds(\n      glyph.glyph.custom.options,\n      contentX,\n      glyphBottom + yOffset,  // $FlowFixMe\n      null,\n      glyphHeight,\n      glyphName,\n    );\n\n    // const totalBounds = new Bounds();\n    const inSizeBounds = new Bounds();\n    const fullBounds = new Bounds();\n    inSizeBounds.copyFrom(contentBounds);\n    inSizeBounds.growWithSameBaseline(glyphBounds);\n    fullBounds.copyFrom(inSizeBounds);\n    const glyphAndAnnotationBounds = new Bounds();\n    glyphAndAnnotationBounds.copyFrom(glyphBounds);\n    glyph.width = glyphBounds.width;\n    glyph.height = glyphBounds.height;\n    glyph.location = new Point(glyphBounds.left, glyphBounds.bottom);\n    glyph.glyph.custom.setSize(glyph.location, glyph.width, glyph.height);\n    glyph.annotations.forEach((annotation) => {\n      annotation.content.calcSize(glyph.location, scale * annotation.scale);\n      this.setAnnotationPosition(glyphBounds, annotation, scale);\n      const annotationBounds = annotation.content.getBounds();\n      inSizeBounds.growWithSameBaseline(annotationBounds);\n      glyphAndAnnotationBounds.growWithSameBaseline(annotationBounds);\n      const fullAnnotationBounds = annotation.content.getBounds(true);\n      fullBounds.growWithSameBaseline(fullAnnotationBounds);\n    });\n\n    let xOffset = 0;\n    if (glyphName === 'left'\n      && glyphAndAnnotationBounds.right > contentX\n      && annotationsOverContent === false\n    ) {\n      xOffset = contentX - glyphAndAnnotationBounds.right;\n    }\n    if (glyphName === 'right'\n      && glyphAndAnnotationBounds.left < contentX\n      && annotationsOverContent === false\n    ) {\n      xOffset = contentX - glyphAndAnnotationBounds.left;\n    }\n    if (xOffset !== 0) {\n      const locationOffset = new Point(xOffset, 0);\n      glyph.location = glyph.location.add(locationOffset);\n      glyph.glyph.custom.setSize(glyph.location, glyph.width, glyph.height);\n      glyph.annotations.forEach((annotation) => {\n        annotation.content.offsetLocation(locationOffset);\n      });\n      inSizeBounds.left += xOffset;\n      inSizeBounds.right = Math.max(inSizeBounds.right + xOffset, contentBounds.right);\n      fullBounds.left += xOffset;\n      fullBounds.right = Math.max(inSizeBounds.right + xOffset, contentBounds.right);\n    }\n    // console.log(inSizeBounds.left, inSizeBounds.width)\n    return [inSizeBounds, fullBounds];\n  }\n\n  setHorizontalGlyph(scale: number, contentBoundsIn: Bounds, glyphName: 'top' | 'bottom') {\n    if (this.glyphs[glyphName] == null) {\n      const fullBounds = new Bounds();\n      fullBounds.copyFrom(contentBoundsIn);\n      return [contentBoundsIn, fullBounds];\n    }\n    const {\n      space, overhang, width, leftSpace, rightSpace, xOffset,\n      annotationsOverContent,\n    } = this.glyphs[glyphName];\n\n    const glyph = this.glyphs[glyphName];\n    const contentBounds = new Bounds();\n    contentBounds.copyFrom(contentBoundsIn);\n    let glyphLength = contentBounds.width;\n    let contentX = contentBounds.left;\n    if (overhang != null) {\n      glyphLength += 2 * overhang * scale;\n      contentX = contentBounds.left - overhang * scale;\n    }\n    if (width != null) {\n      glyphLength = width * scale;\n    }\n\n    if (leftSpace != null || rightSpace != null) {\n      glyphLength = (leftSpace || 0) * scale + contentBounds.width + (rightSpace || 0) * scale;\n      if (leftSpace != null) {\n        contentX = contentBounds.left - leftSpace * scale;\n      }\n    }\n\n    if (leftSpace == null && rightSpace == null && width != null) {\n      contentX = contentBounds.left + (contentBounds.width - width) / 2;\n    } else if (leftSpace == null && rightSpace != null && width != null) {\n      contentX = contentBounds.right + rightSpace * scale - width;\n    }\n    let contentY;\n    if (glyphName === 'top') {\n      contentY = contentBounds.top + space * scale;\n    } else {\n      contentY = contentBounds.bottom - space * scale;\n    }\n\n    const glyphBounds = glyph.glyph.getBounds(\n      glyph.glyph.custom.options,\n      contentX + xOffset,\n      contentY,\n      glyphLength,  // $FlowFixMe\n      null,\n      glyphName,\n    );\n\n    const inSizeBounds = new Bounds();\n    const fullBounds = new Bounds();\n    inSizeBounds.copyFrom(contentBounds);\n    inSizeBounds.growWithSameBaseline(glyphBounds);\n    fullBounds.copyFrom(inSizeBounds);\n\n    const glyphAndAnnotationBounds = new Bounds();\n    glyphAndAnnotationBounds.copyFrom(glyphBounds);\n    glyph.width = glyphBounds.width;\n\n    glyph.height = glyphBounds.height;\n    glyph.location = new Point(glyphBounds.left, glyphBounds.bottom);\n    glyph.glyph.custom.setSize(glyph.location, glyph.width, glyph.height);\n    glyph.annotations.forEach((annotation) => {\n      annotation.content.calcSize(glyph.location, scale * annotation.scale);\n      this.setAnnotationPosition(glyphBounds, annotation, scale);\n      const annotationBounds = annotation.content.getBounds();\n      inSizeBounds.growWithSameBaseline(annotationBounds);\n      glyphAndAnnotationBounds.growWithSameBaseline(annotationBounds);\n      const fullAnnotationBounds = annotation.content.getBounds(true);\n      fullBounds.growWithSameBaseline(fullAnnotationBounds);\n    });\n\n    let yOffset = 0;\n    if (glyphName === 'top'\n      && glyphAndAnnotationBounds.bottom < contentY\n      && annotationsOverContent === false\n    ) {\n      yOffset = contentY - glyphAndAnnotationBounds.bottom;\n    }\n    if (glyphName === 'bottom'\n      && glyphAndAnnotationBounds.top > contentY\n      && annotationsOverContent === false\n    ) {\n      yOffset = contentY - glyphAndAnnotationBounds.top;\n    }\n\n    if (yOffset !== 0) {\n      const locationOffset = new Point(0, yOffset);\n      glyph.location = glyph.location.add(locationOffset);\n      glyph.glyph.custom.setSize(glyph.location, glyph.width, glyph.height);\n      glyph.annotations.forEach((annotation) => {\n        annotation.content.offsetLocation(locationOffset);\n      });\n      inSizeBounds.top += yOffset;\n      inSizeBounds.bottom += yOffset;\n      fullBounds.top += yOffset;\n      fullBounds.bottom += yOffset;\n    }\n    return [inSizeBounds, fullBounds];\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  setAnnotationPosition(\n    contentToAnnotateBounds: Bounds,\n    annotation: EQN_Annotation,\n    scale: number,\n  ) {\n    let {\n      xPosition, yPosition, xAlign, yAlign, offset,\n    } = annotation;\n    offset = getPoint(offset);\n    const { content, fullContentBounds } = annotation;\n    const locationContentToAnnotate = new Point(\n      contentToAnnotateBounds.left,\n      contentToAnnotateBounds.bottom + contentToAnnotateBounds.descent,\n    );\n    let xPos;\n    let yPos;\n    // $FlowFixMe\n    if (contentToAnnotateBounds.annotations != null\n      && annotation.reference != null) {\n      // $FlowFixMe\n      const reference = contentToAnnotateBounds.annotations[annotation.reference];\n      if (reference.xPosition != null) {\n        ({ xPosition } = reference);\n      }\n      if (reference.yPosition != null) {\n        ({ yPosition } = reference);\n      }\n      if (reference.xAlign != null) {\n        ({ xAlign } = reference);\n      }\n      if (reference.yAlign != null) {\n        ({ yAlign } = reference);\n      }\n      if (reference.offset != null) {\n        offset = offset.add(getPoint(reference.offset));\n      }\n    }\n    if (xPosition === 'right') {\n      xPos = 1;\n    } else if (xPosition === 'center') {\n      xPos = 0.5;\n    } else if (typeof xPosition === 'number') {\n      xPos = xPosition;\n    } else {  // left\n      xPos = 0;\n    }\n    xPos = xPos * contentToAnnotateBounds.width + locationContentToAnnotate.x;\n\n    if (yPosition === 'bottom') {\n      yPos = 0;\n    } else if (yPosition === 'middle') {\n      yPos = 0.5;\n    } else if (yPosition === 'top') {\n      yPos = 1;\n    } else if (typeof yPosition === 'number') {\n      yPos = yPosition;\n    } else if (typeof yPosition === 'string' && yPosition.slice(-1)[0] === 'a') {\n      const ascentPercentage = parseFloat(yPosition);\n      const ascentPercentHeight = contentToAnnotateBounds.ascent / contentToAnnotateBounds.height;\n      const descentPercentHeight = contentToAnnotateBounds.descent / contentToAnnotateBounds.height;\n      yPos = ascentPercentHeight * ascentPercentage + descentPercentHeight;\n    } else {    // baseline\n      yPos = contentToAnnotateBounds.descent / contentToAnnotateBounds.height;\n    }\n    yPos = yPos * contentToAnnotateBounds.height\n           + locationContentToAnnotate.y - contentToAnnotateBounds.descent;\n\n    const contentBounds = content.getBounds(fullContentBounds);\n    if (xAlign === 'center') {\n      xPos -= contentBounds.width * 0.5;\n    } else if (xAlign === 'right') {\n      xPos -= contentBounds.width;\n    } else if (typeof xAlign === 'number') {\n      xPos -= contentBounds.width * xAlign;\n    }\n    if (yAlign === 'bottom') {\n      yPos += contentBounds.descent;\n    } else if (yAlign === 'middle') {\n      yPos = yPos + contentBounds.descent - contentBounds.height / 2;\n    } else if (yAlign === 'top') {\n      yPos -= contentBounds.ascent;\n    } else if (typeof yAlign === 'string' && yAlign.slice(-1)[0] === 'a') {\n      const ascentPercentage = parseFloat(yAlign);\n      yPos -= contentBounds.ascent * ascentPercentage;\n    } else if (typeof yAlign === 'number') {\n      yPos += contentBounds.descent - contentBounds.height * yAlign;\n    }\n\n    const offsetToUse = getPoint(offset);\n    xPos += offsetToUse.x * scale;\n    yPos += offsetToUse.y * scale;\n\n    const locationOffset = (new Point(xPos, yPos)).sub(\n      contentBounds.left,\n      contentBounds.bottom + contentBounds.descent,\n    );\n    content.offsetLocation(locationOffset);\n  }\n\n  getBounds(useFullSize: boolean = false) {\n    if (useFullSize && this.fullSize != null) {\n      return new Bounds({\n        left: this.location.x + this.fullSize.leftOffset,\n        right: this.location.x + this.fullSize.leftOffset + this.fullSize.width,\n        top: this.location.y + this.fullSize.ascent,\n        bottom: this.location.y - this.fullSize.descent,\n        width: this.fullSize.width,\n        height: this.fullSize.height,\n        ascent: this.fullSize.ascent,\n        descent: this.fullSize.descent,\n      });\n    }\n    return new Bounds({\n      left: this.location.x,\n      right: this.location.x + this.width,\n      top: this.location.y + this.ascent,\n      bottom: this.location.y - this.descent,\n      width: this.width,\n      height: this.height,\n      ascent: this.ascent,\n      descent: this.descent,\n    });\n  }\n}\n","\n// @flow\nimport {\n  Point,\n} from '../../../tools/g2';\n// import {\n//   FigureElementPrimitive, FigureElementCollection,\n// } from '../../../Element';\nimport { duplicateFromTo } from '../../../tools/tools';\nimport { Element, Elements } from './Element';\nimport Symbol from '../Symbols/SymbolNew';\n// import type { ElementInterface } from './Element';\n// import Bounds from './Bounds';\n\nexport default class BaseEquationFunction extends Elements {\n  contents: Array<Elements | null>;\n  glyphs: Array<?Symbol>;\n  glyphLocations: Array<Point>;\n  glyphWidths: Array<number>;\n  glyphHeights: Array<number>;\n  // inSize: boolean;\n  options: Object;\n\n  constructor(\n    content: Elements | null | Array<Elements | null>,\n    glyph: ?(Symbol\n      | Array<?Symbol>),\n    // inSize: boolean = true,\n    options: Object,\n  ) {\n    const glyphElements = [];\n    if (Array.isArray(glyph)) {\n      glyph.forEach((g) => {\n        glyphElements.push(g != null ? new Element(g) : null);\n      });\n    } else {\n      glyphElements.push(glyph != null ? new Element(glyph) : null);\n    }\n    let glyphs = [];\n    if (Array.isArray(glyph)) {\n      glyphs = glyph;\n    } else {\n      glyphs.push(glyph);\n    }\n\n    let contentArray: Array<Elements | null> = [];\n    if (Array.isArray(content)) {\n      contentArray = content;\n    } else {\n      contentArray.push(content);\n    }\n    super([...glyphElements, ...contentArray]);\n    this.glyphs = glyphs;\n    this.contents = contentArray;\n    this.glyphLocations = glyphElements.map(() => new Point(0, 0));\n    this.glyphWidths = glyphElements.map(() => 1);\n    this.glyphHeights = glyphElements.map(() => 1);\n    this.options = options;\n    // this.fullSize = null;\n  }\n\n  // getFullSize(useFullSize: boolean) {\n  //   if (useFullSize && this.full != null) {\n  //     return {\n  //       width: this.fullBounds.width,\n  //       height: this.fullBounds.height,\n  //       ascent: this.fullBounds.ascent,\n  //       descent: this.fullBounds.descent,\n  //     };\n  //   }\n  //   return {\n  //     width: this.width,\n  //     height: this.height,\n  //     ascent: this.ascent,\n  //     descent: this.descent,\n  //   };\n  // }\n\n  _dup(namedCollection?: Object) {\n    const copyContent = this.contents.map(\n      content => (content == null ? null : content._dup(namedCollection)),\n    );\n    let { glyphs } = this;\n    // let copyGlyphs = [];\n    if (namedCollection) {\n      const newGlyphs = [];\n      this.glyphs.forEach((g) => {\n        if (g != null) {        // $FlowFixMe\n          newGlyphs.push(namedCollection[g.name]);\n        } else {\n          newGlyphs.push(g);\n        }\n      });\n      glyphs = newGlyphs;\n    }\n    const copy = new this.constructor(\n      copyContent,\n      glyphs,\n      this.options,\n    );\n    duplicateFromTo(\n      this, copy,\n      ['content', 'contents', 'glyphs'],\n    );\n    return copy;\n  }\n\n  getAllElements() {\n    let elements = [];\n    this.contents.forEach((c) => {\n      if (c != null) {\n        elements = [...elements, ...c.getAllElements()];\n      }\n    });\n    this.glyphs.forEach((g) => {\n      if (g != null) {\n        elements = [...elements, g];\n      }\n    });\n    return elements;\n  }\n\n  setPositions() {\n    this.glyphs.forEach((glyph, index) => {\n      if (glyph != null) {\n        const t = glyph.getTransform()._dup();\n        t.updateTranslation(this.glyphLocations[index].x, this.glyphLocations[index].y);\n        t.updateScale(this.glyphWidths[index], this.glyphHeights[index]);\n        glyph.setTransform(t);\n      }\n    });\n    this.contents.forEach((content) => {\n      if (content != null) {\n        content.setPositions();\n      }\n    });\n  }\n\n  offsetLocation(offset: Point = new Point(0, 0)) {\n    this.location = this.location.add(offset);\n    this.glyphLocations.forEach((glyphLocation, index) => {\n      if (this.glyphs[index] != null) {\n        this.glyphLocations[index] = glyphLocation.add(offset);\n      }\n    });\n    this.contents.forEach((content) => {\n      if (content != null) {\n        content.offsetLocation(offset);\n      }\n    });\n  }\n\n  // eslint-disable-next-line class-methods-use-this, no-unused-vars\n  calcSize(location: Point, scale: number) {\n    // this.location = ;\n    // this.glyphLocations[] = ;\n    // this.glyphHeights[] = ;\n    // this.glyphWidths[] = ;\n    // this.width = ;\n    // this.ascent = ;\n    // this.descent = ;\n    // this.height = ;\n    // this.fullSize = {\n    //   leftOffset: ,\n    //   width: ,\n    //   ascent: ,\n    //   descent: ,\n    //   height: ,\n    // };\n  }\n}\n","// @flow\nimport { joinObjects } from '../../../tools/tools';\nimport {\n  Point, Rect,\n} from '../../../tools/g2';\n\ntype TypeBounds = {\n  width: number;\n  height: number;\n  ascent: number;\n  descent: number;\n  top: number;\n  bottom: number;\n  left: number;\n  right: number;\n  annotations?: {\n    [referenceName: string]: {\n      xPosition: 'left' | 'center' | 'right' | number,\n      yPosition: 'bottom' | 'baseline' | 'middle' | 'top' | number,\n      xAlign: 'left' | 'center' | 'right' | number,\n      yAlign: 'bottom' | 'baseline' | 'middle' | 'top' | number,\n      offset?: Point,\n    }\n  }\n};\nexport default class Bounds {\n  width: number;\n  height: number;\n  ascent: number;\n  descent: number;\n  top: number;\n  bottom: number;\n  left: number;\n  right: number;\n\n  constructor(boundsIn: {\n    width?: number;\n    height?: number;\n    ascent?: number;\n    descent?: number;\n    top?: number;\n    bottom?: number;\n    left?: number;\n    right?: number;\n  } = {}) {\n    const defaultBounds = {\n      width: 0,\n      height: 0,\n      ascent: 0,\n      descent: 0,\n      left: 0,\n      right: 0,\n      top: 0,\n      bottom: 0,\n    };\n    const bounds = joinObjects(defaultBounds, boundsIn);\n    this.copyFrom(bounds);\n  }\n\n  toRect() {\n    return new Rect(this.left, this.bottom, this.width, this.height);\n  }\n\n  copyFrom(from: Object) {\n    if (from.width != null) {\n      this.width = from.width;\n    }\n    if (from.height != null) {\n      this.height = from.height;\n    }\n    if (from.ascent != null) {\n      this.ascent = from.ascent;\n    }\n    if (from.descent != null) {\n      this.descent = from.descent;\n    }\n    if (from.left != null) {\n      this.left = from.left;\n    }\n    if (from.right != null) {\n      this.right = from.right;\n    }\n    if (from.top != null) {\n      this.top = from.top;\n    }\n    if (from.bottom != null) {\n      this.bottom = from.bottom;\n    }\n  }\n\n  leftOffset(leftDelta: number) {\n    this.left += leftDelta;\n    this.width = this.right - this.left;\n  }\n\n  rightOffset(rightDelta: number) {\n    this.right += rightDelta;\n    this.width = this.right - this.left;\n  }\n\n  topOffset(topDelta: number) {\n    this.top += topDelta;\n    this.ascent += topDelta;\n    this.height = this.ascent + this.descent;\n  }\n\n  bottomOffset(bottomDelta: number) {\n    this.bottom += bottomDelta;\n    this.descent -= bottomDelta;\n    this.height = this.ascent + this.descent;\n  }\n\n  offset(top: number, right: number, bottom: number, left: number) {\n    this.left += left;\n    this.right += right;\n    this.top += top;\n    this.ascent += top;\n    this.descent -= bottom;\n    this.bottom += bottom;\n    this.width = this.right - this.left;\n    this.height = this.ascent + this.descent;\n  }\n\n  growWithSameBaseline(newBounds: TypeBounds) {\n    const baseline = this.bottom + this.descent;\n    if (newBounds.left < this.left) {\n      this.left = newBounds.left;\n    }\n    if (newBounds.right > this.right) {\n      this.right = newBounds.right;\n    }\n    if (newBounds.top > this.top) {\n      this.top = newBounds.top;\n    }\n    if (newBounds.bottom < this.bottom) {\n      this.bottom = newBounds.bottom;\n    }\n    this.width = this.right - this.left;\n    this.height = this.top - this.bottom;\n    this.ascent = this.top - baseline;\n    this.descent = baseline - this.bottom;\n  }\n}\n","\n// @flow\nimport {\n  Point,\n} from '../../../tools/g2';\nimport Bounds from './Bounds';\nimport BaseEquationFunction from './BaseEquationFunction';\n\n\nexport default class Container extends BaseEquationFunction {\n  calcSize(location: Point, scale: number) {\n    this.location = location._dup();\n    const loc = location._dup();\n    const {\n      width, descent, ascent, xAlign, yAlign, fit, scaleModifier,\n      fullContentBounds,\n    } = this.options;\n    const [mainContent] = this.contents;\n    const contentBounds = new Bounds();\n    const containerBounds = new Bounds();\n    const fullBounds = new Bounds();\n    if (mainContent != null) {\n      mainContent.calcSize(loc._dup(), scale * scaleModifier);\n      contentBounds.copyFrom(mainContent.getBounds(fullContentBounds));\n      // contentBounds.copyFrom(mainContent);\n      containerBounds.copyFrom(contentBounds);\n    }\n\n    if (width != null) {\n      containerBounds.width = width;\n    }\n\n    if (descent != null) {\n      containerBounds.descent = descent;\n    }\n\n    if (ascent != null) {\n      containerBounds.ascent = ascent;\n    }\n\n    containerBounds.height = containerBounds.descent + containerBounds.ascent;\n\n    if (mainContent != null) {\n      if (fit === 'width') {\n        mainContent.calcSize(loc._dup(), containerBounds.width / contentBounds.width);\n      } else if (fit === 'height') {\n        mainContent.calcSize(loc._dup(), containerBounds.height / contentBounds.height);\n      } else if (fit === 'contain') {\n        const newScale = Math.min(\n          containerBounds.width / contentBounds.width,\n          containerBounds.height / contentBounds.height,\n        );\n        mainContent.calcSize(loc._dup(), newScale);\n      }\n      contentBounds.copyFrom(mainContent);\n    }\n\n    const contentLoc = loc._dup();\n    if (xAlign === 'center') {\n      contentLoc.x = loc.x + containerBounds.width / 2 - contentBounds.width / 2;\n    } else if (xAlign === 'right') {\n      contentLoc.x = loc.x + containerBounds.width - contentBounds.width;\n    } else if (typeof xAlign === 'number') {\n      contentLoc.x = loc.x + containerBounds.width * xAlign;\n    }\n\n    if (yAlign === 'bottom') {\n      contentLoc.y = loc.y - containerBounds.descent + contentBounds.descent;\n    } else if (yAlign === 'middle') {\n      contentLoc.y = loc.y - containerBounds.descent\n                     + containerBounds.height / 2 - contentBounds.height / 2\n                     + contentBounds.descent;\n    } else if (yAlign === 'top') {\n      contentLoc.y = loc.y + containerBounds.ascent\n                     - contentBounds.height + contentBounds.descent;\n    } else if (typeof yAlign === 'number') {\n      contentLoc.y = loc.y - containerBounds.descent\n                     + containerBounds.height * yAlign + contentBounds.descent;\n    }\n    if (mainContent != null) {\n      mainContent.offsetLocation(contentLoc.sub(mainContent.location));\n    }\n    if (mainContent != null) {\n      fullBounds.copyFrom(mainContent.getBounds(true));\n      fullBounds.growWithSameBaseline(containerBounds);\n    } else {\n      fullBounds.copyFrom(containerBounds);\n    }\n\n    this.width = containerBounds.width;\n    this.height = containerBounds.height;\n    this.descent = containerBounds.descent;\n    this.ascent = containerBounds.ascent;\n    this.fullSize = {\n      leftOffset: this.location.x - fullBounds.left,\n      width: fullBounds.width,\n      ascent: fullBounds.ascent,\n      descent: fullBounds.descent,\n      height: fullBounds.height,\n    };\n  }\n}\n","// @flow\nimport {\n  Point,\n} from '../../../tools/g2';\nimport { duplicateFromTo } from '../../../tools/tools';\nimport Bounds from './Bounds';\nimport {\n  FigureElementPrimitive, FigureElementCollection,\n} from '../../Element';\nimport { FunctionMap } from '../../../tools/FunctionMap';\n\nexport interface ElementInterface {\n  ascent: number;\n  descent: number;\n  width: number;\n  location: Point;\n  height: number;\n  fullSize: {\n    leftOffset: number,\n    width: number,\n    descent: number,\n    ascent: number,\n    height: number,\n  };\n  fnMap: FunctionMap,\n\n  calcSize(location: Point, scale: number): void;\n  _dup(namedCollection?: Object): ElementInterface;\n  getAllElements(): Array<ElementInterface | FigureElementPrimitive | FigureElementCollection>;\n  setPositions(): void;\n  offsetLocation(offset: Point): void;\n  getBounds(useFullSize?: boolean): Bounds;\n}\n\n// Equation is a class that takes a set of drawing objects (TextObjects,\n// FigureElementPrimitives or FigureElementCollections and HTML Objects\n// and arranges their size in a )\nclass BlankElement {\n  ascent: number;\n  descent: number;\n  width: number;\n  height: number;\n\n  constructor(width: number = 0.03, ascent: number = 0, descent: number = 0) {\n    this.width = width;\n    this.ascent = ascent;\n    this.descent = descent;\n    this.height = this.ascent + this.descent;\n  }\n\n  _dup() {\n    return new BlankElement(this.width, this.ascent, this.descent);\n  }\n}\n\nclass Element implements ElementInterface {\n  content: FigureElementPrimitive | FigureElementCollection | BlankElement;\n  ascent: number;\n  descent: number;\n  width: number;\n  location: Point;\n  height: number;\n  scale: number;\n  fnMap: FunctionMap;\n  fullSize: {\n    leftOffset: number,\n    width: number,\n    height: number,\n    ascent: number,\n    descent: number,\n  };\n\n  constructor(content: FigureElementPrimitive | FigureElementCollection | BlankElement) {\n    this.content = content;\n    this.ascent = 0;\n    this.descent = 0;\n    this.width = 0;\n    this.location = new Point(0, 0);\n    this.height = 0;\n    this.fullSize = {\n      leftOffset: 0,\n      width: this.width,\n      height: this.height,\n      ascent: this.ascent,\n      descent: this.descent,\n    };\n    this.fnMap = new FunctionMap();\n  }\n\n  // execFn(fn: string | Function | null, ...args: Array<any>) {\n  //   // if (fn == null) {\n  //   //   return null;\n  //   // }\n  //   // if (typeof fn === 'string') {\n  //   //   return this.fnMap.exec(fn, ...args);\n  //   // }\n  //   // return fn(...args);\n  //   return this.fnMap.exec(fn, ...args);\n  // }\n\n  calcSize(location: Point, scale: number) {\n    const { content } = this;\n    if (content instanceof BlankElement) {\n      this.width = content.width * scale;\n      this.height = content.height * scale;\n      this.ascent = content.ascent * scale;\n      this.descent = content.descent * scale;\n      this.location = location._dup();\n      this.scale = scale;\n    }\n    if (content instanceof FigureElementCollection\n        || content instanceof FigureElementPrimitive) {\n      // Update translation and scale\n      content.transform.updateTranslation(location.x, location.y);\n      content.transform.updateScale(scale, scale);\n      content.updateLastDrawTransform();\n      if (content.internalSetTransformCallback != null) {\n        this.fnMap.exec(content.internalSetTransformCallback, content.transform);\n      }\n\n      // Get the boundaries of element\n      // const r = content.getRelativeVertexSpaceBoundingRect();\n      const r = content.getRelativeBoundingRect('draw');\n      this.location = location._dup();\n      this.scale = scale;\n      this.ascent = r.top * scale;\n      this.descent = -r.bottom * scale;\n      this.height = r.height * scale;\n      this.width = r.width * scale;\n    }\n    this.fullSize = {\n      leftOffset: 0,\n      width: this.width,\n      height: this.height,\n      ascent: this.ascent,\n      descent: this.descent,\n    };\n  }\n\n  _dup(namedCollection?: Object) {\n    let c;\n    if (this.content instanceof BlankElement) {\n      c = new Element(this.content);\n    } else if (namedCollection) {\n      c = new Element(namedCollection[this.content.name]);\n    } else {\n      c = new Element(this.content);\n    }\n    c.ascent = this.ascent;\n    c.descent = this.descent;\n    c.width = this.width;\n    c.location = this.location._dup();\n    c.height = this.height;\n    c.scale = this.scale;\n    return c;\n  }\n\n  // getFullSize() {\n  //   return this.fullSize;\n  // }\n\n  getAllElements() {\n    if (this.content instanceof BlankElement) {\n      return [];\n    }\n    return [this.content];\n  }\n\n  setPositions() {\n    const { content } = this;\n    if (content instanceof FigureElementCollection\n        || content instanceof FigureElementPrimitive) {\n      content.transform.updateTranslation(this.location.x, this.location.y);\n      content.transform.updateScale(this.scale, this.scale);\n      content.updateLastDrawTransform();\n    }\n  }\n\n  offsetLocation(offset: Point = new Point(0, 0)) {\n    this.location = this.location.add(offset);\n  }\n\n  // getFullBounds() {\n  //   return new Bounds({\n  //     left: this.location.x + this.fullSize.leftOffset,\n  //     right: this.location.x + this.fullSize.leftOffset + this.fullSize.width,\n  //     top: this.location.y + this.fullSize.ascent,\n  //     bottom: this.location.y - this.fullSize.descent,\n  //     width: this.fullSize.width,\n  //     height: this.fullSize.height,\n  //     ascent: this.fullSize.ascent,\n  //     descent: this.fullSize.descent,\n  //   });\n  // }\n\n  getBounds(useFullSize: boolean = false) {\n    if (useFullSize && this.fullSize != null) {\n      return new Bounds({\n        left: this.location.x + this.fullSize.leftOffset,\n        right: this.location.x + this.fullSize.leftOffset + this.fullSize.width,\n        top: this.location.y + this.fullSize.ascent,\n        bottom: this.location.y - this.fullSize.descent,\n        width: this.fullSize.width,\n        height: this.fullSize.height,\n        ascent: this.fullSize.ascent,\n        descent: this.fullSize.descent,\n      });\n    }\n    return new Bounds({\n      left: this.location.x,\n      right: this.location.x + this.width,\n      top: this.location.y + this.ascent,\n      bottom: this.location.y - this.descent,\n      width: this.width,\n      height: this.height,\n      ascent: this.ascent,\n      descent: this.descent,\n    });\n  }\n}\n\nclass Elements implements ElementInterface {\n  content: Array<ElementInterface>;\n  ascent: number;\n  descent: number;\n  width: number;\n  location: Point;\n  height: number;\n  fnMap: FunctionMap;\n  fullSize: {\n    leftOffset: number,\n    width: number,\n    height: number,\n    ascent: number,\n    descent: number,\n  };\n\n  constructor(content: Array<ElementInterface | null>) {\n    const nonNullContent: Array<ElementInterface> = [];\n    content.forEach((c) => {\n      if (c !== null) {\n        nonNullContent.push(c);\n      }\n    });\n    this.content = nonNullContent;\n    this.ascent = 0;\n    this.descent = 0;\n    this.width = 0;\n    this.location = new Point(0, 0);\n    this.height = 0;\n    this.fnMap = new FunctionMap();\n  }\n\n  // execFn(fn: string | Function | null, ...args: Array<any>) {\n  //   // if (fn == null) {\n  //   //   return null;\n  //   // }\n  //   // if (typeof fn === 'string') {\n  //   //   return this.fnMap.exec(fn, ...args);\n  //   // }\n  //   // return fn(...args);\n  //   return this.fnMap.exec(fn, ...args);\n  // }\n\n  _dup(namedCollection?: Object) {\n    const contentCopy = [];\n    this.content.forEach(element => contentCopy.push(element._dup(namedCollection)));\n    const c = new Elements(contentCopy);\n    duplicateFromTo(this, c, ['content']);\n    return c;\n  }\n\n  calcSize(location: Point, scale: number) {\n    let des = 0;\n    let asc = 0;\n    const loc = location._dup();\n    let fullBounds = null;\n    this.content.forEach((element) => {\n      element.calcSize(loc, scale);\n\n      loc.x += element.width;\n      if (element.descent > des) {\n        des = element.descent;\n      }\n      if (element.ascent > asc) {\n        asc = element.ascent;\n      }\n      const fullElementBounds = element.getBounds(true);\n      if (fullBounds == null) {\n        fullBounds = new Bounds();\n        fullBounds.copyFrom(fullElementBounds);\n      }\n    });\n    if (fullBounds === null) {\n      fullBounds = new Bounds();\n      fullBounds.left = location.x;\n      fullBounds.top = location.y;\n      fullBounds.bottom = location.y;\n    }\n\n    this.width = loc.x - location.x;\n    this.ascent = asc;\n    this.descent = des;\n    this.location = location._dup();\n    this.height = this.descent + this.ascent;\n    this.fullSize = {\n      leftOffset: this.location.x - fullBounds.left,\n      width: fullBounds.width,\n      ascent: fullBounds.ascent,\n      descent: fullBounds.descent,\n      height: fullBounds.height,\n    };\n  }\n\n  // getFullBounds() {\n  //   // const fullSize = {\n  //   //   leftOffset: 0,\n  //   //   width: this.width,\n  //   //   ascent: this.ascent,\n  //   //   descent: this.descent,\n  //   //   height: this.height,\n  //   // };\n  //   // const bounds = new Bounds();\n  //   // bounds.width = this.width;\n  //   // bounds.left = this.location.x;\n  //   // bounds.right = bounds.left + bounds.right;\n  //   // bounds.bottom = this.location.y - this.descent;\n  //   // bounds.top = this.location.y + this.ascent;\n  //   // bounds.ascent = this.ascent;\n  //   // bounds.descent = this.descent;\n  //   // bounds.height = this.height;\n  //   const bounds = new Bounds();\n  //   bounds.left = this.location.x;\n  //   bounds.bottom = this.location.y;\n  //   bounds.top = this.location.y;\n\n  //   this.content.forEach((element) => {\n  //     const elementBounds = element.getBounds();\n  //     bounds.growWithSameBaseline(elementBounds);\n  //   });\n  //   return bounds;\n  // }\n\n  getAllElements() {\n    let elements = [];\n    this.content.forEach((e) => {\n      elements = [...elements, ...e.getAllElements()];\n    });\n    return elements;\n  }\n\n  setPositions() {\n    this.content.forEach((e) => {\n      e.setPositions();\n    });\n  }\n\n  offsetLocation(offset: Point = new Point(0, 0)) {\n    this.location = this.location.add(offset);\n    this.content.forEach((e) => {\n      e.offsetLocation(offset);\n    });\n  }\n\n  getBounds(useFullSize: boolean = false) {\n    if (useFullSize && this.fullSize != null) {\n      return new Bounds({\n        left: this.location.x + this.fullSize.leftOffset,\n        right: this.location.x + this.fullSize.leftOffset + this.fullSize.width,\n        top: this.location.y + this.fullSize.ascent,\n        bottom: this.location.y - this.fullSize.descent,\n        width: this.fullSize.width,\n        height: this.fullSize.height,\n        ascent: this.fullSize.ascent,\n        descent: this.fullSize.descent,\n      });\n    }\n    return new Bounds({\n      left: this.location.x,\n      right: this.location.x + this.width,\n      top: this.location.y + this.ascent,\n      bottom: this.location.y - this.descent,\n      width: this.width,\n      height: this.height,\n      ascent: this.ascent,\n      descent: this.descent,\n    });\n  }\n}\n\nexport { BlankElement, Element, Elements };\n","// @flow\nimport {\n  Point,\n} from '../../../tools/g2';\nimport Bounds from './Bounds';\nimport BaseEquationFunction from './BaseEquationFunction';\n// // Equation is a class that takes a set of drawing objects (TextObjects,\n// // FigureElementPrimitives or FigureElementCollections and HTML Objects\n// // and arranges their size in a )\n\nexport default class Fraction extends BaseEquationFunction {\n  calcSize(location: Point, incomingScale: number) {\n    this.location = location._dup();\n    const loc = location._dup();\n    const [vinculum] = this.glyphs;\n    const [numerator, denominator] = this.contents;\n    const {\n      scaleModifier, numeratorSpace, denominatorSpace, overhang,\n      offsetY, fullContentBounds, baseline,\n    } = this.options;\n    const scale = incomingScale * scaleModifier;\n    const vinculumBounds = new Bounds();\n    const numeratorBounds = new Bounds();\n    const denominatorBounds = new Bounds();\n    const fullBounds = new Bounds();\n    // console.log(numeratorBounds)\n    // console.log(denominatorBounds)\n    if (numerator != null) {\n      numerator.calcSize(loc._dup(), scale);\n      numeratorBounds.copyFrom(numerator.getBounds(fullContentBounds));\n    }\n\n    if (denominator != null) {\n      denominator.calcSize(loc._dup(), scale);\n      denominatorBounds.copyFrom(denominator.getBounds(fullContentBounds));\n    }\n\n    this.location = location._dup();\n\n    // numerator.calcSize(location, scale);\n    // denominator.calcSize(location, scale);\n\n    vinculumBounds.width = Math.max(\n      numeratorBounds.width, denominatorBounds.width,\n    ) + overhang * 2 * scale;\n\n    if (vinculum != null) {\n      vinculumBounds.height = vinculum.getHeight(\n        vinculum.custom.options, vinculumBounds.width,\n      );\n    }\n\n    // const vSpaceNum = scale * numeratorSpace;\n    // const vSpaceDenom = scale * denominatorSpace;\n    const lineVAboveBaseline = scale * offsetY / scaleModifier;\n\n    const numeratorLoc = new Point(\n      loc.x + (vinculumBounds.width - numeratorBounds.width) / 2,\n      loc.y + lineVAboveBaseline + vinculumBounds.height\n        + numeratorSpace * scale + numeratorBounds.descent,\n    );\n    const denominatorLoc = new Point(\n      loc.x + (vinculumBounds.width - denominatorBounds.width) / 2,\n      loc.y + lineVAboveBaseline - denominatorSpace * scale\n        - denominatorBounds.ascent,\n    );\n    // const xNumerator = (vinculumBounds.width - numeratorBounds.width) / 2;\n    // const xDenominator = (vinculumBounds.width - denominatorBounds.width) / 2;\n\n    // const lineWidth = Math.max(scale * 0.01, 0.008);\n\n    // const yNumerator = numeratorBounds.descent\n    //                     + vSpaceNum + lineVAboveBaseline;\n\n    // const yDenominator = denominatorBounds.ascent\n    //                      + vSpaceDenom - lineVAboveBaseline;\n\n    let baselineOffset = 0;\n    if (baseline === 'numerator' && numerator != null) {\n      baselineOffset = loc.y - numeratorLoc.y;\n    } else if (baseline === 'denominator' && denominator != null) {\n      baselineOffset = loc.y - denominatorLoc.y;\n    }\n\n    if (numerator != null) {\n      numerator.offsetLocation(\n        numeratorLoc.sub(numerator.location.x, numerator.location.y - baselineOffset),\n      );\n    }\n    if (denominator != null) {\n      denominator.offsetLocation(\n        denominatorLoc.sub(denominator.location.x, denominator.location.y - baselineOffset),\n      );\n    }\n\n    this.width = vinculumBounds.width;\n    this.descent = loc.y - (denominatorLoc.y - denominatorBounds.descent);\n    // vSpaceNum + lineWidth / 2\n    //                - lineVAboveBaseline\n    //                + denominatorBounds.ascent + denominatorBounds.descent;\n    if (this.descent < 0) {\n      this.descent = 0;\n    }\n    this.ascent = (numeratorLoc.y + numeratorBounds.ascent) - loc.y;\n    // vSpaceNum + lineWidth / 2\n    //               + lineVAboveBaseline + numeratorBounds.ascent\n    //               + numeratorBounds.descent;\n    this.height = this.descent + this.ascent;\n\n    this.glyphLocations[0] = new Point(\n      this.location.x,\n      this.location.y + lineVAboveBaseline + baselineOffset,\n    );\n    this.glyphWidths[0] = vinculumBounds.width;\n    this.glyphHeights[0] = vinculumBounds.height;\n\n    fullBounds.copyFrom(vinculumBounds);\n    fullBounds.left = this.glyphLocations[0].x;\n    fullBounds.bottom = this.glyphLocations[0].y;\n    if (numerator != null) {\n      fullBounds.growWithSameBaseline(numerator.getBounds(true));\n    }\n    if (denominator != null) {\n      fullBounds.growWithSameBaseline(denominator.getBounds(true));\n    }\n\n    if (vinculum) {\n      vinculum.custom.setSize(\n        this.glyphLocations[0],\n        vinculumBounds.width,\n        vinculumBounds.height,\n      );\n    }\n\n    this.fullSize = {\n      leftOffset: this.location.x - fullBounds.left,\n      width: fullBounds.width,\n      ascent: fullBounds.ascent,\n      descent: fullBounds.descent,\n      height: fullBounds.height,\n    };\n  }\n}\n","\n// @flow\nimport {\n  Point, parsePoint,\n} from '../../../tools/g2';\nimport Bounds from './Bounds';\nimport { Elements } from './Element';\nimport BaseEquationFunction from './BaseEquationFunction';\n\nfunction getMaxAscentDescent(\n  numRows,\n  numCols,\n  matrix: Array<Array<Elements | null>>,\n  bounds: Array<Array<Bounds>>,\n) {\n  const rowAscents = [];\n  const rowDescents = [];\n  const rowHeights = [];\n  let maxAscent = 0;\n  let maxDescent = 0;\n  let maxHeight = 0;\n  for (let row = 0; row < numRows; row += 1) {\n    let rowMaxAscent = 0;\n    let rowMaxDescent = 0;\n    // let rowMaxHeight = 0;\n    for (let col = 0; col < numCols; col += 1) {\n      const bound = bounds[row][col];\n      if (bound.ascent > rowMaxAscent || col === 0) {\n        rowMaxAscent = bound.ascent;\n      }\n      if (bound.descent > rowMaxDescent || col === 0) {\n        rowMaxDescent = bound.descent;\n      }\n    }\n    if (rowMaxAscent > maxAscent || row === 0) {\n      maxAscent = rowMaxAscent;\n    }\n    if (rowMaxDescent > maxDescent || row === 0) {\n      maxDescent = rowMaxDescent;\n    }\n    const rowMaxHeight = rowMaxDescent + rowMaxAscent;\n    if (rowMaxHeight > maxHeight || row === 0) {\n      maxHeight = rowMaxHeight;\n    }\n    rowHeights.push(rowMaxHeight);\n    rowAscents.push(rowMaxAscent);\n    rowDescents.push(rowMaxDescent);\n  }\n  return {\n    ascents: rowAscents,\n    descents: rowDescents,\n    heights: rowHeights,\n    maxAscent,\n    maxDescent,\n    maxHeight,\n  };\n}\n\nfunction getMaxColWidth(\n  numRows,\n  numCols,\n  matrix: Array<Array<Elements | null>>,\n  bounds: Array<Array<Bounds>>,\n) {\n  const colWidths = [];\n  let maxWidth = 0;\n  for (let col = 0; col < numCols; col += 1) {\n    let maxColWidth = 0;\n    for (let row = 0; row < numRows; row += 1) {\n      const elementWidth = bounds[row][col].width;\n      if (elementWidth > maxColWidth) {\n        maxColWidth = elementWidth;\n      }\n      if (elementWidth > maxWidth) {\n        maxWidth = elementWidth;\n      }\n    }\n    colWidths.push(maxColWidth);\n  }\n  return [colWidths, maxWidth];\n}\n\n// Matrix is centered in y.\n\nexport default class Matrix extends BaseEquationFunction {\n  calcSize(location: Point, scale: number) {\n    this.location = location._dup();\n    const loc = location._dup();\n    const aboveBaseline = scale * 0.07;\n    const {\n      order, fit, space, contentScale, yAlign, fullContentBounds,\n    } = this.options;\n    const [numRows, numCols] = order;\n\n    const bounds = [];\n    const locs = [];\n    let index = 0;\n    const matrix: Array<Array<Elements | null>> = [];\n    for (let row = 0; row < numRows; row += 1) {\n      matrix.push([]);\n      bounds.push([]);\n      locs.push([]);\n      for (let col = 0; col < numCols; col += 1) {\n        const elementBounds = new Bounds();\n        const element = this.contents[index];\n        if (element != null) {\n          element.calcSize(loc._dup(), scale * contentScale);\n          elementBounds.copyFrom(element.getBounds(fullContentBounds));\n        }\n        matrix[row].push(element);\n        bounds[row].push(elementBounds);\n        locs[row].push(new Point(0, 0));\n        index += 1;\n      }\n    }\n\n    const rowBounds = getMaxAscentDescent(numRows, numCols, matrix, bounds);\n    const [colWidths, maxWidth] = getMaxColWidth(numRows, numCols, matrix, bounds);\n    const maxDim = Math.max(maxWidth, rowBounds.maxHeight);\n    if (fit !== 'min') {\n      let dim;\n      if (fit === 'max') {\n        dim = new Point(maxDim, maxDim);\n      } else {\n        dim = parsePoint(fit);\n        if (dim == null) {\n          dim = new Point(0, 0);\n        }\n      }\n      for (let row = 0; row < numRows; row += 1) {\n        rowBounds.heights[row] = dim.y;\n      }\n      for (let col = 0; col < numCols; col += 1) {\n        colWidths[col] = dim.x;\n      }\n    }\n\n    let cumHeight = 0;\n    let cumWidth = 0;\n    for (let row = numRows - 1; row >= 0; row -= 1) {\n      cumWidth = 0;\n      for (let col = 0; col < numCols; col += 1) {\n        const bound = bounds[row][col];\n        const x = cumWidth + colWidths[col] / 2 - bound.width / 2;\n        let y = cumHeight + rowBounds.heights[row] / 2\n            - (bound.ascent - bound.descent) / 2;\n        if (yAlign === 'baseline') {\n          y = cumHeight + rowBounds.descents[row];\n        }\n        cumWidth += colWidths[col] + space.x * scale;\n        locs[row][col] = new Point(x, y);\n      }\n      if (yAlign === 'baseline') {\n        cumHeight += rowBounds.descents[row] + rowBounds.ascents[row] + space.y * scale;\n      } else {\n        cumHeight += rowBounds.heights[row] + space.y * scale;\n      }\n    }\n    const totalHeight = cumHeight - space.y * scale;\n    const totalWidth = cumWidth - space.x * scale;\n\n    const fullBounds = new Bounds();\n    for (let row = 0; row < numRows; row += 1) {\n      for (let col = 0; col < numCols; col += 1) {\n        locs[row][col].x += loc.x;\n        locs[row][col].y = loc.y - totalHeight / 2 + locs[row][col].y + aboveBaseline;\n        const element = matrix[row][col];\n        if (element != null) {\n          element.offsetLocation(locs[row][col].sub(element.location));\n          if (fullBounds.width === 0) {\n            fullBounds.copyFrom(element.getBounds(true));\n          }\n          fullBounds.growWithSameBaseline(element.getBounds(true));\n        }\n      }\n    }\n\n    this.width = totalWidth;\n    this.height = totalHeight;\n    this.descent = totalHeight / 2 - aboveBaseline;\n    this.ascent = totalHeight / 2 + aboveBaseline;\n    this.fullSize = {\n      leftOffset: this.location.x - fullBounds.left,\n      width: fullBounds.width,\n      ascent: fullBounds.ascent,\n      descent: fullBounds.descent,\n      height: fullBounds.height,\n    };\n  }\n}\n","\n// @flow\nimport {\n  Point,\n} from '../../../tools/g2';\nimport Bounds from './Bounds';\nimport BaseEquationFunction from './BaseEquationFunction';\n\n\nexport default class Scale extends BaseEquationFunction {\n  calcSize(location: Point, scale: number) {\n    this.location = location._dup();\n    const loc = location._dup();\n    const {\n      scaleModifier, fullContentBounds,\n    } = this.options;\n    const [mainContent] = this.contents;\n    const contentBounds = new Bounds();\n    const fullBounds = new Bounds();\n    if (mainContent != null) {\n      mainContent.calcSize(loc._dup(), scale * scaleModifier);\n      contentBounds.copyFrom(mainContent.getBounds(fullContentBounds));\n      fullBounds.copyFrom(mainContent.getBounds(true));\n    }\n\n    this.width = contentBounds.width;\n    this.height = contentBounds.height;\n    this.descent = contentBounds.descent;\n    this.ascent = contentBounds.ascent;\n    this.fullSize = {\n      leftOffset: this.location.x - fullBounds.left,\n      width: fullBounds.width,\n      ascent: fullBounds.ascent,\n      descent: fullBounds.descent,\n      height: fullBounds.height,\n    };\n  }\n}\n","// @flow\nimport {\n  Point, Transform, parsePoint, getPoint, getTransform,\n} from '../../tools/g2';\nimport { joinObjects, joinObjectsWithOptions } from '../../tools/tools';\n// import { RGBToArray } from '../../tools/color';\nimport {\n  FigureElementPrimitive, FigureElementCollection, FigureElement,\n} from '../Element';\nimport {\n  FigureFont,\n} from '../DrawingObjects/TextObject/TextObject';\nimport type { ElementInterface } from './Elements/Element';\nimport { Elements } from './Elements/Element';\nimport BaseAnnotationFunction from './Elements/BaseAnnotationFunction';\nimport EquationForm from './EquationForm';\nimport type {\n  TypeHAlign, TypeVAlign,\n} from './EquationForm';\n// import HTMLObject from '../DrawingObjects/HTMLObject/HTMLObject';\nimport * as html from '../../tools/htmlGenerator';\nimport EquationSymbols from './EquationSymbols';\n// import type { TypeSymbolOptions } from './EquationSymbols';\nimport { getFigureElement, EquationFunctions } from './EquationFunctions';\nimport type { TypeEquationPhrase } from './EquationFunctions';\nimport type {\n  TypeColor, OBJ_Font,\n} from '../../tools/types';\nimport type {\n  TypeParsablePoint, TypeBorder, TypeParsableBuffer,\n} from '../../tools/g2';\nimport type { OBJ_TriggerAnimationStep } from '../Animation/Animation';\nimport { AnimationManager, TriggerAnimationStep } from '../Animation/Animation';\nimport type {\n  EQN_VinculumSymbol, EQN_BoxSymbol, EQN_ArrowSymbol, EQN_SumSymbol,\n  EQN_ProdSymbol, EQN_IntegralSymbol, EQN_StrikeSymbol, EQN_BracketSymbol,\n  EQN_AngleBracketSymbol, EQN_BraceSymbol, EQN_BarSymbol,\n  EQN_SquareBracketSymbol, EQN_RadicalSymbol, TypeSymbolOptions,\n} from './EquationSymbols';\nimport type { OBJ_FigureForElement } from '../Figure';\n\n// Priority:\n//   1. symbol\n//   2. text\n\n/**\n * Object that defines new text for a selection of equation elements.\n *\n * Each key in the object is the name of the equation element whose text is to\n * be updated.\n *\n * @property {string | FigureElement} [_elementName]\n */\nexport type EQN_UpdateElementText = {\n  [elementName: string]: string | FigureElement\n};\n\n/**\n * Object where keys are property names of a {@link FigureElement} and values\n * are the values to set the properties to.\n *\n * @property {any} [_propertyName]\n */\nexport type OBJ_ElementPropertyMod = {\n  [propertyName: string]: any,\n}\n\n/**\n * Object where keys are equation element names, and values are objects\n * describing which element properties to modify after creation.\n *\n * @property {OBJ_ElementPropertyMod} [_elementName]\n */\nexport type OBJ_ElementMods = {\n  [elementName: string]: OBJ_ElementPropertyMod,\n}\n\n/**\n * Definition of a text or equation element.\n *\n * The properties 'color', 'isTouchable', 'onClick' and `touchBorder`\n * modify the corresponding properties on the {@link FigureElementPrimitive}\n * itself, and so could equally be set in `mods`. They are provided in the\n * root object for convenience as they are commonly used.\n *\n * @property {string} [text] - Text element only\n * @property {OBJ_Font} [font] - Text element only\n * @property {'italic' | 'normal'} [style] - Text element only\n * @property {object} [mods] - Properties to set on instantiated element\n * @property {TypeColor} [color] - Color to set the element\n * @property {boolean} [isTouchable] - make the element touchable\n * @property {() => void | 'string' | null} [onClick] - called when touched\n * @property {TypeBorder | 'border' | number | 'rect' | 'draw' | 'buffer'} [touchBorder]\n * set the element's touch border\n * @property {OBJ_ElementMods} [mods]\n */\nexport type EQN_TextElement = string | {\n    text?: string;\n    font?: OBJ_Font;\n    style?: 'italic' | 'normal' | null;\n    weight?: 'normal' | 'bold' | 'lighter' | 'bolder' | '100' | '200' | '300' | '400' | '500' | '600' | '700' | '800' | '900',\n    size?: number,\n    color?: TypeColor;\n    isTouchable?: boolean,\n    onClick?: () => void | 'string' | null,\n    touchBorder?: TypeBorder | 'border' | number | 'rect' | 'draw' | 'buffer',\n    mods?: OBJ_ElementMods;\n  } | FigureElementPrimitive | FigureElementCollection;\n\n/**\n * An equation element can be any of the below. If `string`, then a\n * {@link EQN_TextElement} will be used where the `text` property is the\n * `string`.\n *\n * - `string`\n * - {@link FigureElementPrimitive}\n * - {@link FigureElementCollection}\n * - {@link EQN_TextElement}\n * - {@link EQN_VinculumSymbol}\n * - {@link EQN_BoxSymbol}\n * - {@link EQN_ArrowSymbol}\n * - {@link EQN_SumSymbol}\n * - {@link EQN_ProdSymbol}\n * - {@link EQN_IntegralSymbol}\n * - {@link EQN_StrikeSymbol}\n * - {@link EQN_BracketSymbol}\n * - {@link EQN_AngleBracketSymbol}\n * - {@link EQN_BraceSymbol}\n * - {@link EQN_BarSymbol}\n * - {@link EQN_SquareBracketSymbol}\n * - {@link EQN_RadicalSymbol}\n */\nexport type TypeEquationElement = string\n  | FigureElementPrimitive\n  | FigureElementCollection\n  | EQN_TextElement\n  | EQN_VinculumSymbol\n  | EQN_BoxSymbol\n  | EQN_ArrowSymbol\n  | EQN_SumSymbol\n  | EQN_ProdSymbol\n  | EQN_IntegralSymbol\n  | EQN_StrikeSymbol\n  | EQN_BracketSymbol\n  | EQN_AngleBracketSymbol\n  | EQN_BraceSymbol\n  | EQN_BarSymbol\n  | EQN_SquareBracketSymbol\n  | EQN_RadicalSymbol;\n\n\n/**\n * Object where keys are element names, and values are the element definitions\n *\n * @see {@link Equation}\n *\n * @property {TypeEquationElement} [_elementName]\n */\nexport type EQN_EquationElements = {\n  [elementName: string]: TypeEquationElement;\n};\n\n/**\n * Form alignment object definition.\n */\ntype EQN_FormAlignment = {\n  fixTo: FigureElementPrimitive | FigureElementCollection | TypeParsablePoint;\n  xAlign: TypeHAlign;\n  yAlign: TypeVAlign;\n};\n\n/**\n * Form translation properties\n *\n * @property {'curved' | 'linear'} style - element should move in a straight\n * line, or through a curve. Default: `\"linear\"`\n * @property {'up' | 'down'} [direction] - curve only - element should move\n * through an up or down curve\n * @property {number} [mag] - the magnitude of the curve\n */\ntype EQN_TranslationStyle = {\n  style: 'curved' | 'linear',\n  direction?: 'up' | 'down',\n  mag: number,\n};\n\n/**\n * Object where keys are element names and values are tranlation definition\n * objects.\n *\n * `[elementName: string]: TypeEquationElement`\n *\n * @see {@link EQN_TranslationStyle}, {@link EQN_FormObjectDefinition}, {@link EQN_FromForm}.\n *\n * @property {EQN_TranslationStyle} [_elementName]\n */\nexport type EQN_TranslationStyles = {\n  [elementName: string]: EQN_TranslationStyle;\n};\n\n\n// /**\n//  * Duration and translation options for form animation\n//  *\n//  * @property {number} [duration] in seconds\n//  * @property {Object.<EQN_TranslationStyle>} [translation]\n//  * @example\n//  * // for an equation with two of its elements named 'a' and 'b'\n//  * {\n//  *   duration: 1,\n//  *   translation: {\n//  *     a: {\n//  *       direction: 'up',\n//  *       style: 'curved',\n//  *       mag: 0.5,\n//  *     },\n//  *     b: {\n//  *       direction: 'down',\n//  *       style: 'curved',\n//  *       mag: 0.2,\n//  *     },\n//  *   },\n//  * }\n//  * // Note, not all elements need to be defined - only those that need a custom\n//  * duration or shouldn't have a linear path\n//  */\n// type TypeFormAnimationProperties = {\n//   duration?: ?number,\n//   translation?: {\n//     [elementName: string]: EQN_TranslationStyle,\n//   },\n// }\n\n/**\n * From form options object.\n *\n * Any defined properties will override the corrsponding properties of the form\n * if it being animated to from a specific form.\n *\n * @property {?number} [duration] duration if animating to this form, use\n * `null` for velocity based duration\n * @property {EQN_TranslationStyle} [translation] translation style\n * when animating to this form\n * @property {string | (() => void)} [onTransition] called at the start of\n * animating to this form, or when `showForm` is used.\n * @property {string | (() => void)} [onShow] called after animation is finished\n * or when `showForm` is used\n * @property {TypeElementMods} [elementMods] properties to set in the equation element\n * (@FigureElementPrimitive) when this form is shown\n */\nexport type EQN_FromForm = {\n  onTransition?: null | string | (() => void),\n  onShow?: null | string | (() => void),\n  duration?: number,\n  translation?: { [elementName: string]: EQN_TranslationStyle },\n  elementMods?: OBJ_ElementMods,\n};\n\n/**\n * Equation form FromForm definition.\n *\n * When animating from a specific form, it can be useful to customize some of\n * the form properties specific to that transition.\n *\n * To do so, use this options object where each key is the specific form from\n * which the equation is animating from, and the value is the specific\n * properties.\n *\n * @property {EQN_FromForm} [_formName]\n *\n * @see {@link EQN_FromForm}, {@link EQN_FormObjectDefinition}\n */\nexport type EQN_FromForms = {\n  [formName: string]: EQN_FromForm,\n};\n\n// A form is a steady state arrangement of elements\n// A form's elements can have different properties, but these properties\n// are generally the same independent on which form was shown before the\n// current form.\n// The only exception is the translation movement properties, which can be\n// different depending on whether you are going to the current form from\n// the previous one, or two the next one.\n\n/**\n * In mathematics, an equation form is a specific arrangement of an equation's\n * terms and operators. Different forms will have different arrangements, that\n * that can be achieved by performing a series of operations to both sides of\n * the equation.\n *\n * For instance, the equation:\n *\n * a + b = c\n *\n * can be rearranged to a different form:\n *\n * a = c - b\n *\n * From a FigureOne figure's perspective, a form is a specific layout of\n * equation elements.\n *\n * This object defines a how the elements are laid out, what properties the\n * elements have, and some animation properties for when animating to this form.\n *\n * @see {@link Equation}\n *\n * @property {TypeEquationPhrase} content The equation phrase of the form\n * defines how the elements are laid out\n * @property {number} [scale] scaling factor for this form\n * @property {EQN_FormAlignment} [alignment] how the equation's position\n * is aligned with this form\n * @property {string} [description] description of this form\n * @property {{}} [modifiers] description modifiers\n * @property {?number} [duration] duration if animating to this form, use\n * `null` for velocity based duration\n * @property {EQN_TranslationStyle} [translation] translation style\n * when animating to this form\n * @property {string | (() => void)} [onTransition] called at the start of\n * animating to this form, or when `showForm` is used.\n * @property {string | (() => void)} [onShow] called after animation is finished\n * or when `showForm` is used\n * @property {OBJ_ElementMods} [elementMods] properties to set in the equation element\n * (@FigureElementPrimitive) when this form is shown\n * @property {EQN_FromForms} [fromForm] override `duration`, `translation`\n * `onTransition` and/or `onShow` with this if coming from specific forms\n *\n * @example\n * // Simple form definition of two different forms of the same equation and one\n * // of the elements is colored blue in one form and red in the other\n * forms: {\n *   form1: {\n *     content: ['a', 'plus', 'b', 'equals', 'c'],\n *     elementMods: {\n *       'a': { color: [0, 0, 1, 1] },\n *     }\n *   },\n *   form2: {\n *     content: ['a', 'equals', 'c', 'minus', 'b'],\n *     elementMods: {\n *       'a': { color: [1, 0, 0, 1] },\n *     }\n *   },\n * }\n *\n * @example\n * // Example using subForms all defined at once\n * forms: {\n *   form1: {\n *     deg: ['a', 'deg'],\n *     rad: ['a', 'rad'],\n *   },\n * }\n *\n * @example\n * // Example using subForms all defined separately\n * const eqn = new Equation();\n * eqn.addForms({\n *   deg: {\n *     content: ['a', 'deg'],\n *     subForm:'deg',\n *   }\n * });\n * eqn.addForms({\n *   rad: {\n *     content: ['a', 'rad'],\n *     subForm:'rad',\n *   }\n * });\n * @example\n * // Example showing all form options\n * forms: {\n *   form1: {\n *     content: ['a', 'b', 'c'],\n *     subForm: 'deg',\n *     scale: 1.2,\n *     alignment: {\n *       fixTo: 'b',\n *       xAlign: 'center',\n *       yAlign: 'bottom',\n *     },\n *     description: '|Form| 1 |description|',\n *     modifiers: {\n *       Form: html.highlight([1, 0, 0, 0]),\n *     },\n *     elementMods: {\n *       a: {\n *         color: color1,\n *         isTouchable: true,\n *       },\n *     },\n *     duration: 1,\n *     translation: {\n *       a: {\n *         style: 'curved',\n *         direction: 'up',\n *         mag: 0.95,\n *       },\n *       b: ['curved', 'down', 0.45],\n *     },\n *     fromPrev: {\n *       duration: null,\n *       translation: {\n *         a: ['curved', 'down', 0.2],\n *         b: ['curved', 'down', 0.2],\n *       },\n *     },\n *     fromNext: {\n *       duration: 2,\n *       translation: {\n *         a: ['curved', 'down', 0.2],\n *         b: ['curved', 'down', 0.2],\n *       },\n *     },\n *   },\n * }\n */\ntype EQN_FormObjectDefinition = {\n  content: TypeEquationPhrase,\n  scale?: number,\n  alignment?: EQN_FormAlignment,\n  description?: string,\n  modifiers?: {},                 // Modifiers for description\n  duration?: ?number,               // null means to use velocity\n  translation?: EQN_TranslationStyle,\n  onShow?: string | (() => void),\n  onTransition?: string | (() => void),\n  elementMods?: OBJ_ElementMods,\n  fromForm: EQN_FromForms,\n};\n\n\n/**\n * A form definition can either be:\n *\n * * an equation form object {@link EQN_FormObjectDefinition}\n * * an equation phrase {@link TypeEquationPhrase}\n *\n * @type {TypeEquationPhrase | EQN_FormObjectDefinition}\n */\ntype TypeEquationForm = TypeEquationPhrase\n                        | EQN_FormObjectDefinition\n\n/**\n * An object of equation forms where each key is the form name and each value\n * is a form defintion {@link TypeEquationForm}\n *\n * @property {TypeEquationForm} [_formName]\n */\nexport type EQN_Forms = {\n  [formName: string]: TypeEquationForm\n};\n\n/**\n * When an equation form series is restarted, or cycled back to the first form\n * in the series, then two special animations can be defined with this object:\n * * `moveFrom`: the equation will move from a location (usually another equation of the same form)\n * * `pulse`: An element will be pulsed when the animation is finished.\n *\n * The default values in the pulse object are are:\n * * `duration`: 1s\n * * `scale`: 1.1\n */\ntype EQN_FormRestart = {\n  moveFrom?: ?Point | FigureElementCollection;\n  pulse?: {\n    duration?: number;\n    scale?: number;\n    element?: ?FigureElement;\n  }\n}\n\n/**\n * {@link NextFormAnimationStep} options object.\n *\n * `OBJ_TriggerAnimationStep & EQN_EquationGoToForm`\n *\n * Duration will be automatically calculated (unless duration is set to 0).\n * To specify it exactly, the `duration`, `dissolveOutTime`, `dissolveInTime`\n * and `blankTime` must all be specified (or at least the ones that will be used\n * in the form change).\n *\n * @extends OBJ_TriggerAnimationStep\n * @extends EQN_EquationGoToForm\n *\n * @see {@link Equation}, {@link NextFormAnimationStep}\n */\nexport type OBJ_NextFormAnimationStep = {\n} & OBJ_TriggerAnimationStep;\n\n/**\n * {@link GoToFormAnimationStep} options object.\n *\n * `OBJ_TriggerAnimationStep & EQN_EquationGoToForm & { start?: 'string', target?: 'string'}`\n *\n * Duration will be automatically calculated (unless duration is set to 0).\n * To specify it exactly, the `duration`, `dissolveOutTime`, `dissolveInTime`\n * and `blankTime` must all be specified (or at least the ones that will be used\n * in the form change).\n *\n * The `form` property of EQN_EquationGoToForm is not used. Use `target`\n * instead.\n *\n * @extends OBJ_TriggerAnimationStep\n * @extends EQN_EquationGoToForm\n *\n * @property {string} [start] form to start from. If undefined, then current\n * form will be used\n * @property {string} [target] form to go to. If undefined, then current\n * form will be used\n *\n * @see {@link Equation}\n */\nexport type OBJ_GoToFormAnimationStep = {\n  start?: string,\n  target?: string,\n} & OBJ_TriggerAnimationStep;\n\n\n/**\n * Default form values applied to all forms\n *\n * @see {@link EQN_FormObjectDefinition}\n */\nexport type EQN_FormDefaults = {\n  alignment?: EQN_FormAlignment,\n  elementMods?: OBJ_ElementMods,\n  duration?: number,\n  translation?: EQN_TranslationStyle,\n  onShow?: null | string | (() => void),\n  onTransition?: null | string | (() => void),\n}\n\n/**\n * Options objects to construct an {@link Equation} class.\n *\n * All properties are optional.\n *\n * @property {TypeColor} [color] default equation color\n * @property {TypeColor} [dimColor] default equation dim color\n * @property {OBJ_Font} [font] default {@link FigureFont} for the equation\n * @property {number} [scale] equation scale (`0.7`)\n * @property {EQN_EquationElements} [elements] equation element definitions\n * @property {EQN_Forms} [forms] form definitions\n * @property {string} [initialForm] form to show when first added to a figure\n * @property {EQN_FormDefaults} [formDefaults] default form options applied to\n * all forms\n * @property {Array<string> | Object.<Array<string>>} [formSeries] an object\n * with each key being a form series name, and each value an array for form\n * names. If defined as an array, then a form series object is created where\n * the form series name is 'base'. Default: {}\n * @property {string} [defaultFormSeries] If more than one form series is\n * defined, then a default must be chosen to be the first current one. Default:\n * first form defined\n * @property {?EQN_FormRestart} [formRestart] behavior when form transitions\n * from last in form series back to first\n * @property {TypeParsablePoint} [position] position will override first\n * translation element of transform\n * @property {Transform} [transform]\n */\nexport type EQN_Equation = {\n  color?: TypeColor;\n  dimColor?: TypeColor;\n  font?: OBJ_Font;\n  scale?: number,\n  elements?: EQN_EquationElements;\n  formDefaults: EQN_FormDefaults;\n  forms?: EQN_Forms;\n  initialForm?: string;\n  formSeries?: Array<string> | {};\n  defaultFormSeries?: string;\n  formRestart?: EQN_FormRestart;\n  position?: TypeParsablePoint;\n  transform?: Transform;\n};\n\n/**\n * Options object for {@link Equation#goToForm}.\n *\n * Often, `goToForm` is called to animate from a shown form to a desired form.\n * Therefore there will be some equation elements that:\n * * Are currently shown, but need to be hidden as they are not in the desired form\n * * Are currently shown, are in the desired form, and need to be moved to the\n *   correct layout position for the desired form\n * * Are currently hidden and need to be shown in the desired form\n *\n * The order that elements are shown, hidden and moved is defined by the\n * `animate` property:\n * * `'move'`: Dissolve out elements to hide, move existing elements to new,\n * dissolve in elements that need to be shown\n * * `'dissolveInThenMove'`: Dissolve out the elements to hide, dissolve in the\n * elements that need to be shown in the correct locations of the form, then\n * move existing elements to their correct locations\n * * `'dissolve'`: Dissolve out the entire current form, and then dissolve in the entire new form\n * * `'moveFrom'`: Shows the desired form at the position defined in the\n * formRestart property of {@link EQN_Equation}, then moves it to the\n * current location\n * * `'pulse'`: Same as `'dissolve'`, but once finished will pulse the element\n *  defined in the pulse object in the formRestart property of {@link EQN_Equation}\n *\n * If a form is already animating, then the `ifAnimating` property will define\n * the behavior of the animation:\n * * `cancelGoTo: true`, `skipToTarget: true`: Current animation will skip to\n *   the end, and current goTo call will be cancelled\n * * `cancelGoTo: true`, `skipToTarget: false`: Current animation will stop in\n *   its current state, and current goTo call will be cancelled\n * * `cancelGoTo: false`, `skipToTarget: true`: Current animation will skip to\n *   the end, and current goTo call will then be executed\n * * `cancelGoTo: false`, `skipToTarget: false`: Current animation will stop in\n *   its current state, and current goTo call will be executed\n *\n * @property {string} [name] - form name to goto\n * @property {number} [index] - form index to goto (can be used instead of name)\n * @property {'move' | 'dissolve' | 'moveFrom' | 'pulse' |\n *  'dissolveInThenMove'} [animate] - default: `\"dissolve\"`\n * @property {number} [delay] - delay before goto start. Default: `0`\n * @property {number} [dissolveOutTime] - Default: 0.4 of duration, or 0.4s if\n * no duration\n * @property {number} [duration] - animation duration. Default: `null`\n * @property {number} [blankTime] - time between dissolve out and dissolve in\n * when animating with `dissolve` or `pulse`. Default: 0.2 of duration, or 0.2s\n * if no duration\n * @property {number} [dissolveInTime] - Default: 0.4 of duration, or 0.4s if\n * no duration\n * @property {boolean} [prioritizeFormDuration] - use duration from the form\n * definition {@link EQN_FormObjectDefinition}. Default: `true`\n * @property {'fromPrev' | 'fromNext'} [fromWhere] - prioritze *fromPrev* or\n * *fromNext* duration from the form definition. {@link EQN_FormObjectDefinition}\n * Default: `null`\n * @property {{cancelGoTo?: boolean, skipToTarget?: boolean}} [ifAnimating] -\n * behavior for if currently animating between forms. Default:\n * `skipToTarget: true`, `cancelGoTo: true`\n * @property {?() => void} [callback] - call when goto finished\n */\ntype EQN_EquationGoToForm = {\n  name?: string,\n  index?: number,\n  animate?: 'move' | 'dissolve' | 'moveFrom' | 'pulse' | 'dissolveInThenMove',\n  delay?: number,\n  dissolveOutTime?: number,\n  duration?: ?number,\n  dissolveInTime?: number,\n  blankTime?: number,\n  prioritizeFormDuration?: boolean,\n  fromWhere?: string | null,\n  ifAnimating?: {\n    cancelGoTo?: boolean;\n    skipToTarget?: boolean;\n  },\n  callback?: ?(string | (() => void)),\n}\n\n\n/**\n * Next form animation step\n *\n * ![](./apiassets/nextformanimationstep.gif)\n *\n * Animation step that animates to the next equation form in a formSeries.\n * Equivalent to a triggering a\n * <a href=\"#equationnextform\">Equation.nextForm</a> call.\n *\n * This animation step is only available in {@link Equation}.\n *\n * @extends TriggerAnimationStep\n * @param {OBJ_NextFormAnimationStep} options\n *\n * @see To test examples, append them to the\n * <a href=\"#equation-boilerplate\">boilerplate</a>\n *\n * @example\n * // Example showing both ways to access GoToForm animation step\n * figure.add({\n *   name: 'eqn',\n *   method: 'equation',\n *   options: {\n *     elements: { times: ' \\u00D7', equals: ' = ' },\n *     forms: {\n *       0: ['a', 'equals', 'b', 'times', ' ', '_1'],\n *       1: ['a', 'equals', 'b', 'times', { strike: [[' ', '_1'], 'strike'] }],\n *       2: ['a', 'equals', 'b'],\n *     },\n *     formSeries: ['0', '1', '2'],\n *   },\n * });\n * const e = figure.getElement('eqn');\n * e.showForm('0');\n * e.animations.new()\n *   .delay(2)\n *   .inParallel([\n *     e.animations.nextForm({ animate: 'move', duration: 1 }),\n *     e._times.animations.dim({ duration: 1 }),\n *     e.__1.animations.dim({ duration: 1 }),\n *   ])\n *   .delay(1)\n *   .nextForm({ animate: 'move', duration: 1 })\n *   .start();\n */\n// eslint-disable-next-line no-unused-vars\nclass NextFormAnimationStep extends TriggerAnimationStep {\n}\n\n/**\n * GoToForm form animation step\n *\n * ![](./apiassets/gotoformanimationstep.gif)\n *\n * Animation step that animates moving between equation forms. Equivalent to\n * a triggering a <a href=\"#equationgotoform\">Equation.goToForm</a> call.\n *\n * This animation step is only available in {@link Equation}.\n *\n * @extends TriggerAnimationStep\n * @param {OBJ_GoToFormAnimationStep} options\n *\n * @see To test examples, append them to the\n * <a href=\"#equation-boilerplate\">boilerplate</a>\n *\n * @example\n * // Example showing both ways to access GoToForm animation step\n * figure.add({\n *   name: 'eqn',\n *   method: 'equation',\n *   options: {\n *     elements: { times: ' \\u00D7', equals: ' = ' },\n *     forms: {\n *       0: ['a', 'equals', 'b', 'times', ' ', '_1'],\n *       1: ['a', 'equals', 'b', 'times', { strike: [[' ', '_1'], 'strike'] }],\n *       2: ['a', 'equals', 'b'],\n *     }\n *   },\n * });\n * const e = figure.getElement('eqn');\n * e.showForm('0');\n * e.animations.new()\n *   .delay(2)\n *   .inParallel([\n *     e.animations.goToForm({ target: '1', animate: 'move' }),\n *     e._times.animations.dim({ duration: 1 }),\n *     e.__1.animations.dim({ duration: 1 }),\n *   ])\n *   .delay(1)\n *   .goToForm({ target: '2', animate: 'move' })\n *   .start();\n */\n// eslint-disable-next-line no-unused-vars\nclass GoToFormAnimationStep extends TriggerAnimationStep {\n}\n\n// export const foo = () => {};\n// An Equation is a collection of elements that can be arranged into different\n// forms.\n// Equation allows setting of forms, and navigating through form series\n// Eqn manages different forms of the\n\n/**\n * An Equation is a collection of elements that can be arranged into different\n * forms.\n *\n * `Equation` should be instantiated from an *object definition*, or from\n * the `figure.primitives.equation` method.\n *\n * Equation includes two additional animation steps in {@link Equation.animations}:\n * * {@link GoToFormAnimationStep}\n * * {@link NextFormAnimationStep}\n *\n * @extends FigureElementCollection\n *\n * @see To test examples, append them to the\n * <a href=\"#equation-boilerplate\">boilerplate</a>\n *\n * @param {EQN_Equation} options\n * @example\n * // Create with options definition\n * figure.add({\n *   name: 'eqn',\n *   method: 'equation',\n *   options: {\n *     elements: {\n *       a: 'a',\n *       b: { color: [0, 0, 1, 1] },\n *       c: 'c',\n *       equals: ' = ',\n *       plus: ' + ',\n *     },\n *     forms: {\n *       1: ['a', 'equals', 'b', 'plus', 'c'],\n *     },\n *   },\n * });\n *\n * @example\n * // Create with methods\n * const eqn = figure.collections.equation();\n * eqn.addElements({\n *   a: 'a',\n *   b: { color: [0, 0, 1, 1] },\n *   c: 'c',\n *   equals: ' = ',\n *   plus: ' + ',\n * });\n * eqn.addForms({\n *   1: ['a', 'equals', 'b', 'plus', 'c'],\n * });\n * figure.add('eqn', eqn);\n * eqn.showForm('1');\n */\n// $FlowFixMe\nexport class Equation extends FigureElementCollection {\n  /**\n   * Equation parameters and functions\n   * @property {EquationFunctions} functions - equation functions\n   */\n  eqn: {\n    // forms: { [formName: string]: {\n    //     base: EquationForm;                   // There is always a base form\n    //     [subFormName: string]: EquationForm;  // Sub forms may differ in units\n    //     name: string;                         // Name of form\n    //   }\n    // };\n    forms: {\n      [formName: string]: EquationForm;\n    };\n\n    functions: EquationFunctions;\n    symbols: EquationSymbols;\n    currentForm: string;\n    // currentSubForm: string;\n    font: FigureFont;\n    // fontText: FigureFont;\n    scale: number;\n\n    // subFormPriority: Array<string>,\n\n    // formSeries: { [seriesName: String]: Array<EquationForm> };\n    formSeries: { [string]: Array<string> };\n    currentFormSeries: Array<string>;\n    currentFormSeriesName: string;\n\n    //\n    // defaultFormAlignment: {\n    //   fixTo: FigureElementPrimitive | FigureElementCollection | Point;\n    //   xAlign: TypeHAlign;\n    //   yAlign: TypeVAlign;\n    // };\n\n    formDefaults: {\n      alignment: {\n        fixTo: (FigureElementPrimitive | FigureElementCollection | Point),\n        xAlign: TypeHAlign,\n        yAlign: TypeVAlign,\n      },\n      elementMods: OBJ_ElementMods,\n      duration?: number,\n      translation?: EQN_TranslationStyle,\n      onShow?: null | string | (() => void),\n      onTransition?: null | string | (() => void),\n    };\n\n    isAnimating: boolean;\n\n    descriptionElement: FigureElementPrimitive | null;\n    descriptionPosition: Point;\n\n    formRestart: ?{\n      moveFrom?: Point | FigureElementCollection;\n      pulse?: {\n        duration: number;\n        scale: number;\n        element: FigureElement;\n      }\n    }\n    // formRestartPosition: ?Point | FigureElementCollection;\n    // formRestartAnimation: 'dissolve' | 'moveFrom' | 'pulse';\n  };\n\n  initialForm: string | null;\n\n  /**\n   * {@link AnimationManager} extended to include additional animation steps\n   * specific to equations\n   * @property {NextFormAnimationStep} nextForm\n   * @property {GoToFormAnimationStep} goToForm\n   * @extends AnimationManager\n   */\n  animations: {\n    nextForm: (OBJ_NextFormAnimationStep) => TriggerAnimationStep,\n    goToForm: (OBJ_GoToFormAnimationStep) => TriggerAnimationStep,\n  } & AnimationManager;\n\n  // isTouchDevice: boolean;\n  // animateNextFrame: void => void;\n  shapes: Object;\n\n  getCurrentForm: () => ?EquationForm;\n\n  /**\n   * @hideconstructor\n   */\n  constructor(\n    shapes: Object,\n    options: EQN_Equation = {},\n  ) {\n    let { color } = options;\n    if (color == null) {\n      color = shapes.defaultColor;\n    }\n    let { dimColor } = options;\n    if (dimColor == null) {\n      dimColor = shapes.defaultDimColor.slice();\n    }\n    const defaultFont = {\n      family: 'Times New Roman',\n      style: 'normal',\n      size: 0.2,\n      weight: '200',\n      color,\n    };\n    const defaultOptions = {\n      color,\n      dimColor,\n      position: new Point(0, 0),\n      scale: 0.7,\n      formDefaults: {\n        alignment: {\n          fixTo: new Point(0, 0),\n          xAlign: 'left',\n          yAlign: 'baseline',\n        },\n        elementMods: {},\n      },\n      elements: {},\n      forms: {},\n      // formSeries: {},\n      formRestart: null,\n      limits: shapes.limits,\n      touchBorder: 'rect',\n      transform: new Transform('Equation').scale(1, 1).rotate(0).translate(0, 0),\n    };\n\n    const optionsToUse = joinObjectsWithOptions({ except: ['font'] }, {}, defaultOptions, options);\n    if (options.font instanceof FigureFont) {\n      optionsToUse.font = options.font;\n    } else if (options.font != null) {\n      optionsToUse.font = new FigureFont(\n        joinObjects({}, defaultFont, options.font),\n      );\n    } else {\n      optionsToUse.font = new FigureFont(defaultFont);\n    }\n    if (optionsToUse.transform != null) {\n      optionsToUse.transform = getTransform(optionsToUse.transform);\n    }\n\n    optionsToUse.formDefaults.alignment.fixTo = parsePoint(\n      optionsToUse.formDefaults.alignment.fixTo,\n      optionsToUse.formDefaults.alignment.fixTo,\n    );\n    // optionsToUse.defaultFormAlignment.fixTo = parsePoint(\n    //   optionsToUse.defaultFormAlignment.fixTo,\n    //   optionsToUse.defaultFormAlignment.fixTo,\n    // );\n    if (optionsToUse.formRestart != null\n      && optionsToUse.formRestart.pulse != null) {\n      optionsToUse.formRestart.pulse = joinObjects({}, {\n        scale: 1.1,\n        duration: 1,\n      }, optionsToUse.formRestart.pulse);\n    }\n\n    super(optionsToUse);\n    // if (optionsToUse.transform != null) {\n    //   this.setTransform(getTransform(optionsToUse.transform));\n    // }\n    this.shapes = shapes;\n    this.setColor(optionsToUse.color);\n    this.dimColor = optionsToUse.dimColor;\n    // this.touchBorder = 'rect';\n    // this.border = 'children';\n    // this.isTouchDevice = isTouchDevice;\n    // this.animateNextFrame = animateNextFrame;\n\n    // Set default values\n    this.eqn = {\n      forms: {},\n      currentForm: '',\n      // currentSubForm: '',\n      // subFormPriority: ['base'],\n      formSeries: { base: [] },\n      currentFormSeries: [],\n      currentFormSeriesName: '',\n      scale: optionsToUse.scale,\n      // defaultFormAlignment: optionsToUse.defaultFormAlignment,\n      formDefaults: {\n        alignment: optionsToUse.formDefaults.alignment,\n        elementMods: optionsToUse.formDefaults.elementMods,\n        // animation: optionsToUse.formDefaults.animation,\n        duration: optionsToUse.formDefaults.duration,\n        translation: optionsToUse.formDefaults.translation,\n      },\n      functions: new EquationFunctions(\n        this.elements,\n        this.addElementFromKey.bind(this),\n        this.getExistingOrAddSymbol.bind(this),\n      ),\n      symbols: new EquationSymbols(this.shapes, this.color),\n      font: optionsToUse.font,\n      // fontText: optionsToUse.fontText,\n      isAnimating: false,\n      descriptionElement: null,\n      descriptionPosition: new Point(0, 0),\n      formRestart: optionsToUse.formRestart,\n    };\n\n    if (optionsToUse.elements != null) {\n      this.addElements(optionsToUse.elements);\n    }\n\n    if (optionsToUse.phrases != null) {\n      this.addPhrases(optionsToUse.phrases);\n    }\n\n    if (optionsToUse.forms != null) {\n      this.addForms(optionsToUse.forms);\n    }\n\n    if (optionsToUse.initialForm != null) {\n      this.initialForm = optionsToUse.initialForm;\n    }\n\n    if (optionsToUse.formSeries != null) {\n      if (Array.isArray(optionsToUse.formSeries)) {\n        this.eqn.formSeries = { base: optionsToUse.formSeries };\n        this.eqn.currentFormSeries = this.eqn.formSeries.base;\n        this.eqn.currentFormSeriesName = 'base';\n      } else {\n        this.eqn.formSeries = optionsToUse.formSeries;\n        if (optionsToUse.defaultFormSeries != null) {\n          this.setFormSeries(optionsToUse.defaultFormSeries);\n        } else {\n          this.setFormSeries(Object.keys(this.eqn.formSeries)[0]);\n        }\n      }\n    } else {\n      this.eqn.formSeries = { base: Object.keys(this.eqn.forms).slice() };\n      this.eqn.currentFormSeries = this.eqn.formSeries.base;\n      this.eqn.currentFormSeriesName = 'base';\n    }\n\n    this.animations.goToForm = (...opt) => {\n      const o = joinObjects({}, {\n        element: this,\n        duration: 1,\n      }, ...opt);\n      if (o.callback != null) {\n        o.done = o.callback;\n      }\n      o.callback = () => {\n        const currentForm = this.getCurrentForm();\n        if (currentForm != null) {\n          if (o.start == null) {\n            o.start = currentForm.name;\n          }\n          if (o.target == null) {\n            o.target = currentForm.name;\n          }\n        }\n        this.showForm(o.start);\n        this.goToForm(joinObjects({}, o, {\n          form: o.target,\n          callback: null,\n          delay: 0,\n        }));\n        return this.getRemainingAnimationTime(['_Equation', '_EquationColor']);\n      };\n      return new TriggerAnimationStep(o);\n    };\n    this.animations.customSteps.push({\n      step: this.animations.goToForm.bind(this),\n      name: 'goToForm',\n    });\n\n    this.animations.nextForm = (...opt) => {\n      const o = joinObjects({}, {\n        element: this,\n        duration: 1,  // need a non zero duration so trigger can incorporate the new duration\n      }, ...opt);\n      if (o.callback != null) {\n        o.done = o.callback;\n      }\n      o.callback = () => {\n        this.nextForm(joinObjects({}, o, {\n          callback: null,\n          delay: 0,\n        }));\n        return this.getRemainingAnimationTime(['_Equation', '_EquationColor']);\n      };\n      return new TriggerAnimationStep(o);\n    };\n    this.animations.customSteps.push({\n      step: this.animations.nextForm.bind(this),\n      name: 'nextForm',\n    });\n  }\n\n  setFigure(figure: OBJ_FigureForElement) {\n    super.setFigure(figure);\n    if (this.initialForm != null) {\n      this.showForm(this.initialForm);\n    }\n  }\n\n  _getStateProperties(options: Object) {  // eslint-disable-line class-methods-use-this\n    return [...super._getStateProperties(options),\n      'eqn.currentForm',\n      // 'eqn.currentSubForm',\n      'eqn.isAnimating',\n      'eqn.currentFormSeries',\n      'eqn.currentFormSeriesName',\n    ];\n  }\n\n  _getStatePropertiesMin() {\n    return [\n      ...super._getStatePropertiesMin(),\n      'eqn.currentForm',\n      // 'eqn.currentSubForm',\n    ];\n  }\n\n  // animateToState(\n  //   state: Object,\n  //   options: Object,\n  //   independentOnly: boolean = false,\n  //   // countStart: () => void,\n  //   // countEnd: () => void,\n  // ) {\n  //   super.animateToState(state, options, independentOnly);\n  //   if (this.eqn.currentForm !== state.eqn.currentForm) {\n  //     // countStart();\n  //     this.goToForm({ name: state.eqn.currentForm, callback: countEnd });\n  //   }\n  // }\n\n  /**\n    * Set the current form series to 'name'\n   */\n  setFormSeries(name: string) {\n    if (this.eqn.formSeries[name] != null) {\n      this.eqn.currentFormSeries = this.eqn.formSeries[name];\n      this.eqn.currentFormSeriesName = name;\n    }\n  }\n\n  /**\n    * Get the current form series name\n   */\n  getFormSeries(): string {\n    return this.eqn.currentFormSeriesName;\n  }\n\n  layoutForms(forms: 'none' | 'current' | 'all') {\n    if (forms === 'none') {\n      return;\n    }\n    const arrange = (formName) => {\n      const form = this.eqn.forms[formName];\n      const {\n        scale, xAlign, yAlign, fixTo,\n      } = form.arranged;\n      form.arrange(scale, xAlign, yAlign, fixTo);\n    };\n    if (forms === 'current') {\n      arrange(this.eqn.currentForm);\n      return;\n    }\n    Object.keys(this.eqn.forms).forEach((formName) => {\n      arrange(formName);\n    });\n    this.showForm(this.eqn.currentForm);\n  }\n\n  /**\n   * Update text of equation element or elements\n   *\n   * @param {EQN_UpdateElementText} elements elements to update\n   * @param {'all' | 'current' | 'none'} [layoutForms] which forms to re-layout\n   * with the updated text\n   */\n  updateElementText(\n    elements: EQN_UpdateElementText,\n    layoutForms: 'all' | 'current' | 'none' = 'none',\n  ) {\n    Object.keys(elements).forEach((elementName) => {\n      const e = this.getElement(elementName);\n      if (e == null) {\n        return;\n      }\n      const col = e.color.slice();\n      e.custom.updateText({ text: elements[elementName] });\n      e.setColor(col);\n    });\n    this.layoutForms(layoutForms);\n  }\n\n  makeTextElem(\n    options: {\n      text?: string,\n      font?: FigureFont | OBJ_Font,\n      style?: 'italic' | 'normal',\n      weight?: 'normal' | 'bold' | '100' | '200' | '300' | '400' | '500' | '600' | '700' | '800' | '900',\n      size?: number,\n      family?: string,\n      color?: TypeColor,\n      touchBorder?: TypeParsableBuffer | Array<Point>,\n      onClick?: () => void | 'string' | null,\n      isTouchable?: boolean,\n      mods?: Object,\n    },\n    defaultText: string = '',\n  ) {\n    let textToUse = defaultText;\n    if (options.text != null) {\n      textToUse = options.text;\n    }\n    const defaultFontDefinition = this.eqn.font.definition();\n    let fontDefinition = defaultFontDefinition;\n    if (options.font != null && options.font instanceof FigureFont) {\n      fontDefinition = options.font.definition();\n    } else {\n      fontDefinition = joinObjects(\n        {},\n        defaultFontDefinition,\n        {\n          style: options.style,\n          weight: options.weight,\n          family: options.family,\n          size: options.size,\n          color: options.color,\n        },\n        options.font,\n      );\n    }\n\n    if (\n      options.style == null\n      && (\n        (options.font != null && options.font.style == null)\n        || options.font == null\n      )\n    ) {\n      if (textToUse.match(/[A-Z,a-z,\\u0370-\\u03ff]/)) {\n        fontDefinition.style = 'italic';\n      } else {\n        fontDefinition.style = 'normal';\n      }\n    }\n    if (fontDefinition.color == null) {\n      fontDefinition.color = this.color;\n    }\n    // console.log(textToUse, fontDefinition)\n    // const font = new FigureFont(fontDefinition);\n    const p = this.shapes.text(\n      {\n        text: {\n          text: textToUse,\n          touchBorder: 0,\n          // touchBorder: options.touchBorder == null ? 0 : options.touchBorder,\n        },\n        position: new Point(0, 0),\n        font: fontDefinition,\n        xAlign: 'left',\n        yAlign: 'baseline',\n        touchBorder: 'buffer',\n        mods: {\n          dimColor: this.dimColor.slice(),\n        },\n        // border: 'draw',\n        // touchBorder: options.touchBorder == null ? 'buffer' : options.touchBorder,\n        // defaultTextTouchBorder: options.defaultTextTouchBorder,\n      },\n    );\n    if (options.touchBorder != null) {\n      p.touchBorder = options.touchBorder;\n    }\n    if (options.isTouchable != null) {\n      p.isTouchable = options.isTouchable;\n    }\n    if (options.onClick != null) {\n      p.onClick = options.onClick;\n    }\n    if (options.mods != null) {\n      p.setProperties(options.mods);\n    }\n    return p;\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  getTextFromKey(key: string) {\n    return key.replace(/^_*/, '').replace(/_.*/, '');\n  }\n\n  getExistingOrAddSymbol(symbol: string | Object) {\n    if (typeof symbol === 'string') {\n      return this.getExistingOrAddSymbolFromKey(symbol, {});\n    }\n    const [key, params] = Object.entries(symbol)[0];  // $FlowFixMe\n    return this.getExistingOrAddSymbolFromKey(key, params);\n  }\n\n  // 'text'\n  // 'text_id'\n  // 'id_symbol'\n  // 'id_id_symbol'\n  // 'symbol'\n  getExistingOrAddSymbolFromKey(key: string, options: Object = {}) {\n    const existingElement = this.getElement(key);\n    if (existingElement != null) {\n      return existingElement;\n    }\n    // console.log(this.name, key, this.dimColor.slice())\n    // Check if the options has a symbol definition\n    if (options.symbol != null && typeof options.symbol === 'string') {\n      // debugger;\n      const symbol = this.makeSymbolElem(options);\n      if (symbol != null) {\n        // symbol.dimColor = this.dimColor.slice();\n        this.add(key, symbol);\n        return symbol;\n      }\n    }\n    // Check the key is a symbol\n    const cleanKey = key.replace(/^_*/, '');\n    // console.log(cleanKey)\n    let symbol = this.eqn.symbols.get(cleanKey, options);\n    if (symbol != null) {\n      // symbol.dimColor = this.dimColor.slice();\n      if (symbol.color[3] > 0.01) {\n        symbol.setColor(this.color);\n      }\n      if (options.mods != null) {\n        symbol.setProperties(options.mods);\n      }\n      this.add(key, symbol);\n      return symbol;\n    }\n    const ending = cleanKey.match(/_[^_]*$/);\n    // console.log(ending)\n    if (ending != null) {\n      symbol = this.eqn.symbols.get(ending[0].replace(/_/, ''), options);\n      if (symbol != null) {\n        // symbol.dimColor = this.dimColor.slice();\n        if (symbol.color[3] > 0.01) {\n          symbol.setColor(this.color);\n        }\n        if (options.mods != null) {\n          symbol.setProperties(options.mods);\n        }\n        this.add(key.replace(/_[^_]*$/, ''), symbol);\n        return symbol;\n      }\n    }\n    return null;\n  }\n\n  addElementFromKey(key: string, options: Object = {}) {\n    let element = this.getExistingOrAddSymbolFromKey(key, options);\n    if (element != null) {\n      return element;\n    }\n    const cleanKey = key.replace(/^_*/, '');\n    const text = cleanKey.replace(/_.*/, '');\n    element = this.makeTextElem(joinObjects({ text }, options));\n    this.add(key, element);\n    return element;\n  }\n\n  // addElementFromObject(key: string, options: Object) {\n  //   if (typeof key !== 'string') {\n  //     return null;\n  //   }\n  //   const existingElement = this.getElement(key);\n  //   if (existingElement != null) {\n  //     return existingElement;\n  //   }\n  //   const text = this.getTextFromKey(key);\n  //   const element = this.makeTextElem({ text });\n  //   this.add(key, element);\n  //   return element;\n  // }\n\n  makeSymbolElem(\n    options: {\n      symbol: string\n    } & TypeSymbolOptions,\n  ) {\n    let symbol = this.eqn.symbols.get(options.symbol, options);\n    if (symbol == null) {\n      symbol = this.makeTextElem({\n        text: `Symbol ${options.symbol} not valid`,\n      });\n    }\n    if (options.color == null && symbol.color[3] > 0.01) {\n      symbol.setColor(this.color);\n    }\n    symbol.dimColor = this.dimColor.slice();\n    if (options.mods != null) {\n      symbol.setProperties(options.mods);\n    }\n    return symbol;\n  }\n\n  /**\n   * Add elements to equation.\n   */\n  addElements(\n    elems: EQN_EquationElements,\n  ) {\n    // Go through each element and add it\n    Object.keys(elems).forEach((key) => {\n      // const [key, elem] = entry;\n      const elem = elems[key];\n      if (typeof elem === 'string') {\n        if (!(key.startsWith('space') && key.startsWith(' '))) {\n          this.add(key, this.makeTextElem({ text: elem }));\n        }\n      } else if (elem instanceof FigureElementPrimitive) {\n        this.add(key, elem);\n      } else if (elem instanceof FigureElementCollection) {\n        this.add(key, elem);\n      } else {\n        let figureElem; // $FlowFixMe\n        if (elem.symbol != null && typeof elem.symbol === 'string') {\n          // console.log(elem.symbol)\n          // $FlowFixMe\n          figureElem = this.makeSymbolElem(elem);\n        } else {\n          // $FlowFixMe\n          figureElem = this.makeTextElem(elem, this.getTextFromKey(key));\n        }\n        if (figureElem != null) {\n          if (elem.mods != null) {\n            figureElem.setProperties(elem.mods);\n          }\n          this.add(key, figureElem);\n        }\n      }\n    });\n\n    const fullLineHeightPrimitive = this.makeTextElem({ text: 'gh' });\n    const form = this.createForm({ elem: fullLineHeightPrimitive });\n    form.content = [this.eqn.functions.contentToElement(fullLineHeightPrimitive)];\n    form.arrange(\n      this.eqn.scale,\n      'left',\n      'baseline',\n      new Point(0, 0),\n    );\n    this.eqn.functions.fullLineHeight = form;\n\n    this.setFirstTransform(this.transform);\n  }\n\n  addDescriptionElement(\n    descriptionElement: FigureElementPrimitive | null = null,\n    descriptionPosition: Point = new Point(0, 0),\n  ) {\n    this.eqn.descriptionElement = descriptionElement;\n    this.eqn.descriptionPosition = descriptionPosition;\n    if (this.eqn.descriptionElement) {\n      this.eqn.descriptionElement\n        .setPosition(this.getPosition('figure')\n          .add(descriptionPosition));\n    }\n  }\n\n  setPosition(pointOrX: TypeParsablePoint | number, y: number = 0) {\n    super.setPosition(pointOrX, y);\n    const position = this.getPosition('figure');\n    // console.log(this.eqn, this.eqn.descriptionElement)\n    if (this.eqn.descriptionElement != null) {\n      this.eqn.descriptionElement.setPosition(position.add(this.eqn.descriptionPosition));\n    }\n  }\n\n  // scaleForm(name: string, scale: number, subForm: string = 'base') {\n  //   // console.log(name, this.form, formType, this.form[name][formType])\n  //   if (name in this.eqn.forms) {\n  //     if (subForm in this.eqn.forms[name]) {\n  //       this.eqn.forms[name][subForm].arrange(\n  //         scale,\n  //         this.eqn.formAlignment.xAlign,\n  //         this.eqn.formAlignment.yAlign,\n  //         this.eqn.formAlignment.fixTo,\n  //       );\n  //     }\n  //   }\n  // }\n\n  // scale(scale: number) {\n  //   Object.keys(this.form).forEach((name) => {\n  //     Object.keys(this.form[name]).forEach((formType) => {\n  //       if (formType !== 'name') {\n  //         this.scaleForm(name, scale, formType);\n  //       }\n  //     });\n  //   });\n  // }\n\n  addPhrases(phrases: { [phraseName: string]: TypeEquationPhrase }) {\n    Object.keys(phrases).forEach((phraseName) => {\n      const phrase = phrases[phraseName];\n      this.eqn.functions.phrases[phraseName] = phrase;\n    });\n  }\n\n  /**\n   * Add forms to equation.\n   */\n  addForms(forms: EQN_Forms) {\n    const isFormString = form => typeof form === 'string';\n    const isFormArray = form => Array.isArray(form);\n    const isFormMethodDefinition = (form) => {\n      if (isFormString(form) || isFormArray(form)) {\n        return false;\n      }\n      if (form != null && typeof form === 'object') {\n        // $FlowFixMe\n        const keys = Object.keys(form);\n        if (keys.length === 1 && keys[0] in this.eqn.functions) {\n          return true;\n        }\n      }\n      return false;\n    };\n    // eslint-disable-next-line max-len\n    const isFormElements = form => (form instanceof Elements || form instanceof BaseAnnotationFunction);\n    const addFormNormal = (name: string, form: TypeEquationForm) => {\n      // $FlowFixMe\n      const formContent = [this.eqn.functions.contentToElement(form)];\n      this.addForm(name, formContent);\n    };\n    const addFormFullObject = (name: string, form: TypeEquationForm) => {\n      // $FlowFixMe\n      const formContent = [this.eqn.functions.contentToElement(form.content)];\n      const {   // $FlowFixMe\n        elementMods, duration, alignment, scale, // $FlowFixMe\n        description, modifiers, translation,  // $FlowFixMe\n        fromForm, onShow, onTransition,\n      } = form;\n      const options = {\n        elementMods,\n        alignment,\n        scale,\n        description,\n        modifiers,\n        fromForm,\n        duration,\n        translation,\n        onShow,\n        onTransition,\n      };\n      // $FlowFixMe\n      this.addForm(name, formContent, options);\n    };\n\n    Object.keys(forms).forEach((name) => {\n      const form: TypeEquationForm = forms[name];\n      if (isFormString(form) || isFormArray(form)\n        || isFormMethodDefinition(form) || isFormElements(form)\n      ) {\n        addFormNormal(name, form);\n      } else {\n        addFormFullObject(name, form);\n      }\n    });\n    if (this.initialForm == null && Object.keys(this.eqn.forms).length > 0) {\n      // eslint-disable-next-line prefer-destructuring\n      this.initialForm = Object.keys(this.eqn.forms)[0];\n    }\n  }\n\n  checkFixTo(\n    fixTo: FigureElementCollection\n          | FigureElementPrimitive\n          | string | Point | null,\n  ): FigureElementPrimitive | FigureElementCollection | Point {\n    if (typeof fixTo === 'string') {\n      const element = getFigureElement(this, fixTo);\n      if (element != null) {\n        return element;\n      }\n      return new Point(0, 0);\n    }\n    if (fixTo instanceof FigureElementPrimitive\n      || fixTo instanceof FigureElementCollection\n      || fixTo instanceof Point\n    ) {\n      return fixTo;\n    }\n    return new Point(0, 0);\n  }\n\n  createForm(\n    elements: { [elementName: string]: FigureElementPrimitive |\n                                       FigureElementCollection }\n    = this.elements,\n  ) {\n    return new EquationForm(\n      elements,\n      {\n        getAllElements: this.getChildren.bind(this),\n        hideAll: this.hideAll.bind(this),\n        show: this.show.bind(this),\n        showOnly: this.showOnly.bind(this),\n        stop: this.stopEquationAnimating.bind(this),\n        getElementTransforms: this.getElementTransforms.bind(this),\n        setElementTransforms: this.setElementTransforms.bind(this),\n        animateToTransforms: this.animateToTransforms.bind(this),\n      },\n    );\n  }\n\n  stopEquationAnimating(how: 'complete' | 'cancel' = 'cancel') {\n    this.stopAnimating(how, '_Equation', true);\n    this.stopAnimating(how, '_EquationColor', true);\n    this.stopPulsing(how);\n  }\n\n  addForm(\n    name: string,\n    content: Array<ElementInterface>,\n    options: {\n      // subForm?: string,\n      scale?: number,\n      alignment?: EQN_FormAlignment,\n      description?: string,\n      modifiers?: Object,\n      elementMods?: {\n        [elementName: string]: Object,\n      },\n      onTransition?: null | string | (() => void),\n      onShow?: null | string | (() => void),\n      // animation?: {\n      duration?: number,\n      translation?: { [elementName: string]: EQN_TranslationStyle },\n      // },\n      fromForm: {\n        [formName: string]: {\n          onTransition?: null | string | (() => void),\n          onShow?: null | string | (() => void),\n          duration?: number,\n          translation?: { [elementName: string]: EQN_TranslationStyle },\n          elementMods?: {\n            [elementName: string]: Object,\n          },\n        },\n      },\n    } = {},\n  ) {\n    // if (!(name in this.eqn.forms)) {\n    //   // $FlowFixMe   - its ok for this to start undefined, it will be filled.\n    //   this.eqn.forms[name] = {};\n    // }\n    const defaultOptions = joinObjects({}, {\n      elementMods: {},\n      description: '',\n      modifiers: {},\n      scale: this.eqn.scale,\n      // animation: {\n      duration: undefined,    // use null for velocities\n      onStart: null,\n      // },\n      fromForm: {},\n      onShow: null,\n      onTransition: null,\n    }, this.eqn.formDefaults);\n    let optionsToUse = defaultOptions;\n    if (options) {\n      optionsToUse = joinObjects({}, defaultOptions, options);\n    }\n    const {\n      description, modifiers, fromForm,\n      onShow, onTransition, duration, translation,\n    } = optionsToUse;\n    // this.eqn.forms[name].name = name;\n    // const form = this.eqn.forms[name];\n    // form[subForm] = this.createForm();\n    const form = this.createForm();\n    this.eqn.forms[name] = form;\n    form.description = description;\n    form.modifiers = modifiers;\n    form.name = name;\n    form.duration = duration;\n    form.translation = translation;\n    // form.animation = animation;\n    form.fromForm = fromForm;\n    form.onShow = onShow;\n    form.onTransition = onTransition;\n\n    // Populate element mods\n    form.elementMods = {};\n\n    const transformElementMods = (elementMods) => {\n      const newMods = {};\n      Object.keys(elementMods).forEach((elementName) => {\n        const mods = elementMods[elementName];\n        const figureElement = getFigureElement(this, elementName);\n        if (figureElement != null) {\n          newMods[elementName] = { element: figureElement, mods };\n        }\n      });\n      return newMods;\n    };\n\n    const transformTranslation = (trans) => {\n      const newTranslation = {};\n      Object.keys(trans).forEach((elementName) => {\n        const figureElement = getFigureElement(this, elementName);\n        const mods = trans[elementName];\n        let direction;\n        let style;\n        let mag;\n        if (Array.isArray(mods)) {\n          [style, direction, mag] = mods;\n        } else {\n          ({ style, direction, mag } = mods);\n        }\n        if (figureElement != null) {\n          newTranslation[elementName] = {\n            element: figureElement, style, direction, mag,\n          };\n        }\n      });\n      return newTranslation;\n    };\n\n    form.elementMods = transformElementMods(optionsToUse.elementMods);\n    if (form.translation != null) {\n      form.translation = transformTranslation(form.translation);\n    }\n    if (form.fromForm != null) {\n      Object.keys(form.fromForm).forEach((fromFormKey) => {\n        const f = form.fromForm[fromFormKey];\n        if (f.elementMods != null) {\n          f.elementMods = transformElementMods(f.elementMods);\n        }\n        if (f.translation != null) { // $FlowFixMe\n          f.translation = transformTranslation(f.translation);\n        }\n      });\n    }\n\n    optionsToUse.alignment.fixTo = this.checkFixTo(optionsToUse.alignment.fixTo);\n    form.content = content;\n    form.arrange(\n      optionsToUse.scale,\n      optionsToUse.alignment.xAlign,\n      optionsToUse.alignment.yAlign,\n      optionsToUse.alignment.fixTo,\n    );\n\n    // // make the first form added also equal to the base form as always\n    // // need a base form for some functions\n    // if (this.eqn.forms[name].base === undefined) {\n    //   const baseOptions = joinObjects({}, optionsToUse);\n    //   baseOptions.subForm = 'base';\n    //   this.addForm(name, content, baseOptions);\n    // }\n\n    if (this.eqn.currentForm === '') {\n      this.eqn.currentForm = name;\n    }\n    // if (this.eqn.currentSubForm === '') {\n    //   this.eqn.currentSubForm = 'base';\n    // }\n  }\n\n  /**\n   * Get the current equation form\n   */\n  getCurrentForm(): ?EquationForm {\n    if (this.eqn.forms[this.eqn.currentForm] == null) {\n      return null;\n    }\n    // if (this.eqn.forms[this.eqn.currentForm][this.eqn.currentSubForm] == null) {\n    //   return null;\n    // }\n    return this.eqn.forms[this.eqn.currentForm];\n  }\n\n  render(animationStop: boolean = true) {\n    const form = this.getCurrentForm();\n    if (form != null) {\n      form.setPositions();\n      form.showHide(0, 0, null, animationStop);\n      this.show();\n      // form.setPositions();\n      form.applyElementMods();\n      // this.updateDescription();\n    }\n  }\n\n  /**\n   * Set current equation form - Note, this does not show the form.\n   */\n  setCurrentForm(\n    formOrName: EquationForm | string,\n    // subForm: string = 'base',\n  ) {\n    if (typeof formOrName === 'string') {\n      this.eqn.currentForm = '';\n      // this.eqn.currentSubForm = '';\n      if (formOrName in this.eqn.forms) {\n        this.eqn.currentForm = formOrName;\n        // if (subForm in this.eqn.forms[formOrName]) {\n        //   this.eqn.currentSubForm = subForm;\n        // }\n      }\n    } else {\n      this.eqn.currentForm = formOrName.name;\n      // this.eqn.currentSubForm = formOrName.subForm;\n    }\n  }\n\n  /**\n   * Show equation form\n   */\n  showForm(\n    formOrName: EquationForm | string = this.eqn.currentForm,\n    // subForm: ?string = null,\n    animationStop: boolean = true,\n    // showCollection: boolean = true,\n  ) {\n    super.show();\n    // this.custom.settingForm = true;\n    let form = formOrName;\n    if (typeof formOrName === 'string') {\n      form = this.getForm(formOrName);\n    }\n    if (form) {\n      this.setCurrentForm(form);\n      this.render(animationStop);         // $FlowFixMe\n      this.fnMap.exec(form.onTransition); // $FlowFixMe\n      this.fnMap.exec(form.onShow);\n    }\n    // this.custom.settingForm = false;\n  }\n\n  showAll() {\n    this.showForm();\n  }\n\n  // show(\n  //   toShow: FigureElementPrimitive | FigureElementCollection | string\n  //     | Array<FigureElementPrimitive | FigureElementCollection | string> = [],\n  // ) {\n  //   // if (!this.custom.settingForm) {\n  //   //   if (Array.isArray(toShow) && toShow.length === 0) {\n  //   //     // console.log(this.eqn.currentForm)\n  //   //     this.showForm(this.eqn.currentForm, true, false);\n  //   //     return;\n  //   //   }\n  //   // }\n  //   super.show(toShow);\n  // }\n\n  /**\n   * Get an equation form object from a form name\n   */\n  getForm(\n    formOrName: string | EquationForm,\n    // subForm: ?string,\n  ): null | EquationForm {\n    if (formOrName instanceof EquationForm) {\n      return formOrName;\n    }\n    if (formOrName in this.eqn.forms) {\n      // let formTypeToUse = subForm;\n      // if (formTypeToUse == null) {\n      //   const possibleFormTypes     // $FlowFixMe\n      //     = this.eqn.subFormPriority.filter(fType => fType in this.eqn.forms[formOrName]);\n      //   if (possibleFormTypes.length) {\n      //     // eslint-disable-next-line prefer-destructuring\n      //     formTypeToUse = possibleFormTypes[0];\n      //   }\n      // }\n      // if (formTypeToUse != null) {\n      //   return this.eqn.forms[formOrName][formTypeToUse];\n      // }\n      return this.eqn.forms[formOrName];\n    }\n    return null;\n  }\n\n  /**\n   * Start an animation to an equation form\n   */\n  goToForm(optionsIn: EQN_EquationGoToForm = {}) {\n    const defaultOptions = {\n      duration: null,\n      prioritizeFormDuration: true,\n      delay: 0,\n      fromWhere: '_current',\n      animate: 'dissolve',\n      callback: null,\n      ifAnimating: {\n        skipToTarget: true,\n        cancelGoTo: true,\n      },\n    };\n    const options = joinObjects(defaultOptions, optionsIn);\n    if (this.eqn.isAnimating) {\n      if (options.ifAnimating.skipToTarget) {\n        // this.stopEquationAnimating('complete', '_Equation', true);\n        // this.stopEquationAnimating('complete', '_EquationColor', true);\n        // this.stopEquationAnimatingPulsing();\n        this.stopEquationAnimating('complete');\n        // this.stopEquationAnimating('complete');\n        const currentForm = this.getCurrentForm();\n        if (currentForm != null) {\n          this.showForm(currentForm);\n        }\n      } else {\n        // this.stopEquationAnimating('cancel');\n        // this.stopEquationAnimating('cancel', '_Equation', true);\n        // this.stopEquationAnimating('cancel', '_EquationColor', true);\n        // this.stopEquationAnimatingPulsing();\n        this.stopEquationAnimating('cancel');\n      }\n      this.eqn.isAnimating = false;\n      if (options.ifAnimating.cancelGoTo) {\n        return;\n      }\n    }\n    // this.stopEquationAnimating(true, true);\n    // this.eqn.isAnimating = false;\n    // Get the desired form - preference is name, then series index,\n    // then next form in the current series\n    let form;\n    if (options.form != null) {\n      form = this.eqn.forms[options.form];\n    } else if (options.index != null) {\n      form = this.eqn.forms[this.eqn.currentFormSeries[options.index]];\n    } else if (this.eqn.currentFormSeries.length > 0) {\n      let index = 0;\n      const currentForm = this.getCurrentForm();\n      if (currentForm != null) {\n        index = this.eqn.currentFormSeries.indexOf(currentForm.name);\n        if (index < 0) {\n          index = 0;\n        }\n      }\n      let formIndex = index + 1;\n      if (formIndex === this.eqn.currentFormSeries.length) {\n        formIndex = 0;\n      }\n      form = this.eqn.forms[this.eqn.currentFormSeries[formIndex]];\n    }\n\n    if (form == null) {\n      return;\n    }\n\n    if (options.fromWhere === '_current') {\n      options.fromWhere = this.eqn.currentForm;\n    }\n    // if (form.onStart != null) {\n    // this.fnMap.exec(form.onTransition);\n    // }\n\n    let { duration } = options;\n    // console.log(options)\n    if (options.prioritizeFormDuration) {\n      if (form.duration !== undefined) {\n        duration = form.duration;\n      }\n      if (\n        options.fromWhere != null\n        && form.fromForm[options.fromWhere] != null\n        && form.fromForm[options.fromWhere].duration !== undefined\n      ) {\n        duration = form.fromForm[options.fromWhere].duration;\n      }\n    }\n    let { onTransition } = form;\n    if (\n      form.fromForm != null\n      && form.fromForm[options.fromWhere] != null\n      && form.fromForm[options.fromWhere].onTransition !== undefined\n    ) {\n      ({ onTransition } = form.fromForm[options.fromWhere]);\n    }\n\n    if (duration != null && duration > 0 && options.animate === 'dissolve') {\n      if (options.dissolveOutTime == null) {\n        options.dissolveOutTime = duration * 0.4;\n      }\n      if (options.dissolveInTime == null) {\n        options.dissolveInTime = duration * 0.4;\n      }\n      if (options.blankTime == null) {\n        options.blankTime = duration * 0.2;\n      }\n    } else {\n      if (options.dissolveOutTime == null) {\n        options.dissolveOutTime = 0.4;\n      }\n      if (options.dissolveInTime == null) {\n        options.dissolveInTime = 0.4;\n      }\n      if (options.blankTime == null) {\n        options.blankTime = 0.2;\n      }\n    }\n    if (duration === 0) {\n      this.showForm(form);\n      this.fnMap.exec(options.callback);\n      // if (options.callback != null) {\n      //   options.callback();\n      // }\n      // if (form.onShow != null) {\n      // this.fnMap.exec(form.onTransition);\n      // this.fnMap.exec(form.onShow);\n      // }\n    } else {\n      this.eqn.isAnimating = true;\n      this.fnMap.exec(onTransition);\n      const end = () => {\n        // $FlowFixMe\n        this.fnMap.exec(form.onShow);\n        // }\n        this.eqn.isAnimating = false;\n        this.fnMap.exec(options.callback);\n        // if (options.callback != null) {\n        //   options.callback();\n        // }\n      };\n      if (options.animate === 'move') {\n        // console.log('move', duration, options, subForm.duration)\n        // console.log('******************* animate')\n        form.animatePositionsTo(\n          options.delay,\n          options.dissolveOutTime,\n          duration,\n          options.dissolveInTime,\n          end,\n          options.fromWhere,\n          false,\n        );\n      } else if (options.animate === 'dissolveInThenMove') {\n        // console.log('move', duration, options, subForm.duration)\n        // console.log('******************* animate')\n        form.animatePositionsTo(\n          options.delay,\n          options.dissolveOutTime,\n          duration,\n          options.dissolveInTime,\n          end,\n          options.fromWhere,\n          true,\n        );\n      } else if (\n        options.animate === 'moveFrom'\n        && this.eqn.formRestart != null\n        && this.eqn.formRestart.moveFrom != null\n      ) {\n        const { moveFrom } = this.eqn.formRestart;\n        const target = this.getPosition();\n        let start = this.getPosition();\n        if (moveFrom instanceof Equation) {\n          moveFrom.showForm(form.name);\n        }\n        if (moveFrom instanceof FigureElementCollection) {\n          start = moveFrom.getPosition();\n        } else {  // $FlowFixMe\n          start = getPoint(this.eqn.formRestart.moveFrom);\n        }\n        const showFormCallback = () => {  // $FlowFixMe\n          this.showForm(form.name, false);\n        };\n        this.fnMap.add('_equationShowFormCallback', showFormCallback);\n        this.animations.new('_Equation')\n          .dissolveOut({ duration: options.dissolveOutTime })\n          .position({ target: start, duration: 0 })\n          .trigger({\n            callback: 'showFormCallback',\n            duration: 0.01,\n          })\n          .position({ target, duration })\n          .whenFinished(end)\n          .start();\n      } else if (\n        options.animate === 'pulse'\n        && this.eqn.formRestart != null\n        && this.eqn.formRestart.pulse != null\n      ) {\n        const { pulse } = this.eqn.formRestart;\n        const newEnd = () => {\n          this.pulse({\n            duration: pulse.duration,\n            scale: pulse.scale,\n            frequency: 0,\n            done: end,\n          });\n          if (pulse.element != null\n            && pulse.element instanceof Equation  // $FlowFixMe\n            && pulse.element.getCurrentForm().name === form.name\n          ) { // $FlowFixMe\n            pulse.element.pulse({ duration: pulse.duration, scale: pulse.scale });\n          }\n        };\n        form.allHideShow(\n          options.delay,\n          options.dissolveOutTime,\n          options.blankTime,\n          options.dissolveInTime,\n          newEnd,\n        );\n      } else {\n        // console.log('******************* hideshow')\n        form.allHideShow(\n          options.delay,\n          options.dissolveOutTime,\n          options.blankTime,\n          options.dissolveInTime,\n          end,\n        );\n      }\n      this.setCurrentForm(form);\n    }\n  }\n\n  getFormIndex(formToGet: EquationForm | string) {\n    const form = this.getForm(formToGet);\n    let index = -1;\n    if (form != null) {\n      index = this.eqn.currentFormSeries.indexOf(form.name);\n    }\n    return index;\n  }\n\n  /**\n   * Animate to previous form in the current form series\n   */\n  prevForm(\n    durationOrOptions: number | null | EQN_EquationGoToForm = null,\n    delay: number = 0,\n  ) {\n    const currentForm = this.getCurrentForm();\n    if (currentForm == null) {\n      return;\n    }\n    let index = this.getFormIndex(currentForm);\n    if (index > -1) {\n      index -= 1;\n      if (index < 0) {\n        index = this.eqn.currentFormSeries.length - 1;\n      }\n      if (typeof durationOrOptions === 'number' || durationOrOptions == null) {\n        this.goToForm({\n          index,\n          duration: durationOrOptions,\n          delay,\n          fromWhere: currentForm.name,\n        });\n      } else {\n        this.goToForm(joinObjects({\n          index,\n          fromWhere: currentForm.name,\n        }, durationOrOptions));\n      }\n    }\n  }\n\n  /**\n   * Animate to next form in the current form series\n   */\n  nextForm(\n    durationOrOptions: number | null | EQN_EquationGoToForm = null,\n    delay: number = 0,\n  ) {\n    let animate = 'move';\n\n    const currentForm = this.getCurrentForm();\n    if (currentForm == null) {\n      return;\n    }\n    let index = this.getFormIndex(currentForm);\n    if (index > -1) {\n      index += 1;\n      if (index > this.eqn.currentFormSeries.length - 1) {\n        index = 0;\n        const { formRestart } = this.eqn;\n        if (formRestart != null && formRestart.moveFrom != null) {\n          animate = 'moveFrom';\n        } else if (formRestart != null && formRestart.pulse != null) {\n          animate = 'pulse';\n        } else {\n          animate = 'dissolve';\n        }\n      }\n      if (typeof durationOrOptions === 'number' || durationOrOptions == null) {\n        this.goToForm({\n          index,\n          duration: durationOrOptions,\n          delay,\n          fromWhere: currentForm.name,\n          animate,\n        });\n      } else {\n        this.goToForm(joinObjects({\n          index,\n          animate,\n          fromWhere: currentForm.name,\n        }, durationOrOptions));\n      }\n    }\n  }\n\n  /**\n   * Start from previous form and animate to current form\n   */\n  replayCurrentForm(duration: number) {\n    if (this.eqn.isAnimating) {\n      // this.stopEquationAnimating(true, true);\n      this.stopEquationAnimating('complete');\n      // this.animations.cancel('complete');\n      // this.animations.cancel('complete');\n      this.eqn.isAnimating = false;\n      const currentForm = this.getCurrentForm();\n      if (currentForm != null) {\n        this.showForm(currentForm);\n      }\n      return;\n    }\n    // this.animations.cancel();\n    // this.animations.cancel();\n    // this.stopEquationAnimating();\n    this.stopEquationAnimating();\n    this.eqn.isAnimating = false;\n    this.prevForm(0);\n    this.nextForm(duration, 0.5);\n  }\n\n  animateToForm(\n    name: string,\n    duration: number | null = null,\n    delay: number = 0,\n    callback: null | string | (() => void) = null,\n  ) {\n    // this.stopEquationAnimatingColor(true, true);\n    // this.stopEquationAnimatingColor(true, true);\n    // this.stopEquationAnimating();\n    this.stopEquationAnimating();\n    // this.animations.cancel();\n    // this.animations.cancel();\n    const form = this.getForm(name);\n    if (form != null) {\n      form.animatePositionsTo(delay, 0.4, duration, 0.4, callback);\n    }\n    this.setCurrentForm(name);\n  }\n\n\n  changeDescription(\n    formOrName: EquationForm | string,\n    description: string = '',\n    modifiers: Object = {},\n    // subForm: string = 'base',\n  ) {\n    const form = this.getForm(formOrName);\n    if (form != null) {\n      form.description = `${description}`;\n      form.modifiers = modifiers;\n    }\n  }\n\n  getDescription(\n    formOrName: EquationForm | string,\n    // subForm: string = 'base',\n  ) {\n    const form = this.getForm(formOrName);\n    if (form != null && form.description != null) {\n      return html.applyModifiers(form.description, form.modifiers);\n    }\n    return '';\n  }\n\n  // updateDescription(\n  //   formOrName: EquationForm | string | null = null,\n  //   subForm: string = 'base',\n  // ) {\n  //   const element = this.eqn.descriptionElement;\n  //   if (element == null) {\n  //     return;\n  //   }\n  //   if (element.isShown === false) {\n  //     return;\n  //   }\n  //   let form = null;\n  //   if (formOrName == null) {\n  //     form = this.getCurrentForm();\n  //   } else if (typeof formOrName === 'string') {\n  //     form = this.getForm(formOrName, subForm);\n  //   } else {\n  //     form = formOrName;\n  //   }\n  //   if (form == null) {\n  //     return;\n  //   }\n  //   if (form.description == null) {\n  //     return;\n  //   }\n\n  //   const { drawingObject } = element;\n  //   if (drawingObject instanceof HTMLObject) {\n  //     drawingObject.change(\n  //       html.applyModifiers(form.description, form.modifiers),\n  //       element.lastDrawTransform.m(),\n  //     );\n  //     html.setOnClicks(form.modifiers);\n  //   }\n  // }\n}\n","// @flow\nimport {\n  Point, getMoveTime, Transform,\n} from '../../tools/g2';\n// import { roundNum } from '../../../tools/math';\nimport { duplicateFromTo, joinObjects } from '../../tools/tools';\nimport {\n  FigureElementPrimitive, FigureElementCollection,\n} from '../Element';\nimport { Element, Elements, BlankElement } from './Elements/Element';\n// eslint-disable-next-line import/no-cycle\nimport { getFigureElement } from './EquationFunctions';\n\nexport type TypeHAlign = 'left' | 'right' | 'center' | number;\nexport type TypeVAlign = 'top' | 'bottom' | 'middle' | 'baseline' | number;\nexport type TypeEquationForm = {\n  collection: FigureElementCollection;\n  createEq: (Array<Elements | Element | string>) => void;\n  arrange: (\n    number, TypeHAlign | null, TypeVAlign | null,\n    FigureElementPrimitive | FigureElementCollection | Point\n  ) => void;\n  dissolveElements: (\n    Array<FigureElementPrimitive | FigureElementCollection>,\n    boolean, number, number, ?(?boolean)) => void;\n  getElementsToShowAndHide: () => void;\n  showHide: (number, number, ?(?mixed)) => void;\n  hideShow: (number, number, ?(?mixed)) => void;\n  // animateTo: (\n  //   number, number,\n  //   FigureElementPrimitive | FigureElementCollection | Point,\n  //   ?(?mixed) => void,\n  //   'left' | 'center' | 'right', 'top' | 'bottom' | 'middle' | 'baseline',\n  // ) => void;\n  animatePositionsTo: (number, ?(?mixed) => void) => void;\n  description: string | null;\n  modifiers: Object;\n  type: string;\n  onShow: string | (() => void);\n  elementMods: {\n    [string]: {\n      element: FigureElementPrimitive | FigureElementCollection,\n      mods: Object,\n    }\n  };\n  time: number | null;\n} & Elements;\n\nexport type TypeCollectionMethods = {\n  getAllElements: () => Array<FigureElementPrimitive | FigureElementCollection>,\n  hideAll: () => void,\n  show: () => void,\n  showOnly: (Array<FigureElementPrimitive | FigureElementCollection>) => void,\n  stop(cancelled?: boolean, forceSetToEndOfPlan?: boolean): void;\n  getElementTransforms: () => { [string: string]: Transform },\n  setElementTransforms: ({ [string: string]: Transform }) => void,\n  animateToTransforms(\n    elementTransforms: Object,\n    time?: number,\n    delay?: number,\n    rotDirection?: number,\n    callback?: ?(string | ((?mixed) => void)),\n    name?: string,\n    easeFunction?: string | ((number) => number)): number,\n};\n\nexport type TypeElements = {\n  [string: string]: FigureElementCollection | FigureElementPrimitive;\n};\n\nexport type TypeElementTranslationOptions = {\n  [elementName: string]: {\n    element: FigureElementPrimitive | FigureElementCollection;\n    direction?: 'up' | 'down',\n    style: 'curved' | 'linear',\n    mag: number,\n  },\n};\nexport default class EquationForm extends Elements {\n  elements: { [string: string]: FigureElementCollection | FigureElementPrimitive };\n  collectionMethods: TypeCollectionMethods;\n  name: string;\n  elementMods: {\n    [elementName: string]: {\n      element: FigureElementPrimitive | FigureElementCollection;\n      mods: Object;\n    }\n  };\n\n  arranged: {\n    scale: number,\n    xAlign: TypeHAlign | null,\n    yAlign: TypeVAlign | null,\n    fixTo: FigureElementPrimitive | FigureElementCollection | Point,\n  };\n\n  // These properties are just saved in the form and not used by this class\n  // They are used by external classes using this form\n  description: string | null;\n  modifiers: Object;\n  onTransition: null | string | (() => void);\n  onShow: null | string | (() => void);\n  // subForm: string;\n  // animation: {\n  duration: ?number;\n  translation: TypeElementTranslationOptions;\n  // };\n\n  fromForm: {\n    [formName: string]: {\n      onTransition?: string | (() => void),\n      onShow?: string | (() => void),\n      // animation?: {\n      duration?: number,\n      translation?: TypeElementTranslationOptions,\n      // },\n      elementMods: {\n        [elementName: string]: {\n          element: FigureElementPrimitive | FigureElementCollection;\n          mods: Object;\n        }\n      },\n    },\n  };\n\n  constructor(\n    elements: TypeElements,\n    collectionMethods: TypeCollectionMethods,\n  ) {\n    super([]);\n    this.elements = elements;\n    this.collectionMethods = collectionMethods;\n    this.description = null;\n    this.modifiers = {};\n    this.elementMods = {};\n    this.onShow = null;\n    this.onTransition = null;\n    // this.duration = null;\n    // this.translation = {};\n    // this.animation = {};\n    this.fromForm = {};\n    // this.subForm = '';\n  }\n\n  getNamedElements() {\n    const namedElements = {};\n    this.collectionMethods.getAllElements().forEach((element) => {\n      namedElements[element.name] = element;\n    });\n    return namedElements;\n  }\n\n  _dup(\n    elements: TypeElements = this.elements,\n    collectionMethods: TypeCollectionMethods = this.collectionMethods,\n  ) {\n    const equationCopy = new EquationForm(elements, collectionMethods);\n    const namedElements = {};\n    collectionMethods.getAllElements().forEach((element) => {\n      namedElements[element.name] = element;\n    });\n    const newContent = [];\n    this.content.forEach((contentElement) => {\n      newContent.push(contentElement._dup(namedElements));\n    });\n    equationCopy.content = newContent;\n    duplicateFromTo(this, equationCopy, ['content', 'collectionMethods', 'form', 'elements']);\n    return equationCopy;\n  }\n\n  createEq(content: Array<Elements | Element | string>) {\n    const elements = [];\n    content.forEach((c) => {\n      if (typeof c === 'string') {\n        if (c.startsWith('space')) {\n          const spaceNum = parseFloat(c.replace(/space[_]*/, '')) || 0.03;\n          elements.push(new Element(new BlankElement(spaceNum)));\n        } else if (c.startsWith(' ')) {\n          const spaceNum = c.length * 0.03;\n          elements.push(new Element(new BlankElement(spaceNum)));\n        } else {\n          const figureElement = getFigureElement(this.elements, c);\n          if (figureElement) {\n            elements.push(new Element(figureElement));\n          }\n        }\n      } else {\n        elements.push(c._dup());\n      }\n      this.content = elements;\n    });\n    // this.content = content;\n  }\n\n  // An Equation collection is a flat collection of FigureElements.\n  //\n  // The form determines how elements are positioned relative to each other.\n  //\n  // A form of an equation takes the form's elements (a subset of the\n  // collection) and applies a translation and scale transformation. This\n  // aligns all the elements of a form relative to each other to render\n  // the desired form.\n  //\n  // Arranging a form of an equation goes through each element in the form\n  // and positions and scales it in the equation's vertex space.\n  // It also saves the locaiton and scale information in the form's element\n  // property.\n  //\n  // The elements are positioned relative to 0,0 in vertex space based on the\n  // fixTo, xAlign and yAlign parameters.\n  //\n  // fixTo can only be a point in the equation's vertex space, or a\n  // FigureElement in the equation.\n  //\n  // If fixTo is an element in the equation:\n  //    - the fixTo element is positioned at 0, 0, and all other elements\n  //      repositioned relative to that.\n  //    - The equation collection setPosition (or translation transform) can\n  //      then be used to position the equation in the figure (or relative\n  //      collection space)\n  //    - if xAlign is:\n  //        - 'center': the fixTo element is centered in x around (0, 0)\n  //        - 'right': the fixTo element right most point is at x = 0\n  //        - 'left': default - the fixTo element x position at 0\n  //    - if yAlign is:\n  //        - 'middle': the fixTo element is centered in y around (0, 0)\n  //        - 'bottom': the fixTo element bottom most point is at y = 0\n  //        - 'top': the fixTo element top most point is at y = 0\n  //        - 'baseline': default - the fixTo element y position at 0\n  //\n  // If fixTo is a Point, the equation is positioned at that point in the\n  // equation's vertex space.\n  //  - xAlign:\n  //    - 'left': The equation's left most element's left most point is at\n  //              Point.x\n  //    - 'right': The equation's right most element's right most point is at\n  //              Point.x\n  //    - 'center': The equation is centered horizontally around Point.x\n  //  - yAlign:\n  //    - 'baseline': The equation's baseline is at Point.y\n  //    - 'top': The equation's top most element's top most point is at Point.y\n  //    - 'bottom': The equation's top most element's top most point is at\n  //                Point.y\n  //    - 'middle': The equation is centered vertically around Point.y\n  //\n  arrange(\n    scale: number = 1,\n    xAlign: TypeHAlign | null = 'left',\n    yAlign: TypeVAlign | null = 'baseline',\n    fixTo: FigureElementPrimitive | FigureElementCollection | Point = new Point(0, 0),\n  ) {\n    this.arranged = {\n      scale,\n      xAlign,\n      yAlign,\n      fixTo,\n    };\n    const elementsInCollection = this.collectionMethods.getAllElements();\n    const elementsCurrentlyShowing = elementsInCollection.filter(e => e.isShown);\n    this.collectionMethods.hideAll();\n    this.collectionMethods.show();\n\n    super.calcSize(new Point(0, 0), scale);\n    this.setPositions();\n\n    let fixPoint = new Point(0, 0);\n    if (fixTo instanceof FigureElementPrimitive\n        || fixTo instanceof FigureElementCollection) {\n      const t = fixTo.transform.t();\n      if (t != null) {\n        fixPoint = t._dup();\n      }\n    } else {\n      fixPoint = new Point(-fixTo.x, -fixTo.y);\n    }\n\n    let w = this.width;\n    let h = this.height;\n    let a = this.ascent;\n    let d = this.descent;\n    let p = this.location._dup();\n\n    if (fixTo instanceof FigureElementPrimitive\n        || fixTo instanceof FigureElementCollection) {\n      // const rect = fixTo.getBoundingRect('local');\n      // const t = fixTo.getPosition('local');\n      // w = rect.width;\n      // h = rect.height;\n      // a = rect.top - t.y;\n      // d = t.y - rect.bottom;\n      // p = t._dup();\n      const t = fixTo.transform.t();\n      const s = fixTo.transform.s();\n      // console.log(fixTo.transform._dup())\n      // console.log(t, s, fixTo.name)\n      if (t != null && s != null) {\n        const rect = fixTo.getBoundingRect('draw');\n        // console.log(rect)\n        // const rect = getBoundingRect(fixTo.drawingObject.border);\n        w = rect.width * s.x;\n        h = rect.height * s.y;\n        a = rect.top * s.y - t.y;\n        d = t.y - rect.bottom * s.y;\n        p = t._dup();\n      }\n    }\n\n    if (xAlign === 'right') {\n      fixPoint.x += w;\n    } else if (xAlign === 'center') {\n      fixPoint.x += w / 2;\n    } else if (typeof xAlign === 'number') {\n      fixPoint.x += xAlign * w;\n    } else if (xAlign != null && xAlign.slice(-1)[0] === 'o') {\n      const offset = parseFloat(xAlign);\n      fixPoint.x += offset;\n    }\n\n    if (yAlign === 'top') {\n      fixPoint.y += p.y + a;\n    } else if (yAlign === 'bottom') {\n      fixPoint.y += p.y - d;\n    } else if (yAlign === 'middle') {\n      fixPoint.y += p.y - d + h / 2;\n    } else if (typeof yAlign === 'number') {\n      fixPoint.y += p.y - d + yAlign * h;\n    } else if (yAlign != null && yAlign.slice(-1)[0] === 'o') {\n      const offset = parseFloat(yAlign);\n      fixPoint.y += p.y + offset;\n    }\n\n    const delta = new Point(0, 0).sub(fixPoint);\n    if (delta.x !== 0 || delta.y !== 0) {\n      this.offsetLocation(delta);\n      this.setPositions();\n    }\n\n    this.collectionMethods.showOnly(elementsCurrentlyShowing);\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  dissolveElements(\n    elements: Array<FigureElementPrimitive | FigureElementCollection>,\n    dissolve: 'in' | 'out' = 'in',\n    delay: number = 0.01,\n    time: number = 1,\n    callback: (?string | ((boolean) => void)) = null,\n  ) {\n    if (elements.length === 0) {\n      if (callback) {\n        this.fnMap.exec(callback, false);\n        // callback(false);\n        return;\n      }\n    }\n    const count = elements.length;\n    let completed = 0;\n    const onFinish = (cancelled: boolean) => {\n      completed += 1;\n      if (completed === count) {\n        if (callback) {\n          // callback(cancelled);\n          this.fnMap.exec(callback, cancelled);\n        }\n      }\n    };\n    elements.forEach((e) => {\n      e.animations.addTo('_EquationColor')\n        .opacity({\n          dissolve, onFinish, duration: time, delay, completeOnCancel: true,\n        })\n        .start();\n    });\n  }\n\n  getElementsToShowAndHide() {\n    const allElements = this.collectionMethods.getAllElements();\n    const elementsShown = allElements.filter(e => e.isShown);\n    const elementsShownTarget = this.getAllElements();\n    const elementsToHide: Array<FigureElementPrimitive\n                                | FigureElementCollection> =\n       elementsShown.filter(e => elementsShownTarget.indexOf(e) === -1);\n    const elementsToShow: Array<FigureElementCollection | FigureElementPrimitive> =\n      elementsShownTarget.filter(e => elementsShown.indexOf(e) === -1);\n    return {\n      show: elementsToShow,\n      hide: elementsToHide,\n    };\n  }\n\n  render() {\n    this.hideShow();\n    this.setPositions();\n  }\n\n  showHide(\n    showTime: number = 0,\n    hideTime: number = 0,\n    callback: ?(?mixed) => void = null,\n    animationStop: boolean = true,\n  ) {\n    if (animationStop) {\n      this.collectionMethods.stop();\n    }\n    this.collectionMethods.show();\n    const { show, hide } = this.getElementsToShowAndHide();\n    if (showTime === 0) {\n      show.forEach((e) => {\n        e.showAll();\n      });\n    } else {\n      this.dissolveElements(show, 'in', 0.01, showTime, null);\n    }\n\n    if (hideTime === 0) {\n      hide.forEach(e => e.hide());\n    } else {\n      this.dissolveElements(hide, 'out', showTime, hideTime, callback);\n    }\n  }\n\n  hideShow(\n    showTime: number = 0,\n    hideTime: number = 0,\n    callback: ?(?mixed) => void = null,\n    animationStop: boolean = true,\n  ) {\n    if (animationStop) {\n      this.collectionMethods.stop();\n    }\n    this.collectionMethods.show();\n    const { show, hide } = this.getElementsToShowAndHide();\n    if (hideTime === 0) {\n      hide.forEach(e => e.hide());\n    } else {\n      this.dissolveElements(hide, 'out', 0.01, hideTime, null);\n    }\n    if (showTime === 0) {\n      show.forEach((e) => {\n        e.showAll();\n      });\n      if (callback != null) {\n        callback();\n      }\n    } else {\n      this.dissolveElements(show, 'in', hideTime, showTime, callback);\n    }\n  }\n\n  allHideShow(\n    delay: number = 0,\n    hideTime: number = 0.5,\n    blankTime: number = 0.5,\n    showTime: number = 0.5,\n    callback: ?(boolean) => void = null,\n  ) {\n    this.collectionMethods.stop();\n    const allElements = this.collectionMethods.getAllElements();\n    const elementsShown = allElements.filter(e => e.isShown);\n    const elementsToShow = this.getAllElements();\n    const elementsToDelayShowing = elementsToShow.filter(e => !e.isShown);\n    const elementsToShowAfterDissolve = elementsToShow.filter(e => e.isShown);\n    let cumTime = delay;\n\n    if (elementsToShow.length === 0 && elementsShown.length === 0) {\n      if (callback != null) {\n        callback(false);\n        return;\n      }\n    }\n\n    let dissolveOutCallback = () => {\n      this.setPositions();\n    };\n    if (elementsToShow.length === 0) {\n      dissolveOutCallback = (cancelled: boolean) => {\n        this.setPositions();\n        if (callback != null) {\n          callback(cancelled);\n        }\n      };\n    }\n\n    if (elementsShown.length > 0) {\n      this.dissolveElements(\n        elementsShown, 'out', delay, hideTime, dissolveOutCallback,\n      );\n      cumTime += hideTime;\n    } else {\n      this.setPositions();\n    }\n\n    this.applyElementMods();\n\n    const count = elementsToShow.length;\n    let completed = 0;\n    const onFinish = (cancelled: boolean) => {\n      completed += 1;\n      if (completed === count - 1) {\n        if (callback) {\n          callback(cancelled);\n        }\n      }\n    };\n    elementsToDelayShowing.forEach((e) => {\n      e.animations.addTo('_EquationColor')\n        .dissolveIn({\n          duration: showTime, onFinish, delay: cumTime + blankTime,\n        })\n        .start();\n    });\n    elementsToShowAfterDissolve.forEach((e) => {\n      e.animations.addTo('_EquationColor')\n        .dissolveIn({\n          duration: showTime, onFinish, delay: blankTime,\n        })\n        .start();\n    });\n  }\n\n  applyElementMods(fromWhere: null | string = null) {\n    const setProps = (elementMods) => {\n      Object.keys(elementMods).forEach((elementName) => {\n        const { element, mods } = elementMods[elementName];\n        if (element != null && mods != null) {\n          element.setProperties(mods);\n          if (mods.color != null) {\n            element.setColor(mods.color);\n          }\n          if (mods.opacity != null) {\n            element.setOpacity(mods.opacity);\n          }\n        }\n      });\n    };\n    setProps(this.elementMods);\n    if (\n      fromWhere != null\n      && fromWhere.length > 0\n      && this.fromForm[fromWhere] != null\n      && this.fromForm[fromWhere].elementMods != null\n    ) {\n      setProps(this.fromForm[fromWhere].elementMods);\n    }\n  }\n\n  // Check callback is being called\n  animatePositionsTo(\n    delay: number,\n    dissolveOutTime: number,\n    moveTime: number | null,\n    dissolveInTime: number,\n    callback: ?(string | ((?mixed) => void)) = null,\n    fromWhere: ?string = null,\n    dissolveInBeforeMove: boolean = false,\n  ) {\n    const allElements = this.collectionMethods.getAllElements();\n    this.collectionMethods.stop();\n    const elementsShownTarget = this.getAllElements();\n    elementsShownTarget.forEach((e) => {\n      if (e.opacity === 0.001) {\n        e.hide();\n        e.setOpacity(1);\n      } else {\n        e.setOpacity(1);\n      }\n    });\n\n    const elementsShown = allElements.filter(e => e.isShown);\n    const elementsToHide =\n      elementsShown.filter(e => elementsShownTarget.indexOf(e) === -1);\n    const elementsToShow =\n      elementsShownTarget.filter(e => elementsShown.indexOf(e) === -1);\n\n    const currentTransforms = this.collectionMethods.getElementTransforms();\n    this.setPositions();\n    const animateToTransforms = this.collectionMethods.getElementTransforms();\n\n    const elementsToMove = [];\n    const toMoveStartTransforms = [];\n    const toMoveStopTransforms = [];\n    Object.keys(animateToTransforms).forEach((key) => {\n      const currentT = currentTransforms[key];\n      const nextT = animateToTransforms[key];\n      if (!currentT.isEqualTo(nextT)) {\n        elementsToMove.push(key);\n        toMoveStartTransforms.push(currentT);\n        toMoveStopTransforms.push(nextT);\n      }\n    });\n\n    const toShowTransforms = {};\n    elementsToShow.forEach((element) => {\n      toShowTransforms[element.name] = element.transform._dup();\n    });\n\n    // Find move time to use. If moveTime is null, then a velocity is used.\n    let moveTimeToUse;\n    if (moveTime === null) {\n      moveTimeToUse = getMoveTime(\n        toMoveStartTransforms, toMoveStopTransforms, 0,\n        new Point(0.35, 0.35),      // 0.25 figure space per s\n        2 * Math.PI / 6,            // 60 per second\n        new Point(0.4, 0.4),            // 100% per second\n      );\n    } else {\n      moveTimeToUse = moveTime;\n    }\n    this.collectionMethods.setElementTransforms(currentTransforms);\n    this.collectionMethods.setElementTransforms(toShowTransforms);\n    let cumTime = delay;\n\n    let moveCallback = null;\n    let dissolveInCallback = null;\n    let dissolveOutCallback = null;\n\n    if (dissolveInBeforeMove) {\n      if (elementsToMove.length === 0 && elementsToShow.length === 0) {\n        dissolveOutCallback = callback;\n      } else if (elementsToMove.length === 0) {\n        dissolveInCallback = callback;\n      } else {\n        moveCallback = callback;\n      }\n    } else if (elementsToMove.length === 0 && elementsToShow.length === 0) {\n      dissolveOutCallback = callback;\n    } else if (elementsToShow.length === 0) {\n      moveCallback = callback;\n    } else {\n      dissolveInCallback = callback;\n    }\n\n    if (elementsToHide.length > 0) {\n      this.dissolveElements(elementsToHide, 'out', delay, dissolveOutTime, dissolveOutCallback);\n      cumTime += dissolveOutTime;\n    } else if (dissolveOutCallback != null) {\n      this.fnMap.exec(dissolveOutCallback);\n    }\n\n    this.applyElementMods(fromWhere);\n\n    let translationToUse = {};\n\n    if (\n      typeof fromWhere === 'string'\n      && fromWhere.length !== 0\n      && this.fromForm != null\n      && this.fromForm[fromWhere] != null\n      // && this.fromForm[fromWhere].animation != null\n      && this.fromForm[fromWhere].translation !== undefined\n    ) {\n      translationToUse = joinObjects(\n        {},\n        this.translation,\n        this.fromForm[fromWhere].translation,\n      );\n    } else {\n      translationToUse = joinObjects({}, this.translation);\n    }\n\n    Object.keys(translationToUse).forEach((key) => {\n      const mods = translationToUse[key];\n      const {\n        element, style, direction, mag,\n      } = mods;\n      if (element) {\n        if (style != null) {\n          element.animations.options.translation.style = style;\n        }\n        if (direction != null) {\n          element.animations.options.translation.direction = direction;\n        }\n        if (mag != null) {\n          element.animations.options.translation.magnitude = mag;\n        }\n      }\n    });\n\n    if (dissolveInBeforeMove) {\n      if (elementsToShow.length > 0) {\n        this.dissolveElements(elementsToShow, 'in', cumTime, dissolveInTime, dissolveInCallback);\n        cumTime += dissolveInTime + 0.001;\n      }\n    }\n    const t = this.collectionMethods.animateToTransforms(\n      animateToTransforms,\n      moveTimeToUse,\n      cumTime,\n      0,\n      moveCallback,\n      '_Equation',\n    );\n    if (t > 0) {\n      cumTime = t;\n    }\n\n    // if (elementsToShow.length > 0) {\n    //   this.dissolveElements(elementsToShow, 'in', cumTime, dissolveInTime, dissolveInCallback);\n    //   cumTime += dissolveInTime + 0.001;\n    // }\n    if (!dissolveInBeforeMove) {\n      if (elementsToShow.length > 0) {\n        this.dissolveElements(elementsToShow, 'in', cumTime, dissolveInTime, dissolveInCallback);\n        cumTime += dissolveInTime + 0.001;\n      }\n    }\n    return cumTime;\n  }\n}\n","// @flow\nimport {\n  Point, getPoint,\n} from '../../tools/g2';\nimport type {\n  TypeParsablePoint,\n} from '../../tools/g2';\nimport { joinObjects } from '../../tools/tools';\nimport {\n  FigureElementPrimitive, FigureElementCollection,\n} from '../Element';\nimport {\n  BlankElement, Element, Elements,\n} from './Elements/Element';\nimport Fraction from './Elements/Fraction';\n// eslint-disable-next-line import/no-cycle\nimport EquationForm from './EquationForm';\nimport Matrix from './Elements/Matrix';\nimport Scale from './Elements/Scale';\nimport Container from './Elements/Container';\nimport BaseAnnotationFunction from './Elements/BaseAnnotationFunction';\nimport EquationLine from './Symbols/Line';\n// eslint-disable-next-line import/no-cycle\n// import type {\n//   EQN_Annotation, EQN_EncompassGlyph, EQN_LeftRightGlyph, EQN_TopBottomGlyph,\n// } from './Elements/BaseAnnotationFunction';\n\nexport function getFigureElement(\n  elementsObject: { [string: string]: FigureElementPrimitive |\n                    FigureElementCollection }\n                  | FigureElementCollection,\n  name: string | FigureElementPrimitive | FigureElementCollection,\n): FigureElementPrimitive | FigureElementCollection | null {\n  if (typeof name !== 'string') {\n    return name;\n  }\n  if (elementsObject instanceof FigureElementCollection) {\n    if (elementsObject && `_${name}` in elementsObject) {\n    // $FlowFixMe\n      return elementsObject[`_${name}`];\n    }\n    return null;\n  }\n\n  if (elementsObject && name in elementsObject) {\n    return elementsObject[name];\n  }\n\n  return null;\n}\n\n/* eslint-disable no-use-before-define */\n/**\n * An equation phrase is used to define an equation form and can be any of the\n * below:\n *\n *  - `string` (which represents the unique identifier of an equation element)\n *  - `{ frac: `{@link EQN_Fraction} `}`\n *  - `{ strike: `{@link EQN_Strike} `}`\n *  - `{ box: `{@link EQN_Box} `}`\n *  - `{ tBox: `{@link EQN_TouchBox} `}`\n *  - `{ root: `{@link EQN_Root} `}`\n *  - `{ brac: `{@link EQN_Bracket} `}`\n *  - `{ sub: `{@link EQN_Subscript} `}`\n *  - `{ sup: `{@link EQN_Superscript} `}`\n *  - `{ supSub: `{@link EQN_SuperscriptSubscript} `}`\n *  - `{ topBar: `{@link EQN_Bar} `}`\n *  - `{ bottomBar: `{@link EQN_Bar} `}`\n *  - `{ annotate: `{@link EQN_Annotate} `}`\n *  - `{ topComment: `{@link EQN_Comment} `}`\n *  - `{ bottomComment: `{@link EQN_Comment} `}`\n *  - `{ pad: `{@link EQN_Pad} `}`\n *  - `{ bar: `{@link EQN_Bar} `}`\n *  - `{ scale: `{@link EQN_Scale} `}`\n *  - `{ container: `{@link EQN_Container} `}`\n *  - `{ matrix: `{@link EQN_Matrix} `}`\n *  - `{ int: `{@link EQN_Integral} `}`\n *  - `{ sumOf: `{@link EQN_SumOf} `}`\n *  - `{ prodOf: `{@link EQN_ProdOf} `}`\n *  - `{ topStrike: `{@link EQN_StrikeComment} `}`\n *  - `{ bottomStrike: `{@link EQN_StrikeComment} `}`\n *  - `Array<TypeEquationPhrase>`\n *\n *\n * @example\n * forms: {\n *   form1: 'a'\n *   form2: ['a', 'equals', 'b']\n *   form3: [{\n *     frac: {\n *       numerator: 'a',\n *       symbol: 'v',\n *       denominator: '1'\n *     },\n *   }, 'equals', 'b'],\n *   form4: [{ frac: ['a', 'v', '1'], 'equals', 'b'}],\n * },\n */\nexport type TypeEquationPhrase =\n  string\n  | number\n  | { frac: EQN_Fraction }\n  | { strike: EQN_Strike }\n  | { box: EQN_Box }\n  | { tBox: EQN_TouchBox }\n  | { root: EQN_Root }\n  | { brac: EQN_Bracket }\n  | { sub: EQN_Subscript }\n  | { sup: EQN_Superscript }\n  | { supSub: EQN_SuperscriptSubscript }\n  | { topBar: EQN_Bar }\n  | { bottomBar: EQN_Bar }\n  | { annotate: EQN_Annotate }\n  | { topComment: EQN_Comment }\n  | { bottomComment: EQN_Comment }\n  | { pad: EQN_Pad }\n  | { bar: EQN_Bar }\n  | { scale: EQN_Scale }\n  | { container: EQN_Container }\n  | { matrix: EQN_Matrix }\n  | { int: EQN_Integral }\n  | { sumOf: EQN_SumOf }\n  | { prodOf: EQN_ProdOf }\n  | { topStrike: EQN_StrikeComment }\n  | { bottomStrike: EQN_StrikeComment }\n  | Array<TypeEquationPhrase>\n  | FigureElementPrimitive\n  | FigureElementCollection\n  | Elements\n  | Element\n  | BaseAnnotationFunction;\n\n/**\n * Equation container options\n *\n * ![](./apiassets/eqn_container.gif)\n *\n * A container is useful to fix spacing around content as it changes between\n * equation forms.\n *\n * Options can be an object, or an array in the property order below\n *\n * @property {TypeEquationPhrase} content\n * @property {number} [width] (`null`)\n * @property {number} [descent] (`null`)\n * @property {number} [ascent] (`null`)\n * @property {'left' | 'center' | 'right' | number} [xAlign] (`'center'`)\n * @property {'bottom' | 'middle' | 'top' | 'baseline' | number} [yAlign]  (`'baseline'`)\n * @property {'width' | 'height' | 'contain'} [fit] - fit width,\n * ascent and descent to either match width, height or fully contain the content (`null`)\n * @property {number} [scale] - (`1`)\n * @property {boolean} [fullContentBounds] - (`false`)\n *\n * @see To test examples, append them to the\n * <a href=\"#equation-boilerplate\">boilerplate</a>\n *\n * @example\n * // Example showing the difference between with and without container\n * figure.add({\n *   name: 'eqn',\n *   method: 'equation',\n *   options: {\n *     forms: {\n *       // Container object definition\n *       1: [\n *         'length',\n *         {\n *           container: {\n *             content: 'width',\n *             width: 0.5,\n *           },\n *         },\n *         'height',\n *       ],\n *       // Container array definition\n *       2: ['length', { container: ['w', 0.5] }, 'height'],\n *       // No container\n *       3: ['length', ' ', 'w', ' ', 'height']\n *     },\n *     formSeries: ['1', '2', '3'],\n *   },\n * });\n * const eqn = figure.elements._eqn;\n * eqn.onClick = () => eqn.nextForm();\n * eqn.setTouchableRect(0.5);\n * eqn.showForm('1');\n *\n * @example\n * // Create equation object then add to figure\n * const eqn = figure.primitives.equation({\n *   forms: {\n *     1: [\n *       'length',\n *       { container: { content: 'width', width: 0.5 } },\n *       'height',\n *     ],\n *     2: ['length', { container: ['w', 0.5] }, 'height'],\n *     3: ['length', ' ', 'w', ' ', 'height']\n *   },\n *   formSeries: ['1', '2', '3'],\n * });\n * figure.add('eqn', eqn);\n * eqn.onClick = () => eqn.nextForm();\n * eqn.setTouchableRect(0.5);\n * eqn.showForm('1');\n */\nexport type EQN_Container = {\n  content: TypeEquationPhrase,\n  width?: number,\n  descent?: number,\n  ascent?: number,\n  xAlign?: 'left' | 'center' | 'right' | number,\n  yAlign?: 'bottom' | 'middle' | 'top' | 'baseline' | number,\n  fit?: 'width' | 'height' | 'contain',\n  scale?: number,\n  fullContentBounds?: boolean,\n} | [\n  TypeEquationPhrase,\n  ?number,\n  ?number,\n  ?number,\n  ?'left' | 'center' | 'right' | number,\n  ?'bottom' | 'middle' | 'top' | 'baseline' | number,\n  ?'width' | 'height' | 'contain',\n  ?number,\n  ?boolean,\n];\n\n/**\n * Equation fraction options\n *\n * ![](./apiassets/eqn_fraction.gif)\n *\n * A fraction has a numerator, denominator and vinculum symbol (line).\n *\n * Options can be an object, or an array in the property order below\n *\n * @property {TypeEquationPhrase} numerator\n * @property {string} symbol - Vinculum symbol\n * @property {TypeEquationPhrase} denominator\n * @property {number} [scale] (`1`)\n * @property {number} [numeratorSpace] (`0.05`)\n * @property {number} [denominatorSpace] (`0.05`)\n * @property {number} [overhang] Vinculum extends beyond the content\n * horizontally by the this amount (`0.05`)\n * @property {number} [offsetY] Offset fraction in y (`0.07`)\n * @property {boolean} [fullContentBounds] Use full bounds with content (`false`)\n *\n * @see To test examples, append them to the\n * <a href=\"#equation-boilerplate\">boilerplate</a>\n *\n * @example\n * // Simple\n * figure.add({\n *   name: 'eqn',\n *   method: 'equation',\n *   options: {\n *     forms: {\n *       1: { frac: ['a', 'vinculum', 'b'] },\n *     },\n *   },\n * });\n * figure.elements._eqn.showForm('1');\n *\n * @example\n * // Example showing object and array fraction definitions, and nesting\n * figure.add({\n *   name: 'eqn',\n *   method: 'equation',\n *   options: {\n *     elements: {\n *       v1: { symbol: 'vinculum' },\n *       v2: { symbol: 'vinculum' },\n *       plus: '  +  ',\n *     },\n *     forms: {\n *       // Fraction object form\n *       1: {\n *         frac: {\n *           numerator: 'a',\n *           denominator: 'b',\n *           symbol: 'v1',\n *         },\n *       },\n *       // Fraction array form\n *       2: { frac: ['a', 'v1', 'd'] },\n *       // Nested\n *       3: {\n *         frac: {\n *           numerator: [{ frac: ['a', 'v1', 'd', 0.7] }, 'plus', '_1'],\n *           symbol: 'v2',\n *           denominator: 'b',\n *         }\n *       },\n *     },\n *     formSeries: ['1', '2', '3'],\n *   },\n * });\n * const eqn = figure.elements._eqn;\n * eqn.onClick = () => eqn.nextForm();\n * eqn.setTouchableRect(0.5);\n * eqn.showForm('1');\n *\n * @example\n * // Create equation object then add to figure\n * const eqn = figure.primitives.equation({\n *   elements: {\n *       v1: { symbol: 'vinculum' },\n *       v2: { symbol: 'vinculum' },\n *       plus: '  +  ',\n *     },\n *     forms: {\n *       1: {\n *         frac: {\n *           numerator: 'a',\n *           denominator: 'b',\n *           symbol: 'v1',\n *         },\n *       },\n *       2: { frac: ['a', 'v1', 'd'] },\n *       3: {\n *         frac: {\n *           numerator: [{ frac: ['a', 'v1', 'd', 0.7] }, 'plus', '_1'],\n *           symbol: 'v2',\n *           denominator: 'b',\n *         }\n *       },\n *     },\n *     formSeries: ['1', '2', '3'],\n * });\n * figure.add('eqn', eqn);\n * eqn.onClick = () => eqn.nextForm();\n * eqn.setTouchableRect(0.5);\n * eqn.showForm('1');\n */\nexport type EQN_Fraction = {\n  numerator: TypeEquationPhrase;\n  symbol: string;\n  denominator: TypeEquationPhrase;\n  scale?: number;\n  numeratorSpace?: number;\n  denominatorSpace?: number;\n  overhang?: number;\n  offsetY?: number;\n  baseline?: 'numerator' | 'denominator' | 'vinculum',\n  fullContentBounds?: boolean,\n} | [\n  TypeEquationPhrase,\n  string,\n  TypeEquationPhrase,\n  ?number,\n  ?number,\n  ?number,\n  ?number,\n  ?number,\n  ?('numerator' | 'denominator' | 'vinculum'),\n  ?boolean,\n];\n\n/**\n * Equation scale\n *\n * ![](./apiassets/eqn_scale.gif)\n *\n * Scale an equation phrase\n *\n * Options can be an object, or an array in the property order below\n *\n * @property {TypeEquationPhrase} content\n * @property {number} [scale] - (`1`)\n * @property {boolean} [fullContentBounds] Use full bounds with content (`false`)\n *\n * @see To test examples, append them to the\n * <a href=\"#equation-boilerplate\">boilerplate</a>\n *\n * @example\n * // Simple\n * figure.add({\n *   name: 'eqn',\n *   method: 'equation',\n *   options: {\n *     forms: {\n *       2: ['a', { scale: ['b', 2] }, 'c'],\n *     },\n *   },\n * });\n * figure.elements._eqn.showForm('1');\n *\n * // Some different bracket examples\n * figure.add({\n *   name: 'eqn',\n *   method: 'equation',\n *   options: {\n *     forms: {\n *       // Default\n *       1: ['a', 'b', 'c'],\n *       // Array definition magnify\n *       2: ['a', { scale: ['b', 2] }, 'c'],\n *       // Object definition shrink\n *       3: [\n *         'a',\n *         {\n *           scale: {\n *             content: ['b', 1],\n *             scale: 0.5,\n *           },\n *         },\n *         'c',\n *       ],\n *       // Back to start\n *       4: ['a', { scale: ['b', 1] }, 'c'],\n *     },\n *     formSeries: ['1', '2', '3']\n *   },\n * });\n * const eqn = figure.elements._eqn;\n * eqn.onClick = () => eqn.nextForm();\n * eqn.setTouchableRect(0.5);\n * eqn.showForm('1');\n */\nexport type EQN_Scale = {\n  content: TypeEquationPhrase,\n  scale?: number,\n  fullContentBounds?: boolean,\n} | [\n  TypeEquationPhrase,\n  ?number,\n  ?boolean,\n];\n\n/**\n * Equation bracket\n *\n * ![](./apiassets/eqn_bracket.gif)\n *\n * Surround an equation phrase with brackets\n *\n * Options can be an object, or an array in the property order below\n *\n * @property {string} [left] left bracket symbol\n * @property {TypeEquationPhrase} [content]\n * @property {string} [right] right bracket symbol\n * @property {boolean} [inSize] `false` excludes bracket symbols from\n * size of resulting phrase (`true`)\n * @property {number} [insideSpace] space between brackets and content (`0.03`)\n * @property {number} [outsideSpace] space between brackets and neighboring\n * phrases(`0.03`)\n * @property {number} [topSpace] how far the brackets extend above the content\n * (`0.05`)\n * @property {number} [bottomSpace] how far the brackets extend below the\n * content (`0.05`)\n * @property {number} [minContentHeight] if content height is less than this,\n * then this number will be used when sizing the brackets (unless it is `null`)\n * (`null`)\n * @property {number} [minContentDescent] if content descent is less than this,\n * then this number will be used when sizing the brackets (unless it is `null`)\n * (`null`)\n * @property {number} [height] force height of brackets (`null`)\n * @property {number} [descent] force descent of brackets (`null`)\n * @property {boolean} [fullContentBounds] use full bounds of content,\n * overriding any `inSize=false` properties in the content (`false`)\n * @property {boolean} [useFullBounds] make the bounds of this phrase equal to\n * the full bounds of the content even if `fullContentBounds=false` and the\n * brackets only surround a portion of the content (`false`)\n * @example\n * // For examples, two bracket symbols are defined as equation elements\n * eqn.addElements({\n *   lb: { symbol: 'bracket', side: 'left' }\n *   rb: { symbol: 'bracket', side: 'right' }\n * });\n *\n * @see To test examples, append them to the\n * <a href=\"#equation-boilerplate\">boilerplate</a>\n *\n * @example\n * // Simple\n * figure.add({\n *   name: 'eqn',\n *   method: 'equation',\n *   options: {\n *     elements: {\n *       lb: { symbol: 'bracket', side: 'left' },\n *       rb: { symbol: 'bracket', side: 'right' },\n *     },\n *     forms: {\n *       1: ['a', { brac: ['lb', ['b', '_ + ', 'c'], 'rb'] }],\n *     },\n *   },\n * });\n * figure.elements._eqn.showForm('1');\n *\n * @example\n * // Some different bracket examples\n * figure.add({\n *   name: 'eqn',\n *   method: 'equation',\n *   options: {\n *     elements: {\n *       lb: { symbol: 'bracket', side: 'left' },\n *       rb: { symbol: 'bracket', side: 'right' },\n *       lsb: { symbol: 'squareBracket', side: 'left' },\n *       rsb: { symbol: 'squareBracket', side: 'right' },\n *       leftBrace: { }\n *     },\n *     forms: {\n *       // Array definition\n *       1: ['a', { brac: ['lb', ['b', '_ + ', 'c'], 'rb'] }],\n *       // Object definition\n *       2: ['a', {\n *         brac: {\n *           left: 'lb',\n *           content: { frac: ['b', 'vinculum', 'c'] },\n *           right: 'rb',\n *         },\n *       }],\n *       // Square brackets\n *       3: ['a', { brac: ['lsb', ['b', '_ + ', 'c'], 'rsb'] }],\n *     },\n *     formSeries: ['1', '2', '3']\n *   },\n * });\n * const eqn = figure.elements._eqn;\n * eqn.onClick = () => eqn.nextForm();\n * eqn.setTouchableRect(0.5);\n * eqn.showForm('1');\n */\n\nexport type EQN_Bracket = {\n  left?: string;\n  content: TypeEquationPhrase;\n  right?: string;\n  inSize?: boolean;\n  insideSpace?: number;\n  outsideSpace?: number;\n  topSpace?: number;\n  bottomSpace?: number;\n  minContentHeight?: number;\n  minContentDescent?: number;\n  height?: number;\n  descent?: number;\n  fullContentBounds?: boolean;\n  useFullBounds?: boolean;\n} | [\n  string,\n  TypeEquationPhrase,\n  ?string,\n  ?boolean,\n  ?number,\n  ?number,\n  ?number,\n  ?number,\n  ?number,\n  ?number,\n  ?number,\n  ?boolean,\n  ?boolean,\n];\n\n/**\n * Equation root\n *\n * ![](./apiassets/eqn_root.gif)\n *\n * Surround an equation phrase with a radical symbol and add a custom root if\n * needed\n *\n * Options can be an object, or an array in the property order below.\n *\n * @property {string} symbol radical symbol\n * @property {TypeEquationPhrase} content\n * @property {boolean} [inSize] `false` excludes radical symbol and root (if\n * defined) from size of resulting phrase (`true`)\n * @property {number} [space] (`0.02`) default space between content and\n * radical symbol in left, right, top and bottom directions.\n * @property {number} [topSpace] space between content top and radical symbol\n * horiztonal line (`space`)\n * @property {number} [rightSpace] radical symbol overhang of content on right\n * (`space`)\n * @property {number} [bottomSpace] radical symbol descent below content\n * (`space`)\n * @property {number} [leftSpace] space between radical symbol up stroke and\n * content (`space`)\n * @property {TypeEquationPhrase} [root] custom root\n * @property {number} [rootOffset] custom root offset (`[0, 0.06]`)\n * @property {number} [rootScale] custom root scale (`0.6`)\n * @property {boolean} [fullContentBounds] use full bounds of content,\n * overriding any `inSize=false` properties in the content (`false`)\n * @property {boolean} [useFullBounds] make the bounds of this phrase equal to\n * the full bounds of the content even if `fullContentBounds=false` and the\n * brackets only surround a portion of the content (`false`)\n *\n * @see To test examples, append them to the\n * <a href=\"#equation-boilerplate\">boilerplate</a>\n *\n * @example\n * // Simple\n * figure.add({\n *   name: 'eqn',\n *   method: 'equation',\n *   options: {\n *     forms: {\n *       1: { root: ['radical', 'a'] },\n *     },\n *   },\n * });\n * figure.elements._eqn.showForm('1');\n *\n * @example\n * // Example showing object and array root definitions, and custom roots\n * figure.add({\n *   name: 'eqn',\n *   method: 'equation',\n *   options: {\n *     elements: {\n *       r: { symbol: 'radical' },\n *       plus: '  +  ',\n *     },\n *     formDefaults: { alignment: { fixTo: 'd' } },\n *     forms: {\n *       // Root object form\n *       1: {\n *         root: {\n *           symbol: 'r',\n *           content: ['a', 'plus', 'd'],\n *         },\n *       },\n *       // Root array form\n *       2: { root: ['r', 'd'] },\n *       // Cube root\n *       3: { root: { content: 'd', symbol: 'r', root: '_3' } },\n *     },\n *     formSeries: ['1', '2', '3'],\n *   },\n * });\n * const eqn = figure.elements._eqn;\n * eqn.onClick = () => eqn.nextForm();\n * eqn.setTouchableRect(0.5);\n * eqn.showForm('1');\n *\n * @example\n * // Create equation object then add to figure\n * const eqn = figure.primitives.equation({\n *   elements: {\n *     r: { symbol: 'radical' },\n *     plus: '  +  ',\n *   },\n *   formDefaults: {\n *     alignment: { fixTo: 'd' },\n *   },\n *   forms: {\n *     1: {\n *       root: {\n *         symbol: 'r',\n *         content: ['a', 'plus', 'd'],\n *       },\n *     },\n *     2: { root: ['r', 'd'] },\n *     3: { root: { content: 'd', symbol: 'r', root: '_3' } },\n *   },\n *   formSeries: ['1', '2', '3'],\n * });\n * figure.add('eqn', eqn);\n * eqn.onClick = () => eqn.nextForm();\n * eqn.setTouchableRect(0.5);\n * eqn.showForm('1');\n */\n\nexport type EQN_Root = {\n  symbol: string;\n  content: TypeEquationPhrase;\n  inSize?: boolean;\n  space?: number;\n  topSpace?: number;\n  rightSpace?: number;\n  bottomSpace?: number;\n  leftSpace?: number;\n  root: TypeEquationPhrase;\n  rootOffset?: number,\n  rootScale?: number,\n  fullContentBounds?: boolean,\n  useFullBounds?: boolean,\n} | [\n  string,\n  TypeEquationPhrase,\n  ?boolean,\n  ?number,\n  ?number,\n  ?number,\n  ?number,\n  ?number,\n  ?TypeEquationPhrase,\n  ?number,\n  ?number,\n  ?boolean,\n  ?boolean,\n];\n\n/**\n * Equation strike-through\n *\n * ![](./apiassets/eqn_strike.gif)\n *\n * Overlay a strike symbol on an equation phrase\n *\n * Options can be an object, or an array in the property order below\n *\n * @property {TypeEquationPhrase} content\n * @property {string} symbol\n * @property {boolean} [inSize] `false` excludes strike symbol from size of\n * resulting phrase (`false`)\n * @property {number} [space] amount the strike symbol overhangs the content on\n * the left, right, bottom and top sides (`0.02`)\n * @property {number} [topSpace] use when top overhang between content and\n *  strike should be different thant `space` property (`space`)\n * @property {number} [rightSpace] use when right overhang between content and\n *  strike should be different thant `space` property (`space`)\n * @property {number} [bottomSpace] use when bottom overhang between content and\n *  strike should be different thant `space` property (`space`)\n * @property {number} [leftSpace] use when left overhang between content and\n *  strike should be different thant `space` property (`space`)\n * @property {boolean} [fullContentBounds] use full bounds of content,\n * overriding any `inSize=false` properties in the content (`false`)\n * @property {boolean} [useFullBounds] make the bounds of this phrase equal to\n * the full bounds of the content even if `fullContentBounds=false` and the\n * brackets only surround a portion of the content (`false`)\n *\n * @see To test examples, append them to the\n * <a href=\"#equation-boilerplate\">boilerplate</a>\n *\n * @example\n * // Simple\n * figure.add({\n *   name: 'eqn',\n *   method: 'equation',\n *   options: {\n *     elements: {\n *       x: { symbol: 'strike', color: [0.6, 0.6, 0.6, 1] },\n *     },\n *     forms: {\n *       1: [{ strike: ['a', 'x']}, ' ', 'b'],\n *     },\n *   },\n * });\n * figure.elements._eqn.showForm('1');\n *\n * @example\n * // Some different strike examples\n * figure.add({\n *   name: 'eqn',\n *   method: 'equation',\n *   options: {\n *     elements: {\n *       s1: { symbol: 'strike', color: [0.6, 0.6, 0.6, 1] },\n *       s2: { symbol: 'strike', style: 'forward', color: [0.6, 0.6, 0.6, 1] },\n *     },\n *     forms: {\n *       // Array definition\n *       1: [{ strike: ['a', 's1']}, ' ', 'b'],\n *       // Object definition\n *       2: {\n *         strike: {\n *           content: ['a', '_ + ', 'b'],\n *           symbol: 's1',\n *         },\n *       },\n *       // Additional options to make strike overhang more\n *       3: {\n *         strike: {\n *           content: ['a', 'b'],\n *           symbol: 's1',\n *           topSpace: 0.2,\n *           rightSpace: 0.2,\n *           leftSpace: 0.2,\n *           bottomSpace: 0.2,\n *         },\n *       },\n *       // Forward strike\n *       4: { strike: [['a', '_ +', 'b'], 's2'] },\n *     },\n *     formSeries: ['1', '2', '3', '4']\n *   },\n * });\n * const eqn = figure.elements._eqn;\n * eqn.onClick = () => eqn.nextForm();\n * eqn.setTouchableRect(0.5);\n * eqn.showForm('1');\n */\nexport type EQN_Strike = {\n  content: TypeEquationPhrase;\n  symbol: string;\n  inSize?: boolean;\n  space?: number;\n  topSpace?: number;\n  rightSpace?: number;\n  bottomSpace?: number;\n  leftSpace?: number;\n  fullContentBounds?: boolean;\n  useFullBounds?: boolean;\n} | [\n  TypeEquationPhrase,\n  string,\n  ?boolean,\n  ?number,\n  ?number,\n  ?number,\n  ?number,\n  ?number,\n  ?boolean,\n  ?boolean,\n];\n\n/**\n * Equation box\n *\n * ![](./apiassets/eqn_box.gif)\n *\n * Place a box symbol around an equation phrase\n *\n * Options can be an object, or an array in the property order below\n *\n * @property {TypeEquationPhrase} content\n * @property {string} symbol\n * @property {boolean} [inSize] `false` excludes box symbol from size of\n * resulting phrase (`false`)\n * @property {number} [space] space between box symbol and content on\n * the left, right, bottom and top sides (`0`)\n * @property {number} [topSpace] use when top space between content and\n *  box should be different thant `space` property (`space`)\n * @property {number} [rightSpace] use when right space between content and\n *  box should be different thant `space` property (`space`)\n * @property {number} [bottomSpace] use when bottom space between content and\n *  box should be different thant `space` property (`space`)\n * @property {number} [leftSpace] use when left space between content and\n *  box should be different thant `space` property (`space`)\n * @property {boolean} [fullContentBounds] use full bounds of content,\n * overriding any `inSize=false` properties in the content (`false`)\n * @property {boolean} [useFullBounds] make the bounds of this phrase equal to\n * the full bounds of the content even if `fullContentBounds=false` and the\n * brackets only surround a portion of the content (`false`)\n *\n *\n * @see To test examples, append them to the\n * <a href=\"#equation-boilerplate\">boilerplate</a>\n *\n * @example\n * // Simple\n * figure.add({\n *   name: 'eqn',\n *   method: 'equation',\n *   options: {\n *     forms: {\n *       1: { box: ['a', 'box', true, 0.1] },\n *     },\n *   },\n * });\n * figure.elements._eqn.showForm('1');\n *\n * @example\n * // Some different box examples\n * figure.add({\n *   name: 'eqn',\n *   method: 'equation',\n *   options: {\n *     elements: {\n *       box: { symbol: 'box' },\n *     },\n *     forms: {\n *       // Array equation\n *       1: ['a', { box: ['b', 'box'] }, 'c'],\n *       // Object definition\n *       2: {\n *         box: {\n *           content: ['a', 'b', 'c'],\n *           symbol: 'box',\n *         },\n *       },\n *       // Additional options for layout\n *       3: {\n *         box: {\n *           content: ['a', 'b', 'c'],\n *           symbol: 'box',\n *           space: 0.2,\n *         },\n *       },\n *       // Box is included in the layout spacing\n *       4: [\n *         'a',\n *         {\n *           box: {\n *             content: 'b',\n *             symbol: 'box',\n *             space: 0.2,\n *             inSize: true,\n *           },\n *         },\n *         'c'\n *       ],\n *     },\n *     formSeries: ['1', '2', '3', '4']\n *   },\n * });\n * const eqn = figure.elements._eqn;\n * eqn.onClick = () => eqn.nextForm();\n * eqn.setTouchableRect(0.5);\n * eqn.showForm('1');\n */\nexport type EQN_Box = {\n  content: TypeEquationPhrase,\n  symbol: string,\n  inSize?: boolean,\n  space?: number,\n  topSpace?: number,\n  rightSpace?: number,\n  bottomSpace?: number,\n  leftSpace?: number,\n  fullContentBounds?: boolean,\n  useFullBounds?: boolean,\n} | [\n  TypeEquationPhrase,\n  string,\n  ?boolean,\n  ?number,\n  ?number,\n  ?number,\n  ?number,\n  ?number,\n  ?boolean,\n  ?boolean,\n];\n\n\n/**\n * Equation touch box\n *\n * Place a box symbol around an equation phrase\n *\n * Options can be an object, or an array in the property order below\n *\n * @property {TypeEquationPhrase} content\n * @property {string} symbol\n * @property {number} [space] space between box symbol and content on\n * the left, right, bottom and top sides (`0`)\n * @property {number} [topSpace] use when top space between content and\n *  box should be different thant `space` property (`space`)\n * @property {number} [rightSpace] use when right space between content and\n *  box should be different thant `space` property (`space`)\n * @property {number} [bottomSpace] use when bottom space between content and\n *  box should be different thant `space` property (`space`)\n * @property {number} [leftSpace] use when left space between content and\n *  box should be different thant `space` property (`space`)\n *\n *\n * @see To test examples, append them to the\n * <a href=\"#equation-boilerplate\">boilerplate</a>\n *\n */\nexport type EQN_TouchBox = {\n  content: TypeEquationPhrase,\n  symbol: string,\n  space?: number,\n  topSpace?: number,\n  rightSpace?: number,\n  bottomSpace?: number,\n  leftSpace?: number,\n} | [\n  TypeEquationPhrase,\n  string,\n  ?number,\n  ?number,\n  ?number,\n  ?number,\n  ?number,\n];\n\n/**\n * Equation bar\n *\n * ![](./apiassets/eqn_bar.gif)\n *\n * Place a bar (or bracket) symbol to the side of an equation phrase\n *\n * Options can be an object, or an array in the property order below\n *\n * @property {TypeEquationPhrase} content\n * @property {string} symbol\n * @property {boolean} [inSize] `false` excludes box symbol from size of\n * resulting phrase (`true`)\n * @property {number} [space] space between content and the symbol (`0.03`)\n * @property {number} [overhang] amount symbol extends beyond content (`0`)\n * @property {number} [length] total length of symbol (overrides `overhang`)\n * @property {number} [left] amount symbol extends beyond content to the left\n * (overrides `overhang` and `length`, and only for side `'top'` or `'bottom'`)\n * @property {number} [left] amount symbol extends beyond content to the right\n * (overrides `overhang` and `length`, and only for side `'top'` or `'bottom'`)\n * @property {number} [top] amount symbol extends beyond content to the top\n * (overrides `overhang` and `length`, and only for side `'left'` or `'right'`)\n * @property {number} [top] amount symbol extends beyond content to the bottom\n * (overrides `overhang` and `length`, and only for side `'left'` or `'right'`)\n * @property {'left' | 'right' | 'top' | 'bottom'} [side] (`top`)\n * @property {number} [minContentHeight] custom min content height for auto\n * symbol sizing when side is `'top'` or `'bottom'`\n * @property {number} [minContentDescent] custom min content descent for auto\n * symbol sizing when side is `'top'` or `'bottom'`\n * @property {number} [minContentAscent] custom min content ascent for auto\n * symbol sizing when side is `'top'` or `'bottom'`\n * @property {number} [descent] force descent of symbol when side is `'top'` or\n * `'bottom'` - height is forced with `length` property\n * @property {boolean} [fullContentBounds] use full bounds of content,\n * overriding any `inSize=false` properties in the content (`false`)\n * @property {boolean} [useFullBounds] make the bounds of this phrase equal to\n * the full bounds of the content even if `fullContentBounds=false` and the\n * brackets only surround a portion of the content (`false`)\n *\n * @see To test examples, append them to the\n * <a href=\"#equation-boilerplate\">boilerplate</a>\n *\n * @example\n * // Simple\n * figure.add({\n *   name: 'eqn',\n *   method: 'equation',\n *   options: {\n *     elements: {\n *       bar: { symbol: 'bar', side: 'top' },\n *     },\n *     forms: {\n *       1: { bar: ['a', 'bar', 'top'] },\n *     },\n *   },\n * });\n * figure.elements._eqn.showForm('1');\n *\n * @example\n * // Some different bar examples\n * figure.add({\n *   name: 'eqn',\n *   method: 'equation',\n *   options: {\n *     elements: {\n *       hBar: { symbol: 'bar', side: 'top' },\n *       vBar: { symbol: 'bar', side: 'right' },\n *       hArrow: { symbol: 'arrow', direction: 'right' },\n *     },\n *     forms: {\n *       // Array equation\n *       1: { bar: [['a', 'b'], 'hBar', 'top'] },\n *       // Object definition\n *       2: {\n *         bar: {\n *           content: ['a', 'b'],\n *           symbol: 'hBar',\n *           side: 'bottom',\n *         },\n *       },\n *       // Additional options for layout\n *       3: {\n *         bar: {\n *           content: ['a', 'b'],\n *           symbol: 'vBar',\n *           side: 'right',\n *           overhang: 0.1,\n *         },\n *       },\n *       // Vector arrow\n *       4: {\n *         bar: {\n *           content: ['a', 'b'],\n *           symbol: 'hArrow',\n *           side: 'top',\n *         },\n *       },\n *     },\n *     formSeries: ['1', '2', '3', '4']\n *   },\n * });\n * const eqn = figure.elements._eqn;\n * eqn.onClick = () => eqn.nextForm();\n * eqn.setTouchableRect(0.5);\n * eqn.showForm('1');\n */\nexport type EQN_Bar = {\n  content: TypeEquationPhrase;\n  symbol?: string;\n  inSize?: boolean,\n  space?: number,\n  overhang?: number,\n  length?: number,\n  left?: number,\n  right?: number,\n  top?: number,\n  bottom?: number,\n  side?: 'left' | 'right' | 'top' | 'bottom',\n  minContentHeight?: number,\n  minContentDescent?: number,\n  minContentAscent?: number,\n  descent?: number,\n  fullContentBounds?: boolean,\n  useFullBounds?: boolean,\n} | [\n  TypeEquationPhrase,\n  ?string,\n  ?boolean,\n  ?number,\n  ?number,\n  ?number,\n  ?number,\n  ?number,\n  ?number,\n  ?number,\n  ?'left' | 'right' | 'top' | 'bottom',\n  ?number,\n  ?number,\n  ?number,\n  ?number,\n  ?boolean,\n  ?boolean,\n];\n\n\n/**\n * Equation integral\n *\n * ![](./apiassets/eqn_integral.gif)\n *\n * Place an integral (with optional limits) before an equation phrase\n *\n * Options can be an object, or an array in the property order below.\n *\n * @property {string} symbol\n * @property {TypeEquationPhrase} content\n * @property {TypeEquationPhrase} [from] bottom limit\n * @property {TypeEquationPhrase} [to] top limit\n * @property {boolean} [inSize] `false` excludes box symbol from size of\n * resulting phrase (`true`)\n * @property {number} [space] horizontal space between symbol and content (`0.05`)\n * @property {number} [topSpace] space between content top and symbol top (`0.1`)\n * @property {number} [bottomSpace] space between content bottom and symbol bottom (`0.1`)\n * @property {number} [height] force height of symbol\n * @property {number} [yOffset] y offset of symbol (`0`)\n * @property {number} [scale] content scale (`1`)\n * @property {number} [fromScale] scale of *from* (bottom) limit (`0.5`)\n * @property {number} [toScale] scale of *to* (top) limit (`0.5`)\n * @property {TypeParsablePoint} [fromOffset] from limit offest ( `side`:\n * `[0, 0]`, `topBottom`: `[0, -0.04]`, `topBottomCenter`: `[0, -0.04]`)\n * @property {TypeParsablePoint} [toOffset] to limit offest (`side`: `[0, 0]`\n * `topBottom`: `[0, 0.04]`, `topBottomCenter`: `[0, 0.04]`)\n * @property {'side' | 'topBottom' | 'topBottomCenter'} [limitsPosition] limits\n * relative to symbol. `side` is to the right of the symbol ends, `topBottom`\n * is above and below the symbol ends and `topBottomCenter` is above and below\n * the integral mid point (`'side'`)\n * @property {boolean} [limitsAroundContent] `false` means content left is\n * aligned with furthest right of limits\n * @property {'left' | 'center' | 'right' | number} [fromXPosition] x position\n * of limit relative to the symbol (`side`: `0.5`, `topBottom`: `0.1`,\n * `topBottomCenter`: `'center'`)\n * @property {'bottom' | 'top' | 'middle' | 'baseline' | number} [fromYPositio]\n * y position of the limit relavite to the symbol (`'bottom'`)\n * @property {'left' | 'center' | 'right' | number} [fromXAlign] limit x\n * alignment (`side`: `'left'`, `topBottom`: `center`,\n * `topBottomCenter`: `'center'`)\n * @property {'bottom' | 'top' | 'middle' | 'baseline' | number} [fromYAlign]\n * limit y alignment (`side`: `'middle'`, `topBottom`: `'top'`,\n * `topBottomCenter`: `'top'`)\n * @property {'left' | 'center' | 'right' | number} [toXPosition] x position\n * of limit relative to the symbol (`side`: `'right'`, `topBottom`: `0.9`,\n * `topBottomCenter`: `'center'`)\n * @property {'bottom' | 'top' | 'middle' | 'baseline' | number} [toYPosition]\n * y position of the limit relavite to the symbol (`side`: `'top'`,\n * `topBottom`: `top`, `topBottomCenter`: `'top'`)\n * @property {'left' | 'center' | 'right' | number} [toXAlign] limit x\n * alignment (`side`: `'left'`, `topBottom`: `center`,\n * `topBottomCenter`: `'center'`)\n * @property {'bottom' | 'top' | 'middle' | 'baseline' | number} [toYAlign]\n * limit y alignment (`side`: `'middle'`, `topBottom`: `bottom`,\n * `topBottomCenter`: `'bottom'`)\n * @property {boolean} [fullContentBounds] use full bounds of content,\n * overriding any `inSize=false` properties in the content (`false`)\n * @property {boolean} [useFullBounds] make the bounds of this phrase equal to\n * the full bounds of the content even if `fullContentBounds=false` and the\n * brackets only surround a portion of the content (`false`)\n *\n * @see To test examples, append them to the\n * <a href=\"#equation-boilerplate\">boilerplate</a>\n *\n * @example\n * // Simple\n * figure.add({\n *   name: 'eqn',\n *   method: 'equation',\n *   options: {\n *     forms: {\n *       1: { int: ['int', 'x dx', 'a', 'b'] },\n *     },\n *   },\n * });\n * figure.elements._eqn.showForm('1');\n *\n * @example\n * // Example showing different integral options\n * figure.add({\n *   name: 'eqn',\n *   method: 'equation',\n *   options: {\n *     elements: {\n *       i: { symbol: 'int' },\n *       // ic: { symbol: 'int', num: 1, type: 'line' },\n *     },\n *     formDefaults: { alignment: { fixTo: 'x' } },\n *     forms: {\n *       // Root object form\n *       1: {\n *         int: {\n *           symbol: 'i',\n *           content: ['x', ' ', 'dx'],\n *           from: 'a',\n *           to: 'b',\n *         },\n *       },\n *       // Root array form\n *       2: { int: ['i', ['x', '  ', '+', ' ', '_1', ' ', 'dx'], 'a', 'b'] },\n *       // Indefinite tripple integral\n *       3: { int: ['i', ['x', '  ', '+', ' ', '_1', ' ', 'dx']] },\n *       // Custom spacing\n *       4: {\n *         int: {\n *           symbol: 'i',\n *           content: ['x', '  ', '+', ' ', '_1', ' ', 'dx'],\n *           to: 'b',\n *           from: { frac: ['a', 'vinculum', 'd + 2'] },\n *           topSpace: 0.2,\n *           bottomSpace: 0.2,\n *           limitsAroundContent: false,\n *         },\n *       },\n *     },\n *     formSeries: ['1', '2', '3', '4'],\n *   },\n * });\n * const eqn = figure.elements._eqn;\n * eqn.onClick = () => eqn.nextForm();\n * eqn.setTouchableRect(0.5);\n * eqn.showForm('1');\n */\nexport type EQN_Integral = {\n  symbol?: string,\n  content?: TypeEquationPhrase,\n  from?: TypeEquationPhrase,\n  to?: TypeEquationPhrase,\n  inSize?: boolean,\n  space?: number,\n  topSpace?: number,\n  bottomSpace?: number,\n  height?: number,\n  yOffset?: number,\n  scale?: number,\n  fromScale?: number,\n  toScale?: number,\n  fromOffset?: TypeParsablePoint,\n  toOffset?: TypeParsablePoint,\n  limitsPosition?: 'side' | 'topBottom' | 'topBottomCenter',\n  limitsAroundContent?: boolean,\n  fromXPosition?: 'left' | 'center' | 'right' | number,\n  fromYPosition?: 'bottom' | 'top' | 'middle' | 'baseline' | number,\n  fromXAlign?: 'left' | 'center' | 'right' | number,\n  fromYAlign?: 'bottom' | 'top' | 'middle' | 'baseline' | number,\n  toXPosition?: 'left' | 'center' | 'right' | number,\n  toYPosition?: 'bottom' | 'top' | 'middle' | 'baseline' | number,\n  toXAlign?: 'left' | 'center' | 'right' | number,\n  toYAlign?: 'bottom' | 'top' | 'middle' | 'baseline' | number,\n  fullBoundsContent?: boolean,\n  useFullBounds?: boolean,\n  } | [\n  ?string,\n  ?TypeEquationPhrase,\n  ?TypeEquationPhrase,\n  ?TypeEquationPhrase,\n  ?boolean,\n  ?number,\n  ?number,\n  ?number,\n  ?number,\n  ?number,\n  ?number,\n  ?number,\n  ?number,\n  ?TypeParsablePoint,\n  ?TypeParsablePoint,\n  ?'side' | 'topBottom' | 'topBottomCenter',\n  ?boolean,\n  ?'left' | 'center' | 'right' | number,\n  ?'bottom' | 'top' | 'middle' | 'baseline' | number,\n  ?'left' | 'center' | 'right' | number,\n  ?'bottom' | 'top' | 'middle' | 'baseline' | number,\n  ?'left' | 'center' | 'right' | number,\n  ?'bottom' | 'top' | 'middle' | 'baseline' | number,\n  ?'left' | 'center' | 'right' | number,\n  ?'bottom' | 'top' | 'middle' | 'baseline' | number,\n  ?boolean,\n  ?boolean,\n];\n\n/**\n * Equation sum of\n *\n * ![](./apiassets/eqn_sumof.gif)\n *\n * Place an equation phrase in a sum of operation\n *\n * Options can be an object, or an array in the property order below\n *\n * @property {string} symbol\n * @property {TypeEquationPhrase} content\n * @property {TypeEquationPhrase} [from]\n * @property {TypeEquationPhrase} [to]\n * @property {boolean} [inSize] `false` excludes sum of operator from size of\n * resulting phrase (`true`)\n * @property {number} [space] horiztonaly space between symbol and content (`0.1`)\n * @property {number} [topSpace] space symbol extends above content top (`0.07`)\n * @property {number} [bottomSpace] space symbol extends below content bottom (`0.07`)\n * @property {number} [height] force height of symbol overwriting `topSpace`\n * @property {number} [yOffset] offset of symbol in y (`0`)\n * @property {number} [scale] content scale (`1`)\n * @property {number} [fromScale] scale of *from* phrase (`0.5`)\n * @property {number} [toScale] scale of *to* phrase (`0.5`)\n * @property {number} [fromSpace] space between symbol and `from` phrase\n * (`0.04`)\n * @property {number} [toSpace] space between symbol and `to` phrase (`0.04`)\n * @property {TypeParsablePoint} [fromOffset] offset of `from` phrase (`[0, 0]`)\n * @property {TypeParsablePoint} [toOffset] offset of `to` phrase (`[0, 0]`)\n * @property {boolean} [fullContentBounds] use full bounds of content,\n * overriding any `inSize=false` properties in the content (`false`)\n * @property {boolean} [useFullBounds] make the bounds of this phrase equal to\n * the full bounds of the content even if `fullContentBounds=false` and the\n * brackets only surround a portion of the content (`false`)\n *\n * @see To test examples, append them to the\n * <a href=\"#equation-boilerplate\">boilerplate</a>\n *\n * @example\n * // Simple\n * figure.add({\n *   name: 'eqn',\n *   method: 'equation',\n *   options: {\n *     forms: {\n *       1: { sumOf: ['sum', 'x', 'b', 'a'] },\n *     },\n *   },\n * });\n * figure.elements._eqn.showForm('1');\n *\n * @example\n * // Example showing different options\n * figure.add({\n *   name: 'eqn',\n *   method: 'equation',\n *   options: {\n *     elements: {\n *       s: { symbol: 'sum', draw: 'dynamic' },\n *       inf: '\\u221e',\n *     },\n *     forms: {\n *       // Object form\n *       1: {\n *         sumOf: {\n *           symbol: 's',\n *           content: [{ sup: ['x', 'n'] }],\n *           from: ['n_1', ' ', '=', ' ', '_0'],\n *           to: '_10',\n *         },\n *       },\n *       // Array form\n *       2: { sumOf: ['s', [{ sup: ['x', 'm'] }], 'm_1', null]},\n *       // Styling with options\n *       3: {\n *         sumOf: {\n *           symbol: 's',\n *           content: { frac: [['x', ' ', '+', ' ', 'm'], 'vinculum', 'a'] },\n *           from: ['m_1', ' ', '=', ' ', '_0'],\n *           to: 'inf',\n *           fromScale: 0.8,\n *           toScale: 0.8,\n *         },\n *       },\n *     },\n *     formSeries: ['1', '2', '3'],\n *   },\n * });\n * const eqn = figure.elements._eqn;\n * eqn.onClick = () => eqn.nextForm();\n * eqn.setTouchableRect(0.5);\n * eqn.showForm('1');\n */\nexport type EQN_SumOf = {\n  symbol?: string,\n  content: TypeEquationPhrase,\n  from?: TypeEquationPhrase,\n  to?: TypeEquationPhrase,\n  inSize?: boolean,\n  space?: number,\n  topSpace?: number,\n  bottomSpace?: number,\n  height?: number,\n  yOffset?: number,\n  scale?: number,\n  fromScale?: number,\n  toScale?: number,\n  fromSpace?: number,\n  toSpace?: number,\n  fromOffset?: TypeParsablePoint,\n  toOffset?: TypeParsablePoint,\n  fullBoundsContent?: boolean,\n  useFullBounds?: boolean,\n} | [\n  ?string,\n  TypeEquationPhrase,\n  ?TypeEquationPhrase,\n  ?TypeEquationPhrase,\n  ?boolean,\n  ?number,\n  ?number,\n  ?number,\n  ?number,\n  ?number,\n  ?number,\n  ?number,\n  ?number,\n  ?number,\n  ?number,\n  ?TypeParsablePoint | null,\n  ?TypeParsablePoint | null,\n  ?boolean,\n  ?boolean,\n];\n\n/**\n * Equation product of\n *\n * ![](./apiassets/eqn_prodof.gif)\n *\n * Place an equation phrase in a product of operation\n *\n * Options can be an object, or an array in the property order below\n *\n * @property {string} symbol\n * @property {TypeEquationPhrase} content\n * @property {TypeEquationPhrase} [from]\n * @property {TypeEquationPhrase} [to]\n * @property {boolean} [inSize] `false` excludes product of operator from size of\n * resulting phrase (`true`)\n * @property {number} [space] horiztonaly space between symbol and content (`0.1`)\n * @property {number} [topSpace] space symbol extends above content top (`0.07`)\n * @property {number} [bottomSpace] space symbol extends below content bottom (`0.07`)\n * @property {number} [height] force height of symbol overwriting `topSpace`\n * @property {number} [yOffset] offset of symbol in y (`0`)\n * @property {number} [scale] content scale (`1`)\n * @property {number} [fromScale] scale of *from* phrase (`0.5`)\n * @property {number} [toScale] scale of *to* phrase (`0.5`)\n * @property {number} [fromSpace] space between symbol and `from` phrase\n * (`0.04`)\n * @property {number} [toSpace] space between symbol and `to` phrase (`0.04`)\n * @property {TypeParsablePoint} [fromOffset] offset of `from` phrase (`[0, 0]`)\n * @property {TypeParsablePoint} [toOffset] offset of `to` phrase (`[0, 0]`)\n * @property {boolean} [fullContentBounds] use full bounds of content,\n * overriding any `inSize=false` properties in the content (`false`)\n * @property {boolean} [useFullBounds] make the bounds of this phrase equal to\n * the full bounds of the content even if `fullContentBounds=false` and the\n * brackets only surround a portion of the content (`false`)\n *\n * @see To test examples, append them to the\n * <a href=\"#equation-boilerplate\">boilerplate</a>\n *\n * @example\n * // Simple\n * figure.add({\n *   name: 'eqn',\n *   method: 'equation',\n *   options: {\n *     forms: {\n *       1: { prodOf: ['prod', 'x', 'b', 'a'] },\n *     },\n *   },\n * });\n * figure.elements._eqn.showForm('1');\n *\n * @example\n * // Example showing different options\n * figure.add({\n *   name: 'eqn',\n *   method: 'equation',\n *   options: {\n *     elements: {\n *       p: { symbol: 'prod', draw: 'dynamic' },\n *       inf: '\\u221e',\n *     },\n *     forms: {\n *       // Object form\n *       1: {\n *         prodOf: {\n *           symbol: 'p',\n *           content: [{ sup: ['x', 'n'] }],\n *           from: ['n_1', ' ', '=', ' ', '_0'],\n *           to: '_10',\n *         },\n *       },\n *       // Array form\n *       2: { prodOf: ['p', [{ sup: ['x', 'm'] }], 'm_1', null]},\n *       // Styling with options\n *       3: {\n *         prodOf: {\n *           symbol: 'p',\n *           content: { frac: [['x', ' ', '+', ' ', 'm'], 'vinculum', 'a'] },\n *           from: ['m_1', ' ', '=', ' ', '_0'],\n *           to: 'inf',\n *           fromScale: 0.8,\n *           toScale: 0.8,\n *         },\n *       },\n *     },\n *     formSeries: ['1', '2', '3'],\n *   },\n * });\n * const eqn = figure.elements._eqn;\n * eqn.onClick = () => eqn.nextForm();\n * eqn.setTouchableRect(0.5);\n * eqn.showForm('1');\n */\nexport type EQN_ProdOf = {\n  symbol?: string,\n  content: TypeEquationPhrase,\n  from?: TypeEquationPhrase,\n  to?: TypeEquationPhrase,\n  inSize?: boolean,\n  space?: number,\n  topSpace?: number,\n  bottomSpace?: number,\n  height?: number,\n  yOffset?: number,\n  scale?: number,\n  fromScale?: number,\n  toScale?: number,\n  fromSpace?: number,\n  toSpace?: number,\n  fromOffset?: TypeParsablePoint,\n  toOffset?: TypeParsablePoint,\n  fullBoundsContent?: boolean,\n  useFullBounds?: boolean,\n} | [\n  ?string,\n  TypeEquationPhrase,\n  ?TypeEquationPhrase,\n  ?TypeEquationPhrase,\n  ?boolean,\n  ?number,\n  ?number,\n  ?number,\n  ?number,\n  ?number,\n  ?number,\n  ?number,\n  ?number,\n  ?number,\n  ?number,\n  ?TypeParsablePoint | null,\n  ?TypeParsablePoint | null,\n  ?boolean,\n  ?boolean,\n];\n\n/**\n * Equation subscript\n *\n * ![](./apiassets/eqn_subscript.gif)\n *\n * Options can be an object, or an array in the property order below\n *\n * @property {TypeEquationPhrase} content\n * @property {TypeEquationPhrase} subscript\n * @property {number} [scale] scale of subscript (`0.5`)\n * @property {TypeParsablePoint} [offset] offset of subscript (`[0, 0]`)\n * @property {boolean} [inSize] `true` excludes subscript from size of\n * resulting phrase (`true`)\n *\n * @see To test examples, append them to the\n * <a href=\"#equation-boilerplate\">boilerplate</a>\n *\n * @example\n * //Simple\n * figure.add({\n *   name: 'eqn',\n *   method: 'equation',\n *   options: {\n *     forms: {\n *       1: { sub: ['x', '_2'] },\n *     },\n *   },\n * });\n * figure.elements._eqn.showForm('1');\n *\n * @example\n * // Example showing different subscript options\n * figure.add({\n *   name: 'eqn',\n *   method: 'equation',\n *   options: {\n *     forms: {\n *       // Object form\n *       1: {\n *         sub: {\n *           content: 'x',\n *           subscript: 'b',\n *         },\n *       },\n *       // Array form\n *       2: [{ sub: ['x', 'b'] }, ' ', { sub: ['y', 'd'] }],\n *       3: { sub: ['x', ['b', '  ', '+', '  ', 'd']] },\n *       // Subscript offset to adjust layout to keep animation smooth\n *       4: {\n *         sub: {\n *           content: 'x',\n *           subscript: { frac: [['b', '  ', '+', '  ', 'd'], 'vinculum', '_2'] },\n *           offset: [-0.025, -0.02],\n *         },\n *       },\n *     },\n *     formSeries: ['1', '2', '3', '4'],\n *   },\n * });\n * const eqn = figure.elements._eqn;\n * eqn.onClick = () => eqn.nextForm();\n * eqn.setTouchableRect(0.5);\n * eqn.showForm('1');\n */\nexport type EQN_Subscript = {\n  content: TypeEquationPhrase;\n  subscript: TypeEquationPhrase;\n  scale?: number,\n  offset?: TypeParsablePoint,\n  inSize: boolean,\n} | [\n  TypeEquationPhrase,\n  TypeEquationPhrase,\n  ?number,\n  ?TypeParsablePoint,\n  ?boolean,\n];\n\n/**\n * Equation superscript\n *\n * ![](./apiassets/eqn_superscript.gif)\n *\n * Options can be an object, or an array in the property order below\n *\n * @property {TypeEquationPhrase} content\n * @property {TypeEquationPhrase} superscript\n * @property {number} [scale] scale of superscript (`0.5`)\n * @property {TypeParsablePoint} [offset] offset of superscript (`[0, 0]`)\n * @property {boolean} [inSize] `true` excludes superscript from size of\n * resulting phrase (`true`)\n *\n * @see To test examples, append them to the\n * <a href=\"#equation-boilerplate\">boilerplate</a>\n *\n * @example\n * // Simple\n * figure.add({\n *   name: 'eqn',\n *   method: 'equation',\n *   options: {\n *     forms: {\n *       1: { sup: ['e', 'x'] },\n *     },\n *   },\n * });\n * figure.elements._eqn.showForm('1');\n *\n * @example\n * // Examples of superscript animations\n * figure.add({\n *   name: 'eqn',\n *   method: 'equation',\n *   options: {\n *     forms: {\n *       // Object form\n *       1: {\n *         sup: {\n *           content: 'e',\n *           superscript: 'x',\n *         },\n *       },\n *       // Array form\n *       2: [{ sup: ['e', 'x'] }, '  ', { sup: ['e_1', 'y'] }],\n *       3: { sup: ['e', ['x', '  ', '+', '  ', 'y']] },\n *     },\n *     formSeries: ['1', '2', '3'],\n *   },\n * });\n * const eqn = figure.elements._eqn;\n * eqn.onClick = () => eqn.nextForm();\n * eqn.setTouchableRect(0.5);\n * eqn.showForm('1');\n */\nexport type EQN_Superscript = {\n  content: TypeEquationPhrase;\n  superscript: TypeEquationPhrase;\n  scale?: number,\n  offset?: TypeParsablePoint,\n  inSize: boolean,\n} | [\n  TypeEquationPhrase,\n  TypeEquationPhrase,\n  ?number,\n  ?TypeParsablePoint,\n  ?boolean,\n];\n\n/**\n * Equation superscript and subscript\n *\n * ![](./apiassets/eqn_supsub.gif)\n *\n * Options can be an object, or an array in the property order below\n *\n * @property {TypeEquationPhrase} content\n * @property {TypeEquationPhrase} superscript\n * @property {TypeEquationPhrase} subscript\n * @property {number} [scale] scale of superscript (`0.5`)\n * @property {TypeParsablePoint} [superscriptOffset] offset of superscript (`[0, 0]`)\n * @property {TypeParsablePoint} [subscriptOffset] offset of subscript (`[0, 0]`)\n * @property {boolean} [inSize] `true` excludes superscript from size of\n * resulting phrase (`true`)\n *\n * @see To test examples, append them to the\n * <a href=\"#equation-boilerplate\">boilerplate</a>\n *\n * @example\n * // Simple\n * figure.add({\n *   name: 'eqn',\n *   method: 'equation',\n *   options: {\n *     forms: {\n *       1: { supSub: ['x', 'b', 'a'] },\n *     },\n *   },\n * });\n * figure.elements._eqn.showForm('1'); *\n *\n * @example\n * // Example showing different super-sub script options\n * figure.add({\n *   name: 'eqn',\n *   method: 'equation',\n *   options: {\n *     forms: {\n *       // Object form\n *       1: {\n *         supSub: {\n *           content: 'x',\n *           superscript: 'b',\n *           subscript: 'a',\n *         },\n *       },\n *       // Array form\n *       2: [{ supSub: ['x', 'b', 'a'] }, '  ', { supSub: ['x_1', 'c', 'a_1'] }],\n *       3: { supSub: ['x', ['b', '  ', '+', '  ', 'c'], 'a'] },\n *     },\n *     formSeries: ['1', '2', '3'],\n *   },\n * });\n * const eqn = figure.elements._eqn;\n * eqn.onClick = () => eqn.nextForm();\n * eqn.setTouchableRect(0.5);\n * eqn.showForm('1');\n */\nexport type EQN_SuperscriptSubscript = {\n  content: TypeEquationPhrase;\n  subscript: TypeEquationPhrase;\n  superscript: TypeEquationPhrase;\n  scale?: number;\n  superscriptOffset?: TypeParsablePoint;\n  subscriptOffset?: TypeParsablePoint;\n  inSize?: boolean,\n} | [\n  TypeEquationPhrase,\n  TypeEquationPhrase,\n  TypeEquationPhrase,\n  ?number,\n  ?TypeParsablePoint,\n  ?TypeParsablePoint,\n  ?boolean,\n];\n\n/**\n * Equation comment options used with `topComment` and `bottomComment`\n * functions.\n *\n * ![](./apiassets/eqn_comment.gif)\n *\n * A symbol between the content and comment is optional.\n *\n * Options can be an object, or an array in the property order below\n *\n * @property {TypeEquationPhrase} content\n * @property {TypeEquationPhrase} comment\n * @property {string} [symbol] optional symbol between content and comment\n * @property {number} [contentSpace] space from content to symbol (`0.03`)\n * @property {number} [commentSpace] space from symbol to comment (`0.03`)\n * @property {number} [contentLineSpace] space between a line symbol and\n * content (`0.03`)\n * @property {number} [commentLineSpace] space between a line symbol and\n * comment (`0.03`)\n * @property {number} [scale] comment scale (`0.6`)\n * @property {boolean} [inSize] `false` excludes the symbol and comment from\n * thre resulting size of the equation phrase (`true`)\n * @property {boolean} [fullContentBounds] use full bounds of content,\n * overriding any `inSize=false` properties in the content (`false`)\n * @property {boolean} [useFullBounds] make the bounds of this phrase equal to\n * the full bounds of the content even if `fullContentBounds=false` and the\n * brackets only surround a portion of the content (`false`)\n *\n * @see To test examples, append them to the\n * <a href=\"#equation-boilerplate\">boilerplate</a>\n *\n * @example\n * // Simple\n * figure.add({\n *   name: 'eqn',\n *   method: 'equation',\n *   options: {\n *     forms: {\n *       1: { topComment: ['radius', 'r = 1'] },\n *     },\n *   },\n * });\n * figure.elements._eqn.showForm('1');\n *\n * @example\n * // Some different comment examples\n * figure.add({\n *   name: 'eqn',\n *   method: 'equation',\n *   options: {\n *     elements: {\n *       bBkt: { symbol: 'bracket', side: 'bottom' },\n *       tBrc: { symbol: 'brace', side: 'top' },\n *       bSqr: { symbol: 'squareBracket', side: 'bottom' },\n *     },\n *     forms: {\n *       // Array equation\n *       1: { topComment: ['a \\u00d7 b \\u00d7 c', 'b = 1, c = 1', 'tBrc'] },\n *       // Object definition\n *       2: {\n *         bottomComment: {\n *           content: 'a \\u00d7 b \\u00d7 c',\n *           symbol: 'bBkt',\n *           comment: 'b = 1, c = 1',\n *         },\n *       },\n *       // Additional options for layout\n *       3: {\n *         bottomComment: {\n *           content: 'a \\u00d7 b \\u00d7 c',\n *           symbol: 'bSqr',\n *           comment: 'b = 1, c = 1',\n *           contentSpace: 0.1,\n *           commentSpace: 0.1,\n *           scale: 0.7,\n *         },\n *       },\n *       // Just comment\n *       4: {\n *         bottomComment: {\n *           content: 'a \\u00d7 b \\u00d7 c',\n *           comment: 'for a > 3',\n *         },\n *       },\n *     },\n *     formSeries: ['1', '2', '3', '4']\n *   },\n * });\n * const eqn = figure.elements._eqn;\n * eqn.onClick = () => eqn.nextForm();\n * eqn.setTouchableRect(0.5);\n * eqn.showForm('1');\n */\nexport type EQN_Comment = {\n  content: TypeEquationPhrase;\n  comment: TypeEquationPhrase;\n  symbol?: string;\n  contentSpace?: number;\n  commentSpace?: number;\n  contentLineSpace?: number;\n  commentLineSpace?: number;\n  scale?: number;\n  inSize?: boolean;\n  fullContentBounds?: boolean;\n  useFullBounds?: boolean;\n} | [\n  TypeEquationPhrase,\n  TypeEquationPhrase,\n  string,\n  ?number,\n  ?number,\n  ?number,\n  ?boolean,\n  ?boolean,\n  ?boolean,\n];\n\n/**\n * Equation strike with comment options used with `topStrike` and `bottomStrike`\n * functions.\n *\n * ![](./apiassets/eqn_strikecomment.gif)\n *\n * Options can be an object, or an array in the property order below\n *\n * @property {TypeEquationPhrase} content\n * @property {string} symbol strike symbol\n * @property {TypeEquationPhrase} comment\n * @property {boolean} [inSize] `false` excludes the symbol and comment from\n * thre resulting size of the equation phrase (`true`)\n * @property {number} [space] top, right, bottom and left extension of symbol\n * beyond content (`0.03`)\n * @property {number} [scale] comment scale (`0.6`)\n * @property {number} [commentSpace] space from symbol to comment (`0.03`)\n *\n * @see To test examples, append them to the\n * <a href=\"#equation-boilerplate\">boilerplate</a>\n *\n * @example\n * // Simple\n * figure.add({\n *   name: 'eqn',\n *   method: 'equation',\n *   options: {\n *     elements: {\n *       x: { symbol: 'strike', color: [0.6, 0.6, 0.6, 1] },\n *     },\n *     forms: {\n *       1: { topStrike: ['radius', 'x', 'radius = 1'] },\n *     },\n *   },\n * });\n * figure.elements._eqn.showForm('1');\n *\n * @example\n * // Some different strike examples\n * figure.add({\n *   name: 'eqn',\n *   method: 'equation',\n *   options: {\n *     elements: {\n *       s1: { symbol: 'strike', style: 'forward', color: [0.6, 0.6, 0.6, 1] },\n *     },\n *     forms: {\n *       // Array equation\n *       1: { topStrike: ['radius', 's1', 'radius = 1'] },\n *       // Object definition\n *       2: {\n *         bottomStrike: {\n *           content: 'radius',\n *           symbol: 's1',\n *           comment: 'radius = 1',\n *         },\n *       },\n *       // Additional options for layout\n *       3: {\n *         bottomStrike: {\n *           content: 'radius',\n *           comment: 'radius = 1',\n *           symbol: 's1',\n *           scale: 0.8,\n *           space: 0.1,\n *           commentSpace: 0.01,\n *         },\n *       },\n *     },\n *     formSeries: ['1', '2', '3']\n *   },\n * });\n * const eqn = figure.elements._eqn;\n * eqn.onClick = () => eqn.nextForm();\n * eqn.setTouchableRect(0.5);\n * eqn.showForm('1');\n */\nexport type EQN_StrikeComment = {\n  content?: TypeEquationPhrase,\n  symbol?: string,\n  comment?: TypeEquationPhrase,\n  inSize?: boolean,\n  space?: number,\n  scale?: number,\n  commentSpace?: number,\n} | [\n  ?TypeEquationPhrase,\n  ?string,\n  ?TypeEquationPhrase,\n  ?boolean,\n  ?number,\n  ?number,\n  ?number,\n];\n\n\n/**\n * Equation padding options.\n *\n * ![](./apiassets/eqn_pad.gif)\n *\n * Pads the size of the equation phrase with space.\n *\n * Options can be an object, or an array in the property order below\n *\n * @property {TypeEquationPhrase} content\n * @property {number} [top] (`0`)\n * @property {number} [right] (`0`)\n * @property {number} [bottom] (`0`)\n * @property {number} [left] (`0`)\n *\n * @see To test examples, append them to the\n * <a href=\"#equation-boilerplate\">boilerplate</a>\n *\n * @example\n * // Simple\n * figure.add({\n *   name: 'eqn',\n *   method: 'equation',\n *   options: {\n *     forms: {\n *       1: ['a', { pad: ['b', 0.1, 0.1, 0.1, 0.1] }, 'c'],\n *     },\n *   },\n * });\n * figure.elements._eqn.showForm('1');\n *\n * @example\n * // Some different padding examples\n * figure.add({\n *   name: 'eqn',\n *   method: 'equation',\n *   options: {\n *     forms: {\n *       // No padding\n *       1: ['a', 'b', 'c'],\n *       // Array form\n *       2: ['a', { pad: ['b', 0.1, 0.1, 0.1, 0.1] }, 'c'],\n *       // Object form\n *       3: [\n *         'a',\n *         {\n *           pad: {\n *             content: 'b',\n *             left: 0.3,\n *             right: 0.1,\n *           },\n *         },\n *         'c',\n *       ],\n *     },\n *     formSeries: ['1', '2', '3'],\n *   },\n * });\n * const eqn = figure.elements._eqn;\n * eqn.onClick = () => eqn.nextForm();\n * eqn.setTouchableRect(0.5);\n * eqn.showForm('1');\n */\nexport type EQN_Pad = {\n  content: TypeEquationPhrase;\n  top?: number,\n  right?: number,\n  bottom?: number,\n  left?: number,\n} | [\n  TypeEquationPhrase,\n  ?number,\n  ?number,\n  ?number,\n  ?number,\n];\n\n/**\n * Equation matrix\n *\n * ![](./apiassets/eqn_matrix.gif)\n *\n * Options can be an object, or an array in the property order below\n *\n * @property {[number, number]} [order] (`[1, length-of-content]`)\n * @property {string} [left] left bracket symbol\n * @property {Array<TypeEquationPhrase>} [content] Array of equation phrases\n * where each element is a matrix element\n * @property {string} [right] right bracket symbol\n * @property {number} [scale] scale of matrix elements (`0.7`)\n * @property {'max' | 'min' | TypeParsablePoint} [fit] cell size -\n * `min` each cell is a rectangle with width equal to largest width in its\n * column, and height equal to largest height in its row - `max`\n * all cells are a square with dimension equal to the largest dimension of the\n * largest cell - `point` all cells are a rectangle with width as point.x and\n * height as point.y - note - `max` and `point` only work with\n * `yAlign`=`'middle'` (`'min'`)\n * @property {TypeParsablePoint} [space] space between each cell\n * (`[0.05, 0.05]`)\n * @property {'baseline' | 'middle'} [yAlign] align cells in a row with the\n * text baseline, or middle of the cell (`baseline`)\n * @property {EQN_Bracket} [brac] bracket options not including\n * the symbols (`{}`)\n * @property {boolean} [fullContentBounds] use full bounds of content,\n * overriding any `inSize=false` properties in the content (`false`)\n *\n * @see To test examples, append them to the\n * <a href=\"#equation-boilerplate\">boilerplate</a>\n *\n * @example\n * // Simple\n * figure.add({\n *   name: 'eqn',\n *   method: 'equation',\n *   options: {\n *     elements: {\n *       lb: { symbol: 'squareBracket', side: 'left' },\n *       rb: { symbol: 'squareBracket', side: 'right' },\n *     },\n *     forms: {\n *       1: { matrix: [[2, 2], 'lb', ['a', 'b', 'c', 'd'], 'rb'] },\n *     },\n *   },\n * });\n * figure.elements._eqn.showForm('1');\n *\n * @example\n * // Some different bar examples\n * figure.add({\n *   name: 'eqn',\n *   method: 'equation',\n *   options: {\n *     elements: {\n *       lb: { symbol: 'squareBracket', side: 'left' },\n *       rb: { symbol: 'squareBracket', side: 'right' },\n *       v: { symbol: 'vinculum' },\n *     },\n *     phrases: {\n *       f: { frac: ['a', 'v', 'b'] },\n *     },\n *     forms: {\n *       // Array equation 2x2 matrix\n *       1: { matrix: [[2, 2], 'lb', ['a', 'b', 'c', 'd'], 'rb'] },\n *       // Object definition vector\n *       2: {\n *         matrix: {\n *           content: ['a', 'b', 'c', 'd'],\n *           left: 'lb',\n *           right: 'rb',\n *           order: [1, 4],\n *         },\n *       },\n *       // Additional options for layout\n *       3: {\n *         matrix: {\n *           content: ['f', 'wxyz', 'c', 'd'],\n *           symbol: 'bSqr',\n *           left: 'lb',\n *           right: 'rb',\n *           order: [2, 2],\n *         },\n *       },\n *       // Fixed size matrix cells\n *       4: {\n *         matrix: {\n *           content: ['f', 'wxyz', 'c', 'd'],\n *           symbol: 'bSqr',\n *           left: 'lb',\n *           right: 'rb',\n *           order: [2, 2],\n *           fit: [0.2, 0.2],\n *           yAlign: 'middle',\n *         },\n *       },\n *     },\n *     formSeries: ['1', '2', '3', '4']\n *   },\n * });\n * const eqn = figure.elements._eqn;\n * eqn.onClick = () => eqn.nextForm();\n * eqn.setTouchableRect(0.5);\n * eqn.showForm('1');\n */\nexport type EQN_Matrix = {\n  order?: [number, number],\n  left?: string,\n  content: TypeEquationPhrase,\n  right?: string,\n  scale?: number,\n  fit?: 'max' | 'min' | TypeParsablePoint,\n  space?: TypeParsablePoint,\n  yAlign?: 'baseline' | 'middle',\n  brac?: EQN_Bracket,\n  fullContentBounds?: boolean,\n} | [\n  ?[number, number],\n  ?string,\n  TypeEquationPhrase,\n  ?string,\n  ?number,\n  ?'max' | 'min',\n  ?TypeParsablePoint,\n  ?'baseline' | 'middle',\n  ?EQN_Bracket,\n  ?boolean,\n];\n\n\n/**\n * An annotation's layout is defined by its *position* and *alignement*.\n * For instance, an annotation at the top right of the content:\n * <pre>\n *                  AAAA\n *                  AAAA\n *          CCCCCCCC\n *          CCCCCCCC\n *          CCCCCCCC\n *          CCCCCCCC\n * </pre>\n * has a *position* relative to the content:\n * * `xPosition`: `'right'`\n * * `yPosition`: `'top'`\n *\n * and an *alignment* relative to the annotation:\n * * `xAlign`: `'left'`\n * * `yAlign`: `'bottom'`\n *\n *\n * In comparison, if `yAlign` were equal to `'top'`, then it would result in:\n * <pre>\n *          CCCCCCCCAAAA\n *          CCCCCCCCAAAA\n *          CCCCCCCC\n *          CCCCCCCC\n * </pre>\n * @property {TypeEquationPhrase} content\n * @property {'left' | 'center' | 'right' | number} [xPosition] where number is\n *  the percentage width of the content (`'center'`)\n * @property {'bottom' | 'baseline' | 'middle' | 'top' | number} [yPosition]\n * where number is the percentage height of the content (`'top'`)\n * @property {'left' | 'center' | 'right' | number} [xAlign] where number is\n * the percentage width of the annotation (`'center'`)\n * @property {'bottom' | 'baseline' | 'middle' | 'top' | number} [yAlign] where\n * number is the percentage width of the annotation (`'bottom'`)\n * @property {Point} [offset] annotation offset (`[0, 0]`)\n * @property {number} [scale] annotation scale (`1`)\n * @property {boolean} [inSize] (`true`)\n * @property {boolean} [fullContentBounds] (`false`)\n * @property {string} [reference] calling getBounds on a glyph can return a\n * suggested position, alignment and offset of an annotation with some name. If\n * this name is defined here, then `xPosition`, `yPosition`, `xAlign`, `yAlign`\n * and `offset` will be overwritten with the glyph's suggestion.\n * @example\n *  annotate: {\n *    content: 'a',\n *    annotation: {\n *      content: 'b',\n *      xPosition: 'right',\n *      yPosition: 'top',\n *      xAlign: 'left',\n *      yAlign: 'bottom',\n *      offset: [0, 0],\n *      scale: 0.5,\n *      inSize: true,\n *      fullContentBounds: false,\n *      // reference: 'root'       // only used when annotating special glyphs\n *    },\n *  },\n */\nexport type EQN_Annotation = {\n  xPosition: 'left' | 'center' | 'right' | number,\n  yPosition: 'bottom' | 'baseline' | 'middle' | 'top' | number,\n  xAlign: 'left' | 'center' | 'right' | number,\n  yAlign: 'bottom' | 'baseline' | 'middle' | 'top' | number,\n  offset: Point,\n  scale: number,\n  content: TypeEquationPhrase,\n  inSize: boolean,\n  fullContentBounds: boolean,\n  reference?: string,\n};\n\n/**\n * A glyph can encompass (surround or overlay) an equation phrase (*content*). The glyph\n * can also be annotated.\n * <pre>\n *\n *       gggggggggggggg\n *       gggCCCCCCCCggg\n *       gggCCCCCCCCggg\n *       gggCCCCCCCCggg\n *       gggCCCCCCCCggg\n *       gggggggggggggg\n *\n * </pre>\n * @property {string} symbol\n * @property {EQN_Annotation} [annotation] use for one annotation only instead\n * of property `annotations`\n * @property {Array<EQN_Annotation>} [annotations] use for one or more\n * annotations\n * @property {number} [space] default space the glyph should extend beyond the\n * top, right, left and bottom sides of the content (`0`)\n * @property {number} [topSpace] space the glyph extends beyond the content top\n * @property {number} [rightSpace] space the glyph extends beyond the content\n * right\n * @property {number} [bottomSpace] space the glyph extends beyond the content\n * bottom\n * @property {number} [leftSpace] space the glyph extends beyond the content\n * left\n * @example\n *  // surrounding content with a box glyph\n * annotate: {\n *   content: 'a',\n *   glyphs: {\n *     encompass: {\n *       symbol: 'box',\n *       space: 0.1,     // e.g. only, this will be overwritten by next props\n *       topSpace: 0.1,\n *       rightSpace: 0.1,\n *       bottomSpace: 0.1,\n *       leftSpace: 0.1,\n *     },\n *   },\n * },\n */\nexport type EQN_EncompassGlyph = {\n  symbol?: string,\n  annotation?: EQN_Annotation,\n  annotations?: Array<EQN_Annotation>,\n  space: number;\n  topSpace?: number;\n  rightSpace?: number;\n  bottomSpace?: number;\n  leftSpace?: number;\n};\n\n/**\n * A glyph can be to the left or right of an equation phrase (*content*).\n * The glyph can also be annotated.\n * <pre>\n *\n *       ggg   CCCCCCCC   ggg\n *       ggg   CCCCCCCC   ggg\n *       ggg   CCCCCCCC   ggg\n *       ggg   CCCCCCCC   ggg\n *\n * </pre>\n * @property {string} symbol\n * @property {EQN_Annotation} [annotation] use for one annotation only instead\n * of property `annotations`\n * @property {Array<EQN_Annotation>} [annotations] use for one or more\n * annotations\n * @property {number} [space] horizontal space between glyph and content (`0`)\n * @property {number} [overhang] amount glyph extends above content top and\n * below content bottom (`0`)\n * @property {number} [topSpace] amount glyph extends above content top\n * @property {number} [bottomSpace] amount glyph extends below content bottom\n * @property {number} [minContentHeight] force min content height for auto\n * glyph scaling\n * @property {number} [minContentDescent] force min content descent for auto\n * glyph scaling\n * @property {number} [minContentAscent] force min content ascent for auto\n * scaling\n * @property {number} [descent] force descent of glyph\n * @property {number} [height] force height of glyph\n * @property {number} [yOffset] offset glyph in y (`0`)\n * @property {boolean} [annotationsOverContent] `true` means only glyph is\n * separated from content by `space` and not annotations (false`)\n * @example\n * // Define glyph symbol\n * eqn.addElements({\n *   lb: { symbol: 'squareBracket', side: 'left' },\n * });\n *  // surrounding content with a box glyph\n * annotate: {\n *   content: 'a',\n *   glyphs: {\n *     left: {\n *       symbol: 'lb',\n *       space: 0.1,\n *       overhang: 0.2,\n *       topSpace: 0.1,\n *       bottomSpace: 0.1,\n *       minContentHeight: 0.3,\n *       minContentDescent: 0.1,\n *       descent: 0.1,\n *       height: 0.3,\n *       yOffset: 0,\n *       annotationsOverContent: true,\n *   },\n * },\n */\nexport type EQN_LeftRightGlyph = {\n  symbol?: string,\n  annotation?: EQN_Annotation,\n  annotations?: Array<EQN_Annotation>,\n  space?: number;\n  overhang?: number,\n  topSpace?: number;\n  bottomSpace?: number;\n  minContentHeight?: number,\n  minContentDescent?: number;\n  minContentAscent?: number,\n  descent?: number,\n  height?: number,\n  yOffset?: number,\n  annotationsOverContent?: boolean,\n};\n\n/**\n * A glyph can be to the top or bottom of an equation phrase (*content*).\n * The glyph can also be annotated.\n * <pre>\n *\n *          gggggggg\n *          gggggggg\n *\n *          CCCCCCCC\n *          CCCCCCCC\n *          CCCCCCCC\n *          CCCCCCCC\n *\n *          gggggggg\n *          gggggggg\n *\n * </pre>\n * @property {string} symbol\n * @property {EQN_Annotation} [annotation] use for one annotation only instead\n * of property `annotations`\n * @property {Array<EQN_Annotation>} [annotations] use for one or more\n * annotations\n * @property {number} [space] vertical space between glyph and content (`0`)\n * @property {number} [overhang] amount glyph extends above content top and\n * below content bottom (`0`)\n * @property {number} [width] force width of glyph\n * @property {number} [leftSpace] amount glyph extends beyond content left\n * @property {number} [rightSpace] amount glyph extends beyond content right\n * @property {number} [xOffset] offset glyph in x (`0`)\n * @property {boolean} [annotationsOverContent] `true` means only glyph is\n * separated from content by `space` and not annotations (false`)\n * @example\n * // Define glyph symbol\n * eqn.addElements({\n *   lb: { symbol: 'squareBracket', side: 'left' },\n * });\n *  // surrounding content with a box glyph\n * annotate: {\n *   content: 'a',\n *   glyphs: {\n *     left: {\n *       symbol: 'lb',\n *       space: 0.1,\n *       overhang: 0.2,\n *       width: 0.3,\n *       leftSpace: 0.1,\n *       rightSpace: 0.1,\n *       xOffset: 0,\n *       annotationsOverContent: true,\n *   },\n * },\n */\nexport type EQN_TopBottomGlyph = {\n  symbol?: string,\n  annotation?: EQN_Annotation,\n  annotations?: Array<EQN_Annotation>,\n  space?: number;\n  overhang?: number,\n  width?: number,\n  leftSpace?: number,\n  rightSpace?: number,\n  xOffset?: number,\n  annotationsOverContent?: boolean,\n};\n\n/**\n * Options object that aligns a line glyph with either the content or\n * annotation.\n *\n * @property {'left' | 'center' | 'right' | number | string} [xAlign]\n * @property {'bottom' | 'baseline' | 'middle' | 'top' | number | string,} [yAlign]\n * @property {0} [space]\n */\nexport type EQN_LineGlyphAlign = {\n  xAlign?: 'left' | 'center' | 'right' | number | string,\n  yAlign?: 'bottom' | 'baseline' | 'middle' | 'top' | number | string,\n  space?: 0,\n}\n\n/**\n * A glyph can be a line between the content and an annotation\n * <pre>\n *\n *                         aaaaa\n *                         aaaaa\n *                       g\n *                     g\n *                   g\n *          CCCCCCCCC\n *          CCCCCCCCC\n *          CCCCCCCCC\n *          CCCCCCCCC\n *\n * </pre>\n * @property {string} symbol\n * @property {EQN_LineGlyphAlign} [content] alignment and spacing to content\n * @property {EQN_LineGlyphAlign} [annotation] alignment and spacing to annotation\n * @property {number} [annotationIndex] annotation index to draw line to\n *\n * @example\n * figure.add({\n *   name: 'eqn',\n *   method: 'equation',\n *   options: {\n *     elements: {\n *       line: { symbol: 'line', width: 0.005, dash: [0.01, 0.01] },\n *     },\n *     forms: {\n *       0: {\n *         annotate: {\n *           content: 'abc',\n *           annotation: {\n *             content: 'def',\n *             xPosition: 'right',\n *             yPosition: 'top',\n *             xAlign: 'left',\n *             yAlign: 'bottom',\n *             scale: 0.6,\n *             offset: [0.2, 0.2],\n *           },\n *           glyphs: {\n *             line: {\n *               annotation: 0,\n *               symbol: 'line',\n *               content: {\n *                 xAlign: 'right',\n *                 yAlign: 'top',\n *                 space: 0.02,\n *               },\n *               comment: {\n *                 xAlign: 'left',\n *                 yAlign: 'bottom',\n *                 space: 0.02,\n *               },\n *             },\n *           },\n *         },\n *       },\n *     },\n *   },\n * });\n */\nexport type EQN_LineGlyph = {\n  symbol: string,\n  content?: EQN_LineGlyphAlign,\n  annotation?: EQN_LineGlyphAlign,\n  annotationIndex?: number,\n}\n\n/**\n * Object defining all the glyphs annotating some content.\n *\n * Multiple glyphs are ok, but only one per position.\n *\n * @property {EQN_EncompassGlyph} [encompass]\n * @property {EQN_TopBottomGlyph} [top]\n * @property {EQN_LeftRightGlyph} [right]\n * @property {EQN_TopBottomGlyph} [bottom]\n * @property {EQN_LeftRightGlyph} [left]\n * @property {EQN_LineGlyph} [line]\n */\nexport type EQN_Glyphs = {\n  left?: EQN_LeftRightGlyph;\n  right?: EQN_LeftRightGlyph;\n  top?: EQN_TopBottomGlyph;\n  bottom?: EQN_TopBottomGlyph;\n  encompass?: EQN_EncompassGlyph;\n  line?: EQN_LineGlyph;\n};\n\n\n/**\n * Equation annotation\n *\n * ![](./apiassets/eqn_annotate.gif)\n *\n * An annotation is an equation phrase ('annotation') which is laid out relative\n * to another equation phrase ('content'). For example:\n * <pre>\n *                  AAAA\n *                  AAAA\n *          CCCCCCCC\n *          CCCCCCCC\n *          CCCCCCCC\n *          CCCCCCCC\n * </pre>\n *\n * The options for defining how to annotate one equation phrase with another is\n * {@link EQN_Annotation}\n *\n * Content can also be annotated with a glyph (that itself may also be\n * annotated). The glyph can either encompass the content, or can be to the\n * top, bottom, left or right of the content\n *\n * <pre>\n *                         Top Glyph\n *                  GGGGGGGGGGGGGGGGGGGGGGG\n *                  GGGGGGGGGGGGGGGGGGGGGGG     Encompassing Glyph\n *                                            /\n *                                          /\n *        GGG       GGGGGGGGGGGGGGGGGGGGGGG        GGG\n *        GGG       GGG                 GGG        GGG\n *        GGG       GGG     CCCCCCC     GGG        GGG\n * Left   GGG       GGG     CCCCCCC     GGG        GGG   Right\n * Glyph  GGG       GGG     CCCCCCC     GGG        GGG   Glyph\n *        GGG       GGG                 GGG        GGG\n *        GGG       GGGGGGGGGGGGGGGGGGGGGGG        GGG\n *\n *\n *                  GGGGGGGGGGGGGGGGGGGGGGG\n *                  GGGGGGGGGGGGGGGGGGGGGGG\n *                       Bottom Glyph\n * </pre>\n *\n * This function is used internally by almost all equation functions\n * (except for fraction) for their layout. As such, it is very generic and\n * powerful. It should also almost never neeed to be used as most layouts\n * can be achieved with a different functions that will have more succinct\n * code that is more readable.\n *\n * This is provided so all layout corner cases not covered by the functions\n * above are possible - including with custom glyphs.\n *\n * Options can *only* be an object.\n *\n * @property {TypeEquationPhrase} content\n * @property {EQN_Annotation} [annotation] use for just one annotation\n * @property {Array<EQN_Annotation>} [annotations] use for multiple annotations\n * @property {boolean} [inSize] `true` means resulting size includes\n * annotations (`true`)\n * @property {number} [space] extend resulting equation phrase size by space on\n * top, right, bottom and left sides (`0`)\n * @property {number} [topSpace] extend resulting equation phrase size by space\n * on top\n * @property {number} [bottomSpace] extend resulting equation phrase size by\n * space on bottom\n * @property {number} [leftSpace] extend resulting equation phrase size by space\n * on left\n * @property {number} [rightSpace] extend resulting equation phrase size by\n * space on right\n * @property {number} [contentScale] scale content (`1`)\n * @property {EQN_Glyphs} [glyphs] glyphs to annotate content with\n * @property {boolean} [fullContentBounds] use full bounds of content,\n * overriding any `inSize=false` properties in the content (`false`)\n * @property {boolean} [useFullBounds] make the bounds of this phrase equal to\n * the full bounds of the content even if `fullContentBounds=false` and the\n * brackets only surround a portion of the content (`false`)\n *\n * @see To test examples, append them to the\n * <a href=\"#equation-boilerplate\">boilerplate</a>\n *\n * @example\n * // Some different annotation examples\n * figure.add({\n *   name: 'eqn',\n *   method: 'equation',\n *   options: {\n *     elements: {\n *       bar: { symbol: 'bar', side: 'right' },\n *     },\n *     forms: {\n *       // Single annotation\n *       1: {\n *         annotate: {\n *           content: 'a',\n *           annotation: {\n *             content: 'bbb',\n *             yPosition: 'top',\n *             yAlign: 'bottom',\n *             xPosition: 'left',\n *             xAlign: 'right',\n *             scale: 0.5,\n *           },\n *         },\n *       },\n *       // Multiple annotations\n *       2: {\n *         annotate: {\n *           content: 'a',\n *           annotations: [\n *             {\n *               content: 'bbb',\n *               yPosition: 'top',\n *               yAlign: 'bottom',\n *               xPosition: 'left',\n *               xAlign: 'right',\n *               scale: 0.5,\n *             },\n *             {\n *               content: 'ccc',\n *               xPosition: 'right',\n *               yPosition: 'middle',\n *               xAlign: 'left',\n *               yAlign: 'middle',\n *               scale: 0.5,\n *               offset: [0.05, 0],\n *             },\n *           ],\n *         },\n *       },\n *       // With glyph\n *       3: {\n *         annotate: {\n *           content: 'a',\n *           glyphs: {\n *             left:{\n *               symbol: 'bar',\n *               overhang: 0.1,\n *               annotation: {\n *                 content: 'bbb',\n *                 xPosition: 'right',\n *                 yPosition: 'bottom',\n *                 xAlign: 'left',\n *                 yAlign: 'middle',\n *                 scale: 0.5,\n *               },\n *             },\n *           },\n *         },\n *       },\n *     },\n *     formSeries: ['1', '2', '3'],\n *   },\n * });\n * const eqn = figure.elements._eqn;\n * eqn.onClick = () => eqn.nextForm();\n * eqn.setTouchableRect(0.5);\n * eqn.showForm('1');\n */\nexport type EQN_Annotate = {\n  content: TypeEquationPhrase,\n  annotation?: EQN_Annotation,\n  annotations?: Array<EQN_Annotation>,\n  fullContentBounds?: boolean,\n  useFullBounds?: boolean,\n  glyphs?: EQN_Glyphs,\n  inSize?: boolean,\n  space?: number,\n  topSpace?: number,\n  bottomSpace?: number,\n  leftSpace?: number,\n  rightSpace?: number,\n  contentScale?: number,\n};\n\n// There are lots of FlowFixMes in this file. This is not perfect, but\n// haven't been able to come up with a quick work around. The problem statement\n// is each function can accept as arguements either a full object definition\n// or the definition split over parameters.\n// The problem is then the first arguement can be so many types, some of which\n// are subsets of the other, then when its parameters are extracted, their type\n// is all confused.\n\n/**\n * Equation Functions.\n *\n * Contains methods for all equation functions.\n */\nexport class EquationFunctions {\n  // eslint-disable-next-line no-use-before-define\n  elements: { [name: string]: FigureElementCollection | FigureElementPrimitive };\n  shapes: {};\n  contentToElement: (TypeEquationPhrase | Elements) => Elements;\n  phrases: {\n    [phraseName: string]: TypeEquationPhrase,\n  };\n\n  fullLineHeight: EquationForm | null;\n  addElementFromKey: (string, Object) => ?FigureElementPrimitive;\n  getExistingOrAddSymbol: (string | Object) => ?FigureElementPrimitive;\n\n  // [methodName: string]: (TypeEquationPhrase) => {};\n\n  /**\n   * @hideconstructor\n   */\n  // eslint-disable-next-line no-use-before-define\n  constructor(\n    elements: { [name: string]: FigureElementCollection | FigureElementPrimitive },\n    addElementFromKey: (string) => ?FigureElementPrimitive,\n    getExistingOrAddSymbol: (string | Object) => ?FigureElementPrimitive,\n  ) {\n    this.elements = elements;\n    this.phrases = {};\n    this.fullLineHeight = null;\n    this.addElementFromKey = addElementFromKey;\n    this.getExistingOrAddSymbol = getExistingOrAddSymbol;\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  stringToElement(content: string) {\n    if (content.startsWith('space')) {\n      const spaceNum = parseFloat(content.replace(/space[_]*/, '')) || 0.03;\n      return new Element(new BlankElement(spaceNum));\n    }\n    if (content.startsWith(' ')) {\n      const spaceNum = content.length * 0.03;\n      return new Element(new BlankElement(spaceNum));\n    }\n    const figureElement = getFigureElement(this.elements, content);\n    if (figureElement) {\n      return new Element(figureElement);\n    }\n    if (content in this.phrases) {\n      return this.parseContent(this.phrases[content]);\n    }\n    const elementFromKey = this.addElementFromKey(content, {});\n    if (elementFromKey != null) {\n      return new Element(elementFromKey);\n    }\n    return null;\n  }\n\n  parseContent(content: ?TypeEquationPhrase) {\n    if (content == null) {\n      return null;\n    }\n    if (typeof content === 'number') {\n      return null;\n    }\n    if (content instanceof Elements) {\n      return content;\n    }\n    if (content instanceof BaseAnnotationFunction) {\n      return content;\n    }\n    if (typeof content === 'string') {\n      return this.stringToElement(content);\n    }\n    if (Array.isArray(content)) {\n      let elementArray = [];\n      content.forEach((c) => {      // $FlowFixMe\n        const result = this.parseContent(c);\n        if (Array.isArray(result)) {\n          elementArray = [...elementArray, ...result];\n        } else {\n          elementArray.push(result);\n        }\n      });\n      return elementArray;\n    }\n    // Otherwise its an object\n    const [method, params] = Object.entries(content)[0];\n    // if (this[method] != null) {\n    // return this[method](params);\n    // }\n    // $FlowFixMe\n    const eqnMethod = this.eqnMethod(method, params);\n    if (eqnMethod != null) {\n      return eqnMethod;\n    }\n    // If it is not a known function, then it must be a new text or\n    // symbol element           // $FlowFixMe\n    const elem = this.addElementFromKey(method, params);     // $FlowFixMe\n    return new Element(elem);\n  }\n\n  contentToElement(\n    content: TypeEquationPhrase | Elements | FigureElementPrimitive | FigureElementCollection,\n  ): Elements {\n    // If input is alread an Elements object, then return it\n    if (content instanceof Elements) {\n      return content._dup();\n    }\n    if (content instanceof FigureElementCollection\n      || content instanceof FigureElementPrimitive\n    ) {\n      return new Elements([new Element(content)]);\n    }\n    let elementArray = this.parseContent(content);\n    if (!Array.isArray(elementArray)) {\n      elementArray = [elementArray];\n    }\n    return new Elements(elementArray);\n  }\n\n  eqnMethod(name: string, params: {}) {\n    // $FlowFixMe\n    if (name === 'frac') { return this.frac(params); }  // $FlowFixMe\n    if (name === 'strike') { return this.strike(params); }    // $FlowFixMe\n    if (name === 'box') { return this.box(params); }          // $FlowFixMe\n    if (name === 'tBox') { return this.touchBox(params); }          // $FlowFixMe\n    if (name === 'root') { return this.root(params); }        // $FlowFixMe\n    if (name === 'brac') { return this.brac(params); }        // $FlowFixMe\n    if (name === 'sub') { return this.sub(params); }          // $FlowFixMe\n    if (name === 'sup') { return this.sup(params); }          // $FlowFixMe\n    if (name === 'supSub') { return this.supSub(params); }    // $FlowFixMe\n    if (name === 'topBar') { return this.topBar(params); }    // $FlowFixMe\n    if (name === 'bottomBar') { return this.bottomBar(params); } // $FlowFixMe\n    if (name === 'annotate') { return this.annotate(params); } // $FlowFixMe\n    if (name === 'bottomComment') { return this.bottomComment(params); } // $FlowFixMe\n    if (name === 'topComment') { return this.topComment(params); } // $FlowFixMe\n    if (name === 'bar') { return this.bar(params); }               // $FlowFixMe\n    if (name === 'topStrike') { return this.topStrike(params); }   // $FlowFixMe\n    if (name === 'bottomStrike') { return this.bottomStrike(params); } // $FlowFixMe\n    if (name === 'pad') { return this.pad(params); }   // $FlowFixMe\n    if (name === 'int') { return this.int(params); }   // $FlowFixMe\n    if (name === 'sumOf') { return this.sumProd(params); }   // $FlowFixMe\n    if (name === 'prodOf') { return this.sumProd(params); }   // $FlowFixMe\n    if (name === 'matrix') { return this.matrix(params); }   // $FlowFixMe\n    if (name === 'scale') { return this.scale(params); }   // $FlowFixMe\n    if (name === 'container') { return this.container(params); }\n    return null;\n  }\n\n  /**\n   * Equation container function\n   * @see {@link EQN_Container} for description and examples\n   */\n  container(\n    options: EQN_Container,\n  ) {\n    let content;\n    let scale;\n    let fit; // fits content to container - width, height, contain, null\n    let width;\n    let ascent;\n    let descent;\n    let xAlign; // left, center, right, multiplier (to left)\n    let yAlign; // bottom, baseline, middle, top, multiplier (to bottom)\n    let fullContentBounds;\n\n    const defaultOptions = {\n      scaleModifier: 1,\n      fit: null,\n      width: null,\n      ascent: null,\n      descent: null,\n      xAlign: 'center',\n      yAlign: 'baseline',\n      fullContentBounds: false,\n    };\n    if (Array.isArray(options)) {\n      [\n        content, width, descent, ascent, xAlign, yAlign, fit, scale,\n        fullContentBounds,\n      ] = options;\n    } else {\n      ({\n        content, width, descent, ascent, xAlign, yAlign, fit, scale,\n        fullContentBounds,\n      } = options);\n    }\n    const optionsIn = {\n      scaleModifier: scale,\n      fit,\n      width,\n      ascent,\n      descent,\n      xAlign,\n      yAlign,\n      fullContentBounds,\n    };\n    const o = joinObjects(defaultOptions, optionsIn);\n    return new Container(\n      [this.contentToElement(content)],\n      [],\n      o,\n    );\n  }\n\n  /**\n   * Equation bracket function\n   * @see {@link EQN_Bracket} for description and examples\n   */\n  brac(\n    options: EQN_Bracket,\n  ) {\n    let content;\n    let left;\n    let right;\n    let insideSpace;\n    let outsideSpace;\n    let topSpace;\n    let bottomSpace;\n    let minContentHeight;\n    let minContentDescent;\n    let descent;\n    let height;\n    let inSize;\n    let useFullBounds;\n    let fullContentBounds;\n\n    if (Array.isArray(options)) {\n      [\n        left, content, right, inSize, insideSpace, outsideSpace,   // $FlowFixMe\n        topSpace, bottomSpace, minContentHeight,                   // $FlowFixMe\n        minContentDescent, height, descent, fullContentBounds,     // $FlowFixMe\n        useFullBounds,\n      ] = options;\n    } else {\n      ({\n        left, content, right, inSize, insideSpace, outsideSpace,\n        topSpace, bottomSpace, minContentHeight,\n        minContentDescent, height, descent, fullContentBounds, useFullBounds,\n      } = options);\n    }\n    const defaultOptions = {\n      insideSpace: 0.03,\n      outsideSpace: 0.03,\n      topSpace: 0.05,\n      bottomSpace: 0.05,\n      minContentHeight: null,\n      minContentDescent: null,\n      descent: null,\n      height: null,\n      inSize: true,\n      useFullBounds: false,\n      fullContentBounds: false,\n    };\n    const optionsIn = {\n      insideSpace,\n      outsideSpace,\n      topSpace,\n      bottomSpace,\n      minContentHeight,\n      minContentDescent,\n      descent,\n      height,\n      inSize,\n      useFullBounds,\n      fullContentBounds,\n    };\n    const o = joinObjects({}, defaultOptions, optionsIn);\n    const glyphs = {};\n    if (left) {\n      glyphs.left = {\n        symbol: left,\n        space: o.insideSpace,\n        topSpace: o.topSpace,\n        bottomSpace: o.bottomSpace,\n        minContentHeight: o.minContentHeight,\n        minContentDescent: o.minContentDescent,\n        descent: o.descent,\n        height: o.height,\n      };\n    }\n    if (right) {\n      glyphs.right = {\n        symbol: right,\n        space: o.insideSpace,\n        topSpace: o.topSpace,\n        bottomSpace: o.bottomSpace,\n        minContentHeight: o.minContentHeight,\n        minContentDescent: o.minContentDescent,\n        descent: o.descent,\n        height: o.height,\n      };\n    }\n    return this.annotate({\n      content,\n      glyphs,\n      inSize: o.inSize,\n      leftSpace: o.outsideSpace,\n      rightSpace: o.outsideSpace,\n      useFullBounds: o.useFullBounds,\n      fullContentBounds: o.fullContentBounds,\n    });\n  }\n\n  /**\n   * Equation bar function\n   * @see {@link EQN_Bar} for description and examples\n   */\n  bar(\n    options: EQN_Bar,\n    forceOptions: Object = {},\n  ) {\n    let content;\n    let symbol;\n    let side;\n    let space;\n    let overhang;\n    let length;\n    let left;\n    let right;\n    let top;\n    let bottom;\n    let inSize;\n    let minContentHeight;\n    let minContentDescent;\n    let minContentAscent;\n    let descent;\n    let fullContentBounds;\n    let useFullBounds;\n    const defaultOptions = {\n      inSize: true,\n      space: 0.03,\n      overhang: 0,\n      length: null,\n      left: null,\n      right: null,\n      top: null,\n      bottom: null,\n      side: 'top',\n      minContentHeight: null,\n      minContentDescent: null,\n      minContentAscent: null,\n      descent: null,\n      fullContentBounds: false,\n      useFullBounds: false,\n    };\n    if (Array.isArray(options)) {\n      [\n        content, symbol, inSize, space, overhang,\n        length, left, right, top, bottom,\n        side, minContentHeight, minContentDescent,\n        minContentAscent, descent, fullContentBounds, useFullBounds,\n      ] = options;\n    } else {\n      ({\n        content, symbol, inSize, space, overhang,\n        length, left, right, top, bottom,\n        side, minContentHeight, minContentDescent,\n        minContentAscent, descent, fullContentBounds, useFullBounds,\n      } = options);\n    }\n    const optionsIn = {\n      side,\n      space,\n      overhang,\n      length,\n      left,\n      right,\n      top,\n      bottom,\n      inSize,\n      minContentHeight,\n      minContentDescent,\n      minContentAscent,\n      descent,\n      fullContentBounds,\n      useFullBounds,\n    };\n    const o = joinObjects({}, defaultOptions, optionsIn, forceOptions);\n\n    const glyphs = {};\n    if (o.side === 'top') {\n      glyphs.top = {\n        symbol,\n        space: o.space,\n        overhang: o.overhang,\n        leftSpace: o.left,\n        rightSpace: o.right,\n        width: o.length,\n      };\n    }\n    if (o.side === 'bottom') {\n      glyphs.bottom = {\n        symbol,\n        space: o.space,\n        overhang: o.overhang,\n        leftSpace: o.left,\n        rightSpace: o.right,\n        width: o.length,\n      };\n    }\n    if (o.side === 'left') {\n      glyphs.left = {\n        symbol,\n        space: o.space,\n        overhang: o.overhang,\n        topSpace: o.top,\n        bottomSpace: o.bottom,\n        height: o.length,\n        minContentHeight: o.minContentHeight,\n        minContentDescent: o.minContentDescent,\n        minContentAscent: o.minContentAscent,\n        descent: o.descent,\n      };\n    }\n    if (o.side === 'right') {\n      glyphs.right = {\n        symbol,\n        space: o.space,\n        overhang: o.overhang,\n        topSpace: o.top,\n        bottomSpace: o.bottom,\n        height: o.length,\n        minContentHeight: o.minContentHeight,\n        minContentDescent: o.minContentDescent,\n        minContentAscent: o.minContentAscent,\n        descent: o.descent,\n      };\n    }\n    return this.annotate({\n      content,                            // $FlowFixMe\n      glyphs,\n      inSize: o.inSize,\n      fullContentBounds: o.fullContentBounds,\n      useFullBounds: o.useFullBounds,\n    });\n  }\n\n  // /**\n  //  */\n  // pointer(options: EQN_Pointer) {\n  //   const defaultOptions = {\n  //     xPosition: 'center',\n  //     yPosition: 'top',\n  //     xAlign: 'center',\n  //     yAlign: 'bottom',\n  //     offset: new Point(0, 0),\n  //     scale: 1,\n  //     inSize: true,\n  //     fullContentBounds: false,\n  //     glyph: {\n  //       content: {\n  //         xPosition: 'center',\n  //         yPosition: 'top',\n  //         offset: new Point(0, 0),\n  //         space: 0.05,\n  //       },\n  //       comment: {\n  //         xPosition: 'center',\n  //         yPosition: 'top',\n  //         offset: new Point(0, 0),\n  //         space: 0.05,\n  //       }\n  //     }\n  //   }\n  // }\n\n  /**\n   * Equation annotate function\n   * @see {@link EQN_Annotate} for description and examples\n   */\n  annotate(options: EQN_Annotate) {\n    const defaultOptions = {\n      inSize: true,\n      useFullBounds: false,\n      fullContentBounds: false,\n      space: 0,\n      contentScale: 1,\n      encompass: {\n        space: 0,\n      },\n      left: {\n        space: 0,\n        overhang: 0,\n        yOffset: 0,\n        annotationsOverContent: false,\n      },\n      right: {\n        space: 0,\n        overhang: 0,\n        yOffset: 0,\n        annotationsOverContent: false,\n      },\n      top: {\n        space: 0,\n        overhang: 0,\n        xOffset: 0,\n        annotationsOverContent: false,\n      },\n      bottom: {\n        space: 0,\n        overhang: 0,\n        xOffset: 0,\n        annotationsOverContent: false,\n      },\n      line: {\n        content: {\n          xAlign: 'left',\n          yAlign: 'bottom',\n          space: 0,\n        },\n        annotation: {\n          xAlign: 'left',\n          yAlign: 'bottom',\n          space: 0,\n        },\n        annotationIndex: 0,\n      },\n    };\n    const {\n      content, annotation, annotations, glyphs,\n    } = options;\n\n    const defaultAnnotation = {\n      xPosition: 'center',\n      yPosition: 'top',\n      xAlign: 'center',\n      yAlign: 'bottom',\n      offset: new Point(0, 0),\n      scale: 1,\n      inSize: true,\n      fullContentBounds: false,\n    };\n    let annotationsToProcess = [];\n    if (annotation != null) {\n      annotationsToProcess.push(annotation);\n    } else if (annotations != null) {\n      annotationsToProcess = annotations;\n    }\n\n    const fillAnnotation = (ann) => {\n      const annCopy = joinObjects({}, defaultAnnotation, ann);  // $FlowFixMe\n      annCopy.offset = getPoint(annCopy.offset);     // $FlowFixMe\n      annCopy.content = this.contentToElement(ann.content);\n      return annCopy;\n    };\n\n    const fillAnnotations = (anns) => {\n      if (anns == null || !Array.isArray(anns)) {\n        return [];\n      }\n      const annsCopy = [];\n      anns.forEach((ann) => {\n        annsCopy.push(fillAnnotation(ann));\n      });\n      return annsCopy;\n    };\n    const annotationsToUse = fillAnnotations(annotationsToProcess);\n\n    const glyphsToUse = {};\n\n    const fillGlyphAnnotation = (side) => {\n      if (glyphs == null) {\n        return;\n      }\n      const glyphSide = glyphs[side];\n      if (glyphSide == null) {\n        return;\n      }\n      glyphsToUse[side] = {}; // $FlowFixMe\n      let glyphAnnotationsToProcess = glyphSide.annotations;\n      // $FlowFixMe\n      if (glyphSide.annotation != null) {      // $FlowFixMe\n        glyphAnnotationsToProcess = [glyphSide.annotation];\n      }\n      const glyphAnnotationsToUse = fillAnnotations(glyphAnnotationsToProcess);\n      glyphsToUse[side] = joinObjects({}, defaultOptions[side], glyphSide);\n      glyphsToUse[side].annotations = glyphAnnotationsToUse;     // $FlowFixMe\n      glyphsToUse[side].glyph = this.getExistingOrAddSymbol(glyphSide.symbol || '');\n    };\n\n    fillGlyphAnnotation('encompass');\n    fillGlyphAnnotation('left');\n    fillGlyphAnnotation('right');\n    fillGlyphAnnotation('top');\n    fillGlyphAnnotation('bottom');\n    fillGlyphAnnotation('line');\n\n    const o = joinObjects(defaultOptions, options);\n    return new BaseAnnotationFunction(\n      this.contentToElement(content),\n      annotationsToUse,       // $FlowFixMe\n      glyphsToUse,\n      o,\n    );\n  }\n\n\n  /**\n   * Equation annotate function\n   * @see {@link EQN_Scale} for description and examples\n   */\n  scale(\n    options: EQN_Scale,\n  ) {\n    let content;\n    let scale;\n    let fullContentBounds;\n    const defaultOptions = {\n      scaleModifier: 1,\n      fullContentBounds: false,\n    };\n    if (Array.isArray(options)) {\n      [\n        content, scale, fullContentBounds,\n      ] = options;\n    } else {\n      ({\n        content, scale, fullContentBounds,\n      } = options);\n    }\n    const optionsIn = {\n      scaleModifier: scale,\n      fullContentBounds,\n    };\n    const o = joinObjects(defaultOptions, optionsIn);\n    return new Scale(\n      [this.contentToElement(content)],\n      [],\n      o,\n    );\n  }\n\n  /**\n   * Equation fraction function\n   * @see {@link EQN_Fraction} for description and examples\n   */\n  frac(\n    options: EQN_Fraction,\n  ) {\n    let numerator;\n    let denominator;\n    let symbol;\n    let scale;\n    let overhang;\n    let numeratorSpace;\n    let denominatorSpace;\n    let offsetY;\n    let fullContentBounds;\n    let baseline;\n\n    // This is imperfect type checking, as the assumption is if den, sym\n    // and fractionScale is null, then they weren't defined by the caller\n    // and therefore the caller is passing in a TypeFracObject or TypeFracArray\n    // All the flow errors go away if TypeEquationPhrase is removed from\n    // optionsOrNum (and then also remove the first if statement below)\n    const defaultOptions = {\n      scaleModifier: 1,\n      numeratorSpace: 0.05,\n      denominatorSpace: 0.05,\n      offsetY: 0.07,\n      overhang: 0.05,\n      fullContentBounds: false,\n      baseline: 'vinculum',\n    };\n    if (Array.isArray(options)) {\n      [\n        numerator, symbol, denominator, scale,\n        numeratorSpace, denominatorSpace, overhang,\n        offsetY, baseline, fullContentBounds,\n      ] = options;\n    } else {\n      ({\n        numerator, symbol, denominator, scale,\n        numeratorSpace, denominatorSpace, overhang,\n        offsetY, baseline, fullContentBounds,\n      } = options);\n    }\n    const optionsIn = {\n      scaleModifier: scale,\n      overhang,\n      numeratorSpace,\n      denominatorSpace,\n      offsetY,\n      fullContentBounds,\n      baseline,\n    };\n    const o = joinObjects(defaultOptions, optionsIn);\n\n    return new Fraction(\n      [this.contentToElement(numerator), this.contentToElement(denominator)],       // $FlowFixMe\n      this.getExistingOrAddSymbol(symbol),\n      o,\n    );\n  }\n\n  root(optionsOrArray: EQN_Root) {\n    let content;\n    let root;\n    let symbol;\n    let space;\n    let leftSpace;\n    let topSpace;\n    let bottomSpace;\n    let rightSpace;\n    let rootScale;\n    let rootOffset;\n    let inSize = true;\n    let fullContentBounds;\n    let useFullBounds;\n    if (Array.isArray(optionsOrArray)) {\n      [                                                            // $FlowFixMe\n        symbol, content, inSize,                                   // $FlowFixMe\n        space, topSpace, rightSpace, bottomSpace, leftSpace,       // $FlowFixMe\n        root, rootOffset, rootScale, fullContentBounds, useFullBounds,\n      ] = optionsOrArray;\n    } else {\n      ({                                                    // $FlowFixMe\n        symbol, content, inSize,                                   // $FlowFixMe\n        space, topSpace, rightSpace, bottomSpace, leftSpace,       // $FlowFixMe\n        root, rootOffset, rootScale, fullContentBounds, useFullBounds,\n      } = optionsOrArray);\n    }\n\n    const defaultOptions = {\n      space: 0.02,\n      rootScale: 0.6,\n      rootOffset: [0, 0.06],\n      inSize: true,\n      fullContentBounds: false,\n      useFullBounds: false,\n    };\n    const optionsIn = {\n      leftSpace,\n      topSpace,\n      bottomSpace,\n      rightSpace,\n      space,\n      rootScale,\n      rootOffset,\n      inSize,\n      fullContentBounds,\n      useFullBounds,\n    };\n    const options = joinObjects(defaultOptions, optionsIn);\n    options.rootOffset = getPoint(options.rootOffset);\n    const annotations = [];\n    if (root != null) {\n      annotations.push({\n        content: root,\n        offset: options.rootOffset,\n        scale: options.rootScale,\n        reference: 'root',\n      });\n    }\n    return this.annotate({\n      content,\n      inSize: options.inSize,\n      useFullBounds: options.useFullBounds,\n      fullContentBounds: options.fullContentBounds,\n      glyphs: {\n        encompass: {\n          symbol,       // $FlowFixMe\n          annotations,\n          space: options.space,\n          leftSpace: options.leftSpace,\n          rightSpace: options.rightSpace,\n          topSpace: options.topSpace,\n          bottomSpace: options.bottomSpace,\n        },\n      },\n    });\n  }\n\n  /**\n   * Equation super-sub script function\n   * @see {@link EQN_SuperscriptSubscript} for description and examples\n   */\n  supSub(options: EQN_SuperscriptSubscript) {\n    let content;\n    let superscript = null;\n    let subscript = null;\n    let scale = null;\n    let subscriptOffset = null;\n    let superscriptOffset = null;\n    let inSize;\n    if (Array.isArray(options)) {\n      [           // $FlowFixMe\n        content, superscript, subscript, scale,            // $FlowFixMe\n        superscriptOffset, subscriptOffset, inSize,\n      ] = options;\n    } else {\n      ({                                                    // $FlowFixMe\n        content, superscript, subscript, scale, superscriptOffset, subscriptOffset, inSize,\n      } = options);\n    }\n\n    const defaultOptions = {\n      scale: 0.5,\n      subscriptOffset: [0, 0],\n      superscriptOffset: [0, 0],\n      inSize: true,\n    };\n    const optionsIn = {\n      superscript,\n      subscript,\n      scale,\n      subscriptOffset,\n      superscriptOffset,\n      inSize,\n    };\n    const o = joinObjects(defaultOptions, optionsIn);\n\n    const annotations = [];\n    if (superscript != null) {\n      annotations.push({\n        content: o.superscript,\n        xPosition: 'right',\n        yPosition: '0.7a',\n        xAlign: 'left',\n        yAlign: 'baseline',\n        offset: getPoint(o.superscriptOffset).add(new Point(o.scale * 0.04, 0)),\n        scale: o.scale,\n      });\n    }\n    if (subscript != null) {\n      annotations.push({\n        content: o.subscript,\n        xPosition: 'right',\n        yPosition: 'baseline',\n        xAlign: 'left',\n        yAlign: '0.7a',\n        offset: o.subscriptOffset,\n        scale: o.scale,\n      });\n    }\n    return this.annotate({\n      content,      // $FlowFixMe\n      annotations,\n      inSize: o.inSize,\n    });\n  }\n\n  /**\n   * Equation superscript function\n   * @see {@link EQN_Superscript} for description and examples\n   */\n  sup(options: EQN_Superscript) {\n    let content;\n    let superscript;\n    let scale;\n    let offset;\n    // let superscriptOffset = null;\n    let inSize;\n    if (Array.isArray(options)) {\n      [           // $FlowFixMe\n        content, superscript, scale, offset, inSize,           // $FlowFixMe\n      ] = options;\n    } else {\n      ({                                                    // $FlowFixMe\n        content, superscript, scale, offset, inSize,\n      } = options);\n    }\n    // $FlowFixMe\n    return this.supSub({          // $FlowFixMe\n      content,                    // $FlowFixMe\n      superscript,                // $FlowFixMe\n      superscriptOffset: offset,  // $FlowFixMe\n      inSize,                     // $FlowFixMe\n      scale,\n    });\n  }\n\n  /**\n   * Equation subscript function\n   * @see {@link EQN_Subscript} for description and examples\n   */\n  sub(options: EQN_Subscript) {\n    let content;\n    let subscript;\n    let scale;\n    let offset;\n    let inSize;\n    if (Array.isArray(options)) {\n      [           // $FlowFixMe\n        content, subscript, scale, offset, inSize,           // $FlowFixMe\n      ] = options;\n    } else {\n      ({                                                    // $FlowFixMe\n        content, subscript, scale, offset, inSize,\n      } = options);\n    }\n    // $FlowFixMe\n    return this.supSub({          // $FlowFixMe\n      content,                    // $FlowFixMe\n      subscript,                  // $FlowFixMe\n      subscriptOffset: offset,    // $FlowFixMe\n      inSize,                     // $FlowFixMe\n      scale,\n    });\n  }\n\n  /**\n   * Equation touch box function\n   * @see {@link EQN_TouchBox} for description and examples\n   */\n  touchBox(\n    options: EQN_TouchBox,\n  ) {\n    let content;\n    let symbol;\n    let space;\n    let topSpace;\n    let bottomSpace;\n    let leftSpace;\n    let rightSpace;\n    const defaultOptions = {\n      inSize: false,\n      space: 0,\n      topSpace: null,\n      bottomSpace: null,\n      leftSpace: null,\n      rightSpace: null,\n    };\n    if (Array.isArray(options)) {\n      [\n        content, symbol, space, topSpace,\n        rightSpace, bottomSpace, leftSpace,\n      ] = options;\n    } else {\n      ({\n        content, symbol, space, topSpace,\n        rightSpace, bottomSpace, leftSpace,\n      } = options);\n    }\n    const optionsIn = {\n      content,\n      symbol,\n      space,\n      topSpace,\n      rightSpace,\n      bottomSpace,\n      leftSpace,\n    };\n    const o = joinObjects(defaultOptions, optionsIn);\n    return this.annotate({\n      content,\n      inSize: false,\n      fullContentBounds: false,\n      useFullBounds: false,\n      glyphs: {\n        encompass: {\n          symbol,\n          space: o.space,\n          leftSpace: o.leftSpace,\n          rightSpace: o.rightSpace,\n          topSpace: o.topSpace,\n          bottomSpace: o.bottomSpace,\n        },\n      },\n    });\n  }\n\n  /**\n   * Equation box function\n   * @see {@link EQN_Box} for description and examples\n   */\n  box(\n    options: EQN_Box,\n  ) {\n    let content;\n    let symbol;\n    let inSize;\n    let space;\n    let topSpace;\n    let bottomSpace;\n    let leftSpace;\n    let rightSpace;\n    let fullContentBounds;\n    let useFullBounds;\n    const defaultOptions = {\n      inSize: false,\n      space: 0,\n      topSpace: null,\n      bottomSpace: null,\n      leftSpace: null,\n      rightSpace: null,\n      fullContentBounds: false,\n      useFullBounds: false,\n    };\n    if (Array.isArray(options)) {\n      [\n        content, symbol, inSize, space, topSpace,\n        rightSpace, bottomSpace, leftSpace, fullContentBounds, useFullBounds,\n      ] = options;\n    } else {\n      ({\n        content, symbol, inSize, space, topSpace,\n        rightSpace, bottomSpace, leftSpace, fullContentBounds, useFullBounds,\n      } = options);\n    }\n    const optionsIn = {\n      content,\n      symbol,\n      inSize,\n      space,\n      topSpace,\n      rightSpace,\n      bottomSpace,\n      leftSpace,\n      fullContentBounds,\n      useFullBounds,\n    };\n    const o = joinObjects(defaultOptions, optionsIn);\n    return this.annotate({\n      content,\n      inSize: o.inSize,\n      fullContentBounds: o.fullContentBounds,\n      useFullBounds: o.useFullBounds,\n      glyphs: {\n        encompass: {\n          symbol,\n          space: o.space,\n          leftSpace: o.leftSpace,\n          rightSpace: o.rightSpace,\n          topSpace: o.topSpace,\n          bottomSpace: o.bottomSpace,\n        },\n      },\n    });\n  }\n\n  /**\n   * Equation pad function\n   * @see {@link EQN_Pad} for description and examples\n   */\n  pad(\n    options: EQN_Pad,\n  ) {\n    let content;\n    let top;\n    let right;\n    let bottom;\n    let left;\n    const defaultOptions = {\n      top: 0,\n      left: 0,\n      right: 0,\n      bottom: 0,\n    };\n    if (Array.isArray(options)) {\n      [\n        content, top, right, bottom, left,\n      ] = options;\n    } else {\n      ({\n        content, top, right, bottom, left,\n      } = options);\n    }\n    const optionsIn = {\n      top,\n      right,\n      bottom,\n      left,\n    };\n    const o = joinObjects(defaultOptions, optionsIn);\n    return this.annotate({\n      content,\n      topSpace: o.top,\n      bottomSpace: o.bottom,\n      rightSpace: o.right,\n      leftSpace: o.left,\n    });\n  }\n\n  /**\n   * Equation top bar function\n   * @see {@link EQN_Bar} for description and examples\n   */\n  topBar(options: EQN_Bar) {\n    return this.bar(options, { side: 'top' });\n  }\n\n  /**\n   * Equation bottom bar function\n   * @see {@link EQN_Bar} for description and examples\n   */\n  bottomBar(options: EQN_Bar) {\n    return this.bar(options, { side: 'bottom' });\n  }\n\n  /**\n   * Equation matrix function\n   * @see {@link EQN_Matrix} for description and examples\n   */\n  matrix(options: EQN_Matrix) {\n    let content;\n    let left;\n    let right;\n    let order;\n    let fit;\n    let space;\n    let scale;\n    let yAlign;\n    let brac;\n    let fullContentBounds;\n    const defaultOptions = {\n      contentScale: 0.7,\n      fit: 'min',\n      space: [0.05, 0.05],\n      yAlign: 'baseline',\n      brac: {},\n      fullContentBounds: false,\n    };\n    if (Array.isArray(options)) {\n      [\n        order, left, content, right,\n        scale, fit, space, yAlign, brac, fullContentBounds,\n      ] = options;\n    } else {\n      ({\n        order, left, content, right,\n        scale, fit, space, yAlign, brac, fullContentBounds,\n      } = options);\n    }\n    const optionsIn = {\n      space,\n      fit,\n      order,\n      contentScale: scale,\n      brac,\n      yAlign,\n      fullContentBounds,\n    };\n    const o = joinObjects({}, defaultOptions, optionsIn);\n\n    let contentArray = [];\n    if (content != null) {      // $FlowFixMe\n      contentArray = content.map(c => this.contentToElement(c));\n    }\n\n    if (o.order == null\n      || o.order[0] * o.order[1] !== contentArray.length) {\n      o.order = [1, contentArray.length];\n    }\n\n    if (o.space != null) {\n      o.space = getPoint(o.space);\n    }\n\n    const matrixContent = new Matrix(\n      contentArray,\n      [],\n      o,\n    );\n    if (left != null && right != null) {\n      return this.brac(joinObjects({}, o.brac, {\n        content: matrixContent,\n        left,\n        right,\n      }));\n    }\n    return matrixContent;\n  }\n\n  /**\n   * Equation integral function\n   * @see {@link EQN_Integral} for description and examples\n   */\n  int(\n    options: EQN_Integral,\n  ) {\n    let content;\n    let symbol;\n    let space;\n    let topSpace;\n    let bottomSpace;\n    let height;\n    let yOffset;\n    let inSize;\n    let from;\n    let to;\n    let scale;\n    let fromScale;\n    let toScale;\n    // let fromSpace;\n    // let toSpace;\n    let fromOffset;\n    let toOffset;\n    let limitsPosition;\n    let limitsAroundContent;\n    let fromXPosition;\n    let fromYPosition;\n    let fromXAlign;\n    let fromYAlign;\n    let toXPosition;\n    let toYPosition;\n    let toXAlign;\n    let toYAlign;\n    let fullBoundsContent;\n    let useFullBounds;\n    const defaultOptions = {\n      inSize: true,\n      space: 0.01,\n      topSpace: 0.1,\n      bottomSpace: 0.1,\n      height: null,\n      yOffset: 0,\n      contentScale: 1,\n      fromScale: 0.5,\n      toScale: 0.5,\n      fromOffset: [0, 0],\n      toOffset: [0.04, 0],\n      limitsPosition: 'side',\n      limitsAroundContent: true,\n      fromXPosition: 0.5,\n      fromYPosition: 'bottom',\n      fromXAlign: 'left',\n      fromYAlign: 'middle',\n      toXPosition: 'right',\n      toYPosition: 'top',\n      toXAlign: 'left',\n      toYAlign: 'middle',\n      fullBoundsContent: false,\n      useFullBounds: false,\n    };\n    if (Array.isArray(options)) {\n      [                                                    // $FlowFixMe\n        symbol, content, from, to, inSize, space,          // $FlowFixMe\n        topSpace, bottomSpace,                             // $FlowFixMe\n        height, yOffset, scale,                            // $FlowFixMe\n        fromScale, toScale,                                // $FlowFixMe\n        fromOffset, toOffset, limitsPosition,              // $FlowFixMe\n        limitsAroundContent,                               // $FlowFixMe\n        fromXPosition, fromYPosition, fromXAlign, fromYAlign, // $FlowFixMe\n        toXPosition, toYPosition, toXAlign, toYAlign, // $FlowFixMe\n        fullBoundsContent, useFullBounds,\n      ] = options;\n    } else {\n      ({                                                   // $FlowFixMe\n        content, symbol, from, to, inSize, space,          // $FlowFixMe\n        topSpace, bottomSpace,                             // $FlowFixMe\n        height, yOffset,                                   // $FlowFixMe\n        scale, fromScale, toScale,                         // $FlowFixMe\n        fromOffset, toOffset, limitsPosition,              // $FlowFixMe\n        limitsAroundContent,                               // $FlowFixMe\n        fromXPosition, fromYPosition, fromXAlign, fromYAlign, // $FlowFixMe\n        toXPosition, toYPosition, toXAlign, toYAlign, // $FlowFixMe\n        fullBoundsContent, useFullBounds,\n      } = options);\n    }\n    if (limitsPosition === 'topBottom') {\n      defaultOptions.fromXPosition = 0.1;\n      defaultOptions.fromYPosition = 'bottom';\n      defaultOptions.fromXAlign = 'center';\n      defaultOptions.fromYAlign = 'top';        // $FlowFixMe\n      defaultOptions.toXPosition = 0.9;\n      defaultOptions.toYPosition = 'top';\n      defaultOptions.toXAlign = 'center';\n      defaultOptions.toYAlign = 'bottom';\n      defaultOptions.fromOffset = [0, -0.04];\n      defaultOptions.toOffset = [0, 0.04];\n    }\n    if (limitsPosition === 'topBottomCenter') {        // $FlowFixMe\n      defaultOptions.fromXPosition = 'center';\n      defaultOptions.fromYPosition = 'bottom';\n      defaultOptions.fromXAlign = 'center';\n      defaultOptions.fromYAlign = 'top';\n      defaultOptions.toXPosition = 'center';\n      defaultOptions.toYPosition = 'top';\n      defaultOptions.toXAlign = 'center';\n      defaultOptions.toYAlign = 'bottom';\n      defaultOptions.fromOffset = [0, -0.04];\n      defaultOptions.toOffset = [0, 0.04];\n    }\n    const optionsIn = {\n      space,\n      topSpace,\n      bottomSpace,\n      height,\n      yOffset,\n      inSize,\n      contentScale: scale,\n      fromScale,\n      toScale,\n      // fromSpace,\n      // toSpace,\n      fromOffset,\n      toOffset,\n      limitsPosition,\n      limitsAroundContent,\n      fromXPosition,\n      fromYPosition,\n      fromXAlign,\n      fromYAlign,\n      toXPosition,\n      toYPosition,\n      toXAlign,\n      toYAlign,\n      fullBoundsContent,\n      useFullBounds,\n    };\n    const o = joinObjects({}, defaultOptions, optionsIn);\n    o.fromOffset = getPoint(o.fromOffset);\n    o.toOffset = getPoint(o.toOffset);\n\n    const annotations = [\n      {\n        content: to,\n        xPosition: o.toXPosition,\n        yPosition: o.toYPosition,\n        xAlign: o.toXAlign,\n        yAlign: o.toYAlign,\n        offset: o.toOffset,\n        scale: o.toScale,\n      },\n      {\n        content: from,\n        xPosition: o.fromXPosition,\n        yPosition: o.fromYPosition,\n        xAlign: o.fromXAlign,\n        yAlign: o.fromYAlign,\n        offset: o.fromOffset,\n        scale: o.fromScale,\n      },\n    ];\n    return this.annotate({  // $FlowFixMe\n      content,\n      inSize: o.inSize,\n      contentScale: o.contentScale,\n      fullBoundsContent: o.fullBoundsContent,\n      useFullBounds: o.useFullBounds,\n      glyphs: {\n        left: {   // $FlowFixMe\n          symbol,\n          space: o.space,\n          topSpace: o.topSpace,\n          bottomSpace: o.bottomSpace,\n          height: o.height,\n          yOffset: o.yOffset,\n          annotationsOverContent: o.limitsAroundContent,\n          // $FlowFixMe\n          annotations,\n        },\n      },\n    });\n  }\n\n  /**\n   * Equation sum of function\n   * @see {@link EQN_SumOf} for description and examples\n   */\n  sumOf(options: EQN_SumOf) {\n    return this.sumProd(options);\n  }\n\n  /**\n   * Equation product of function\n   * @see {@link EQN_ProdOf} for description and examples\n   */\n  prodOf(options: EQN_ProdOf) {\n    return this.sumProd(options);\n  }\n\n  sumProd(\n    optionsOrArray: EQN_SumOf | EQN_ProdOf,\n  ) {\n    let content;\n    let symbol;\n    let space;\n    let topSpace;\n    let bottomSpace;\n    let height;\n    let yOffset;\n    let inSize;\n    let from;\n    let to;\n    let scale;\n    let fromScale;\n    let toScale;\n    let fromSpace;\n    let toSpace;\n    let fromOffset;\n    let toOffset;\n    let fullBoundsContent;\n    let useFullBounds;\n    const defaultOptions = {\n      inSize: true,\n      space: 0.1,\n      topSpace: 0.07,\n      bottomSpace: 0.07,\n      height: null,\n      yOffset: 0,\n      contentScale: 1,\n      fromScale: 0.5,\n      toScale: 0.5,\n      fromSpace: 0.04,\n      toSpace: 0.04,\n      fromOffset: [0, 0],\n      toOffset: [0, 0],\n      fullBoundsContent: false,\n      useFullBounds: false,\n    };\n    if (Array.isArray(optionsOrArray)) {\n      [\n        symbol, content, from, to, inSize, space,\n        topSpace, bottomSpace,\n        height, yOffset, scale,\n        fromScale, toScale, fromSpace, toSpace, fromOffset, toOffset,\n        fullBoundsContent, useFullBounds,\n      ] = optionsOrArray;\n    } else {\n      ({                                                   // $FlowFixMe\n        symbol, content, from, to, inSize, space,\n        topSpace, bottomSpace,\n        height, yOffset,\n        scale, fromScale, toScale, fromSpace, toSpace, fromOffset, toOffset,\n        fullBoundsContent, useFullBounds,\n      } = optionsOrArray);\n    }\n    const optionsIn = {\n      space,\n      topSpace,\n      bottomSpace,\n      height,\n      yOffset,\n      inSize,\n      contentScale: scale,\n      fromScale,\n      toScale,\n      fromSpace,\n      toSpace,\n      fromOffset,\n      toOffset,\n      fullBoundsContent,\n      useFullBounds,\n    };\n    const options = joinObjects({}, defaultOptions, optionsIn);\n    const annotations = [\n      {\n        content: to,\n        xPosition: 'center',\n        yPosition: 'top',\n        xAlign: 'center',\n        yAlign: 'bottom',\n        offset: getPoint(options.toOffset)\n          .add(0, options.toSpace),\n        scale: options.toScale,\n      },\n      {\n        content: from,\n        xPosition: 'center',\n        yPosition: 'bottom',\n        xAlign: 'center',\n        yAlign: 'top',\n        offset: getPoint(options.fromOffset)\n          .add(0, -options.fromSpace),\n        scale: options.fromScale,\n      },\n    ];\n    return this.annotate({\n      content,\n      contentScale: options.contentScale,\n      fullBoundsContent: options.fullBoundsContent,\n      useFullBounds: options.useFullBounds,\n      glyphs: {\n        left: {         // $FlowFixMe\n          symbol,         // $FlowFixMe\n          annotations,         // $FlowFixMe\n          space: options.space,\n          topSpace: options.topSpace,\n          bottomSpace: options.bottomSpace,\n          yOffset: options.yOffset,\n          height: options.height,\n        },\n      },\n      inSize: options.inSize,\n    });\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  processComment(\n    optionsOrArray: EQN_Comment,\n  ) {\n    let content;\n    let comment;\n    let symbol;\n    let contentSpace;\n    let commentSpace;\n    let contentLineSpace;\n    let commentLineSpace;\n    let scale;\n    let inSize;\n    let fullContentBounds;\n    let useFullBounds;\n    if (Array.isArray(optionsOrArray)) {\n      [\n        content, comment, symbol, contentSpace, commentSpace,\n        scale, inSize, contentLineSpace, commentLineSpace,     // $FlowFixMe\n        fullContentBounds, useFullBounds,\n      ] = optionsOrArray;\n    } else {\n      ({                                                       // $FlowFixMe\n        content, comment, symbol, contentSpace, commentSpace,\n        scale, inSize, contentLineSpace, commentLineSpace,     // $FlowFixMe\n        fullContentBounds, useFullBounds,\n      } = optionsOrArray);\n    }\n    const optionsIn = {\n      contentSpace,\n      commentSpace,\n      scale,\n      inSize,\n      useFullBounds,\n      fullContentBounds,\n      contentLineSpace,\n      commentLineSpace,\n    };\n    const defaultOptions = {\n      contentSpace: 0.03,\n      commentSpace: 0.03,\n      scale: 0.6,\n      inSize: true,\n      fullContentBounds: false,\n      useFullBounds: false,\n      contentLineSpace: 0.03,\n      commentLineSpace: 0.03,\n    };\n\n    const options = joinObjects(defaultOptions, optionsIn);\n    return [\n      content, comment, symbol,\n      options.contentSpace, options.commentSpace, options.scale,\n      options.inSize, options.contentLineSpace, options.commentLineSpace,\n      options.fullContentBounds, options.useFullBounds,\n    ];\n  }\n\n  /**\n   * Equation top comment of function\n   * @param {EQN_Comment} options\n   * @see {@link EQN_Comment} for description and examples\n   */\n  // $FlowFixMe\n  topComment(...args) {\n    const [\n      content, comment, symbol,\n      contentSpaceToUse, commentSpaceToUse, scaleToUse,\n      inSize, contentLineSpace, commentLineSpace, fullContentBounds,\n      useFullBounds,\n    ] = this.processComment(...args);\n    const annotations = [{\n      content: comment,\n      xPosition: 'center',\n      yPosition: 'top',\n      xAlign: 'center',\n      yAlign: 'bottom',\n      scale: scaleToUse,\n      offset: [0, commentSpaceToUse],\n    }];\n    if (symbol === '' || symbol == null) {\n      return this.annotate({\n        content,           // $FlowFixMe\n        annotations,\n        inSize,\n      });\n    }\n    const glyph = this.getExistingOrAddSymbol(symbol);\n    if (glyph instanceof EquationLine) {\n      annotations[0].offset = [0, commentSpaceToUse + contentSpaceToUse];\n      return this.annotate({\n        content,\n        fullContentBounds,\n        useFullBounds,   // $FlowFixMe\n        annotations,\n        glyphs: {\n          line: {\n            symbol,              // $FlowFixMe\n            content: { xAlign: 'center', yAlign: 'top', space: contentLineSpace },\n            annotation: { xAlign: 'center', yAlign: 'bottom', space: commentLineSpace },\n            annotationIndex: 0,\n          },\n        },\n        inSize,\n      });\n    }\n    return this.annotate({\n      content,\n      fullContentBounds,\n      useFullBounds,\n      glyphs: {\n        top: {\n          symbol,              // $FlowFixMe\n          annotations,\n          space: contentSpaceToUse,\n        },\n      },\n      inSize,\n    });\n  }\n\n  /**\n   * Equation bottom comment of function\n   * @param {EQN_Comment} options\n   * @see {@link EQN_Comment} for description and examples\n   */\n  // $FlowFixMe\n  bottomComment(...args) {\n    const [\n      content, comment, symbol,\n      contentSpaceToUse, commentSpaceToUse, scaleToUse,\n      inSize, contentLineSpace, commentLineSpace, fullContentBounds,\n      useFullBounds,\n    ] = this.processComment(...args);\n\n    const annotations = [{\n      content: comment,\n      xPosition: 'center',\n      yPosition: 'bottom',\n      xAlign: 'center',\n      yAlign: 'top',\n      scale: scaleToUse,\n      offset: [0, -commentSpaceToUse],\n    }];\n    if (symbol === '' || symbol == null) {\n      return this.annotate({\n        content,           // $FlowFixMe\n        annotations,\n        inSize,\n      });\n    }\n    const glyph = this.getExistingOrAddSymbol(symbol);\n    if (glyph instanceof EquationLine) {\n      annotations[0].offset = [0, -commentSpaceToUse - contentSpaceToUse];\n      return this.annotate({\n        content,\n        fullContentBounds,\n        useFullBounds,    // $FlowFixMe\n        annotations,\n        glyphs: {\n          line: {\n            symbol,              // $FlowFixMe\n            content: { xAlign: 'center', yAlign: 'bottom', space: contentLineSpace },\n            annotation: { xAlign: 'center', yAlign: 'top', space: commentLineSpace },\n            annotationIndex: 0,\n          },\n        },\n        inSize,\n      });\n    }\n    return this.annotate({\n      content,\n      fullContentBounds,\n      useFullBounds,\n      glyphs: {\n        bottom: {\n          symbol,            // $FlowFixMe\n          annotations,\n          space: contentSpaceToUse,\n        },\n      },\n      inSize,\n    });\n  }\n\n  /**\n   * Equation strike of function\n   * @see {@link EQN_Strike} for description and examples\n   */\n  strike(\n    options: EQN_Strike,\n  ) {\n    let content;\n    let symbol;\n    let inSize;\n    let space;\n    let topSpace;\n    let bottomSpace;\n    let leftSpace;\n    let rightSpace;\n    let fullContentBounds;\n    let useFullBounds;\n\n    const defaultOptions = {\n      inSize: false,\n      space: 0.02,\n      topSpace: null,\n      bottomSpace: null,\n      leftSpace: null,\n      rightSpace: null,\n      fullContentBounds: false,\n      useFullBounds: false,\n    };\n    if (Array.isArray(options)) {\n      [\n        content, symbol, inSize, space, topSpace,\n        rightSpace, bottomSpace, leftSpace, fullContentBounds, useFullBounds,\n      ] = options;\n    } else {\n      ({\n        content, symbol, inSize, space, topSpace,\n        rightSpace, bottomSpace, leftSpace, fullContentBounds, useFullBounds,\n      } = options);\n    }\n    const glyph = this.getExistingOrAddSymbol(symbol);\n    if (glyph != null && glyph.custom.options.style === 'horizontal') {\n      defaultOptions.space = 0;           // $FlowFixMe\n      defaultOptions.leftSpace = 0.02;    // $FlowFixMe\n      defaultOptions.rightSpace = 0.02;   // $FlowFixMe\n    }\n    const optionsIn = {\n      content,\n      symbol,\n      inSize,\n      space,\n      topSpace,\n      rightSpace,\n      bottomSpace,\n      leftSpace,\n      fullContentBounds,\n      useFullBounds,\n    };\n    const o = joinObjects(defaultOptions, optionsIn);\n    // console.log(glyph, o)\n    return this.annotate({\n      content,\n      inSize: o.inSize,\n      fullContentBounds: o.fullContentBounds,\n      useFullBounds: o.useFullBounds,\n      glyphs: {\n        encompass: {\n          symbol,\n          topSpace: o.topSpace,\n          bottomSpace: o.bottomSpace,\n          leftSpace: o.leftSpace,\n          rightSpace: o.rightSpace,\n          space: o.space,\n        },\n      },\n    });\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  processStrike(\n    optionsOrContent: EQN_StrikeComment,\n  ) {\n    let content;\n    let comment;\n    let symbol;\n    let commentSpace;\n    let scale;\n    let space;\n    let inSize;\n    if (Array.isArray(optionsOrContent)) {             // $FlowFixMe\n      [content, symbol, comment, inSize, space, scale, commentSpace] = optionsOrContent;\n    } else {\n      ({                                                      // $FlowFixMe\n        content, comment, symbol, inSize, space, scale, commentSpace,\n      } = optionsOrContent);\n    }\n    const optionsIn = {\n      inSize,\n      commentSpace,\n      scale,\n      space,\n    };\n    const defaultOptions = {\n      space: 0,\n      scale: 0.5,\n      commentSpace: 0.1,\n      inSize: true,\n    };\n    const options = joinObjects(defaultOptions, optionsIn);\n    return [\n      content, symbol, comment, options.inSize,\n      options.commentSpace, options.scale, options.space,\n    ];\n  }\n\n  /**\n   * Equation top strike of function\n   * @param {EQN_Strike} options\n   * @see {@link EQN_Strike} for description and examples\n   */\n  // $FlowFixMe\n  topStrike(...args) {\n    const [\n      content, symbol, comment, inSize,\n      commentSpace, scale, space,\n    ] = this.processStrike(...args);\n    const annotations = [\n      {\n        content: comment,\n        xPosition: 'center',\n        yPosition: 'top',\n        xAlign: 'center',\n        yAlign: 'bottom',\n        offset: [0, commentSpace],\n        scale,\n      },\n    ];\n    return this.annotate({    // $FlowFixMe\n      content,\n      inSize,\n      glyphs: {\n        encompass: {    // $FlowFixMe\n          symbol,\n          space,    // $FlowFixMe\n          annotations,\n        },\n      },\n    });\n  }\n\n  /**\n   * Equation bottom strike of function\n   * @param {EQN_Strike} options\n   * @see {@link EQN_Strike} for description and examples\n   */\n  // $FlowFixMe\n  bottomStrike(...args) {\n    const [\n      content, symbol, comment, inSize,\n      commentSpace, scale, space,\n    ] = this.processStrike(...args);\n    const annotations = [\n      {\n        content: comment,\n        xPosition: 'center',\n        yPosition: 'bottom',\n        xAlign: 'center',\n        yAlign: 'top',\n        offset: [0, -commentSpace],\n        scale,\n      },\n    ];\n    return this.annotate({    // $FlowFixMe\n      content,\n      inSize,\n      glyphs: {\n        encompass: {    // $FlowFixMe\n          symbol,\n          space,    // $FlowFixMe\n          annotations,\n        },\n      },\n    });\n  }\n}\n","// @flow\nimport {\n  Point, Transform,\n} from '../../tools/g2';\nimport type {\n  TypeBorder,\n} from '../../tools/g2';\nimport { joinObjects } from '../../tools/tools';\nimport FigurePrimitives from '../FigurePrimitives/FigurePrimitives';\n// import { FigureElementCollection } from '../Element';\n// import Integral from './Symbols/Integral';\n// import SuperSub from './Elements/SuperSub';\nimport Bracket from './Symbols/Bracket';\n// import BracketNew from './Symbols/BracketNew';\nimport Box from './Symbols/Box';\n// import Radical from './Symbols/Radical';\nimport Brace from './Symbols/Brace';\nimport SquareBracket from './Symbols/SquareBracket';\nimport AngleBracket from './Symbols/AngleBracket';\n// import SquareBracketNew from './Symbols/SquareBracketNew';\nimport Bar from './Symbols/Bar';\nimport Sum from './Symbols/Sum';\nimport Product from './Symbols/Product';\n// import SimpleIntegral from './Symbols/SimpleIntegral';\nimport Integral from './Symbols/Integral';\nimport Arrow from './Symbols/Arrow';\nimport type { OBJ_LineArrows } from '../geometries/arrow';\nimport VinculumNew from './Symbols/Vinculum';\nimport Strike from './Symbols/Strike';\nimport Radical from './Symbols/Radical';\nimport Line from './Symbols/Line';\nimport type {\n  TypeColor, TypeDash,\n} from '../../tools/types';\n\n// import BracketNew from './Symbols/BracketNew';\n// import BraceNew from './Symbols/BraceNew';\n\n// import { Annotation, AnnotationInformation } from './Elements/Annotation';\n// export type TypeSymbolOptions = {\n//   color?: TypeColor,\n//   numLines?: number,\n//   side?: 'left' | 'right' | 'bottom' | 'top',\n//   width?: number,\n//   fill?: boolean,\n//   staticSize?: ?(Point | [number, number] | number),\n//   startWidth?: number,\n//   lineWidth?: number,\n//   startHeight?: number,\n//   maxStartWidth?: ?number,\n//   maxStartHeight?: ?number,\n//   proportionalToHeight?: boolean,\n//   endLength?: number,\n//   sides?: number,\n//   tipWidth?: number,\n//   radius?: number,\n//   arrowWidth?: number,\n//   arrowHeight?: number,\n// }\n\n/**\n * Base object options for all equation symbols\n *\n * `isTouchable`, `touchBorder`, `color` and `onClick` change the corresponding\n * properties on the {@link FigureElementPrimitive}, and could therefore also\n * be set in `mods`. However, as these are commonly used, they are included in\n * the root object for convenience.\n */\nexport type EQN_Symbol = {\n  color?: TypeColor,\n  isTouchable?: boolean,\n  touchBorder?: TypeBorder | 'border' | number | 'rect' | 'draw' | 'buffer',\n  onClick?: () => void | string | null,\n  mods?: Object,\n};\n\n/**\n * Vinculum equation symbol\n *\n * <pre>\n *                          width\n *       |<---------------------------------------->|\n *       |                                          |\n *       |                                          | ____\n *       00000000000000000000000000000000000000000000   A\n *       00000000000000000000000000000000000000000000   |  lineWidth\n *       00000000000000000000000000000000000000000000 __V_\n *\n * </pre>\n * @property {'vinculum'} symbol\n * @property {number} [lineWidth] (`0.01`)\n * @property {'static' | 'dynamic'} [draw] `'dynamic'` updates vertices on\n * resize, `'static'` only changes scale transform (`dynamic`)\n * @property {number | 'first'} [staticWidth] used when `draw`=`static`.\n * `number` sets width of static symbol - `'first'` calculates and sets width\n * based on first use (`'first'`)\n *\n * @extends EQN_Symbol\n *\n * @example\n * eqn.addElements({\n *   v: {\n *     symbol: 'vinculum',\n *     color: [1, 0, 0, 1],\n *     lineWidth: 0.01,\n *   },\n * })\n */\nexport type EQN_VinculumSymbol = {\n  symbol: 'vinculum',\n  lineWidth?: number,\n  draw?: 'static' | 'dynamic',\n  staticWidth?: number | 'first',\n  staticHeight?: number | 'first',\n} & EQN_Symbol;\n\n/**\n * Box equation symbol\n *\n * <pre>\n *                                          width\n *                 |<--------------------------------------------------->|\n *                 |                                                     |\n *                 |                                                     |\n *\n *         ------- 0000000000000000000000000000000000000000000000000000000\n *         A       0000000000000000000000000000000000000000000000000000000\n *         |       0000                                               0000\n *         |       0000                                               0000\n *         |       0000                                               0000\n *  height |       0000                                               0000\n *         |       0000                                               0000\n *         |       0000                                               0000\n *         |       0000                                               0000\n *         |       0000                                               0000\n *         |       0000000000000000000000000000000000000000000000000000000\n *         V______ 0000000000000000000000000000000000000000000000000000000\n *\n * </pre>\n *\n * @property {'box'} symbol\n * @property {number} [lineWidth] (`0.01`)\n * @property {boolean} [fill] (`false`)\n * @property {number} [width] force width instead of auto calculation\n * @property {number} [height] force height instead of auto calculation\n * @property {'static' | 'dynamic'} [draw] `'dynamic'` updates vertices on\n * resize, `'static'` only changes scale transform (`dynamic`)\n * @property {number | 'first'} [staticWidth] used when `draw`=`static`.\n * `number` sets width of static symbol - `'first'` calculates and sets width\n * based on first use\n * @property {number | 'first'} [staticHeight] used when `draw`=`static`.\n * `number` sets height of static symbol - `'first'` calculates and sets height\n * based on first use\n *\n * @extends EQN_Symbol\n *\n * @example\n * eqn.addElements({\n *   b: {\n *     symbol: 'box',\n *     color: [1, 0, 0, 1],\n *     lineWidth: 0.01,\n *     fill: false,\n *   },\n * })\n */\nexport type EQN_BoxSymbol = {\n  symbol: 'box',\n  fill?: boolean,\n  width?: number,\n  height?: number,\n  lineWidth?: number,\n  draw?: 'static' | 'dynamic',\n  staticWidth?: number | 'first',\n  staticHeight?: number | 'first',\n} & EQN_Symbol;\n\n/**\n * Arrow equation symbol\n * <pre>\n *                             arrowWidth\n *                         |<--------------->|\n *                         |                 |\n *                         |                 |\n *                  -------|------- 0        |\n *                  A      |      00000      |\n *    arrowHeight   |      |     0000000     |\n *                  |      |   00000000000   |\n *                  V      | 000000000000000 |\n *                  ------ 0000000000000000000\n *                               0000000\n *                               0000000\n *                               0000000\n *                               0000000\n *                               0000000\n *                               0000000\n *                               0000000\n *                               0000000\n *                               0000000\n *                               0000000\n *                               0000000\n *                               0000000\n *                               0000000\n *                               0000000\n *                               0000000\n *                               0000000\n *                               |     |\n *                               |     |\n *                               |<--->|\n *                              lineWidth\n * </pre>\n * @property {'arrow'} symbol\n * @property {'up' | 'down' | 'left' | 'right'} [direction] (`'right'`)\n * @property {number} [lineWidth] (`0.01`)\n * @property {number} [arrowWidth] (`0.01`)\n * @property {number} [arrowHeight] (`0.04`)\n * @property {number} [lineWidth] (`0.01`)\n * @property {'static' | 'dynamic'} [draw] `'dynamic'` updates vertices on\n * resize, `'static'` only changes scale transform (`dynamic`)\n * @property {number | 'first'} [staticHeight] used when `draw`=`static`.\n * `number` sets height of static symbol - `'first'` calculates and sets height\n * based on first use (`'first'`)\n *\n * @extends EQN_Symbol\n *\n * @example\n * eqn.addElements({\n *   a: {\n *     symbol: 'arrow',\n *     color: [1, 0, 0, 1],\n *     direction: 'right'\n *     lineWidth: 0.01,\n *     arrowHeight: 0.02,\n *     arrowWidth: 0.02,\n *   },\n * })\n */\nexport type EQN_ArrowSymbol = {\n  symbol: 'arrow',\n  direction?: 'up' | 'down' | 'left' | 'right',\n  lineWidth?: number,\n  arrowHeight?: number,\n  arrowWidth?: number,\n  draw?: 'static' | 'dynamic',\n  staticHeight?: number | 'first',\n} & EQN_Symbol;\n\n/**\n * Sum equation symbol\n * <pre>\n *          ---------- 00000000000000000000000000000000000\n *          A            0000000                     000000\n *          |              0000000                      000\n *          |                0000000                      00\n *          |                  0000000\n *          |                    0000000\n *          |                      0000000\n *          |                        0000000\n *          |                          0000000\n *          |                            0000000\n *          |                              0000000\n *          |                                000000\n *          |                                  000\n *          |                                0000\n *   height |                              0000\n *          |                            0000   \\\n *          |                          0000      \\\n *          |                        0000         lineWidth\n *          |                      0000\n *          |                    0000\n *          |                  0000\n *          |                0000                          00\n *          |              0000                          000|\n *          |            0000                         000000|\n *          V          000000000000000000000000000000000000 |\n *          --------  000000000000000000000000000000000000  |\n *                   |                                      |\n *                   |                                      |\n *                   |                 width                |\n *                   |<------------------------------------>|\n * </pre>\n * @property {'sum'} symbol\n * @property {number} [lineWidth] (`height * 0.88 / (25 * height + 15)`)\n * @property {number} [sides] number of sides that make up serif curve (`5`)\n * @property {'static' | 'dynamic'} [draw] `'static'` updates vertices on\n * resize, `'static'` only changes scale transform (`dynamic`)\n * @property {number | 'first'} [staticHeight] used when `draw`=`static`.\n * `number` sets height of static symbol - `'first'` calculates and sets height\n * based on first use (`'first'`)\n *\n * @extends EQN_Symbol\n *\n * @example\n * eqn.addElements({\n *   s: {\n *     symbol: 'sum',\n *     color: [1, 0, 0, 1],\n *     lineWidth: 0.01\n *     sides: 5,\n *   },\n * })\n */\nexport type EQN_SumSymbol ={\n  symbol: 'sum',\n  lineWidth?: number,\n  sides?: number,\n  draw?: 'static' | 'dynamic',\n  staticHeight?: number | 'first',\n} & EQN_Symbol;\n\n/**\n * Product equation symbol used in {@link EQN_ProdOf}\n * <pre>\n *                                          width\n *                |<--------------------------------------------------------->|\n *                |                                                           |\n *                |                                                           |\n *                |                                                           |\n *                |                          lineWidth                        |\n *                |                            /                              |\n *                |                           /                               |\n *          ---- 00000000000000000000000000000000000000000000000000000000000000\n *          A         000000000000000000000000000000000000000000000000000000\n *          |           00000000000000000000000000000000000000000000000000\n *          |            00000000000                         00000000000\n *          |            00000000000                         00000000000\n *          |            00000000000                         00000000000\n *          |            00000000000                         00000000000\n *          |            00000000000                         00000000000\n *          |            00000000000                         00000000000\n *          |            00000000000                         00000000000\n *          |            00000000000                         00000000000\n *          |            00000000000                         00000000000\n *  height  |            00000000000                         00000000000\n *          |            00000000000                         00000000000\n *          |            00000000000                         00000000000\n *          |            00000000000                         00000000000\n *          |            00000000000                         00000000000\n *          |            00000000000                         00000000000\n *          |            00000000000                         00000000000\n *          |            00000000000                         00000000000\n *          |            00000000000                         00000000000\n *          |            00000000000                         00000000000\n *          |            00000000000                         00000000000\n *          |            00000000000                         00000000000\n *          |           0000000000000                       00000000000000\n *          V         00000000000000000                   000000000000000000\n *          ----- 0000000000000000000000000           00000000000000000000000000\n * </pre>\n * @property {'prod'} symbol\n * @property {number} [lineWidth] (related to height)\n * @property {number} [sides] number of sides that make up serif curve (`5`)\n * @property {'static' | 'dynamic'} [draw] `'static'` updates vertices on\n * resize, `'static'` only changes scale transform (`dynamic`)\n * @property {number | 'first'} [staticHeight] used when `draw`=`static`.\n * `number` sets height of static symbol - `'first'` calculates and sets height\n * based on first use (`'first'`)\n *\n * @extends EQN_Symbol\n *\n * @example\n * eqn.addElements({\n *   p: {\n *     symbol: 'prod',\n *     color: [1, 0, 0, 1],\n *     lineWidth: 0.01\n *     sides: 5,\n *   },\n * })\n */\nexport type EQN_ProdSymbol = {\n  symbol: 'prod',\n  lineWidth?: number,\n  sides?: number,\n  draw?: 'static' | 'dynamic',\n  staticHeight?: number | 'first',\n} & EQN_Symbol;\n\n/**\n * Integral equation symbol used in {@link EQN_Integral}\n * <pre>\n *      --------------------------------------------------   0000000\n *     A                                              000000011111111\n *     |                                         0000000   111111111111\n *     |                                       0000000    11111111111111\n *     |                                      0000000     11111111111111\n *     |                                     0000000       111111111111\n *     |                                   000000000         11111111\n *     |                                  000000000\n *     |                                 0000000000\n *     |                                 000000000\n *     |                                0000000000\n *     |                                0000000000\n *     |                               00000000000\n *     |                              00000000000\n *     |                              000000000000\n *     |                             000000000000      lineWidth\n *     | height              ------->000000000000<----------\n *     |                             000000000000\n *     |                             000000000000\n *     |                            000000000000\n *     |                             00000000000\n *     |                            00000000000\n *     |                            0000000000\n *     |                            0000000000\n *     |     Serif                  000000000\n *     |       \\                   000000000\n *     |        \\                 0000000000\n *     |      11111111           000000000\n *     |    111111111111       00000000\n *     |   11111111111111     0000000\n *     |   11111111111111   0000000\n *     |    111111111111   0000000\n *     V      111111110000000\n *     -------  0000000\n* </pre>\n * @property {'int'} symbol\n * @property {number} [lineWidth] (related to height)\n * @property {number} [sides] number of sides that make up s curve (`30`)\n * @property {number} [num] number of integral symbols (`1`)\n * @property {'line' | 'generic'} [type] `line` draws a circle through the\n *  symbols denoting a line integral (`generic`)\n * @property {number} [tipWidth] width of s curve tip (related to lineWidth)\n * @property {boolean} [serif] `false` to remove serifs (`true`)\n * @property {number} [serifSides] number of sides in serif circles (`10`)\n * @property {number} [lineIntegralSides] number of sides in line integral circle (`20`)\n\n * @property {'static' | 'dynamic'} [draw] `'static'` updates vertices on\n * resize, `'static'` only changes scale transform (`dynamic`)\n * @property {number | 'first'} [staticHeight] used when `draw`=`static`.\n * `number` sets height of static symbol - `'first'` calculates and sets height\n * based on first use (`'first'`)\n *\n * @extends EQN_Symbol\n *\n * @example\n * eqn.addElements({\n * int: {\n *   symbol: 'int',\n *   color: [0.95, 0, 0, 1],\n *   lineWidth: 0.01,\n *   sides: 20,\n *   num: 2,\n *   type: 'generic',\n *   tipWidth: null,\n *   serif: true,\n *   serifSides: 10,\n *   lineIntegralSides: 20,\n *   draw: 'static',\n *   staticHeight: 'first',\n * },\n */\nexport type EQN_IntegralSymbol = {\n  symbol: 'int',\n  lineWidth?: number,\n  sides?: number,\n  tipWidth?: number,\n  draw?: 'static' | 'dynamic',\n  staticHeight?: number | 'first',\n  serif?: boolean,\n  num?: number,\n  type?: 'line' | 'generic',\n  serifSides?: number,\n  lineIntegralSides?: number,\n} & EQN_Symbol;\n\n/**\n * Radical equation symbol used in {@link EQN_Root}.\n *\n * The radical symbol allows customization on how to draw the radical. Mostly\n * it will not be needed, but for edge case equation layouts it may be useful.\n *\n * <pre>\n *\n *   height\n *   |\n *   |\n *   |_____________________________ XXXXXXXXXXXXXXXXXXXXXXXXXXXXXX\n *   A                             X|\n *   |   startHeight              X |   CCCCCCCCCCCCCCCCCCCCCCC\n *   |   |                       X  |   CCCCCCCCCCCCCCCCCCCCCCC\n *   |   |    tickHeight        X   |   CCCCCCCCCCCCCCCCCCCCCCC\n *   |   |    |                X    |   CCCCCCCCCCCCCCCCCCCCCCC\n *   |   |____V____           X     |   CCCCCCCCCCCCCCCCCCCCCCC\n *   |   A    |    X         X      |   CCCCCCCCCCCCCCCCCCCCCCC\n *   |   |    |__X |X       X       |   CCCCCCCCCCCCCCCCCCCCCCC\n *   |   |    A |  | X     X        |   CCCCCCCCCCCCCCCCCCCCCCC\n *   |   |      |  |  X   X         |   CCCCCCCCCCCCCCCCCCCCCCC\n *   |   |      |  |   X X          |   CCCCCCCCCCCCCCCCCCCCCCC\n *   V___V______|__|____X           |\n *              |  |    |           |\n *              |  |    |           |\n *   tickWidth >|--|<   |           |\n *              |  |    |           |\n *              |  |<-->|downWidth  |\n *              |                   |\n *              |<----------------->|\n *                     startWidth\n* </pre>\n\n * @property {'radical'} symbol\n * @property {number} [lineWidth] (`0.01`)\n * @property {number} [width] force width of content area (normally defined by content size)\n * @property {number} [height] force height of content area (normally defined by content size)\n * @property {number} [startWidth] (`0.5`)\n * @property {number} [startHeight] (`0.5`)\n * @property {?number} [maxStartWidth] (`0.15`)\n * @property {?number} [maxStartHeight] (`0.15`)\n * @property {number} [tickHeight]\n * @property {number} [tickWidth]\n * @property {number} [downWidth]\n * @property {boolean} [proportionalToHeight] `true` makes `startHeight`,\n * `startWidth`, `tickHeight`, `tickWidth`, and `downWidth` a percentage of\n * height instead of absolute (`true`)\n * @property {number} [lineWidth2] lineWidth of down stroke (`2 x lineWidth`)\n * @property {'static' | 'dynamic'} [draw] `'static'` updates vertices on\n * resize, `'static'` only changes scale transform (`dynamic`)\n * @property {number | 'first'} [staticHeight] used when `draw`=`static`.\n * `number` sets height of static symbol - `'first'` calculates and sets height\n * based on first use (`'first'`)\n * @property {number | 'first'} [staticWidth] used when `draw`=`static`.\n * `number` sets width of static symbol - `'first'` calculates and sets width\n * based on first use (`'first'`)\n *\n * @extends EQN_Symbol\n *\n * @example\n * // Typical\n * eqn.addElements({\n *   rad: {\n *     symbol: 'radical',\n *     color: [1, 0, 0, 1],\n *   },\n * });\n * @example\n * // All options\n *  eqn.addElements({\n *    rad: {\n *      symbol: 'radical',\n *      color: [1, 0, 0, 1],\n *      lineWidth: 0.01,\n *      lineWidth2: 0.02,\n *      width: 1.2,\n *      height: 0.8,\n *      startWidth: 0.04,\n *      startHeight: 0.04,\n *      tickHeight: 0.01,\n *      tickWidth: 0.01,\n *      downWidth: 0.01,\n *      maxStartWidth: 0.03,\n *      maxStartHeight: 0.03,\n *      proportionalToHeight: false,\n *      draw: 'dynamic',\n *    },\n *  });\n */\nexport type EQN_RadicalSymbol = {\n  symbol: 'radical',\n  lineWidth?: number,\n  width?: number,\n  height?: number,\n  startWidth?: number,\n  startHeight?: number,\n  proportionalToHeight?: boolean,\n  maxStartWidth?: ?number,\n  maxStartHeight?: ?number,\n  lineWidth2?: number,\n  tickWidth?: number,\n  tickHeight?: number,\n  downWidth?: number,\n  draw: 'static' | 'dynamic',\n  staticHeight?: number | 'first',\n  staticWidth?: number | 'first',\n} & EQN_Symbol;\n\n/**\n * Strike equation symbol used in {@link EQN_Strike}.\n *\n * Four styles of strike symbol are available:\n * <pre>\n *\n *\n *          000         000\n *            000     000\n *              000 000\n *                000                       0000000000000000\n *              000 000\n *            000     000\n *          000         000\n *               cross                         horizontal\n *\n *\n *                      000                 000\n *                    000                     000\n *                  000                         000\n *                000                             000\n *              000                                 000\n *            000                                     000\n *          000                                         000\n *             forward                        backward\n *\n * </pre>\n *\n * @property {'strike'} symbol\n * @property {'cross' | 'forward' | 'back' | 'horizontal'} [style] (`'cross'`)\n * @property {number} [lineWidth] (`0.015`)\n * @property {number} [width] force width of strike (normally defined by\n * content size)\n * @property {number} [height] force height of strike (normally defined by\n * content size)\n * @property {'static' | 'dynamic'} [draw] `'static'` updates vertices on\n * resize, `'static'` only changes scale transform (`dynamic`)\n * @property {number | 'first'} [staticHeight] used when `draw`=`static`.\n * `number` sets height of static symbol - `'first'` calculates and sets height\n * based on first use (`'first'`)\n * @property {number | 'first'} [staticWidth] used when `draw`=`static`.\n * `number` sets width of static symbol - `'first'` calculates and sets width\n * based on first use (`'first'`)\n *\n * @extends EQN_Symbol\n *\n * @example\n * // Typical\n * eqn.addElements({\n *   s: { symbol: 'strike', style: 'forward' },\n * });\n * @example\n * // All options\n *  eqn.addElements({\n *    s: {\n *      symbol: 'strike',\n *      style: 'cross',\n *      lineWidth: 0.01,\n *      width: 0.5,\n *      height: 0.5,\n *      draw: 'static',\n *      staticHeight: 'first',\n *      staticWidth: 'first',\n *    },\n *  });\n */\nexport type EQN_StrikeSymbol = {\n  symbol: 'strike',\n  style?: 'cross' | 'forward' | 'back' | 'horizontal',\n  lineWidth?: number,\n  width?: number,\n  height?: number,\n  draw: 'static' | 'dynamic',\n  staticHeight?: number | 'first',\n  staticWidth?: number | 'first',\n} & EQN_Symbol;\n\n/**\n * Bracket equation symbol\n *<pre>\n *                    tipWidth\n *                      ----->| |<---\n *                            | |\n *                            | |\n *                            000\n *                          0000\n *                        00000\n *                      000000\n *                     000000\n *                     000000\n *        lineWidth   000000\n *             ------>000000<---\n *                    000000\n *                    |000000\n *                    |000000\n *                    | 000000\n *                    |   00000\n *                    |     0000\n *                    |       000\n *                    |         |\n *                    |         |\n *                    |<------->|\n *                       width\n * </pre>\n *\n * @property {'bracket'} symbol\n * @property {'left' | 'right' | 'top' | 'bottom'} [side] how to orient the\n * bracket ('left')\n * @property {number} [sides] number of sides in bracket curve (`10`)\n * @property {number} [lineWidth] (depends on height)\n * @property {number} [tipWidth] (depends on lineWidth)\n * @property {number} [width] force width bracket (normally depends on height)\n * @property {'static' | 'dynamic'} [draw] `'static'` updates vertices on\n * resize, `'static'` only changes scale transform (`dynamic`)\n * @property {number | 'first'} [staticHeight] used when `draw`=`static`.\n * `number` sets height of static symbol - `'first'` calculates and sets height\n * based on first use (`'first'`)\n *\n * @extends EQN_Symbol\n *\n * @example\n * // Typical\n * eqn.addElements({\n *   lb: { symbol: 'bracket', side: 'left' },\n * });\n * @example\n * // All options\n *  eqn.addElements({\n *    rb: {\n *      symbol: 'bracket',\n *      side: 'right',\n *      sides: 20,\n *      lineWidth: 0.01,\n *      tipWidth: 0.05,\n *      width: 0.5,\n *      draw: 'static',\n *      staticHeight: 'first',\n *    },\n *  });\n */\nexport type EQN_BracketSymbol = {\n  symbol: 'bracket',\n  side?: 'left' | 'right' | 'top' | 'bottom',\n  lineWidth?: number,\n  sides?: number,\n  width?: number,\n  tipWidth?: number,\n  draw?: 'static' | 'dynamic',\n  staticHeight?: number | 'first',\n} & EQN_Symbol;\n\n/**\n * Angle bracket equation symbol\n *\n * <pre>\n *                      width\n *                   |<------->|\n *                   |         |\n *           --------|----- 0000\n *           A       |     0000\n *           |       |    0000\n *           |       |   0000\n *           |       |  0000\n *           |         0000\n *    height |        0000\n *           |        0000\n *           |         0000\n *           |          0000\n *           |           0000\n *           |            0000\n *           |             0000\n *           V_____________ 0000\n *\n * </pre>\n *\n * @property {'angleBracket'} symbol\n * @property {'left' | 'right' | 'top' | 'bottom'} [side] how to orient the\n * angle bracket ('left')\n * @property {number} [lineWidth] (depends on height)\n * @property {number} [width] force width bracket (normally depends on height)\n * @property {'static' | 'dynamic'} [draw] `'static'` updates vertices on\n * resize, `'static'` only changes scale transform (`dynamic`)\n * @property {number | 'first'} [staticHeight] used when `draw`=`static`.\n * `number` sets height of static symbol - `'first'` calculates and sets height\n * based on first use (`'first'`)\n *\n * @extends EQN_Symbol\n *\n * @example\n * // Typical\n * eqn.addElements({\n *   lb: { symbol: 'angleBracket', side: 'left' },\n * });\n * @example\n * // All options\n *  eqn.addElements({\n *    rb: {\n *      symbol: 'angleBracket',\n *      side: 'right',\n *      lineWidth: 0.01,\n *      width: 0.5,\n *      draw: 'static',\n *      staticHeight: 'first',\n *    },\n *  });\n */\nexport type EQN_AngleBracketSymbol = {\n  symbol: 'angleBracket',\n  side?: 'left' | 'right' | 'top' | 'bottom',\n  lineWidth?: number,\n  width?: number,\n  draw?: 'dynamic' | 'static',\n  staticHeight?: number | 'first',\n} & EQN_Symbol;\n\n/**\n * Brace equation symbol\n *\n * <pre>\n *                width\n *             |<------>|\n *             |        |\n *             |        |\n *             |      000\n *             |    000\n *             |   000\n *             |  0000\n *             |  0000\n *             |  0000\n *             |  0000\n *             |  000\n *             | 000\n *             000\n *               000\n *                000\n *                0000\n *                0000\n *                0000\n *                0000\n *           - - -0000 - - - -\n *          |      000        |\n *          |       000       |\n *          |         000     |\n *           - - - - - - - - -\n *                        \\\n *                         \\\n *                          \\\n *      - - - - - - - - - - - - - - - - - - - - - - - - -\n *     |       00000000000000                            |\n *     |        00000000000000                           |\n *     |          000000000000                 tipWidth  |\n *     |            000000000000               |         |\n *     |              000000000000             |         |\n *     |                 0000000000000  _______V_        |\n *     |                     00000000000                 |\n *     |                         0000000_________        |\n *     |                                       A         |\n *      - - - - - - - - - - - - - - - - - - - - - - - - -\n *\n * </pre>\n *\n * @property {'brace'} symbol\n * @property {'left' | 'right' | 'top' | 'bottom'} [side] how to orient the\n * brace ('left')\n * @property {number} [lineWidth] (depends on height)\n * @property {number} [tipWidth] (depends on lineWidth)\n * @property {number} [width] force width bracket (normally depends on height)\n * @property {number} [sides] number of sides in curved sections (`10`)\n * @property {'static' | 'dynamic'} [draw] `'static'` updates vertices on\n * resize, `'static'` only changes scale transform (`dynamic`)\n * @property {number | 'first'} [staticHeight] used when `draw`=`static`.\n * `number` sets height of static symbol - `'first'` calculates and sets height\n * based on first use (`'first'`)\n *\n * @extends EQN_Symbol\n *\n * @example\n * // Typical\n * eqn.addElements({\n *   lb: { symbol: 'brace', side: 'left' },\n * });\n * @example\n * // All options\n *  eqn.addElements({\n *    rb: {\n *      symbol: 'brace',\n *      side: 'right',\n *      lineWidth: 0.01,\n *      tipWidth: 0.01,\n *      width: 0.5,\n *      draw: 'static',\n *      staticHeight: 0.5,\n *    },\n *  });\n */\nexport type EQN_BraceSymbol = {\n  symbol: 'brace',\n  side?: 'left' | 'right' | 'top' | 'bottom',\n  lineWidth?: number,\n  sides?: number,\n  width?: number,\n  tipWidth?: number,\n  draw?: 'dynamic' | 'static',\n  staticHeight?: number | 'first',\n} & EQN_Symbol;\n\n/**\n * Bar equation symbol\n *\n * <pre>\n *\n *        >| |<---- lineWidth\n *         | |\n *         | |\n *         000\n *         000\n *         000\n *         000\n *         000\n *         000\n *         000\n *         000\n *         000\n *         000\n *         000\n *\n * </pre>\n *\n * @property {'bar'} symbol\n * @property {'left' | 'right' | 'top' | 'bottom'} [side] how to orient the\n * bar ('left')\n * @property {number} [lineWidth] (`0.01`)\n * @property {'static' | 'dynamic'} [draw] `'static'` updates vertices on\n * resize, `'static'` only changes scale transform (`dynamic`)\n * @property {number | 'first'} [staticHeight] used when `draw`=`static`.\n * `number` sets height of static symbol - `'first'` calculates and sets height\n * based on first use (`'first'`)\n *\n * @extends EQN_Symbol\n *\n * @example\n * // Typical\n * eqn.addElements({\n *   lb: { symbol: 'bar', side: 'left' },\n * });\n * @example\n * // All options\n *  eqn.addElements({\n *    rb: {\n *      symbol: 'bar',\n *      side: 'right',\n *      lineWidth: 0.01,\n *      draw: 'static',\n *      staticHeight: 0.5,\n *    },\n *  });\n */\nexport type EQN_BarSymbol = {\n  symbol: 'bar',\n  side?: 'left' | 'right' | 'top' | 'bottom',\n  lineWidth?: number,\n  draw?: 'dynamic' | 'static',\n  staticHeight?: number | 'first',\n} & EQN_Symbol;\n\n\n/**\n * Square bracket equation symbol\n *\n * <pre>\n *\n *                            width\n *                  |<--------------------->|\n *                  |                       |\n *            ___                              ____\n *           A      0000000000000000000000000     A\n *           |      0000000000000000000000000     | tipWidth\n *           |      0000000000000000000000000  ___V\n *           |      00000000\n *           |      00000000\n *           |      00000000\n *           |      00000000\n *  height   |      00000000\n *           |      00000000\n *           |      00000000\n *           |      00000000\n *           |      00000000\n *           |      00000000\n *           |      0000000000000000000000000\n *           |      0000000000000000000000000\n *           V___   0000000000000000000000000\n *\n *                  |      |\n *                  |      |\n *                  |<---->|\n *                 line width\n *\n * </pre>\n *\n * @property {'squareBracket'} symbol\n * @property {'left' | 'right' | 'top' | 'bottom'} [side] how to orient the\n * square bracket ('left')\n * @property {number} [lineWidth] (`0.01`)\n * @property {number} [tipWidth] (`0.01`)\n * @property {number} [width] (depends on lineWidth)\n * @property {number} [radius] optional curved corner radius (`0`)\n * @property {number} [sides] number of sides in curve (`5`)\n * @property {'static' | 'dynamic'} [draw] `'static'` updates vertices on\n * resize, `'static'` only changes scale transform (`dynamic`)\n * @property {number | 'first'} [staticHeight] used when `draw`=`static`.\n * `number` sets height of static symbol - `'first'` calculates and sets height\n * based on first use (`'first'`)\n *\n * @extends EQN_Symbol\n *\n * @example\n * // Typical\n * eqn.addElements({\n *   lb: { symbol: 'squareBracket', side: 'left' },\n * });\n * @example\n * // All options\n *  eqn.addElements({\n *    rb: {\n *      symbol: 'squareBracket',\n *      side: 'right',\n *      lineWidth: 0.01,\n *      tipWidth: 0.01,\n *      width: 0.03\n *      radius: 0.05,\n *      sides: 10,\n *      draw: 'static',\n *      staticHeight: 0.5,\n *    },\n *  });\n */\nexport type EQN_SquareBracketSymbol = {\n  symbol: 'squareBracket',\n  side?: 'left' | 'right' | 'top' | 'bottom',\n  lineWidth?: number,\n  width?: number,\n  tipWidth?: number,\n  radius?: number,\n  sides?: number,\n  draw?: 'dynamic' | 'static',\n  staticHeight?: number | 'first',\n} & EQN_Symbol;\n\n\n/**\n * A line symbol to be used in {@link EQN_Annotate} as a {@link EQN_LineGlyph},\n * or in {@link EQN_Comment}.\n * @property {number} [width] line width\n * @property {TypeDash} [dash] dash style of line\n * @property {OBJ_LineArrows} [arrow] arrow styles of line where start is\n * toward the content\n * @property {'static' | 'dynamic'} [draw] `'static'` updates vertices on\n * resize, `'static'` only changes scale transform (`dynamic`)\n * @property {number | 'first'} [staticHeight] used when `draw`=`static`.\n * `number` sets height of static symbol - `'first'` calculates and sets height\n * based on first use (`'first'`)\n * @property {number | 'first'} [staticWidth]\n */\nexport type EQN_LineSymbol = {\n  width?: number,\n  dash?: TypeDash,\n  arrow?: OBJ_LineArrows,\n  // draw?: 'dynamic' | 'static',\n  // staticHeight?: number | 'first',\n  // staticWidth?: number | 'first',\n}\n\nexport type TypeSymbolOptions = EQN_VinculumSymbol\n  & EQN_VinculumSymbol\n  & EQN_BoxSymbol\n  & EQN_ArrowSymbol\n  & EQN_SumSymbol\n  & EQN_ProdSymbol\n  & EQN_IntegralSymbol\n  & EQN_StrikeSymbol\n  & EQN_BracketSymbol\n  & EQN_AngleBracketSymbol\n  & EQN_BraceSymbol\n  & EQN_BarSymbol\n  & EQN_SquareBracketSymbol\n  & EQN_LineSymbol;\n\n\nexport default class EquationSymbols {\n  shapes: FigurePrimitives;\n  defaultColor: Array<number>;\n\n  constructor(\n    shapes: FigurePrimitives,\n    defaultColor: Array<number>,\n  ) {\n    this.shapes = shapes;\n    this.defaultColor = defaultColor;\n  }\n\n  get(\n    name: string,\n    options: TypeSymbolOptions,\n  ) {\n    if (name === 'vinculum') {              // $FlowFixMe\n      return this.vinculum(options);\n    }\n    if (name === 'strike') {                // $FlowFixMe\n      return this.strike(options);\n    }\n    if (name === 'bracket') {               // $FlowFixMe\n      return this.bracket(options);\n    }\n    if (name === 'squareBracket') {         // $FlowFixMe\n      return this.squareBracket(options);\n    }\n    if (name === 'brace') {                 // $FlowFixMe\n      return this.brace(options);\n    }\n    if (name === 'bar') {                   // $FlowFixMe\n      return this.bar(options);\n    }\n    if (name === 'tBox') {                   // $FlowFixMe\n      return this.touchBox(options);\n    }\n    if (name === 'box') {                   // $FlowFixMe\n      return this.box(options);\n    }\n    if (name === 'angleBracket') {          // $FlowFixMe\n      return this.angleBracket(options);\n    }\n    if (name === 'radical') {               // $FlowFixMe\n      return this.radical(options);\n    }\n    if (name === 'sum') {                   // $FlowFixMe\n      return this.sum(options);\n    }\n    if (name === 'prod') {                  // $FlowFixMe\n      return this.product(options);\n    }\n    if (name === 'int') {                   // $FlowFixMe\n      return this.integral(options);\n    }\n    if (name === 'arrow') {                 // $FlowFixMe\n      return this.arrow(options);\n    }\n    if (name === 'line') {                 // $FlowFixMe\n      return this.line(options);\n    }\n    return null;\n  }\n\n  // vinculumOld(options: { color?: TypeColor } = {}) {\n  //   let { color } = options;\n  //   if (color == null) {\n  //     color = this.defaultColor;\n  //   }\n  //   return this.shapes.horizontalLine(\n  //     new Point(0, 0),\n  //     1, 1, 0,\n  //     color,\n  //     new Transform('vinculum').scale(1, 1).translate(0, 0),\n  //   );\n  // }\n\n  vinculum(options: EQN_VinculumSymbol) {\n    const defaultOptions = {\n      color: this.defaultColor,\n      lineWidth: null,\n      staticHeight: null,          // not definable by user\n      draw: 'dynamic',\n      staticWidth: 'first',\n      drawBorderBuffer: 0,\n      touchBorder: 0,\n    };\n    const optionsToUse = joinObjects(defaultOptions, options);\n    return (new VinculumNew(\n      this.shapes.webgl,\n      optionsToUse.color,\n      new Transform('VinculumSymbol').scale(1, 1).translate(0, 0),\n      this.shapes.limits,\n      optionsToUse,\n      // 'strip',\n    ));\n  }\n\n  box(optionsIn: EQN_BoxSymbol) {\n    const defaultOptions = {\n      color: this.defaultColor,\n      fill: false,\n      width: null,\n      height: null,\n      lineWidth: 0.01,\n      draw: 'dynamic',\n      staticHeight: 'first',\n      staticWidth: 'first',\n    };\n    const optionsToUse = joinObjects(defaultOptions, optionsIn);\n    return (new Box(\n      this.shapes.webgl,\n      optionsToUse.color,\n      new Transform('Box').scale(1, 1).translate(0, 0),\n      this.shapes.limits,\n      optionsToUse,\n      // 'strip',\n    ));\n  }\n\n  line(optionsIn: EQN_LineSymbol) {\n    const defaultOptions = {\n      color: this.defaultColor,\n      width: 0.01,\n      dash: [],\n      arrow: null,\n      draw: 'dynamic',\n      staticHeight: 'first',\n      staticWidth: 'first',\n    };\n    const optionsToUse = joinObjects(defaultOptions, optionsIn);\n    return (new Line(\n      this.shapes.webgl,\n      optionsToUse.color,\n      new Transform('Line').scale(1, 1).translate(0, 0),\n      this.shapes.limits,\n      optionsToUse,\n    ));\n  }\n\n  touchBox(optionsIn: EQN_BoxSymbol) {\n    const defaultOptions = {\n      color: [0, 0, 0, 0.0001],\n      fill: false,\n      width: null,\n      height: null,\n      lineWidth: 0.01,\n      draw: 'static',\n      staticHeight: 'first',\n      staticWidth: 'first',\n      isTouchable: true,\n    };\n    const optionsToUse = joinObjects(defaultOptions, optionsIn);\n\n    return (new Box(\n      this.shapes.webgl,\n      optionsToUse.color,\n      new Transform('TouchBox').scale(1, 1).translate(0, 0),\n      this.shapes.limits,\n      optionsToUse,\n      // 'strip',\n    ));\n  }\n\n  arrow(options: EQN_ArrowSymbol) {\n    const defaultOptions = {\n      color: this.defaultColor,\n      direction: 'right',\n      lineWidth: 0.01,\n      arrowWidth: 0.03,\n      arrowLength: 0.04,\n      length: 0.1,\n      staticHeight: 'first',\n      draw: 'static',\n      staticWidth: null,          // not definable by user\n    };\n    const optionsToUse = joinObjects(defaultOptions, options);\n    if (optionsToUse.direction === 'left' || optionsToUse.direction === 'right') {\n      optionsToUse.side = 'top';\n    } else {\n      optionsToUse.side = 'left';\n    }\n    return (new Arrow(\n      this.shapes.webgl,\n      optionsToUse.color,\n      new Transform('ArrowSymbol').scale(1, 1).translate(0, 0),\n      this.shapes.limits,\n      optionsToUse,\n      // 'strip',\n    ));\n  }\n\n  sum(options: EQN_SumSymbol) {\n    const defaultOptions = {\n      color: this.defaultColor,\n      lineWidth: null,\n      sides: 5,\n      staticHeight: 'first',\n      draw: 'static',\n      staticWidth: null,          // not definable by user\n      drawBorderBuffer: 0,\n      touchBorder: 0,\n    };\n    const optionsToUse = joinObjects(defaultOptions, options);\n\n    return (new Sum(\n      this.shapes.webgl,\n      optionsToUse.color,\n      new Transform('sum').scale(1, 1).translate(0, 0),\n      this.shapes.limits,\n      optionsToUse,\n      // 'strip',\n    ));\n  }\n\n  product(options: EQN_ProdSymbol) {\n    const defaultOptions = {\n      color: this.defaultColor,\n      lineWidth: null,\n      sides: 5,\n      staticHeight: 'first',\n      draw: 'static',\n      staticWidth: null,          // not definable by user\n    };\n    const optionsToUse = joinObjects(defaultOptions, options);\n\n    return (new Product(\n      this.shapes.webgl,\n      optionsToUse.color,\n      new Transform('Sum').scale(1, 1).translate(0, 0),\n      this.shapes.limits,\n      optionsToUse,\n      // 'strip',\n    ));\n  }\n\n  integral(options: EQN_IntegralSymbol) {\n    const defaultOptions = {\n      color: this.defaultColor,\n      lineWidth: null,\n      width: null,\n      tipWidth: null,\n      // percentage: 0.95,\n      sides: 30,\n      // staticSize: 'first',\n      // radius: 0.03,\n      serif: true,\n      staticHeight: 'first',\n      draw: 'static',\n      staticWidth: null,          // not definable by user\n      num: 1,\n      type: 'generic',\n      serifSides: 10,\n      lineIntegralSides: 20,\n    };\n    const optionsToUse = joinObjects(defaultOptions, options);\n\n    return new Integral(\n      this.shapes.webgl,\n      optionsToUse.color,\n      new Transform('Integral').scale(1, 1).translate(0, 0),\n      this.shapes.limits,\n      // optionsToUse.staticSize,\n      optionsToUse,\n      // 'triangles',\n      // {\n      //   lineWidth: optionsToUse.lineWidth,\n      //   minLineWidth: optionsToUse.minLineWidth,\n      //   sides: optionsToUse.sides,\n      //   width: optionsToUse.width,\n      //   percentage: optionsToUse.percentage,\n      //   sigma: optionsToUse.sigma,\n      // },\n    );\n  }\n\n  radical(optionsIn: EQN_RadicalSymbol) {\n    const defaultOptions: {\n      color: TypeColor,\n      lineWidth: number,\n      startHeight: number,\n      startWidth: number,\n      proportionalToHeight: boolean,\n      maxStartWidth: ?number,\n      maxStartHeight: ?number,\n      staticSize: ?(Point | [number, number]),\n      draw: 'static' | 'dynamic',\n      staticHeight?: number | 'first',\n      staticWidth?: number | 'first',\n    } = {\n      color: this.defaultColor,\n      lineWidth: 0.01,\n      staticSize: null,\n      startHeight: 0.5,\n      startWidth: 0.5,\n      maxStartWidth: 0.15,\n      maxStartHeight: 0.15,\n      proportionalToHeight: true,\n      draw: 'dynamic',\n      staticHeight: 'first',\n      staticWidth: 'first',\n    };\n    if (optionsIn.proportionalToHeight != null\n      && optionsIn.proportionalToHeight === false\n    ) {\n      defaultOptions.startHeight = 0.15;\n      defaultOptions.startWidth = 0.15;\n      // defaultOptions.maxStartHeight = null;\n      // defaultOptions.maxStartWidth = null;\n    }\n    const optionsToUse = joinObjects(defaultOptions, optionsIn);\n    return new Radical(\n      this.shapes.webgl,\n      optionsToUse.color,\n      new Transform('bracket').scale(1, 1).translate(0, 0),\n      this.shapes.limits,\n      optionsToUse,\n      // 'strip',\n    );\n  }\n\n  strike(options: EQN_StrikeSymbol) {\n    const defaultOptions = {\n      style: 'cross',\n      color: this.defaultColor,\n      lineWidth: null,\n      draw: 'dynamic',\n      staticHeight: 'first',\n      width: null,\n      height: null,\n      staticWidth: 'first',\n    };\n    const optionsToUse = joinObjects(defaultOptions, options);\n    return new Strike(\n      this.shapes.webgl,\n      optionsToUse.color,\n      new Transform('bracket').scale(1, 1).translate(0, 0),\n      this.shapes.limits,\n      optionsToUse,\n      // 'triangles',\n    );\n    // let { color } = options;\n    // if (color == null) {\n    //   color = this.defaultColor;\n    // }\n    // return this.shapes.horizontalLine(\n    //   new Point(0, 0),\n    //   1, 1, 0,\n    //   color,\n    //   new Transform('strike').scale(1, 1).rotate(0).translate(0, 0),\n    // );\n  }\n\n  // xStrike(options: { color?: TypeColor } = {}) {\n  //   let { color } = options;\n  //   if (color == null) {\n  //     color = this.defaultColor;\n  //   }\n  //   const cross = this.collections.collection(new Transform('xStrike')\n  //     .scale(1, 1).rotate(0).translate(0, 0));\n  //   cross.color = color;\n  //   const strike1 = this.shapes.horizontalLine(\n  //     new Point(0, 0),\n  //     1, 1, 0,\n  //     color,\n  //     new Transform('strikeLine').scale(1, 1).rotate(0).translate(0, 0),\n  //   );\n  //   const strike2 = strike1._dup();\n  //   cross.add('s1', strike1);\n  //   cross.add('s2', strike2);\n  //   return cross;\n  // }\n\n  bracket(options: EQN_BracketSymbol) {\n    const defaultOptions = {\n      side: 'left',\n      color: this.defaultColor,\n      lineWidth: null,\n      sides: 10,\n      draw: 'dynamic',\n      staticHeight: 'first',\n      width: null,\n      tipWidth: null,\n      staticWidth: null,\n    };\n    const optionsToUse = joinObjects(defaultOptions, options);\n    return (new Bracket(\n      this.shapes.webgl,\n      optionsToUse.color,\n      new Transform('bracket').scale(1, 1).translate(0, 0),\n      this.shapes.limits,\n      optionsToUse,\n      // 'strip',\n    ));\n  }\n\n  angleBracket(options: EQN_AngleBracketSymbol) {\n    const defaultOptions = {\n      side: 'left',\n      lineWidth: null,\n      width: null,\n      color: this.defaultColor,\n      draw: 'dynamic',\n      staticHeight: 'first',\n    };\n    const optionsToUse = joinObjects(defaultOptions, options);\n    return (new AngleBracket(\n      this.shapes.webgl,\n      optionsToUse.color,\n      new Transform('bar').scale(1, 1).translate(0, 0),\n      this.shapes.limits,\n      optionsToUse,\n      // 'strip',\n    ));\n  }\n\n  brace(options: EQN_BraceSymbol) {\n    const defaultOptions = {\n      side: 'left',\n      color: this.defaultColor,\n      lineWidth: null,\n      sides: 10,\n      draw: 'dynamic',\n      staticHeight: 'first',\n      width: null,\n      tipWidth: null,\n      staticWidth: null,\n    };\n    const optionsToUse = joinObjects(defaultOptions, options);\n    return (new Brace(\n      this.shapes.webgl,\n      optionsToUse.color,\n      new Transform('brace').scale(1, 1).translate(0, 0),\n      this.shapes.limits,\n      optionsToUse,\n      // 'strip',\n    ));\n  }\n\n  bar(options: EQN_BarSymbol) {\n    const defaultOptions = {\n      side: 'left',\n      lineWidth: 0.01,\n      color: this.defaultColor,\n      draw: 'dynamic',\n      staticHeight: 'first',\n    };\n    const optionsToUse = joinObjects(defaultOptions, options);\n    return (new Bar(\n      this.shapes.webgl,\n      optionsToUse.color,\n      new Transform('bar').scale(1, 1).translate(0, 0),\n      this.shapes.limits,\n      optionsToUse,\n      // 'strip',\n    ));\n  }\n\n  squareBracket(options: EQN_SquareBracketSymbol) {\n    const defaultOptions = {\n      side: 'left',\n      lineWidth: null,\n      color: this.defaultColor,\n      width: null,\n      draw: 'dynamic',\n      staticHeight: 'first',\n      radius: 0,\n      sides: 5,\n      tipWidth: null,\n    };\n    const optionsToUse = joinObjects(defaultOptions, options);\n    // if (optionsToUse.endLineWidth == null) {\n    //   optionsToUse.endLineWidth = optionsToUse.lineWidth * 0.7;\n    // }\n    return (new SquareBracket(\n      this.shapes.webgl,\n      optionsToUse.color,\n      new Transform('bar').scale(1, 1).translate(0, 0),\n      this.shapes.limits,\n      optionsToUse,\n      // 'strip',\n    ));\n  }\n}\n","// @flow\n\nfunction makeDiv(\n  id: string,\n  classes: Array<string>,\n  text: string,\n  indent: number = 0,\n) {\n  const indentStr = ' '.repeat(indent);\n  const idStr = id ? ` id=\"${id}\"` : '';\n  const classString = classes ? ` ${classes.join(' ')}` : '';\n  let out = `${indentStr}<div${idStr} class=\"equation_element${classString}\">\\n`;\n  out += `${text}\\n`;\n  out += `${indentStr}</div>`;\n  return out;\n}\n\n// Most fundamental Equation Element properties includes element size and\n// location, as well as html id and classes.\nclass HTMLElementProperties {\n  id: string;\n  classes: Array<string>;\n\n  constructor(id: string = '', classes: string | Array<string> = '') {\n    this.id = id;\n    if (Array.isArray(classes)) {\n      this.classes = classes;\n    } else if (classes.length > 0) {\n      this.classes = classes.split(' ');\n    } else {\n      this.classes = [];\n    }\n  }\n\n  render(indent: number = 0, text: string = '') {\n    return makeDiv(\n      this.id,\n      this.classes,\n      text,\n      indent,\n    );\n  }\n}\n\nclass HTMLElement extends HTMLElementProperties {\n  text: string;\n\n  constructor(\n    text: string,\n    id: string = '',\n    classes: string | Array<string> = [],\n  ) {\n    super(id, classes);\n    this.classes.push('equation_text');\n    this.text = text;\n  }\n\n  render(indent: number = 0) {\n    return super.render(indent, `${' '.repeat(indent + 2)}${this.text}`);\n  }\n}\n\nclass HTMLElements extends HTMLElementProperties {\n  content: Array<HTMLElement | HTMLElements | HTMLElementProperties>;\n\n  constructor(\n    content: Array<HTMLElement | HTMLElements | HTMLElementProperties | null>,\n    id: string = '',\n    classes: string | Array<string> = [],\n  ) {\n    super(id, classes);\n    const filteredContent = [];\n    content.forEach((c) => {\n      if (c !== null) {\n        filteredContent.push(c);\n      }\n    });\n    this.content = filteredContent;\n  }\n\n  render(indent: number = 0) {\n    return super.render(indent, this.content.map(c => c.render(indent + 2)).join('\\n'));\n  }\n}\n\nclass Fraction extends HTMLElementProperties {\n  numerator: HTMLElements;\n  denominator: HTMLElements;\n\n  constructor(\n    numerator: HTMLElements,\n    denominator: HTMLElements,\n    id: string = '',\n    classes: string | Array<string> = [],\n  ) {\n    super(id, classes);\n    this.classes.push('fraction');\n    this.numerator = numerator;\n    this.denominator = denominator;\n  }\n\n  render(indent: number = 0) {\n    const s = ' '.repeat(indent + 2);\n    let out = '';\n    out += `${s}<div class=\"numerator\">\\n`;\n    out += this.numerator.render(indent + 4);\n    out += `\\n${s}</div>\\n`;\n    out += `${s}<div class=\"fraction_line\"> </div>\\n`;\n    out += `${s}<div class=\"denominator\">\\n`;\n    out += this.denominator.render(indent + 4);\n    out += `\\n${s}</div>`;\n    return super.render(indent, out);\n  }\n}\n\nclass SuperSub extends HTMLElementProperties {\n  superscript: HTMLElements | null;\n  subscript: HTMLElements | null;\n  content: HTMLElements;\n\n  constructor(\n    content: HTMLElements,\n    superscript: HTMLElements | null,\n    subscript: HTMLElements | null,\n    id: string = '',\n    classes: string | Array<string> = '',\n  ) {\n    super(id, classes);\n    this.classes.push('supersub');\n    this.superscript = superscript;\n    this.subscript = subscript;\n    this.content = content;\n  }\n\n  render(indent: number = 0) {\n    const s = ' '.repeat(indent + 2);\n    let out = '';\n    out += `${s}<div class=\"supsub_content element\">\\n`;\n    out += this.content.render(indent + 2);\n    out += `\\n${s}</div>\\n`;\n    out += `${s}<div class=\"super_sub element\">\\n`;\n    out += `${s}<div class=\"super_sub_super superscript_text element\">\\n`;\n    if (this.superscript !== null) {\n      out += this.superscript.render(indent + 4);\n    }\n    out += `\\n${s}</div>\\n`;\n    out += `${s}<div class=\"super_sub_sub subscript_text element\">\\n`;\n    if (this.subscript !== null) {\n      out += this.subscript.render(indent + 4);\n    }\n    out += `\\n${s}</div>`;\n    out += `\\n${s}</div>\\n`;\n    return super.render(indent, out);\n  }\n}\n\nclass Subscript extends SuperSub {\n  constructor(\n    content: HTMLElements,       // eslint-disable-line no-use-before-define\n    subscript: HTMLElements,\n    id: string = '',\n    classes: string | Array<string> = '',\n  ) {\n    super(content, null, subscript, id, classes);\n    const index = this.classes.indexOf('supersub');\n    if (index > -1) {\n      this.classes.splice(index, 1);\n    }\n    this.classes.push('subscript');\n  }\n}\n\nclass Superscript extends SuperSub {\n  constructor(\n    content: HTMLElements,       // eslint-disable-line no-use-before-define\n    superscript: HTMLElements,\n    id: string = '',\n    classes: string | Array<string> = '',\n  ) {\n    super(content, superscript, null, id, classes);\n    const index = this.classes.indexOf('supersub');\n    if (index > -1) {\n      this.classes.splice(index, 1);\n    }\n    this.classes.push('superscript');\n  }\n}\n\n\nclass Root extends HTMLElementProperties {\n  content: HTMLElements;\n\n  constructor(\n    content: HTMLElements,     // eslint-disable-line no-use-before-define\n    id: string = '',\n    classes: string | Array<string> = [],\n  ) {\n    super(id, classes);\n    this.content = content;\n  }\n\n  render(indent: number = 0) {\n    const s = ' '.repeat(indent + 2);\n    let out = '';\n    out += `${s}<div class=\"square_root element\">\\n`;\n    out += `${s}  <div class=\"equation_element radical element\">\\n`;\n    out += `${s}    &radic;\\n`;\n    out += `${s}  </div>\\n`;\n    out += this.content.render(indent + 4);\n    out += `\\n${s}</div>`;\n    return super.render(indent, out);\n  }\n}\n\n// function contentToE(content: string | HTMLElements): HTMLElements {\n//   let c;\n//   if (typeof content === 'string') {\n//     c = new HTMLElements(content);\n//   } else {\n//     c = content;\n//   }\n//   return c;\n// }\n\ntype EquationInput = Array<HTMLElements | HTMLElementProperties |\n                           HTMLElement | string> |\n                     HTMLElements | HTMLElementProperties |\n                     HTMLElement | string;\n\n\nfunction contentToElement(content: EquationInput): HTMLElements {\n  if (content instanceof HTMLElements) {\n    return content;\n  }\n  if (content instanceof HTMLElement\n      || content instanceof HTMLElementProperties) {\n    return new HTMLElements([content]);\n  }\n  if (typeof content === 'string') {\n    return new HTMLElements([new HTMLElement(content)]);\n  }\n\n  // Otherwise must be array\n  const elementArray: Array<HTMLElement | HTMLElements | HTMLElementProperties | null> = [];\n\n  content.forEach((c) => {\n    if (typeof c === 'string') {\n      elementArray.push(new HTMLElement(c));\n    } else {\n      elementArray.push(c);\n    }\n  });\n  return new HTMLElements(elementArray);\n}\n\n\nexport default class HTMLEquation extends HTMLElements {\n  constructor(id: string = '', classes: string | Array<string> = []) {\n    super([], id, classes);\n  }\n\n  createEq(content: Array<HTMLElements | HTMLElementProperties | string>) {\n    const elements = [];\n    content.forEach((c) => {\n      if (typeof c === 'string') {\n        elements.push(new HTMLElement(c));\n      } else {\n        elements.push(c);\n      }\n      this.content = elements;\n    });\n  }\n\n  htmlElement() {\n    const element = document.createElement('div');\n    element.setAttribute('id', this.id);\n    element.innerHTML = this.render();\n    this.classes.forEach((c) => {\n      if (c) {\n        element.classList.add(c);\n      }\n    });\n    return element;\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  el(\n    content: 'string',\n    id: string = '',\n    classes: string | Array<string> = [],\n  ) {\n    return new HTMLElement(content, id, classes);\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  supsub(\n    content: EquationInput,\n    superscript: EquationInput,\n    subscript: EquationInput,\n    id: string = '',\n    classes: string | Array<string> = [],\n  ) {\n    return new SuperSub(\n      contentToElement(content),\n      contentToElement(superscript),\n      contentToElement(subscript),\n      id,\n      classes,\n    );\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  sub(\n    content: EquationInput,\n    subscript: EquationInput,\n    id: string = '',\n    classes: string | Array<string> = [],\n  ) {\n    return new Subscript(\n      contentToElement(content),\n      contentToElement(subscript),\n      id,\n      classes,\n    );\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  sup(\n    content: EquationInput,\n    superscript: EquationInput,\n    id: string = '',\n    classes: string | Array<string> = [],\n  ) {\n    return new Superscript(\n      contentToElement(content),\n      contentToElement(superscript),\n      id,\n      classes,\n    );\n  }\n\n\n  // e(\n  //   content: string | Array<HTMLElementProperties>,\n  //   id: string = '',\n  //   classes: string | Array<string> = [],\n  // ) {\n  //   return new HTMLElements(content, id, classes);\n  // }\n\n  // eslint-disable-next-line class-methods-use-this\n  frac(\n    numerator: EquationInput,\n    denominator: EquationInput,\n    id: string = '',\n    classes: string | Array<string> = [],\n  ) {\n    return new Fraction(\n      contentToElement(numerator),\n      contentToElement(denominator),\n      id,\n      classes,\n    );\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  sqrt(\n    content: EquationInput,\n    id: string = '',\n    classes: string | Array<string> = [],\n  ) {\n    return new Root(\n      contentToElement(content),\n      id,\n      classes,\n    );\n  }\n}\n\n","// @flow\nimport {\n  Point, Line,\n} from '../../../tools/g2';\nimport Bracket from './Bracket';\n\nexport default class Bar extends Bracket {\n  // eslint-disable-next-line class-methods-use-this\n\n  // Angle Bracket\n  //                         width\n  //                      |<------->|\n  //                      |         |\n  //                      |      ___\n  //           A          |     /  /\n  //           |          |    /  /\n  //           |          |   /  /\n  //           |          |  /  /\n  //           |            /  /\n  //    height |           /  /\n  //           |           \\  \\\n  //           |            \\  \\\n  //           |             \\  \\\n  //           |              \\  \\\n  //           |               \\  \\\n  //           |                \\  \\\n  //           V                 \\__\\\n\n  // To calculate dimensions, need to solve the below where we know:\n  //   * height (h)\n  //   * width (w)\n  //\n  // Looking at the bottom half of the bracket:\n  //\n  //                                 width\n  //                   |<------------------------------>|\n  //                   |                                |\n  //                   |   tip width           Dh       |\n  //                   |<-------------->|<------------->|\n  //\n  //          ______   __________________...............:\n  //          A        :\\*               \\              :\n  //          |        : \\  *             \\             :\n  //          |        :  \\   *            \\            :\n  //          |        :   \\    *           \\           :\n  //          |        :    \\     *          \\          :\n  //          |        :     \\      *         \\         :\n  //          |        :      \\       * A      \\ D      :\n  //   h / 2  |        :       \\        *       \\       :\n  //          |        :        \\         *      \\      :\n  //          |        :       C \\          *     \\     :\n  //          |        :          \\           *    \\    :\n  //          |        :           \\            *   \\   :\n  //          |        :            \\             *  \\  :\n  //          |        :             \\              * \\ :\n  //          |        :              \\               *\\:\n  //          V_____   :...............\\________________\\  B\n  //                                    \\               *\n  //                        C extension  \\          *\n  //                                      \\      *   E\n  //                                     R \\ *\n  //\n  //   - Draw a circle at B of radius lineWidth\n  //   - This circle will touch an extended line C at a right angle (R)\n  //   - Line E is the line from the circle center (B) to the tangent point (R)\n  //   - Line A is the secant and the extended line C is the tangent of the\n  //     the angle Theta which is angle between the line A and line E\n  //   - The angle between lines E and D is also a right angle (as C || D),\n  //     therefore we can calculate the angle between A and D (Beta)\n  //   - Calculate the angle from the horiontal to A: a = arctan2(h/2, w)\n  //   - Calculate the angle from the horizontal to D: alpha = a + Beta\n  //   - Calculate the horizontal component of D: Dh = h / 2 / tan(alpha)\n  //   - Calculate Tip Width = w - Dh\n\n  // eslint-disable-next-line class-methods-use-this\n  getLeftPoints(\n    options: Object,\n    widthIn: number,\n    height: number,\n  ): [\n    Array<Point>,\n    Array<Point>,\n    number,\n    number,\n  ] {\n    // const { side } = options;\n    const { lineWidth, width } = this.getVerticalDefaultValues(height, widthIn, options);\n    const line = new Line(new Point(0, 0), new Point(width, height / 2));\n    const theta = Math.acos(lineWidth / line.distance);\n    const beta = Math.PI / 2 - theta;\n    const alpha = line.ang + beta;\n    const tipWidth = width - height / 2 / Math.tan(alpha);\n\n    const leftPoints = [\n      new Point(width - tipWidth, 0),\n      new Point(0, height / 2),\n      new Point(width - tipWidth, height),\n    ];\n    const rightPoints = [\n      new Point(width, 0),\n      new Point(tipWidth, height / 2),\n      new Point(width, height),\n    ];\n\n    // if (side === 'top' || side === 'bottom') {\n    //   return this.getBracketPoints(leftPoints, rightPoints, side, height, width);\n    // }\n    return [leftPoints, rightPoints, width, height];\n    // return this.getBracketPoints(leftPoints, rightPoints, side, width, height);\n  }\n\n  /* eslint-disable class-methods-use-this */\n  // $FlowFixMe\n  getVerticalDefaultValues(height: number, width: ?number, options: {\n      lineWidth?: number,\n      width?: number,\n    }): {\n      width: number,\n      lineWidth: number,\n    } {\n    const out = {};\n    if (width == null && options.width == null) {\n      out.width = 97570.78 + (0.004958708 - 97570.78)\n                  / (1 + (height / 2399858) ** 0.9383909);\n    }\n    if (width != null) {\n      out.width = width;\n    }\n    if (options.width != null) {\n      out.width = options.width;\n    }\n    if (options.lineWidth == null) {\n      out.lineWidth = (0.2933614 + (0.0001418178 - 0.2933614)\n                      / (1 + (height / 39.01413) ** 0.618041)) * 0.7;\n    } else {\n      out.lineWidth = options.lineWidth;\n    }\n    return out;\n  }\n}\n","\n// @flow\nimport {\n  Point, Transform,\n} from '../../../tools/g2';\nimport Bracket from './Bracket';\nimport type { TypeColor } from '../../../tools/types';\n\nexport type TypeEquationSymbolArrowBracket = {\n  symbol: 'arrow',\n  direction?: 'down' | 'left' | 'up' | 'right',\n  lineWidth?: number,\n  arrowWidth?: number,\n  arrowHeight?: number,\n  draw?: 'static' | 'dynamic',\n  color?: TypeColor;\n  mods?: Object;\n};\n\nexport default class Arrow extends Bracket {\n  // eslint-disable-next-line class-methods-use-this\n\n  //                      arrow width\n  //                 |<--------------->|\n  //                 |                 |\n  //                 |        6        |\n  //          -------|------- 0 -------|---------\n  //          A      |      00000      |        A\n  //   arrow  |      |     0000000     |        |\n  //   height |      |   00000000000   |        |\n  //          V      | 000000000000000 |        |\n  //          ---- 5 0000000000000000000 4      |\n  //                       0000000              |\n  //                    3  0000000 2            |\n  //                       0000000              |\n  //                       0000000              |\n  //                       0000000              |  height\n  //                       0000000              |\n  //                       0000000              |\n  //                       0000000              |\n  //                       0000000              |\n  //                       0000000              |\n  //                       0000000              |\n  //                       0000000              |\n  //                       0000000              |\n  //                       0000000              |\n  //                       0000000              V\n  //                       0000000 --------------\n  //                      1       0\n  //                       |     |\n  //                       |     |\n  //                       |<--->|\n  //                     Line Width\n\n  // eslint-disable-next-line class-methods-use-this\n  getLeftPoints(options: Object, widthIn: number, lengthIn: number) {\n    const { direction } = options;\n    let length = lengthIn;\n    if (length == null) {\n      length = options.length;\n    }\n    const {\n      lineWidth, arrowWidth, arrowLength,\n    } = this.getVerticalDefaultValues(length, widthIn, options);\n    const p0 = new Point(arrowWidth / 2 + lineWidth / 2, 0);\n    const p1 = new Point(arrowWidth / 2 - lineWidth / 2, 0);\n    const p2 = new Point(p0.x, length - arrowLength);\n    const p3 = new Point(p1.x, p2.y);\n    const p4 = new Point(arrowWidth, p2.y);\n    const p5 = new Point(0, p2.y);\n    const p6 = new Point(arrowWidth / 2, length);\n\n    let leftPoints = [\n      p1._dup(),\n      p3._dup(),\n      p5._dup(),\n      p6._dup(),\n    ];\n    let rightPoints = [\n      p0._dup(),\n      p2._dup(),\n      p4._dup(),\n      p6._dup(),\n    ];\n    if (direction === 'down' || direction === 'left') {\n      const m = new Transform().scale(1, -1).translate(0, length).m();\n      // $FlowFixMe\n      leftPoints = leftPoints.map((p: Point) => p.transformBy(m));\n      // $FlowFixMe\n      rightPoints = rightPoints.map((p: Point) => p.transformBy(m));\n    }\n    // let side = 'left';\n    // if (direction === 'up' || direction === 'down') {\n    //   side = 'left';\n    // } else if (direction === 'left' || direction === 'right') {\n    //   side = 'top';\n    // }\n    // return [points, widthIn, length];\n    // $FlowFixMe\n    // if (direction === 'up' || direction === 'down') {\n    //   // console.log(length, arrowWidth)\n    //   return [leftPoints, rightPoints, length, arrowWidth];\n    // }\n    // $FlowFixMe\n    return [leftPoints, rightPoints, arrowWidth, length];\n  }\n\n  /* eslint-disable class-methods-use-this */\n  // $FlowFixMe\n  getVerticalDefaultValues(length: number, width: ?number, options: {\n      lineWidth?: number,\n      arrowWidth?: number,\n      arrowLength?: number,\n      length?: number,\n    }) {\n    const out = {};\n    if (options.lineWidth == null) {\n      out.lineWidth = (0.2933614 + (0.0001418178 - 0.2933614)\n                      / (1 + (length / 39.01413) ** 0.618041)) * 0.8;\n    } else {\n      out.lineWidth = options.lineWidth;\n    }\n    if (options.arrowWidth == null) {\n      out.arrowWidth = out.lineWidth * 3;\n    } else {\n      out.arrowWidth = options.arrowWidth;\n    }\n    if (options.arrowLength == null) {\n      out.arrowLength = out.lineWidth * 3;\n    } else {\n      out.arrowLength = options.arrowLength;\n    }\n    out.width = out.arrowWidth;\n    // $FlowFixMe\n    return out;\n  }\n}\n","// @flow\nimport {\n  Point,\n} from '../../../tools/g2';\nimport Bracket from './Bracket';\n\n\nexport default class Bar extends Bracket {\n  // eslint-disable-next-line class-methods-use-this\n  getLeftPoints(options: Object, widthIn: number, height: number) {\n    const { lineWidth, width } = this.getVerticalDefaultValues(height, widthIn, options);\n\n    const leftPoints = [\n      new Point(0, 0),\n      new Point(0, height),\n    ];\n    const rightPoints = [\n      new Point(lineWidth, 0),\n      new Point(lineWidth, height),\n    ];\n\n    return [leftPoints, rightPoints, width, height];\n  }\n\n  /* eslint-disable class-methods-use-this */\n  // $FlowFixMe\n  getVerticalDefaultValues(height: number, width: ?number, options: {\n      lineWidth?: number,\n      width?: number,\n    }) {\n    const out = {};\n    if (options.lineWidth == null) {\n      out.lineWidth = (0.2933614 + (0.0001418178 - 0.2933614)\n                      / (1 + (height / 39.01413) ** 0.618041)) * 0.8;\n    } else {\n      out.lineWidth = options.lineWidth;\n    }\n    out.width = out.lineWidth;\n    return out;\n  }\n}\n","// @flow\nimport { FigureElementPrimitive, FigureElement, FigureElementCollection } from '../../Element';\nimport {\n  Point, getPoint,\n} from '../../../tools/g2';\nimport type {\n  TypeParsablePoint,\n} from '../../../tools/g2';\nimport Symbol from './SymbolNew';\nimport Bounds from '../Elements/Bounds';\n// import WebGLInstance from '../../../webgl/webgl';\n\n\nexport default class Box extends Symbol {\n  symbol: FigureElementPrimitive;\n\n  // eslint-disable-next-line class-methods-use-this\n  // getTriangles() {\n  //   return 'strip';\n  // }\n\n  //                                          width\n  //                 |<--------------------------------------------------->|\n  //                 |                                                     |\n  //                 |                                                     |\n  //                2                                                       4\n  //         ------- 0000000000000000000000000000000000000000000000000000000\n  //         A       0000000000000000000000000000000000000000000000000000000\n  //         |       0000 3                                           5 0000\n  //         |       0000                                               0000\n  //         |       0000                                               0000\n  //  height |       0000                                               0000\n  //         |       0000                                               0000\n  //         |       0000                                               0000\n  //         |       0000                                               0000\n  //         |       0000 1                                           7 0000\n  //         |       0000000000000000000000000000000000000000000000000000000\n  //         V______ 0000000000000000000000000000000000000000000000000000000\n  //                0                                                        6\n\n  // eslint-disable-next-line class-methods-use-this\n  getPoints(options: Object, widthIn: number, heightIn: number) {\n    const { fill } = options;\n    const { lineWidth, width, height } = this.getDefaultValues(\n      heightIn, widthIn, options,\n    );\n    let points;\n    if (fill) {\n      points = [\n        new Point(0, 0),\n        new Point(width, 0),\n        new Point(0, height),\n        new Point(width, height),\n      ];\n    } else {\n      points = [\n        new Point(0, 0),\n        new Point(lineWidth, lineWidth),\n        new Point(0, height),\n        new Point(lineWidth, height - lineWidth),\n        new Point(width, height),\n        new Point(width - lineWidth, height - lineWidth),\n        new Point(width, 0),\n        new Point(width - lineWidth, lineWidth),\n        new Point(0, 0),\n        new Point(lineWidth, lineWidth),\n      ];\n    }\n    return [points, width, height, 'strip'];\n  }\n\n  /* eslint-disable class-methods-use-this */\n  getBounds(\n    options: {\n      lineWidth?: number,\n      height?: number,\n      width?: number,\n      draw?: 'dynamic' | 'static',\n      staticWidth?: number | 'first',\n      staticHeight?: number | 'first',\n      fill?: boolean,\n    },\n    leftIn: number,\n    bottomIn: number,\n    widthIn: number,\n    heightIn: number,\n  ) {\n    const { lineWidth, width, height } = this.getDefaultValues(\n      heightIn, widthIn, options,\n    );\n    const bounds = new Bounds();\n    if (options.draw === 'static') {\n      let { staticWidth, staticHeight } = options;\n      if (staticWidth === 'first') {\n        staticWidth = width + lineWidth * 2;\n      }\n      if (staticHeight === 'first') {\n        staticHeight = height + lineWidth * 2;\n      }\n      if (staticWidth == null) {\n        staticWidth = 1;\n      }\n      if (staticHeight == null) {\n        staticHeight = 1;\n      }\n      const heightLineWidthRatio = lineWidth / staticHeight;\n      const widthLineWidthRatio = lineWidth / staticWidth;\n      bounds.width = width / (1 - 2 * widthLineWidthRatio);\n      bounds.height = height / (1 - 2 * heightLineWidthRatio);\n      const widthLineWidth = bounds.width * widthLineWidthRatio;\n      const heightLineWidth = bounds.height * heightLineWidthRatio;\n      bounds.left = leftIn - widthLineWidth;\n      bounds.right = bounds.left + bounds.width;\n      bounds.bottom = bottomIn - heightLineWidth;\n      bounds.top = bounds.bottom + bounds.height;\n      bounds.ascent = bounds.height;\n      bounds.descent = 0;\n    } else {\n      bounds.left = leftIn + widthIn / 2 - width / 2 - lineWidth;\n      bounds.bottom = bottomIn + heightIn / 2 - height / 2 - lineWidth;\n      bounds.width = width + lineWidth * 2;\n      bounds.height = height + lineWidth * 2;\n      bounds.right = bounds.left + bounds.width;\n      bounds.top = bounds.bottom + bounds.height;\n      bounds.descent = 0;\n      bounds.ascent = bounds.height;\n    }\n    return bounds;\n  }\n\n  /* eslint-disable class-methods-use-this */\n  // $FlowFixMe\n  getDefaultValues(height: number, width: number, options: {\n      lineWidth?: number,\n      fill?: boolean,\n      height?: number,\n      width?: number,\n    }): {\n      height: number,\n      width: number,\n      lineWidth: number,\n    } {\n    const out = {};\n    if (options.lineWidth != null && typeof options.lineWidth === 'number') {\n      out.lineWidth = options.lineWidth;\n    } else {\n      out.lineWidth = 0.01;\n    }\n    if (options.fill === true) {\n      out.lineWidth = 0;\n    }\n\n    if (options.height != null && typeof options.height === 'number') {\n      out.height = options.height;\n    } else if (height != null) {\n      out.height = height;\n    } else {\n      out.height = 1;\n    }\n    if (options.width != null && typeof options.width === 'number') {\n      out.width = options.width;\n    } else if (width != null) {\n      out.width = width;\n    } else {\n      out.width = 1;\n    }\n    return out;\n  }\n\n  surround(\n    parent: FigureElement,\n    children: ?Array<string | FigureElement>,\n    spaceIn: TypeParsablePoint | number = 0,\n    drawingSpace: 'figure' | 'local' | 'gl' | 'draw' = 'local',\n  ) {\n    let elements = [parent];\n    if (children != null && children.length !== 0) {\n      elements = parent.getElements(children);\n    }\n    if (elements.length === 0) {\n      return;\n    }\n    const space = (typeof spaceIn === 'number') ? getPoint([spaceIn, spaceIn]) : getPoint(spaceIn);\n    let maxBounds;\n    if (parent instanceof FigureElementCollection) {\n      maxBounds = parent.getBoundingRect(drawingSpace, 'border', children);\n    } else {\n      maxBounds = parent.getBoundingRect(drawingSpace);\n    }\n\n    maxBounds.left -= space.x;\n    maxBounds.bottom -= space.y;\n    maxBounds.width += 2 * space.x;\n    maxBounds.height += 2 * space.y;\n    maxBounds.right = maxBounds.left + maxBounds.width;\n    maxBounds.top = maxBounds.bottom + maxBounds.height;\n\n    this.custom.setSize(\n      new Point(maxBounds.left, maxBounds.bottom),\n      maxBounds.width, maxBounds.height,\n    );\n    // this.drawingObject.updateBox(\n    //   maxBounds.width,\n    //   maxBounds.height,\n    // );\n    // this.setPosition(\n    //   maxBounds.left + maxBounds.width / 2,\n    //   maxBounds.bottom + maxBounds.height / 2,\n    // );\n  }\n\n  // surround(parent, childrenToUse, space) {\n  //   let elements = [parent];\n  //   if (childrenToUse !== '' && childrenToUse != null) {\n  //     elements = parent.getElements(childrenToUse);\n  //   }\n  //   maxBounds = elements.\n  // }\n}\n","// @flow\nimport {\n  Point, Transform,\n} from '../../../tools/g2';\nimport Bracket from './Bracket';\n\nexport default class Brace extends Bracket {\n  // eslint-disable-next-line class-methods-use-this\n  // getWidth() {\n  //   return (type: 'static' | 'dynamic', options: Object, height: number) => {\n  //     const { width } = options;\n  //     if (type === 'static') {\n  //       return height * width;\n  //     }\n  //     return width;\n  //   };\n  // }\n\n  //  - Curve R1 and R2 are repeated 4 times in brace\n  //  - Curve R1 is a full 90 circle\n  //  - Curve R2 > R1 and is less than 90\n  //                                       width\n  //                               |<--------------->|\n  //                               |                 |\n  //                               |                *|\n  //           A                   |              * *\n  //           |                   |       R1   *  *\n  //           |                   |          *   *  R2\n  //           |                   |        *    *\n  //           |                   |       *    *\n  //           |                   |       *    *\n  //           |                   |      *    *\n  //           |                   |      *    *\n  //           |                   |      *    *\n  //           |                   |      *    *\n  //           |                   |      *    *\n  //           |                   |      *    *\n  //           |                   |      *    *\n  //           |                   |      *    *\n  //           |                   |      *    *\n  //           |                   |      *    *\n  //           |                   |     *    *\n  //           |                   |     *    *\n  //           |                   |    *    *\n  //           |                      *   *\n  //   height  |                    *  *\n  //           |                   * *\n  //           |          A        * *\n  //           |          |          *  *\n  //           |          |        |   *   *\n  //           |          |        |     *    *\n  //           |          |        |      *    *\n  //           |          |        |      *    *\n  //           |          |        |       *    *\n  //           |          |        |       *    *\n  //           |          |        |       *    *\n  //           |          |        |       *    *\n  //           |    h / 2 |        |       *    *\n  //           |          |        |       *    *\n  //           |          |        |       *    *\n  //           |          |        |       *    *\n  //           |          |        |       *    *\n  //           |          |        |       *    *\n  //           |          |        |        *    *\n  //           |          |        |        *    *\n  //           |          |        |         *    *\n  //           |          |        |           *   *\n  //           |          |        |             *  *\n  //           V          V        |_______________ *\n  //                           (0,0)\n  //\n\n  // The solution to a circle that intersect at the same\n  //\n  //                       |OOO ooo\n  //                       |       OOo\n  //                       |         | OOo              A\n  //                       |         |    OOo           |\n  //                       |         |      OOo         |\n  //                       |         |        OOo       |\n  //                       |         |         OOo      | h\n  //                       |         |          OOo     |\n  //                       |         |           OOo    |\n  //                       |         |           OOo    |\n  //                       C---------|-----------OOo    V\n  //                       |         |      w      |\n  //                       |         |<----------->|\n  //                       |                       |\n  //                       |          r            |\n  //                       |<--------------------->|\n  // Circle with radius r intersects a vertical line with height h\n  // a distance w from the circle horizontal.\n  //\n  // Calculate r:\n  //          w^2 + h^2\n  //     r = -----------\n  //              2w\n  //\n  // Calculate angle from center C to intersection with h:\n  //\n  //     theta = arcsin (h / r))\n  //\n  //\n  //\n  //  For the brace case, the outside radius is a full 90 arc\n  //  The inside arc is calculated from the top equations where\n  //\n  //       w = outsideRadius - lineWidth\n  //\n  //                              width\n  //                   <---------------------->\n  //\n  //           A       OOO ooo\n  //  TipWidth |       00o    OOo\n  //           V       00o        OOo   ---------------\n  //                     00o         OOo              A\n  //                       00o           OOo          |\n  //                        00o            OOo        |\n  //                         00o            OOo       | h\n  //                         00o             OOo      |\n  //                          00o            OOo      |\n  //  Ci              Co      00o            OOo      V\n  //  |                |\n  //  |                |     |  line width     |\n  //  |                |     |<--------------->|\n  //  |                |     |                 |\n  //  |  inside radius |     |                 |\n  //  |<-------------------->|                 |\n  //                   |                       |\n  //                   |    outside radius     |\n  //                   |<--------------------->|\n  //\n  //\n  // eslint-disable-next-line class-methods-use-this\n  getLeftPoints(options: Object, widthIn: number, height: number) {\n    const {\n      sides,\n    } = options;\n\n    const { lineWidth, width, tipWidth } = this.getVerticalDefaultValues(height, widthIn, options);\n\n    const outsideRadius = (width / 2 + lineWidth / 2);\n    const h = outsideRadius - tipWidth;\n    const w = outsideRadius - lineWidth;\n    // const w = lineWidth;\n    const insideRadius = (w ** 2 + h ** 2) / (2 * w);\n    const leftPoints = [];\n    const rightPoints = [];\n    const outsideStep = Math.PI / 2 / sides;\n\n    const insideStep = Math.asin(h / insideRadius) / sides;\n\n    const insidePoints = [];\n    const outsidePoints = [];\n    for (let i = 0; i < sides + 1; i += 1) {\n      const outsideAngle = i * outsideStep;\n      const insideAngle = i * insideStep;\n      outsidePoints.push(new Point(\n        outsideRadius * Math.cos(outsideAngle),\n        outsideRadius * Math.sin(outsideAngle),\n      ));\n      insidePoints.push(new Point(\n        insideRadius * Math.cos(insideAngle) - insideRadius + outsideRadius - lineWidth,\n        insideRadius * Math.sin(insideAngle),\n      ));\n    }\n\n    // const topCurveCenter = new Point(width, height - outsideRadius);\n    let m = (new Transform().scale(-1, 1).translate(\n      width, height - outsideRadius,\n    )).m();\n    for (let i = 0; i < sides + 1; i += 1) {\n      leftPoints.push(outsidePoints[sides - i].transformBy(m));\n      rightPoints.push(insidePoints[sides - i].transformBy(m));\n    }\n\n    m = (new Transform().scale(1, -1).translate(\n      0,\n      height / 2 - tipWidth / 2 + outsideRadius,\n    )).m();\n    for (let i = 0; i < sides + 1; i += 1) {\n      leftPoints.push(insidePoints[i].transformBy(m));\n      rightPoints.push(outsidePoints[i].transformBy(m));\n    }\n\n    m = (new Transform().translate(\n      0,\n      height / 2 + tipWidth / 2 - outsideRadius,\n    )).m();\n    for (let i = 0; i < sides + 1; i += 1) {\n      leftPoints.push(insidePoints[sides - i].transformBy(m));\n      rightPoints.push(outsidePoints[sides - i].transformBy(m));\n    }\n\n    m = (new Transform().scale(-1, -1).translate(\n      width,\n      outsideRadius,\n    )).m();\n    for (let i = 0; i < sides + 1; i += 1) {\n      leftPoints.push(outsidePoints[i].transformBy(m));\n      rightPoints.push(insidePoints[i].transformBy(m));\n    }\n\n    // if (side === 'top' || side === 'bottom') {\n    //   return this.getBracketPoints(leftPoints, rightPoints, side, height, width);\n    // }\n    return [leftPoints, rightPoints, width, height];\n  }\n\n  // Values that look good:\n  // height          width         lineWidth\n  //   2              0.2           0.04  0.03\n  //   1              0.1           0.03  0.02\n  //   0.5            0.05          0.015\n  //   0.3            0.05          0.015\n  //   0.2            0.03          0.012\n  // eslint-disable-next-line class-methods-use-this\n  getVerticalDefaultValues(height: number, width: ?number, options: {\n      lineWidth?: number,\n      width?: number,\n      tipWidth?: number,\n    }) {\n    const out = {};\n    if (width == null && options.width == null) {\n      out.width = 97570.78 + (0.004958708 - 97570.78)\n                  / (1 + (height / 2399858) ** 0.9383909);\n    }\n    if (width != null) {\n      out.width = width;\n    }\n    if (options.width != null) {\n      out.width = options.width;\n    }\n    if (options.lineWidth == null) {\n      out.lineWidth = (0.2933614 + (0.0001418178 - 0.2933614)\n                      / (1 + (height / 39.01413) ** 0.618041)) * 0.8;\n    } else {\n      out.lineWidth = options.lineWidth;\n    }\n\n    if (options.tipWidth == null) {\n      out.tipWidth = out.lineWidth / 3;\n    } else {\n      out.tipWidth = options.tipWidth;\n    }\n    return out;\n  }\n}\n","// @flow\nimport {\n  Transform, polarToRect,\n} from '../../../tools/g2';\nimport type { Point } from '../../../tools/g2';\nimport Symbol from './SymbolNew';\n// import Bounds from '../Elements/Bounds';\n\n\nexport default class Bracket extends Symbol {\n  // This is the same math as for Brace, but the outside radius is only a\n  // portion of a half circle\n\n  //                             * *\n  //                          *  *\n  //                        *   *\n  //                      *    *\n  //                     *    *\n  //                     *    *\n  //                    *    *\n  //                    *    *\n  //                    *    *\n  //                     *    *\n  //                     *    *\n  //                      *    *\n  //                        *   *\n  //                          *  *\n  //                            * *\n  //\n  //\n  //\n  //\n  //\n  //\n  //\n  //\n  //\n  //                                     0000000\n  //                                0000       |\n  //                            000         0000\n  //                         00          000\n  //                       0           00\n  //                      00         000\n  //                    0           0\n  //                   00         00\n  //                 00          0\n  //                 0           0\n  //                 0           0\n  //                 0           0\n  //\n  //\n  // eslint-disable-next-line class-methods-use-this\n  getPoints(options: Object, widthIn: number, heightIn: number) {\n    const {\n      side,\n    } = options;\n    let leftPoints;\n    let rightPoints;\n    let width;\n    let height;\n    if (side === 'left' || side === 'right') {\n      [leftPoints, rightPoints, width, height] = this.getLeftPoints(\n        options, widthIn, heightIn,\n      );\n    } else {\n      [leftPoints, rightPoints, width, height] = this.getLeftPoints(\n        options, heightIn, widthIn,\n      );\n    }\n\n    // The points of the glyph are for side 'left' by default\n    // Transform the glyph to the correct side and have it's lower left corner\n    // at (0, 0) and be\n    let t;\n    if (side === 'right') {\n      t = new Transform().scale(-1, 1).translate(width, 0);\n    } else if (side === 'top') {\n      t = new Transform()\n        .translate(0, -height / 2)\n        .rotate(-Math.PI / 2)\n        .translate(height / 2, width);\n    } else if (side === 'bottom') {\n      t = new Transform()\n        .translate(0, -height / 2)\n        .rotate(Math.PI / 2)\n        .translate(height / 2, 0);\n    } else {\n      t = new Transform();\n    }\n    const newPointsLeft = leftPoints.map(p => p.transformBy(t.m()));\n    const newPointsRight = rightPoints.map(p => p.transformBy(t.m()));\n    const points = [];\n    newPointsLeft.forEach((r1p, index) => {\n      const r2p = newPointsRight[index];\n      points.push(r1p);\n      points.push(r2p);\n    });\n    if (side === 'top' || side === 'bottom') {\n      return [points, height, width, 'strip'];\n    }\n    return [points, width, height, 'strip'];\n  }\n\n  getLeftPoints(options: Object, widthIn: number, heightIn: number) {\n    const {\n      sides,\n    } = options;\n    const {     // $FlowFixMe\n      lineWidth, width, tipWidth,\n    } = this.getVerticalDefaultValues(heightIn, widthIn, options);\n\n    // width of bracket without linewidth - essentially width of inner radius\n    const wInnerRadius = (width - lineWidth);\n    const innerRadius = (wInnerRadius ** 2 + (heightIn / 2) ** 2) / (2 * wInnerRadius);\n\n    // top line width is half middle line width\n    const wOuterRadius = (width - tipWidth);\n    const outerRadius = (wOuterRadius ** 2 + (heightIn / 2) ** 2) / (2 * wOuterRadius);\n\n    const angleInner = Math.asin(heightIn / 2 / innerRadius);\n    const stepAngleInner = angleInner * 2 / sides;\n    const angleOuter = Math.asin(heightIn / 2 / outerRadius);\n    const stepAngleOuter = angleOuter * 2 / sides;\n\n    const innerPoints: Array<Point> = [];\n    const outerPoints: Array<Point> = [];\n\n    for (let i = 0; i < sides + 1; i += 1) {\n      innerPoints.push(polarToRect(\n        innerRadius, angleInner - stepAngleInner * i + Math.PI,\n      ).add(innerRadius + lineWidth, heightIn / 2));\n      outerPoints.push(polarToRect(\n        outerRadius, angleOuter - stepAngleOuter * i + Math.PI,\n      ).add(outerRadius, heightIn / 2));\n    }\n\n    return [outerPoints, innerPoints, innerPoints[0].x, heightIn];\n  }\n\n\n  // Default values are values of width, height, lineWidth\n  // Values that look good:\n  // height          width         lineWidth\n  //   2              0.2           0.04\n  //   1              0.1           0.03\n  //   0.5            0.05          0.015\n  //   0.3            0.05          0.015\n  //   0.2            0.03          0.012\n  /* eslint-disable class-methods-use-this */\n  // $FlowFixMe\n  getDefaultValues(contentHeight: number, contentWidth: number, options: {\n      lineWidth?: number,\n      width?: number,\n      tipWidth?: number,\n      side?: 'left' | 'right' | 'top' | 'bottom',\n    }) {\n    let out = {};\n    if (options.side === 'left' || options.side === 'right') {\n      out = this.getVerticalDefaultValues(contentHeight, contentWidth, options);\n      // $FlowFixMe\n      out.height = contentHeight;\n    } else {\n      out = this.getVerticalDefaultValues(contentWidth, contentHeight, options);\n      const { width } = out;\n      out.width = contentWidth;\n      // $FlowFixMe\n      out.height = width;\n    }\n    return out;\n  }\n\n  getVerticalDefaultValues(contentHeight: number, contentWidth: ?number, options: {\n      lineWidth?: number,\n      width?: number,\n      tipWidth?: number,\n    }) {\n    const out = {};\n    if (contentWidth == null && options.width == null) {\n      out.width = 97570.78 + (0.004958708 - 97570.78)\n                  / (1 + (contentHeight / 2399858) ** 0.9383909);\n    }\n    if (contentWidth != null) {\n      out.width = contentWidth;\n    }\n    if (options.width != null) {\n      out.width = options.width;\n    }\n    if (options.lineWidth == null) {\n      out.lineWidth = 0.2933614 + (0.0001418178 - 0.2933614)\n                      / (1 + (contentHeight / 39.01413) ** 0.618041);\n    } else {\n      out.lineWidth = options.lineWidth;\n    }\n\n    if (options.tipWidth == null) {\n      out.tipWidth = out.lineWidth / 3;\n    } else {\n      out.tipWidth = options.tipWidth;\n    }\n    return out;\n  }\n}\n","\n// @flow\nimport {\n  Point,\n} from '../../../tools/g2';\n// import {\n//   joinObjects,\n// } from '../../../../tools/tools';\nimport {\n  range,\n} from '../../../tools/math';\nimport Symbol from './SymbolNew';\n\n\nexport default class Integral extends Symbol {\n  // eslint-disable-next-line class-methods-use-this\n  // getTriangles() {\n  //   return 'triangles';\n  // }\n\n  // eslint-disable-next-line class-methods-use-this\n  // getWidth() {\n  //   return (options: Object, height: number) => {\n  //     let width;\n  //     if (options.draw === 'static') {\n  //       let { staticHeight } = options;\n  //       if (typeof staticHeight !== 'number') {\n  //         staticHeight = height;\n  //       }\n  //       ({ width } = this.getDefaultValues(staticHeight, null, options));\n  //       return width / staticHeight * height;\n  //     }\n  //     ({ width } = options);\n  //     ({ width } = this.getDefaultValues(height, width, options));\n  //     return width;\n  //   };\n  // }\n\n  //     --------------------------------------------------   0000000\n  //     A                                              000000011111111\n  //     |                                         0000000   111111111111\n  //     |                                       0000000    11111111111111\n  //     |                                      0000000     11111111111111\n  //     |                                     0000000       111111111111\n  //     |                                   000000000         11111111\n  //     |                                  000000000\n  //     |                                 0000000000\n  //     |    S curve gradient = k         000000000\n  //     |                                0000000000\n  //     |                                0000000000\n  //     |                               00000000000\n  //     |                              00000000000\n  //     |                              000000000000\n  //     |                             000000000000      lineWidth\n  //   h |                     ------->000000000000<----------\n  //     |                             000000000000\n  //     |                             000000000000\n  //     |                            000000000000\n  //     |                             00000000000\n  //     |                            00000000000\n  //     |                            0000000000\n  //     |                            0000000000\n  //     |                            000000000\n  //     |                           000000000\n  //     |                          0000000000\n  //     |      11111111           000000000\n  //     |    111111111111       00000000\n  //     |   11111111111111     0000000\n  //     |   11111111111111   0000000\n  //     |    111111111111   0000000\n  //     V      111111110000000\n  //     -------  0000000\n\n  // Integral line is generated from a sigmoid function (S-curve) that is\n  // thickened more in middle than on ends (square of cosine of normalized\n  // height)\n  //\n  // S (sigmoid) Curve:\n  //                    h\n  //         s(x) = -----------            (1)\n  //                       -kx\n  //                  1 + e\n  //\n  // It's derivative is:\n  //\n  //        ds\n  //       ----  =  h k s (1 - s)          (2)\n  //        dx\n  //\n  // The angle theta of the curve at some given x can is then:\n  //\n  //     theta = atan(ds/dx)               (3)\n  //\n  //\n  // If you know s, x and want to find k, then can rearrange the above to:\n  //\n  //      k = -ln((h / s) - 1) / x         (4)\n  //\n  // Procedure:\n  //    - Find gradient where s = 0.999999 of the height and x is w / 2\n  //    - Make an xRange from w / 2 to w / 2 (with buffer for serif)\n  //    - Go through all x and:\n  //        - Find y from (1)\n  //        - Find the derivative at x using (2) and theta using (3)\n  //        - Find the left and right sides of the line using theta + PI / 2\n  //          and add more thickness in the middle\n  //\n  //    - Find serifs by:\n  //        - Go to end outside point and find its theta\n  //        - Center of serif is then at vector from end point to\n  //          theta + /2 with magnitude of serif radius\n  //        - Draw circle at serif\n  //\n  // eslint-disable-next-line class-methods-use-this\n  getPoints(options: Object, widthIn: number, height: number) {\n    const {\n      sides, serif, num, type, serifSides, lineIntegralSides,\n    } = options;\n    const { lineWidth, width, tipWidth } = this.getDefaultValues(\n      height,\n      widthIn,\n      options,\n    );\n    const singleWidth = width - (num - 1) * lineWidth * 3;\n    const percentage = 0.99999999999;\n    const h = height;\n    const serifRadius = lineWidth * 0.7;\n    let widthWithoutSerifs = singleWidth;\n    if (serif) {\n      widthWithoutSerifs = singleWidth - serifRadius * 2;\n    }\n    const xArray = range(\n      -widthWithoutSerifs / 2,\n      widthWithoutSerifs / 2,\n      widthWithoutSerifs / sides,\n    );\n    const targetY = percentage * height;\n    const k = -Math.log(height / targetY - 1) / singleWidth / 2;\n    let bottomTheta = 0;\n    const linePoints = [];\n    let prevLeft;\n    let prevRight;\n    xArray.forEach((x, index) => {\n      const sigmoid = 1 / (1 + Math.exp(-k * x));\n      const derivative = h * k * sigmoid * (1 - sigmoid);\n      const theta = Math.atan(derivative);\n      const y = sigmoid * h;\n      const a = (lineWidth / 2 - tipWidth / 2)\n                * (Math.cos((y - height / 2) / height * Math.PI)) ** 2\n                + tipWidth / 2;\n      const xDelta = a * Math.cos(theta + Math.PI / 2);\n      const yDelta = a * Math.sin(theta + Math.PI / 2);\n      const left = new Point(x + xDelta + singleWidth / 2, y + yDelta);\n      const right = new Point(x - xDelta + singleWidth / 2, y - yDelta);\n      if (index > 0) {\n        linePoints.push(prevLeft._dup());\n        linePoints.push(prevRight._dup());\n        linePoints.push(right._dup());\n        linePoints.push(prevLeft._dup());\n        linePoints.push(right._dup());\n        linePoints.push(left._dup());\n      }\n      prevLeft = left;\n      prevRight = right;\n      if (index === 0) {\n        bottomTheta = theta;\n      }\n    });\n\n    let points = [];\n    if (serif === false) {\n      points = linePoints;\n    } else {\n      const serifPoints = serifSides;\n\n      const bottomCenter = new Point(\n        linePoints[1].x + serifRadius * Math.cos(bottomTheta + Math.PI / 2),\n        linePoints[1].y + serifRadius * Math.sin(bottomTheta + Math.PI / 2),\n      );\n\n      const topCenter = new Point(\n        linePoints[linePoints.length - 1].x + serifRadius * Math.cos(bottomTheta - Math.PI / 2),\n        linePoints[linePoints.length - 1].y + serifRadius * Math.sin(bottomTheta - Math.PI / 2),\n      );\n\n      const bottomSerifPoints = [];\n      const topSerifPoints = [];\n      const angleDelta = Math.PI * 2 / Math.max(serifPoints, 3);\n      let prevBottom = new Point(0, 0); // initialied for flow only\n      let prevTop = new Point(0, 0);    // initialied for flow only\n      for (let i = 0; i < serifPoints + 1; i += 1) {\n        const bottom = new Point(\n          bottomCenter.x + serifRadius * Math.cos(angleDelta * i),\n          bottomCenter.y + serifRadius * Math.sin(angleDelta * i),\n        );\n        const top = new Point(\n          topCenter.x + serifRadius * Math.cos(angleDelta * i),\n          topCenter.y + serifRadius * Math.sin(angleDelta * i),\n        );\n        if (i > 0) {\n          bottomSerifPoints.push(linePoints[1]._dup());\n          bottomSerifPoints.push(prevBottom._dup());\n          bottomSerifPoints.push(bottom._dup());\n          topSerifPoints.push(linePoints[linePoints.length - 2]._dup());\n          topSerifPoints.push(prevTop._dup());\n          topSerifPoints.push(top._dup());\n        }\n        prevBottom = bottom;\n        prevTop = top;\n      }\n      points = [\n        ...bottomSerifPoints,\n        ...linePoints,\n        ...topSerifPoints,\n      ];\n    }\n    const numPoints = points.length;\n    for (let i = 1; i < num; i += 1) {\n      for (let j = 0; j < numPoints; j += 1) {\n        points.push(points[j].add(lineWidth * 3 * i, 0));\n      }\n      // width = width + lineWidth * 2;\n    }\n    if (type === 'line') {\n      const lineIntegralEllipsePoints = this.getLineIntegralPoints(\n        lineWidth, num, width, height, lineIntegralSides,\n      );\n      points = [...points, ...lineIntegralEllipsePoints];\n    }\n    return [points, width, height, 'triangles'];\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  getLineIntegralPoints(\n    lineWidth: number,\n    num: number,\n    width: number,\n    height: number,\n    sides: number,\n  ) {\n    const ellipseHeight = lineWidth * 6;\n    const ellipseWidth = Math.max(\n      ellipseHeight,\n      (lineWidth * 3 + (num - 1) * lineWidth * 3 / 2) * 2,\n    );\n    const center = new Point(width / 2, height / 2);\n    const deltaAngle = Math.PI * 2 / sides;\n    let prevOuter = new Point(0, 0);\n    let prevInner = new Point(0, 0);\n    const ellipseLineWidth = lineWidth / 2;\n    const points = [];\n    for (let i = 0; i < sides + 1; i += 1) {\n      const angle = i * deltaAngle;\n      const inner = new Point(\n        (ellipseWidth / 2 - ellipseLineWidth / 2) * Math.cos(angle),\n        (ellipseHeight / 2 - ellipseLineWidth / 2) * Math.sin(angle),\n      ).add(center);\n      const outer = new Point(\n        (ellipseWidth / 2 + ellipseLineWidth / 2) * Math.cos(angle),\n        (ellipseHeight / 2 + ellipseLineWidth / 2) * Math.sin(angle),\n      ).add(center);\n      if (i > 0) {\n        points.push(prevOuter._dup());\n        points.push(prevInner._dup());\n        points.push(inner._dup());\n        points.push(prevOuter._dup());\n        points.push(inner._dup());\n        points.push(outer._dup());\n      }\n      prevOuter = outer;\n      prevInner = inner;\n    }\n    return points;\n  }\n\n  /* eslint-disable class-methods-use-this */\n  // $FlowFixMe\n  getDefaultValues(height: number, width: ?number, options: {\n      lineWidth?: number,\n      tipWidth?: number,\n      num: number,\n    }) {\n    // at 2:\n    //    lw = 0.05 (40)\n    //     w = 0.4 (5)\n    //     e = 0.01 (200)\n    //\n    // at 1:\n    //    lw = 0.03 (33)\n    //     w = 0.25 (4)\n    //     e = 0.01 (100)\n    //\n    // at 0.5:\n    //    lw = 0.02 (25)\n    //     w = 0.15 (3.3)\n    //     e = 0.008 (63)\n    //\n    // at 0.3:\n    //    lw = 0.017 (17)\n    //     w = 0.15 (2)\n    //     e = 0.006 (50)\n    //\n    // Using https://mycurvefit.com and add 0 to each to keep values under 0.3 positive\n    const defaultLineWidth = 607.73 + (0.0004220802 - 607.73)\n      / (1 + (height / 5368595) ** 0.6370402);\n    const defaultSingleWidth = 12277.16 + (0.003737719 - 12277.16)\n      / (1 + (height / 36507180) ** 0.6193363);\n    const defaultTotalWidth = defaultSingleWidth + ((options.num - 1) * defaultLineWidth * 3);\n    const out = {\n      lineWidth: defaultLineWidth,\n      width: defaultTotalWidth,\n      tipWidth: 0.01033455 + (0.000004751934 - 0.01033455) / (1 + (height / 0.2588074) ** 2.024942),\n      height,\n    };\n    if (width != null) {\n      out.width = width;\n    }\n    if (options.lineWidth != null) {\n      out.lineWidth = options.lineWidth;\n    }\n    if (options.tipWidth != null) {\n      out.tipWidth = options.tipWidth;\n    } else {\n      out.tipWidth = out.lineWidth / 3;\n    }\n\n    return out;\n  }\n}\n","// @flow\nimport { FigureElementPrimitive } from '../../Element';\nimport {\n  Point, Line,\n} from '../../../tools/g2';\nimport { makePolyLine } from '../../geometries/lines/lines';\nimport Symbol from './SymbolNew';\n// import WebGLInstance from '../../../webgl/webgl';\n\n\nexport default class EquationLine extends Symbol {\n  symbol: FigureElementPrimitive;\n\n  // constructor(\n  //   webgl: Array<WebGLInstance>,\n  //   color: TypeColor,\n  //   transformOrLocation: Transform | Point,\n  //   figureLimits: Rect,\n  //   symbolOptions: Object,\n  //   // triangles: 'strip' | 'triangles' | 'fan',\n  // ) {\n  //   super(webgl, color, transformOrLocation, figureLimits, symbolOptions);\n  //   // this.custom.setSize = (location: Point) => {\n\n  //   // }\n  // }\n  // eslint-disable-next-line class-methods-use-this\n  // getTriangles() {\n  //   return 'strip';\n  // }\n\n  //                             width\n  //          |<---------------------------------------->|\n  //          |                                          |  3\n  //        1 |                                          | ____\n  //          00000000000000000000000000000000000000000000   A\n  //          00000000000000000000000000000000000000000000   |  Line Width\n  //          00000000000000000000000000000000000000000000 __V_\n  //         0                                            2\n  //\n\n  // eslint-disable-next-line class-methods-use-this\n  getPoints(options: Object, angle: number, length: number) {\n    // const { lineWidth, width, height } = this.getDefaultValues(\n    //   null, null, options,\n    // );\n    // const p1 = options.spacedLine.p1;\n    // const p2 = options.spacedLine.p2;\n    // console.log(angle, length)\n    const line = new Line([0, 0], length, angle);\n    // console.log(line)\n    const [points] = makePolyLine(\n      [new Point(0, 0), line.p2], options.width, false, 'mid', 'none', 0.1,\n      1, 0, options.dash, false,\n      2, [[]], 0, [[]], options.arrow,\n    );\n\n    // const points = [\n    //   new Point(0, 0),\n    //   new Point(0, lineWidth),\n    //   new Point(width, 0),\n    //   new Point(width, lineWidth),\n    // ];\n    return [points, angle, length, 'triangles'];\n  }\n\n  /* eslint-disable class-methods-use-this */\n  // $FlowFixMe\n  // getDefaultValues(height: number, width: ?number, options: {\n  //     lineWidth?: number,\n  //   }) {\n  //   const out = {};\n  //   if (options.lineWidth != null) {\n  //     out.lineWidth = options.lineWidth;\n  //   } else {\n  //     out.lineWidth = 0.01;\n  //   }\n  //   out.height = out.lineWidth;\n  //   if (width != null) {\n  //     out.width = width;\n  //   } else {\n  //     out.width = 1;\n  //   }\n  //   return out;\n  // }\n}\n","\n// @flow\nimport {\n  Point, quadBezierPoints,\n} from '../../../tools/g2';\nimport Symbol from './SymbolNew';\n// import Bounds from '../Elements/Bounds';\n\nexport default class Product extends Symbol {\n  // eslint-disable-next-line class-methods-use-this\n  // getTriangles() {\n  //   return 'strip';\n  // }\n\n  // eslint-disable-next-line class-methods-use-this\n  // getWidth() {\n  //   return (options: Object, height: number) => {\n  //     // The width should be 7 times the thick2 linewidth;\n  //     // const { lineWidth } = options;\n  //     let width;\n  //     if (options.draw === 'static') {\n  //       let { staticHeight } = options;\n  //       if (typeof staticHeight !== 'number') {\n  //         staticHeight = height;\n  //       }\n  //       ({ width } = this.getDefaultValues(staticHeight, null, options));\n  //       return width / staticHeight * height;\n  //     }\n  //     ({ width } = options);\n  //     ({ width } = this.getDefaultValues(height, width, options));\n  //     return width;\n  //   };\n  // }\n\n  //                                            w\n  //             |<--------------------------------------------------------->|\n  //             |                                                           |\n  //             |   a                                                       |\n  //             |<---->|                                                    |\n  //             |      |                     thick1                         |\n  //             |      |                     /                              |\n  //             |      |                    /                               |\n  //       ---- 00000000000000000000000000000000000000000000000000000000000000\n  //       A         000000000000000000000000000000000000000000000000000000\n  //       |           00000000000000000000000000000000000000000000000000\n  //       |            00000000000                         00000000000\n  //       |            00000000000                         00000000000\n  //       |            00000000000                         00000000000\n  //       |            00000000000                         00000000000\n  //       |            00000000000                         00000000000\n  //       |            00000000000                         00000000000\n  //       |            00000000000                         00000000000\n  //       |            00000000000                         00000000000\n  //       |            00000000000   \\                 /   00000000000\n  //    h  |            00000000000    \\              /     00000000000\n  //       |            00000000000      \\          /       00000000000\n  //       |            00000000000        \\      /         00000000000\n  //       |            00000000000         thick2          00000000000\n  //       |            00000000000                         00000000000\n  //       |            00000000000                         00000000000\n  //       |            00000000000                         00000000000\n  //       |            00000000000                         00000000000\n  //       |            00000000000                         00000000000\n  //       |            00000000000                         00000000000\n  //       |            00000000000                         00000000000\n  //       |            00000000000                         00000000000\n  //       |           0000000000000                       00000000000000\n  //       V         00000000000000000                   000000000000000000\n  //       ----- 0000000000000000000000000           00000000000000000000000000\n\n  //\n  //                         10 0000000000000000000000000 11\n  //                          8 0000000000000000000000000 9\n  //                                 6 00000000000 7\n  //                                   00000000000\n  //                                   00000000000\n  //                                   00000000000\n  //                                   00000000000\n  //                                   00000000000\n  //                                   00000000000\n  //                                   00000000000\n  //                                   00000000000\n  //                                   00000000000\n  //                                   00000000000\n  //                                   00000000000\n  //                                   00000000000\n  //                                   00000000000\n  //                                   00000000000\n  //                                   00000000000\n  //                                   00000000000\n  //                                   00000000000\n  //                                   00000000000\n  //                                   00000000000\n  //                                   00000000000\n  //                                   00000000000\n  //                                 4 00000000000 5\n  //                          2 00000000000000000000000000  3\n  //                          0 00000000000000000000000000  1\n  //                        (0, 0)\n\n  // eslint-disable-next-line class-methods-use-this\n  getPoints(options: Object, widthIn: number, height: number) {\n    const { serif, sides } = options;\n    const { lineWidth, width } = this.getDefaultValues(\n      height,\n      widthIn,\n      options,\n    );\n    let sidesToUse = sides;\n    if (serif === 'false') {\n      sidesToUse = 2;\n    }\n    // const { lineWidth, sides } = options;\n    // let lineWidthToUse = lineWidth;\n    // if (lineWidth == null) {\n    //   // lineWidthToUse = width / (25 * height + 15);\n    //   lineWidthToUse = width / 21;\n    // }\n\n    const thick1 = lineWidth * 1.2;\n    const thick2 = lineWidth * 3;\n    const tipWidth = lineWidth / 2;\n    const a = thick2 * 0.9;\n\n    const p0 = new Point(0, 0);\n    const p1 = new Point(thick2 + a * 2, 0);\n    const p2 = new Point(p0.x, tipWidth);\n    const p3 = new Point(p1.x, tipWidth);\n    const p4 = new Point(a, p2.y);\n    const p5 = new Point(a + thick2, p4.y);\n    const p6 = new Point(p4.x, height - tipWidth);\n    const p7 = new Point(p5.x, height - tipWidth);\n    const p8 = new Point(p2.x, height - tipWidth);\n    // const p9 = new Point(p3.x, height - tipWidth);\n    const p10 = new Point(p2.x, height);\n    const p11 = new Point(p3.x, height);\n\n    const p40 = p2;\n    const p41 = p4;\n    const p42 = new Point(p4.x, p4.y + a);\n    const p50 = p3;\n    const p51 = p5;\n    const p52 = new Point(p5.x, p4.y + a);\n    const p4Curve = quadBezierPoints(p40, p41, p42, sidesToUse);\n    const p5Curve = quadBezierPoints(p50, p51, p52, sidesToUse);\n    const bottomCurve = [];\n    p4Curve.forEach((p, index) => {\n      bottomCurve.push(p);\n      bottomCurve.push(p5Curve[index]);\n    });\n\n    const p60 = new Point(p6.x, p6.y - a);\n    const p61 = p6;\n    const p62 = p8;\n    // const p70 = new Point(p7.x, p7.y - a);\n    // const p71 = p7;\n    // const p72 = p9;\n    const p6Curve = quadBezierPoints(p60, p61, p62, sidesToUse);\n    // const p7Curve = quadBezierPoints(p70, p71, p72, sides);\n    const topCurve = [];\n    p6Curve.forEach((p) => {\n      topCurve.push(p);\n      // topCurve.push(p7Curve[index]);\n      topCurve.push(new Point(p7.x, p.y));\n    });\n\n    const leg = [\n      p0,\n      p1,\n      // p2,\n      // p3,\n      // p4,\n      // p5,\n      ...bottomCurve,\n      // p6,\n      // p7,\n      // p8,\n      // p9,\n      ...topCurve,\n      p10,\n      p11,\n    ];\n    const leg2 = [];\n    for (let i = leg.length - 1; i > 0; i -= 2) {\n      leg2.push(new Point(width - leg[i - 1].x, leg[i - 1].y));\n      leg2.push(new Point(width - leg[i].x, leg[i].y));\n    }\n    const transition = [\n      new Point(a + thick2, height),\n      new Point(a + thick2, height - thick1),\n      new Point(width - a - thick2, height),\n      new Point(width - a - thick2, height - thick1),\n    ];\n    const points = [\n      ...leg,\n      ...transition,\n      ...leg2,\n    ];\n    return [points, width, height, 'strip'];\n  }\n\n  // Linewidths that look good:\n  // height          width         lineWidth\n  //   2              1.6            0.05\n  //   1              0.8            0.025\n  //   0.5            0.4            0.012\n  //   0.3            0.25           0.009\n  //   0.2            0.2           0.008\n  /* eslint-disable class-methods-use-this */\n  // $FlowFixMe\n  getDefaultValues(height: number, width: ?number, options: {\n      lineWidth?: number,\n    }) {\n    const out: {\n      lineWidth: number,\n      width: number,\n      height: number,\n    } = {\n      lineWidth: options.lineWidth || 1, // height * 0.93 / (25 * height + 15),\n      width: width || 1,\n      height,\n    };\n    if (options.lineWidth == null && width != null) {\n      out.lineWidth = width / 7 / 3;\n    } else if (options.lineWidth == null && width == null) {\n      // out.lineWidth = height * 0.93 / (25 * height + 15);\n      out.lineWidth = 12902.65 + (0.001053004 - 12902.65) / (1 + (height / 573148) ** 0.9938213);\n      out.width = 1704804 + (0.002184303 - 1704804) / (1 + (height / 2234236) ** 0.9967453);\n    } else if (options.lineWidth != null && width == null) {\n      out.width = options.lineWidth * 7 * 3;\n    }\n    return out;\n  }\n}\n","// @flow\nimport { FigureElementPrimitive } from '../../Element';\nimport {\n  Point, Line,\n} from '../../../tools/g2';\nimport Symbol from './SymbolNew';\nimport Bounds from '../Elements/Bounds';\n// import WebGLInstance from '../../../webgl/webgl';\nimport type {\n  TypeColor,\n} from '../../../tools/types';\n\nexport default class Radical extends Symbol {\n  symbol: FigureElementPrimitive;\n\n  // eslint-disable-next-line class-methods-use-this\n  // getTriangles() {\n  //   return 'strip';\n  // }\n\n  //   height                      left space                right space\n  //   |                             >|--|<                    >|--|<\n  //   |                              |  |                      |  |\n  //   |                              |  |                      |  |\n  //   |_____________________________ XXXXXXXXXXXXXXXXXXXXXXXXXXXXXX____V\n  //   A                             X|  |                      |_______|\n  //   |   startHeight              X |   CCCCCCCCCCCCCCCCCCCCCCC       A\n  //   |   |                       X  |   CCCCCCCCCCCCCCCCCCCCCCC    top space\n  //   |   |    tickHeight        X   |   CCCCCCCCCCCCCCCCCCCCCCC\n  //   |   |    |                X    |   CCCCCCCCCCCCCCCCCCCCCCC\n  //   |   |____V____           X     |   CCCCCCCCCCCCCCCCCCCCCCC\n  //   |   A    |    X         X      |   CCCCCCCCCCCCCCCCCCCCCCC\n  //   |   |    |__X |X       X       |   CCCCCCCCCCCCCCCCCCCCCCC\n  //   |   |    A |  | X     X        |   CCCCCCCCCCCCCCCCCCCCCCC\n  //   |   |      |  |  X   X         |   CCCCCCCCCCCCCCCCCCCCCCC   bottom space\n  //   |   |      |  |   X X          |   CCCCCCCCCCCCCCCCCCCCCCC_______V\n  //   V___V______|__|____X __________|_________________________________|\n  //              |  |    |           |                                 A\n  //              |  |    |           |\n  //        tick >|--|<   |           |\n  //       width  |  |    |           |\n  //              |  |<-->|down width |\n  //              |                   |\n  //              |<------------------|\n  //                     startWidth\n  //\n  //\n  //\n  //  First define bottom line (B), then offset the lines and find intercepts to\n  //  get the top line (T)\n  //         RRRRRRRRRRRRRRRR                  7                          9\n  //         RRRRRRRRRRRRRRRR                    TTTTTTTTTTTTTTTTTTTTTTTTT\n  //         RRRRRRRRRRRRRRRR                   T  BBBBBBBBBBBBBBBBBBBBBBB\n  //         RRRRRRRRRRRRRRRR                  T  B 6                     8\n  //         RRRRRRRRRRRRRRRR                 T  B\n  //         RRRRRRRRRRRRRRRR                T  B\n  //         RRRRRRRRRRRRRRRR               T  B\n  //                        |              T  B\n  //                        |             T  B\n  //            3           |            T  B\n  //            T           |           T  B\n  //           T T          |          T  B\n  //          T   T   lineWidth2      T  B\\\n  //         T     T       /|        T  B  \\\n  //        T  B    T    /  |       T  B    \\\n  //       T  B B    T /    |      T  B      lineWidth\n  //    1 T  B 2 B    T     |     T  B\n  //        B     B    T    |    T  B\n  //        0      B    T   |   T  B\n  //                B    T  |  T  B\n  //                 B    T 5 T  B\n  //                  B    T T  B\n  //                   B    T  B\n  //                    B     B\n  //                     B   B\n  //                      B B\n  //                       B\n  //                       4\n  //\n  // Root aligns with downWidth + tickWidth\n  //\n\n\n  // eslint-disable-next-line class-methods-use-this\n  getPoints(options: Object, widthIn: number, heightIn: number) {\n    // const { proportionalToHeight } = options;\n    const {\n      lineWidth, startWidth, tickWidth, tickHeight,\n      downWidth, startHeight, lineWidth2, height, width,\n    } = this.getDefaultValues(\n      heightIn, widthIn, options,\n    );\n\n    const p0 = new Point(0, startHeight - tickHeight);\n    const p2 = new Point(tickWidth, startHeight);\n    const p4 = new Point(downWidth + tickWidth, 0);\n    const p6 = new Point(startWidth, height - lineWidth);\n    const p8 = new Point(width, height - lineWidth);\n\n    const line02 = new Line(p0, p2);\n    const line24 = new Line(p2, p4);\n    const line46 = new Line(p4, p6);\n    const line68 = new Line(p6, p8);\n\n    const line02Offset = line02.offset('top', lineWidth);\n    const line24Offset = line24.offset('top', lineWidth2);\n    const line46Offset = line46.offset('top', lineWidth);\n    const line68Offset = line68.offset('top', lineWidth);\n\n    const p1 = line02Offset.p1._dup();\n    const p3 = line02Offset.intersectsWith(line24Offset).intersect;\n    const p5 = line24Offset.intersectsWith(line46Offset).intersect;\n    const p7 = line46Offset.intersectsWith(line68Offset).intersect;\n    const p9 = p8.add(0, lineWidth);\n\n    const points = [p0, p1, p2, p3, p4, p5, p6, p7, p8, p9];\n\n    return [points, widthIn, heightIn, 'strip'];\n  }\n\n  // Get Glyph bounds based on content\n  /* eslint-disable class-methods-use-this */\n  getBounds(\n    options: {\n      color?: TypeColor,\n      lineWidth?: number,\n      startHeight?: number,\n      startWidth?: number,\n      proportionalToHeight?: boolean,\n      maxStartWidth?: ?number,\n      maxStartHeight?: ?number,\n      width?: number,             // contentWidth\n      height?: number,            // contentHeight\n      draw: 'static' | 'dynamic',\n      staticHeight?: number | 'first',\n      staticWidth?: number | 'first',\n      lineWidth2?: number,\n      tickWidth?: number,\n      tickHeight?: number,\n      downWidth?: number,\n    },\n    contentX: number,\n    contentY: number,\n    contentWidthIn: number,\n    contentHeightIn: number,\n  ) {    // $FlowFixMe\n    const height = this.getHeightFromContentHeight(contentHeightIn, options);\n    const {\n      width, startWidth, lineWidth, startHeight, downWidth, tickWidth, lineWidth2,\n    } = this.getDefaultValues(    // $FlowFixMe\n      height, contentWidthIn, options,\n    );\n    const bounds = new Bounds();\n    if (options.draw === 'static') {\n      let { staticWidth, staticHeight } = options;\n      if (staticWidth === 'first') {\n        staticWidth = width + startWidth;\n      }\n      if (staticHeight === 'first') {\n        staticHeight = height + lineWidth;\n      }\n      if (staticWidth == null) {\n        staticWidth = 1;\n      }\n      if (staticHeight == null) {\n        staticHeight = 1;\n      }\n      const heightLineWidthRatio = lineWidth / staticHeight;\n      const widthStartWidthRatio = startWidth / staticWidth;\n      const heightStartHeightRatio = startHeight / staticHeight;\n      bounds.width = width / (1 - widthStartWidthRatio);\n      bounds.height = height / (1 - heightLineWidthRatio);\n      const widthStartWidth = bounds.width * widthStartWidthRatio;\n      const heightStartHeight = bounds.height * heightStartHeightRatio;\n      const heightLineWidth = bounds.height * heightLineWidthRatio;\n      bounds.left = contentX - widthStartWidth;\n      bounds.right = bounds.left + bounds.width;\n      bounds.bottom = contentY;\n      bounds.top = bounds.bottom + bounds.height;\n      bounds.ascent = bounds.height;\n      bounds.descent = 0;\n      // $FlowFixMe\n      bounds.annotations = {\n        root: {\n          xPosition: 'left',\n          yPosition: 'bottom',\n          xAlign: 'right',\n          yAlign: 'bottom',\n          offset: new Point(widthStartWidth * 0.5, heightStartHeight + heightLineWidth * 2),\n        },\n      };\n    } else {\n      bounds.left = contentX + contentWidthIn / 2 - width / 2 - startWidth;\n      bounds.bottom = contentY;\n      bounds.width = width + startWidth;\n      bounds.height = height;\n      bounds.right = bounds.left + bounds.width;\n      bounds.top = bounds.bottom + bounds.height;\n      bounds.descent = 0;\n      bounds.ascent = bounds.height;\n      // $FlowFixMe\n      bounds.annotations = {\n        root: {\n          xPosition: 'left',\n          yPosition: 'bottom',\n          xAlign: 'right',\n          yAlign: 'bottom',\n          offset: new Point(downWidth + tickWidth, startHeight + lineWidth2),\n        },\n      };\n    }\n    return bounds;\n  }\n\n  /* eslint-disable class-methods-use-this */\n  getHeightFromContentHeight(contentHeightIn: number, options: {\n    lineWidth?: number,\n    contentHeight?: number,\n  }): number {\n    let lineWidth;\n    let contentHeight;\n    if (options.lineWidth != null && typeof options.lineWidth === 'number') {\n      ({ lineWidth } = options);\n    } else {\n      lineWidth = 0.01;\n    }\n\n    if (contentHeightIn != null) {\n      contentHeight = contentHeightIn;\n    } else {\n      contentHeight = 1;\n    }\n    return contentHeight + lineWidth;\n  }\n\n  /* eslint-disable class-methods-use-this */\n  // $FlowFixMe\n  getDefaultValues(\n    height: ?number,\n    width: ?number,\n    options: {\n      lineWidth?: number,\n      height?: number,\n      width?: number,\n      lineWidth?: number,\n      lineWidth2?: number,\n      startWidth?: number,\n      startHeight?: number,\n      tickHeight?: number,\n      tickWidth?: number,\n      downWidth?: number,\n      maxStartWidth?: number,\n      maxStartHeight?: number,\n      proportionalToHeight?: boolean,\n      downWidth?: number,\n    },\n  ): {\n      height: number,\n      width: number,\n      lineWidth: number,\n      lineWidth2: number,\n      startWidth: number,\n      startHeight: number,\n      tickHeight: number,\n      tickWidth: number,\n      downWidth: number,\n    } {\n    const out = {};\n    if (options.lineWidth != null && typeof options.lineWidth === 'number') {\n      out.lineWidth = options.lineWidth;\n    } else {\n      out.lineWidth = 0.01;\n    }\n    if (options.lineWidth2 != null && typeof options.lineWidth2 === 'number') {\n      out.lineWidth2 = options.lineWidth2;\n    } else {\n      out.lineWidth2 = out.lineWidth * 2;\n    }\n\n    if (options.height != null && typeof options.height === 'number') {\n      out.height = options.height;\n    } else if (height != null) {\n      out.height = height;\n    } else {\n      out.height = 1;\n    }\n\n    if (options.startHeight != null && typeof options.startHeight === 'number') {\n      out.startHeight = options.startHeight;\n      if (options.proportionalToHeight) {   // $FlowFixMe\n        out.startHeight = options.startHeight * out.height;\n      }\n    } else {\n      out.startHeight = out.height / 3;\n    }\n    if (options.maxStartHeight != null && options.maxStartHeight < out.startHeight) {\n      out.startHeight = options.maxStartHeight;\n    }\n\n    if (options.tickHeight != null && typeof options.tickHeight === 'number') {\n      out.tickHeight = options.tickHeight;\n      if (options.proportionalToHeight) {   // $FlowFixMe\n        out.tickHeight = options.tickHeight * out.startHeight;\n      }\n    } else {\n      out.tickHeight = out.startHeight * 0.1;\n    }\n\n    if (options.startWidth != null && typeof options.startWidth === 'number') {\n      out.startWidth = options.startWidth;\n      if (options.proportionalToHeight) {   // $FlowFixMe\n        out.startWidth = options.startWidth * out.height;\n      }\n    } else {\n      out.startWidth = out.startHeight / 2;\n    }\n    if (options.maxStartWidth != null && options.maxStartWidth < out.startWidth) {\n      out.startWidth = options.maxStartWidth;\n    }\n\n    if (options.tickWidth != null && typeof options.tickWidth === 'number') {\n      out.tickWidth = options.tickWidth;\n      if (options.proportionalToHeight) {   // $FlowFixMe\n        out.tickWidth = options.tickWidth * out.startWidth;\n      }\n    } else {\n      out.tickWidth = out.startWidth / 5;\n    }\n\n    if (options.downWidth != null && typeof options.downWidth === 'number') {\n      out.downWidth = options.downWidth;\n      if (options.proportionalToHeight) {   // $FlowFixMe\n        out.downWidth = options.downWidth * out.startWidth;\n      }\n    } else {\n      out.downWidth = out.startWidth / 5 * 2;\n    }\n\n    if (options.width != null && typeof options.width === 'number') {\n      out.width = options.width;\n    } else if (width != null) {\n      out.width = width;\n    } else {\n      out.width = 1;\n    }\n    return out;\n  }\n}\n","// @flow\nimport {\n  Point, polarToRect,\n} from '../../../tools/g2';\nimport Bracket from './Bracket';\n\n\nexport default class SquareBracket extends Bracket {\n  // eslint-disable-next-line class-methods-use-this\n  // getWidth() {\n  //   return (type: 'static' | 'dynamic', options: Object, height: number) => {\n  //     const { width } = options;\n  //     if (type === 'static') {\n  //       return height * width;\n  //     }\n  //     return width;\n  //   };\n  // }\n\n  //                            width\n  //                  |<--------------------->|\n  //\n  //            ___   ._______________________    ____\n  //           A      |                       |      A\n  //           |      |                       |      | tipWidth\n  //           |      |      .________________|   ___V\n  //           |      |      |\n  //           |      |      |\n  //           |      |      |\n  //           |      |      |\n  //  height   |      |      |\n  //           |      |      |\n  //           |      |      |\n  //           |      |      |\n  //           |      |      |\n  //           |      |      |________________\n  //           |      |                       |\n  //           |      |                       |\n  //           V___   |_______________________|\n  //\n  //                  |      |\n  //                  |      |\n  //                  |<---->|\n  //                 line width\n  //\n  // If radius is defined, then lineEndWidth = lineWidth\n  //\n  // eslint-disable-next-line class-methods-use-this\n  getLeftPoints(options: Object, widthIn: number, height: number) {\n    // const {\n    //   lineWidth, width, endLineWidth, radius, sides,\n    // } = options;\n\n    const {\n      sides, radius,\n    } = options;\n\n    const { lineWidth, width, tipWidth } = this.getVerticalDefaultValues(height, widthIn, options);\n\n    if (radius === 0) {\n      const outsidePoints = [\n        new Point(width, 0),\n        new Point(0, 0),\n        new Point(0, height),\n        new Point(width, height),\n      ];\n      const insidePoints = [\n        new Point(width, tipWidth),\n        new Point(lineWidth, tipWidth),\n        new Point(lineWidth, height - tipWidth),\n        new Point(width, height - tipWidth),\n      ];\n      return [outsidePoints, insidePoints, width, height];\n    }\n\n    const radiusToUse = Math.min(radius, width, height / 2);\n    const rOutside = radiusToUse;\n    const rInside = radiusToUse - lineWidth;\n\n    const outsidePoints = [new Point(width, 0)];\n    const insidePoints = [new Point(width, lineWidth)];\n\n    const lowCenter = new Point(rOutside, rOutside);\n    const highCenter = new Point(rOutside, height - rOutside);\n\n    for (let i = 0; i <= sides; i += 1) {\n      const angle = Math.PI / 2 / sides * i;\n      outsidePoints.push(polarToRect(rOutside, Math.PI / 2 * 3 - angle).add(lowCenter));\n      insidePoints.push(polarToRect(rInside, Math.PI / 2 * 3 - angle).add(lowCenter));\n    }\n\n    for (let i = 0; i <= sides; i += 1) {\n      const angle = Math.PI / 2 / sides * i;\n      outsidePoints.push(polarToRect(rOutside, Math.PI - angle).add(highCenter));\n      insidePoints.push(polarToRect(rInside, Math.PI - angle).add(highCenter));\n    }\n\n    outsidePoints.push(new Point(width, height));\n    insidePoints.push(new Point(width, height - lineWidth));\n\n    // if (side === 'top' || side === 'bottom') {\n    //   return this.getBracketPoints(outsidePoints, insidePoints, side, height, width);\n    // }\n    return [outsidePoints, insidePoints, width, height];\n  }\n\n  /* eslint-disable class-methods-use-this */\n  getVerticalDefaultValues(height: number, width: ?number, options: {\n      lineWidth?: number,\n      width?: number,\n      tipWidth?: number,\n    }) {\n    const out = {};\n    if (width == null && options.width == null) {\n      out.width = (97570.78 + (0.004958708 - 97570.78)\n                  / (1 + (height / 2399858) ** 0.9383909)) * 0.8;\n    }\n    if (width != null) {\n      out.width = width;\n    }\n    if (options.width != null) {\n      out.width = options.width;\n    }\n    if (options.lineWidth == null) {\n      out.lineWidth = (0.2933614 + (0.0001418178 - 0.2933614)\n                      / (1 + (height / 39.01413) ** 0.618041)) * 0.8;\n    } else {\n      out.lineWidth = options.lineWidth;\n    }\n\n    if (options.tipWidth == null) {\n      out.tipWidth = out.lineWidth * 0.7;\n    } else {\n      out.tipWidth = options.tipWidth;\n    }\n    return out;\n  }\n}\n","// @flow\nimport { FigureElementPrimitive } from '../../Element';\nimport {\n  Point,\n} from '../../../tools/g2';\nimport Symbol from './SymbolNew';\nimport Bounds from '../Elements/Bounds';\n// import WebGLInstance from '../../../webgl/webgl';\n\n\nexport default class Strike extends Symbol {\n  symbol: FigureElementPrimitive;\n\n  // eslint-disable-next-line class-methods-use-this\n  // getTriangles() {\n  //   return 'strip';\n  // }\n\n  //                             X Strike\n  //               2    3                  4      5\n  //             --- 000                     000\n  //             A     000                 000\n  //             |       000             000\n  //             |         000         000\n  //             |           000     000\n  //             |             000 000\n  //     height  |               000\n  //             |             000 000\n  //             |           000     000\n  //             |         000         000\n  //             |       000             000\n  //             V     000                 000\n  //             --- 000                     000\n  //               0 |   1                 6   |  7\n  //                 |                         |\n  //                 |<----------------------->|\n  //                           width\n  //\n  //\n  //                          Forward Strike\n  //\n  //                                         000\n  //                                       000\n  //                                     000\n  //                                   000\n  //                                 000\n  //                               000\n  //                             000\n  //                           000\n  //                         000\n  //                       000\n  //                     000\n  //                   000\n  //                 000\n\n  //                          Back Strike\n  //                 000\n  //                   000\n  //                     000\n  //                       000\n  //                         000\n  //                           000\n  //                             000\n  //                               000\n  //                                 000\n  //                                   000\n  //                                     000\n  //                                       000\n  //                                         000\n\n\n  //                1      Horizontal Strike     3\n  //                 000000000000000000000000000\n  //                 000000000000000000000000000\n  //                0                            2\n  //\n  //              |\n  //              |           \\      00000000000000\n  //              |             \\  00000000000000\n  //              |              00000000000000\n  //              |            00000000000000\n  //              |          00000000000000\n  //              |        00000000000000\n  //              |      00000000000000  \\\n  //              |    00000000000000      \\ LineWidth\n  //              |  00000000000000   o\n  //           -- |00000000000000       o   theta\n  //           A  |  0000000000          o\n  //         b |  |    000000             o\n  //           V  |    g 00               o\n  //           --- -------------------------------\n  //              |       |\n  //              |<----->|\n  //                  a\n  //\n  // theta = atan(height / width)\n  //\n  // angle g = 180 - theta - 90\n  // b = lineWidth * sin(g)\n  // a = lineWidth * cos(g)\n\n\n  // eslint-disable-next-line class-methods-use-this\n  getPoints(options: Object, widthIn: number, heightIn: number) {\n    const { style } = options;\n    const { lineWidth, width, height } = this.getDefaultValues(\n      heightIn, widthIn, options,\n    );\n    let points;\n    const theta = Math.atan2(height, width);\n    const g = Math.PI / 2 - theta;\n    const a = lineWidth * Math.cos(g);\n    const b = lineWidth * Math.sin(g);\n    const p0 = new Point(0, b);\n    const p1 = new Point(a, 0);\n    const p2 = new Point(0, height - b);\n    const p3 = new Point(a, height);\n    const p4 = new Point(width - a, height);\n    const p5 = new Point(width, height - b);\n    const p6 = new Point(width - a, 0);\n    const p7 = new Point(width, b);\n\n    const h0 = new Point(0, height / 2 - lineWidth / 2);\n    const h1 = new Point(0, height / 2 + lineWidth / 2);\n    const h2 = new Point(width, height / 2 - lineWidth / 2);\n    const h3 = new Point(width, height / 2 + lineWidth / 2);\n\n    if (style === 'forward') {\n      points = [\n        p0, p1, p5,\n        p0, p5, p4,\n      ];\n    } else if (style === 'back') {\n      points = [\n        p2, p3, p7,\n        p2, p7, p6,\n      ];\n    } else if (style === 'cross') {\n      points = [\n        p0, p1, p5,\n        p0, p5, p4,\n        p2, p3, p7,\n        p2, p7, p6,\n      ];\n    } else {\n      points = [\n        h0, h2, h3,\n        h0, h3, h1,\n      ];\n    }\n    return [points, width, height, 'triangles'];\n  }\n\n  /* eslint-disable class-methods-use-this */\n  getBounds(\n    options: {\n      lineWidth?: number,\n      height?: number,\n      width?: number,\n    },\n    leftIn: number,\n    bottomIn: number,\n    widthIn: number,\n    heightIn: number,\n  ) {\n    const { width, height } = this.getDefaultValues(\n      heightIn, widthIn, options,\n    );\n    const bounds = new Bounds();\n    bounds.left = leftIn;\n    bounds.bottom = bottomIn;\n    bounds.width = width;\n    bounds.height = height;\n    bounds.right = bounds.left + bounds.width;\n    bounds.top = bounds.bottom + bounds.height;\n    bounds.descent = 0;\n    bounds.ascent = bounds.height;\n    return bounds;\n  }\n\n  /* eslint-disable class-methods-use-this */\n  // $FlowFixMe\n  getDefaultValues(height: number, width: ?number, options: {\n      lineWidth?: number,\n      height?: number,\n      width?: number,\n    }): {\n      height: number,\n      width: number,\n      lineWidth: number,\n    } {\n    const out = {};\n    if (options.lineWidth != null && typeof options.lineWidth === 'number') {\n      out.lineWidth = options.lineWidth;\n    } else {\n      out.lineWidth = 0.015;\n    }\n    if (options.height != null && typeof options.height === 'number') {\n      out.height = options.height;\n    } else if (height != null) {\n      out.height = height;\n    } else {\n      out.height = 1;\n    }\n    if (options.width != null && typeof options.width === 'number') {\n      out.width = options.width;\n    } else if (width != null) {\n      out.width = width;\n    } else {\n      out.width = 1;\n    }\n    return out;\n  }\n}\n","\n// @flow\nimport {\n  Point, Line, quadBezierPoints,\n} from '../../../tools/g2';\nimport Symbol from './SymbolNew';\n// import Bounds from '../Elements/Bounds';\n\nexport default class Sum extends Symbol {\n  // eslint-disable-next-line class-methods-use-this\n  // getTriangles() {\n  //   return 'strip';\n  // }\n\n  // // eslint-disable-next-line class-methods-use-this\n  // getWidth() {\n  //   return (type: 'static' | 'dynamic', options: Object, height: number) => {\n  //     const { width } = options;\n  //     if (type === 'static') {\n  //       return height * width;\n  //     }\n  //     return width;\n  //   };\n  // }\n\n  // eslint-disable-next-line class-methods-use-this\n  // getWidth() {\n  //   return (options: Object, height: number) => {\n  //     let width;\n  //     if (options.draw === 'static') {\n  //       let { staticHeight } = options;\n  //       if (typeof staticHeight !== 'number') {\n  //         staticHeight = height;\n  //       }\n  //       ({ width } = this.getDefaultValues(staticHeight, null, options));\n  //       return width / staticHeight * height;\n  //     }\n  //     ({ width } = options);\n  //     ({ width } = this.getDefaultValues(height, width, options));\n  //     return width;\n  //   };\n  // }\n\n\n  //                   8                                    10\n  //          ---------- 00000000000000000000000000000000000_______________\n  //          A            0000000 9         \\      11 000000           *\n  //          |              0000000          \\           000           *\n  //          |                0000000         thick2       00  12     *\n  //          |                  0000000  D             13    \\       * tipAngle\n  //          |                    0000000                     \\    *\n  //          |                  B   0000000       thick1        \\*\n  //          |                        0000000    /\n  //          |                          0000000 /\n  //          |                            0000000\n  //          |                              0000000\n  //          |                                000000  -- 7\n  //          |      -------------------------6  000\n  //          |      A                         00|0\n  //       h  |      |                       0000|\n  //          |      |                     0000  |\\\n  //          |      |                   0000    | \\\n  //          |      | e               0000      |  thick2\n  //          |      |               0000  C     |\n  //          |      |         A   0000          |             0\n  //          |      |           0000            |         1   |____\n  //          |      |         0000       thick3 |           00    A\n  //          |      |       0000        /       |      3  000|    |\n  //          |      |     0000  5      /        |      000000|    |  c\n  //          V      V   000000000000000000000000|00000000000 |    |\n  //          --------  0000000000000000000000000|0000000000__|____V\n  //                 4 |                         |        2|  |\n  //                   |                         |         |  |\n  //                   |                         |         |  |\n  //                   |<----------------------->|         |  |\n  //                   |           a                       |  |\n  //                   |                                   |  |\n  //                   |                                   |  |  b\n  //                   |                              ---->|  |<---\n  //                   |                                      |\n  //                   |                                      |\n  //                   |                  w                   |\n  //                   |<------------------------------------>|\n  //\n\n  // Linewidths that look good:\n  // height = 0.2, linewWidth = width / 20\n  // height = 0.6, linewWidth = width / 30\n  // height = 1, linewWidth = width / 40\n  // height = 1.4, linewWidth = width / 50\n  // height = 1.8, linewWidth = width / 60\n  // Therefore default lineWidth =  width / (25 * height + 15)\n  // eslint-disable-next-line class-methods-use-this\n  getPoints(options: Object, widthIn: number, height: number) {\n    const { sides } = options;\n    // let lineWidthToUse = lineWidth;\n    const { lineWidth, width } = this.getDefaultValues(height, widthIn, options);\n    // if (lineWidth == null) {\n    //   lineWidthToUse = width / (25 * height + 15);\n    // }\n    const bottomTipAngle = Math.PI / 2 * 0.9;\n    const topTipAngle = Math.PI / 2 * 0.95;\n    const a = 0.431 * width;\n    const e = height / 2 - lineWidth;\n    const cBottom = 0.176 * height;\n    const cTop = 0.153 * height;\n    const bBottom = cBottom / Math.tan(bottomTipAngle);\n    const bTop = cTop / Math.tan(topTipAngle);\n\n    const thick2 = lineWidth;\n    const thick3 = lineWidth * 2;\n    const thick1 = lineWidth * 3;\n    const tipWidth = lineWidth * 0.6;\n\n    const lineA = new Line(new Point(0, 0), new Point(a, e));\n    const CxOffset = thick2 / Math.sin(lineA.ang);\n    const lineC = new Line(new Point(CxOffset, 0), height, lineA.ang);\n    const lineB = new Line(new Point(0, height), new Point(a, e));\n    const DxOffset = -thick1 / Math.sin(lineB.ang);\n    const lineD = new Line(new Point(DxOffset, height), height, lineB.ang);\n\n    const intersection = lineC.intersectsWith(lineD).intersect;\n\n    const p0 = new Point(width, cBottom);\n    const p1 = new Point(width - tipWidth, cBottom);\n    const p2 = new Point(width - bBottom, 0);\n    const p3 = new Point(\n      p1.x - (cBottom - thick3) / Math.tan(bottomTipAngle), thick3,\n    );\n    const p4 = new Point(0, 0);\n    const p5 = new Point(thick2 / Math.sin(lineA.ang) + thick3 / Math.tan(lineA.ang), thick3);\n    const p6 = new Point(a, e);\n    const p7 = intersection;\n    const p8 = new Point(0, height);\n    const p9 = new Point(\n      -thick1 / Math.sin(lineB.ang) - thick2 / Math.tan(lineB.ang),\n      height - thick2,\n    );\n    const p10 = new Point(width - bTop, height);\n    const p12 = new Point(width, height - cTop);\n    const p13 = new Point(width - tipWidth, height - cTop);\n    const p11 = new Point(\n      p13.x - (cTop - thick2) / Math.tan(topTipAngle),\n      height - thick2,\n    );\n\n    const p30 = p1;\n    const p31 = p3;\n    const p32 = new Point(p31.x - (cBottom - thick3), thick3);\n    const bottomCurve = quadBezierPoints(p30, p31, p32, sides);\n    const bottomCurvePairs = [];\n    bottomCurve.forEach((p) => {\n      bottomCurvePairs.push(p2);\n      bottomCurvePairs.push(p);\n    });\n\n    const p111 = p11;\n    const p110 = new Point(p111.x - cTop + thick2, height - thick2);\n    const p112 = p13;\n    const topCurve = quadBezierPoints(p110, p111, p112, sides);\n    const topCurvePairs = [];\n    topCurve.forEach((p) => {\n      topCurvePairs.push(p10);\n      topCurvePairs.push(p);\n    });\n    const points = [\n      p0,\n      p1,\n      ...bottomCurvePairs,\n      p4,\n      p5,\n      p6,\n      p7,\n      p8,\n      p9,\n      ...topCurvePairs,\n      p12,\n      p13,\n    ];\n    return [points, width, height, 'strip'];\n  }\n\n  /* eslint-disable class-methods-use-this */\n  // $FlowFixMe\n  getDefaultValues(height: number, width: ?number, options: {\n      lineWidth?: number,\n      width?: number,\n    }) {\n    const out = {\n      lineWidth: height * 0.88 / (25 * height + 15),\n      width: height * 0.88,\n      height,\n    };\n    if (options.lineWidth != null) {\n      out.lineWidth = options.lineWidth;\n    }\n    if (options.width != null) {\n      out.width = options.width;\n    }\n    return out;\n  }\n\n  // getBounds(options: Object,\n  //   leftIn: number,\n  //   bottomIn: number,\n  //   widthIn: number,\n  //   heightIn: number,\n  // ) {\n  //   const { width, height } = this.getDefaultValues(\n  //     heightIn, widthIn, options,\n  //   );\n  //   const bounds = new Bounds();\n  //   bounds.left = leftIn - width;\n  //   bounds.bottom = bottomIn;\n  //   bounds.width = width;\n  //   bounds.right = bounds.left + width;\n  //   bounds.ascent = height;\n  //   bounds.descent = 0;\n  //   bounds.height = height;\n  //   bounds.top = bounds.bottom + bounds.height;\n  //   return bounds;\n  // }\n}\n","// @flow\nimport { FigureElementPrimitive } from '../../Element';\nimport {\n  Point, Transform, Rect, getBoundingBorder, getBorder,\n} from '../../../tools/g2';\nimport {\n  duplicate,\n} from '../../../tools/tools';\n// import VertexSymbol from './VertexSymbol';\nimport VertexGeneric from '../../DrawingObjects/VertexObject/VertexGeneric';\nimport WebGLInstance from '../../webgl/webgl';\nimport Bounds from '../Elements/Bounds';\nimport type {\n  TypeColor,\n} from '../../../tools/types';\n\n\nexport default class Symbol extends FigureElementPrimitive {\n  constructor(\n    webgl: Array<WebGLInstance>,\n    color: TypeColor,\n    transformOrLocation: Transform | Point,\n    figureLimits: Rect,\n    symbolOptions: Object,\n    // triangles: 'strip' | 'triangles' | 'fan',\n  ) {\n    const vertexObject = new VertexGeneric(webgl);\n\n    let initialT;\n    if (transformOrLocation instanceof Transform) {\n      initialT = transformOrLocation;\n    } else {\n      initialT = new Transform('Symbol').scale(1, 1).translate(0, 0);\n    }\n    super(vertexObject, initialT, color, figureLimits);\n    if (symbolOptions.touchBorder != null) {\n      this.touchBorder = symbolOptions.touchBorder;\n    }\n    if (symbolOptions.border != null) {\n      this.border = symbolOptions.border;\n    }\n    if (symbolOptions.onClick != null) {\n      this.onClick = symbolOptions.onClick;\n    }\n    if (symbolOptions.isTouchable != null) {\n      this.isTouchable = symbolOptions.isTouchable;\n    }\n    this.custom.options = symbolOptions;\n    if (this.custom.options.draw === 'dynamic') {\n      this.custom.scale = new Point(1, 1);\n      this.internalSetTransformCallback = () => {\n        const s = this.getScale();\n        if (this.custom.scale.isNotEqualTo(s, 8)) {\n          const [\n            pointsNew, widthNew, heightNew, drawType,\n          ] = this.getPoints(this.custom.options, s.x, s.y);\n          this.pointsDefinition = {\n            points: duplicate(pointsNew),\n            width: widthNew,\n            height: heightNew,\n            drawType,\n          };\n          // $FlowFixMe\n          // this.drawingObject.change(pointsNew);\n          // this.drawBorder = [\n          //   new Point(0, 0),\n          //   new Point(widthNew, 0),\n          //   new Point(widthNew, heightNew),\n          //   new Point(0, heightNew),\n          // ];\n          this.updateSymbol(pointsNew, widthNew, heightNew, drawType);\n          // this.drawingObject.updatePoints(\n          //   pointsNew,\n          //   widthNew,\n          //   heightNew,\n          // );\n          this.custom.scale = s;\n        }\n      };\n    }\n\n    // eslint-disable-next-line max-len\n    this.custom.setSize = (location: Point, widthIn: number, heightIn: number) => {\n      const t = this.transform._dup();\n      if (\n        this.custom.options.draw === 'static'\n        // && this.drawingObject.points.length === 0\n      ) {\n        let points = [];\n        let width = 0;\n        let height = 0;\n        let drawType = 'strip';\n        if (\n          this.custom.options.staticHeight === 'first'\n          || this.custom.options.staticWidth === 'first'\n        ) {\n          ([points, width, height, drawType] = this.getPoints(symbolOptions, widthIn, heightIn));\n        } else if (this.custom.options.staticHeight != null\n          || this.custom.options.staticWidth != null) {\n          ([points, width, height, drawType] = this.getPoints(\n            symbolOptions,\n            this.custom.options.staticWidth,\n            this.custom.options.staticHeight,\n          ));\n        }\n        this.pointsDefinition = {\n          points: duplicate(points),\n          width,\n          height,\n          drawType,\n        };\n        // $FlowFixMe\n        // this.drawingObject.updatePoints(points, width, height);\n        this.updateSymbol(points, width, height, drawType);\n        this.custom.options.staticHeight = height;\n        this.custom.options.staticWidth = width;\n        // console.log('a', width, height)\n        t.updateScale(width, height);\n      } else {\n        const [\n          pointsNew, widthNew, heightNew, drawType,\n        ] = this.getPoints(this.custom.options, widthIn, heightIn);\n        this.pointsDefinition = {\n          points: duplicate(pointsNew),\n          width: widthNew,\n          height: heightNew,\n          drawType,\n        };\n        // $FlowFixMe\n        this.updateSymbol(pointsNew, widthNew, heightNew, drawType);\n        // this.drawingObject.updatePoints(\n        //   pointsNew,\n        //   widthNew,\n        //   heightNew,\n        // );\n        this.custom.scale = new Point(widthIn, heightIn);\n        // console.log('b', widthIn, heightIn, this.getPath())\n        t.updateScale(widthIn, heightIn);\n      }\n      t.updateTranslation(location.x, location.y);\n      this.setTransform(t);\n    };\n\n    this.setPointsFromDefinition = () => {\n      if (Object.keys(this.pointsDefinition).length === 0) {\n        return;\n      }\n      const {\n        points, width, height, drawType,\n      } = this.pointsDefinition;\n      // $FlowFixMe\n      this.updateSymbol(points, width, height, drawType);\n      // this.drawingObject.updatePoints(points, width, height);\n      // // if (width == null || height == null || location == null) {\n      // //   return;\n      // // }\n      // this.custom.setSize(this.getPosition(), width, height);\n    };\n  }\n\n  updateSymbol(\n    pointsIn: Array<Point>,\n    width: number,\n    height: number,\n    drawType: 'strip' | 'triangles' | 'fan',\n  ) {\n    this.drawingObject.change({ points: pointsIn, drawType });\n    this.drawBorder = [[\n      new Point(0, 0),\n      new Point(width, 0),\n      new Point(width, height),\n      new Point(0, height),\n    ]];\n    if (\n      typeof this.custom.options.drawBorderBuffer === 'number'\n      || (\n        Array.isArray(this.custom.options.drawBorderBuffer)\n        && typeof this.custom.options.drawBorderBuffer[0] === 'number'\n      )\n    ) {\n      this.drawBorderBuffer = [getBoundingBorder( // $FlowFixMe\n        this.drawBorder, this.custom.options.drawBorderBuffer,\n      )];\n    } else if (Array.isArray(this.custom.options.drawBorderBuffer)) {\n      // $FlowFixMe\n      this.drawBorderBuffer = getBorder(this.custom.options.drawBorderBuffer);\n    } else {\n      this.drawBorderBuffer = this.drawBorder;\n    }\n  }\n\n  // // eslint-disable-next-line class-methods-use-this, no-unused-vars\n  // updatePoints(points: Array<Point>, width: Number, height: number) {\n  // }\n\n  getTransform() {\n    if (this.custom.options.draw === 'static') {\n      const t = this.transform._dup();\n      const s = t.s();\n      if (s != null) {\n        t.updateScale(\n          s.x / this.custom.options.staticWidth,\n          s.y / this.custom.options.staticHeight,\n        );\n      }\n      return t;\n    }\n    const t = this.transform._dup();\n    t.updateScale(1, 1);\n    return t;\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  getWidth(options: Object, height: number) {\n    let width;\n    if (options.draw === 'static') {\n      let { staticHeight } = options;\n      const { staticWidth } = options;\n      if (staticHeight === 'first') {\n        staticHeight = height;\n      }\n      ({ width } = this.getDefaultValues(staticHeight, staticWidth, options));\n      if (width == null) {\n        width = height;\n      }\n      return width / staticHeight * height;\n    }\n    ({ width } = options);\n    ({ width } = this.getDefaultValues(height, width, options));\n    return width;\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  getHeight(options: Object, width: number) {\n    let height;\n    if (options.draw === 'static') {\n      let { staticWidth } = options;\n      const { staticHeight } = options;\n      if (staticWidth === 'first') {\n        staticWidth = width;\n      } // ????\n      ({ height } = this.getDefaultValues(staticHeight, staticWidth, options));\n      if (height == null) {\n        height = width;\n      }\n      return height / staticWidth * width;\n    }\n    ({ height } = options);\n    ({ height } = this.getDefaultValues(height, width, options));\n    return height;\n  }\n\n  getBounds(\n    options: Object,\n    contentX: number,\n    contentY: number,\n    contentWidth: number,\n    contentHeight: number,\n    side?: 'left' | 'right' | 'bottom' | 'top',\n  ) {\n    // const contentWidth = contentWidthIn == null ? 0 : contentWidthIn;\n    // const contentHeight = contentHeightIn == null ? 0 : contentHeightIn;\n    const { width, height } = this.getDefaultValues(\n      contentHeight, contentWidth, options,\n    );\n    const bounds = new Bounds();\n    if (side === 'left') {\n      bounds.left = contentX - width;\n      bounds.bottom = contentY;\n      bounds.top = bounds.bottom + height;\n      bounds.right = bounds.left + width;\n    } else if (side === 'right') {\n      bounds.left = contentX;\n      bounds.bottom = contentY;\n      bounds.top = bounds.bottom + height;\n      bounds.right = bounds.left + width;\n    } else if (side === 'top') {\n      bounds.bottom = contentY;\n      bounds.top = contentY + height;\n      bounds.left = contentX + contentWidth / 2 - width / 2;\n      bounds.right = bounds.left + width;\n    } else {\n      bounds.top = contentY;\n      bounds.bottom = contentY - height;\n      bounds.left = contentX + contentWidth / 2 - width / 2;\n      bounds.right = bounds.left + width;\n    }\n    bounds.width = width;\n    bounds.height = height;\n    bounds.ascent = height;\n    bounds.descent = 0;\n    return bounds;\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  getPoints(options: Object, width: number, height: number) {\n    const points = [\n      new Point(0, 0),\n      new Point(width, 0),\n      new Point(width, height),\n      new Point(0, height),\n    ];\n\n    return [points, width, height, 'strip'];\n  }\n\n  // eslint-disable-next-line class-methods-use-this, no-unused-vars\n  getDefaultValues(height: number, width: number, options: Object) {\n    // const out: {\n    //   height?: number,\n    //   width?: number,\n    //   lineWidth?: number,\n    //   tipWidth?: number,\n    //   arrowWidth?: number,\n    //   arrowHeight?: number,\n    // } = {};\n    // return out;\n    return {};\n  }\n}\n","// @flow\nimport { FigureElementPrimitive } from '../../Element';\nimport {\n  Point,\n} from '../../../tools/g2';\nimport Symbol from './SymbolNew';\n// import WebGLInstance from '../../../webgl/webgl';\n\n\nexport default class Bracket extends Symbol {\n  symbol: FigureElementPrimitive;\n\n  // eslint-disable-next-line class-methods-use-this\n  // getTriangles() {\n  //   return 'strip';\n  // }\n\n  //                             width\n  //          |<---------------------------------------->|\n  //          |                                          |  3\n  //        1 |                                          | ____\n  //          00000000000000000000000000000000000000000000   A\n  //          00000000000000000000000000000000000000000000   |  Line Width\n  //          00000000000000000000000000000000000000000000 __V_\n  //         0                                            2\n  //\n\n  // eslint-disable-next-line class-methods-use-this\n  getPoints(options: Object, widthIn: number, heightIn: number) {\n    const { lineWidth, width, height } = this.getDefaultValues(\n      heightIn, widthIn, options,\n    );\n\n    const points = [\n      new Point(0, 0),\n      new Point(0, lineWidth),\n      new Point(width, 0),\n      new Point(width, lineWidth),\n    ];\n    return [points, width, height, 'strip'];\n  }\n\n  /* eslint-disable class-methods-use-this */\n  // $FlowFixMe\n  getDefaultValues(height: number, width: ?number, options: {\n      lineWidth?: number,\n    }) {\n    const out = {};\n    if (options.lineWidth != null) {\n      out.lineWidth = options.lineWidth;\n    } else {\n      out.lineWidth = 0.01;\n    }\n    out.height = out.lineWidth;\n    if (width != null) {\n      out.width = width;\n    } else {\n      out.width = 1;\n    }\n    return out;\n  }\n}\n","// @flow\nimport WebGLInstance from './webgl/webgl';\n// import getShaders from './webgl/shaders';\n\nimport {\n  Rect, Point, Transform, getRect,\n  spaceToSpaceTransform, minAngleDiff, getTransform,\n  getPoint,\n} from '../tools/g2';\nimport type { TypeParsableRect, TypeParsablePoint } from '../tools/g2';\n// import * as math from '../tools/math';\n// import { round } from '../tools/math';\nimport { FunctionMap } from '../tools/FunctionMap';\nimport { setState, getState } from './Recorder/state';\nimport parseState from './Recorder/parseState';\nimport { isTouchDevice, joinObjects, SubscriptionManager } from '../tools/tools';\nimport {\n  FigureElementCollection, FigureElementPrimitive, FigureElement,\n} from './Element';\nimport type {\n  OBJ_AddElement, TypeElementPath,\n} from './Element';\nimport GlobalAnimation from './webgl/GlobalAnimation';\nimport { Recorder } from './Recorder/Recorder';\n// eslint-disable-next-line import/no-cycle\nimport Gesture from './Gesture';\nimport DrawContext2D from './DrawContext2D';\nimport FigurePrimitives from './FigurePrimitives/FigurePrimitives';\nimport type { OBJ_Polyline } from './FigurePrimitives/FigurePrimitives';\n// import FigureEquation from './Equation/FigureEquation';\nimport FigureCollections from './FigureCollections/FigureCollections';\n// import addElements from './FigureAddElements/addElements';\n// import type { TypeAddElementObject } from './FigureAddElements/addElements';\nimport type { OBJ_ScenarioVelocity } from './Animation/AnimationStep/ElementAnimationStep/ScenarioAnimationStep';\nimport type { TypeColor, OBJ_Font } from '../tools/types';\nimport SlideNavigator from './SlideNavigator';\nimport type { OBJ_SlideNavigator } from './SlideNavigator';\n\n/**\n * Space Transforms\n *\n * @property {Transform} glToFigure\n * @property {Transform} figureToGL\n * @property {Transform} pixelToFigure\n * @property {Transform} figureToPixel\n * @property {Transform} pixelToGL\n * @property {Transform} glToPixel\n * @property {Transform} figureToCSSPercent\n */\nexport type OBJ_SpaceTransforms = {\n  glToFigure: Transform;\n  figureToGL: Transform;\n  pixelToFigure: Transform;\n  figureToPixel: Transform;\n  pixelToGL: Transform;\n  glToPixel: Transform;\n  figureToCSSPercent: Transform;\n}\n\n\nexport type OBJ_FigureForElement = {\n  limits: Rect,\n  spaceTransforms: OBJ_SpaceTransforms,\n  animateNextFrame: () => void,\n  animationFinished: () => void,\n  recorder: Recorder,\n}\n\n/**\n  * Figure options object\n  * @property {string} [htmlId] HTML `div` tag `id` to tie figure to (`\"figureOneContainer\"`)\n  * @property {TypeParsableRect} [limits] - limits (bottom left\n  *  corner at (-1, -1), width 2, height 2)\n  * @property {TypeColor} [color] default color (`[0, 0, 0, 1]`)\n  * @property {OBJ_Font} [font] default font (`{ family: 'Helvetica,\n  * size: 0.2, style: 'normal', weight: 'normal' }`)\n  * @property {number} [lineWidth] default line width\n  * @property {number} [length] default length to use for shapes\n */\nexport type OBJ_Figure = {\n  htmlId?: string,\n  limits?: TypeParsableRect,\n  color?: TypeColor,\n  font?: OBJ_Font,\n  lineWidth?: number,\n  length?: number,\n};\n\n\n// There are several coordinate spaces that need to be considered for a\n// figure.\n//\n// In the simplest figure, there will be in hierarchy:\n//  - GL Canvas\n//    - Figure\n//      - Element Collection\n//        - Element Primitive\n//          - Drawing Object (e.g. shape, text) from primative vertices\n//\n// A shape is defined in Drawing Object space.\n// It is then transformed by the element primative\n// It is then transformed by the element colleciton\n// It is then transformed by the figure\n// it is then transformed into GL Space\n//\n// Figure elements can also be rendered to an image in a HTML 2D canvas\n// element. To do so, pass in:\n//    - Figure Element (primative or collection) to render\n//    - HTML element (which is a 2D canvas)\n//    - Window of figure to render\n//    - Window scaling (how does the window fit within the HTML Element)\n//      - fit: figure units will be scaled so that figure window limits\n//             aspect ratio fits within the element aspect ratio\n//      - 1em: figure units will be scaled so 0.2 figure units (default font\n//             size) looks like 1em of the html element font size in pixels\n//      - 10px: figure units will be scaled so that the max figure window\n//              limit will be the pixel count\n//      - strech: figure units will be scaled so that the figure window\n//                limits will be stretched to fit the html element width\n//                and height\n// Then the process is:\n//    - html element size in pixels and aspect ratio found\n//    - html element size in gl coordinates found\n\n//  /**\n//   * @typedef FigureOptions\n//   * @type {object}\n//   * @property {string} [htmlId = 'figureOneContainer'] - div id of figure container.\n//   * @property {Rect} [limits = Rect(-1, -1, 2, 2)] - limits of figure.\n//   */\n\n/**\n * Primary Figure class.\n *\n * A figure will attach a WebGL canvas and Context2D\n * canvas to the html `div` element with id `\"figureOneContainer\"`.\n *\n * The figure manages all drawing elements, renders the drawing elements\n * on a browser's animation frames and listens for guestures from the user.\n *\n * The figure also has a recorder, allowing to record and playback states,\n * and gestures - though this is not yet documented.\n *\n * To attach to a different `div`, use the `htmlId` property in the class\n * constructor.\n *\n * If a figure is paused, then all drawing element animations will\n * also be paused.\n *\n * `Figure` has a number of convenience methods for create drawing elements\n * already attached to the drawing canvases, and useful transforms for\n * converting between the different spaces (e.g. pixel, GL, figure).\n *\n * @class\n * @param {OBJ_Figure} options\n * @property {FigurePrimitives} primitives create figure primitives such\n * as shapes, lines and grids\n * @property {FigureCollections} collections create figure collections such\n * as advanced lines, shapes, equations and plots\n *\n * @example\n * // Simple html and javascript example to create a figure, and add a\n * // hexagon.\n * //\n * // For additional examples, see https://github.com/airladon/FigureOne\n * //\n * // Two files `index.html` and `index.js` in the same directory\n *\n * // index.html\n * <!doctype html>\n * <html>\n * <body>\n *     <div id=\"figureOneContainer\" style=\"width: 800px; height: 800px; background-color: white;\">\n *     </div>\n *     <script type=\"text/javascript\" src='https://cdn.jsdelivr.net/npm figureone@0.3.12/figureone.min.js'></script>\n *     <script type=\"text/javascript\" src='./index.js'></script>\n * </body>\n * </html>\n *\n * // index.js\n * const figure = new Fig.Figure({ limits: [-1, -1, 2, 2 ]});\n * figure.add(\n *   {\n *     name: 'p',\n *     method: 'polygon',\n *     options: {\n *       radius: 0.5,\n *       sides: 6,\n *     },\n *   },\n * );\n * figure.initialize();\n *\n * @example\n * // Alternately, an element can be added programatically\n * // index.js\n * const figure = new Fig.Figure({ limits: [-1, -1, 2, 2 ]});\n * const hex = figure.shapes.polygon({\n *   radius: 0.5,\n *   sides: 6,\n * });\n * figure.add('hexagon', hex);\n */\nclass Figure {\n  htmlId: string;\n  canvasLow: HTMLCanvasElement;\n  canvasOffscreen: HTMLCanvasElement;\n  // canvasHigh: HTMLCanvasElement;\n  textCanvasLow: HTMLCanvasElement;\n  textCanvasOffscreen: HTMLCanvasElement;\n  container: HTMLElement;\n  // textCanvasHigh: HTMLCanvasElement;\n  draw2DLow: DrawContext2D;\n  draw2DOffscreen: DrawContext2D;\n  // draw2DHigh: DrawContext2D;\n  htmlCanvas: HTMLElement;\n  webglLow: WebGLInstance;\n  webglOffscreen: WebGLInstance;\n  // webglHigh: WebGLInstance;\n  gestureCanvas: HTMLElement;\n\n  elements: FigureElementCollection;\n  globalAnimation: GlobalAnimation;\n  recorder: Recorder;\n  gesture: Gesture;\n  inTransition: boolean;\n  beingMovedElements: Array<FigureElement>;\n\n  beingTouchedElements: Array<FigureElement>;\n\n  touchTopElementOnly: boolean;\n  previousCursorPoint: Point;\n\n  limits: Rect;\n  stateTime: DOMHighResTimeStamp;\n\n  // gestureElement: HTMLElement;\n  shapes: FigurePrimitives;\n  shapesLow: Object;\n\n  primitives: FigurePrimitives;\n  // shapesHigh: Object;\n  // equation: Object;\n  // equationLow: Object;\n  // equationHigh: Object;\n\n  collections: FigureCollections;\n  collectionsLow: FigureCollections;\n  // objectsHigh: FigureCollections;\n\n  backgroundColor: Array<number>;\n  fontScale: number;\n  // layout: Object;\n\n  /**\n   * Useful transforms between spaces at the figure level and above.\n   * @property {OBJ_SpaceTransforms} spaceTransforms\n   */\n  spaceTransforms: OBJ_SpaceTransforms;\n\n  // oldScrollY: number;\n  lastDrawTime: number;\n  drawQueued: boolean;\n  waitForFrames: number;\n  scrolled: boolean;\n  scrollingFast: boolean;\n  scrollTimeoutId: ?TimeoutID;\n  drawTimeoutId: ?TimeoutID;\n  oldScroll: number;\n  fromWhere: string;      // used for drawing debug only\n  oldWidth: number;\n\n  drawAnimationFrames: number;\n  defaultColor: Array<number>;\n  defaultDimColor: Array<number>;\n  defaultFont: OBJ_Font;\n  defaultLineWidth: number;\n  defaultLength: number;\n\n  animationFinishedCallback: ?(string | (() => void));\n  // updateFontSize: string;\n\n  isTouchDevice: boolean;\n  fnMap: FunctionMap;\n\n  isPaused: boolean;\n  pauseTime: number;\n  cursorShown: boolean;\n  cursorElementName: string;\n  isTouchDown: boolean;\n  setStateCallback: ?(string | (() => void));\n  subscriptions: SubscriptionManager;\n  mockPreviousTouchPoint: Point;\n\n  state: {\n    pause: 'paused' | 'preparingToPause' | 'preparingToUnpause' | 'unpaused';\n    preparingToStop: boolean;\n    preparingToSetState: boolean;\n  };\n  // pauseAfterNextDrawFlag: boolean;\n\n  constructor(options: OBJ_Figure = {}) {\n    const defaultOptions = {\n      htmlId: 'figureOneContainer',\n      limits: new Rect(-1, -1, 2, 2),\n      fontScale: 1,\n      color: [0, 0, 0, 1],\n      dimColor: [0.5, 0.5, 0.5, 1],\n      font: {\n        family: 'Helvetica',\n        size: 0.2,\n        style: 'normal',\n        weight: '100',\n        opacity: 1,\n      },\n    };\n    this.fnMap = new FunctionMap();\n    this.isPaused = false;\n    this.scrolled = false;\n    this.cursorElementName = 'cursor';\n    this.setStateCallback = null;\n    this.mockPreviousTouchPoint = new Point(0, 0);\n    // this.oldScrollY = 0;\n    const optionsToUse = joinObjects({}, defaultOptions, options);\n    const {\n      htmlId, limits,\n    } = optionsToUse;\n    this.defaultColor = optionsToUse.color;\n    // this.defaultLineWidth = optionsToUse.lineWidth;\n    if (optionsToUse.font.color == null) {\n      optionsToUse.font.color = this.defaultColor.slice();\n    }\n    this.defaultDimColor = optionsToUse.dimColor;\n    this.defaultFont = optionsToUse.font;\n    this.htmlId = htmlId;\n    this.animationFinishedCallback = null;\n    // this.layout = layout;\n    if (typeof htmlId === 'string') {\n      const container = document.getElementById(htmlId);\n      if (container instanceof HTMLElement) {\n        this.container = container;\n        const { children } = container;\n        for (let i = 0; i < children.length; i += 1) {\n          const child = children[i];\n          if (child instanceof HTMLCanvasElement\n            && child.classList.contains('figureone__gl')) {\n            this.canvasLow = child;\n          }\n          if (child instanceof HTMLCanvasElement\n            && child.classList.contains('figureone__gl__offscreen')) {\n            this.canvasOffscreen = child;\n          }\n          if (child instanceof HTMLCanvasElement\n            && child.classList.contains('figureone__text')) {\n            this.textCanvasLow = child;\n          }\n          if (child instanceof HTMLCanvasElement\n            && child.classList.contains('figureone__text__offscreen')) {\n            this.textCanvasOffscreen = child;\n          }\n          if (child.classList.contains('figureone__html')\n          ) {\n            this.htmlCanvas = child;\n          }\n        }\n        if (this.canvasLow == null) {\n          this.canvasLow = document.createElement('canvas');\n          this.canvasLow.classList.add('figureone__gl', 'figureone__canvas');\n          container.appendChild(this.canvasLow);\n        }\n        if (this.textCanvasLow == null) {\n          this.textCanvasLow = document.createElement('canvas');\n          this.textCanvasLow.classList.add('figureone__text', 'figureone__canvas');\n          container.appendChild(this.textCanvasLow);\n        }\n        if (this.htmlCanvas == null) {\n          this.htmlCanvas = document.createElement('div');\n          this.htmlCanvas.classList.add('figureone__html', 'figureone__canvas');\n          container.appendChild(this.htmlCanvas);\n        }\n\n        const canvasStyle = document.createElement('style');\n        canvasStyle.type = 'text/css';\n        container.classList.add('figureone__container');\n        canvasStyle.innerHTML = `\n          .figureone__container {\n            position: relative;\n            pointer-events: none;\n          }\n          .figureone__canvas {\n            width: 100%;\n            height: 100%;\n            position: absolute;\n          }\n          .figureone__html {\n            pointer-events: auto;\n          }\n        `;\n        document.getElementsByTagName('head')[0].appendChild(canvasStyle);\n\n        this.backgroundColor = [1, 1, 1, 1];\n        const webglLow = new WebGLInstance(\n          this.canvasLow,\n          this.backgroundColor,\n        );\n        this.webglLow = webglLow;\n        if (this.canvasOffscreen) {\n          const webglOffscreen = new WebGLInstance(\n            this.canvasOffscreen,\n            this.backgroundColor,\n          );\n          this.webglOffscreen = webglOffscreen;\n        }\n        this.draw2DLow = new DrawContext2D(this.textCanvasLow);\n        if (this.textCanvasOffscreen) {\n          const draw2DOffscreen = new DrawContext2D(this.textCanvasOffscreen);\n          this.draw2DOffscreen = draw2DOffscreen;\n        }\n        // this.draw2DHigh = new DrawContext2D(this.textCanvasHigh);\n      }\n    }\n\n    if (optionsToUse.gestureCanvas != null) {\n      const gestureCanvas = document.getElementById(optionsToUse.gestureCanvas);\n      if (gestureCanvas != null) {\n        this.gestureCanvas = gestureCanvas;\n      }\n    }\n    if (this.gestureCanvas == null) {\n      this.gestureCanvas = this.htmlCanvas;\n    }\n\n    if (this instanceof Figure) {  // $FlowFixMe\n      this.gesture = new Gesture(this);\n    }\n\n    this.previousCursorPoint = new Point(0, 0);\n    this.isTouchDown = false;\n    // this.pauseAfterNextDrawFlag = false;\n    this.fontScale = optionsToUse.fontScale;\n    // console.log(this.canvasLow.getClientBoundingRect())\n    this.updateLimits(limits);\n    this.setDefaultLineWidth(options.lineWidth || null);\n    this.setDefaultLength(options.length || null);\n    this.drawQueued = false;\n    this.lastDrawTime = 0;\n    this.inTransition = false;\n    this.beingMovedElements = [];\n    this.beingTouchedElements = [];\n    this.touchTopElementOnly = true;\n    this.globalAnimation = new GlobalAnimation();\n    this.subscriptions = new SubscriptionManager(this.fnMap);\n    this.recorder = new Recorder();\n    this.recorder.figure = this;\n    this.bindRecorder();\n    this.pauseTime = this.globalAnimation.now() / 1000;\n    this.shapesLow = this.getShapes();\n    // this.shapesHigh = this.getShapes(true);\n    this.shapes = this.shapesLow;\n    this.primitives = this.shapes;\n    // this.equationLow = this.getEquations();\n    // this.equationHigh = this.getEquations(true);\n    // this.equation = this.equationLow;\n    this.collectionsLow = this.getObjects();\n    // this.collectionsHigh = this.getObjects(true);\n    this.collections = this.collectionsLow;\n    this.createFigureElements();\n    if (this.elements.name === '') {\n      this.elements.name = 'figureRoot';\n    }\n    this.state = {\n      pause: 'unpaused',\n      preparingToStop: false,\n      preparingToSetState: false,\n    };\n    this.stateTime = this.globalAnimation.now() / 1000;\n\n    // this.updateFontSize = optionsToUse.updateFontSize;\n\n    window.addEventListener('resize', this.resize.bind(this));\n    this.sizeHtmlText();\n    this.isTouchDevice = isTouchDevice();\n    this.animateNextFrame(true, 'first frame');\n    if (optionsToUse.elements) {\n      // eslint-disable-next-line new-cap\n      this.elements = new optionsToUse.elements(this);\n      this.elements.figureLimits = this.limits;\n      this.initElements();\n    }\n    this.waitForFrames = 0;\n    this.scrollingFast = false;\n    this.scrollTimeoutId = null;\n    this.drawTimeoutId = null;\n    this.oldScroll = window.pageYOffset;\n    this.drawAnimationFrames = 0;\n    this.cursorShown = false;\n    // /**\n    //  * Create built in {@link FigureElement}s\n    //  * @property {function(OBJ_Polygon): FigureElementPrimitive} polygon\n    //  */\n    // deprecate\n    // $FlowFixMe\n    // this.create = {\n    //   collection: this.collections.collection.bind(this.shapes),\n    //   generic: this.shapes.generic.bind(this.shapes),\n    //   polyline: this.shapes.polyline.bind(this.shapes),\n    //   polygon: this.shapes.polygon.bind(this.shapes),\n    //   grid: this.shapes.grid.bind(this.shapes),\n    //   triangle: this.shapes.triangle.bind(this.shapes),\n    //   rectangle: this.shapes.rectangle.bind(this.shapes),\n    //   // radialLines: this.shapes.radialLines.bind(this.shapes),\n    //   text: this.shapes.text.bind(this.shapes),\n    //   textLine: this.shapes.textLine.bind(this.shapes),\n    //   textLines: this.shapes.textLines.bind(this.shapes),\n    //   // arrow: this.shapes.arrow.bind(this.shapes),\n    //   html: this.shapes.html.bind(this.shapes),\n    //   // htmlImage: this.shapes.htmlImage.bind(this.shapes),\n    //   // htmlText: this.shapes.htmlText.bind(this.shapes),\n    //   line: this.collections.line.bind(this.collections),\n    //   angle: this.collections.angle.bind(this.collections),\n    //   smartPolyLine: this.collections.polyline.bind(this.collections),\n    //   equation: this.equation.equation.bind(this.equation),\n    // };\n  }\n\n  slideNavigator(options: OBJ_SlideNavigator) {\n    return new SlideNavigator(joinObjects({}, { collection: this.elements }, options));\n  }\n\n  bindRecorder() {\n    // this.recorder.figure = {\n    //   animateNextFrame: this.animateNextFrame.bind(this),\n    //   setState: this.setState.bind(this),\n    //   getState: this.getState.bind(this),\n    //   getElement: this.getElement.bind(this),\n    //   showCursor: this.showCursor.bind(this),\n    //   pause: this.pause.bind(this),\n    //   unpause: this.unpause.bind(this),\n    //   getIsInTransition: this.getIsInTransition.bind(this),\n    //   animateToState: this.animateToState.bind(this),\n    //   isAnimating: this.isAnimating.bind(this),\n    //   setAnimationFinishedCallback: this.setAnimationFinishedCallback.bind(this),\n    //   subscriptions: this.subscriptions,\n    //   getPauseState: this.getPauseState.bind(this),\n    //   dissolveToState: this.dissolveToState.bind(this),\n    // };\n    const onCursor = (payload) => {\n      const [action, x, y] = payload;\n      if (action === 'show') {\n        this.showCursor('up', new Point(x, y));\n      } else {\n        this.showCursor('hide');\n      }\n    };\n    const onTouch = (payload) => {\n      const [action, x, y] = payload;\n      if (!this.isCursorShown()) {\n        return;\n      }\n      if (action === 'down') {\n        this.showCursor('down', new Point(x, y));\n      } else {\n        this.showCursor('up');\n      }\n    };\n    const onCursorMove = (payload) => {\n      const [x, y] = payload;\n      this.setCursor(new Point(x, y));\n    };\n    const moved = (payload) => {\n      const [elementPath, transform] = payload;\n      const element = this.getElement(elementPath);\n      if (element == null) {\n        return;\n      }\n      element.moved(getTransform(transform));\n    };\n\n    const startBeingMoved = (payload) => {\n      const [elementPath] = payload;\n      const element = this.getElement(elementPath);\n      if (element == null) {\n        return;\n      }\n      element.startBeingMoved();\n    };\n\n    const stopBeingMoved = (payload) => {\n      const [elementPath, transform, velocity] = payload;\n      const element = this.getElement(elementPath);\n      if (element == null) {\n        return;\n      }\n      element.stopBeingMoved();\n      element.state.movement.velocity = getTransform(velocity);\n      element.transform = getTransform(transform);\n    };\n\n    const startMovingFreely = (payload) => {\n      const [elementPath, transform, velocity] = payload;\n      const element = this.getElement(elementPath);\n      if (element == null) {\n        return;\n      }\n      element.transform = getTransform(transform);\n      element.state.movement.velocity = getTransform(velocity);\n      element.startMovingFreely();\n    };\n    const click = (payload) => {\n      const [id] = payload;\n      const element = document.getElementById(id);\n      if (element != null) {\n        element.click();\n      }\n    };\n    const elementClick = (payload) => {\n      const [elementPath] = payload;\n      const element = this.getElement(elementPath);\n      if (element != null) {\n        element.click(payload);\n      }\n    };\n    const eqnNavClick = (payload) => {\n      const [direction, elementPath] = payload;\n      const element = this.getElement(elementPath);\n      if (element == null) {\n        // element.click();\n        return;\n      }\n      if (direction === 'next') { // $FlowFixMe\n        element.clickNext();\n      }\n      if (direction === 'prev') { // $FlowFixMe\n        element.clickPrev();\n      }\n      if (direction === 'refresh') { // $FlowFixMe\n        element.clickRefresh();\n      }\n    };\n\n    this.recorder.addEventType('cursor', onCursor);\n    this.recorder.addEventType('cursorMove', onCursorMove);\n    this.recorder.addEventType('touch', onTouch);\n    this.recorder.addEventType('moved', moved);\n    this.recorder.addEventType('stopBeingMoved', stopBeingMoved);\n    this.recorder.addEventType('startMovingFreely', startMovingFreely);\n    this.recorder.addEventType('startBeingMoved', startBeingMoved);\n    this.recorder.addEventType('click', click);\n    this.recorder.addEventType('elementClick', elementClick);\n    this.recorder.addEventType('eqnNavClick', eqnNavClick);\n  }\n\n  setDefaultLineWidth(userInputLineWidth: number | null) {\n    if (userInputLineWidth != null) {\n      this.defaultLineWidth = userInputLineWidth;\n      return;\n    }\n\n    const matrix = this.spaceTransforms.pixelToFigure.matrix();\n    this.defaultLineWidth = Math.abs(matrix[0]);\n  }\n\n  setDefaultLength(userInputLength: number | null) {\n    if (userInputLength != null) {\n      this.defaultLength = userInputLength;\n      return;\n    }\n\n    this.defaultLength = this.limits.width / 4;\n  }\n\n  scrollEvent() {\n    this.scrolled = true;\n    this.animateNextFrame(false, 'scroll event');\n  }\n\n  enableScrolling() {\n    document.addEventListener(\n      'scroll',\n      this.scrollEvent.bind(this),\n      false,\n    );\n  }\n\n  disableScrolling() {\n    document.removeEventListener(\n      'scroll',\n      this.scrollEvent.bind(this),\n      false,\n    );\n  }\n\n  getState(options: { precision?: number, ignoreShown?: boolean, min?: boolean }) {\n    this.stateTime = this.globalAnimation.now() / 1000;\n    return getState(this, [\n      'lastDrawTime',\n      'elements',\n      'stateTime',\n    ], options);\n  }\n\n  setState(\n    stateIn: Object,\n    optionsIn: {\n      how: 'animate' | 'dissolve' | 'instant',\n      duration?: number | {\n        dissovlveOut: ?number,\n        dissovlveIn: ?number,\n        delay: ?number,\n      },\n      velocity?: OBJ_ScenarioVelocity,\n      maxDuration?: number,\n      // minDuration?: number,\n      zeroDurationThreshold?: boolean,\n      allDurationsSame?: boolean,\n    } | 'dissolve' | 'animate' | 'instant' = 'instant',\n  ) {\n    // console.log(stateIn)\n    // $FlowFixMe\n    const state = parseState(stateIn, this);\n    let finishedFlag = false;\n    this.state.preparingToSetState = false;\n    const finished = () => {\n      finishedFlag = true;\n      this.state.preparingToSetState = false;\n      // if (window.asdf) {\n      //   debugger;\n      // }\n      setState(this, state);\n      this.elements.setTimeDelta(this.globalAnimation.now() / 1000 - this.stateTime);\n      this.elements.setPointsFromDefinition();\n      this.elements.setPrimitiveColors();\n      if (this.setStateCallback != null) {\n        this.fnMap.exec(this.setStateCallback);\n      }\n      this.animateNextFrame();\n      // console.log('triggered')\n      this.subscriptions.publish('stateSet');\n    };\n\n    let options = {\n      how: 'instant',\n      maxDuration: 6,\n      // velocity: {\n      //   position: 2,\n      //   rotation: Math.PI * 2 / 2,\n      //   scale: 1,\n      //   opacity: 0.8,\n      //   color: 0.8,\n      // },\n      allDurationsSame: true,\n      zeroDurationThreshold: 0.00001,\n      // minDuration: 0,\n      duration: 0,\n    };\n    if (optionsIn.velocity != null) { // $FlowFixMe\n      options.velocity = {\n        position: 2,\n        rotation: Math.PI * 2 / 2,\n        scale: 1,\n        opacity: 0.8,\n        color: 0.8,\n      };\n    }\n\n    // console.log(resumeSettings)\n    if (typeof optionsIn === 'string') {\n      options.how = optionsIn;\n    } else {\n      options = joinObjects({}, options, optionsIn);\n      // velocity trumps duration by default, but if only duration is defined by the\n      // user, then remove velocity;\n      // if (this.settings.resume.duration != null && this.settings.resume.velocity == null) {\n      //   options.velocity = undefined;\n      // }\n    }\n    if (options.how === 'dissolve') {\n      const defaultDuration = {\n        dissolveIn: 0.8,\n        dissolveOut: 0.8,\n        delay: 0.2,\n      };\n      if (options.duration === 0) {\n        options.duration = defaultDuration;\n      } else if (typeof options.duration === 'number') {\n        options.duration = {\n          dissolveOut: options.duration / 10 * 4.5,\n          dissolveIn: options.duration / 10 * 4.5,\n          delay: options.duration / 10 * 1,\n        };\n      } else {\n        options.duration = joinObjects({}, defaultDuration, options.duration);\n      }\n    } else if (options.duration != null && typeof options.duration !== 'number') {\n      // $FlowFixMe\n      options.duration = {\n        dissolveOut: 0,\n        dissolveIn: 0,\n        delay: 0,\n      };\n    }\n\n    if (\n      options.how === 'instant' // $FlowFixMe\n      || this.elements.isStateSame(state.elements, true, ['cursor'])\n    ) {\n      finished();\n    } else if (options.how === 'animate') {\n      this.elements.stop('freeze');  // This is cancelling the pulse\n      this.animateToState(\n        state,\n        options,\n        finished,\n        'now',\n      );\n    } else {\n      // this.figure.elements.freezePulseTransforms(false);\n      this.elements.stop('freeze');\n      this.dissolveToState({\n        state,\n        dissolveInDuration: options.duration.dissolveIn,\n        dissolveOutDuration: options.duration.dissolveOut,\n        done: finished,\n        delay: options.duration.delay,\n        startTime: 'now',\n      });\n    }\n\n    if (!finishedFlag) {\n      this.state.preparingToSetState = true;\n      this.subscriptions.publish('preparingToSetState');\n    }\n    this.animateNextFrame();\n  }\n\n  animateToState(\n    state: Object,\n    optionsIn: Object = {},\n    done: ?(string | (() => void)),\n    startTime: ?number | 'now' | 'prevFrame' | 'nextFrame' = null,\n  ) {\n    // const defaultOptions = {\n    //   // delay: 0,\n    //   duration: 1,\n    // };\n    // if (optionsIn.velocity != null) {\n    //   defaultOptions.duration = null;\n    // }\n\n    // const options = joinObjects(optionsIn, optionsIn);\n    // countStart();\n    const duration = this.elements.animateToState(\n      state.elements, optionsIn, true, startTime,\n    );\n\n    // countEnd();\n    if (done != null) {\n      if (duration === 0) {\n        this.fnMap.exec(done);\n      } else if (done != null) {\n        this.subscriptions.add('animationsFinished', done, 1);\n      }\n    }\n  }\n\n\n  dissolveToState(optionsIn: {\n    state: Object,\n    dissolveOutDuration: number,\n    dissolveInDuration: number,\n    delay: Number,\n    done: ?(string | (() => void)),\n    startTime: ?number | 'now' | 'prev' | 'next',\n  }) {\n    const options = joinObjects({}, {\n      dissolveOutDuration: 0.8,\n      dissolveInDuration: 0.8,\n      delay: 0.2,\n      done: null,\n      startTime: null,\n    }, optionsIn);\n    this.elements.animations.new()\n      .opacity({ duration: options.dissolveOutDuration, start: 1, target: 0.001 })\n      .trigger(\n        {\n          callback: () => {\n            this.elements.hideAll();\n            this.elements.show();\n            // this.elements.setOpacity(1);\n          },\n        },\n      )\n      .delay({ duration: options.delay })\n      .trigger({\n        callback: () => {\n          this.dissolveInToState({\n            state: options.state,\n            duration: options.dissolveInDuration,\n            done: options.done,\n            startTime: options.startTime,\n          });\n          // this.\n        },\n        // duration: options.dissolveInDuration,\n        duration: 0,\n      })\n      .start(options.startTime);\n    // console.log(this.elements)\n    // console.log(this.globalAnimation.now())\n  }\n\n  // dissolveToComplete(optionsIn: {\n  //   dissolveOutDuration: number,\n  //   dissolveInDuration: number,\n  //   delay: Number,\n  //   done: ?(string | (() => void)),\n  //   startTime: ?number | 'now' | 'prev' | 'next',\n  // }) {\n  //   const options = joinObjects({}, {\n  //     dissolveOutDuration: 0.8,\n  //     dissolveInDuration: 0.8,\n  //     delay: 0.2,\n  //     done: null,\n  //     startTime: null,\n  //   }, optionsIn);\n  //   const state = this.getState({});\n  //   this.stop('complete');\n  //   const completeState = this.getState({});\n  //   this.setState(state, 'instant');\n  //   this.elements.animations.new()\n  //     .opacity({ duration: options.dissolveOutDuration, start: 1, target: 0.001 })\n  //     .trigger(\n  //       {\n  //         callback: () => {\n  //           this.elements.hideAll();\n  //           this.elements.show();\n  //           // this.elements.setOpacity(1);\n  //         },\n  //       },\n  //     )\n  //     .delay({ duration: options.delay })\n  //     .trigger({\n  //       callback: () => {\n  //         this.dissolveInToState({\n  //           state: completeState,\n  //           duration: options.dissolveInDuration,\n  //           done: options.done,\n  //           startTime: options.startTime,\n  //         });\n  //         // this.\n  //       },\n  //       // duration: options.dissolveInDuration,\n  //       duration: 0,\n  //     })\n  //     .start(options.startTime);\n  // }\n\n\n  dissolveInToState(optionsIn: {\n    state: Object,\n    duration: number,\n    done: ?(string | (() => void)),\n    startTime: ?number | 'now' | 'prev' | 'next',\n  }) {\n    const options = joinObjects({}, {\n      duration: 0.8,\n      done: null,\n      startTime: null,\n    }, optionsIn);\n    const {\n      state, duration, done, startTime,\n    } = options;\n    const dissolveDuration = this.elements.dissolveInToState(state.elements, duration, startTime);\n\n    // force update of transforms to update any dependent transforms\n    const elements = this.elements.getAllElements();\n    elements.forEach((element) => {\n      if (element.isShown && element.dependantTransform === false) {\n        element.setTransform(element.transform);\n      }\n    });\n\n\n    if (done != null) {\n      if (dissolveDuration === 0) {\n        this.fnMap.exec(done);\n      } else if (done != null) {\n        this.subscriptions.add('animationsFinished', done, 1);\n      }\n    }\n  }\n\n  /**\n   * Add a {@link FigureElement} to the figure with some `name`.\n   * @example\n   * const hex = figure.shapes.polygon({\n   *   radius: 0.5,\n   *   sides: 6,\n   * });\n   * figure.add('hexagon', hex);\n   */\n  addLegacy(\n    name: string,\n    figureElement: FigureElementPrimitive | FigureElementCollection,\n  ) {\n    this.elements.add(name, figureElement);\n  }\n\n  add(\n    nameOrElementOrElementDefinition: string\n        | FigureElement | OBJ_AddElement\n        | Array<FigureElement | OBJ_AddElement>,\n    elementToAdd: FigureElement,\n  ) {\n    this.elements.add(nameOrElementOrElementDefinition, elementToAdd);\n  }\n\n\n  /**\n   * Get element from an element path with '.' separators.\n   *\n   * For instance, if a collection has a child collection 'a', which\n   * has a child primitive 'b', then the path would be: 'a.b'.\n   *\n   * @see <a href=\"#figureelementcollectiongetelement\">element.getElement</a>\n   *\n   * @param {null | string} elementPath\n   * @return {FigureElement | null } element at path. If `elementPath`\n   * is `null`, then the figure's base collection is returned. If `elementPath`\n   * is invalid then `null` is returned.\n   *\n   * @example\n   * // Get all the elements from a figure\n   * figure.add(\n   *   {\n   *     name: 'c',\n   *     method: 'collection',\n   *     elements: [\n   *       {\n   *         name: 'tri',\n   *         method: 'triangle',\n   *         options: {\n   *           height: 0.4,\n   *           width: 0.4,\n   *         },\n   *       },\n   *       {\n   *         name: 'text',\n   *         method: 'text',\n   *         options: {\n   *           text: 'triangle',\n   *           position: [0, -0.4],\n   *           xAlign: 'center',\n   *         },\n   *       },\n   *     ],\n   *   },\n   * );\n   *\n   * const c = figure.getElement('c');\n   * // Elements within collections can be found with dot notation\n   * const tri = figure.getElement('c.tri');\n   * // Or the collection can be queried directly\n   * const text = c.getElement('text');\n   */\n  getElement(elementName: string) {\n    if (elementName === this.elements.name) {\n      return this.elements;\n    }\n    return this.elements.getElement(elementName);\n  }\n\n  /**\n   * Returns an array of result from\n   * [getElement](#figureelementcollectiongetelement) calls on an\n   * array of paths.\n   *\n   * @param {TypeElementPath} children\n   * @return {Array<FigureElement>} Array of\n   * [getElement](#figureelementcollectiongetelement) results\n   */\n  getElements(children: TypeElementPath) {\n    return this.elements.getElements(children);\n  }\n\n  /**\n   * Set the figure to be touchable.\n   *\n   * Using <a href=\"#figureelementsettouchable\">element.setTouchable</a> will\n   * automatically set this.\n   */\n  setTouchable(touchable: boolean = true) {\n    if (touchable) {\n      this.elements.hasTouchableElements = true;\n    } else {\n      this.elements.hasTouchableElements = false;\n    }\n  }\n\n  getShapes() {\n    const webgl = [this.webglLow];\n    if (this.webglOffscreen) {\n      webgl.push(this.webglOffscreen);\n    }\n    const draw2D = [this.draw2DLow];\n    if (this.draw2DOffscreen) {\n      draw2D.push(this.draw2DOffscreen);\n    }\n    // if (high) {\n    //   webgl = this.webglHigh;\n    //   draw2D = this.draw2DHigh;\n    // }\n    return new FigurePrimitives(\n      webgl, draw2D,\n      // this.draw2DFigures,\n      this.htmlCanvas,\n      this.limits,\n      this.spaceTransforms,\n      this.animateNextFrame.bind(this, true, 'getShapes'),\n      this.defaultColor,\n      this.defaultDimColor,\n      this.defaultFont,\n      this.defaultLineWidth,\n      this.defaultLength,\n    );\n  }\n\n  // getEquations() {\n  //   const shapes = this.shapesLow;\n  //   // if (high) {\n  //   //   shapes = this.shapesHigh;\n  //   // }\n  //   return new FigureEquation(shapes, this.animateNextFrame.bind(this, true, 'equations'));\n  // }\n\n  getObjects() {\n    const shapes = this.shapesLow;\n    // const equation = this.equationLow;\n    // if (high) {\n    //   shapes = this.shapesHigh;\n    //   equation = this.equationHigh;\n    // }\n    return new FigureCollections(\n      shapes,\n      // equation,\n      this.isTouchDevice,\n      this.animateNextFrame.bind(this, true, 'collections'),\n    );\n  }\n\n  sizeHtmlText() {\n    const containerRect = this.container.getBoundingClientRect();\n    let size = containerRect.width / 35;\n    const test = document.getElementById(`${this.htmlId}_measure`);\n    if (test != null) {\n      test.style.fontSize = `${size}px`;\n      const width = (test.clientWidth + 1);\n      const ratio = width / containerRect.width;\n      if (containerRect.width < 500) {\n        size = Math.floor(0.84 / ratio * size * 10000) / 10000;\n      } else {\n        size = Math.floor(0.85 / ratio * size * 10000) / 10000;\n      }\n    }\n\n    this.htmlCanvas.style.fontSize = `${size}px`;\n  }\n\n  destroy() {\n    this.gesture.destroy();\n    this.webglLow.gl.getExtension('WEBGL_lose_context').loseContext();\n    // this.webglHigh.gl.getExtension('WEBGL_lose_context').loseContext();\n  }\n\n  setSpaceTransforms() {\n    const glSpace = {\n      x: { bottomLeft: -1, width: 2 },\n      y: { bottomLeft: -1, height: 2 },\n    };\n    const figureSpace = {\n      x: { bottomLeft: this.limits.left, width: this.limits.width },\n      y: { bottomLeft: this.limits.bottom, height: this.limits.height },\n    };\n\n    // console.log(this.canvasLow)\n    const canvasRect = this.canvasLow.getBoundingClientRect();\n    const pixelSpace = {\n      x: { bottomLeft: 0, width: canvasRect.width },\n      y: { bottomLeft: canvasRect.height, height: -canvasRect.height },\n    };\n\n    const percentSpace = {\n      x: { bottomLeft: 0, width: 1 },\n      y: { bottomLeft: 1, height: -1 },\n    };\n\n    this.spaceTransforms = {\n      figureToGL: spaceToSpaceTransform(figureSpace, glSpace, 'Figure'),\n      glToFigure: spaceToSpaceTransform(glSpace, figureSpace),\n      pixelToFigure: spaceToSpaceTransform(pixelSpace, figureSpace),\n      figureToPixel: spaceToSpaceTransform(figureSpace, pixelSpace),\n      pixelToGL: spaceToSpaceTransform(pixelSpace, glSpace),\n      glToPixel: spaceToSpaceTransform(glSpace, pixelSpace),\n      figureToCSSPercent: spaceToSpaceTransform(figureSpace, percentSpace),\n    };\n  }\n\n  // startRecording() {\n  //   this.isRecording = true;\n  // }\n\n  // stopRecording() {\n  //   this.isRecording = false;\n  // }\n\n  // deprecate\n  // eslint-disable-next-line class-methods-use-this\n  initialize() {\n    // const elements = this.elements.getAllElements();\n    // /* eslint-disable no-param-reassign */\n    // elements.forEach((element) => {\n    //   element.figure = this;\n    //   element.recorder = this.recorder;\n    //   element.animationFinishedCallback = this.animationFinished.bind(this, element);\n    // });\n    // this.elements.setFigure(this);\n    // // /* eslint-enable no-param-reassign */\n    // this.setFirstTransform();\n    // this.animateNextFrame();\n    // this.elements.setFigure({\n    //   limits: this.limits,\n    //   spaceTransforms: this.spaceTransforms,\n    //   animateNextFrame: this.animateNextFrame.bind(this),\n    //   animationFinished: this.animationFinished.bind(this),\n    //   recorder: this.recorder,\n    // });\n    // this.setFirstTransform();\n    // this.animateNextFrame();\n  }\n\n  initElements() {\n    // const elements = this.elements.getAllElements();\n    // /* eslint-disable no-param-reassign */\n    // elements.forEach((element) => {\n    //   element.figure = this;\n    //   element.recorder = this.recorder;\n    //   element.animationFinishedCallback = this.animationFinished.bind(this, element);\n    // });\n    // this.elements.setFigure(this);\n    // // /* eslint-enable no-param-reassign */\n    // this.setFirstTransform();\n    // this.animateNextFrame();\n    this.elements.setFigure({\n      limits: this.limits,\n      spaceTransforms: this.spaceTransforms,\n      animateNextFrame: this.animateNextFrame.bind(this),\n      animationFinished: this.animationFinished.bind(this),\n      recorder: this.recorder,\n    });\n    this.setFirstTransform();\n    this.animateNextFrame();\n  }\n\n  setElements(collection: FigureElementCollection) {\n    this.elements = collection;\n    this.initElements();\n    // this.elements.setFigure(this);\n    // // /* eslint-enable no-param-reassign */\n    // this.setFirstTransform();\n    // this.animateNextFrame();\n  }\n\n  /**\n   * Get remaining animation durations of running animations\n   */\n  getRemainingAnimationTime(nowIn: number = this.globalAnimation.now() / 1000) {\n    const elements = this.elements.getAllElements();\n    let now = nowIn;\n\n    if (this.state.pause === 'paused') {\n      now = this.pauseTime;\n    }\n    let remainingTime = 0;\n\n    elements.forEach((element) => {\n      const elementRemainingTime = element.animations.getRemainingTime([], now);\n      if (elementRemainingTime > remainingTime) {\n        remainingTime = elementRemainingTime;\n      }\n      const remainingPulseTime = element.getRemainingPulseTime(now);\n      if (remainingPulseTime > remainingTime) {\n        remainingTime = remainingPulseTime;\n      }\n      const remainingMovingFreelyTime = element.getRemainingMovingFreelyTime(now);\n      if (remainingMovingFreelyTime > remainingTime) {\n        remainingTime = remainingMovingFreelyTime;\n      }\n    });\n    return remainingTime;\n  }\n\n  setAnimationFinishedCallback(callback: ?(string | (() => void))) {\n    this.animationFinishedCallback = callback;\n  }\n\n  animationFinished() {\n    if (this.isAnimating()) {\n      return;\n    }\n    this.fnMap.exec(this.animationFinishedCallback);\n    this.subscriptions.publish('animationsFinished');\n  }\n\n  setFirstTransform() {\n    this.elements.setFirstTransform(this.spaceTransforms.figureToGL);\n  }\n\n  updateLimits(limits: TypeParsableRect) {\n    const l = getRect(limits);\n    this.limits = l._dup();\n    this.setSpaceTransforms();\n  }\n\n  // Renders all tied elements in the first level of figure elements\n  renderAllElementsToTiedCanvases(force: boolean = false) {\n    if (this.canvasOffscreen == null) {\n      return;\n    }\n    let needClear = false;\n    Object.keys(this.elements.elements).forEach((name) => {\n      const element = this.elements.elements[name];\n      if (\n        element.isShown\n        && (element.isRenderedAsImage === false || force)\n        && element.tieToHTML.element != null\n      ) {\n        element.isRenderedAsImage = true;\n        this.renderElementToTiedCanvas(name);\n        needClear = true;\n      }\n    });\n    if (needClear) {\n      this.drawQueued = true;\n      this.clearContext();\n      this.draw2DLow.ctx.clearRect(0, 0, this.textCanvasLow.width, this.textCanvasLow.height);\n      this.draw(-1);\n    }\n  }\n\n  renderElementToTiedCanvas(elementName: string) {\n    // record visibility of top level elements in figure\n    const currentVisibility = {};\n    Object.keys(this.elements.elements).forEach((name) => {\n      const element = this.elements.elements[name];\n      currentVisibility[name] = element.isShown;\n    });\n\n    // Hide all elements\n    Object.keys(this.elements.elements).forEach((name) => {\n      this.elements.elements[name].hide();\n    });\n\n    // Show the element to render\n    const elementToRender = this.elements.elements[elementName];\n    elementToRender.show();\n\n    // Move it to the origin to render\n    const oldPosition = elementToRender.getPosition();\n    const oldScale = elementToRender.getScale();\n    const htmlCanvas = document.getElementById(elementToRender.tieToHTML.element);\n    if (htmlCanvas instanceof HTMLElement) {\n      this.canvasOffscreen.style.width = `${htmlCanvas.clientWidth}px`;\n      this.canvasOffscreen.style.height = `${htmlCanvas.clientHeight}px`;\n      this.textCanvasOffscreen.style.width = `${htmlCanvas.clientWidth}px`;\n      this.textCanvasOffscreen.style.height = `${htmlCanvas.clientHeight}px`;\n      this.webglOffscreen.resize();\n      this.draw2DOffscreen.resize();\n    }\n\n    elementToRender.updateHTMLElementTie(this.canvasOffscreen);\n    // Need to reset position as updateHTMLElementTie doesn't set correct\n    // position as it uses a figure pixels space transform that is only\n    // relavant to the first gl canvas.\n    const scale = elementToRender.getScale();\n    elementToRender\n      .setPosition(0 - scale.x * (elementToRender.tieToHTML.window.left\n        + elementToRender.tieToHTML.window.width / 2),\n      0 - scale.y * (elementToRender.tieToHTML.window.bottom\n        + elementToRender.tieToHTML.window.height / 2));\n    // elementToRender.setPosition(0, 0);\n\n    // Stop animations and render\n    elementToRender.isRenderedAsImage = false;\n    elementToRender.stop('complete');\n\n    this.renderToCanvas(elementToRender.tieToHTML.element);\n    elementToRender.isRenderedAsImage = true;\n    // elementToRender.setRenderedOnNextDraw();\n    // reset position\n    elementToRender.setPosition(oldPosition);\n    elementToRender.setScale(oldScale);\n\n    // show all elements that were shown previously (except element that was just rendered)\n    Object.keys(this.elements.elements).forEach((name) => {\n      const element = this.elements.elements[name];\n      if (currentVisibility[name] === true) {\n        element.show();\n      } else {\n        element.hide();\n      }\n    });\n  }\n\n  // This method will render the gl and 2d contexts to a canvas\n  renderToCanvas(\n    htmlCanvasElementOrId: string = '',\n  ) {\n    let htmlCanvas = htmlCanvasElementOrId;\n    if (typeof htmlCanvasElementOrId === 'string') {\n      htmlCanvas = document.getElementById(htmlCanvasElementOrId);\n    }\n\n    if (!(htmlCanvas instanceof HTMLElement)) {\n      return;\n    }\n\n    this.drawQueued = true;\n    this.draw(-1, 1);\n\n    const w = document.getElementById(`${htmlCanvasElementOrId}_webgl`);\n    if (w instanceof HTMLImageElement) {\n      w.src = this.webglOffscreen.gl.canvas.toDataURL('image/png', 0.5);\n      w.style.display = 'block';\n    }\n\n\n    const d = document.getElementById(`${htmlCanvasElementOrId}_2d`);\n    if (d instanceof HTMLImageElement) {\n      d.src = this.draw2DOffscreen.canvas.toDataURL('image/png', 0.5);\n      d.style.display = 'block';\n    }\n    this.clearContext(1);\n  }\n\n  unrenderAll() {\n    // console.log('unrender all', Object.keys(this.elements.drawOrder).length)\n    for (let i = 0; i < this.elements.drawOrder.length; i += 1) {\n      const element = this.elements.elements[this.elements.drawOrder[i]];\n      element.unrender();\n    }\n  }\n\n  // resize should only be called if the viewport size has changed.\n  resize(skipHTMLTie: boolean = false) {\n    this.webglLow.resize();\n    this.draw2DLow.resize();\n    this.setSpaceTransforms();\n    if (this.elements != null) {\n      this.elements.updateLimits(this.limits, this.spaceTransforms);\n    }\n    this.sizeHtmlText();\n    // this.elements.resizeHtmlObject();\n    // this.updateHTMLElementTie();\n    if (skipHTMLTie) {\n      this.elements.resize();\n    } else {\n      this.elements.resize(this.canvasLow);\n    }\n    if (this.oldWidth !== this.canvasLow.clientWidth) {\n      // this.unrenderAll();\n      // console.log('updating width')\n      this.renderAllElementsToTiedCanvases();\n      this.oldWidth = this.canvasLow.clientWidth;\n    }\n    this.animateNextFrame(true, 'resize');\n    this.drawAnimationFrames = 2;\n    // this.renderAllElementsToTiedCanvases(true);\n  }\n\n  updateHTMLElementTie() {\n    if (this.elements != null) {\n      this.elements.updateHTMLElementTie(\n        this.canvasLow,\n      );\n    }\n  }\n\n  // simulateTouchDown(figurePoint: Point) {\n  //   // const pixelPoint = figurePoint.transformBy(this.spaceTransforms.figureToPixel.matrix());\n  //   // const clientPoint = this.pixelToClient(pixelPoint);\n  //   // this.touchDownHandler(clientPoint);\n\n  //   const pointer = this.getElement(this.cursorElementName);\n  //   if (pointer == null) {\n  //     return;\n  //   }\n  //   const up = pointer.getElement('up');\n  //   const down = pointer.getElement('down');\n  //   if (up == null || down == null) {\n  //     return;\n  //   }\n  //   up.hide();\n  //   down.show();\n  //   pointer.setPosition(figurePoint);\n  // }\n\n  /**\n   * Show specific elements within the figure\n   */\n  show(\n    toShow: TypeElementPath = [],\n  ): void {\n    this.elements.show(toShow);\n  }\n\n  /**\n   * Show specific elements within a figure, while hiding all others\n   */\n  showOnly(\n    toShow: TypeElementPath = [],\n  ): void {\n    this.elements.showOnly(toShow);\n  }\n\n  /**\n   * Set scenarios of all elements with scenarioName defined\n   */\n  setScenarios(scenarioName: string, onlyIfVisible: boolean = false) {\n    this.elements.setScenarios(scenarioName, onlyIfVisible);\n  }\n\n  toggleCursor() {\n    this.cursorShown = !this.cursorShown;\n    if (this.recorder.state === 'recording') {\n      if (this.cursorShown) {\n        this.recorder.recordEvent('cursor', ['show', this.previousCursorPoint.x, this.previousCursorPoint.y]);\n        if (this.isTouchDown) {\n          this.showCursor('down');\n        } else {\n          this.showCursor('up');\n        }\n        this.setCursor(this.previousCursorPoint);\n      } else {\n        this.recorder.recordEvent('cursor', ['hide']);\n        this.showCursor('hide');\n      }\n    }\n  }\n\n  showCursor(show: 'up' | 'down' | 'hide', position: ?Point = null) {\n    const cursor = this.getElement(this.cursorElementName);\n    if (cursor == null) {\n      return;\n    }\n    const up = cursor.getElement('up');\n    const down = cursor.getElement('down');\n    if (up == null || down == null) {\n      return;\n    }\n    if (show === 'up') {\n      up.showAll();\n      down.hide();\n    } else if (show === 'down') {\n      up.hide();\n      down.showAll();\n    } else {\n      cursor.hide();\n    }\n    if (position != null) {\n      this.setCursor(position);\n    }\n    this.animateNextFrame();\n  }\n\n  isCursorShown() {\n    const cursor = this.getElement(this.cursorElementName);\n    if (cursor == null) {\n      return false;\n    }\n    return cursor.isShown;\n  }\n\n  // Handle touch down, or mouse click events within the canvas.\n  // The default behavior is to be able to move objects that are touched\n  // and dragged, then when they are released, for them to move freely before\n  // coming to a stop.\n  touchDownHandler(clientPoint: Point) {\n    if (this.recorder.state === 'recording') {\n      const pixelP = this.clientToPixel(clientPoint);\n      const figurePoint = pixelP.transformBy(this.spaceTransforms.pixelToFigure.matrix());\n      this.recorder.recordEvent('touch', ['down', figurePoint.x, figurePoint.y]);\n      if (this.cursorShown) {\n        this.showCursor('down');\n      }\n    }\n\n    if (this.isPaused) {\n      this.unpause();\n    }\n    if (this.recorder.state === 'playing') {\n      this.recorder.pausePlayback();\n      this.showCursor('hide');\n    }\n    if (this.inTransition) {\n      return false;\n    }\n    this.isTouchDown = true;\n\n    // Get the touched point in clip space\n    const pixelPoint = this.clientToPixel(clientPoint);\n    // console.log(pixelPoint)\n    const glPoint = pixelPoint.transformBy(this.spaceTransforms.pixelToGL.matrix());\n    // console.log(glPoint)\n    // console.log(glPoint, clientPoint)\n\n    // console.log(glPoint.transformBy(this.glToFigureSpaceTransform.matrix()))\n    // const clipPoint = this.clientToClip(clientPoint);\n\n    // Get all the figure elements that were touched at this point (element\n    // must have isTouchable = true to be considered)\n    this.beingTouchedElements = this.elements.getTouched(glPoint);\n\n    if (this.touchTopElementOnly && this.beingTouchedElements.length > 1) {\n      this.beingTouchedElements = [this.beingTouchedElements[0]];\n    }\n\n    // if (this.touchTopElementOnly && this.beingTouchedElements.length > 0) {\n    //   // if () {\n    //   this.beingTouchedElements[0].click(glPoint);\n    //   // }\n    // } else {\n    this.beingTouchedElements.forEach(e => e.click(glPoint));\n    // }\n\n    // Make a list of, and start moving elements that are being moved\n    // (element must be touched and have isMovable = true to be in list)\n    this.beingMovedElements = [];\n    for (let i = 0; i < this.beingTouchedElements.length; i += 1) {\n      const element = this.beingTouchedElements[i];\n      if (element.isMovable) {\n        this.beingMovedElements.push(element);\n        element.startBeingMoved();\n      }\n    }\n    if (this.beingMovedElements.length > 0) {\n      this.animateNextFrame(true, 'touch down handler');\n    }\n    if (this.beingTouchedElements.length > 0) {\n      return true;\n    }\n    return false;\n  }\n\n  // simulateTouchUp() {\n  //   // this.touchUpHandler();\n  //   const pointer = this.getElement(this.cursorElementName);\n  //   if (pointer == null) {\n  //     return;\n  //   }\n  //   const up = pointer.getElement('up');\n  //   const down = pointer.getElement('down');\n  //   if (up == null || down == null) {\n  //     return;\n  //   }\n  //   up.show();\n  //   down.hide();\n  // }\n\n  // Handle touch up, or mouse click up events in the canvas. When an UP even\n  // happens, the default behavior is to let any elements being moved to move\n  // freely until they decelerate to 0.\n  touchUpHandler() {\n    // console.log(this.beingMovedElements)\n    if (this.recorder.state === 'recording') {\n      this.recorder.recordEvent('touch', ['up']);\n      if (this.cursorShown) {\n        this.showCursor('up');\n      }\n    }\n    // console.log(\"before\", this.elements._circle.transform.t())\n    // console.log(this.beingMovedElements)\n    for (let i = 0; i < this.beingMovedElements.length; i += 1) {\n      const element = this.beingMovedElements[i];\n      if (element.state.isBeingMoved) {\n        element.stopBeingMoved();\n        element.startMovingFreely();\n      }\n    }\n    this.isTouchDown = false;\n    this.beingMovedElements = [];\n    this.beingTouchedElements = [];\n    // console.log(\"after\", this.elements._circle.transform.t())\n  }\n\n  // simulateCursorMove(figurePoint: Point) {\n  //   const pointer = this.getElement(this.cursorElementName);\n  //   if (pointer == null) {\n  //     return;\n  //   }\n  //   pointer.setPosition(figurePoint);\n  // }\n\n  setCursor(p: Point) {\n    const pointer = this.getElement(this.cursorElementName);\n    if (pointer == null) {\n      return;\n    }\n    pointer.setPosition(p);\n    // console.log(p, pointer.isShown, pointer._up.isShown, pointer);\n    this.animateNextFrame();\n  }\n\n  touchFreeHandler(clientPoint: Point) {\n    if (this.recorder.state === 'recording') {\n      const pixelP = this.clientToPixel(clientPoint);\n      const figurePoint = pixelP.transformBy(this.spaceTransforms.pixelToFigure.matrix());\n      this.previousCursorPoint = figurePoint;\n      if (this.cursorShown) {\n        this.recorder.recordEvent('cursorMove', [figurePoint.x, figurePoint.y]);\n        this.setCursor(figurePoint);\n      }\n    }\n  }\n\n  rotateElement(\n    element: FigureElement,\n    previousClientPoint: Point,\n    currentClientPoint: Point,\n  ) {\n    let centerFigureSpace = element.getPosition('figure');\n    if (centerFigureSpace == null) {\n      centerFigureSpace = new Point(0, 0);\n    }\n    const center = centerFigureSpace\n      .transformBy(this.spaceTransforms.figureToPixel.matrix());\n    const previousPixelPoint = this.clientToPixel(previousClientPoint);\n    const currentPixelPoint = this.clientToPixel(currentClientPoint);\n\n    // const previousFigurePoint =\n    //   previousPixelPoint.transformBy(this.pixelToFigureSpaceTransform.matrix());\n    // const currentFigurePoint =\n    //   currentPixelPoint.transformBy(this.pixelToFigureSpaceTransform.matrix());\n    // const currentAngle = Math.atan2(\n    //   currentFigurePoint.y - center.y,\n    //   currentFigurePoint.x - center.x,\n    // );\n    // const previousAngle = Math.atan2(\n    //   previousFigurePoint.y - center.y,\n    //   previousFigurePoint.x - center.x,\n    // );\n    const currentAngle = Math.atan2(\n      currentPixelPoint.y - center.y,\n      currentPixelPoint.x - center.x,\n    );\n    const previousAngle = Math.atan2(\n      previousPixelPoint.y - center.y,\n      previousPixelPoint.x - center.x,\n    );\n    const diffAngle = -minAngleDiff(previousAngle, currentAngle);\n    const transform = element.transform._dup();\n    let rot = transform.r();\n    if (rot == null) {\n      rot = 0;\n    }\n    const newAngle = rot - diffAngle;\n    // if (newAngle < 0) {\n    //   newAngle += 2 * Math.PI;\n    // }\n    // if (newAngle > 2 * Math.PI) {\n    //   newAngle -= 2 * Math.PI;\n    // }\n    transform.updateRotation(newAngle);\n    element.moved(transform._dup());\n  }\n\n  translateElement(\n    element: FigureElement,\n    previousClientPoint: Point,\n    currentClientPoint: Point,\n  ) {\n    const previousPixelPoint = this.clientToPixel(previousClientPoint);\n    const currentPixelPoint = this.clientToPixel(currentClientPoint);\n\n    const previousFigurePoint =\n      previousPixelPoint.transformBy(this.spaceTransforms.pixelToFigure.matrix());\n    const currentFigurePoint =\n      currentPixelPoint.transformBy(this.spaceTransforms.pixelToFigure.matrix());\n    const m = element.spaceTransformMatrix('figure', 'local');\n\n    const currentVertexSpacePoint = currentFigurePoint.transformBy(m);\n    const previousVertexSpacePoint = previousFigurePoint.transformBy(m);\n    // const delta = currentFigurePoint.sub(previousFigurePoint);\n    const elementSpaceDelta = currentVertexSpacePoint.sub(previousVertexSpacePoint);\n    // console.log(delta, elementSpaceDelta)\n    const currentTransform = element.transform._dup();\n    const currentTranslation = currentTransform.t();\n    if (currentTranslation != null) {\n      const newTranslation = currentTranslation.add(elementSpaceDelta);\n      currentTransform.updateTranslation(newTranslation);\n      element.moved(currentTransform);\n    }\n  }\n\n  scaleElement(\n    element: FigureElement,\n    previousClientPoint: Point,\n    currentClientPoint: Point,\n    type: 'x' | 'y' | '' = '',\n  ) {\n    const previousPixelPoint = this.clientToPixel(previousClientPoint);\n    const currentPixelPoint = this.clientToPixel(currentClientPoint);\n\n    // const previousFigurePoint =\n    //   previousPixelPoint.transformBy(this.pixelToFigureSpaceTransform.matrix());\n    // const currentFigurePoint =\n    //   currentPixelPoint.transformBy(this.pixelToFigureSpaceTransform.matrix());\n\n    // const previousMag = previousFigurePoint.sub(center).distance();\n    // const currentMag = currentFigurePoint.sub(center).distance();\n    const center = element.getPosition('figure')\n      .transformBy(this.spaceTransforms.figureToPixel.matrix());\n    const previousMag = previousPixelPoint.sub(center).distance();\n    const currentMag = currentPixelPoint.sub(center).distance();\n\n\n    const currentScale = element.transform.s();\n    if (currentScale != null) {\n      const currentTransform = element.transform._dup();\n      const newScaleX = currentScale.x * currentMag / previousMag;\n      const newScaleY = currentScale.y * currentMag / previousMag;\n      if (type === 'x') {\n        currentTransform.updateScale(newScaleX, 1);\n      } else if (type === 'y') {\n        currentTransform.updateScale(1, newScaleY);\n      } else {\n        currentTransform.updateScale(newScaleX, newScaleY);\n      }\n      element.moved(currentTransform);\n    }\n  }\n\n  getIsInTransition() {\n    return this.inTransition;\n  }\n\n  // simulateTouchMove(\n  //   previousFigurePoint: Point,\n  //   currentFigurePoint: Point,\n  //   pointerElement: string = 'pointer',\n  // ) {\n  //   // const previousPixelPoint = previousFigurePoint\n  //   //   .transformBy(this.spaceTransforms.figureToPixel.matrix());\n  //   // const previousClientPoint = this.pixelToClient(previousPixelPoint);\n  //   // const currentPixelPoint = currentFigurePoint\n  //   //   .transformBy(this.spaceTransforms.figureToPixel.matrix());\n  //   // const currentClientPoint = this.pixelToClient(currentPixelPoint);\n  //   // this.touchMoveHandler(previousClientPoint, currentClientPoint);\n\n  //   const pointer = this.getElement(pointerElement);\n  //   if (pointer == null) {\n  //     return;\n  //   }\n  //   pointer.setPosition(currentFigurePoint);\n  // }\n\n  // Handle touch/mouse move events in the canvas. These events will only be\n  // sent if the initial touch down happened in the canvas.\n  // The default behavior is to drag (move) any objects that were touched in\n  // the down event to the new location.\n  // This function should return true if the move event should NOT be processed\n  // by the system. For example, on a touch device, a touch and drag would\n  // normally scroll the screen. Typically, you would want to move the figure\n  // element and not the screen, so a true would be returned.\n  touchMoveHandler(previousClientPoint: Point, currentClientPoint: Point): boolean {\n    if (this.recorder.state === 'recording') {\n      const currentPixelPoint = this.clientToPixel(currentClientPoint);\n      const figurePoint = currentPixelPoint\n        .transformBy(this.spaceTransforms.pixelToFigure.matrix());\n      this.recorder.recordEvent('cursorMove', [figurePoint.x, figurePoint.y]);\n      if (this.cursorShown) {\n        this.setCursor(figurePoint);\n      }\n    }\n\n    if (this.inTransition) {\n      return false;\n    }\n    if (this.beingMovedElements.length === 0) {\n      return false;\n    }\n    const previousPixelPoint = this.clientToPixel(previousClientPoint);\n    // const currentPixelPoint = this.clientToPixel(currentClientPoint);\n\n    const previousGLPoint =\n      previousPixelPoint.transformBy(this.spaceTransforms.pixelToGL.matrix());\n\n    // Go through each element being moved, get the current translation\n    for (let i = 0; i < this.beingMovedElements.length; i += 1) {\n      const element = this.beingMovedElements[i];\n      if (element !== this.elements) {\n        if (element.isBeingTouched(previousGLPoint)\n              || element.move.canBeMovedAfterLosingTouch) {\n          const elementToMove = element.move.element == null ? element : element.move.element;\n          if (elementToMove.state.isBeingMoved === false) {\n            elementToMove.startBeingMoved();\n          }\n          if (this.beingMovedElements.indexOf(elementToMove) === -1) {\n            this.beingMovedElements.push(elementToMove);\n          }\n          if (element.move.type === 'rotation') {\n            this.rotateElement(\n              elementToMove,\n              previousClientPoint,\n              currentClientPoint,\n            );\n          } else if (element.move.type === 'scale') {\n            this.scaleElement(\n              elementToMove,\n              previousClientPoint,\n              currentClientPoint,\n            );\n          } else if (element.move.type === 'scaleX') {\n            this.scaleElement(\n              elementToMove,\n              previousClientPoint,\n              currentClientPoint,\n              'x',\n            );\n          } else if (element.move.type === 'scaleY') {\n            this.scaleElement(\n              elementToMove,\n              previousClientPoint,\n              currentClientPoint,\n              'y',\n            );\n          } else {\n            this.translateElement(\n              elementToMove,\n              previousClientPoint,\n              currentClientPoint,\n            );\n          }\n        }\n      }\n      if (this.touchTopElementOnly) {\n        i = this.beingMovedElements.length;\n      }\n    }\n    this.animateNextFrame(true, 'touch move handler');\n    return true;\n  }\n\n  /**\n   * Stop all animations, movement and pulses in figure.\n   */\n  stop(\n    how: 'freeze' | 'cancel' | 'complete' | 'animateToComplete' | 'dissolveToComplete' = 'cancel',\n  ) {\n    const stopped = () => {\n      this.subscriptions.publish('stopped');\n      this.state.preparingToStop = false;\n    };\n    if (!this.elements.isAnimating()) {\n      stopped();\n      return;\n    }\n    if (how === 'freeze' || how === 'cancel' || how === 'complete') {\n      this.elements.stop(how);\n      stopped();\n      return;\n    }\n\n    this.state.preparingToStop = false;\n    if (how === 'animateToComplete') {\n      this.elements.stop(how);\n      const elements = this.elements.getAllElements();\n      let preparingToStopCounter = 0;\n      const checkAllStopped = () => {\n        if (preparingToStopCounter > 0) {\n          preparingToStopCounter -= 1;\n        }\n        if (preparingToStopCounter === 0) {\n          stopped();\n        }\n      };\n      elements.forEach((element) => {\n        if (element.state.preparingToStop) {\n          preparingToStopCounter += 1;\n          element.subscriptions.add('stopped', checkAllStopped, 1);\n        }\n      });\n      if (preparingToStopCounter === 0) {\n        checkAllStopped();\n      } else if (preparingToStopCounter > 0) {\n        this.subscriptions.publish('preparingToStop');\n        this.state.preparingToStop = true;\n      }\n      return;\n    }\n    // console.log('asdf')\n    // Otherwise we are dissolving to complete\n    const state = this.getState({});\n    this.elements.stop('complete');\n    const completeState = this.getState({});\n    this.setState(state);\n    this.elements.stop('freeze');\n    this.setState(completeState, 'dissolve');\n    if (this.state.preparingToSetState) {\n      this.subscriptions.add('stateSet', stopped, 1);\n      this.subscriptions.publish('preparingToStop');\n      this.state.preparingToStop = true;\n    } else {\n      stopped();\n    }\n  }\n\n  // To add elements to a figure, either this method can be overridden,\n  // or the `add` method can be used.\n  createFigureElements() {\n    // this.elements = new FigureElementCollection();\n    this.elements = this.collections.collection();\n    this.initElements();\n    // this.elements.setFigure({\n    //   limits: this.limits,\n    //   spaceTransforms: this.spaceTransforms,\n    //   animateNextFrame: this.animateNextFrame,\n    //   animationFinished: this.animationFinished.bind(this),\n    // });\n    // this.setFirstTransform();\n    // this.animateNextFrame();\n    // this.elements.figureLimits = this.limits;\n  }\n\n\n  setElementsToCollection(collection: FigureElementCollection) {\n    this.elements = collection;\n    // this.elements.setDigram(this);\n    // this.setFirstTransform();\n    this.initElements();\n  }\n\n  clearContext(canvasIndex: number = 0) {\n    if (canvasIndex === 0) {\n      this.webglLow.gl.clearColor(0, 0, 0, 0);\n      this.webglLow.gl.clear(this.webglLow.gl.COLOR_BUFFER_BIT);\n    } else {\n      this.webglOffscreen.gl.clearColor(0, 0, 0, 0);\n      this.webglOffscreen.gl.clear(this.webglLow.gl.COLOR_BUFFER_BIT);\n    }\n    // this.webglHigh.gl.clearColor(0, 0, 0, 0);\n    // this.webglHigh.gl.clear(this.webglHigh.gl.COLOR_BUFFER_BIT);\n    this.elements.clear(canvasIndex);\n  }\n\n  // scroll() {\n  //   if (this.scrollingFast === false) {\n  //     this.webglLow.gl.canvas.style.top = '-10000px';\n  //     this.renderAllElementsToTiedCanvases();\n  //     this.scrollingFast = true;\n  //     if (this.scrollTimeoutId) {\n  //       clearTimeout(this.scrollTimeoutId);\n  //       this.scrollTimeoutId = null;\n  //     }\n  //     this.scrollTimeoutId = setTimeout(this.centerDrawingLens.bind(this, true), 100);\n  //   }\n  // }\n\n  drawNow(time: number = -1) {\n    this.drawQueued = true;\n    this.draw(time);\n  }\n\n  // getPaused() {\n  //   return this.elements.getPaused();\n  // }\n\n  // getPauseState() {\n  //   return this.state.pause;\n  // }\n\n  pause() {\n    if (this.state.pause === 'pause' || this.state.pause === 'preparingToPause' || this.state.pause === 'preparingToUnpause') {\n      return;\n    }\n    this.state.pause = 'paused';\n    this.pauseTime = this.globalAnimation.now() / 1000;\n  }\n\n  // pauseLegacy(pauseSettings: TypePauseSettings = { simplePause: true }) {\n  //   // forcePause: boolean = true, clearAnimations: boolean = false) {\n  //   this.elements.pause(pauseSettings);\n  //   if (pauseSettings.simplePause != null && pauseSettings.simplePause) {\n  //     this.state.pause = 'paused';\n  //     this.pauseTime = this.globalAnimation.now() / 1000;\n  //     return;\n  //   }\n\n  //   const elements = this.elements.getAllElements();\n  //   let preparingToPauseCounter = 0;\n  //   const checkAllPaused = () => {\n  //     if (preparingToPauseCounter > 0) {\n  //       preparingToPauseCounter -= 1;\n  //     }\n  //     if (preparingToPauseCounter === 0) {\n  //       this.state.pause = 'paused';\n  //       this.isPaused = true;\n  //       this.subscriptions.publish('paused');\n  //     }\n  //   }\n  //   elements.forEach((element) => {\n  //     if (element.state.pause === 'preparingToPause') {\n  //       preparingToPauseCounter += 1;\n  //       element.subscriptions.add('paused', checkAllPaused, 1);\n  //     }\n  //   });\n  //   this.pauseTime = this.globalAnimation.now() / 1000;\n  //   if (preparingToPauseCounter === 0 && this.state.pause !== 'paused') {\n  //     checkAllPaused();\n  //   } else if (preparingToPauseCounter > 0) {\n  //     this.state.pause = 'preparingToPause';\n  //     this.subscriptions.publish('preparingToPause');\n  //   }\n  // }\n\n  // pauseAfterNextDraw() {\n  //   this.pauseAfterNextDrawFlag = true;\n  // }\n\n  unpause() {\n    if (this.state.pause === 'unpaused' || this.state.pause === 'preparingToPause' || this.state.pause === 'preparingToUnpause') {\n      return;\n    }\n    this.state.pause = 'unpaused';\n    this.isPaused = false;\n    this.elements.setTimeDelta(this.globalAnimation.now() / 1000 - this.pauseTime);\n    this.animateNextFrame();\n    this.subscriptions.publish('unpaused');\n  }\n\n  touchDown(figurePosition: TypeParsablePoint) {\n    const p = getPoint(figurePosition);\n    const pixelPoint = p.transformBy(this.spaceTransforms.figureToPixel.m());\n    const clientPoint = this.pixelToClient(pixelPoint);\n    this.touchDownHandler(clientPoint);\n    this.mockPreviousTouchPoint = clientPoint;\n    // $FlowFixMe\n    if (this.elements.elements[this.cursorElementName] != null) {\n      this.showCursor('down', p);\n      // cursor.setPosition(p);\n    }\n  }\n\n  touchUp() {\n    this.touchUpHandler();\n    // $FlowFixMe\n    if (this.elements.elements[this.cursorElementName] != null) {\n      this.showCursor('up');\n      // cursor.setPosition(p);\n    }\n  }\n\n  touchMove(figurePosition: TypeParsablePoint) {\n    const p = getPoint(figurePosition);\n    const pixelPoint = p.transformBy(this.spaceTransforms.figureToPixel.m());\n    const clientPoint = this.pixelToClient(pixelPoint);\n    this.touchMoveHandler(this.mockPreviousTouchPoint, clientPoint);\n    this.mockPreviousTouchPoint = clientPoint;\n    // $FlowFixMe\n    if (this.elements.elements[this.cursorElementName] != null) {\n      this.showCursor('down', p);\n      // cursor.setPosition(p);\n    }\n  }\n\n  // unpauseLegacy() {\n  //   this.elements.unpause();\n  //   const elements = this.elements.getAllElements();\n  //   let preparingToUnpauseCounter = 0;\n  //   const checkAllUnpaused = () => {\n  //     if (preparingToUnpauseCounter > 0) {\n  //       preparingToUnpauseCounter -= 1;\n  //     }\n  //     if (preparingToUnpauseCounter === 0) {\n  //       this.state.pause = 'unpaused';\n  //       this.isPaused = false;\n  //       this.elements.setTimeDelta(this.globalAnimation.now() / 1000 - this.pauseTime);\n  //       this.animateNextFrame();\n  //       this.subscriptions.publish('unpaused');\n  //     }\n  //   };\n  //   elements.forEach((element) => {\n  //     if (element.state.pause === 'preparingToUnpause') {\n  //       preparingToUnpauseCounter += 1;\n  //       element.subscriptions.add('unpaused', checkAllUnpaused, 1)\n  //     }\n  //   });\n  //   if (preparingToUnpauseCounter === 0 && this.state.pause !== 'unpaused') {\n  //     checkAllUnpaused();\n  //   } else if (preparingToUnpauseCounter > 0) {\n  //     this.state.pause = 'preparingToUnpause';\n  //     this.subscriptions.publish('preparingToUnpause');\n  //   }\n  //   // // this.state.pause = this.elements.getPause();\n  //   // this.pauseTime = performance.now() / 1000;\n\n\n  //   // this.elements.unpause();\n  //   // this.isPaused = false;\n  //   // this.elements.setTimeDelta(performance.now() / 1000 - this.pauseTime);\n  //   this.animateNextFrame();\n  // }\n\n  draw(nowIn: number, canvasIndex: number = 0): void {\n    // const start = new Date().getTime();\n    const t = performance.now();\n    // if ((nowIn - this.lastDrawTime ) * 1000 > 40) {\n    //   console.log((nowIn - this.lastDrawTime) * 1000)\n    // }\n    window.timeData = [];\n    if (this.state.pause === 'paused') {\n      return;\n    }\n    let now = nowIn;\n    if (nowIn === -1) {\n      now = this.lastDrawTime;\n    }\n\n    this.lastDrawTime = now;\n\n    if (this.scrolled === true) {\n      this.scrolled = false;\n      if (Math.abs(window.pageYOffset - this.oldScroll)\n          > this.webglLow.gl.canvas.clientHeight / 4\n      ) {\n        this.renderAllElementsToTiedCanvases();\n        // }\n        this.scrollingFast = true;\n        if (this.scrollTimeoutId) {\n          clearTimeout(this.scrollTimeoutId);\n          this.scrollTimeoutId = null;\n        }\n        this.scrollTimeoutId = setTimeout(this.centerDrawingLens.bind(this, true), 100);\n      }\n    }\n\n    // If only a scroll event called draw, then quit before drawing\n    if (this.drawQueued === false) {\n      return;\n    }\n    this.drawQueued = false;\n\n    this.clearContext(canvasIndex);\n    // console.log('really drawing')\n    // const startSetup = new Date().getTime();\n    this.subscriptions.publish('beforeDraw');\n    this.elements.setupDraw(\n      now,\n      canvasIndex,\n    );\n    const t2 = performance.now();\n    // const endSetup = new Date().getTime();\n    // const startDraw = endSetup;\n    this.elements.draw(now, [this.spaceTransforms.figureToGL], 1, canvasIndex);\n    // const endDraw = new Date().getTime();\n    const t3 = performance.now()\n    if (this.elements.isAnyElementMoving()) {\n      this.animateNextFrame(true, 'is moving');\n    }\n\n    if (this.drawAnimationFrames > 0) {\n      this.drawAnimationFrames -= 1;\n      this.animateNextFrame(true, 'queued frames');\n    }\n    this.subscriptions.publish('afterDraw');\n    // const t3 = performance.now();\n    // console.log('Summary', round(t2 - t, 0), round(t3 - t2, 0), round(t - this.lastTime1, 0));\n    // this.lastTime1 = t;\n    // const end = new Date().getTime();\n    // const total = end - start;\n    // const setup = endSetup - startSetup;\n    // const draw = endDraw - startDraw;\n    // console.log(total, setup, draw, total - setup - draw);\n    console.log(performance.now() - t, t2 - t, t3 - t2);\n    console.log(window.timeData);\n    // console.log(perfr)\n  }\n\n  // renderToImages() {\n  //   // console.log('visibility1')\n  //   this.drawTimeoutId = null;\n  //   // if (this.webglLow.gl.canvas.style.top !== '-10000px') {\n  //   //   this.webglLow.gl.canvas.style.top = '-10000px';\n  //   //   this.waitForFrames = 1;\n  //   // }\n  //   this.renderAllElementsToTiedCanvases();\n  //   // this.centerDrawingLens();\n  //   // this.webglLow.gl.canvas.style.visibility = 'visible';\n  // }\n\n  centerDrawingLens(fromTimeOut: boolean = false) {\n    if (fromTimeOut) {\n      this.scrollingFast = false;\n    }\n    let viewPortHeight = window.innerHeight || 0;\n    if (document.documentElement != null) {\n      viewPortHeight = Math.max(\n        document.documentElement.clientHeight,\n        window.innerHeight || 0,\n      );\n    }\n    let newTop = window.pageYOffset + viewPortHeight / 2\n                 - this.webglLow.gl.canvas.clientHeight / 2;\n    if (newTop < 0) {\n      newTop = 0;\n    }\n    const newTopInPx = `${newTop}px`;\n    if (this.webglLow.gl.canvas.style.top !== newTopInPx) {\n      this.webglLow.gl.canvas.style.top = `${newTop}px`;\n      this.draw2DLow.canvas.style.top = `${newTop}px`;\n      this.updateHTMLElementTie();\n    }\n    this.oldScroll = window.pageYOffset;\n  }\n\n  /**\n   * Force figure to draw on next available animation frame.\n   */\n  animateNextFrame(draw: boolean = true, fromWhere: string = '') {\n    this.fromWhere = fromWhere;\n    if (!this.drawQueued) {\n      if (draw) {\n        this.drawQueued = true;\n      }\n      this.globalAnimation.queueNextFrame(this.draw.bind(this));\n    }\n  }\n\n  // animateNextFrameContinuous(method: () => void) {\n  //   this.globalAnimation.queueNextFrame((now) => {\n  //     const t = performance.now();\n  //     const lastTime = t - this.lastTime\n  //     this.lastTime = t;\n  //     method(now);\n  //     this.draw(now);\n  //     console.log(round(lastTime, 1), round(performance.now() - t, 1));\n  //     this.animateNextFrameContinuous(method);\n  //   });\n  // }\n\n  isAnimating(): boolean {\n    // console.log('asdf')\n    return this.elements.isAnimating();\n  }\n\n  clientToPixel(clientLocation: Point): Point {\n    const canvas = this.canvasLow.getBoundingClientRect();\n    return new Point(\n      clientLocation.x - canvas.left,\n      clientLocation.y - canvas.top,\n    );\n  }\n\n  pixelToClient(pixelLocation: Point): Point {\n    const canvas = this.canvasLow.getBoundingClientRect();\n    return new Point(\n      pixelLocation.x + canvas.left,\n      pixelLocation.y + canvas.top,\n    );\n  }\n\n  debugShowTouchBorders(\n    elements: TypeElementPath,\n    lineOptions: OBJ_Polyline = {},\n    startIndex: number = 0,\n  ) {\n    const elems = this.elements.getElements(elements);\n    elems.forEach((element, index) => {\n      const touchBorder = element.getBorder('figure', 'touchBorder');\n      const polyline = this.primitives.polyline(joinObjects({}, lineOptions, {\n        points: touchBorder[0],\n        close: true,\n      }));\n      this.add(`__touchBorder_${index + startIndex}`, polyline);\n    });\n  }\n}\n\nexport default Figure;\n","// @flow\n\n// import Figure from '../Figure';\nimport {\n  Transform, Point, Line, polarToRect,\n  threePointAngle, getPoint, clipAngle,\n} from '../../tools/g2';\nimport type { TypeParsablePoint } from '../../tools/g2';\nimport {\n  roundNum,\n} from '../../tools/math';\nimport { joinObjects } from '../../tools/tools';\nimport {\n  FigureElementCollection, FigureElementPrimitive,\n} from '../Element';\nimport EquationLabel from './EquationLabel';\nimport { Equation } from '../Equation/Equation';\nimport { simplifyArrowOptions, getArrowLength } from '../geometries/arrow';\nimport type { OBJ_LineArrows, OBJ_LineArrow } from '../geometries/arrow';\nimport type { OBJ_Pulse } from '../Element';\nimport type { EQN_Equation } from '../Equation/Equation';\nimport type { TypeWhen } from '../webgl/GlobalAnimation';\nimport type {\n  TypeLabelOrientation, TypeLabelLocation, TypeLabelSubLocation,\n} from './EquationLabel';\nimport * as animation from '../Animation/Animation';\nimport type { OBJ_CustomAnimationStep, OBJ_TriggerAnimationStep } from '../Animation/Animation';\nimport type { TypeColor } from '../../tools/types';\nimport type { OBJ_Collection } from '../FigurePrimitives/FigurePrimitives';\nimport type FigureCollections from './FigureCollections';\n\n// export type TypeAngleLabelOrientation = 'horizontal' | 'tangent';\n\n/**\n * Angle move options object.\n *\n * The angle corner has two arms. The `startArm` is the first arm of the angle\n * (the one defined by <a href=\"adv_angle#startangle\">startAngle</a>),\n * while the `endArm` is the second arm of the corner defined by\n * <a href=\"adv_angle#angle\">angle</a>.\n *\n * Both arms can be set to either rotate the angle (`'rotation'`) or change the\n * size of the angle (`'angle'`). Invisible touch pads are overlaid on the arms\n * with some `width`. When these pads are touched, the corresponding arm will\n * move. The pads extend past the arm ends by `width` as well.\n *\n * If `movePadRadius` is greater than 0, then a pad with that radius will be\n * placed at the corner vertex. When this pad is touched, the angle will\n * translate.\n *\n * @property {'rotation' | 'angle' | null} [startArm]\n * @property {'rotation' | 'angle' | null} [endArm]\n * @property {boolean} [movable] `true` to make movable, `false` to not (`true`)\n * @property {number} [movePadRadius] radius of move pad (`0`)\n * @property {number} [width] width of pads over lines (`0.5`)\n */\nexport type OBJ_MovableAngle = {\n  movable: boolean,\n  movePadRadius: number,\n  width: number,\n  startArm: 'angle' | 'rotation' | null,\n  endArm: 'angle' | 'rotation' | null,\n}\n\n/**\n * Collections angle label options object.\n *\n * An angle can be annotated with a label using the `text` property and can be:\n * - text (`string`, or Array<`string`)\n * - an equation (`Equation`, `EQN_Equation`)\n * - real length of line (`null`)\n *\n * In all cases, an actual {@link Equation} is created as the label. The\n * equation can have multiple forms, which can be set using the `showForm`\n * method.\n *\n * If `text`: `string`, then an equation with a single form named `base` will\n * be created with a single element being the string text.\n *\n * If `text`: `Array<string>`, then an equation with a form for each element\n * of the array is created. Each form is named '0', '1', '2'... corresponding\n * with the index of the array. Each form is has a single element, being the\n * text at that index.\n *\n * Use `text`: `Equation` or `EQN_Equation` to create completely custom\n * equations with any forms desirable.\n *\n * If the label text is the real angle (`null`), then the number\n * of decimal places can be selected with `precision` and the units with\n * `units`.\n *\n * By default, the label is placed at the same radius as the curve (if\n * a curve exists). An independant radius can be selected with `radius`.\n *\n * The space between the radius and the label is defined with `offset`. An\n * `offset` of 0 puts the center of the label on the radius. Any\n * positive or negative value of offset will move the label so no part of the\n * label overlaps the line, and then the closest part of the label is separated\n * from the line by `offset`.\n *\n * To situate the label, use `curvePosition`, `location` and\n * `subLocation`. By default the label will be a percentage `curvePosition`\n * of the angle. `location` then defines which side of the radius the label is\n * on, while `subLocation` defines the backup location for invalid cases of\n * `location`. See {@link TypeLabelLocation} and\n * {@link TypeLabelSubLocation}. `location` can additionaly place the\n * labels off the ends of the angle.\n *\n * To automatically update the label location and orientation as the line\n * transform (translation, rotation or scale) changes then use `update: true`.\n *\n * @property {null | string | Array<string> | Equation | EQN_Equation } text\n * or equation to show. Use `null` to show real angle.\n * @property {'degrees' | 'radians'} units (`'degrees'`)\n * @property {number} [precision] (`0`)\n * @property {number} [radius] overwrite default radius\n * @property {number} [offset] space to radius (`0`)\n * @property {number} [curvePosition] where the label is along the curve of the\n * angle, in percent of curve from the start of the angle (`0.5`)\n * @property {TypeLabelLocation} [location] (`'outside'`)\n * @property {TypeLabelSubLocation} [subLocation]\n * @property {TypeLabelOrientation} [orientation] (`'horizontal'`)\n * @property {number} [autoHide] hide label if angle is less than value (`null`)\n * @property {number} [autoHideMax] hide label if angle is greater than value (`null`)\n * @property {boolean} [update] (`false`)\n * @property {number} [scale] size of the label\n * @property {TypeColor} [color]\n */\nexport type TypeAngleLabelOptions = {\n  text: null | string | Array<string> | Equation | EQN_Equation,\n  units?: 'degrees' | 'radians';  // Real angle units\n  precision?: number,             // Num decimal places if using angle label\n  radius?: number,                // Label radius\n  offset?: number,                // Label position along curve in rad\n  curvePosition?: number,         // Label position along curve in %\n  location?: TypeLabelLocation,\n  subLocation?: TypeLabelSubLocation,\n  orientation?: TypeLabelOrientation,\n  autoHide?: ?number,             // Auto hide label if angle is less than this\n  autoHideMax?: ?number,          // Auto hide label if angle greater than this\n  update?: boolean,\n  scale?: number,                 // Text scale\n  color?: TypeColor,          // Text color can be different to curve\n};\n\n/**\n * Angle Curve options object.\n *\n * The curve annotation of an Collections Angle shape.\n *\n * @property {number} [width] Curve line width (`0.01`)\n * @property {boolean} [fill] Use a fill instead of a line (`false`)\n * @property {number} [sides] Number of sides in full circle curve (`100`)\n * @property {number} [radius] Curve radius (`0.5`)\n * @property {number} [num] Number of curves (`1`)\n * @property {number} [step] Step radius of curves if curve num > 1 (`0`)\n * @property {?number} [autoHide] if angle is less than this, hide curve\n * (`null`)\n * @property {?number} [autoHideMax] if angle is less than this, hide curve\n * (`null`)\n * @property {boolean} [autoRightAngle] Right angle curve displayed when angle\n * = /2 (`false`)\n * @property {number} [rightAngleRange] Range around /2 for right angle curve\n * display (`0.01745329...` or 1 degree)\n */\nexport type OBJ_AngleCurve = {\n  width?: number,           // Curve line width\n  fill?: boolean,\n  sides?: number,           // Number of sides in 360 curve\n  radius?: number,          // Curve radius\n  num?: number,             // Number of curves\n  step?: number,            // Step radius of curves if curve num > 1\n  autoHide?: ?number,       // if angle is less than this, hide curve\n  autoHideMax?: ?number,    // if angle is less than this, hide curve\n  autoRightAngle?: boolean, // Right angle curve displayed when angle = /2\n  rightAngleRange?: number, // Range around /2 for right angle curve display\n};\n\n/**\n * Additional arrow properties specific to collections angle shapes.\n *\n * By default, the arrows are placed at the same radius as the curve, but\n * the radius can be changed with `radius`.\n *\n * By default, the arrows will hide when the angle is small enough where\n * the arrows will touch. To disable this, use `autoHide`.\n *\n * As the curve is a polygon with a finite amount of sides, its actual length\n * can look like it changes when the angle changes and a smaller number of\n * sides are used. This can result in a gap sometimes appearing between the\n * curve and the arrow head. To eliminate this gap, allow the curve to overlap\n * with the arrow head a little with `curveOverlap`. Beware however, if using\n * transparency, a large overlap will be obvious as the semi opaque color will\n * be darker in the overlap area. Also, if pulsing curve thickness, then for\n * small arrow heads, large width pulse scales and large overlap, the curve\n * may break through the pointy edge of the arrow head. Therefore selecting\n * `curveOverlap` can be a delicate balance that depends on application.\n *\n * @property {number} [curveOverlap] the percent of the arrow that the curve\n * overlaps with (`0.3`)\n * @property {boolean} [autoHide] `true` will hide the arrows when the angle is\n * small enough that the arrows start to touch (`true`)\n * @property {number} [radius] location of the arrows, by default they will be\n * at the radius of the curve.\n */\nexport type OBJ_AngleArrows = {\n  curveOverlap?: number,\n  autoHide?: boolean,\n  radius?: number,\n};\n\n/**\n * Arrow definition for advaned angles.\n *\n * `string | (`{@link OBJ_LineArrows} ` & ` {@link OBJ_AngleArrows}`)`\n *\n * Use `single` string to specify head type of two arrows with default\n * dimensions. Otherwise use options object to select and/or customize one or\n * both arrows.\n */\nexport type TypeAngleArrows = string | OBJ_LineArrows & OBJ_AngleArrows;\n\n/**\n * Collections angle corner definition.\n *\n * @property {number} [length] length of corner's arms - by default it will be\n * twice the length of the curve.\n * @property {number} [width] line width of the corner - by default it will be\n * the same as the curve\n * @property {TypeColor} [color]\n * @property {'fill' | 'auto' | 'none'} [style] style of the corner\n */\nexport type OBJ_AngleCorner = {\n  length?: number,\n  width?: number,\n  color?: TypeColor,\n  style?: 'fill' | 'auto' | 'none',\n};\n\n/**\n * Options object for setting properties of `pulseAngle`.\n *\n * The `curve`, `corner`, `label` and `arrow` can all be\n * pulsed with a simple scale number, or customization using\n * the {@type OBJ_Pulse} object.\n *\n * The `thick` property can be used to change the default scale pulse.\n * When a `1` is used, the angle will pulse from the vertex of the corner\n * in scale. When `thick` is greater than 1, then the `curve` will pulse in\n * thickness. Use a much smaller scale for curve when doing this.\n *\n * NB: When pulsing the thickness of a curve, the end corners of the curve\n * may break through when the arrow heads are small or there is a large curve\n * overlap between curve and arrow head. Use {@link OBJ_AngleArrows} to\n * adjust `curveOverlap` and arrow head size, reduce the thickness scale, or\n * increase the arrow scale to compensate.\n *\n * @property {number | OBJ_Pulse} [curve] (`1.5`)\n * @property {number | OBJ_Pulse} [corner] (`1.5`)\n * @property {number | OBJ_Pulse} [label] (`1.5`)\n * @property {number | OBJ_Pulse} [arrow] (`1.5`)\n * @property {number} [thick] (`1`)\n * @property {number} [duration] in seconds\n * @property {number} [frequency] in Hz\n * @property {TypeWhen} [when] when to start the pulse (`'nextFrame'`)\n * @property {function(): void} [done] execute when pulsing is finished\n */\nexport type OBJ_PulseAngle = {\n  curve?: number | OBJ_Pulse,\n  corner?: number | OBJ_Pulse,\n  label?: number | OBJ_Pulse,\n  arrow?: number | OBJ_Pulse,\n  thick?: number,\n  duration?: number,\n  frequency?: number,\n  when?: TypeWhen,\n  done?: ?() => void,\n};\n\n\n/**\n * {@link CollectionsAngle} options object that extends {@link OBJ_Collection}\n * options object (without `parent`).\n *\n * The Collections Angle is a convient and powerful angle\n * {@link FigureElementCollection} that can draw one or several arcs of an\n * angle annotation, a label, arrows, and the corner of an angle. It also\n * includes some methods to make it convient to use dynamically.\n *\n * There are two ways to define an angle. With a `position`, `startAngle` and\n * `angle`, or with three points. The angle can then be annotated with a curve\n * and a label on either side of the corner using the `direction` property.\n *\n * The first way to define an angle is with `position`, `startAngle` and\n * `angle`. `position` is the location of the vertex of the corner.\n * Two lines join to make a corner, from which an angle annotation can be\n * superimposed. The first line is defined with `startAngle` and the second\n * line defined by `angle` relative to the first line. `angle` can either be\n * positive or negative to define the second line.\n *\n * The second way to define an angle is with three points `p1`, `p2` and `p3`.\n * `p2` is the vertex position of the corner. Line21 is first line of the\n * corner and Line23 is the second.\n *\n * An angle can be annotated with a `curve` (or many multiple curves) and a\n * `label`. `direction` defines which side of the corner the annotations will\n * be drawn. `direction` can either be positive or negative (`1` or `-1`).\n *\n * A positive direction will place the annotations:\n * - on the angle formed between `startAngle` and `angle`\n * - *OR* the angle formed between Line21 and Line23 in the positive rotation\n * direction\n *\n * A negative direction will place the annotations on the other side of the\n * corner.\n *\n * A curve with multiple lines and/or arrows can be defined with `curve`.\n *\n * A label that can be the real angle in degrees or radians, text or an\n * equation can be defined with `label`.\n *\n * The annotations will be placed at some radius from the corner vertex.\n * `offset` can be used to draw the line some offset away from the line\n * definition where a positive offset is on the side of the line that the line\n * rotates toward when rotating in the positive direction.\n *\n * Pulsing this collection normally would pulse the scale of everything.\n * If it often desirable to pulse only parts of the angle in special ways.\n * Therefore this collection provides a method `pulseAngle` to allow this.\n * This options object can define the default values for pulseAngle if desired.\n *\n * @extends OBJ_Collection\n *\n * @property {Point} [position] position of the angle vertex\n * @property {number} [startAngle] rotation where the angle should start\n * @property {number} [angle] size of the angle\n * @property {Point} [p1] alternate way to define startAngle with `p2` and `p3`\n * @property {Point} [p2] alternate way to define position of the angle vertex\n * with `p2` and `p3`\n * @property {Point} [p3] alternate way to define size of angle with `p2` and\n * `p3`\n * @property {1 | -1} [direction] side of the corner the angle annotations\n * reside\n * @property {OBJ_AngleCurve} [curve] options for a curve annotation\n * @property {TypeAngleArrows} [arrow] options for arrow annotations\n * @property {OBJ_AngleCorner} [corner] options for drawing a corner\n * @property {TypeAngleLabelOptions} [label] options for label annotations\n * @property {OBJ_PulseAngle} [pulseAngle] default pulseAngle options\n */\nexport type COL_Angle = {\n  position?: Point,         // Position of angle vertex\n  startAngle?: number,      // Start rotation of angle\n  angle?: number,           // Angle measure\n  p1?: Point,               // Can define angle with p1, p2, p3\n  p2?: Point,               // p2 is angle vertex\n  p3?: Point,               // Curve goes from P21 to P23 anticlockwise\n  direction?: 1 | -1;       // Direction (from P21 to P23, or for angle)\n  curve?: OBJ_AngleCurve,\n  // autoRightAngle?: boolean, // Right angle curve displayed when angle = /2\n  // rightAngleRange?: number, // Range around /2 for right angle curve display\n  arrow: TypeAngleArrows;\n  // Label\n  label?: TypeAngleLabelOptions,\n  corner?: OBJ_AngleCorner,\n  pulseAngle?: OBJ_PulseAngle,\n  //\n  //\n  // Sides - deprecated\n  // side1?: {                 // Define side line at start of angle\n  //   length?: number,        // Side line length\n  //   width?: number,         // Side line width\n  //   color?: TypeColor,  // Side line color\n  // },\n  // side2?: {                 // Define side line at end of angle\n  //   length?: number,\n  //   width?: number,\n  //   color?: TypeColor,\n  // },\n  // sides?: {                 // Define both side lines - overrides side 1 & 2\n  //   length?: number,\n  //   width?: number,\n  //   color?: TypeColor,\n  // },\n  // mods?: {};\n} & OBJ_Collection;\n\n// Angle is a class that manages:\n//   A angle curve\n//   Label\n//   Arrows\n//   Straight Lines\n//\n// The angle collection comprises:\n//   * Positioned at 0, 0 in vertex space\n//   * Curve from 0 to angle size (where 0 is along x axis in vertex space)\n//   * Label in center of curve\n//   * Arrows at ends of curve\n//   * Straight lines forming the corner\n//\n// To give the angle a custom position and rotation from 0, the main class's\n// transform is used:\n//   - Translation for position\n//   - Rotation for rotation\n//\n// An angle can be defined in two ways:\n//   - Angle, rotation, position\n//   - p1, p2, p3\n\n\nclass AngleLabel extends EquationLabel {\n  radius: number;\n  curvePosition: number;\n  offset: number;\n  showRealAngle: boolean;\n  orientation: TypeLabelOrientation;\n  precision: number;\n  units: 'degrees' | 'radians';\n  autoHide: ?number;\n  autoHideMax: ?number;\n  location: 'left' | 'right' | 'top' | 'bottom' | 'outside' | 'inside' | 'positive' | 'negative';\n  subLocation: 'left' | 'right' | 'bottom' | 'top';\n\n  constructor(\n    equation: FigureCollections,\n    labelText: string | Equation | Array<string>,\n    color: TypeColor,\n    radius: number,\n    curvePosition: number = 0.5,     // number where 0 is end1, and 1 is end2\n    offset: number = 0,\n    showRealAngle: boolean = false,\n    units: 'degrees' | 'radians' = 'degrees',\n    precision: number = 0,\n    autoHide: ?number = null,\n    autoHideMax: ?number = null,\n    orientation: TypeLabelOrientation = 'horizontal',\n    location: 'left' | 'right' | 'top' | 'bottom' | 'outside' | 'inside' | 'positive' | 'negative',\n    subLocation: 'left' | 'right' | 'top' | 'bottom',\n    scale: number = 0.7,\n  ) {\n    super(equation, { label: labelText, color, scale });\n    this.radius = radius;\n    this.curvePosition = curvePosition;\n    this.offset = offset;\n    this.showRealAngle = showRealAngle;\n    this.units = units;\n    this.orientation = orientation;\n    this.precision = precision;\n    this.autoHide = autoHide;\n    this.autoHideMax = autoHideMax;\n    this.location = location;\n    this.subLocation = subLocation;\n  }\n}\n\n\n/**\n * These properties are the same as the ones with the same names in\n * {@link COL_Angle}.\n * @property {TypeParsablePoint} [position]\n * @property {number} [startAngle]\n * @property {number} [angle]\n * @property {TypeParsablePoint} [p1]\n * @property {TypeParsablePoint} [p2]\n * @property {TypeParsablePoint} [p3]\n */\nexport type OBJ_AngleSet = {\n  position?: TypeParsablePoint,\n  startAngle?: number,\n  angle?: number,\n  p1?: TypeParsablePoint,\n  p2?: TypeParsablePoint,\n  p3?: TypeParsablePoint,\n}\n\n/**\n * Angle animation step.\n *\n * @property {number} [start] start angle (`current angle`)\n * @property {number} [target] angle to animate to (`current angle`)\n * @extends OBJ_CustomAnimationStep\n */\nexport type OBJ_AngleAnimationStep = {\n  start?: number,\n  target?: number,\n} & OBJ_CustomAnimationStep;\n\n/**\n * Pulse angle animation step - see {@link OBJ_PulseAngle} for desicription of\n * properties.\n * @property {number | OBJ_Pulse} [curve] (`1.5`)\n * @property {number | OBJ_Pulse} [corner] (`1.5`)\n * @property {number | OBJ_Pulse} [label] (`1.5`)\n * @property {number | OBJ_Pulse} [arrow] (`1.5`)\n * @property {number} [thick] (`1`)\n * @property {number} [duration] in seconds\n * @property {number} [frequency] in Hz\n * @extends OBJ_TriggerAnimationStep\n */\nexport type OBJ_PulseAngleAnimationStep = {\n  curve?: number | OBJ_Pulse,\n  corner?: number | OBJ_Pulse,\n  label?: number | OBJ_Pulse,\n  arrow?: number | OBJ_Pulse,\n  thick?: number,\n  duration?: number,\n  frequency?: number,\n} & OBJ_TriggerAnimationStep;\n\n// export type CollectionsAngleAnimationManager =\n/*\n................###....##....##..######...##.......########\n...............##.##...###...##.##....##..##.......##......\n..............##...##..####..##.##........##.......##......\n.............##.....##.##.##.##.##...####.##.......######..\n.............#########.##..####.##....##..##.......##......\n.............##.....##.##...###.##....##..##.......##......\n.............##.....##.##....##..######...########.########\n*/\n\n/**\n * {@link FigureElementCollection} representing an angle.\n *\n * ![](./apiassets/advangle_examples.png)\n *\n * <p class=\"inline_gif\"><img src=\"./apiassets/advangle_grow.gif\" class=\"inline_gif_image\"></p>\n *\n * <p class=\"inline_gif\"><img src=\"./apiassets/advangle_move.gif\" class=\"inline_gif_image\"></p>\n *\n * This object defines a convient and powerful angle\n * {@link FigureElementCollection} that includes one or more curve annotations,\n * arrows, a label annotation that can self align and\n * some methods to make it convient to use dynamically.\n *\n * See {@link COL_Angle} for the options that can be used when creating the\n * angle.\n *\n * The object contains two additional animation steps `angle` and `pulseAngle`\n * that animate a change in angle, and animate a pulsing of the angle\n * respectively. The animation steps are available in\n * the animation manager ({@link FigureElement}.animations),\n * and in the animation builder\n * (<a href=\"#animationmanagernew\">animations.new</a>\n * and <a href=\"#animationmanagerbuilder\">animations.builder</a>).\n *\n * Some of the useful methods included in an collections angle are:\n * - <a href=\"#collectionsanglepulseangle\">pulseAngle</a> - customize pulsing the\n *   angle without\n * - <a href=\"#collectionsanglesetmovable\">setMovable</a> - overrides\n *    <a href=\"#figureelementsetmovable\">FigureElement.setMovable</a> and\n *    allowing for more complex move options.\n *\n *\n * @see See {@link OBJ_AngleAnimationStep} for angle animation step options.\n *\n * See {@link OBJ_PulseAngleAnimationStep} for pulse angle animation step\n * options.\n *\n * To test examples below, append them to the\n * <a href=\"#drawing-boilerplate\">boilerplate</a>.\n *\n * @example\n * // Angle with size label\n * figure.add({\n *   name: 'a',\n *   method: 'collections.angle',\n *   options: {\n *     angle: Math.PI / 4,\n *     label: null,\n *     curve: {\n *       radius: 0.5,\n *       width: 0.01,\n *     },\n *     corner: {\n *       width: 0.01,\n *       length: 1,\n *     },\n *   }\n * });\n *\n * @example\n * // Right angle, created from figure.collections\n * const a = figure.collections.angle({\n *   angle: Math.PI / 2,\n *   curve: {\n *     autoRightAngle: true,\n *     width: 0.01,\n *   },\n *   corner: {\n *     width: 0.01,\n *     length: 1,\n *   },\n * });\n * figure.add('a', a);\n *\n * @example\n * // Multi colored angle with arrows and an equation label\n * figure.add({\n *   name: 'a',\n *   method: 'collections.angle',\n *   options: {\n *     angle: Math.PI / 4 * 3,\n *     label: {\n *       text: {\n *         elements: {\n *           theta: { text: '\\u03b8', color: [1, 0, 1, 1] },\n *         },\n *         forms: {\n *           0: { frac: ['theta', 'vinculum', '2']},\n *         },\n *       },\n *       offset: 0.05,\n *       location: 'inside',\n *       color: [0, 0, 1, 1],\n *     },\n *     curve: {\n *       radius: 0.5,\n *       width: 0.01,\n *     },\n *     arrow: 'barb',\n *     corner: {\n *       width: 0.01,\n *       length: 1,\n *       color: [0, 0.5, 0, 1],\n *     },\n *   }\n * });\n *\n * @example\n * // Multiple curve angle, without corner\n * const a = figure.collections.angle({\n *   angle: Math.PI / 4,\n *   curve: {\n *     num: 3,\n *     step: -0.03,\n *     radius: 0.5,\n *     width: 0.01,\n *   },\n *   label: {\n *     text: 'a',\n *     offset: 0.05,\n *   },\n * });\n * figure.add('a', a);\n *\n * @example\n * // Change angle animation\n * figure.add({\n *   name: 'a',\n *   method: 'collections.angle',\n *   options: {\n *     angle: Math.PI / 4,\n *     label: null,\n *     curve: {\n *       radius: 0.5,\n *       width: 0.01,\n *     },\n *     corner: {\n *       width: 0.01,\n *       length: 1,\n *     },\n *   }\n * });\n * figure.elements._a.animations.new()\n *   .angle({ start: Math.PI / 4, target: Math.PI / 4 * 3, duration: 3 })\n *   .start();\n *\n * @example\n * // Movable angle\n * figure.add({\n *   name: 'a',\n *   method: 'collections.angle',\n *   options: {\n *     angle: Math.PI / 4 * 3,\n *     label: {\n *       text: null,\n *       location: 'outside',\n *       orientation: 'horizontal',\n *       offset: 0.1,\n *       update: true,\n *       sides: 200,\n *     },\n *     curve: {\n *       radius: 0.3,\n *       fill: true,\n *     },\n *     corner: {\n *       width: 0.02,\n *       length: 1,\n *       color: [0.4, 0.4, 0.4, 1],\n *     },\n *   }\n * });\n * figure.elements._a.setMovable({\n *   startArm: 'rotation',\n *   endArm: 'angle',\n *   movePadRadius: 0.3,\n * });\n */\n// $FlowFixMe\nclass CollectionsAngle extends FigureElementCollection {\n  // Figure elements\n  _curve: ?FigureElementPrimitive;\n  _curveRight: ?FigureElementPrimitive;\n  _arrow1: ?FigureElementPrimitive;\n  _arrow2: ?FigureElementPrimitive;\n  _side1: ?FigureElementPrimitive;\n  _side2: ?FigureElementPrimitive;\n  _corner: ?FigureElementPrimitive;\n  _label: ?Equation;\n\n  _anglePad: ?FigureElementPrimitive;\n  _rotPad: ?FigureElementPrimitive;\n  _movePad: ?FigureElementPrimitive;\n\n  label: ?AngleLabel;\n  arrow: ?{\n    start?: OBJ_LineArrow & {\n      radius: number, curveOverlap: number, autoHide: boolean, height: number,\n    },\n    end?: OBJ_LineArrow & {\n      radius: number, curveOverlap: number, autoHide: boolean, height: number,\n    },\n  };\n\n  corner: ?{\n    width: number,\n    length: number,\n    color: TypeColor,\n    style: 'fill' | 'auto' | 'none',\n  };\n\n  side1: ?{ width: number, length: number };\n  side2: ?{ width: number, length: number };\n  curve: ?{\n    width: number,\n    sides: number,\n    radius: number,\n    num: number,\n    step: number,\n    autoHide: ?number,\n    autoHideMax: ?number,\n    autoRightAngle: boolean,\n    rightAngleRange: number,\n  };\n\n  startAngle: number;\n  angle: number;\n  direction: -1 | 1;\n  lastLabelRotationOffset: number;\n  // autoRightAngle: boolean;\n  // rightAngleRange: number;\n\n  // angle properties - pulic read/write\n\n  // angle properties - private internal use only\n  collections: FigureCollections;\n  // equation: Object;\n  isTouchDevice: boolean;\n  largerTouchBorder: boolean;\n\n  nextPosition: ?Point;\n  nextStartAngle: ?number;\n\n  pulseAngleDefaults: {\n    curve: number | OBJ_Pulse,\n    corner: number | OBJ_Pulse,\n    label: number | OBJ_Pulse,\n    arrow: number | OBJ_Pulse,\n    thick: number,\n    duration: number,\n    frequency: number,\n  }\n\n  autoUpdateSubscriptionId: number;\n\n  animations: {\n    pulseAngle: (OBJ_PulseAngle) => animation.TriggerAnimationStep,\n    angle: (OBJ_AngleAnimationStep) => animation.CustomAnimationStep,\n  } & animation.AnimationManager;\n\n  calculateAngleRotationPosition(options: {\n    p1?: TypeParsablePoint,\n    p2?: TypeParsablePoint,\n    p3?: TypeParsablePoint,\n    position?: TypeParsablePoint,\n    startAngle?: number,\n    angle?: number,\n  }) {\n    // console.log(this.lastLabelRotationOffset)\n    const defaultOptions = {\n      angle: 1,\n      startAngle: this.startAngle,\n    };\n    const o = joinObjects({}, defaultOptions, options);\n    let { angle, startAngle, position } = o;\n    if (position != null) {\n      position = getPoint(position);\n    }\n    if (o.p1 != null && o.p2 != null && o.p3 != null) {\n      const p1 = getPoint(o.p1);\n      const p2 = getPoint(o.p2);\n      const p3 = getPoint(o.p3);\n      position = p2._dup();\n      const line21 = new Line(p2, p1);\n      startAngle = line21.angle();\n      angle = threePointAngle(p1, p2, p3);\n    }\n    // this.startAngle = startAngle;\n    this.nextStartAngle = startAngle;\n    if (position != null) {\n      this.nextPosition = position;\n    }\n    this.angle = angle;\n    // this.startAngle = startAngle;\n  }\n\n  /**\n   * @hideconstructor\n   */\n  constructor(\n    collections: FigureCollections,\n    isTouchDevice: boolean,\n    animateNextFrame: void => void,\n    options: COL_Angle = {},\n  ) {\n    const defaultOptions = {\n      position: new Point(0, 0),\n      color: collections.primitives.defaultColor,\n      direction: 1,\n      curve: null,\n      corner: null,\n      sides: null,\n      sideStart: null,\n      sideStop: null,\n      pulseAngle: {\n        curve: 1.5,\n        label: 1.5,\n        arrow: 1.5,\n        side: 1.5,\n        corner: 1.5,\n        thick: 1,\n      },\n      mods: {},\n      transform: new Transform('Angle').scale(1, 1).rotate(0).translate(0, 0),\n      limits: collections.primitives.limits,\n    };\n    const optionsToUse = joinObjects({}, defaultOptions, options);\n\n    super(optionsToUse);\n    this.setColor(optionsToUse.color);\n\n    this.collections = collections;\n    this.largerTouchBorder = optionsToUse.largerTouchBorder;\n    this.isTouchDevice = isTouchDevice;\n    this.autoUpdateSubscriptionId = 0;\n\n    this.lastLabelRotationOffset = 0;\n    if (optionsToUse.direction === 'positive') {\n      this.direction = 1;\n    } else if (optionsToUse.direction === 'negative') {\n      this.direction = -1;\n    } else {\n      this.direction = optionsToUse.direction;\n    }\n\n    this.calculateAngleRotationPosition(optionsToUse);\n    this.setNextPositionAndRotation();\n\n    // Setup default values for sides, arrows, curve and label\n    this.side1 = null;\n    this.side2 = null;\n    this.curve = null;\n    this.label = null;\n\n    // If the curve is to be shown (and not just a label) then make it\n    this._curve = null;\n    if (optionsToUse.curve) {\n      this.addCurve(optionsToUse.curve);\n    }\n\n    // Arrow related properties\n    this._arrow1 = null;\n    this._arrow2 = null;\n    if (optionsToUse.arrow != null) {\n      let width = 0.01;\n      if (this.curve) {\n        width = this.curve.width;\n      }\n      let autoHide = true;\n      if (typeof optionsToUse.arrow !== 'string' && optionsToUse.arrow.autoHide != null) {\n        autoHide = optionsToUse.arrow.autoHide;\n      }\n      let defaultArrowRadius = 0.1;\n      if (this.curve) {\n        defaultArrowRadius = this.curve.radius;\n      }\n      if (typeof optionsToUse.arrow !== 'string' && optionsToUse.arrow.radius != null) {\n        defaultArrowRadius = optionsToUse.arrow.radius;\n      }\n      let curveOverlap = 0.3;\n      if (typeof optionsToUse.arrow !== 'string' && optionsToUse.arrow.curveOverlap != null) {\n        curveOverlap = optionsToUse.arrow.curveOverlap;\n      }\n      const arrowOptions = simplifyArrowOptions(optionsToUse.arrow, width);\n      // $FlowFixMe\n      this.arrow = arrowOptions;\n      if (this.arrow == null) {\n        return;\n      }\n\n      const defaultO = {\n        radius: defaultArrowRadius,\n        autoHide,\n        curveOverlap,\n      };\n\n      if (this.arrow.start != null) { // $FlowFixMe\n        this.arrow.start = joinObjects({}, defaultO, this.arrow.start);\n      }\n      if (this.arrow.end != null) { // $FlowFixMe\n        this.arrow.end = joinObjects({}, defaultO, this.arrow.end);\n      }\n      this.addArrow('start');\n      this.addArrow('end');\n    }\n\n    // Label\n    if (optionsToUse.label || optionsToUse.label === null) {\n      if (optionsToUse.label === null) {\n        optionsToUse.label = { text: null };\n      }\n      if (typeof optionsToUse.label === 'string') {\n        optionsToUse.label = { text: optionsToUse.label };\n      }\n      this.addLabel(optionsToUse.label);\n    }\n\n    // Sides\n    let defaultSideLength = 0.5;\n    if (this.curve) {\n      defaultSideLength = this.curve.radius * 2;\n    }\n    let defaultSideWidth = 0.01;\n    if (this.curve) {\n      defaultSideWidth = this.curve.width;\n    }\n    const defaultSideOptions = {\n      length: defaultSideLength,\n      width: defaultSideWidth,\n      color: this.color,\n    };\n    if (optionsToUse.side1) {\n      const sideOptions = joinObjects({}, defaultSideOptions, optionsToUse.side1);\n      this.addSide(1, sideOptions.length, sideOptions.width, sideOptions.color);\n    }\n\n    if (optionsToUse.side2) {\n      const sideOptions = joinObjects({}, defaultSideOptions, optionsToUse.side2);\n      this.addSide(2, sideOptions.length, sideOptions.width, sideOptions.color);\n    }\n\n    if (optionsToUse.corner != null) {\n      const cornerOptions = joinObjects(\n        {}, defaultSideOptions, { style: 'fill' }, optionsToUse.corner,\n      );\n      this.addCorner(cornerOptions);\n    }\n\n    // Sides overrides side1 and side2\n    if (optionsToUse.sides) {\n      let sides = {};\n      if (typeof optionsToUse.sides === 'object') {\n        ({ sides } = optionsToUse);\n      }\n      const sideOptions = joinObjects({}, defaultSideOptions, sides);\n      this.addSide(1, sideOptions.length, sideOptions.width, sideOptions.color);\n      this.addSide(2, sideOptions.length, sideOptions.width, sideOptions.color);\n    }\n\n    this.pulseAngleDefaults = {\n      curve: optionsToUse.pulseAngle.curve || 1.5,\n      corner: optionsToUse.pulseAngle.corner || 1.5,\n      label: optionsToUse.pulseAngle.label || 1.5,\n      arrow: optionsToUse.pulseAngle.arrow || 1.5,\n      duration: optionsToUse.pulseAngle.duration || 1.5,\n      frequency: optionsToUse.pulseAngle.frequency || 0,\n      thick: optionsToUse.pulseAngle.thick || 1,\n    };\n\n    this.animations.angle = (...opt) => {\n      const o = joinObjects({}, {\n        element: this,\n      }, ...opt);\n      let target;\n      let start;\n      let toSetup = true;\n      o.callback = (percentage) => {\n        if (toSetup) {\n          if (o.start == null) {\n            start = this.angle;\n          } else {\n            ({ start } = o);\n          }\n          if (o.target == null) {\n            target = this.angle;\n          } else {\n            ({ target } = o);\n          }\n          toSetup = false;\n        }\n        const a = (target - start) * percentage + start;\n        this.setAngle({ angle: a });\n      };\n      return new animation.CustomAnimationStep(o);\n    };\n\n    this.animations.customSteps.push({\n      step: this.animations.angle.bind(this),\n      name: 'angle',\n    });\n\n    this.animations.pulseAngle = (...opt) => {\n      const o = joinObjects({}, {\n        element: this,\n        duration: 1,\n      }, ...opt);\n      o.callback = () => {\n        this.pulseAngle({\n          curve: o.curve,\n          label: o.label,\n          arrow: o.arrow,\n          corner: o.corner,\n          duration: o.duration,\n          frequency: o.frequency,\n          thick: o.thick,\n        });\n      };\n      return new animation.TriggerAnimationStep(o);\n    };\n\n    this.animations.customSteps.push({\n      step: this.animations.pulseAngle.bind(this),\n      name: 'pulseAngle',\n    });\n\n    this.update();\n    if (optionsToUse.mods != null && optionsToUse.mods !== {}) {\n      this.setProperties(optionsToUse.mods);\n    }\n  }\n\n  _getStateProperties(options: Object) {  // eslint-disable-line class-methods-use-this\n    return [...super._getStateProperties(options),\n      'angle',\n      'lastLabelRotationOffset',\n    ];\n  }\n\n  _fromState(state: Object) {\n    joinObjects(this, state);\n    this.setAngle({\n      angle: this.angle,\n      rotationOffset: this.lastLabelRotationOffset,\n    });\n    return this;\n  }\n\n  /**\n   * Turn on and off auto label location and orientation updates when angle\n   * transform changes. When an angle is created with a label, auto update\n   * is turned off by default.\n   *\n   * Manual updates can be performed with\n   * <a href=\"collectionsangle#udpatelabel\">updateLabel</a>\n   */\n  setAutoUpdate(update: boolean = true) {\n    if (update) {\n      this.autoUpdateSubscriptionId = this.subscriptions.add('setTransform', () => {\n        this.updateLabel(this.getRotation());\n        // this.updateMovePads();\n      });\n    } else {\n      this.subscriptions.remove('setTransform', this.autoUpdateSubscriptionId);\n      this.autoUpdateSubscriptionId = -1;\n    }\n  }\n\n  setNextPositionAndRotation() {\n    if (this.nextPosition != null) {\n      this.transform.updateTranslation(this.nextPosition);\n    }\n    if (this.nextStartAngle != null) {\n      this.transform.updateRotation(this.nextStartAngle);\n      this.startAngle = this.nextStartAngle || 0;\n    }\n    this.nextPosition = null;\n    this.nextStartAngle = null;\n  }\n\n  /**\n   * Set the angle. The same direction and angle sign must be used as when\n   * originally defined.\n   */\n  setAngle(options: OBJ_AngleSet = {}) {\n    this.calculateAngleRotationPosition(options);\n    const { corner, _corner } = this;\n    if (corner != null && _corner != null) {\n      const points = this.getCornerPoints(corner.length);\n      _corner.custom.updatePoints({ points });\n    }\n    this.update();\n  }\n\n  getCornerPoints(length: number) {\n    return [\n      new Point(length, 0),\n      new Point(0, 0),\n      new Point(length * Math.cos(this.angle), length * Math.sin(this.angle)),\n    ];\n  }\n\n  addCorner(options: {\n    length: number,\n    width: number,\n    color: TypeColor,\n    style: 'fill' | 'auto' | 'none',\n  }) {\n    const {\n      width, color, length, style,\n    } = options;\n    const corner = this.collections.primitives.polyline({\n      width,\n      color,\n      points: this.getCornerPoints(length),\n      cornerStyle: style,\n    });\n    this.corner = {\n      length, width, color, style,\n    };\n    this.add('corner', corner);\n  }\n\n  addSide(\n    index: 1 | 2,\n    length: number | null = null,\n    width: number | null = null,\n    color: TypeColor = this.color,\n  ) {\n    const line = this.collections.primitives.line({\n      length: 1,\n      width,\n      angle: 0,\n      color,\n      transform: new Transform().scale(1, 1).rotate(0),\n    });\n    // $FlowFixMe\n    this[`side${index}`] = { length, width };\n    this.add(`side${index}`, line);\n  }\n\n  addLabel(options: TypeAngleLabelOptions = {}) {\n    const defaultLabelOptions = {\n      text: null,\n      radius: 0.4,\n      curvePosition: 0.5,\n      offset: 0.0001,\n      showRealAngle: false,\n      units: 'degrees',\n      precision: 0,\n      orientation: 'horizontal',\n      autoHide: null,\n      autoHideMax: null,\n      scale: 0.7,\n      color: this.color,\n      location: 'outside',\n      update: false,\n    };\n    if (this.curve) {\n      defaultLabelOptions.radius = Math.max(\n        this.curve.radius,\n        this.curve.radius + (this.curve.num - 1) * this.curve.step,\n      );\n    }\n\n    const optionsToUse = joinObjects({}, defaultLabelOptions, options);\n    if (optionsToUse.text === null) {\n      optionsToUse.text = '';\n      optionsToUse.showRealAngle = true;\n    }\n    this.label = new AngleLabel(\n      this.collections,\n      optionsToUse.text,\n      optionsToUse.color,\n      optionsToUse.radius,\n      optionsToUse.curvePosition,\n      optionsToUse.offset,\n      optionsToUse.showRealAngle,\n      optionsToUse.units,\n      optionsToUse.precision,\n      optionsToUse.autoHide,\n      optionsToUse.autoHideMax,\n      optionsToUse.orientation,\n      optionsToUse.location,\n      optionsToUse.subLocation,\n      optionsToUse.scale,\n    );\n    this.label.eqn.initialForm = null;\n    if (optionsToUse.isTouchable != null) {\n      this.label.eqn.isTouchable = optionsToUse.isTouchable;\n    }\n    if (optionsToUse.touchBorder != null) {\n      this.label.eqn.touchBorder = optionsToUse.touchBorder;\n    }\n    if (optionsToUse.onClick != null) {\n      this.label.eqn.onClick = optionsToUse.onClick;\n    }\n    if (this.label != null) {\n      this.add('label', this.label.eqn);\n    }\n    this.setAutoUpdate(optionsToUse.update);\n    this.updateLabel();\n  }\n\n  addCurve(curveOptions: {\n    width?: number,\n    sides?: number,\n  } = {}) {\n    const defaultCurveOptions = {\n      width: 0.01,\n      sides: 100,\n      radius: 0.5,\n      num: 1,\n      fill: false,\n      step: 0,\n      autoHide: null,\n      autoHideMax: null,\n      autoRightAngle: false,\n      rightAngleRange: 1 / 180 * Math.PI,\n    };\n    const optionsToUse = joinObjects(\n      {}, defaultCurveOptions, curveOptions,\n    );\n\n    let { direction } = this;\n    if (this.angle < 0 && this.direction === -1) {\n      direction = 1;\n    } else if (this.angle < 0 && this.direction === 1) {\n      direction = -1;\n    }\n\n    for (let i = 0; i < optionsToUse.num; i += 1) {\n      const o = {\n        sides: optionsToUse.sides,\n        radius: optionsToUse.radius + i * optionsToUse.step,\n        color: this.color,\n        direction,\n        transform: new Transform('AngleCurve').rotate(0),\n        // dash: optionsToUse.dash,\n      };\n      if (optionsToUse.fill === false) {  // $FlowFixMe\n        o.line = {\n          width: optionsToUse.width,\n          // dash: optionsToUse.dash,\n        };\n      }\n\n      const curve = this.collections.primitives.polygon(o);\n      this.curve = optionsToUse;\n      let name = 'curve';\n      if (i > 0) {\n        name = `${name}${i}`;\n      }\n      this.add(name, curve);\n    }\n\n    // Right Angle\n    if (this.curve != null && this.curve.autoRightAngle) {\n      const right = this.collections.collection();\n      const rightLength = optionsToUse.radius * 0.707; // / Math.sqrt(2);\n      right.add('line1', this.collections.primitives.line({\n        p1: [rightLength, 0],\n        length: rightLength + optionsToUse.width / 2,\n        width: optionsToUse.width,\n        angle: Math.PI / 2 * direction,\n        color: this.color,\n      }));\n      right.add('line2', this.collections.primitives.line({\n        p1: [0, rightLength * direction],\n        length: rightLength + optionsToUse.width / 2,\n        width: optionsToUse.width,\n        angle: 0,\n        color: this.color,\n      }));\n      this.add('curveRight', right);\n    }\n  }\n\n  change(options: {\n    radius?: number,\n    curveRadius?: number,\n    curvePosition?: number,\n    offset?: number,\n  }) {\n    if (this._curve != null && options.radius != null) {\n      this._curve.custom.update({ radius: options.radius });\n    }\n    if (this.label != null) {\n      if (options.curveRadius != null) {\n        this.label.radius = options.curveRadius;\n      }\n      if (options.curvePosition != null) {\n        this.label.curvePosition = options.curvePosition;\n      }\n      if (options.offset != null) {\n        this.label.offset = options.offset;\n      }\n    }\n  }\n\n\n  addArrow(\n    lineEnd: 'start' | 'end',\n  ) {\n    // $FlowFixMe\n    if (this.arrow[lineEnd] == null) {\n      return;\n    }\n    const o = this.arrow[lineEnd];\n    const a = this.collections.primitives.arrow(joinObjects(\n      {},\n      o,\n      {\n        // angle: r,\n        color: this.color,\n        transform: new Transform().rotate(0).translate(0, 0),\n      },\n    ));\n    // $FlowFixMe\n    const arrowLength = getArrowLength(o)[1];\n    let index = 1;\n    if (lineEnd === 'end') {\n      index = 2;\n    }\n    // $FlowFixMe\n    this.arrow[lineEnd] = {\n      height: arrowLength,\n      radius: o.radius || 0,\n      autoHide: o.autoHide,\n      curveOverlap: o.curveOverlap,\n    };\n    this.add(`arrow${index}`, a);\n    this.update();\n  }\n\n  updateCurve(primaryCurveAngle: number, angle: number, rotation: number, show: boolean) {\n    const { curve } = this;\n    if (curve) {\n      let { direction } = this;\n      if (this.angle < 0 && this.direction === -1) {\n        direction = 1;\n      } else if (this.angle < 0 && this.direction === 1) {\n        direction = -1;\n      }\n      let r = rotation;\n      if (this.direction === -1) {\n        r *= -1;\n      }\n      if (this.angle < 0) {\n        r *= -1;\n      }\n      for (let i = 0; i < curve.num; i += 1) {\n        let name = '_curve';\n        if (i > 0) {\n          name = `_curve${i}`;\n        }\n        // $FlowFixMe\n        const element = this[name];\n        // console.log(element)\n        if (element) {\n          if (show) {\n            element.show();\n            if (i === 0) {\n              let delta = 0;\n              if (this.curve) {\n                const sideAngle = 2 * Math.PI / this.curve.sides;\n                const numSides = Math.floor(roundNum(primaryCurveAngle / sideAngle));\n                delta = primaryCurveAngle - numSides * sideAngle;\n              }\n              element.angleToDraw = clipAngle(primaryCurveAngle, '0to360');\n              element.transform.updateRotation(r + direction * delta / 2);\n            } else {\n              let delta = 0;\n              if (this.curve) {\n                delta = angle % (2 * Math.PI / this.curve.sides);\n              }\n              element.angleToDraw = clipAngle(angle, '0to360');\n              element.transform.updateRotation(direction * delta / 2);\n            }\n          } else {\n            element.hide();\n          }\n        }\n      }\n    }\n  }\n\n  update(labelRotationOffset: number | null = null) {\n    const { _arrow1 } = this;\n    const { _arrow2 } = this;\n    let arrow1Hide = false;\n    let arrow2Hide = false;\n\n    let rotationForArrow1 = 0;\n    let fullCurveAngle = clipAngle(this.angle, '-360to360');\n    if (fullCurveAngle >= 0 && this.direction === -1) {\n      fullCurveAngle = Math.PI * 2 - fullCurveAngle;\n    } else if (fullCurveAngle < 0 && this.direction === 1) {\n      fullCurveAngle = Math.abs(fullCurveAngle);\n    } else if (fullCurveAngle < 0 && this.direction === -1) {\n      fullCurveAngle = Math.PI * 2 - Math.abs(fullCurveAngle);\n    }\n    let curveAngle = fullCurveAngle;\n    let trueCurveAngle = fullCurveAngle;\n    // const arrow2LengthModifier = 0.5;\n    // const arrowLengthMod = 0.9;\n\n    let arrow1Angle = 0;\n    let arrow2Angle = 0;\n    if (this.arrow != null && this.arrow.start != null) {\n      const { start } = this.arrow;\n      const radius = start.radius || 0;\n      arrow1Angle = start.height / radius * (1 - start.curveOverlap);\n      curveAngle -= arrow1Angle;\n      trueCurveAngle -= start.height / radius;\n    }\n    if (this.arrow != null && this.arrow.end != null) {\n      const { end } = this.arrow;\n      const radius = end.radius || 0;\n      arrow2Angle = end.height / radius * (1 - end.curveOverlap);\n      curveAngle -= arrow2Angle;\n      trueCurveAngle -= end.height / radius;\n    }\n\n    if (this.arrow != null && trueCurveAngle < 0) {\n      if (this.arrow.start != null && this.arrow.start.autoHide) {\n        const radius = this.arrow.start.radius || 0;\n        arrow1Hide = true;\n        trueCurveAngle += this.arrow.start.height / radius;\n        curveAngle += arrow1Angle;\n      }\n      if (this.arrow.end != null && this.arrow.end.autoHide) {\n        const radius = this.arrow.end.radius || 0;\n        arrow2Hide = true;\n        trueCurveAngle += this.arrow.end.height / radius;\n        curveAngle += arrow2Angle;\n      }\n    }\n\n    if (_arrow1 && this.arrow != null && this.arrow.start != null) {\n      if (arrow1Hide) {\n        _arrow1.hide();\n      } else {\n        _arrow1.show();\n        // $FlowFixMe\n        _arrow1.transform.updateTranslation(this.arrow.start.radius, 0);\n        // $FlowFixMe\n        const arrowLengthAngle = this.arrow.start.height / this.arrow.start.radius;\n        let curveToLine;    // $FlowFixMe\n        const radius = this.arrow.start.radius || 0;\n        if (\n          (this.angle > 0 && this.direction === 1)\n          || (this.angle < 0 && this.direction === -1)\n        ) {\n          curveToLine = new Line(\n            polarToRect(radius, arrowLengthAngle), [radius, 0],\n          ).angle();\n        } else {\n          curveToLine = new Line(\n            polarToRect(radius, -arrowLengthAngle), [radius, 0],\n          ).angle();\n        }\n        _arrow1.transform.updateRotation(curveToLine);\n        rotationForArrow1 = arrow1Angle;\n      }\n    }\n\n    if (_arrow2 && this.arrow != null && this.arrow.end != null) {\n      if (arrow2Hide) {\n        _arrow2.hide();\n      } else {\n        _arrow2.show();\n        // $FlowFixMe\n        _arrow2.transform.updateTranslation(polarToRect(this.arrow.end.radius, this.angle));\n        // $FlowFixMe\n        const arrowLengthAngle = this.arrow.end.height / this.arrow.end.radius;\n        let curveToLine;    // $FlowFixMe\n        const radius = this.arrow.start.radius || 0;\n        if (\n          (this.angle > 0 && this.direction === 1)\n          || (this.angle > 0 && this.direction === -1)\n        ) {\n          curveToLine = new Line(\n            polarToRect(radius, this.angle - this.direction * arrowLengthAngle),\n            polarToRect(radius, this.angle),\n          ).angle();\n        } else {\n          curveToLine = new Line(\n            polarToRect(radius, this.angle + this.direction * arrowLengthAngle),\n            polarToRect(radius, this.angle),\n          ).angle();\n        }\n        _arrow2.transform.updateRotation(curveToLine);\n        rotationForArrow1 = arrow1Angle;\n      }\n    }\n\n    if (labelRotationOffset != null) {\n      this.lastLabelRotationOffset = labelRotationOffset;\n    }\n\n    this.setNextPositionAndRotation();\n\n    const { _curve, curve, _curveRight } = this;\n    if (_curve != null && curve != null) {\n      if (\n        (curve.autoHide != null && fullCurveAngle < curve.autoHide)\n        || (curve.autoHideMax != null && fullCurveAngle > curve.autoHideMax)\n      ) {\n        if (_curveRight != null) {\n          _curveRight.hide();\n        }\n        _curve.hide();\n        if (_arrow1 != null) {\n          _arrow1.hide();\n        }\n        if (_arrow2 != null) {\n          _arrow2.hide();\n        }\n      } else if (\n        curve != null\n        && curve.autoRightAngle\n        && fullCurveAngle >= Math.PI / 2 - curve.rightAngleRange / 2\n        && fullCurveAngle <= Math.PI / 2 + curve.rightAngleRange / 2\n      ) {\n        if (_curveRight != null) {\n          _curveRight.showAll();\n        }\n        _curve.hide();\n        if (_arrow1 != null) {\n          _arrow1.hide();\n        }\n        if (_arrow2 != null) {\n          _arrow2.hide();\n        }\n      } else {\n        if (_curveRight != null) {\n          _curveRight.hide();\n        }\n        if (_arrow1 != null && arrow1Hide === false) {\n          _arrow1.show();\n        }\n        if (_arrow2 != null && arrow2Hide === false) {\n          _arrow2.show();\n        }\n        // _curve.show();\n        curveAngle = Math.max(curveAngle, 0);\n        // _curve.angleToDraw = curveAngle;\n        // _curve.transform.updateRotation(rotationForArrow1);\n        this.updateCurve(curveAngle, fullCurveAngle, rotationForArrow1, true);\n      }\n    }\n    this.updateLabel();\n\n    const { _side1, side1 } = this;\n    if (_side1 && side1) {\n      // _side1.transform.updateRotation(this.rotation);\n      _side1.transform.updateScale(side1.length, 1);\n    }\n\n    const { _side2, side2 } = this;\n    if (_side2 && side2) {\n      _side2.transform.updateRotation(this.angle);\n      _side2.transform.updateScale(side2.length, 1);\n    }\n\n    this.updateMovePads();\n  }\n\n  checkLabelForRightAngle() {\n    if (this.curve != null && this.curve.autoRightAngle === false) {\n      return;\n    }\n    const { label } = this;\n    let setRight = false;\n    if (label != null) {\n      const angle = parseFloat(label.getText());\n      if (angle === 90) {\n        setRight = true;\n      }\n    }\n    if (setRight === false) {\n      return;\n    }\n    const {\n      _curveRight, _curve, _arrow1, _arrow2,\n    } = this;\n    if (_curveRight != null) {\n      _curveRight.showAll();\n    }\n    if (_curve != null) {\n      _curve.hide();\n    }\n    if (_arrow1 != null) {\n      _arrow1.hide();\n    }\n    if (_arrow2 != null) {\n      _arrow2.hide();\n    }\n  }\n\n  /**\n   * Get the current angle in degrees or radians\n   */\n  getAngle(units: 'deg' | 'rad' = 'rad') {\n    if (units === 'deg') {\n      return this.angle * 180 / Math.PI;\n    }\n    return this.angle;\n  }\n\n  /**\n   * Set the label text\n   */\n  setLabel(text: string) {\n    const { label } = this;\n    if (label != null) {\n      label.setText(text);\n      label.showRealAngle = false;\n    }\n    this.updateLabel();\n  }\n\n  /**\n   * Get the label text\n   */\n  getLabel() {\n    if (this.label != null) {\n      return this.label.getText();\n    }\n    return '';\n  }\n\n  /**\n   * Set the label to be the real angle\n   */\n  setLabelToRealAngle() {\n    const { label } = this;\n    if (label != null) {\n      label.showRealAngle = true;\n    }\n    this.updateLabel();\n  }\n\n  /**\n   * Manually update the label orientations with a custom rotation offset.\n   *\n   * Automatic updating can be done with\n   * <a href=\"collectionsangle#setautoupdate\">setAutoUpdate</a>\n   * @param {number | null} rotationOffset\n   */\n  updateLabel(rotationOffset: ?number = this.getRotation()) {\n    if (rotationOffset != null) {\n      this.lastLabelRotationOffset = rotationOffset;\n    }\n    const { _label, label } = this;\n    if (_label && label) {\n      if (\n        (label.autoHide != null && label.autoHide > Math.abs(this.angle)) // $FlowFixMe\n        || (label.autoHideMax != null && Math.abs(this.angle) > label.autoHideMax)\n      ) {\n        _label.hide();\n      } else {\n        _label.show();\n        if (label.showRealAngle) {\n          let { angle } = this;\n          if (angle >= 0 && this.direction === -1) {\n            angle = -(Math.PI * 2 - Math.abs(angle));\n          } else if (angle < 0 && this.direction === -1) {\n            angle = Math.PI * 2 - Math.abs(angle);\n          }\n          // angle = clipAngle(angle, this.clip);\n          angle = Math.abs(angle);\n          let angleText = roundNum(angle, label.precision)\n            .toFixed(label.precision);\n          if (label.units === 'degrees') {\n            let a = roundNum(angle * 180 / Math.PI, label.precision);\n            if (a === 360) {\n              a = 0;\n            }\n            angleText = a.toFixed(label.precision);\n            angleText = `${angleText}\\u00b0`;\n          }\n          label.setText(angleText);\n        }\n        let angle = clipAngle(this.angle, '-360to360');\n        let lineOffsetAngle = Math.PI / 2;\n        if (angle < 0) {\n          lineOffsetAngle = -Math.PI / 2;\n        }\n        if (angle >= 0 && this.direction === -1) {\n          angle = -(Math.PI * 2 - angle);\n        } else if (angle < 0 && this.direction === -1) {\n          angle = Math.PI * 2 - Math.abs(angle);\n        }\n        let labelPosition = polarToRect(\n          label.radius, angle * label.curvePosition,\n        );\n        let { orientation, location } = label;\n        if (orientation === 'tangent') {\n          orientation = 'baseToLine';\n        }\n        if (location === 'outside') {\n          location = 'negative';\n          if (this.direction === -1) {\n            location = 'positive';\n          }\n        }\n        if (location === 'inside') {\n          location = 'positive';\n          if (this.direction === -1) {\n            location = 'negative';\n          }\n        }\n        let lineAngle = clipAngle(clipAngle(angle, '0to360') * label.curvePosition + lineOffsetAngle, '0to360');\n        if (location === 'start') {\n          labelPosition = new Point(label.radius, 0);\n          lineAngle = 0;\n        }\n        if (location === 'end') {\n          labelPosition = polarToRect(\n            label.radius, angle,\n          );\n          lineAngle = clipAngle(angle, '0to360');\n        }\n        label.updateRotation(\n          labelPosition, lineAngle, label.offset, location, label.subLocation, orientation,\n          this.lastLabelRotationOffset == null ? 0 : this.lastLabelRotationOffset,\n          'oval', false, Math.PI / 2, -Math.PI / 2,\n        );\n      }\n    }\n  }\n\n  /**\n   * Pulse the angle where each element can be pulsed in a custom way.\n   *\n   * The pulse scales of the curve, label, corner and arrows can all be defined\n   * separately.\n   */\n  pulseAngle(options?: OBJ_PulseAngle = {}) {\n    const defaultOptions = {\n      curve: this.pulseAngleDefaults.curve,\n      label: this.pulseAngleDefaults.label,\n      arrow: this.pulseAngleDefaults.arrow,\n      corner: this.pulseAngleDefaults.corner,\n      done: null,\n      duration: this.pulseAngleDefaults.duration,\n      frequency: this.pulseAngleDefaults.frequency,\n      when: 'nextFrame',\n      thick: this.pulseAngleDefaults.thick,\n    };\n    const p = this.getPosition('figure');\n    const o = joinObjects(defaultOptions, options);\n    let { done } = o;\n    const pulse = (elementName, oName, oScale, oThick) => {\n      const element = this.elements[elementName];\n      if (element != null && element.isShown) {\n        let pulseOptions;\n        const defaultThick = joinObjects({ num: o.thick }, o.thick > 1 ? oThick : oScale);\n        if (typeof o[oName] === 'number') {\n          pulseOptions = joinObjects(\n            {}, defaultThick, o, { scale: o[oName], callback: done },\n          );\n        } else {\n          pulseOptions = joinObjects(\n            {}, defaultThick, o, o[oName], { callback: done },\n          );\n        }\n        if (pulseOptions.num > 1 && pulseOptions.min == null) {\n          pulseOptions.min = 1 / pulseOptions.scale;\n        }\n        element.pulse(pulseOptions);\n        done = null;\n      }\n    };\n    if (this._curve != null) {\n      pulse('curve', 'curve', {}, {});\n    }\n    if (this._curveRight != null) {\n      pulse('curveRight', 'curve', {}, {});\n    }\n    if (this.corner != null && this._corner != null) {\n      // const cornerLength = this.corner.length || 0;\n      pulse(\n        'corner', 'corner',\n        { centerOn: p },\n        {\n          centerOn: p,\n          num: 1,\n        },\n      );\n    }\n    pulse('label', 'label', { centerOn: p }, { num: 1 });\n    if (this.arrow != null) {\n      if (this._arrow1 != null) {\n        pulse(\n          'arrow1', 'arrow',\n          { centerOn: p },\n          { centerOn: this._arrow1.getPosition('figure'), num: 1 },\n        );\n      }\n      if (this._arrow2 != null) {\n        pulse(\n          'arrow2', 'arrow',\n          { centerOn: p },\n          { centerOn: this._arrow2.getPosition('figure'), num: 1 },\n        );\n      }\n    }\n    this.animateNextFrame();\n  }\n\n  showAll() {\n    super.showAll();\n    this.update();\n  }\n\n  /**\n   * Use this method to enable or disable movability of the line.\n   *\n   * @param {OBJ_MovableAngle | boolean} [movableOrOptions] `true` to\n   * make movable, `false` to make not movable or use options to\n   * set different kinds of movability.\n   */\n  // $FlowFixMe\n  setMovable(movableOrOptions: boolean | OBJ_MovableAngle) {\n    const defaultOptions = {\n      movable: true,\n      type: this.move.type,\n      width: 0.5,\n      movePadRadius: 0,\n      startArm: null,\n      endArm: null,\n    };\n    let options;\n    if (movableOrOptions === false) {\n      options = joinObjects({}, defaultOptions, { movable: false });\n    } else if (movableOrOptions === true) {\n      options = defaultOptions;\n    } else {\n      options = joinObjects({}, defaultOptions, movableOrOptions);\n    }\n    const {\n      movable, startArm, endArm, movePadRadius, width,\n    } = options;\n    if (movable) {\n      if (startArm != null && endArm != null) {\n        if (startArm === 'rotation') {\n          this.addRotPad(1 - movePadRadius, width, 'rotation');\n        }\n        if (endArm === 'rotation') {\n          this.addAnglePad(1 - movePadRadius, width, 'rotation');\n        }\n        if (startArm === 'angle') {\n          this.addRotPad(1 - movePadRadius, width, 'angle');\n        }\n        if (endArm === 'angle') {\n          this.addAnglePad(1 - movePadRadius, width, 'angle');\n        }\n      } else if (startArm != null) {\n        this.addRotPad(1 - movePadRadius, width, startArm);\n      } else if (endArm != null) {\n        this.addAnglePad(1 - movePadRadius, width, endArm);\n      }\n      if (movePadRadius > 0) {\n        this.addMovePad(movePadRadius);\n      }\n    } else {\n      this.isMovable = false;\n      this.isTouchable = false;\n      if (this._anglePad != null) {\n        this._anglePad.setMovable(false);\n      }\n      if (this._rotPad != null) {\n        this._rotPad.setMovable(false);\n      }\n    }\n    this.updateMovePads();\n  }\n\n  getLength() {\n    if (this.corner != null && this.corner.length != null) {\n      return this.corner.length;\n    }\n    if (this.curve != null && this.curve.radius != null) {\n      return this.curve.radius;\n    }\n    if (this.label != null && this.label.radius != null) {\n      return this.label.radius;\n    }\n    return 1;\n  }\n\n  addAnglePad(percentLength: number = 1, width: number = 0.5, type: 'rotation' | 'angle') {\n    if (this._anglePad == null) {\n      const length = this.getLength();\n      const anglePad = this.collections.primitives.rectangle({\n        offset: [length * (1 - percentLength), 0],\n        // position: [length * (1 - percentLength), 0],\n        xAlign: 'left',\n        yAlign: 'middle',\n        width: length * percentLength + width,\n        height: width,\n        color: [0, 0, 1, 0],\n        border: [[]],\n        touchBorder: 'buffer',\n      });\n      this.add('anglePad', anglePad);\n      anglePad.setMovable();\n      anglePad.move.type = 'rotation';\n      anglePad.drawingObject.border = [[]];\n      if (type === 'rotation') {\n        // anglePad.move.element = this;\n        anglePad.subscriptions.add('beforeSetTransform', (transformToSet) => {\n          const nextR = transformToSet[0].r();\n          const currentR = anglePad.getRotation();\n          const deltaR = nextR - currentR;\n          this.transform.updateRotation(this.getRotation() + deltaR);\n          anglePad.cancelSetTransform = true;\n        });\n      } else {\n        anglePad.subscriptions.add('setTransform', () => {\n          let angle = anglePad.getRotation();\n          if (this.angle > 0) {\n            angle = clipAngle(angle, '0to360');\n          } else {\n            angle = clipAngle(angle, '-360to0');\n          }\n          this.setAngle({ angle });\n        });\n      }\n    }\n  }\n\n  addRotPad(percentLength: number = 1, width: number = 0.5, type: 'rotation' | 'angle') {\n    if (this._rotPad == null) {\n      const length = this.getLength();\n      const rotPad = this.collections.primitives.rectangle({\n        xAlign: 'left',\n        yAlign: 'middle',\n        width: length * percentLength + width,\n        height: width,\n        color: [1, 0, 1, 0],\n        offset: [length * (1 - percentLength), 0],\n        border: [[]],\n        touchBorder: 'buffer',\n      });\n      this.add('rotPad', rotPad);\n      rotPad.setMovable();\n      rotPad.move.type = 'rotation';\n      rotPad.drawingObject.border = [[]];\n      // rotPad.touchBorder = 'drawBuffer';\n      if (type === 'angle') {\n        rotPad.move.element = this;\n        this.subscriptions.add('beforeSetTransform', (transformToSet) => {\n          // $FlowFixMe\n          const nextR = transformToSet[0].r();\n          const currentR = this.getRotation();\n          const deltaR = nextR - currentR;\n          let angle = this.angle - deltaR;\n          if (this.angle > 0) {\n            angle = clipAngle(angle, '0to360');\n          } else {\n            angle = clipAngle(angle, '-360to0');\n          }\n          this.setAngle({ angle });\n        });\n      } else {\n        rotPad.move.element = this;\n      }\n    }\n  }\n\n  addMovePad(percentLength: number = 1) {\n    if (this._movePad == null) {\n      const length = this.getLength();\n      const movePad = this.collections.primitives.polygon({\n        radius: length * percentLength,\n        sides: 8,\n        fill: true,\n        color: [1, 0, 0, 0],\n        border: [[]],\n        touchBorder: 'buffer',\n      });\n      this.add('movePad', movePad);\n      movePad.setMovable();\n      movePad.move.type = 'translation';\n      movePad.drawingObject.border = [[]];\n      movePad.move.element = this;\n    }\n  }\n\n  updateMovePads() {\n    if (this._anglePad != null) {\n      this._anglePad.transform.updateRotation(this.angle);\n    }\n  }\n}\n\nexport default CollectionsAngle;\n\nexport type TypeLabelledAngle = {\n  _curve: FigureElementPrimitive;\n  _label: {\n    _base: FigureElementPrimitive;\n  } & Equation;\n} & CollectionsAngle;\n\n","// @flow\n\n// import Figure from '../Figure';\nimport {\n  Transform, Point,\n  getPoint, // getTransform,\n} from '../../tools/g2';\nimport type { TypeParsablePoint } from '../../tools/g2';\nimport {\n  round, range,\n} from '../../tools/math';\nimport { joinObjects } from '../../tools/tools';\nimport {\n  FigureElementCollection, FigureElementPrimitive,\n} from '../Element';\nimport type {\n  OBJ_Font, OBJ_Font_Fixed, TypeDash,\n} from '../../tools/types';\nimport type {\n  OBJ_Line, OBJ_TextLines, OBJ_Collection,\n} from '../FigurePrimitives/FigurePrimitives';\nimport type FigureCollections from './FigureCollections';\n\n/**\n * Axis Ticks and Grid options object for {@link COL_Axis}.\n *\n * ![](./apiassets/axisticks.png)\n *\n * Ticks and grid locations can specified programatically with `start`,\n * `stop` and `step`, or manually using a `values` array where each value\n * is a value on the axis.\n *\n * `length` and `offset` control the length of the ticks/grid and how much\n * of the line is above or below the axis line. An offset of `0` will put\n * the entire tick on the positive side of the axis.\n *\n * Different properties are defined in different spaces.\n * - `start`, `step`, `stop` and `values` are all in axis space, or the values\n *   along the axis.\n * - `length`, `offset`, `width` and `dash` are all in draw space and relate\n *   to dimensions in the space the axis is being drawn into.\n *\n * @property {number} [start] start value of the ticks/grid on the axis\n * (`axis.start`)\n * @property {number} [step] step between ticks/grid\n * (`(axis.stop - axis.start) / 5`)\n * @property {number} [stop] stop value of the ticks/grid on the axis\n * (`axis.stop`)\n * @property {Array<number>} [values] value locations of the ticks/grid on\n * the axis (overrides `start`, `stop` and `step`)\n * @property {number} [length] length of the ticks/grid (draw space)\n * @property {number} [offset] offset of the ticks/grid (draw space) - use this\n * to center ticks around the axis or not (`-length / 2`)\n * @property {number} [width] width of ticks/grid (draw space)\n * @property {TypeDash} [dash] line style is solid or dashed (`[]`)\n *\n * @extends OBJ_Line\n *\n * @see\n *\n * {@link COL_Axis}\n *\n * To test examples below, append them to the\n * <a href=\"#drawing-boilerplate\">boilerplate</a>.\n *\n * @example\n * // Axis with no ticks\n * figure.add({\n *   name: 'x',\n *   method: 'collections.axis',\n *   options: {\n *     length: 2,\n *   },\n * });\n *\n * @example\n * // Axis with default ticks\n * figure.add({\n *   name: 'x',\n *   method: 'collections.axis',\n *   options: {\n *     length: 2,\n *     ticks: true,\n *   },\n * });\n *\n * @example\n * // Axis ticks with custom step and color\n * figure.add({\n *   name: 'x',\n *   method: 'collections.axis',\n *   options: {\n *     length: 2,\n *     ticks: { step: 0.5, color: [0, 0, 1, 1] },\n *   },\n * });\n *\n * @example\n * // Axis with ticks between 0.2 and 0.8 below the line\n * figure.add({\n *   name: 'x',\n *   method: 'collections.axis',\n *   options: {\n *     length: 2,\n *     ticks: {\n *       start: 0.2,\n *       stop: 0.8,\n *       step: 0.2,\n *       length: 0.15,\n *       offset: -0.2,\n *       dash: [0.01, 0.01]\n *     },\n *   },\n * });\n *\n * @example\n * // Axis with ticks at values\n * figure.add({\n *   name: 'x',\n *   method: 'collections.axis',\n *   options: {\n *     length: 2,\n *     ticks: { values: [0, 0.2, 0.8, 1] },\n *   },\n * });\n */\nexport type OBJ_AxisTicks = {\n  start?: number,\n  step?: number,\n  stop?: number,\n  values?: Array<number>,\n  length?: number,\n  offset?: number,\n  width?: number,\n  dash?: Array<number>,\n} & OBJ_Line;\n\n\nexport type OBJ_AxisTicks_Fixed = {\n  start: number,\n  step: number,\n  stop: number,\n  values: Array<number>,\n  length: number,\n  offset: number,\n  width: number,\n  dash: TypeDash,\n} & OBJ_Line;\n\n\n/**\n * Axis label options object for the {@link COL_Axis}.\n *\n * ![](./apiassets/axislabels_ex1.png)\n *\n * ![](./apiassets/axislabels_ex2.png)\n *\n * ![](./apiassets/axislabels_ex3.png)\n *\n * ![](./apiassets/axislabels_ex4.png)\n *\n * ![](./apiassets/axislabels_ex5.png)\n *\n * ![](./apiassets/axislabels_ex6.png)\n *\n *\n * By default, labels are positioned with the first `ticks` defined in the\n * axis. Labels can also be positioned at custom values with `values`.\n *\n * Labels will be values at the label positions, unless specified as a specific\n * string or number in the `text` property.\n *\n * Different properties are defined in different spaces.\n * - `values`, is defined in axis space, or the values along the axis.\n * - `space` and `offset` are defined in draw space and relate\n *   to dimensions in the space the axis is being drawn into.\n *\n * @property {null | number | Array<number>} [values] the axis values to\n * position labels at - by default (`null`) these values will be the same\n * values as the first `ticks` values if `ticks` are defined (`null`)\n * @property {null | Array<string | null | number>} [text] An array of text to\n * be used for the labels. `null` will use the\n * value the label is at, `number` and `string` can be used for label\n * customization. If using an array that is shorter than the number of values\n * for labels to be drawn at, then `null` will be used for undefined values.\n * (`null`)\n * @property {number} [precision] Number of decimal places to be shown when the\n * label text is the axis value (`null`) or a `number` (`1`)\n * @property {'decimal' | 'exp'} [format] `'exp'` will present numbers in\n * exponential form (`'decimal'`)\n * @property {number} [space] space between the ticks and the label\n * @property {TypeParsablePoint} [offset] additional offset for the labels\n * (`[0, 0]`)\n * @property {number} [rotation] label rotation (`0`)\n * @property {'left' | 'right' | 'center'} [xAlign] horizontal alignment of\n * labels (`'center'` for x axes, `'right'` for y axes)\n * @property {'bottom' | 'baseline' | 'middle' | 'top'} [yAlign] vertical\n * alignment of labels (`'top'` for x axes, `'middle'` for y axes)\n * @property {OBJ_Font} [font] specific font changes for labels\n * @property {Array<number> | number} [hide] value indexes to hide (`[]`)\n *\n * @see\n *\n * To test examples below, append them to the\n * <a href=\"#drawing-boilerplate\">boilerplate</a>.\n *\n * For more examples see {@link OBJ_Axis}.\n *\n * @example\n * // By default labels are displayed if there are ticks\n * figure.add({\n *   name: 'x',\n *   method: 'collections.axis',\n *   options: {\n *     length: 2,\n *     ticks: true,\n *   },\n * });\n *\n * @example\n * // If there are multiple ticks, then just the first are used to show labels\n * figure.add({\n *   name: 'x',\n *   method: 'collections.axis',\n *   options: {\n *     length: 2,\n *     ticks: [\n *       { step: 0.5 },\n *       { step: 0.1, length: 0.05, offset: 0 },\n *     ],\n *   },\n * });\n *\n * @example\n * // Long labels can be displayed with a rotation. Set the\n * // xAlign, yAlign and offset to make it look good.\n * figure.add({\n *   name: 'x',\n *   method: 'collections.axis',\n *   options: {\n *     axis: 'x',\n *     length: 2,\n *     start: 10000,\n *     stop: 20000,\n *     ticks: true,\n *     labels: {\n *       precision: 0,\n *       rotation: Math.PI / 4,\n *       yAlign: 'middle',\n *       xAlign: 'right',\n *       space: 0.05,\n *     },\n *   },\n * });\n *\n * @example\n * // Specific labels can be hidden\n * figure.add({\n *   name: 'x',\n *   method: 'collections.axis',\n *   options: {\n *     length: 2,\n *     ticks: true,\n *     labels: { hide: 0 },\n *   },\n * });\n *\n * @example\n * // Labels can be at specific values, and have a specific font\n * figure.add({\n *   name: 'x',\n *   method: 'collections.axis',\n *   options: {\n *     length: 2,\n *     ticks: true,\n *     labels: {\n *       values: [0, 0.6],\n *       font: { color: [0, 0, 1, 1], size: 0.15 },\n *     },\n *   },\n * });\n *\n * @example\n * // Labels can be strings, `null` for the actual value, or numbers. If numbers\n * // then they will be drawn in the same format as the actual values.\n * figure.add({\n *   name: 'x',\n *   method: 'collections.axis',\n *   options: {\n *     length: 2,\n *     ticks: true,\n *     labels: {\n *       values: null,\n *       text: ['0', null, 'AB', '0.6', 0.8, null],\n *       format: 'exp',\n *     },\n *   },\n * });\n */\nexport type OBJ_AxisLabels = {\n  values?: null | number | Array<number>,\n  text?: null | Array<string | null | number>,\n  precision?: number,\n  format?: 'decimal' | 'exp',\n  space?: number,\n  offset?: TypeParsablePoint,\n  rotation?: number,\n  xAlign?: 'left' | 'right' | 'center',\n  yAlign?: 'bottom' | 'baseline' | 'middle' | 'top',\n  font?: OBJ_Font,\n  hide?: Array<number>,\n}\n\n/**\n * Axis title\n *\n * ({@link OBJ_TextLines} `& { rotation?: number, offset?:` {@link TypeParsablePoint} `}) | string`\n */\nexport type TypeAxisTitle = OBJ_TextLines & {\n  rotation?: number,\n  offset?: TypeParsablePoint\n} | string;\n\n/**\n * {@link CollectionsAxis} options object that extends {@link OBJ_Collection}\n * options object (without `parent`).\n *\n * An axis can be used to create a number line, used as an axis in\n * {@link COL_Plot} and/or used to plot a {@link COL_Trace} against.\n *\n * An axis is a line that may have\n * - tick marks\n * - labels\n * - grid lines\n * - a title\n *\n * An axis is drawn to a `length`. It will have values along its length\n * from `start` to `stop`. Ticks, grid lines and labels are all drawn\n * at axis value positions. All other dimensions, such as line lengths,\n * widths, positions, spaces and offsets are defined in draw space, or in the\n * same space as the `length` of the axis.\n *\n * @property {'x' | 'y'} [axis] `'x'` axes are horizontal, `'y'` axes are\n * vertical (`'x'`)\n * @property {number} [length] length of the axis\n * @property {OBJ_Line | boolean} [line] line style of the axis - `null` will draw\n * no line. By default, a solid line will be drawn if not defined.\n * @property {number} [start] start value of axis (`0`)\n * @property {number} [stop] stop value of axis. `stop` must be larger than\n * `start` (`start + 1`)\n * @property {OBJ_AxisTicks | Array<OBJ_AxisTicks> | boolean} [ticks] tick\n * options. Use an Array to setup multiple sets/styles of ticks. Use a boolean\n * value to turn ticks on or off. (`false`)\n * @property {OBJ_AxisLabels | Array<OBJ_AxisLabels> | boolean} [labels] label\n * options.\n * Use an array to setup multiple sets of labels, and use a boolean to turn\n * labels on and off (`true` if ticks exits, `false` otherwise)\n * @property {OBJ_AxisTicks | Array<OBJ_AxisTicks> | boolean} [grid] grid\n * options. Use an array for multiple sets of grids, and use a boolean to\n * turn grids on and off (`false`)\n * @property {TypeAxisTitle | boolean} [title] axis title (`false`)\n * @property {OBJ_Font} [font] default font of axis (used by title and labels)\n * @property {boolean} [show] `false` hides the axis. Two axes are needed\n * to plot an {@link CollectionsTrace} on a {@link CollectionsPlot}, but if either or\n * both axes aren't to be drawn, then use `false` to hide each axis (`true`)\n * @property {[number, number]} [auto] Will select automatic values for\n * `start`, `stop`, and `step` that cover the range [min, max]\n * @property {string} [name] axis name - used to define which axes a trace\n * should be plotted against in an {@link CollectionsPlot}.\n * @property {TypeParsablePoint} [position] axis position (`[0, 0]`)\n *\n * @extends OBJ_Collection\n */\nexport type COL_Axis = {\n  axis?: 'x' | 'y',\n  length?: number,              // draw space length\n  line?: boolean | OBJ_Line,\n  start?: number,               // value space start at draw space start\n  stop?: number,                // value space stop at draw space stop\n  ticks?: OBJ_AxisTicks | Array<OBJ_AxisTicks> | boolean,\n  labels?: OBJ_AxisLabels | Array<OBJ_AxisLabels> | boolean,\n  grid?: OBJ_AxisTicks | Array<OBJ_AxisTicks> | boolean,\n  title?: TypeAxisTitle,\n  font?: OBJ_Font,              // Default font\n  show?: boolean,\n  auto?: [number, number],\n  name?: string,\n  position?: TypeParsablePoint,\n} & OBJ_Collection;\n\n\n/*\n...................###....##.....##.####..######.\n..................##.##....##...##...##..##....##\n.................##...##....##.##....##..##......\n................##.....##....###.....##...######.\n................#########...##.##....##........##\n................##.....##..##...##...##..##....##\n................##.....##.##.....##.####..######.\n*/\n\n/**\n * {@link FigureElementCollection} representing an Axis.\n *\n * This object defines an axis with an axis line, tick marks, labels,\n * grid lines and a title.\n *\n * See {@link COL_Axis} for the options that can be used when creating\n * the axis.\n *\n * An axis is drawn to a `length`. It will have values along its length\n * from `start` to `stop`. Ticks, grid lines and labels are all drawn\n * at axis value positions. All other dimensions, such as line lengths,\n * widths, positions, spaces and offsets are defined in draw space, or in the\n * same space as the `length` of the axis.\n *\n * The object contains additional methods that convert between axis values\n * and draw space positions, as well as a convenience method to report if a\n * value is within an axis.\n * - <a href=\"#collectionsaxisvaluetodraw\">valueToDraw</a>\n * - <a href=\"#collectionsaxisdrawtovalue\">drawToValue</a>\n * - <a href=\"#collectionsaxisinaxis\">inAxis</a>\n *\n * To test examples below, append them to the\n * <a href=\"#drawing-boilerplate\">boilerplate</a>.\n *\n * For more examples of axis labels and axis ticks, see {@link OBJ_AxisLabels}\n * and {@link OBJ_AxisTicks}.\n *\n * #### Example\n * ```javascript\n * // By default an axis is an 'x' axis\n * figure.add({\n *   name: 'x',\n *   method: 'collections.axis',\n *   options: {\n *     ticks: true,\n *   },\n * });\n * ```\n * ![](./apiassets/advaxis_ex1.png)\n *\n * #### Example\n * ```javascript\n * // An axis can also be created and then added to a figure\n * // An axis can have specific start and stop values\n * // An axis can be a y axis\n * const axis = figure.collections.axis({\n *   axis: 'y',\n *   start: -10,\n *   stop: 10,\n *   ticks: { step: 5 },\n * })\n * figure.add('axis', axis);\n * ```\n * ![](./apiassets/advaxis_ex2.png)\n *\n * #### Example\n * ```javascript\n * // An axis can have multiple sets of ticks and a title\n * figure.add({\n *   name: 'x',\n *   method: 'collections.axis',\n *   options: {\n *     ticks: [\n *       { step: 0.2, length: 0.1 },\n *       { step: 0.05, length: 0.05, offset: 0 },\n *     ],\n *     title: 'time (s)',\n *   },\n * });\n * ```\n * ![](./apiassets/advaxis_ex3.png)\n *\n * #### Example\n * ```javascript\n * // An axis line and ticks can be customized to be dashed\n * // and have arrows\n * figure.add({\n *   name: 'x',\n *   method: 'collections.axis',\n *   options: {\n *     length: 2.5,\n *     start: -130,\n *     stop: 130,\n *     line: {\n *       dash: [0.01, 0.01],\n *       arrow: 'barb',\n *     },\n *     ticks: {\n *       start: -100,\n *       stop: 100,\n *       step: 25,\n *       dash: [0.01, 0.01],\n *     },\n *     labels: { precision: 0 },\n *     title: {\n *       font: { style: 'italic' },\n *       text: 'x',\n *       position: [2.65, 0.03],\n *     },\n *   },\n * });\n * ```\n * ![](./apiassets/advaxis_ex4.png)\n *\n * #### Example\n * ```javascript\n * // An axis title can have grid lines extend from it, and titles with more\n * // formatting\n * figure.add({\n *   name: 'x',\n *   method: 'collections.axis',\n *   options: {\n *     stop: 2,\n *     ticks: { step: 0.5 },\n *     grid: [\n *       { step: 0.5, length: 1, color: [0.5, 0.5, 0.5, 1] },\n *       { step: 0.1, length: 1, dash: [0.01, 0.01], color: [0.7, 0.7, 0.7, 1] },\n *     ],\n *     title: {\n *       font: { color: [0.4, 0.4, 0.4, 1] },\n *       text: [\n *         'Total Time',\n *         {\n *           text: 'in seconds',\n *           font: { size: 0.1 },\n *           lineSpace: 0.12,\n *         },\n *       ],\n *     },\n *   },\n * });\n * ```\n * ![](./apiassets/advaxis_ex5.png)\n *\n *\n * @see {@link COL_Axis} for parameter descriptions\n *\n */\n// $FlowFixMe\nclass CollectionsAxis extends FigureElementCollection {\n  // Figure elements\n  _line: ?FigureElementPrimitive;\n  _majorTicks: ?FigureElementPrimitive;\n  _majorGrid: ?FigureElementPrimitive;\n  _minorTicks: ?FigureElementPrimitive;\n  _minorGrid: ?FigureElementPrimitive;\n  _labels: ?FigureElementPrimitive;\n  _arrow1: ?FigureElementPrimitive;\n  _arrow2: ?FigureElementPrimitive;\n  _title: ?FigureElementPrimitive;\n\n  length: number;\n  angle: number;\n  startValue: number;\n  stopValue: number;\n  showAxis: boolean;\n\n  ticks: Array<OBJ_AxisTicks_Fixed>;\n  grid: Array<OBJ_AxisTicks_Fixed>;\n\n  labels: Array<OBJ_AxisLabels>;\n\n  drawToValueRatio: number;\n  valueToDrawRatio: number;\n  defaultFont: OBJ_Font_Fixed;\n  name: string;\n  autoStep: null | number;\n  axis: 'x' | 'y';\n  line: OBJ_Line;\n\n  /**\n   * @hideconstructor\n   */\n  constructor(\n    collections: FigureCollections,\n    optionsIn: COL_Axis,\n  ) {\n    const defaultOptions: COL_Axis = {\n      length: collections.primitives.defaultLength,\n      angle: 0,\n      start: 0,\n      color: collections.primitives.defaultColor,\n      font: collections.primitives.defaultFont,\n      name: '',\n      line: {},\n      // grid: null,\n      // ticks: null,\n      show: true,\n      axis: 'x',\n      transform: new Transform('Axis').scale(1, 1).rotate(0).translate(0, 0),\n      limits: collections.primitives.limits,\n    };\n    let options = joinObjects({}, defaultOptions, optionsIn);\n    super(options);\n    this.collections = collections;\n    this.autoStep = null;\n    if (optionsIn.auto != null) {\n      const {\n        start, stop, step, precision,\n      } = this.calcAuto(optionsIn.auto);\n      defaultOptions.start = start;\n      defaultOptions.stop = stop;\n      defaultOptions.ticks = {};\n      defaultOptions.labels = { precision };\n      this.autoStep = step;\n    }\n    options = joinObjects({}, defaultOptions, optionsIn);\n    if (options.stop == null || options.stop <= options.start) {\n      options.stop = options.start + 1;\n    }\n    this.name = options.name;\n    this.defaultFont = options.font;\n    if (optionsIn.font == null || optionsIn.font.color == null) {\n      this.defaultFont.color = options.color;\n    }\n    this.showAxis = options.show;\n    this.startValue = options.start;\n    this.stopValue = options.stop;\n    if (this.startValue >= this.stopValue) {\n      this.startValue = this.stopValue - 1;\n    }\n    this.length = options.length;\n    this.axis = options.axis;\n    this.angle = this.axis === 'x' ? 0 : Math.PI / 2;\n    this.drawToValueRatio = (options.stop - options.start) / options.length;\n    this.valueToDrawRatio = 1 / this.drawToValueRatio;\n    if (options.ticks != null && options.labels === undefined) {\n      options.labels = {};\n    }\n    // if (options.position != null) {\n    //   this.transform.updateTranslation(getPoint(options.position));\n    // }\n    // if (options.transform != null) {\n    //   this.transform = getTransform(options.transform);\n    // }\n    this.setColor(options.color);\n\n    this.ticks = [];\n    this.grid = [];\n    this.labels = [];\n\n    if (this.showAxis && options.line != null && options.line !== false) {\n      this.addLine(options.line);\n    }\n    if (this.showAxis && options.ticks != null && options.ticks !== false) {\n      this.addTicks(options.ticks, 'ticks');\n    }\n\n    if (this.showAxis && options.labels != null && options.labels !== false) {\n      this.addLabels(options.labels);\n    }\n    if (this.showAxis && options.title != null) {\n      this.addTitle(options.title);\n    }\n    if (this.showAxis && options.grid != null && options.grid !== false) {\n      this.addTicks(options.grid, 'grid');\n    }\n    this.reorder();\n  }\n\n  addLine(optionsInOrBool: OBJ_Line | boolean) {\n    let optionsIn = optionsInOrBool;\n    if (optionsInOrBool === true) {\n      optionsIn = {};\n    }\n    const defaultOptions = {\n      length: this.length,\n      angle: this.angle,\n      width: this.collections.primitives.defaultLineWidth,\n      color: this.color,\n    };\n    const o = joinObjects({}, defaultOptions, optionsIn);\n    const line = this.collections.primitives.line(o);\n    this.line = o;\n    this.add('line', line);\n  }\n\n  reorder() {\n    let grid = [];\n    let ticks = [];\n    const line = [];\n    this.drawOrder.forEach((elementName) => {\n      if (elementName.startsWith('grid')) {\n        grid.push(elementName);\n      }\n      if (elementName.startsWith('tick')) {\n        ticks.push(elementName);\n      }\n      if (elementName.startsWith('line')) {\n        line.push(elementName);\n      }\n    });\n    ticks = ticks.reverse();\n    grid = grid.reverse();\n    this.toBack(ticks);\n    this.toBack(line);\n    this.toBack(grid);\n  }\n\n  processTicks(\n    name: 'ticks' | 'grid',\n    o: { start?: number, stop?: number, step?: number, values?: Array<number>},\n    index: number,\n  ) {\n    // let { start, stop } = this;\n    let start = this.startValue;\n    let stop = this.stopValue;\n    let step;\n    let values;\n    if (o.start != null) {\n      start = o.start;\n    }\n    if (o.stop != null) {\n      stop = o.stop;\n    }\n    if (o.step != null) {\n      step = o.step;\n    }\n    if (o.values != null) {\n      values = o.values;\n    }\n\n    if (name === 'grid' && this.ticks.length >= index + 1) {\n      if (o.start == null) {\n        start = this.ticks[index].start;\n      }\n      if (o.stop == null) {\n        stop = this.ticks[index].stop;\n      }\n      if (o.step == null) {\n        step = this.ticks[index].step;\n      }\n      if (o.values == null) {\n        values = this.ticks[index].values;\n      }\n    }\n    if (step == null && this.autoStep != null && this.autoStep < (stop - start) / 2) {\n      step = this.autoStep;\n    } else if (step == null && index === 0) {\n      step = (stop - start) / 5;\n    } else if (step == null) { // $FlowFixMe\n      step = this[name].step / 2;\n    }\n    return {\n      start, stop, step, values,\n    };\n  }\n\n  addTicks(optionsInOrBool: OBJ_AxisTicks | Array<OBJ_AxisTicks> | boolean, name: 'ticks' | 'grid' = 'ticks') {\n    let optionsIn = optionsInOrBool;\n    if (optionsInOrBool === true) {\n      optionsIn = {};\n    }\n    const defaultOptions = {\n      // start: this.startValue,\n      // stop: this.stopValue,\n      // step: (this.stopValue - this.startValue) / 5,\n      width: this.line != null ? this.line.width : this.collections.primitives.defaultLineWidth,\n      length: name === 'ticks' ? this.collections.primitives.defaultLineWidth * 10 : this.collections.primitives.defaultLineWidth * 50,\n      angle: this.angle + Math.PI / 2,\n      color: this.color,\n    };\n    let optionsToUse;\n    if (Array.isArray(optionsIn)) {\n      optionsToUse = optionsIn;\n    } else {\n      optionsToUse = [optionsIn];\n    } // $FlowFixMe\n    this[name] = [];\n    const elements = [];\n    const lengthSign = this.axis === 'x' ? 1 : -1;\n    optionsToUse.forEach((options, index) => {\n      const o = joinObjects({}, defaultOptions, options);\n      const {\n        start, stop, step, values,\n      } = this.processTicks(name, o, index);\n      o.start = start;\n      o.stop = stop;\n      o.step = step;\n      o.length *= lengthSign;\n      if (o.offset == null && name === 'ticks') {\n        o.offset = this.axis === 'x' ? -o.length / 2 : o.length / 2;\n      } else if (o.offset == null && name === 'grid') {\n        const t = this.transform.t() || new Point(0, 0);\n        if (this.axis === 'x') {\n          o.offset = -t.y;\n        } else {\n          o.offset = -t.x;\n        }\n      }\n      const num = Math.floor((o.stop + o.step / 10000 - o.start) / o.step);\n      o.num = num;\n      if (values == null) {\n        o.values = range(o.start, o.stop, o.step);\n      } else {\n        o.values = values;\n      }\n\n      if (this.axis === 'x') {\n        o.copy = [{ to: o.values.map(v => new Point(this.valueToDraw(v), 0)) }];\n      } else {\n        o.copy = [{ to: o.values.map(v => new Point(0, this.valueToDraw(v))) }];\n      } // $FlowFixMe\n      o.copy[0].original = false;\n\n      if (o.p1 == null) {\n        o.p1 = new Point(0, o.offset * lengthSign).rotate(this.angle);\n      }\n\n      const ticks = this.collections.primitives.line(o);\n      elements.push(ticks); // $FlowFixMe\n      this[name].push(o);\n    });\n\n    // Add elements in reverse to ensure first elements are drawn last and\n    // will therefore overwrite later elements.\n    elements.reverse();\n    elements.forEach((element, index) => {\n      this.add(`${name}${index}`, element);\n    });\n  }\n\n  addTitle(optionsIn: OBJ_TextLines & { rotation?: number, offset?: TypeParsablePoint } | string) {\n    const defaultOptions = {\n      font: joinObjects({}, this.defaultFont, { size: this.defaultFont.size || 0.1 * 1.3 }),\n      justify: 'center',\n      xAlign: 'center',\n      yAlign: this.axis === 'x' ? 'top' : 'bottom',\n      rotation: this.axis === 'x' ? 0 : Math.PI / 2,\n      offset: [0, 0],\n    };\n    let optionsToUse = optionsIn;\n    if (typeof optionsIn === 'string') {\n      optionsToUse = { text: [optionsIn] };\n    }\n    const o = joinObjects({}, defaultOptions, optionsToUse);\n    o.offset = getPoint(o.offset);\n    const bounds = this.getBoundingRect('draw');\n    if (o.position == null) {\n      if (this.axis === 'x') {\n        o.position = new Point(this.length / 2, bounds.bottom - o.font.size / 1.5).add(o.offset);\n      } else {\n        o.position = new Point(bounds.left - o.font.size / 1.5, this.length / 2).add(o.offset);\n      }\n    }\n    const title = this.collections.primitives.textLines(o);\n    title.transform.updateRotation(o.rotation);\n    this.add('title', title);\n  }\n\n  addLabels(optionsInOrBool: OBJ_AxisLabels | Array<OBJ_AxisLabels> | boolean) {\n    let optionsIn = optionsInOrBool;\n    if (optionsInOrBool === true) {\n      optionsIn = {};\n    }\n    const defaultOptions = {\n      text: null,\n      precision: 1,\n      values: null,\n      format: 'decimal',  // or 'exponent'\n      font: this.defaultFont,\n      xAlign: this.axis === 'x' ? 'center' : 'right',\n      yAlign: this.axis === 'x' ? 'baseline' : 'middle',\n      rotation: 0,\n    };\n    let optionsToUse;\n    if (Array.isArray(optionsIn)) {\n      optionsToUse = optionsIn;\n    } else {\n      optionsToUse = [optionsIn];\n    }\n    this.labels = [];\n    const bounds = this.getBoundingRect('draw');\n    optionsToUse.forEach((options, index) => {\n      const o = joinObjects({}, defaultOptions, options);\n      if (typeof o.hide === 'number') {\n        o.hide = [o.hide];\n      }\n      if (typeof o.values === 'number') {\n        o.values = [o.values];\n      }\n\n      o.offset = getPoint(o.offset);\n\n      if (typeof o.text === 'string') {\n        o.text = [o.text];\n      }\n\n      // Values where to put the labels - null is auto which is same as ticks\n      let values = [];\n      if (o.values == null && this.ticks.length > 0) {\n        values = this.ticks[index].values;\n      } else {\n        values = o.values;\n      }\n      if (values == null) {\n        values = [];\n      }\n\n      // Text for labels at each value - null is actual value\n      if (o.text == null) {\n        o.text = [];\n        o.text = Array(values.length).map(() => null);\n      }\n\n      if (o.space == null) {\n        o.space = this.axis === 'x' ? o.font.size + this.collections.primitives.defaultLineWidth * 5 : this.collections.primitives.defaultLineWidth * 10;\n      }\n\n      // Generate the text objects\n      const text = [];\n      for (let i = 0; i < values.length; i += 1) {\n        let location;\n        const draw = this.valueToDraw(values[i]);\n        if (this.axis === 'x') {\n          location = new Point(\n            draw + o.offset.x,\n            bounds.bottom - o.space + o.offset.y,\n          ).rotate(-o.rotation);\n        } else {\n          location = new Point(\n            bounds.left + o.offset.x - o.space,\n            draw + o.offset.y,\n          ).rotate(-o.rotation);\n        }\n        if (\n          o.hide == null\n          || (o.hide != null && o.hide.indexOf(i) === -1)\n        ) {\n          let label = o.text[i];\n          if (label == null) {\n            label = values[i];\n          }\n          if (typeof label === 'number') {\n            if (o.format === 'decimal') {\n              label = `${round(label, o.precision).toFixed(o.precision)}`;\n            } else {\n              label = `${label.toExponential(o.precision)}`;\n            }\n          }\n          text.push({\n            text: label,\n            location,\n          });\n        }\n      }\n      o.text = text;\n      const labels = this.collections.primitives.text(o);\n      labels.transform.updateRotation(o.rotation);\n      this.add(`labels${index}`, labels);\n      this.labels.push(o);\n    });\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  calcAuto(auto: [number, number]) {\n    const [min, max] = auto;\n    const r = max - min;\n    let order;\n    if (r < 1) {\n      order = Math.floor(Math.log10(r));\n    // eslint-disable-next-line yoda\n    } else if (1 <= r && r < 3) {\n      order = Math.floor(Math.log10(r / 3));\n    } else {\n      order = Math.ceil(Math.log10(r));\n    }\n    // let order = r < 10 ? Math.floor(Math.log10(r)) : Math.ceil(Math.log10(r));\n    if (order === 0) {\n      order = 1;\n    }\n    const factor = 10 ** (order - 1);\n    // const newRange = Math.ceil(r / factor + 1) * factor;\n    const newStart = Math.floor(min / factor) * factor;\n    const newEnd = Math.ceil(max / factor) * factor;\n    const newRange = newEnd - newStart;\n    // const newEnd = newStart + newRange;\n    let step;\n    switch (round(newRange / factor)) {\n      case 3:\n      case 6:\n        step = newRange / 3;\n        break;\n      case 4:\n      case 8:\n        step = newRange / 4;\n        break;\n      case 7:\n        step = newRange / 7;\n        break;\n      case 9:\n        step = newRange / 3;\n        break;\n      default:\n        step = newRange / 5;\n    }\n    let precision = 0;\n    if (order < 0) {\n      precision = Math.abs(order) + 1;\n    }\n    return {\n      start: round(newStart),\n      stop: round(newEnd),\n      step: round(step),\n      precision: round(precision),\n    };\n  }\n\n  // _getStateProperties(options: Object) {  // eslint-disable-line class-methods-use-this\n  //   return [...super._getStateProperties(options),\n  //     'length', 'angle', 'start', 'stop',\n  //     'ticks', 'grid', 'labels', 'drawToValueRatio', 'valueToDraw',\n  //   ];\n  // }\n\n  /**\n   * Convert an axis value or values to a draw space position or positions.\n   *\n   * 'x' axes have a draw space position of 0 on the left end of the axis and\n   * 'y' axes have a draw space position of 0 on the bottom end of the axis.\n   *\n   * @return {number} draw space position\n   */\n  valueToDraw<T: (number | Array<number>)>(value: T): T {\n    if (typeof value === 'number') { // $FlowFixMe\n      return (value - this.startValue) * this.valueToDrawRatio;\n    }\n    return value.map(v => (v - this.startValue) * this.valueToDrawRatio);\n  }\n\n  /**\n   * Convert an axis draw space value or values to an axis value or values.\n   *\n   * 'x' axes have a draw space position of 0 on the left end of the axis and\n   * 'y' axes have a draw space position of 0 on the bottom end of the axis.\n   *\n   * @return {number} draw space position\n   */\n  drawToValue<T: (number | Array<number>)>(drawValue: T): T {\n    if (typeof drawValue === 'number') { // $FlowFixMe\n      return drawValue * this.drawToValueRatio + this.startValue;\n    }\n    return drawValue.map(v => v * this.drawToValueRatio + this.startValue);\n  }\n\n  /**\n   * Check if a value is within the axis.\n   *\n   * @return {boolean} `true` if value is within length of axis.\n   */\n  inAxis(value: number, precision: number = 8) {\n    const roundedValue = round(value, precision);\n    if (roundedValue < this.startValue || roundedValue > this.stopValue) {\n      return false;\n    }\n    return true;\n  }\n  // isInAxis(value: number) {\n  //   if (value )\n  // }\n}\n\nexport default CollectionsAxis;\n","// @flow\nimport {\n  Transform, Point, parsePoint,\n} from '../../tools/g2';\nimport {\n  FigureElementCollection, FigureElementPrimitive,\n} from '../Element';\nimport EquationForm from '../Equation/EquationForm';\nimport * as html from '../../tools/htmlGenerator';\nimport { generateUniqueId, joinObjects } from '../../tools/tools';\nimport { Equation } from '../Equation/Equation';\nimport { Recorder } from '../Recorder/Recorder';\n\n// eslint-disable-next-line no-use-before-define\n// export type TypeEquationNavigator = EquationNavigator;\n\nfunction updateDescription(\n  eqn: Equation,\n  // subForm: string,\n  descriptionElement: ?HTMLElement,\n  index: number,\n  setClicks: boolean = false,\n  prefix: string = '',\n) {\n  const element = descriptionElement;\n  if (element == null) {\n    return;\n  }\n  let form = null;\n  // $FlowFixMe\n  // form = eqn.eqn.formSeries[index][formType];\n  // form = eqn.getForm(eqn.eqn.currentFormSeries[index], subForm);\n  form = eqn.getCurrentForm();\n  if (form == null) {\n    return;\n  }\n  if (form.description == null) {\n    if (element != null) {\n      element.innerHTML = '';\n    }\n    return;\n  }\n\n  const monochrome = !setClicks;\n  if (descriptionElement) {\n    if (setClicks) {\n      // eslint-disable-next-line no-param-reassign\n      descriptionElement.innerHTML = html\n        .applyModifiers(`${prefix}${form.description}`, form.modifiers);\n      html.setOnClicks(form.modifiers);\n    } else {\n      // eslint-disable-next-line no-param-reassign\n      descriptionElement.innerHTML = html\n        .applyModifiers(`${prefix}${form.description}`, form.modifiers, '', monochrome);\n    }\n  }\n}\n\nfunction enableTouch(element: ?HTMLElement) {\n  if (element) {\n    element.classList.remove('figureone__eqn_nav__not_touchable');\n  }\n}\n\nfunction disableTouch(element: ?HTMLElement) {\n  if (element) {\n    element.classList.add('figureone__eqn_nav__not_touchable');\n  }\n}\n\nfunction updateButtons(\n  // eslint-disable-next-line no-use-before-define\n  nav: EqnNavigator,\n  includeNextPrevPrefix: boolean = false,\n) {\n  let nextPrefix = '';\n  let prevPrefix = '';\n  if (includeNextPrevPrefix) {\n    nextPrefix = 'NEXT: ';\n    prevPrefix = 'PREV: ';\n  }\n  const currentForm = nav.eqn.getCurrentForm();\n  if (currentForm != null) {\n    const index = nav.eqn.getFormIndex(currentForm);\n    if (index === 0) {\n      disableTouch(nav.refresh);\n      disableTouch(nav.prev);\n      disableTouch(nav.prevDescription);\n      disableTouch(nav.description);\n      // enableTouch(nav.nextDescription, true);\n    } else {\n      enableTouch(nav.refresh);\n      enableTouch(nav.prev);\n      enableTouch(nav.prevDescription);\n      enableTouch(nav.description);\n    }\n    if (nav.eqn.eqn.currentFormSeries.length > 1) {\n      enableTouch(nav.next);\n      enableTouch(nav.nextDescription);\n      if (nav.navType === '1Button') {\n        enableTouch(nav.description);\n      }\n    } else {\n      disableTouch(nav.next);\n      disableTouch(nav.nextDescription);\n      if (nav.navType === '1Button') {\n        const { next } = nav;\n        if (next) {\n          next.classList.remove('figureone__eqn_nav__next_form');\n          next.classList.remove('figureone__eqn_nav__reset');\n          next.classList.remove('interactive_top_right');\n        }\n      }\n    }\n    const nextIndex = index + 1;\n    if (nextIndex > nav.eqn.eqn.currentFormSeries.length - 1) {\n      if (nav.nextDescription) {\n        // eslint-disable-next-line no-param-reassign\n        nav.nextDescription.innerHTML = 'RESTART from begining';\n      }\n      if (nav.navType === '1Button' && nav.eqn.eqn.currentFormSeries.length > 1) {\n        const { next } = nav;\n        if (next) {\n          next.classList.add('figureone__eqn_nav__reset');\n          next.classList.remove('figureone__eqn_nav__next_form');\n        }\n      }\n    } else {\n      updateDescription(\n        nav.eqn, nav.nextDescription,\n        nextIndex, false, nextPrefix,\n      );\n      if (nav.navType === '1Button' && nav.eqn.eqn.currentFormSeries.length > 1) {\n        const { next } = nav;\n        if (next) {\n          next.classList.add('figureone__eqn_nav__next_form');\n          next.classList.remove('figureone__eqn_nav__reset');\n        }\n      }\n    }\n    updateDescription(nav.eqn, nav.description, index, true);\n    // nav.eqn.updateDescription(currentForm);\n    const prevIndex = index - 1;\n    if (prevIndex >= 0) {\n      updateDescription(\n        nav.eqn, nav.prevDescription,\n        prevIndex, false, prevPrefix,\n      );\n    } else if (nav.prevDescription) {\n      // eslint-disable-next-line no-param-reassign\n      nav.prevDescription.innerHTML = '';\n    }\n  }\n}\n\n// eslint-disable-next-line no-use-before-define\nfunction updateButtonsDescriptionOnly(nav: EqnNavigator) {\n  const currentForm = nav.eqn.getCurrentForm();\n  if (currentForm != null) {\n    const index = nav.eqn.getFormIndex(currentForm);\n    enableTouch(nav.description);\n    updateDescription(nav.eqn, nav.description, index, true);\n  }\n}\n\nexport type TypeNavTypeOptions = {\n  forceTwoLines?: boolean;\n  arrows?: boolean;\n};\n\n// Nav3Line\nfunction makeType3Line(\n  prevMethod: () => void,\n  refreshMethod: () => void,\n  nextMethod: () => void,\n  options: TypeNavTypeOptions,\n) {\n  const table = document.createElement('table');\n  const prevGroup = document.createElement('tr');\n  const currentGroup = document.createElement('tr');\n  const nextGroup = document.createElement('tr');\n  const prev = document.createElement('td');\n  const refresh = document.createElement('td');\n  const next = document.createElement('td');\n  const prevDescription = document.createElement('td');\n  const description = document.createElement('td');\n  const nextDescription = document.createElement('td');\n  prevGroup.appendChild(prev);\n  prevGroup.appendChild(prevDescription);\n  nextGroup.appendChild(next);\n  nextGroup.appendChild(nextDescription);\n  currentGroup.appendChild(refresh);\n  currentGroup.appendChild(description);\n  table.appendChild(prevGroup);\n  table.appendChild(currentGroup);\n  table.appendChild(nextGroup);\n\n  table.classList.add('figureone__eqn_nav__table');\n  prevGroup.classList.add('figureone__eqn_nav__3line__prevRow');\n  currentGroup.classList.add('figureone__eqn_nav__3line__currentRow');\n  nextGroup.classList.add('figureone__eqn_nav__3line__nextRow');\n  prev.classList.add('figureone__eqn_nav__3line__prevRow__button');\n  refresh.classList.add('figureone__eqn_nav__3line__currentRow__button');\n  next.classList.add('figureone__eqn_nav__3line__nextRow__button');\n  prevDescription.classList.add('figureone__eqn_nav__3line__prevRow__description');\n  description.classList.add('figureone__eqn_nav__3line__currentRow__description');\n  description.classList.add('figureone__eqn_nav__description');\n  nextDescription.classList.add('figureone__eqn_nav__3line__nextRow__description');\n\n  const defaultOptions = {\n    forceTwoLines: false,\n    arrows: false,\n  };\n  const optionsToUse = joinObjects({}, defaultOptions, options);\n  // if (!Array.isArray(options)) {\n  //   optionsToUse = [options];\n  // }\n  // Use two lines to stop jittering when transitioning from one line to two\n  // lines\n  if (optionsToUse.forceTwoLines) {\n    prevGroup.classList.add('figureone__eqn_nav__3line__prev_twoLines');\n    currentGroup.classList.add('figureone__eqn_nav__3line__current_twoLines');\n    nextGroup.classList.add('figureone__eqn_nav__3line__next_twoLines');\n  }\n\n  prevGroup.onclick = prevMethod;\n  currentGroup.onclick = refreshMethod;\n  nextGroup.onclick = nextMethod;\n\n  next.innerHTML = 'Next';\n  prev.innerHTML = 'Prev';\n  refresh.innerHTML = 'Refresh';\n  return {\n    table,\n    prevGroup,\n    currentGroup,\n    nextGroup,\n    prev,\n    refresh,\n    next,\n    prevDescription,\n    description,\n    nextDescription,\n  };\n}\n\n// NavDescriptionOnly\nfunction makeTypeDescriptionOnly(\n  nextMethod: () => void,\n) {\n  const table = document.createElement('table');\n  const currentGroup = document.createElement('tr');\n  const description = document.createElement('td');\n  currentGroup.appendChild(description);\n  table.appendChild(currentGroup);\n  table.classList.add('figureone__eqn_nav__table');\n  currentGroup.classList.add('figureone__eqn_nav__description_only__currentRow');\n  description.classList.add('figureone__eqn_nav__description_only__currentRow__description');\n  description.classList.add('figureone__eqn_nav__description');\n  currentGroup.onclick = nextMethod;\n  return {\n    table,\n    currentGroup,\n    description,\n  };\n}\n\n// Nav1Button\nfunction makeTypeOneButton(\n  nextMethod: () => void,\n  // options: TypeNavTypeOptions,  // can be: 'twoLines'\n) {\n  const table = document.createElement('table');\n  const currentGroup = document.createElement('tr');\n  const next = document.createElement('td');\n  const description = document.createElement('td');\n  currentGroup.appendChild(next);\n  currentGroup.appendChild(description);\n  table.appendChild(currentGroup);\n\n  table.classList.add('figureone__eqn_nav__table');\n  currentGroup.classList.add('figureone__eqn_nav__1button__currentRow');\n  next.classList.add('figureone__eqn_nav__1button__button');\n  description.classList.add('figureone__eqn_nav__1line__currentRow__description');\n  description.classList.add('figureone__eqn_nav__description');\n  next.classList.add('interactive_top_right');\n  // const defaultOptions = {\n  //   icons: true,\n  // };\n  // const optionsToUse = joinObjects({}, defaultOptions, options);\n\n  next.onclick = nextMethod;\n  description.onclick = nextMethod;\n\n  // if (optionsToUse.icons) {\n  next.classList.add('figureone__eqn_nav__next_form');\n  // }\n\n  return {\n    table,\n    currentGroup,\n    next,\n    description,\n  };\n}\n\n// Nav1Line\nfunction makeType1Line(\n  prevMethod: () => void,\n  refreshMethod: () => void,\n  nextMethod: () => void,\n  options: TypeNavTypeOptions,  // can be: 'twoLines'\n) {\n  const table = document.createElement('table');\n  const currentGroup = document.createElement('tr');\n  const prev = document.createElement('td');\n  const next = document.createElement('td');\n  const description = document.createElement('td');\n  currentGroup.appendChild(prev);\n  currentGroup.appendChild(description);\n  currentGroup.appendChild(next);\n  table.appendChild(currentGroup);\n\n  table.classList.add('figureone__eqn_nav__table');\n  currentGroup.classList.add('figureone__eqn_nav__1line__currentRow');\n  prev.classList.add('figureone__eqn_nav__1line__prev__button');\n  next.classList.add('figureone__eqn_nav__1line__next__button');\n  description.classList.add('figureone__eqn_nav__1line__currentRow__description');\n  description.classList.add('figureone__eqn_nav__description');\n\n  const defaultOptions = {\n    forceTwoLines: false,\n    arrows: false,\n  };\n  const optionsToUse = joinObjects({}, defaultOptions, options);\n\n  // Use two lines to stop jittering when transitioning from one line to two\n  // lines\n  if (optionsToUse.forceTwoLines) {\n    currentGroup.classList.add('figureone__eqn_nav__1line__current_twoLines');\n  }\n\n  prev.onclick = prevMethod;\n  description.onclick = refreshMethod;\n  next.onclick = nextMethod;\n\n  if (optionsToUse.arrows) {\n    const nextArrow = document.createElement('div');\n    nextArrow.classList.add('figureone__eqn_nav__arrow_right');\n    next.appendChild(nextArrow);\n\n    const prevArrow = document.createElement('div');\n    prevArrow.classList.add('figureone__eqn_nav__arrow_left');\n    prev.appendChild(prevArrow);\n  } else {\n    next.innerHTML = 'Next';\n    prev.innerHTML = 'Prev';\n  }\n\n  return {\n    table,\n    currentGroup,\n    prev,\n    next,\n    description,\n  };\n}\n\n// Nav2Line\nfunction makeType2Line(\n  prevMethod: () => void,\n  refreshMethod: () => void,\n  nextMethod: () => void,\n  options: TypeNavTypeOptions,\n) {\n  const table = document.createElement('table');\n  const row = document.createElement('tr');\n  const descriptionRows = document.createElement('tr');\n  const currentGroup = document.createElement('tr');\n  const prev = document.createElement('td');\n  const next = document.createElement('td');\n  const nextGroup = document.createElement('tr');\n  // const descriptionRows = document.createElement('td');\n  // const descriptionRow = document.createElement('tr');\n  // const nextDescriptionRow = document.createElement('tr');\n  const description = document.createElement('td');\n  const nextDescription = document.createElement('td');\n  currentGroup.appendChild(description);\n  nextGroup.appendChild(nextDescription);\n  descriptionRows.appendChild(currentGroup);\n  descriptionRows.appendChild(nextGroup);\n\n  row.appendChild(prev);\n  row.appendChild(descriptionRows);\n  row.appendChild(next);\n  table.appendChild(row);\n\n  table.classList.add('figureone__eqn_nav__table');\n  currentGroup.classList.add('figureone__eqn_nav__2lines__currentRow');\n  nextGroup.classList.add('figureone__eqn_nav__2lines__nextRow');\n  prev.classList.add('figureone__eqn_nav__2lines__prev__button');\n  next.classList.add('figureone__eqn_nav__2lines__next__button');\n  description.classList.add('figureone__eqn_nav__2lines__currentRow__description');\n  description.classList.add('figureone__eqn_nav__description');\n  nextDescription.classList.add('figureone__eqn_nav__2lines__nextRow__description');\n\n  const defaultOptions = {\n    forceTwoLines: false,\n    arrows: false,\n  };\n  const optionsToUse = joinObjects({}, defaultOptions, options);\n  // Use two lines to stop jittering when transitioning from one line to two\n  // lines\n  if (optionsToUse.forceTwoLines > -1) {\n    currentGroup.classList.add('figureone__eqn_nav__2lines__current_twoLines');\n  }\n\n  prev.onclick = prevMethod;\n  description.onclick = refreshMethod;\n  next.onclick = nextMethod;\n  nextDescription.onclick = nextMethod;\n\n  if (optionsToUse.arrows) {\n    const nextArrow = document.createElement('div');\n    nextArrow.classList.add('figureone__eqn_nav__arrow_right');\n    next.appendChild(nextArrow);\n\n    const prevArrow = document.createElement('div');\n    prevArrow.classList.add('figureone__eqn_nav__arrow_left');\n    prev.appendChild(prevArrow);\n  } else {\n    next.innerHTML = 'Next';\n    prev.innerHTML = 'Prev';\n  }\n\n  return {\n    table,\n    currentGroup,\n    nextGroup,\n    prev,\n    next,\n    nextDescription,\n    description,\n  };\n}\n\nexport type TypeNavigatorOptions = {\n  equation?: Equation,\n  offset?: Point,\n  navType?: 'equationOnly' | 'description' | '1Line' | '2Line' | '3Line' | '1Button',\n  navTypeOptions?: TypeNavTypeOptions,\n  xAlign?: 'left' | 'right' | 'center',\n  yAlign?: 'top' | 'bottom' | 'middle' | 'baseline',\n  id?: string,\n  interactive?: boolean,\n};\n\n// A Navigator is a FigureElementCollection that is a html table that has\n// the possible html elements of:\n//   next: a next form button\n//   prev: a prev form button\n//   refresh: a button that shows animation to current form again\n//   description: description of current form\n//   nextDescription: description of next form\n//   prevDescription: description of prev form\n//   nextGroup: a html parent that holds nextDescription and nextButton\n//   prevGroup: a html parent that holds prevDescription and prevButton\n//\n// Equation navigators\n\n// Extends equation\n// export type Navigator = {\n//   next: Element | TypeElementDefinition | TypeArrow,\n//   prev: Element | TypeElementDefinition | TypeArrow,\n//   description: Element | TypeTextLines,\n//   type: 'equationOnly' | 'description' | '1Line' | '2LIne' | '3Line',\n// }\nexport default class EqnNavigator extends FigureElementCollection {\n  shapes: Object;\n  // setEquation: (Equation) => void;\n  next: ?HTMLElement;\n  prev: ?HTMLElement;\n  refresh: ?HTMLElement;\n  nextDescription: ?HTMLElement;\n  prevDescription: ?HTMLElement;\n  description: ?HTMLElement;\n  prevGroup: ?HTMLElement;\n  nextGroup: ?HTMLElement;\n  table: ?HTMLElement;\n  _table: FigureElementPrimitive;\n  currentGroup: ?HTMLElement;\n  updateButtons: () => void;\n  eqn: Equation;\n  animateNextFrame: void => void;\n  navType: 'equationOnly' | 'description' | '1Line' | '2Line' | '3Line' | '1Button';\n  options: TypeNavTypeOptions;\n  recorder: Recorder;\n\n  constructor(\n    shapes: Object,\n    // eqn: Equation,\n    animateNextFrame: () => void,\n    options: TypeNavigatorOptions = {},\n  ) {\n    const defaultOptions = {\n      offset: new Point(0, 0),\n      navType: 'twoLine',\n      navTypeOptions: {\n        forceTwoLines: false,\n        arrows: false,\n      },\n      xAlign: 'center',\n      yAlign: 'middle',\n      interactive: true,\n      id: generateUniqueId('id_figureone__equation_navigator_'),\n      transform: new Transform('Eqn Nav').scale(1, 1).translate(0, 0),\n      limits: shapes.limits,\n    };\n    const optionsToUse = joinObjects({}, defaultOptions, options);\n    super(optionsToUse);\n    // super(shapes, eqnOptions);\n    this.shapes = shapes;\n    // this.setEquation(equation);\n    this.prev = null;\n    this.next = null;\n    this.refresh = null;\n    this.description = null;\n    this.nextDescription = null;\n    this.prevDescription = null;\n    this.table = null;\n    this.prevGroup = null;\n    this.currentGroup = null;\n    this.nextGroup = null;\n    this.animateNextFrame = animateNextFrame;\n    this.recorder = new Recorder();\n\n    this.options = optionsToUse;\n    if (optionsToUse.equation != null) {\n      // this.eqn = optionsToUse.equation;\n      // this.eqn.onClick = this.clickNext.bind(this);\n      // this.eqn.hasTouchableElements = true;\n      // this.eqn.isTouchable = true;\n      // this.eqn.touchInBoundingRect = true;\n      this.connectToEquation(optionsToUse.equation, optionsToUse.interactive);\n    }\n\n    this.navType = optionsToUse.navType;\n\n    let navigatorHTMLElement = null;\n    if (this.navType === '3Line') {\n      navigatorHTMLElement = makeType3Line(\n        this.clickPrev.bind(this),\n        this.clickRefresh.bind(this),\n        this.clickNext.bind(this),\n        optionsToUse.navTypeOptions,\n      );\n    }\n    if (this.navType === 'description') {\n      navigatorHTMLElement = makeTypeDescriptionOnly(this.clickNext.bind(this));\n    }\n    if (this.navType === '1Line') {\n      navigatorHTMLElement = makeType1Line(\n        this.clickPrev.bind(this),\n        this.clickRefresh.bind(this),\n        this.clickNext.bind(this),\n        optionsToUse.navTypeOptions,\n      );\n    }\n    if (this.navType === '1Button') {\n      navigatorHTMLElement = makeTypeOneButton(\n        this.clickNext.bind(this),\n        // optionsToUse.navTypeOptions,\n      );\n    }\n    if (this.navType === '2Line') {\n      navigatorHTMLElement = makeType2Line(\n        this.clickPrev.bind(this),\n        this.clickRefresh.bind(this),\n        this.clickNext.bind(this),\n        optionsToUse.navTypeOptions,\n      );\n    }\n\n    // const eqnCollectionPosition = this.eqn.getPosition();\n    if (navigatorHTMLElement != null) {\n      const offsetToUse = parsePoint(optionsToUse.offset, new Point(0, 0));\n      Object.assign(this, navigatorHTMLElement);\n      const table = this.shapes.htmlElement(\n        navigatorHTMLElement.table,\n        `${optionsToUse.id}_table`,\n        '',\n        offsetToUse, optionsToUse.yAlign, optionsToUse.xAlign,\n      );\n      this.add('table', table);\n    }\n  }\n\n  connectToEquation(eqn: Equation, interactive: boolean) {\n    this.eqn = eqn;\n    if (interactive) {\n      this.eqn.onClick = this.clickNext.bind(this);\n      this.eqn.hasTouchableElements = true;\n      this.eqn.isTouchable = true;\n      // this.eqn.touchInBoundingRect = true;\n    }\n    // this.setTransformCallback = () => {\n    //   const p = this.getPosition();\n    //   this.eqn.setPosition(p);\n    // }\n  }\n\n  // const navigator = collections.collection(;\n  // setEquation(eqn: Equation) {\n  //   this.eqn = eqn;\n  //   // this._eqn = [];\n  //   this.add('eqn', eqn.collection);\n  // }\n\n  // setWidth(width) {\n\n  // }\n\n  clickNext() {\n    if (this.onClick !== null && this.onClick !== undefined) {\n      if (this.recorder.state === 'recording') {\n        this.recorder.recordEvent('eqnNavClick', ['next', this.getPath()]);\n      }\n      this.fnMap.exec(this.onClick, this);\n    }\n    this.eqn.nextForm(1.5);\n    this.updateButtons();\n    this.animateNextFrame();\n  }\n\n  clickPrev() {\n    if (this.onClick !== null && this.onClick !== undefined) {\n      if (this.recorder.state === 'recording') {\n        this.recorder.recordEvent('eqnNavClick', ['prev', this.getPath()]);\n      }\n      this.fnMap.exec(this.onClick, this);\n    }\n    this.eqn.prevForm(1.5);\n    this.updateButtons();\n    this.animateNextFrame();\n  }\n\n  clickRefresh() {\n    if (this.onClick !== null && this.onClick !== undefined) {\n      if (this.recorder.state === 'recording') {\n        this.recorder.recordEvent('eqnNavClick', ['refresh', this.getPath()]);\n      }\n      this.fnMap.exec(this.onClick, this);\n    }\n    const currentForm = this.eqn.getCurrentForm();\n    if (currentForm != null) {\n      const index = this.eqn.getFormIndex(currentForm);\n      if (index > 0) {\n        this.eqn.replayCurrentForm(1.5);\n        this.animateNextFrame();\n      }\n    }\n    this.updateButtons();\n  }\n\n  updateButtons() {\n    if (this.navType === 'equationOnly') {\n      return;\n    }\n    if (this.navType === 'description') {\n      updateButtonsDescriptionOnly(this);\n    } else if (this.navType === '2Line') {\n      updateButtons(this, true);\n    } else {\n      updateButtons(this);\n    }\n  }\n\n  showForm(formOrName: EquationForm | string) {\n    this.show();\n    this.eqn.showForm(formOrName);\n    // this.showForm(formOrName, formType);\n    if (this._table) {\n      this._table.show();\n      this.updateButtons();\n    }\n  }\n}\n","// @flow\nimport {\n  Point, clipAngle,\n} from '../../tools/g2';\nimport {\n  round,\n} from '../../tools/math';\nimport { Equation } from '../Equation/Equation';\nimport type {\n  TypeVAlign, TypeHAlign,\n} from '../Equation/EquationForm';\nimport { joinObjects } from '../../tools/tools';\nimport type { EQN_Equation } from '../Equation/Equation';\nimport type { TypeColor } from '../../tools/types';\nimport type FigureCollections from './FigureCollections';\n\nconst DEBUG = false;\n\nexport type TypeLabelOptions = {\n  label?: string | Equation | Array<string> | EQN_Equation,\n  color?: TypeColor,\n  scale?: number,\n  position?: Point,\n  form?: string,\n  yAlign?: TypeVAlign,\n  xAlign?: TypeHAlign,\n};\n\n/**\n * Orientation of the label.\n *\n * `'horizontal' | 'toLine' | 'awayLine' | 'upright'`\n *\n * Where:\n * - `'horizontal'`: Label will be horizontal\n * - `'baseToLine'`: Label will have same angle as line with text base toward\n *   the line\n * - `'baseAway'`: Label will have same angle as line with text base away from\n *   the line\n * - `'upright'`: Label will have same angle as line with text being more\n *   upright than upside down.\n */\nexport type TypeLabelOrientation = 'horizontal' | 'baseAway' | 'baseToLine'\n                                      | 'upright';\n\n/**\n * Label location relative to the line.\n *\n * `'top' | 'left' | 'bottom' | 'right' | 'start' | 'end' | 'positive' | 'negative'`\n *\n * '`top`' is in the positive y direction and `'right'` is in the positive\n * x direction. '`bottom`' and '`left`' are the opposite sides respectively.\n *\n * `'positive'` is on the side of the line that the line rotates toward when\n * rotating in the positive direction. `'negative'` is the opposite side.\n *\n * `'start'` is the start end of the line, while `'end'` is the opposide end\n * of the line.\n */\nexport type TypeLabelLocation = 'top' | 'left' | 'bottom' | 'right'\n                                    | 'start' | 'end' | 'outside' | 'inside'\n                                    | 'positive' | 'negative';\n\n/**\n * Label sub location relative to line.\n *\n * `'top' | 'left' | 'bottom' | 'right'`\n *\n * The label sub location is a fallback for when an invalid case is encountered\n * by the primary location. When the primary location is `'top'` or `'bottom'`\n * and the line is perfectly vertical, then the sub location would be used.\n *\n * Similarly, if the primary location is `'left'` or `'right'` and the line is\n * perfectly horizontal, then the sub location would be used.\n */\nexport type TypeLabelSubLocation = 'top' | 'left' | 'bottom' | 'right';\n\n\n/**\n * Equation label\n */\nexport default class EquationLabel {\n  eqn: Equation;\n  height: number;\n  width: number;\n  aOffset: number;\n\n  constructor(\n    collections: FigureCollections,\n    options: TypeLabelOptions = {},\n  ) {\n    const defaultOptions = {\n      label: '',\n      color: [0, 0, 1, 1],\n      scale: 0.7,\n      position: new Point(0, 0),\n      xAlign: 'center',\n      yAlign: 'middle',\n    };\n    const optionsToUse = joinObjects({}, defaultOptions, options);\n    const labelTextOrEquation = optionsToUse.label;\n    const { color, scale, position } = optionsToUse;\n    // const { form } = optionsToUse;\n    const { yAlign, xAlign } = optionsToUse;\n    let eqn;\n    if (typeof labelTextOrEquation === 'string') {\n      eqn = collections.equation({\n        elements: { base: labelTextOrEquation },\n        color,\n        formDefaults: {\n          alignment: {\n            fixTo: new Point(0, 0),\n            xAlign,\n            yAlign,\n          },\n        },\n        scale,\n        forms: {\n          base: ['base'],\n        },\n        position,\n      });\n      eqn.showForm('base');\n    } else if (labelTextOrEquation instanceof Equation) {\n      eqn = labelTextOrEquation;\n      eqn.showForm(Object.keys(eqn.eqn.forms)[0]);\n    } else if (Array.isArray(labelTextOrEquation)) {\n      const elements = {};\n      const forms = {};\n      const formSeries = [];\n      labelTextOrEquation.forEach((labelText, index) => {\n        elements[`_${index}`] = labelText;\n        forms[index] = [labelText];\n        formSeries.push(`${index}`);\n      });\n\n      eqn = collections.equation({\n        elements,\n        forms,\n        color,\n        position,\n        formDefaults: {\n          alignment: {\n            fixTo: new Point(0, 0),\n            xAlign,\n            yAlign,\n          },\n        },\n        scale,\n        formSeries,\n      });\n      eqn.showForm('0');\n    } else {\n      const defaultEqnOptions = {\n        color,\n        formDefaults: {\n          alignment: {\n            fixTo: new Point(0, 0),\n            xAlign,\n            yAlign,\n          },\n        },\n        scale,\n        // form,\n      };\n      eqn = collections.equation(joinObjects(\n        defaultEqnOptions, labelTextOrEquation,\n      ));\n      // if (form == null) {\n      eqn.showForm(Object.keys(eqn.eqn.forms)[0]);\n    }\n    this.eqn = eqn;\n    this.width = 0;\n    this.height = 0;\n    this.aOffset = 0;\n  }\n\n  // TODO\n  // setEqn() {\n  // }\n\n  showForm(formName: string) {\n    this.eqn.showForm(formName);\n  }\n\n  setText(text: string) {\n    const form = this.eqn.getCurrentForm();\n    if (form != null) {\n      const key = Object.keys(form.elements)[0];\n      // This is ok to fix for flow because all the elements of the\n      // simple equation created by Equationlabel will be Primitives\n      // $FlowFixMe\n      const textObject = form.elements[key].drawingObject;\n      if (textObject != null) {\n        textObject.setText(text); // $FlowFixMe\n        form.elements[key].drawBorder = form.elements[key].drawingObject.textBorder; // $FlowFixMe\n        form.elements[key].drawBorderBuffer = form.elements[key].drawingObject.textBorderBuffer;\n      }\n      // console.log(form)\n      form.arrange(\n        this.eqn.eqn.scale,\n        this.eqn.eqn.formDefaults.alignment.xAlign,\n        this.eqn.eqn.formDefaults.alignment.yAlign,\n        this.eqn.eqn.formDefaults.alignment.fixTo,\n      );\n    }\n  }\n\n  getText(): string {\n    let textToReturn = '';\n    const form = this.eqn.getCurrentForm();\n    if (form != null) {\n      const key = Object.keys(form.elements)[0];\n      // This is ok to fix for flow because all the elements of the\n      // simple equation created by Equationlabel will be Primitives\n      // $FlowFixMe\n      const textObject = form.elements[key].drawingObject;\n      // This is ok to fix for flow because all the elements of the\n      // simple equation created by Equationlabel will be Primitives\n      // that are text objects\n      if (textObject != null) {\n        // $FlowFixMe\n        textToReturn = textObject.text[0].text;\n      }\n    }\n    return textToReturn;\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  updateRotation(\n    position: Point,\n    lineAngle: number,\n    offsetMag: number,\n    location: 'top' | 'bottom' | 'left' | 'right' | 'positive' | 'negative' | 'start' | 'end' | 'inside' | 'outside',\n    subLocation: 'top' | 'bottom' | 'left' | 'right',\n    orientation: 'horizontal' | 'baseAway' | 'baseToLine' | 'upright',\n    parentAngleOffset: number = 0,\n    style: 'oval' | 'rectangle' = 'oval',\n    relativeToLine: boolean = true,\n    startThetaAngle: number = Math.PI * 2,\n    endThetaAngle: number = Math.PI,\n  ) {\n    // Calculate the offsetAngle and label angle\n    let offsetAngle = Math.PI / 2;\n    let labelAngle = 0;\n    if (location === 'start') {\n      offsetAngle = -Math.PI;\n    } else if (location === 'end') {\n      offsetAngle = 0;\n    } else {\n      const offsetTop = Math.cos(lineAngle + parentAngleOffset) < 0 ? -Math.PI / 2 : Math.PI / 2;\n      const offsetBottom = -offsetTop;\n      const offsetLeft = Math.sin(lineAngle + parentAngleOffset) > 0 ? Math.PI / 2 : -Math.PI / 2;\n      const offsetRight = -offsetLeft;\n\n      if (location === 'top') {\n        offsetAngle = offsetTop;\n      }\n      if (location === 'bottom') {\n        offsetAngle = offsetBottom;\n      }\n      if (location === 'right') {\n        offsetAngle = offsetRight;\n      }\n      if (location === 'left') {\n        offsetAngle = offsetLeft;\n      }\n      if (location === 'positive') {\n        offsetAngle = Math.PI / 2;\n      }\n      if (location === 'negative') {\n        offsetAngle = -Math.PI / 2;\n      }\n      if (round(Math.sin(lineAngle + parentAngleOffset), 4) === 0\n        && (location === 'left' || location === 'right')\n      ) {\n        if (subLocation === 'top') {\n          offsetAngle = offsetTop;\n        }\n        if (subLocation === 'bottom') {\n          offsetAngle = offsetBottom;\n        }\n      }\n      if (round(Math.cos(lineAngle + parentAngleOffset), 4) === 0\n        && (location === 'top' || location === 'bottom')\n      ) {\n        if (subLocation === 'right') {\n          offsetAngle = offsetRight;\n        }\n        if (subLocation === 'left') {\n          offsetAngle = offsetLeft;\n        }\n      }\n      if (location === 'inside') {\n        offsetAngle = -Math.PI / 2;\n      }\n      if (location === 'outside') {\n        offsetAngle = Math.PI / 2;\n      }\n    }\n\n    let parentAngle = parentAngleOffset;\n    if (orientation === 'horizontal') {\n      labelAngle = -lineAngle;\n    }\n\n    if (orientation === 'baseToLine') {\n      parentAngle = 0;\n      labelAngle = 0;\n      if (offsetAngle < 0) {\n        labelAngle = Math.PI;\n      }\n    }\n    if (orientation === 'baseAway') {\n      parentAngle = 0;\n      labelAngle = Math.PI;\n      if (offsetAngle < 0) {\n        labelAngle = 0;\n      }\n    }\n    if (orientation === 'upright') {\n      parentAngle = 0;\n      if (Math.cos(lineAngle + parentAngleOffset) < 0) {\n        labelAngle = Math.PI;\n      }\n    }\n\n    // half height and width of text\n    let h = 0;\n    let w = 0;\n    const currentForm = this.eqn.getCurrentForm();\n    let change = false;\n    if (currentForm != null) {\n      if (this.height !== currentForm.height) {\n        this.height = currentForm.height;\n        change = true;\n      }\n      if (this.width !== currentForm.width) {\n        this.width = currentForm.width;\n        change = true;\n      }\n      h = currentForm.height / 2;\n      w = currentForm.width / 2;\n    }\n    let positionOffset = new Point(0, 0);\n    if (style === 'oval') {\n      positionOffset = this.getOvalOffset(\n        labelAngle - parentAngle,\n        h, w, offsetMag, offsetAngle, change, location,\n        startThetaAngle, endThetaAngle,\n      );\n    }\n\n    let p;\n    let r;\n    p = position.add(positionOffset);\n    r = labelAngle - parentAngle;\n    if (relativeToLine === false) {\n      p = position.add(positionOffset).rotate(lineAngle, position);\n      r = labelAngle - parentAngle + lineAngle;\n    }\n    this.eqn.setPosition(p);\n    this.eqn.transform.updateRotation(r);\n\n    if (DEBUG) {  // $FlowFixMe\n      const e = this.eqn.parent._debugEllipse;\n      if (e != null) {\n        e.setPosition(p);\n        e.setRotation(r);\n      }\n    }\n  }\n\n  getOvalOffset(\n    labelAngle: number,\n    h: number,\n    w: number,\n    offsetMag: number,\n    offsetAngle: number,\n    change: boolean,\n    location: 'top' | 'bottom' | 'left' | 'right' | 'positive' | 'negative' | 'start' | 'end' | 'inside' | 'outside',\n    startThetaAngle: number = Math.PI * 2,\n    endThetaAngle: number = Math.PI,\n  ) {\n    // eslint-disable-next-line max-len\n    const getR = (a, b, angle) => a * b / Math.sqrt((b * Math.cos(angle)) ** 2 + (a * Math.sin(angle)) ** 2);\n\n    // Create an oval around the label by:\n    // * Find top corner of label\n    // * Find distance (R) and angle to top corner\n    // * The oval must go through this top corner\n    // * Find 'a' and 'b' of the oval so that 'a' and 'b' are the width and\n    //   height with the same offset (a = w + o), (b = h + o)\n    // * To find 'o', make an oval with o = offsetMag and see how close\n    //   its topCorner R is to the reference.\n    // * If it doesn't reach the top corner reference, then step o in fifths\n    //   of the delta until either 10 steps have occured, or the top corner\n    //   is covered.\n    if (change) {\n      const topCornerAngle = Math.atan(h / w);\n      const topCornerR = h / Math.sin(topCornerAngle) + offsetMag;\n      const delta = topCornerR - getR(w + offsetMag, h + offsetMag, topCornerAngle);\n      let i = 2;\n      let testR = -1;\n      let ovalOffset = 0;\n      while (i < 33 && testR < topCornerR) {\n        ovalOffset = delta * i * 0.1 + offsetMag;\n        testR = getR(w + ovalOffset, h + ovalOffset, topCornerAngle);\n        i += 1;\n      }\n      this.aOffset = ovalOffset;\n    }\n\n    const a = this.aOffset + w;\n    const b = this.aOffset + h;\n\n    const phi = clipAngle(labelAngle, '0to360');\n    let theta;\n    let xOffset = 0;\n    let yOffset = 0;\n    let R;\n    if (location === 'start') {\n      theta = startThetaAngle - phi;\n      R = getR(a, b, theta);\n      xOffset = -R * Math.cos(startThetaAngle);\n      yOffset = -R * Math.sin(startThetaAngle);\n    } else if (location === 'end') {\n      theta = endThetaAngle - phi;\n      R = getR(a, b, theta);\n      xOffset = -R * Math.cos(endThetaAngle);\n      yOffset = -R * Math.sin(endThetaAngle);\n    } else {\n      // Calculate the position\n      // Refer to oval_math.pdf for working\n      theta = clipAngle(Math.PI * 2 - Math.atan(-(b ** 2) / (a ** 2 * Math.tan(phi))), '0to360');\n      R = getR(a, b, theta);\n      let sigma = clipAngle(phi + theta - Math.PI, '-180to180');\n      if (sigma < 0) {\n        sigma += Math.PI;\n      }\n      xOffset = R * Math.cos(sigma);\n      yOffset = R * Math.sin(sigma);\n      if (offsetAngle < 0) {\n        yOffset = -yOffset;\n        xOffset = -xOffset;\n      }\n    }\n\n    // DEBUG ONLY\n    if (DEBUG) {\n      if (this.eqn.parent != null) {  // $FlowFixMe\n        if (this.eqn.parent._debugEllipse == null) {\n          const e = this.eqn.shapes.ellipse({\n            width: 1,\n            height: 0.5,\n            color: [0, 0, 1, 0.6],\n            sides: 50,\n          }); // $FlowFixMe\n          this.eqn.parent.add('debugEllipse', e);\n        } // $FlowFixMe\n        const e = this.eqn.parent._debugEllipse;\n        if (e != null) {\n          e.custom.update({\n            width: a * 2,\n            height: b * 2,\n          });\n        }\n      }\n    }\n\n    if (offsetMag === 0) {\n      return new Point(0, 0);\n    }\n    return new Point(xOffset, yOffset);\n  }\n}\n\nexport type TypeEquationLabel = EquationLabel;\n","// @flow\nimport WebGLInstance from '../webgl/webgl';\nimport {\n  Rect, Transform, Point,\n} from '../../tools/g2';\n\nimport { joinObjects } from '../../tools/tools';\n// import {\n//   FigureElementCollection,\n// } from '../Element';\nimport DrawContext2D from '../DrawContext2D';\n// import EquationNavigator from './EquationNavigator';\nimport CollectionsLine from './Line';\nimport CollectionsAngle from './Angle';\n// eslint-disable-next-line import/no-cycle\nimport CollectionsPolyline from './PolyLine';\nimport CollectionsAxis from './Axis';\nimport CollectionsTrace from './Trace';\nimport type { COL_Line } from './Line';\nimport type { COL_Angle } from './Angle';\nimport type { TypeLabelOptions } from './EquationLabel';\nimport type { COL_Polyline } from './PolyLine';\nimport type { COL_Axis } from './Axis';\nimport type { COL_Trace } from './Trace';\nimport type { COL_Plot } from './Plot';\nimport type { COL_Rectangle } from './Rectangle';\nimport EquationLabel from './EquationLabel';\nimport CollectionsPlot from './Plot';\nimport CollectionsPlotLegend from './Legend';\nimport CollectionsRectangle from './Rectangle';\nimport type { EQN_Equation } from '../Equation/Equation';\nimport { Equation } from '../Equation/Equation';\nimport type { OBJ_Collection } from '../FigurePrimitives/FigurePrimitives';\nimport EqnNavigator from './EqnNavigator';\nimport type { TypeNavigatorOptions } from './EqnNavigator';\nimport SlideNavigator from './SlideNavigator';\nimport type { COL_SlideNavigator } from './SlideNavigator';\nimport {\n  FigureElementCollection,\n} from '../Element';\nimport type { TypeColor } from '../../tools/types';\n// import { Equation } from '../Equation/Equation';\n\n/**\n * Built in figure collections.\n *\n * Provides advanced primitives the specific methods, animations and interactivity.\n */\nexport default class FigureCollections {\n  webgl: Array<WebGLInstance>;\n  draw2D: DrawContext2D;\n  limits: Rect;\n  primitives: Object;\n  // equationFromFig: Object;\n  isTouchDevice: boolean;\n  animateNextFrame: void => void;\n\n  /**\n    * @hideconstructor\n    */\n  constructor(\n    primitives: Object,\n    // equation: Object,\n    isTouchDevice: boolean,\n    animateNextFrame: () => void,\n  ) {\n    this.webgl = primitives.webgl;\n    this.draw2D = primitives.draw2D;\n    this.limits = primitives.limits;\n    this.primitives = primitives;\n    this.isTouchDevice = isTouchDevice;\n    this.animateNextFrame = animateNextFrame;\n    // this.equationFromFig = equation;\n  }\n\n  /**\n   * Create a {@link FigureElementCollection}.\n   */\n  collection(\n    transformOrPointOrOptions: Transform | Point | OBJ_Collection = {},\n    ...moreOptions: Array<OBJ_Collection>\n  ) {\n    const defaultOptions = {\n      transform: new Transform('collection').scale(1, 1).rotate(0).translate(0, 0),\n      border: 'children',\n      touchBorder: 'children',\n      holeBorder: 'children',\n      color: this.primitives.defaultColor,\n      parent: null,\n      limits: this.limits,\n    };\n    let optionsToUse;\n    if (transformOrPointOrOptions instanceof Point) {\n      defaultOptions.transform.updateTranslation(transformOrPointOrOptions);\n      optionsToUse = joinObjects({}, defaultOptions, ...moreOptions);\n    } else if (transformOrPointOrOptions instanceof Transform) {\n      defaultOptions.transform = transformOrPointOrOptions._dup();\n      optionsToUse = joinObjects({}, defaultOptions, ...moreOptions);\n    } else {\n      optionsToUse = joinObjects({}, defaultOptions, transformOrPointOrOptions, ...moreOptions);\n    }\n    // if (optionsToUse.border != null) {\n    //   optionsToUse.border = getBorder(optionsToUse.border);\n    // }\n    // if (optionsToUse.touchBorder != null) {\n    //   optionsToUse.touchBorder = getBorder(optionsToUse.touchBorder);\n    // }\n    // if (optionsToUse.holeBorder != null) {\n    //   optionsToUse.holeBorder = getBorder(optionsToUse.holeBorder);\n    // }\n    // console.log(optionsToUse.transform, transformOrPointOrOptions)\n    const element = new FigureElementCollection(optionsToUse);\n    element.dimColor = this.primitives.defaultDimColor.slice();\n    // console.log(element)\n    // element.setColor(color);\n    if (\n      optionsToUse.pulse != null\n      && typeof element.pulseDefault !== 'function'\n      && typeof element.pulseDefault !== 'string'\n    ) {\n      element.pulseDefault.scale = optionsToUse.pulse;\n    }\n\n    element.collections = this;\n    return element;\n  }\n\n  /**\n   * Create a {@link CollectionsLine}.\n   */\n  line(...options: Array<COL_Line>) {\n    // const optionsToUse = Object.assign({}, ...options);\n    // console.log(Object.assign({}, ...options))\n    const optionsToUse = joinObjects({}, ...options);\n    return new CollectionsLine(\n      this, this.isTouchDevice,\n      optionsToUse,\n    );\n  }\n\n  /**\n   * Create a {@link CollectionsAngle}.\n   */\n  angle(...options: Array<COL_Angle>) {\n    const optionsToUse = joinObjects({}, ...options);\n    return new CollectionsAngle(\n      this, this.isTouchDevice, this.animateNextFrame,\n      optionsToUse,\n    );\n  }\n\n  label(...options: Array<TypeLabelOptions>) {\n    // const optionsToUse = Object.assign({}, ...options);\n    const optionsToUse = joinObjects({}, ...options);\n    return new EquationLabel(\n      this, optionsToUse,\n    );\n  }\n\n  /**\n   * Create a {@link CollectionsPolyline}.\n   */\n  polyline(...options: Array<COL_Polyline>) {\n    const optionsToUse = joinObjects({}, ...options);\n    return new CollectionsPolyline(\n      this,\n      this.isTouchDevice, this.animateNextFrame,\n      optionsToUse,\n    );\n  }\n\n  /**\n   * Create a {@link CollectionsRectangle}.\n   */\n  rectangle(...options: Array<COL_Rectangle>) {\n    return new CollectionsRectangle(this, joinObjects({}, ...options));\n  }\n\n  /**\n   * Create a {@link CollectionSlideNavigator}\n   */\n  slideNavigator(...options: Array<COL_SlideNavigator>) {\n    return new SlideNavigator(this, joinObjects({}, ...options));\n  }\n\n  /**\n   * Create a {@link CollectionsAixs}.\n   */\n  axis(...options: Array<COL_Axis>) {\n    return new CollectionsAxis(this, joinObjects({}, ...options));\n  }\n\n  /**\n   * Create a {@link CollectionsTrace}.\n   */\n  trace(...options: Array<COL_Trace>) {\n    return new CollectionsTrace(this, joinObjects({}, ...options));\n  }\n\n  /**\n   * Create a {@link CollectionsPlot}.\n   */\n  plot(...options: Array<COL_Plot>) {\n    return new CollectionsPlot(this, joinObjects({}, ...options));\n  }\n\n  /**\n   * Create a {@link CollectionsLegend}.\n   */\n  plotLegend(...options: Array<COL_Plot>) {\n    return new CollectionsPlotLegend(this, joinObjects({}, ...options));\n  }\n\n  /**\n   * Create a {@link Equation}.\n   */\n  equation(\n    options: EQN_Equation,\n  ) {\n    const equation = new Equation(this.primitives, options);\n    return equation;\n  }\n\n  addEquation(\n    parent: FigureElementCollection,\n    name: string,\n    options: EQN_Equation = {},\n  ) {\n    // $FlowFixMe\n    const equation = new Equation(this.primitives, options);\n    parent.add(name, equation);\n    return equation;\n  }\n\n  addNavigator(\n    parent: FigureElementCollection,\n    name: string,\n    options: TypeNavigatorOptions,\n  ) {\n    let navNameToUse = name;\n    const optionsToUse = joinObjects({}, options);\n    if (optionsToUse.equation == null) {                // $FlowFixMe\n      const equation = this.addEquation(parent, `${name}Eqn`, options);\n      optionsToUse.equation = equation;\n      navNameToUse = `${name}Nav`;\n    } else if (!(optionsToUse.equation instanceof Equation)) {\n      // let methodPathToUse;\n      let nameToUse;\n      // let pathToUse;\n      let eqnOptions;\n      let elementModsToUse;\n      // let addElementsToUse;\n      let firstScenario;\n      if (Array.isArray(optionsToUse.equation)) {\n        [, nameToUse, , eqnOptions,\n          elementModsToUse, , firstScenario,\n        ] = optionsToUse.equation;\n      } else {\n        nameToUse = optionsToUse.equation.name;\n        // pathToUse = optionsToUse.equation.path;\n        eqnOptions = optionsToUse.equation.options;\n        // methodPathToUse = optionsToUse.equation.method;\n        elementModsToUse = optionsToUse.equation.mods;\n        firstScenario = optionsToUse.equation.scenario;\n      }\n\n      let equation;\n      if (Array.isArray(eqnOptions)) {\n        equation = this.addEquation(parent, nameToUse, ...eqnOptions);\n      } else {\n        equation = this.addEquation(parent, nameToUse, eqnOptions);\n      }\n\n      if (elementModsToUse != null && elementModsToUse !== {}) {\n        equation.setProperties(elementModsToUse);\n      }\n      if (firstScenario != null && firstScenario in equation.scenarios) {\n        equation.setScenario(firstScenario);\n      }\n      optionsToUse.equation = equation;\n    }\n    // $FlowFixMe\n    const navigator = new EqnNavigator(\n      this.primitives,\n      this.animateNextFrame,\n      optionsToUse,\n    );\n    parent.add(navNameToUse, navigator);\n    return navigator;\n  }\n\n  cursor(\n    optionsIn: {\n      color: TypeColor,\n      width: number,\n      radius: number,\n    },\n  ) {\n    const defaultOptions = {\n      color: this.primitives.defaultColor,\n      width: 0.01,\n      radius: 0.05,\n    };\n    const options = joinObjects(defaultOptions, optionsIn);\n    const cursor = this.collection();\n    const polygon = {\n      width: options.width,\n      color: options.color,\n      radius: options.radius,\n      sides: 50,\n    };\n    const up = this.primitives.polygon(polygon);\n    const down = this.primitives.polygon(joinObjects({}, polygon));\n    cursor.add('up', up);\n    cursor.add('down', down);\n    return cursor;\n  }\n}\n","// @flow\n\n// import Figure from '../Figure';\nimport {\n  Transform, Point,\n  getPoint, getPoints,\n} from '../../tools/g2';\nimport type { TypeParsablePoint } from '../../tools/g2';\n// import {\n//   round,\n// } from '../../tools/math';\nimport { joinObjects } from '../../tools/tools';\nimport {\n  FigureElementCollection, FigureElementPrimitive,\n} from '../Element';\nimport type CollectionsTrace, { COL_Trace } from './Trace';\nimport type { OBJ_Font, OBJ_Font_Fixed } from '../../tools/types';\nimport type {\n  OBJ_TextLines, OBJ_Collection,\n} from '../FigurePrimitives/FigurePrimitives';\nimport type { TypePlotFrame } from './Plot';\nimport type FigureCollections from './FigureCollections';\n\n/**\n * Legend customization for a single trace sample in the legend.\n *\n * @property {OBJ_Font} [font] default font\n * @property {number} [length] length of the line sample\n * @property {TypeParsablePoint} [offset] offset of this trace sample from\n * the last trace sample\n * @property {number} [space] space between line sample and text\n * @property {boolean} [fontColorIsLineColor] use line color as font color\n * @property {OBJ_TextLines | 'string'} [text] custom text\n * @property {TypeParsablePoint} [position] position of the trace sample\n */\nexport type OBJ_PlotLegendCustomTrace = {\n  font?: OBJ_Font,\n  length?: number,\n  offset?: TypeParsablePoint,\n  space?: number,\n  fontColorIsLineColor?: boolean,\n  text?: OBJ_TextLines | 'string',\n  position?: TypeParsablePoint,\n};\n\n/**\n * Legend customization options object\n *\n * Allows customization of specific trace samples in the legend.\n * `_arrayIndexOrName` represents a generic key that should actually\n * be the array index of the specific trace defined in {@link COL_PlotLegend}\n * or the name of the trace. See examples in {@link CollectionsPlotLegend} for use.\n *\n * @property {OBJ_PlotLegendCustomTrace} [_arrayIndexOrName]\n */\nexport type OBJ_PlotLegendCustom = {\n  [_arrayIndexOrName: string]: OBJ_PlotLegendCustomTrace;\n};\n\n/**\n * {@link CollectionsPlotLegend} options object that extends {@link OBJ_Collection}\n * options object (without `parent`).\n *\n * A legend consists of a number of trace samples and their corresponding names,\n * and may have an encompassing frame with a border and fill.\n *\n * @extends OBJ_Collection\n *\n * @property {TypeParsablePoint} [position] position of the first trace in the\n * legend\n * @property {number} [length] length of the line sample\n * @property {number} [space] space between the line and the text\n * @property {Array<TypeParsablePoint> | TypeParsablePoint} [offset] offset\n * between trace samples - can be used to space out a legend, or make it\n * horizontal\n * @property {OBJ_Font} [font] default font for trace sample text\n * @property {boolean} [fontColorIsLineColor] set the trace sample text color to\n * the same as the line sample\n * @property {Array<number> | TypePlotFrame} [frame] frame around the legend -\n * specifying just a color will create a solid fill rectangle of that color\n * @property {Array<number>} [show] array of which trace indeces to show if only\n * some should be shown\n * @property {Array<number>} [hide] array of which trace indeces to hide if some\n * should be hidden\n * @property {OBJ_PlotLegendCustom} [custom] customizations to specific trace\n * samples\n * @property {Array<COL_Trace>} [traces] the traces from the plot that this\n * legend will display. This is used by {@link CollectionsPlot} and should not be\n * used by the user.\n */\nexport type COL_PlotLegend = {\n  position?: TypeParsablePoint,\n  length?: number, // 0 = text only\n  space?: number,\n  offset?: Array<TypeParsablePoint> | TypeParsablePoint,\n  font?: OBJ_Font,\n  fontColorIsLineColor?: boolean,\n  frame?: Array<number> | TypePlotFrame,\n  show?: Array<number>,\n  hide?: Array<number>,\n  custom?: OBJ_PlotLegendCustom,\n  traces: Array<COL_Trace>,\n} & OBJ_Collection;\n\n\n/*\n................##.......########..######...########.##....##.########.\n................##.......##.......##....##..##.......###...##.##.....##\n................##.......##.......##........##.......####..##.##.....##\n................##.......######...##...####.######...##.##.##.##.....##\n................##.......##.......##....##..##.......##..####.##.....##\n................##.......##.......##....##..##.......##...###.##.....##\n................########.########..######...########.##....##.########.\n*/\n/**\n * {@link FigureElementCollection} representing an legend.\n *\n * ![](./apiassets/advlegend_ex1.png)\n * ![](./apiassets/advlegend_ex2.png)\n *\n * ![](./apiassets/advlegend_ex3.png)\n * ![](./apiassets/advlegend_ex4.png)\n *\n * ![](./apiassets/advlegend_ex5.png)\n *\n * This object defines a legend in an {@link CollectionsPlot}.\n *\n * The legend includes traces, trace names and a frame. Each can be customized\n * using the {@link COL_PlotLegend} options object.\n *\n * To test examples below, append them to the\n * <a href=\"#drawing-boilerplate\">boilerplate</a>.\n *\n * All examples below also use this power function to generate the traces:\n * ```javascript\n * const pow = (pow = 2, stop = 10, step = 0.05) => {\n *   const xValues = Fig.tools.math.range(0, stop, step);\n *   return xValues.map(x => new Fig.Point(x, x ** pow));\n * }\n * ```\n *\n * @example\n * // By default, the legend will appear in the top right corner\n * figure.add({\n *   name: 'plot',\n *   method: 'collections.plot',\n *   options: {\n *     trace: [\n *       { points: pow(2), name: 'Power 2' },\n *       { points: pow(2.5), name: 'Power 2.5' },\n *       {\n *         points: pow(3, 10, 0.5),\n *         name: 'Power 3',\n *         markers: { radius: 0.03, sides: 10 },\n *       },\n *     ],\n *     legend: true,\n *   },\n * });\n *\n * @example\n * // Change the line length, position and use a frame on the legend\n * figure.add({\n *   name: 'plot',\n *   method: 'collections.plot',\n *   options: {\n *     trace: [\n *       { points: pow(2), name: 'Power 2' },\n *       { points: pow(2.5), name: 'Power 2.5' },\n *       {\n *         points: pow(3, 10, 0.5),\n *         name: 'Power 3',\n *         markers: { radius: 0.03, sides: 10 },\n *       },\n *     ],\n *     legend: {\n *       length: 0.5,\n *       frame: [0.95, 0.95, 0.95, 1],\n *       position: [0.2, 1.8],\n *     },\n *   },\n * });\n *\n * @example\n * // Make a horizontal legend\n * figure.add({\n *   name: 'plot',\n *   method: 'collections.plot',\n *   options: {\n *     trace: [\n *       { points: pow(2), name: 'Power 2' },\n *       { points: pow(2.5), name: 'Power 2.5' },\n *       {\n *         points: pow(3, 10, 0.5),\n *         name: 'Power 3',\n *         markers: { radius: 0.03, sides: 10 },\n *       },\n *     ],\n *     legend: {\n *       offset: [0.9, 0],\n *       position: [-0.3, -0.5],\n *       frame: {\n *         line: { width: 0.005 },\n *         corner: { radius: 0.05, sides: 10 },\n *       },\n *     },\n *   },\n * });\n *\n * @example\n * // Customize legend trace text\n * figure.add({\n *   name: 'plot',\n *   method: 'collections.plot',\n *   options: {\n *     trace: [\n *       { points: pow(2), name: 'Power 2' },\n *       { points: pow(2.5), name: 'Power 2.5' },\n *       {\n *         points: pow(3, 10, 0.5),\n *         name: 'Power 3',\n *         markers: { radius: 0.03, sides: 10 },\n *       },\n *     ],\n *     legend: {\n *       offset: [0, -0.2],\n *       custom: {\n *         1: {\n *           font: { size: 0.1, style: 'italic', color: [1, 0, 0, 1] },\n *           text: {\n *             text: [\n *               'Power 2.5',\n *               {\n *                 text: 'Reference Trace',\n *                 font: { size: 0.06 },\n *                 lineSpace: 0.06,\n *               },\n *             ],\n *             justify: 'left',\n *           },\n *         },\n *       },\n *     },\n *   },\n * });\n *\n * @example\n * // Customize legend\n * figure.add({\n *   name: 'plot',\n *   method: 'collections.plot',\n *   options: {\n *     trace: [\n *       { points: pow(2), name: 'Power 2' },\n *       { points: pow(2.5), name: 'Power 2.5' },\n *       {\n *         points: pow(3, 10, 0.5),\n *         name: 'Power 3',\n *         markers: { radius: 0.03, sides: 10 },\n *       },\n *     ],\n *     legend: {\n *       fontColorIsLineColor: true,\n *       length: 0,\n *       custom: {\n *         0: { position: [2, 0.2] },\n *         1: { position: [2, 0.7] },\n *         'Power 3': { position: [2, 2] },\n *       }\n *     },\n *   },\n * });\n */\n// $FlowFixMe\nclass CollectionsPlotLegend extends FigureElementCollection {\n  // Figure elements\n  _frame: ?FigureElementPrimitive;\n  // _axis: ?CollectionsAxis;\n  // _majorTicks: ?FigureElementPrimitive;\n  // _minorTicks: ?FigureElementPrimitive;\n  // _labels: ?FigureElementPrimitive;\n  // _arrow1: ?FigureElementPrimitive;\n  // _arrow2: ?FigureElementPrimitive;\n\n  defaultFont: OBJ_Font_Fixed;\n\n  traces: Array<CollectionsTrace>;\n  offset: Array<Point>;\n\n  toShow: Array<number>;\n\n  /**\n   * @hideconstructor\n   */\n  constructor(\n    collections: FigureCollections,\n    optionsIn: COL_PlotLegend,\n  ) {\n    const defaultOptions = {\n      font: collections.primitives.defaultFont,\n      color: collections.primitives.defaultColor,\n      fontColorIsLineColor: false,\n      frame: false,\n      custom: {},\n      length: collections.primitives.defaultLength / 10,\n      space: 0.05,\n      position: new Point(0, 0),\n      transform: new Transform('PlotLegend').scale(1, 1).rotate(0).translate(0, 0),\n      limits: collections.primitives.limits,\n    };\n    const options = joinObjects({}, defaultOptions, optionsIn);\n\n    super(options);\n    this.setPosition(0, 0);\n    this.collections = collections;\n\n    this.defaultFont = options.font;\n    this.defaultColor = options.color;\n    this.traces = options.traces;\n\n    this.toShow = this.getTracesToShow(options);\n    this.offset = this.getOffset(options);\n    this.addTraces(options);\n    if (options.frame != null && options.frame !== false) {\n      this.addFrame(options.frame);\n      this.toBack('frame');\n    }\n  }\n\n  getTraceIndex(name: string | number) {\n    if (typeof name === 'number') {\n      return name;\n    }\n    for (let i = 0; i < this.traces.length; i += 1) {\n      if (name === this.traces[i].name) {\n        return i;\n      }\n    }\n    return -1;\n  }\n\n  getTracesToShow(o: { show?: number, hide?: number }) {\n    let toShow = [...Array(this.traces.length).keys()];\n    if (o.show) {\n      toShow = [];\n      let showToUse = o.show;\n      if (typeof showToUse === 'number') {\n        showToUse = [showToUse];\n      }\n      showToUse.forEach((index) => {\n        const traceIndex = this.getTraceIndex(index);\n        if (traceIndex !== -1) {\n          toShow.push(traceIndex);\n        }\n      });\n    }\n    if (o.hide) {\n      let hideToUse = o.hide;\n      if (typeof hideToUse === 'number') {\n        hideToUse = [hideToUse];\n      }\n      hideToUse.forEach((index) => {\n        const traceIndex = this.getTraceIndex(index);\n        if (traceIndex !== -1 && toShow.indexOf(traceIndex) !== -1) {\n          toShow.splice(traceIndex, 1);\n        }\n      });\n    }\n    return toShow;\n  }\n\n  getOffset(o: { offset: Array<TypeParsablePoint> | TypeParsablePoint }) {\n    const offsetArray = [];\n    let { offset } = o;\n    if (offset == null) {\n      offset = [new Point(0, -this.defaultFont.size * 1.5)];\n    }\n    offset = getPoints(offset);\n    for (let i = 0; i < this.toShow.length; i += 1) {\n      offsetArray.push(offset[i % offset.length]._dup());\n    }\n    return offsetArray;\n  }\n\n  addTraces(o: COL_PlotLegend) {\n    let p = new Point(0, 0);\n    this.toShow.forEach((traceIndex, index) => {\n      const trace = this.traces[traceIndex];\n\n      // Get any trace specific customizations\n      let custom = {};                              // $FlowFixMe\n      if (o.custom[`${index}`] != null) {           // $FlowFixMe\n        custom = o.custom[`${index}`];              // $FlowFixMe\n      } else if (o.custom[trace.name] != null) {\n        custom = o.custom[trace.name];\n      }\n      if (index === 0 && custom.position == null) {\n        custom.position = getPoint(o.position || [0, 0]);\n      }\n\n      // Trace specific options\n      const oTrace = joinObjects({}, {\n        length: o.length,\n        font: o.font,\n        fontColorIsLineColor: o.fontColorIsLineColor,\n        offset: this.offset[index],\n        space: o.space,\n        text: trace.name,\n      }, custom);\n\n      // Get final position of trace start\n      if (oTrace.position != null) {\n        p = getPoint(oTrace.position);\n      } else {\n        p = p.add(getPoint(oTrace.offset));\n      }\n\n      // Add trace line (if exists)\n      if (oTrace.length > 0 && trace.line != null) {\n        const oLine = joinObjects({}, trace.line, {\n          p1: p,\n          length: oTrace.length,\n          angle: 0,\n        });\n        const line = this.collections.primitives.line(oLine);\n        this.add(`line${traceIndex}`, line);\n      }\n\n      // Add trace marker (if exists)\n      if (oTrace.length > 0 && trace.markers != null) {\n        const oMarker = joinObjects({}, trace.markers, {\n          position: new Point(p.x + oTrace.length / 2, p.y),  // $FlowFixMe\n          copy: trace.markers.copy.slice(0, -1),\n        });\n        const marker = this.collections.primitives.polygon(oMarker);\n        this.add(`marker${traceIndex}`, marker);\n      }\n\n      // Add trace text\n      const textOptions = {\n        font: this.defaultFont,\n        justify: 'center',\n        xAlign: 'left',\n        yAlign: 'middle',\n        position: new Point(p.x + oTrace.length + oTrace.space, p.y),\n      };\n      if (custom.font != null) {\n        textOptions.font = joinObjects({}, textOptions.font, custom.font);\n      }\n      let textOptionsToUse = oTrace.text;\n      if (typeof oTrace.text === 'string') {\n        textOptionsToUse = { text: [oTrace.text] };\n      }\n      if (typeof custom.text === 'string') { // $FlowFixMe\n        custom.text = { text: [custom.text] };\n      }\n      let colorOverride = {};\n      if (o.fontColorIsLineColor) {\n        colorOverride = { font: { color: trace.color.slice() } };\n      }\n      const oText = joinObjects({}, textOptions, colorOverride, textOptionsToUse, custom.text);\n      // o.offset = getPoint(o.offset);\n      const traceName = this.collections.primitives.textLines(oText);\n      this.add(`trace${traceIndex}`, traceName);\n    });\n  }\n\n  addFrame(optionsIn: Object | boolean | Array<number>) {\n    let o = optionsIn;\n    if (optionsIn === true) {\n      o = {};\n    } else if (Array.isArray(optionsIn)) {\n      o = { fill: optionsIn };\n    }\n    // const bounds = this.getBoundingRect('draw');\n    const defaultFrameOptions = {\n      // space: Math.min(bounds.width, bounds.height) / 20,\n      space: this.defaultFont.size,\n      // line: { width: 0.01 },\n    };\n    if (optionsIn.line == null && optionsIn.fill == null) { // $FlowFixMe\n      defaultFrameOptions.line = { width: 0.01 };\n    }\n\n    const oFrame = joinObjects({}, defaultFrameOptions, o);\n    if (oFrame.line != null && oFrame.line.color == null) {\n      oFrame.line.color = this.defaultColor.slice();\n    }\n    const frame = this.collections.rectangle(oFrame);\n    frame.surround(this, oFrame.space);\n    this.add('frame', frame);\n  }\n\n  // _getStateProperties(options: Object) {  // eslint-disable-line class-methods-use-this\n  //   return [...super._getStateProperties(options),\n  //     'angle',\n  //     'lastLabelRotationOffset',\n  //   ];\n  // }\n\n  // _fromState(state: Object) {\n  //   joinObjects(this, state);\n  //   this.setAngle({\n  //     angle: this.angle,\n  //     rotationOffset: this.lastLabelRotationOffset,\n  //   });\n  //   return this;\n  // }\n}\n\nexport default CollectionsPlotLegend;\n","// @flow\n\n// import Figure from '../Figure';\nimport {\n  Transform, Point, Line, normAngle, getBoundingBorder,\n} from '../../tools/g2';\n// import {\n//   mul,\n// } from '../../tools/m2';\nimport type { TypeParsablePoint, TypeParsableBuffer, TypeBorder } from '../../tools/g2';\nimport {\n  roundNum,\n} from '../../tools/math';\nimport {\n  FigureElementCollection, FigureElementPrimitive,\n} from '../Element';\nimport EquationLabel from './EquationLabel';\nimport type {\n  TypeLabelOrientation, TypeLabelLocation, TypeLabelSubLocation,\n} from './EquationLabel';\n// import type { TypeLabelEquationOptions } from './EquationLabel';\nimport { joinObjects } from '../../tools/tools';\nimport { Equation } from '../Equation/Equation';\nimport type { TypeWhen } from '../webgl/GlobalAnimation';\nimport { simplifyArrowOptions, getArrowLength } from '../geometries/arrow';\nimport type { OBJ_LineArrows, OBJ_LineArrow, TypeArrowHead } from '../geometries/arrow';\nimport type { OBJ_Pulse, FigureElement } from '../Element';\nimport type { EQN_Equation } from '../Equation/Equation';\nimport * as animation from '../Animation/Animation';\nimport type { OBJ_CustomAnimationStep, OBJ_TriggerAnimationStep } from '../Animation/Animation';\nimport type { TypeColor, TypeDash } from '../../tools/types';\nimport type FigurePrimitives, { OBJ_Collection } from '../FigurePrimitives/FigurePrimitives';\nimport type FigureCollections from './FigureCollections';\n\n\n/**\n * Width pulse options object.\n *\n * @property {number} [line] width scale\n * @property {number | OBJ_Pulse} [label] label pulse options or scale. Use\n * the options object for more control of how the label is pulsed (for example\n * if the label should be pulsed from its bottom rather than its center).\n * @property {number} [arrow] arrow pulse scale\n * @property {function(): void} [done] execute when pulsing is finished\n * @property {number} [duration] pulse duration in seconds\n * @property {number} [frequency] pulse frequency in pulses per second\n * @property {TypeWhen} [when] when to start the pulse (`'nextFrame'`)\n */\nexport type OBJ_PulseWidth = {\n  line?: number,\n  label?: number | OBJ_Pulse,\n  arrow?: number,\n  done?: ?() => void,\n  duration?: number,\n  when?: TypeWhen,\n  frequency?: number,\n}\n\n/**\n * Collections line label options object.\n *\n * A line can be annotated with a label using the `text` property and can be:\n * - text (`string`, or Array<`string`)\n * - an equation (`Equation`, `EQN_Equation`)\n * - real length of line (`null`)\n *\n * In all cases, an actual {@link Equation} is created as the label. The\n * equation can have multiple forms, which can be set using the `showForm`\n * method.\n *\n * If `text`: `string`, then an equation with a single form named `base` will\n * be created with a single element being the string text.\n *\n * If `text`: `Array<string>`, then an equation with a form for each element\n * of the array is created. Each form is named '0', '1', '2'... corresponding\n * with the index of the array. Each form is has a single element, being the\n * text at that index.\n *\n * Use `text`: `Equation` or `EQN_Equation` to create completely custom\n * equations with any forms desirable.\n *\n * If the label text is the real length of the line (`null`), then the number\n * of decimal places can be selected with `precision`.\n *\n * The space between the line and the label is defined with `offset`. An\n * `offset` of 0 puts the center of the label on the line. Any\n * positive or negative value of offset will move the label so no part of the\n * label overlaps the line, and then the closest part of the label is separated\n * from the line by `offset`.\n *\n * To situate the label on the line, use `linePosition`, `location` and\n * `subLocation`. By default the label will be a percentage `linePosition`\n * along the line. `location` then defines which side of the line the label is\n * on, while `subLocation` defines the backup location for invalid cases of\n * `location`. See {@link TypeLabelLocation} and\n * {@link TypeLabelSubLocation}. `location` can additionaly place the\n * labels off the ends of the line.\n *\n * To automatically update the label location and orientation as the line\n * transform (translation, rotation or scale) changes then use `update: true`.\n *\n * @see {@link COL_Line}\n *\n * @property {null | string | Array<string> | Equation | EQN_Equation } text\n * @property {number} [precision]\n * @property {number} [offset]\n * @property {number} [linePosition]\n * @property {TypeLabelLocation} [location]\n * @property {TypeLabelSubLocation} [subLocation]\n * @property {TypeLabelOrientation} [orientation]\n * @property {boolean} [update] (`false`)\n * @property {number} [scale] size of the label\n * @property {TypeColor} [color]\n */\nexport type OBJ_LineLabel = {\n  text: null | string | Array<string> | Equation | EQN_Equation,\n  precision?: number,\n  offset?: number,\n  linePosition?: number,\n  location?: TypeLabelLocation,\n  subLocation?: TypeLabelSubLocation,\n  orientation?: TypeLabelOrientation,\n  update?: boolean,\n  scale?: number,\n  color?: TypeColor,\n};\n\n\n/**\n * Line move options object.\n *\n * The `'centerTranslateEndRotation`' movement will move the line\n * when touched within the `middleLength` percentage of the line\n * and rotate it otherwise.\n *\n * @property {boolean} [movable] `true` to make movable (`true`)\n * @property {'translation' | 'rotation' | 'centerTranslateEndRotation' | 'scale'} [type]\n * @property {number} [middleLength] length of the middle section of line that\n * allows for translation movement in percent of total length (`0.333`)\n * @property {boolean} [includeLabelInTouchBoundary] `true` to include the\n * line's label in the touch boundary for `'centerTranslateEndRotation'`\n * ('false`)\n */\nexport type OBJ_LineMove = {\n  // movable?: boolean,\n  type?: 'translation' | 'rotation' | 'centerTranslateEndRotation' | 'scale',\n  middleLength?: number,\n  includeLabelInTouchBoundary?: boolean,\n}\n\n/**\n * setMovable options object for {@link COL_Line}.\n *\n * @extends OBJ_LineMove\n *\n * @property {boolean} [movable] `true` to make movable (`true`)\n */\nexport type OBJ_MovableLine = {\n  movable?: boolean,\n} & OBJ_LineMove;\n\n/**\n * {@link CollectionsLine} options object that extends {@link OBJ_Collection}\n * options object (without `parent`).\n *\n *\n * The Collections Line is a convient and powerful line\n * {@link FigureElementCollection} that includes the line, arrows, a label\n * annotation and some methods to make it convient to use dynamically.\n *\n * A line can either be defined by its two end points (`p1`, `p2`), or a\n * point (`p1`), `length` and `angle`.\n *\n * `offset` can be used to draw the line some offset away from the line\n * definition where a positive offset is on the side of the line that the line\n * rotates toward when rotating in the positive direction. This is especially\n * useful for creating lines that show dimensions of shapes.\n *\n * The line also has a control point which is positioned on the line with the\n * `align` property. The control point is the line's center of rotation, and\n * fixes the point from which the line changes length. This is also the point\n * where the line collection position will be if `getPosition` is called on the\n * element.\n *\n * For instance, setting the control point at `align: 'start'` will mean that\n * if the line can rotate, it will rotate around `p1`, and if the length is\n * changed, then `p1` will remain fixed while `p2` changes.\n *\n * `width` sets the width of the line. Setting the width to 0 will hide the\n * line itself, but if arrows or a label are defined they will still be\n * displayed.\n *\n * Use the `label` property to define and position a label relative to the line.\n * The label can be any string, equation or the actual length of the line and\n * be oriented relative to the line or always be horizontal.\n *\n * Use the `arrow` and `dash` properties to define arrows and the line style.\n *\n * Pulsing this collection normally would pulse both the length and width of\n * the line. If it often desirable to pulse a line without changing its length,\n * and so this collection provides a method `pulseWidth` to allow this. This\n * options object can define the default values for pulseWidth if desired.\n *\n * Default pulse values can then be specified with the `pulse` property.\n *\n * @extends OBJ_Collection\n *\n * @property {TypeParsablePoint} [p1] First point of line\n * @property {TypeParsablePoint} [p2] Will override `length`/`angle` definition\n * @property {number} [angle] line angle\n * @property {number} [length]  line length\n * @property {number} [offset] line offset\n * @property {'start' | 'end' | 'center' | number} [align] rotation center of\n * line (only needed if rotating line)\n * @property {number} [width] line width\n * @property {OBJ_LineLabel} [label] label annotation\n * @property {OBJ_LineArrows | TypeArrowHead} [arrow] line arrow(s)\n * @property {TypeDash} [dash] make the line dashed\n * @property {OBJ_PulseWidth} [pulseWidth] default options for pulseWidth pulse\n * @property {OBJ_Pulse} [pulse] default options for normal pulse\n * @property {OBJ_LineMove} [move] line move options\n */\nexport type COL_Line = {\n  p1?: TypeParsablePoint,\n  p2?: TypeParsablePoint,\n  length?: number,\n  angle?: number,\n  offset?: number,\n  align?: 'start' | 'end' | 'center' | number,\n  width?: number,\n  label?: OBJ_LineLabel,\n  arrow?: OBJ_LineArrows | TypeArrowHead;\n  dash?: TypeDash,\n  pulseWidth?: OBJ_PulseWidth,\n  pulse?: OBJ_Pulse;\n  move?: OBJ_LineMove;\n} & OBJ_Collection;\n\n\n// Line is a class that manages:\n//   A straight line\n//   Arrows\n//   Label\n//   Future: Dimension posts\n//\n// In the straight line draw space, the line is defined from 0,0 to 1,0 if\n// solid, and 0,0 to maxLength,0 if dashed. The length is changed by scaling\n// the solid line, and changing the number of points drawn for the dashed line.\n// The straight line position transform is then used to position the horiztonal\n// line to make its 'start', 'center', 'end' or number align at (0, 0).\n//\n// Arrows are defined in draw space so their tip is at (0, 0). Their position\n// transform then places their tips at p1 and p2 of the line.\n//\n\nclass LineLabel extends EquationLabel {\n  offset: number;\n  location: TypeLabelLocation;\n  subLocation: TypeLabelSubLocation;\n  orientation: TypeLabelOrientation;\n  linePosition: number;\n  precision: number;\n\n  constructor(\n    collections: FigureCollections,\n    labelText: string | Equation | EQN_Equation | Array<string>,\n    color: TypeColor,\n    offset: number,\n    location: TypeLabelLocation = 'top',\n    subLocation: TypeLabelSubLocation = 'left',\n    orientation: TypeLabelOrientation = 'horizontal',\n    linePosition: number = 0.5,     // number where 0 is end1, and 1 is end2\n    scale: number = 0.7,\n    precision: number = 1,\n  ) {\n    super(collections, { label: labelText, color, scale });\n    this.offset = offset;\n    this.location = location;\n    this.subLocation = subLocation;\n    this.orientation = orientation;\n    this.linePosition = linePosition;\n    this.precision = precision;\n  }\n}\n\nfunction makeStraightLine(\n  primitives: FigurePrimitives,\n  length: number,\n  width: number,\n  color: TypeColor,\n  dash: TypeDash,\n  // maxLength: number,\n  // touchBorder: number | { width: number, start: number, end: number },\n): FigureElement {  // $FlowFixMe\n  const straightLine = primitives.line({\n    p1: [0, 0],\n    length: dash.length < 2 ? 1 : length,\n    angle: 0,\n    width,\n    color,\n    dash,\n    transform: new Transform().scale(1, 1).translate(0, 0),\n    // touchBorder,\n  });\n\n  return straightLine;\n}\n\nfunction getLineFromOptions(options: {\n  p1?: TypeParsablePoint,\n  p2?: TypeParsablePoint,\n  length?: number,\n  angle?: number,\n  offset?: number,\n}) {\n  const defaultOptions = {\n    p1: new Point(0, 0),\n    length: 1,\n    angle: 0,\n    align: 'start',\n    offset: 0,\n  };\n  let line;\n  const o = joinObjects({}, defaultOptions, options);\n  if (o.p1 != null && o.p2 != null) {\n    line = new Line(o.p1, o.p2);\n  } else {\n    line = new Line(o.p1, o.length, o.angle);\n  }\n  if (o.offset !== 0) {\n    line = line.offset('positive', o.offset);\n  }\n  return line;\n}\n\n/**\n * Grow line animation step.\n *\n * @property {number} [start] line length to grow from (`current length`)\n * @property {number} [target] line length to grow to (`current length`)\n * @extends OBJ_CustomAnimationStep\n */\nexport type OBJ_LengthAnimationStep = {\n  start?: number,\n  target?: number,\n} & OBJ_CustomAnimationStep;\n\n/**\n * Pulse Width animation step.\n *\n *\n * @property {number} [line] width scale\n * @property {number | OBJ_Pulse} [label] label pulse options or scale. Use\n * the options object for more control of how the label is pulsed (for example\n * if the label should be pulsed from its bottom rather than its center).\n * @property {number} [arrow] arrow pulse scale\n * @property {function(): void} [done] execute when pulsing is finished\n * @property {number} [duration] pulse duration in seconds\n * @property {number} [frequency] pulse frequency in pulses per second\n * @extends OBJ_TriggerAnimationStep\n */\nexport type OBJ_PulseWidthAnimationStep = {\n  line?: number,\n  label?: number | OBJ_Pulse,\n  arrow?: number,\n  done?: ?() => void,\n  duration?: number,\n  frequency?: number,\n} & OBJ_TriggerAnimationStep;\n\n\n/*\n...................##.......####.##....##.########\n...................##........##..###...##.##......\n...................##........##..####..##.##......\n...................##........##..##.##.##.######..\n...................##........##..##..####.##......\n...................##........##..##...###.##......\n...................########.####.##....##.########\n*/\n// A line is always defined as horiztonal with length 1 in vertex space\n// The line's position and rotation is the line collection transform\n// translation and rotation respectively.\n// The line's length is the _line primative x scale.\n/**\n * {@link FigureElementCollection} representing a line.\n *\n * <p class=\"inline_gif\"><img src=\"./apiassets/advline_pulse.gif\" class=\"inline_gif_image\"></p>\n *\n * <p class=\"inline_gif\"><img src=\"./apiassets/advline_grow.gif\" class=\"inline_gif_image\"></p>\n *\n * <p class=\"inline_gif\"><img src=\"./apiassets/advline_multimove.gif\" class=\"inline_gif_image\"></p>\n *\n * This object defines a convient and powerful line\n * {@link FigureElementCollection} that includes a solid or dashed line,\n * arrows, a label annotation that can self align with line orientation, and\n * some methods to make it convient to use dynamically.\n *\n * See {@link COL_Line} for the options that can be used when creating the line.\n *\n * The object contains a two additional animation steps. `length`\n * animates changing the line length, and `pulseWidth` animates the\n * `pulseWidth` method. The animation steps are available in\n * the animation manager ({@link FigureElement}.animations),\n * and in the animation builder\n * (<a href=\"#animationmanagernew\">animations.new</a>\n * and <a href=\"#animationmanagerbuilder\">animations.builder</a>).\n *\n * Some of the useful methods included in an collections line are:\n * - <a href=\"#collectionslinepulsewidth\">pulseWidth</a> - pulses the line without\n *   changing its length\n * - <a href=\"#collectionslinegrow\">grow</a> - starts and animation that executes\n *   a single `length` animation\n *    step\n * - <a href=\"#collectionslinesetmovable\">grow</a> - overrides\n *    <a href=\"#figureelementsetmovable\">FigureElement.setMovable</a> and\n *    allowing for more complex move options.\n *\n * @see See {@link OBJ_LengthAnimationStep} for angle animation step options.\n *\n * See {@link OBJ_PulseWidthAnimationStep} for pulse angle animation step\n * options.\n *\n * To test examples below, append them to the\n * <a href=\"#drawing-boilerplate\">boilerplate</a>.\n *\n *\n * @example\n * // Pulse an annotated line\n * figure.add({\n *   name: 'l',\n *   method: 'collections.line',\n *   options: {\n *     p1: [-1, 0],\n *     p2: [1, 0],\n *     arrow: 'triangle',\n *     label: {\n *       text: 'length',\n *       offset: 0.04,\n *     },\n *   },\n * });\n *\n * figure.elements._l.pulseWidth({ duration: 2 });\n *\n * @example\n * // Animate growing a line while showing it's length\n * figure.add({\n *   name: 'l',\n *   method: 'collections.line',\n *   options: {\n *     p1: [-1, 0],\n *     p2: [-0.5, 0],\n *     align: 'start',\n *     arrow: { end: { head: 'barb', scale: 2 } },\n *     label: {\n *       text: null,\n *       offset: 0.03,\n *       precision: 2,\n *       location: 'start'\n *     },\n *   },\n * });\n *\n * const l = figure.elements._l;\n * l.animations.new()\n *   .length({ start: 0.5, target: 2, duration: 2 })\n *   .start();\n *\n * @example\n * // Example showing dashed line with an equation label that stays horizontal\n * const l = figure.collections.line({\n *   p1: [0, 0],\n *   p2: [1.4, 0],\n *   align: 'start',\n *   label: {\n *     text: {                             // label text is an equation\n *       elements: {\n *         twopi: '2\\u03C0',\n *       },\n *       forms: {\n *         base: ['twopi', ' ', { frac: ['a', 'vinculum', 'b'] } ]\n *       },\n *     },\n *     offset: 0.03,\n *     orientation: 'horizontal',          // keep label horizontal\n *     location: 'top',                    // keep label on top of line\n *   },\n *   dash: [0.08, 0.02, 0.02, 0.02],\n * });\n * figure.add('l', l);\n * l.setMovable({ type: 'centerTranslateEndRotation'})\n * l.setAutoUpdate();\n *\n */\n// $FlowFixMe\nexport default class CollectionsLine extends FigureElementCollection {\n  // Figure elements\n  _line: ?FigureElementPrimitive;\n  _movePad: ?FigureElementPrimitive;\n  _rotPad: ?FigureElementPrimitive;\n  _startPad: ?FigureElementPrimitive;\n  _arrow1: ?FigureElementPrimitive;\n  _arrow2: ?FigureElementPrimitive;\n  _label: null | {\n    _base: FigureElementPrimitive;\n  } & FigureElementCollection;\n\n  label: ?LineLabel;\n  arrow1: ?{ height: number; };\n  arrow2: ?{ height: number; };\n\n  line: Line;\n\n  width: number;\n  localXPosition: number;\n  alignDraw: 'start' | 'end' | 'center' | number;\n  dash: TypeDash;\n  arrow: ?{\n    start?: OBJ_LineArrow,\n    end?: OBJ_LineArrow,\n  };\n\n  showRealLength: boolean;\n  autoUpdateSubscriptionId: number;\n\n  shapes: Object;\n  equation: Object;\n\n  isTouchDevice: boolean;\n\n  scaleTransformMethodName: string;\n\n  animateLengthToStepFunctionName: string;\n  animateLengthToDoneFunctionName: string;\n  pulseWidthDoneCallbackName: string;\n\n  pulseWidthDefaults: {\n    line: number,\n    label: number,\n    arrow: number,\n    duration: number,\n    frequency: number,\n  };\n\n  multiMove: {\n    midLength: number;\n    includeLabelInTouchBoundary: boolean;\n  };\n\n  animateLengthToOptions: {\n    initialLength: number,\n    deltaLength: number,\n    callback: ?(string | (() => void)),\n    onStepCallback: ?(string | ((number, number) => void)),\n    finishOnCancel: boolean,\n  };\n\n  pulseWidthOptions: {\n    oldCallback: ?(string | (() => void)),\n    oldTransformMethod: ?(string | ((number, ?Point) => Transform)),\n  };\n\n  animations: {\n    length: (OBJ_LengthAnimationStep) => animation.CustomAnimationStep,\n    pulseWidth: (OBJ_PulseWidth) => animation.TriggerAnimationStep,\n  } & animation.AnimationManager;\n\n  lastParentRotationOffset: number;\n  /**\n   * @hideconstructor\n   */\n  constructor(\n    // shapes: Object,\n    // equation: Object,\n    collections: FigureCollections,\n    isTouchDevice: boolean,\n    // animateNextFrame: void => void,\n    options: COL_Line = {},\n  ) {\n    const defaultOptions = {\n      // position: new Point(0, 0),\n      width: 0.01,\n      align: 'start',\n      color: collections.primitives.defaultColor,\n      dash: [],\n      mods: {},\n      pulseWidth: {\n        line: 6,\n        label: 2,\n        arrow: 3,\n        duration: 1,\n        frequency: 0,\n      },\n      transform: new Transform('Line').scale(1, 1).rotate(0).translate(0, 0),\n      limits: collections.primitives.limits,\n      // touchBorder: 'children',\n    };\n    const optionsToUse = joinObjects({}, defaultOptions, options);\n    // if (optionsToUse.touchBorder == null) {\n    //   if (isTouchDevice) {\n    //     optionsToUse.touchBorder = optionsToUse.width * 16;\n    //   } else {\n    //     optionsToUse.touchBorder = optionsToUse.width * 8;\n    //   }\n    // }\n    super(optionsToUse);\n    this.setColor(optionsToUse.color);\n\n    // this.shapes = shapes;\n    // this.equation = equation;\n    this.collections = collections;\n    // this.touchBorder = optionsToUse.touchBorder;\n    this.isTouchDevice = isTouchDevice;\n    this.dash = optionsToUse.dash;\n    this.width = optionsToUse.width;\n    this.line = getLineFromOptions(optionsToUse);\n    this.alignDraw = optionsToUse.align;\n    this.localXPosition = 0;\n    this.autoUpdateSubscriptionId = -1;\n    this.lastParentRotationOffset = 0;\n\n\n    // this.animateLengthToOptions = {\n    //   initialLength: 0,\n    //   deltaLength: 1,\n    //   finishOnCancel: true,\n    //   callback: null,\n    //   onStepCallback: null,\n    // };\n\n    this.pulseWidthOptions = {\n      oldCallback: null,\n      oldTransformMethod: null,\n    };\n\n    // this.animateLengthToStepFunctionName = '_animateToLengthStep';\n    // this.fnMap.add(this.animateLengthToStepFunctionName, this.animateLengthToStep.bind(this));\n    // this.animateLengthToDoneFunctionName = '_animateToLengthDone';\n    // this.fnMap.add(this.animateLengthToDoneFunctionName, this.animateLengthToDone.bind(this));\n    // this.pulseWidthDoneCallbackName = '_pulseWidthDone';\n    // this.fnMap.add(this.pulseWidthDoneCallbackName, this.pulseWidthDone.bind(this));\n\n    // this.transform.updateTranslation(this.line.p1);\n    // this.transform.updateRotation(this.line.angle);\n\n    // Line is defined in vertex space as horiztonal along the x axis.\n    // The reference will define how it is offset where:\n    //    - start: line extends from 0 to length in x\n    //    - end: line extends from -length to 0 in length\n    //    - middle: line extends from -length / 2 to length / 2\n    //    - percent: line extends from -length * % to length * (1 - %)\n\n    // MultiMove means the line has a middle section that when touched\n    // translates the line collection, and when the rest of the line is\n    // touched then the line collection is rotated.\n    this.multiMove = {\n      midLength: 0,\n      includeLabelInTouchBoundary: false,\n      // bounds: new RectBounds({\n      //   left: -1, bottom: -1, top: 1, right: 1\n      // }),\n      // bounds: new Rect(-1, -1, 2, 2),\n    };\n\n    this.scaleTransformMethodName = '_transformMethod';\n    // If the line is to be shown (and not just a label) then make it\n    this._line = null;\n    if (this.width > 0) {\n      const straightLine = makeStraightLine(\n        this.collections.primitives, this.line.length(), this.width,\n        optionsToUse.color, this.dash, // this.maxLength,\n      );\n      const scaleTransformMethod = s => new Transform().scale(1, s);\n      straightLine.fnMap.add(this.scaleTransformMethodName, scaleTransformMethod);\n      this.add('line', straightLine);\n    }\n\n    // Arrow related properties\n    this._arrow1 = null;\n    this._arrow2 = null;\n\n    // Label related properties\n    this.label = null;\n    this._label = null;\n    this.showRealLength = false;\n\n    if (optionsToUse.arrow != null) {\n      const arrowOptions = simplifyArrowOptions(optionsToUse.arrow, this.width || 0.01);\n      // $FlowFixMe\n      this.arrow = arrowOptions;\n      this.addArrow('start');\n      this.addArrow('end');\n    }\n\n    this.setupLine();\n\n\n    const defaultLabelOptions = {\n      text: null,\n      offset: 0.00001,\n      location: 'positive',\n      subLocation: 'left',\n      orientation: 'horizontal',\n      linePosition: 0.5,\n      scale: 0.7,\n      color: optionsToUse.color,\n      precision: 1,\n      update: false,\n    };\n    if (optionsToUse.label !== undefined) {\n      let labelOptions;\n      if (typeof optionsToUse.label === 'string' || optionsToUse.label === null) {\n        labelOptions = joinObjects({}, defaultLabelOptions, { text: optionsToUse.label });\n      } else {\n        labelOptions = joinObjects({}, defaultLabelOptions, optionsToUse.label);\n      }\n      if (labelOptions.text === null) {\n        labelOptions.text = '';\n        this.showRealLength = true;\n      }\n      this.addLabel(\n        labelOptions.text,\n        labelOptions.offset,\n        labelOptions.location,\n        labelOptions.subLocation,\n        labelOptions.orientation,\n        labelOptions.linePosition,\n        labelOptions.scale,\n        labelOptions.color,\n        labelOptions.precision,\n        labelOptions.update,\n        labelOptions,\n      );\n    }\n\n    const defaultMoveOptions = {\n      type: 'rotation',\n      middleLength: 0.22,\n      includeLabelInTouchBoundary: false,\n    };\n    if (optionsToUse.move) {\n      const moveOptions = joinObjects({}, defaultMoveOptions, optionsToUse.move);\n      this.setMovable({\n        movable: true,\n        type: moveOptions.type,\n        middleLength: moveOptions.middleLength,\n      });\n    }\n\n    this.pulseWidthDefaults = {\n      line: optionsToUse.pulseWidth.line || 1,\n      label: optionsToUse.pulseWidth.label || 1,\n      arrow: optionsToUse.pulseWidth.arrow || 1,\n      duration: optionsToUse.pulseWidth.duration || 1,\n      frequency: optionsToUse.pulseWidth.frequency || 0,\n    };\n\n    if (optionsToUse.mods != null && optionsToUse.mods !== {}) {\n      this.setProperties(optionsToUse.mods);\n    }\n\n    this.animations.length = (...opt) => {\n      const o = joinObjects({}, {\n        element: this,\n        // start: this.line.length(),\n        // target: this.line.length(),\n      }, ...opt);\n      let target;\n      let start;\n      let toSetup = true;\n      o.callback = (percentage) => {\n        if (toSetup) {\n          if (o.start == null) {\n            start = this.line.length();\n          } else {\n            ({ start } = o);\n          }\n          if (o.target == null) {\n            target = this.line.length();\n          } else {\n            ({ target } = o);\n          }\n          toSetup = false;\n        }\n        const l = (target - start) * percentage + start;\n        this.setLength(l);\n      };\n      return new animation.CustomAnimationStep(o);\n    };\n\n    this.animations.pulseWidth = (...opt) => {\n      const o = joinObjects({}, {\n        element: this,\n        duration: 1,\n      }, ...opt);\n      o.callback = () => {\n        this.pulseWidth({\n          line: o.line,\n          label: o.label,\n          arrow: o.arrow,\n          duration: o.duration,\n          frequency: o.frequency,\n        });\n      };\n      return new animation.TriggerAnimationStep(o);\n    };\n\n    this.animations.customSteps.push({\n      step: this.animations.length.bind(this),\n      name: 'length',\n    });\n    this.animations.customSteps.push({\n      step: this.animations.pulseWidth.bind(this),\n      name: 'pulseWidth',\n    });\n    // trigger(...options: Array<OBJ_TriggerAnimationStep>) {\n    //   const optionsToUse = joinObjects({}, ...options);\n    //   return new anim.TriggerAnimationStep(optionsToUse);\n    // }\n  }\n\n  _getStateProperties(options: Object) {  // eslint-disable-line class-methods-use-this\n    return [...super._getStateProperties(options),\n      'line',\n      'align',\n      // 'length',\n      // 'position',\n      'width',\n      'dash',\n      'animateLengthToOptions',\n      'pulseWidthOptions',\n    ];\n  }\n\n  _fromState(state: Object) {\n    joinObjects(this, state);\n    this.setupLine();\n    // this.setLineDimensions();\n    return this;\n  }\n\n  pulseWidthDone() {\n    const line = this._line;\n    if (line == null) {\n      return;\n    }\n    if (this.pulseWidthOptions.oldTransformMethod) {\n      line.pulseSettings.transformMethod = this.pulseWidthOptions.oldTransformMethod;\n    }\n    line.pulseSettings.callback = this.pulseWidthOptions.oldCallback;\n  }\n\n  /**\n   * Pulse the line so that it's width pulses and its length doesn't change.\n   *\n   * The pulse scales of the line, label and arrows can all be defined\n   * separately.\n   */\n  pulseWidth(options?: OBJ_PulseWidth = {}) {\n    const defaultOptions = {\n      line: this.pulseWidthDefaults.line,\n      label: this.pulseWidthDefaults.label,\n      arrow: this.pulseWidthDefaults.arrow,\n      done: null,\n      duration: this.pulseWidthDefaults.duration,\n      frequency: this.pulseWidthDefaults.frequency,\n      when: 'nextFrame',\n    };\n    const o = joinObjects(defaultOptions, options);\n    let { done } = o;\n    const line = this._line;\n    if (line != null) {\n      line.stopPulsing();\n      this.pulseWidthOptions = {\n        oldTransformMethod: line.pulseSettings.transformMethod,\n        oldCallback: line.pulseSettings.callback,\n      };\n      line.pulseSettings.callback = this.pulseWidthDoneCallbackName;\n      line.pulseSettings.transformMethod = this.scaleTransformMethodName;\n      line.pulse({\n        duration: o.duration,\n        scale: o.line,\n        frequency: o.frequency,\n        callback: done,\n        when: o.when,\n      });\n      done = null;\n    }\n    const arrow1 = this._arrow1;\n    const arrow2 = this._arrow2;\n    if (arrow1 != null) {\n      arrow1.pulse({\n        duration: o.duration,\n        scale: o.arrow,\n        frequency: o.frequency,\n        callback: done,\n        when: o.when,\n        centerOn: arrow1.getPosition('figure'),\n      });\n      done = null;\n    }\n    if (arrow2 != null) {\n      arrow2.pulse({\n        duration: o.duration,\n        scale: o.arrow,\n        frequency: o.frequency,\n        callback: done,\n        when: o.when,\n        centerOn: arrow2.getPosition('figure'),\n      });\n      done = null;\n    }\n\n    const label = this._label;\n    if (label != null) {\n      // label.pulseScaleNow(o.duration, o.label, 0, done);\n      let labelOptions;\n      if (typeof o.label === 'number') {\n        labelOptions = joinObjects({}, o, { scale: o.label, callback: done });\n      } else {\n        labelOptions = joinObjects({}, o, o.label, { callback: done });\n      }\n      label.pulse(labelOptions);\n      done = null;\n    }\n    if (done != null) {\n      done();\n    }\n    this.animateNextFrame();\n  }\n\n  addArrow(\n    lineEnd: 'start' | 'end',\n  ) {\n    if (this.arrow == null || this.arrow[lineEnd] == null) {\n      return;\n    }\n    const o = this.arrow[lineEnd];\n    let r = 0;\n    let position = 1;\n    if (lineEnd === 'start') {\n      r = Math.PI;\n      position = 0;\n    }\n    const a = this.collections.primitives.arrow(joinObjects(\n      {},\n      o,\n      {\n        angle: r,\n        color: this.color,\n        transform: new Transform().translate(position),\n      },\n    ));\n    // $FlowFixMe\n    const arrowLength = getArrowLength(o)[1];\n    let index = 1;\n    if (lineEnd === 'end') {\n      index = 2;\n    }\n    // $FlowFixMe\n    this[`arrow${index}`] = { height: arrowLength };\n    this.add(`arrow${index}`, a);\n  }\n\n  /**\n   * Use this method to enable or disable movability of the line.\n   *\n   * @param {OBJ_MovableLine | boolean} [movableOrOptions] `true` to\n   * make movable, `false` to make not movable or use options to\n   * set different kinds of movability.\n   */\n  // $FlowFixMe\n  setMovable(movableOrOptions: OBJ_MovableLine | boolean) {\n    const defaultOptions = {\n      movable: true,\n      type: this.move.type,\n      middleLength: 0.333,\n      includeLabelInTouchBoundary: false,\n    };\n    let options;\n    if (movableOrOptions === false) {\n      options = joinObjects({}, defaultOptions, { movable: false });\n    } else if (movableOrOptions === true) {\n      options = defaultOptions;\n    } else {\n      options = joinObjects({}, defaultOptions, movableOrOptions);\n    }\n    const { movable } = options;\n    if (movable) {\n      const {\n        includeLabelInTouchBoundary, type, middleLength,\n      } = options;\n      this.multiMove.includeLabelInTouchBoundary = includeLabelInTouchBoundary;\n      if (type === 'translation' || type === 'rotation'\n        || type === 'scale'\n      ) {\n        this.move.type = type;\n        super.setMovable(true);\n        this.hasTouchableElements = true;\n        if (this._line != null) {\n          this._line.isTouchable = true;\n          this._line.isMovable = false;\n        }\n        if (this._movePad) {\n          this._movePad.isMovable = false;\n        }\n      } else if (type === 'centerTranslateEndRotation') {\n        this.setMultiMovable(middleLength);\n        this.updateMovePads();\n      }\n    } else {\n      this.isMovable = false;\n      this.isTouchable = false;\n      if (this._line != null) {\n        this._line.isTouchable = false;\n        this._line.isMovable = false;\n      }\n    }\n  }\n\n  // getP1Position() {\n  //   const matrix = this.spaceTransformMatrix('draw', 'figure');\n  //   return new Point(this.localXPosition, 0).transformBy(matrix);\n  // }\n\n  // setMovableLength() {\n  //   // const elements = ['line', 'arrow1', 'arrow2'];\n  //   // if (this.multiMove.includeLabelInTouchBoundary) {\n  //   //   elements.push('label');\n  //   // }\n  //   // const touchBorder = getBoundingBorder(this.getBorder('draw', 'touchBorder', elements));\n  //   // const width = touchBorder[0].distance(touchBorder[1]);\n  //   // const height = touchBorder[0].distance(touchBorder[3]);\n  //   const r = 0.1;\n  //   if (this._startPad == null) {\n  //     const startPad = this.shapes.polygon({\n  //       position: new Point(this.localXPosition, 0),\n  //       radius: r,\n  //       sides: 8,\n  //       color: [0, 0, 1, 0.5],\n  //     });\n  //     // console.log(width, height)\n  //     // startPad.transform.updateScale(width, height);\n  //     // startPad.transform.updateTranslation(touchBorder[0]);\n  //     this.add('startPad', startPad);\n  //     startPad.setMovable();\n  //     startPad.move.type = 'translation';\n  //     // startPad.move.element = this;\n  //     let flag = 5;\n  //     startPad.subscriptions.add('setTransform', () => {\n  //       if (flag === 0) {\n  //         flag = 5;\n  //         const matrix = this.spaceTransformMatrix('figure', 'local');\n  //         const p = startPad.getPosition('figure').transformBy(matrix);\n  //         // const p = startPad.getPosition('draw')\n  //         // console.log(Math.round(p.x * 100) / 100 , Math.round(p.y * 100) / 100)\n  //         this.setEndPoints(p, this.line.p2._dup());\n  //       } else {\n  //         flag -= 1;\n  //       }\n  //       // const p = startPad.getPosition('figure');\n  //     });\n  //     startPad.drawingObject.border = [[]];\n  //   }\n  //   this.hasTouchableElements = true;\n  //   this.isTouchable = false;\n  //   this.isMovable = false;\n  //   // this.setLength(this.line.length());\n  // }\n\n  // Private\n  setMultiMovable(middleLengthPercent: number) {\n    this.multiMove.midLength = middleLengthPercent;\n    if (this._rotPad == null) {\n      const rotPad = this.collections.primitives.rectangle({\n        position: new Point(0, 0),\n        xAlign: 'left',\n        yAlign: 'bottom',\n        width: 1,\n        height: 1,\n        color: [0, 0, 1, 0.0005],\n      });\n      this.add('rotPad', rotPad);\n      rotPad.setMovable();\n      rotPad.move.type = 'rotation';\n      rotPad.move.element = this;\n      rotPad.drawingObject.border = [[]];\n    }\n    if (this._movePad == null) {\n      const movePad = this.collections.primitives.rectangle({\n        position: new Point(0, 0),\n        xAlign: 'left',\n        yAlign: 'bottom',\n        width: 1,\n        height: 1,\n        color: [0, 1, 0, 0.0005],\n      });\n\n      this.add('movePad', movePad);\n      movePad.setMovable();\n\n      movePad.move.type = 'translation';\n      movePad.move.element = this;\n      movePad.drawingObject.border = [[]];\n    }\n    this.hasTouchableElements = true;\n    this.isTouchable = false;\n    this.isMovable = false;\n    this.setLength(this.line.length());\n  }\n\n\n  /**\n   * Use this to manually update the rotation of the line collection.\n   */\n  updateMoveTransform(t: Transform = this.transform._dup()) {\n    const r = t.r();\n    // const { bounds } = this.move;\n    // console.log('qqwer')\n    if (r != null) {\n      // const w = Math.abs(this.line.length() / 2 * Math.cos(r));\n      // const h = Math.abs(this.line.length() / 2 * Math.sin(r));\n      // if (bounds instanceof TransformBounds) {\n      //   bounds.updateTranslation(new RectBounds({\n      //     left: bounds.left + w,\n      //     bottom: bounds.bottom + h,\n      //     right: bounds.right - w,\n      //     top: bounds.top - h,\n      //   }));\n      // }\n      if (r > 2 * Math.PI) {\n        this.transform.updateRotation(r - 2 * Math.PI);\n      }\n      if (r < 0) {\n        this.transform.updateRotation(r + 2 * Math.PI);\n      }\n    }\n  }\n\n  addLabel(\n    labelText: string | Equation | EQN_Equation | Array<string>,\n    offset: number,\n    location: TypeLabelLocation = 'top',\n    subLocation: TypeLabelSubLocation = 'left',\n    orientation: TypeLabelOrientation = 'horizontal',\n    linePosition: number = 0.5,     // number where 0 is end1, and 1 is end2\n    scale: number = 0.7,\n    color: TypeColor = this.color,\n    precision: number = 1,\n    update: boolean = false,\n    otherOptions: {\n      isTouchable?: boolean,\n      touchBorder?: TypeParsableBuffer | TypeBorder,\n      onClick?: null | string | (() => void)\n    } = {},\n  ) {\n    this.label = new LineLabel(\n      this.collections, labelText, color,\n      offset, location, subLocation, orientation, linePosition, scale,\n      precision,\n    );\n    this.label.eqn.initialForm = null;\n    if (otherOptions.isTouchable != null) {\n      this.label.eqn.isTouchable = otherOptions.isTouchable;\n    }\n    if (otherOptions.touchBorder != null) {\n      this.label.eqn.touchBorder = otherOptions.touchBorder;\n    }\n    if (otherOptions.onClick != null) {\n      this.label.eqn.onClick = otherOptions.onClick;\n    }\n    if (this.label != null) {\n      this.add('label', this.label.eqn);\n    }\n    // if (update) {\n    //   this.subscriptions.add('setTransform', () => {\n    //     this.updateLabel();\n    //     this.updateMovePads();\n    //   });\n    // }\n    this.setAutoUpdate(update);\n    this.updateLabel();\n    this.updateMovePads();\n  }\n\n  /**\n   * Turn on and off auto label location and orientation updates when line\n   * transform changes. When a line is created with a label, auto update\n   * is turned off by default.\n   */\n  setAutoUpdate(update: boolean = true) {\n    if (update) {\n      this.autoUpdateSubscriptionId = this.subscriptions.add('setTransform', () => {\n        this.updateLabel();\n        this.updateMovePads();\n      });\n    } else {\n      // console.log(this.autoUpdateSubscriptionId)\n      this.subscriptions.remove('setTransform', this.autoUpdateSubscriptionId);\n      this.autoUpdateSubscriptionId = -1;\n    }\n  }\n\n  /**\n   * Get line length\n   * @return {number}\n   */\n  getLength() {\n    return this.line.length();\n  }\n\n  /**\n   * Get line angle\n   * @param {'deg' | 'rad'} [units]\n   * @return {number}\n   */\n  getAngle(units: 'deg' | 'rad' = 'rad') {\n    if (units === 'deg') {\n      return this.line.angle() * 180 / Math.PI;\n    }\n    return this.line.angle();\n  }\n\n  /**\n   * Change the text of the label\n   */\n  setLabel(text: string) {\n    this.showRealLength = false;\n    if (this.label != null) {\n      this.label.setText(text);\n    }\n    this.updateLabel();\n    this.updateMovePads();\n  }\n\n  /**\n   * Get the text of the label\n   */\n  getLabel() {\n    if (this.label != null) {\n      return this.label.getText();\n    }\n    return '';\n  }\n\n  /**\n   * Set the label to be the real length of the line\n   */\n  setLabelToRealLength() {\n    this.showRealLength = true;\n    this.updateLabel();\n    this.updateMovePads();\n  }\n\n  /**\n   * Manually update the label orientations with a custom rotation offset.\n   *\n   * Automatic updating can be done with\n   * <a href=\"collectionsline#setautoupdate\">setAutoUpdate</a>\n   * @param {number | null} rotationOffset\n   */\n  updateLabel(rotationOffset: number | null = null) {\n    if (rotationOffset != null) {\n      this.lastParentRotationOffset = rotationOffset;\n    }\n\n    const { label } = this;\n    if (label == null) {\n      return;\n    }\n    const lineAngle = normAngle(this.transform.r() || 0);\n    if (this.showRealLength && this._label) {\n      const labelToUse = roundNum(this.line.length(), 2)\n        .toFixed(label.precision);\n      const current = label.getText();\n      if (current !== labelToUse) {\n        label.setText(roundNum(this.line.length(), 2)\n          .toFixed(label.precision));\n      }\n    }\n    const labelPosition = new Point(\n      this.localXPosition + label.linePosition * this.line.length(),\n      0,\n    );\n    if (label.location === 'start') {\n      labelPosition.x = this.localXPosition;\n    }\n    if (label.location === 'end') {\n      labelPosition.x = this.localXPosition + this.line.length();\n    }\n\n    label.updateRotation(\n      labelPosition, lineAngle, label.offset,\n      label.location, label.subLocation, label.orientation,\n      this.lastParentRotationOffset, 'oval', true,\n      Math.PI * 2, Math.PI,\n    );\n  }\n\n  // updateLabelLegacy(parentRotationOffset: number = 0) {\n  //   const { label } = this;\n  //   if (label == null) {\n  //     return;\n  //   }\n  //   const lineAngle = normAngle(this.transform.r() || 0);\n  //   let labelAngle = 0;\n  //   if (this.showRealLength && this._label) {\n  //     const labelToUse = roundNum(this.line.length(), 2)\n  //       .toFixed(label.precision);\n  //     const current = label.getText();\n  //     if (current !== labelToUse) {\n  //       label.setText(roundNum(this.line.length(), 2)\n  //         .toFixed(label.precision));\n  //     }\n  //   }\n  //   const labelPosition = new Point(\n  //     this.localXPosition + label.linePosition * this.line.length(),\n  //     0,\n  //   );\n  //   let labelOffsetAngle = Math.PI / 2;\n  //   const labelOffsetMag = label.offset;\n  //   if (label.location === 'start' || label.location === 'end') {\n  //     if (label.location === 'start') {\n  //       labelPosition.x = this.localXPosition - label.offset;\n  //       labelOffsetAngle = -Math.PI;\n  //     }\n  //     if (label.location === 'end') {\n  //       labelPosition.x = this.localXPosition + this.line.length() + label.offset;\n  //       labelOffsetAngle = 0;\n  //     }\n  //   } else {\n  //     const offsetTop = Math.cos(lineAngle) < 0 ? -Math.PI / 2 : Math.PI / 2;\n  //     const offsetBottom = -offsetTop;\n  //     const offsetLeft = Math.sin(lineAngle) > 0 ? Math.PI / 2 : -Math.PI / 2;\n  //     const offsetRight = -offsetLeft;\n\n  //     if (label.location === 'top') {\n  //       labelOffsetAngle = offsetTop;\n  //     }\n  //     if (label.location === 'bottom') {\n  //       labelOffsetAngle = offsetBottom;\n  //     }\n  //     if (label.location === 'right') {\n  //       labelOffsetAngle = offsetRight;\n  //     }\n  //     if (label.location === 'left') {\n  //       labelOffsetAngle = offsetLeft;\n  //     }\n  //     if (label.location === 'positive') {\n  //       labelOffsetAngle = Math.PI / 2;\n  //     }\n  //     if (label.location === 'negative') {\n  //       labelOffsetAngle = -Math.PI / 2;\n  //     }\n  //     if (roundNum(Math.sin(lineAngle), 4) === 0\n  //       && (label.location === 'left' || label.location === 'right')\n  //     ) {\n  //       if (label.subLocation === 'top') {\n  //         labelOffsetAngle = offsetTop;\n  //       }\n  //       if (label.subLocation === 'bottom') {\n  //         labelOffsetAngle = offsetBottom;\n  //       }\n  //     }\n  //     if (roundNum(Math.cos(lineAngle), 4) === 0\n  //       && (label.location === 'top' || label.location === 'bottom')\n  //     ) {\n  //       if (label.subLocation === 'right') {\n  //         labelOffsetAngle = offsetRight;\n  //       }\n  //       if (label.subLocation === 'left') {\n  //         labelOffsetAngle = offsetLeft;\n  //       }\n  //     }\n  //     if (label.location === 'inside') {\n  //       labelOffsetAngle = -Math.PI / 2;\n  //     }\n  //     if (label.location === 'outside') {\n  //       labelOffsetAngle = Math.PI / 2;\n  //     }\n  //   }\n\n  //   if (label.orientation === 'horizontal') {\n  //     labelAngle = -lineAngle;\n  //   }\n  //   if (label.orientation === 'baseToLine') {\n  //     labelAngle = 0;\n  //     if (labelOffsetAngle < 0) {\n  //       labelAngle = Math.PI;\n  //     }\n  //   }\n  //   if (label.orientation === 'baseAway') {\n  //     labelAngle = Math.PI;\n  //     if (labelOffsetAngle < 0) {\n  //       labelAngle = 0;\n  //     }\n  //   }\n  //   if (label.orientation === 'upright') {\n  //     if (Math.cos(lineAngle) < 0) {\n  //       labelAngle = Math.PI;\n  //     }\n  //   }\n\n  //   label.updateRotation(\n  //     labelAngle - parentRotationOffset,\n  //     labelPosition, labelOffsetMag, labelOffsetAngle,\n  //   );\n  // }\n\n  /**\n   * Set the length of the line\n   */\n  setLength(\n    length: number,\n    align: 'start' | 'end' | 'center' | number = this.alignDraw,\n  ) {\n    let newLen = length;\n    if (length === 0) {\n      newLen = 0.0000001;\n    }\n    if (align === 'start') {\n      this.line = new Line(this.line.p1, newLen, this.line.angle());\n    } else if (align === 'end') {\n      this.line = new Line(\n        this.line.pointAtLength(this.line.length() - newLen),\n        newLen, this.line.angle(),\n      );\n    } else if (align === 'center') {\n      this.line = new Line(\n        this.line.pointAtLength((this.line.length() - newLen) / 2),\n        newLen, this.line.angle(),\n      );\n    } else if (typeof align === 'number') {\n      // console.log(align)\n      this.line = new Line(\n        this.line.pointAtLength((this.line.length() - newLen) * align),\n        newLen, this.line.angle(),\n      );\n    }\n    this.alignDraw = align;\n    this.setupLine();\n  }\n\n  setupLine() {\n    const set = (key, x) => {\n      // $FlowFixMe\n      if (this[`_${key}`] != null) {  // $FlowFixMe\n        this[`_${key}`].transform.updateTranslation(x);\n      }\n    };\n    let xPosition = 0;\n    let position = this.line.p1._dup();\n    // const { align } = this;\n    const align = this.alignDraw;\n    if (typeof align === 'number') {\n      xPosition = -this.line.length() * align;\n      position = this.line.pointAtPercent(align);\n    } else if (align === 'end') {\n      xPosition = -this.line.length();\n      position = this.line.p2._dup();\n    } else if (align === 'center') {\n      xPosition = -this.line.length() / 2;\n      position = this.line.pointAtPercent(0.5);\n    }\n    this.localXPosition = xPosition;\n    set('arrow1', xPosition);\n    set('arrow2', xPosition + this.line.length());\n\n    let straightLineLength = this.line.length();\n    let startOffset = 0;\n\n    if (this.arrow1 && this._arrow1) {\n      straightLineLength -= this.arrow1.height;\n      startOffset = this.arrow1.height;\n    }\n    if (this.arrow2 && this._arrow2) {\n      straightLineLength -= this.arrow2.height;\n    }\n    straightLineLength = Math.max(straightLineLength, 0);\n    const line = this._line;\n    if (line) {\n      line.transform.updateTranslation(xPosition + startOffset);\n      line.custom.updatePoints({ p1: [0, 0], p2: [straightLineLength, 0], dash: this.dash });\n      // if (Array.isArray(this.dash) && this.dash.length > 0) {\n      //   line.lengthToDraw = straightLineLength;\n      //   line.drawBorder = [[\n      //     new Point(0, -this.width / 2),\n      //     new Point(straightLineLength, -this.width / 2),\n      //     new Point(straightLineLength, this.width / 2),\n      //     new Point(0, this.width / 2),\n      //   ]];\n      //   line.drawBorderBuffer = line.drawingObject.border;\n      // } else {\n      //   line.transform.updateScale(straightLineLength, 1);\n      // }\n    }\n\n    this.transform.updateRotation(this.line.angle());\n    this.transform.updateTranslation(position);\n    this.updateLabel();\n    this.updateMovePads();\n  }\n\n  updateMovePads() {\n    if (this._movePad == null || this._rotPad == null) {\n      return;\n    }\n    const elements = ['line', 'arrow1', 'arrow2'];\n    if (this.multiMove.includeLabelInTouchBoundary) {\n      elements.push('label');\n    }\n    const touchBorder = getBoundingBorder(this.getBorder('draw', 'touchBorder', elements));\n    const width = touchBorder[0].distance(touchBorder[1]);\n    const height = touchBorder[0].distance(touchBorder[3]);\n    const movePad = this._movePad;\n    if (movePad) {\n      const midWidth = this.multiMove.midLength * this.line.length();\n      movePad.transform.updateScale(midWidth, height);\n      // const p = movePad.getPosition();\n      movePad.setPosition(\n        this.localXPosition + this.line.length() / 2 - midWidth / 2,\n        touchBorder[0].y,\n      );\n    }\n    const rotPad = this._rotPad;\n    if (rotPad) {\n      rotPad.transform.updateScale(width, height);\n      // const p = rotPad.getPosition();\n      rotPad.setPosition(touchBorder[0].x, touchBorder[0].y);\n    }\n    const startPad = this._startPad;\n    if (startPad) {\n      startPad.transform.updateTranslation(this.localXPosition, 0);\n    }\n  }\n\n  /**\n   * Change the line position, length and angle using end points and an offset.\n   *\n   * For most lines, an offset of 0 will be desired, as this will position the\n   * line ends to be at `p1` and `p2`.\n   *\n   * A non-positive offset will position the line in parallel with `p1` and `p2`\n   * but some offset away. A positive offset will position the line on the side\n   * it will rotate toward with positive rotation.\n   */\n  setEndPoints(p1: TypeParsablePoint, p2: TypeParsablePoint, offset: number = 0) {\n    this.line = new Line(p1, p2).offset('positive', offset);\n    // console.log(p, q)\n    this.setupLine();\n  }\n\n  // animateLengthToStep(percent: number) {\n  //   const { initialLength, deltaLength, onStepCallback } = this.animateLengthToOptions;\n  //   this.setLength(initialLength + deltaLength * percent);\n  //   if (onStepCallback != null) {\n  //     this.fnMap.exec(onStepCallback, percent, initialLength + deltaLength * percent);\n  //   }\n  // }\n\n  // animateLengthToDone() {\n  //   const {\n  //     initialLength, callback, deltaLength, finishOnCancel,\n  //   } = this.animateLengthToOptions;\n  //   if (finishOnCancel) {\n  //     this.setLength(initialLength + deltaLength);\n  //   }\n  //   this.fnMap.exec(callback);\n  // }\n\n  // animateLengthTo(\n  //   toLength: number = 1,\n  //   time: number = 1,\n  //   finishOnCancel: boolean = true,\n  //   callback: ?(string | (() => void)) = null,\n  //   onStepCallback: ?(string | ((number, number) => void)) = null,\n  //   stop: ?boolean = true,\n  // ) {\n  //   if (stop) {\n  //     this.stop();\n  //   }\n  //   this.animateLengthToOptions = {\n  //     initialLength: this.line.length(),\n  //     deltaLength: toLength - this.line.length(),\n  //     callback,\n  //     onStepCallback,\n  //     finishOnCancel,\n  //   };\n  //   this.animations.new('Line Length')\n  //     .custom({\n  //       callback: this.animateLengthToStepFunctionName,\n  //       duration: time,\n  //     })\n  //     .whenFinished(this.animateLengthToDoneFunctionName)\n  //     .start();\n  //   this.animateNextFrame();\n  // }\n\n  // /**\n  //  * Grow the line from a length to the current length\n  //  */\n  // growLegacy(\n  //   fromLength: number = 0,\n  //   duration: number = 1,\n  //   finishOnCancel: boolean = true,\n  //   callback: ?(string | (() => void)) = null,\n  //   onStepCallback: ?(number, number) => void = null,\n  // ) {\n  //   this.stop();\n  //   const target = this.line.length();\n  //   this.setLength(fromLength);\n  //   this.animateLengthTo(target, duration, finishOnCancel, callback, onStepCallback);\n  // }\n\n  /**\n   * Create a new animation that executes a single grow animation step.\n   */\n  grow(options: OBJ_LengthAnimationStep) {\n    const o = joinObjects({}, { start: 0 }, options);\n    this.animations.new()\n      .then(this.animations.length(o))\n      .start();\n  }\n\n  showLineOnly() {\n    this.show();\n    if (this._line) {\n      this._line.show();\n    }\n    if (this._arrow1) {\n      this._arrow1.show();\n    }\n    if (this._arrow2) {\n      this._arrow2.show();\n    }\n    if (this._label) {\n      this._label.hideAll();\n    }\n  }\n\n\n  /**\n   * Return a geometric {@link Line} object that represents the line\n   * @return {Line}\n   */\n  getLine(\n    // space: TypeSpace = 'local'\n  ) {\n    return new Line(this.getP1(), this.getP2());\n  }\n\n  /**\n   * Return the start point of the line\n   * @return {Point}\n   */\n  getP1(\n    // space: TypeSpace = 'local'\n  ) {\n    // return this.line.p1._dup();\n    // const matrix = this.spaceTransformMatrix('draw', space);\n    // if (this._line != null) {\n    //   matrix = mul(matrix, this._line.spaceTransformMatrix('draw', 'local'));\n    //   // return this._line.getPosition(space);\n    // }\n    // return this.getPosition(space);\n\n    // // if (space === 'draw') {\n    // //   return this.line.p1._dup();\n    // // }\n    // // return this.line.p1.transformBy(this.spaceTransformMatrix('draw', space));\n    // return new Point(0, 0).transformBy(matrix);\n    return this.line.p1._dup();\n  }\n\n  /**\n   * Return the end point of the line\n   * @return {Point}\n   */\n  getP2(\n    // space: TypeSpace = 'local'\n  ) {\n    return this.line.p2._dup();\n    // if (space === 'draw') {\n    //   return this.line.p2._dup();\n    // }\n    // return this.line.p2.transformBy(this.spaceTransformMatrix('draw', space));\n    // return new Point(this.line.length(), 0)\n    //   .transformBy(this.spaceTransformMatrix('draw', space));\n  }\n}\n\n// export type TypeLine = CollectionsLine;\n\n// export class MovableLine extends CollectionsLine {\n//   // constructor(\n//   //   fullLength: number,\n//   //   endLength: number,\n//   //   width: number,\n//   //   boundary: Rect,\n//   // ) {\n\n//   // }\n// }\n\n// export type TypeMovableLine = MovableLine;\n\nexport type TypeLabelledLine = {\n  _line: FigureElementPrimitive;\n  _label: {\n    _base: FigureElementPrimitive;\n  } & Equation;\n} & CollectionsLine;\n","// @flow\n\n// import Figure from '../Figure';\nimport {\n  Transform, Point,\n  getPoint, parsePoint,\n  comparePoints, Rect,\n} from '../../tools/g2';\nimport type { TypeParsablePoint } from '../../tools/g2';\n// import {\n//   round,\n// } from '../../tools/math';\nimport { joinObjects } from '../../tools/tools';\nimport {\n  FigureElementCollection,\n} from '../Element';\nimport type CollectionsAxis, { COL_Axis } from './Axis';\nimport type CollectionsTrace, { COL_Trace } from './Trace';\nimport type { COL_PlotLegend } from './Legend';\nimport type CollectionsRectangle, { COL_Rectangle } from './Rectangle';\nimport type { OBJ_TextLines, OBJ_Collection } from '../FigurePrimitives/FigurePrimitives';\nimport type { OBJ_Font, TypeColor, OBJ_Font_Fixed } from '../../tools/types';\nimport type FigureCollections from './FigureCollections';\n\n/**\n * Plot frame.\n *\n * {@link COL_Rectangle}` & { space: number }`\n *\n * Define how much larger the frame is than the plot, labels and\n * titles with `space`.\n */\nexport type TypePlotFrame = COL_Rectangle & { space: number };\n\n/**\n * Plot title.\n *\n * {@link OBJ_TextLines}` & { offset: `{@link TypeParsablePoint}` }`\n *\n * Use `offset` to adjust the location of the title.\n */\nexport type TypePlotTitle = OBJ_TextLines & { offset: TypeParsablePoint };\n\n/**\n * {@link CollectionsPlot} options object that extends {@link OBJ_Collection}\n * options object (without `parent`).\n *\n * A plot is a collection of axes and traces, and may include a title, legend\n * and bounding frame.\n *\n * Use `width`, `height` and `position` to define the size of the plot area\n * (area where the traces are drawn) and where it is in the figure.\n *\n * @extends OBJ_Collection\n *\n * @property {number} [width] width of the plot area\n * @property {number} [height] height of the plot area\n * @property {COL_Axis | boolean} [xAxis] customize the x axis, or use `false`\n * to hide it\n * @property {COL_Axis | boolean} [yAxis] customize the y axis, or use `false`\n * to hide it\n * @property {Array<COL_Axis>} [axes] add additional axes\n * @property {boolean} [grid] turn on and off the grid - use the grid options\n * in xAxis, yAxis or axes for finer customization\n * @property {TypePlotTitle | string} [title] plot title can be simply a\n * `string` or fully customized with TypePlotTitle\n * @property {Array<COL_Trace | TypeParsablePoint> | COL_Trace | Array<TypeParsablePoint>} [trace]\n *  Use array if plotting more than one trace. Use COL_Trace to customize the\n *  trace.\n * @property {COL_PlotLegend | boolean} [legend] `true` to turn the legend on,\n * or use COL_PlotLegend to customize it's location and layout\n * @property {boolean | TypeColor | TypePlotFrame} [frame] frame around the\n * plot can be turned on with `true`, can be a simple color fill using\n * `Array<number>` as a color, or can be fully customized with TypePlotFrame\n * @property {TypeColor | COL_Rectangle} [plotArea] plot area can be a\n * color fill with `Array<number`> as a color, or be fully customized with\n * COL_Rectangle\n * @property {OBJ_Font} [font] Default font for plot (title, axes, labels, etc.)\n * @property {TypeColor} [color] Default color\n * @property {TypeParsablePoint} [position] Position of the plot\n */\nexport type COL_Plot = {\n  width?: number,\n  height?: number,\n  xAxis?: COL_Axis | boolean,\n  yAxis?: COL_Axis | boolean,\n  axes?: Array<COL_Axis>,\n  grid?: boolean,\n  title?: string | TypePlotTitle,\n  trace?: Array<COL_Trace | TypeParsablePoint> | COL_Trace | Array<TypeParsablePoint>,\n  legend?: COL_PlotLegend,\n  frame?: boolean | TypeColor | TypePlotFrame,\n  plotArea?: TypeColor | COL_Rectangle,\n  font?: OBJ_Font,\n  color?: TypeColor,\n  position?: TypeParsablePoint,\n} & OBJ_Collection;\n\nfunction cleanTraces(\n  tracesIn: Array<COL_Trace | Array<TypeParsablePoint>> | COL_Trace | Array<TypeParsablePoint>,\n): [Array<COL_Trace>, Rect] {\n  let traces = [];\n  if (!Array.isArray(tracesIn)) {\n    traces = [tracesIn];\n  } else if (tracesIn.length === 0) {\n    traces = []; // $FlowFixMe\n  } else if (parsePoint(tracesIn[0]) instanceof Point) {\n    traces = [{ points: tracesIn }];\n  } else {\n    tracesIn.forEach((trace) => {\n      if (!Array.isArray(trace)) {\n        traces.push(trace);\n      } else {\n        traces.push({ points: trace });\n      }\n    });\n  }\n\n  let firstPoint = true;\n  let result = { min: new Point(0, 0), max: new Point(0, 0) };\n  traces.forEach((trace) => { // $FlowFixMe\n    for (let i = 0; i < trace.points.length; i += 1) { // $FlowFixMe\n      const p = getPoint(trace.points[i]);\n      // eslint-disable-next-line no-param-reassign\n      // trace.points[i] = p;\n      result = comparePoints(p, result.min, result.max, firstPoint);\n      firstPoint = false;\n    }\n  });\n  const bounds = new Rect(\n    result.min.x,\n    result.min.y,\n    result.max.x - result.min.x,\n    result.max.y - result.min.y,\n  );  // $FlowFixMe\n  return [traces, bounds];\n}\n\n/*\n.............########..##........#######..########\n.............##.....##.##.......##.....##....##...\n.............##.....##.##.......##.....##....##...\n.............########..##.......##.....##....##...\n.............##........##.......##.....##....##...\n.............##........##.......##.....##....##...\n.............##........########..#######.....##...\n*/\n\n/**\n * {@link FigureElementCollection} representing a plot including axes, traces,\n * labels and titles.\n *\n * ![](./apiassets/advplot_ex1.png)\n * ![](./apiassets/advplot_ex2.png)\n *\n * ![](./apiassets/advplot_ex3.png)\n * ![](./apiassets/advplot_ex4.png)\n *\n * ![](./apiassets/advplot_ex5.png)\n * ![](./apiassets/advplot_ex6.png)\n *\n * This object provides convient and customizable plot functionality.\n *\n * At its simplist, just the points of the trace to be plotted need to be\n * passed in to get a plot with automatically generated axes, tick marks,\n * labels and grid lines.\n *\n * Additional options can be used to finely customize each of these, as well\n * as add and customize plot and axis titles, a legend, and a frame around the\n * entire plot.\n *\n * @see\n * See {@link COL_Axis}, {@link OBJ_AxisLabels}, {@link OBJ_AxisTicks},\n * {@link COL_Trace} and {@link COL_PlotLegend} for more examples of customizing\n * specific parts of the plot.\n *\n * To test examples below, append them to the\n * <a href=\"#drawing-boilerplate\">boilerplate</a>.\n *\n * All examples below also use this power function to generate the traces:\n * ```javascript\n * const pow = (pow = 2, stop = 10, step = 0.05) => {\n *   const xValues = Fig.tools.math.range(0, stop, step);\n *   return xValues.map(x => new Fig.Point(x, x ** pow));\n * }\n * ```\n * @example\n * // Plot of single trace with auto axis scaling\n * figure.add({\n *   name: 'plot',\n *   method: 'collections.plot',\n *   options: {\n *     trace: pow(),\n *   },\n * });\n *\n * @example\n * // Multiple traces with a legend\n * // Some traces are customized beyond the default color to include dashes and\n * // markers\n * figure.add({\n *   name: 'plot',\n *   method: 'collections.plot',\n *   options: {\n *     width: 2,                                    // Plot width in figure\n *     height: 2,                                   // Plot height in figure\n *     yAxis: { start: 0, stop: 100 },              // Customize y axis limits\n *     trace: [\n *       { points: pow(1.5), name: 'Power 1.5' },   // Trace names are for legend\n *       {                                          // Trace with only markers\n *         points: pow(2, 10, 0.5),\n *         name: 'Power 2',\n *         markers: { sides: 4, radius: 0.03 },\n *       },\n *       {                                          // Trace with markers and\n *         points: pow(3, 10, 0.5),                 // dashed line\n *         name: 'Power 3',\n *         markers: { radius: 0.03, sides: 10, line: { width: 0.005 } },\n *         line: { dash: [0.04, 0.01] },\n *       },\n *     ],\n *     legend: true,\n *   },\n * });\n *\n * @example > collections.plot.multiple.grids.simple.titles\n * // Multiple grids and simple titles\n * figure.add({\n *   name: 'plot',\n *   method: 'collections.plot',\n *   options: {\n *     width: 2,\n *     height: 2,\n *     yAxis: {\n *       start: 0,\n *       stop: 100,\n *       grid: [\n *         { step: 20, width: 0.005, dash: [], color: [0.7, 0.7, 1, 1] },\n *         { step: 5, width: 0.005, dash: [0.01, 0.01], color: [1, 0.7, 0.7, 1] },\n *       ],\n *       title: 'velocity (m/s)',\n *     },\n *     xAxis: {\n *       grid: [\n *         { step: 2, width: 0.005, dash: [], color: [0.7, 0.7, 1, 1] },\n *         { step: 0.5, width: 0.005, dash: [0.01, 0.01], color: [1, 0.7, 0.7, 1] },\n *       ],\n *       title: 'time (s)',\n *     },\n *     trace: pow(3),\n *     title: 'Velocity over Time'\n *   },\n * });\n *\n * @example\n * // Hide axes\n * // Use plot frame and plot area\n * // Title has a subtitle\n * figure.add({\n *   name: 'plot',\n *   method: 'collections.plot',\n *   options: {\n *     width: 2,\n *     height: 2,\n *     trace: pow(3),\n *     xAxis: { show: false },\n *     yAxis: { show: false },\n *     plotArea: [0.93, 0.93, 0.93, 1],\n *     frame: {\n *       line: { width: 0.005, color: [0.5, 0.5, 0.5, 1] },\n *       corner: { radius: 0.1, sides: 10 },\n *       space: 0.15,\n *     },\n *     title: {\n *       text: [\n *         'Velocity over Time',\n *         { text: 'For object A', lineSpace: 0.13, font: { size: 0.08 } },\n *       ],\n *       offset: [0, 0],\n *     }\n *   },\n * });\n *\n * @example\n * // Secondary y axis\n * figure.add({\n *   name: 'plot',\n *   method: 'collections.plot',\n *   options: {\n *     width: 2,\n *     height: 2,\n *     trace: pow(2),\n *     yAxis: {\n *       title: {\n *         text: 'velocity (m/s)',\n *         rotation: 0,\n *         xAlign: 'right',\n *       },\n *     },\n *     xAxis: { title: 'time (s)' },\n *     axes: [\n *       {\n *         axis: 'y',\n *         start: 0,\n *         stop: 900,\n *         color: [1, 0, 0, 1],\n *         position: [2, 0],\n *         ticks: {\n *           step: 300,\n *           offset: 0,\n *           length: 0.05,\n *         },\n *         labels: {\n *           offset: [0.2, 0],\n *           precision: 0,\n *           xAlign: 'left',\n *         },\n *         title: {\n *           offset: [0.4, 0],\n *           xAlign: 'left',\n *           text: 'displacment (m)',\n *           rotation: 0,\n *         }\n *       },\n *     ],\n *     position: [-1, -1],\n *   },\n * });\n *\n * @example\n * // Cartesian axes crossing at the zero point\n * // Automatic layout doesn't support this, but axes, ticks, labels and titles\n * // can all be customized to create it.\n * figure.add({\n *   name: 'plot',\n *   method: 'collections.plot',\n *   options: {\n *     width: 3,\n *     height: 3,\n *     trace: pow(2, 20),\n *     font: { size: 0.1 },\n *     xAxis: {\n *       start: -25,\n *       stop: 25,\n *       ticks: {\n *         start: -20,\n *         stop: 20,\n *         step: 5,\n *         length: 0.1,\n *         offset: -0.05\n *       },\n *       line: { arrow: 'barb' },\n *       position: [0, 1.5],\n *       labels: [\n *         {\n *           hide: 4,\n *           precision: 0,\n *           space: 0.1,\n *         },\n *         {\n *           values: 0,\n *           text: 'O',\n *           offset: [0, 0.165],\n *         },\n *       ],\n *       title: {\n *         text: 'x',\n *         offset: [1.65, 0.3],\n *         font: {\n *           style: 'italic',\n *           family: 'Times New Roman',\n *           size: 0.15,\n *         },\n *       },\n *     },\n *     yAxis: {\n *       start: -500,\n *       stop: 500,\n *       line: { arrow: 'barb' },\n *       ticks: {\n *         start: -400,\n *         stop: 400,\n *         step: 100,\n *         length: 0.1,\n *         offset: -0.05,\n *       },\n *       position: [1.5, 0],\n *       labels: {\n *         hide: 4,\n *         precision: 0,\n *         space: 0.03,\n *       },\n *       title: {\n *         text: 'y',\n *         offset: [0.35, 1.6],\n *         font: {\n *           style: 'italic',\n *           family: 'Times New Roman',\n *           size: 0.15,\n *         },\n *         rotation: 0,\n *       },\n *     },\n *     grid: false,\n *     position: [-1, -1],\n *   },\n * });\n *\n */\n// $FlowFixMe\nclass CollectionsPlot extends FigureElementCollection {\n  // Figure elements\n  // _axis: ?CollectionsAxis;\n  // _majorTicks: ?FigureElementPrimitive;\n  // _minorTicks: ?FigureElementPrimitive;\n  // _labels: ?FigureElementPrimitive;\n  // _arrow1: ?FigureElementPrimitive;\n  // _arrow2: ?FigureElementPrimitive;\n  __frame: ?CollectionsRectangle;\n\n  shapes: Object;\n  equation: Object;\n  collections: Object;\n\n  axes: Array<CollectionsAxis>;\n  traces: Array<CollectionsTrace>;\n\n  defaultFont: OBJ_Font_Fixed;\n  width: number;\n  height: number;\n  theme: string;\n  grid: boolean;\n  xAxisShow: boolean;\n  yAxisShow: boolean;\n  frameSpace: ?number;\n\n  // length: number;\n  // angle: number;\n  // start: number;\n  // stop: number;\n\n  /**\n   * @hideconstructor\n   */\n  constructor(\n    collections: FigureCollections,\n    optionsIn: COL_Plot,\n  ) {\n    const defaultOptions = {\n      font: collections.primitives.defaultFont,\n      color: collections.primitives.defaultColor,\n      theme: 'classic',\n      width: collections.primitives.limits.width / 3,\n      height: collections.primitives.limits.width / 3,\n      grid: [],\n      xAlign: 'plotAreaLeft',\n      yAlign: 'plotAreaBottom',\n      limits: collections.primitives.limits,\n      transform: new Transform('Plot').scale(1, 1).rotate(0).translate(0, 0),\n    };\n    if (\n      optionsIn.color != null\n      && (\n        optionsIn.font == null\n        || (optionsIn.font != null && optionsIn.font.color == null)\n      )\n    ) {\n      defaultOptions.font.color = optionsIn.color;\n    }\n    const options = joinObjects({}, defaultOptions, optionsIn);\n    // if (options.transform != null) {\n    //   options.transform = getTransform(options.transform);\n    // }\n    // if (options.position != null) {\n    //   options.transform.updateTranslation(getPoint(options.position));\n    // }\n    if (options.stop == null) {\n      options.stop = options.start + 1;\n    }\n\n    super(options);\n    this.collections = collections;\n\n    this.defaultFont = options.font;\n    this.defaultColor = options.color;\n    this.width = options.width;\n    this.height = options.height;\n    this.theme = options.theme;\n    this.grid = options.grid;\n    this.xAxisShow = true;\n    if (options.xAxis === false) {\n      this.xAxisShow = false;\n    }\n    this.yAxisShow = true;\n    if (options.yAxis === false) {\n      this.yAxisShow = false;\n    }\n\n    if (optionsIn.font == null || optionsIn.font.size == null) {\n      this.defaultFont.size = Math.min(this.width, this.height) / 20;\n    }\n\n    this.setColor(options.color);\n\n    this.axes = [];\n    this.traces = [];\n\n    const [traces, bounds] = cleanTraces(options.trace);\n\n    if (options.frame != null && options.frame !== false) {\n      this.addFrame(options.frame);\n    }\n    if (options.plotArea != null && options.plotArea !== false) {\n      this.addPlotArea(options.plotArea);\n    }\n\n    this.addAxes([joinObjects(\n      {},\n      { axis: 'x', name: 'x', auto: [bounds.left, bounds.right] },\n      options.xAxis != null ? options.xAxis : {},\n    )]);\n    this.addAxes([joinObjects(\n      {},\n      { axis: 'y', name: 'y', auto: [bounds.bottom, bounds.top] },\n      options.yAxis != null ? options.yAxis : {},\n    )]);\n    if (options.axes != null) {\n      this.addAxes(options.axes);\n    }\n    if (options.trace != null) {\n      this.addTraces(traces);\n    }\n    if (options.title != null) {\n      this.addTitle(options.title);\n    }\n\n    if (options.legend != null && options.legend !== false) {\n      this.addLegend(options.legend);\n    }\n\n    // if (options.border != null) {\n    //   this.addBorder(options.border);\n    // }\n\n    if (this.__frame != null && this.frameSpace != null) {\n      this.__frame.surround(this, this.frameSpace);\n    }\n  }\n\n  getNonTraceBoundingRect() {\n    const children = [];\n    Object.keys(this.elements).forEach((elementName) => {\n      if (!elementName.startsWith('trace')) {\n        children.push(elementName);\n      }\n    });\n    return this.getBoundingRect('draw', 'border', children);\n  }\n\n  addAxes(axes: Array<COL_Axis>) {\n    const defaultOptions = {\n      color: this.defaultColor,\n      font: this.defaultFont,\n      type: 'x',\n    };\n    axes.forEach((axisOptions) => {\n      let axisType;\n      if (axisOptions.axis != null) {\n        axisType = axisOptions.axis;  // $FlowFixMe\n      } else if (defaultOptions.axis != null) {\n        axisType = defaultOptions.axis;\n      }\n      if (axisType === 'x') {     // $FlowFixMe\n        defaultOptions.length = this.width;\n      } else {                    // $FlowFixMe\n        defaultOptions.length = this.height;\n      }\n      const theme = this.getTheme(this.theme, axisType, axisOptions.color);\n      const show = axisType === 'x' ? this.xAxisShow : this.yAxisShow;\n      // $FlowFixMe\n      defaultOptions.show = show;\n      const o = joinObjects({}, defaultOptions, theme.axis, axisOptions);\n      if (Array.isArray(o.grid)) {\n        for (let i = 0; i < o.grid.length; i += 1) {\n          o.grid[i] = joinObjects({}, theme.axis.grid, o.grid[i]);\n        }\n      }\n      if (Array.isArray(o.ticks)) {\n        for (let i = 0; i < o.ticks.length; i += 1) {\n          o.ticks[i] = joinObjects({}, theme.axis.ticks, o.ticks[i]);\n        }\n      }\n      if (o.name == null) {\n        o.name = `axis_${this.axes.length}`;\n      }\n      const axis = this.collections.axis(o);\n      this.add(o.name, axis);\n      this.axes.push(axis);\n    });\n  }\n\n  addPlotArea(plotArea: Array<number> | COL_Rectangle) {\n    const defaultOptions = {\n      width: this.width,\n      height: this.height,\n      xAlign: 'left',\n      yAlign: 'bottom',\n      position: [0, 0],\n    };\n    let o;\n    if (Array.isArray(plotArea)) {    // $FlowFixMe\n      defaultOptions.fill = plotArea;\n      o = defaultOptions;\n    } else {\n      o = joinObjects({}, defaultOptions, plotArea);\n    }\n    this.add('_plotArea', this.collections.rectangle(o));\n  }\n\n  addFrame(frame: COL_Rectangle | boolean | TypeColor) {\n    const defaultOptions = {\n      width: this.width / 2,\n      height: this.height / 2,\n      xAlign: 'left',\n      yAlign: 'bottom',\n      position: [0, 0],\n      space: Math.min(this.width, this.height) / 20,\n    };\n    let optionsIn = frame;\n    if (optionsIn === true) {\n      optionsIn = { line: { width: this.collections.primitives.defaultLineWidth } };\n    } else if (Array.isArray(optionsIn)) {\n      optionsIn = { fill: optionsIn };\n    }\n    const o = joinObjects({}, defaultOptions, optionsIn);\n    this.frameSpace = o.space;\n    this.add('_frame', this.collections.rectangle(o));\n  }\n\n  getTraceIndex(name: string | number) {\n    if (typeof name === 'number') {\n      return name;\n    }\n    for (let i = 0; i < this.traces.length; i += 1) {\n      if (name === this.traces[i].name) {\n        return i;\n      }\n    }\n    return -1;\n  }\n\n  addLegend(legendOptions: COL_PlotLegend | boolean) {\n    let optionsIn;\n    if (legendOptions === true) {\n      optionsIn = {};\n    } else {\n      optionsIn = legendOptions;\n    }\n    const defaultOptions = {\n      traces: this.traces,\n      lineTextSpace: this.width / 50,\n      length: this.width / 10,\n      position: [this.width + this.width / 20, this.height],\n    };\n    const theme = this.getTheme(this.theme).legend;\n    const o = joinObjects({}, defaultOptions, theme, optionsIn);\n    const legend = this.collections.plotLegend(o);\n    this.add('_legend', legend);\n  }\n\n  getAxis(name: string) {\n    for (let i = 0; i < this.axes.length; i += 1) {\n      if (this.axes[i].name === name) {\n        return this.axes[i];\n      }\n    }\n    return null;\n  }\n\n  getXAxis() {\n    for (let i = 0; i < this.axes.length; i += 1) {\n      if (this.axes[i].axis === 'x') {\n        return this.axes[i];\n      }\n    }\n    return null;\n  }\n\n  getYAxis() {\n    for (let i = 0; i < this.axes.length; i += 1) {\n      if (this.axes[i].axis === 'y') {\n        return this.axes[i];\n      }\n    }\n    return null;\n  }\n\n  pointToDraw(\n    point: TypeParsablePoint,\n    xAxisName: string = 'x',\n    yAxisName: string = 'y',\n  ) {\n    const xAxis = this.getAxis(xAxisName);\n    const yAxis = this.getAxis(yAxisName);\n    if (xAxis == null || yAxis == null) {\n      return null;\n    }\n    const p = getPoint(point);\n    return new Point(xAxis.valueToDraw(p.x), yAxis.valueToDraw(p.y));\n  }\n\n  drawToPoint(\n    point: TypeParsablePoint,\n    xAxisName: string = 'x',\n    yAxisName: string = 'y',\n  ) {\n    const xAxis = this.getAxis(xAxisName);\n    const yAxis = this.getAxis(yAxisName);\n    if (xAxis == null || yAxis == null) {\n      return null;\n    }\n    const p = getPoint(point);\n    return new Point(xAxis.drawToPoint(p.x), yAxis.drawToPoint(p.y));\n  }\n\n  addTraces(traces: Array<COL_Trace>) {\n    const theme = this.getTheme(this.theme);\n    traces.forEach((traceOptions, index) => {\n      const defaultOptions = {\n        xAxis: 'x',\n        yAxis: 'y',\n        color: theme.traceColors[index % theme.traceColors.length],\n      };\n      const o = joinObjects({}, defaultOptions, traceOptions);\n      if (o.name == null) {\n        o.name = `trace_${index}`;\n      }\n      o.xAxis = this.getAxis(o.xAxis);\n      o.yAxis = this.getAxis(o.yAxis);\n\n      const trace = this.collections.trace(o);\n      this.add(o.name, trace);\n      this.traces.push(trace);\n    });\n  }\n\n  getTheme(name: string, axis: 'x' | 'y' = 'x', defaultColor: Array<number> | null = null) {\n    const length = axis === 'x' ? this.width : this.height;\n    const gridLength = axis === 'x' ? this.height : this.width;\n\n    // const minDimension = Math.min(\n    //   this.collections.primitives.limits.width, this.collections.primitives.limits.height);\n\n    let theme = {};\n    if (name === 'classic') {\n      const color = defaultColor == null ? [0.35, 0.35, 0.35, 1] : defaultColor;\n      const tickLength = Math.min(this.width, this.height) / 30;\n      const gridDash = this.collections.primitives.defaultLineWidth;\n      theme = {\n        axis: {\n          color,\n          line: { width: this.collections.primitives.defaultLineWidth },\n          ticks: {\n            width: this.collections.primitives.defaultLineWidth,\n            length: tickLength,\n            offset: -tickLength,\n          },\n          font: {\n            color,\n          },\n          length,\n          grid: {\n            color,\n            width: this.collections.primitives.defaultLineWidth / 2,\n            length: gridLength,\n            dash: [gridDash, gridDash],\n          },\n        },\n        title: {\n          font: { color },\n        },\n        legend: {\n          color,\n          font: { color },\n        },\n        traceColors: [\n          [0, 0, 1, 1],\n          [1, 0, 0, 1],\n          [0, 0.7, 0, 1],\n          [0.8, 0.8, 0.2, 1],\n          [0.2, 0.8, 0.8, 1],\n          [0.8, 0.2, 0.8, 1],\n        ],\n      };\n    }\n\n    if (theme.axis != null && theme.axis.grid != null) {\n      if (this.grid === false) {  // $FlowFixMe\n        delete theme.axis.grid;\n        // theme.axis.grid = undefined;\n      } else if (typeof this.grid === 'object' || Array.isArray(this.grid)) {\n        theme.axis.grid = joinObjects({}, theme.axis.grid, this.grid);\n      }\n    }\n    return theme;\n  }\n\n  addTitle(optionsIn: OBJ_TextLines & { offset: TypeParsablePoint } | string) {\n    const defaultOptions = {\n      font: joinObjects({}, this.defaultFont, { size: this.defaultFont.size * 1.5 }),\n      justify: 'center',\n      xAlign: 'center',\n      yAlign: 'bottom',\n      offset: [0, 0],\n    };\n    let optionsToUse = optionsIn;\n    if (typeof optionsIn === 'string') {\n      optionsToUse = { text: [optionsIn] };\n    }\n    const theme = this.getTheme(this.theme).title;\n    const o = joinObjects({}, defaultOptions, theme, optionsToUse);\n    o.offset = getPoint(o.offset);\n    const bounds = this.getNonTraceBoundingRect();\n    if (o.position == null) {\n      o.position = new Point(\n        this.width / 2 + o.offset.x,\n        bounds.top + o.font.size * 0.5 + o.offset.y,\n      );\n    }\n    const title = this.collections.primitives.textLines(o);\n    this.add('title', title);\n  }\n\n  // _getStateProperties(options: Object) {  // eslint-disable-line class-methods-use-this\n  //   return [...super._getStateProperties(options),\n  //     'angle',\n  //     'lastLabelRotationOffset',\n  //   ];\n  // }\n\n  // _fromState(state: Object) {\n  //   joinObjects(this, state);\n  //   this.setAngle({\n  //     angle: this.angle,\n  //     rotationOffset: this.lastLabelRotationOffset,\n  //   });\n  //   return this;\n  // }\n}\n\nexport default CollectionsPlot;\n","// @flow\n\nimport {\n  Transform, Point, getPoint, clipAngle,\n  RangeBounds, RectBounds,\n} from '../../tools/g2';\nimport type {\n  TypeRangeBoundsDefinition, TypeRectBoundsDefinition,\n} from '../../tools/g2';\nimport { joinObjects, joinObjectsWithOptions } from '../../tools/tools';\nimport { round, range } from '../../tools/math';\nimport {\n  FigureElementCollection, FigureElementPrimitive,\n} from '../Element';\nimport type {\n  COL_Line,\n} from './Line';\nimport type {\n  COL_Angle,\n} from './Angle';\n// import FigurePrimitives from '../FigurePrimitives/FigurePrimitives';\n// eslint-disable-next-line import/no-cycle\nimport FigureCollections from './FigureCollections';\n// import FigureEquation from '../Equation/FigureEquation';\nimport type { OBJ_Polyline, OBJ_Polygon, OBJ_Collection } from '../FigurePrimitives/FigurePrimitives';\n\n/* eslint-disable max-len */\n/**\n * Collections Polyline pad addition options.\n *\n * Each pad is associated with a point of the polyline.\n *\n * @extends OBJ_Polygon\n *\n * @property {boolean} [isMovable] `true` allows moving the pad and the\n * associated polyline point (`false`)\n * @property {TypeRangeBoundsDefinition | TypeRectBoundsDefinition | RangeBounds | RectBounds | 'figure'} [boundary]\n * boundary the pad can move within\n */\n/* eslint-enable max-len */\nexport type OBJ_PolylinePadSingle = {\n  isMovable?: boolean,\n  boundary?: TypeRangeBoundsDefinition | TypeRectBoundsDefinition | RangeBounds | RectBounds | 'figure',\n}\n\n/**\n  * @extends OBJ_PolylinePadSingle\n  * @extends OBJ_PolylineCustomization\n */\nexport type OBJ_PolylinePad = {};\n\n/**\n * Polyline side, angle and pad customization options object\n *\n * ![](./apiassets/polylinecustomization_ex1.png)\n *\n * ![](./apiassets/polylinecustomization_ex2.png)\n *\n * Side annotations, angle annotations and movable pads in an\n * {@link CollectionsPolyline} are defined with the options objects {@link COL_Line},\n * {@link COL_Angle} and ({@link OBJ_Polygon} & {@link OBJ_PolylinePadSingle})\n * respectively.\n *\n * The properties in this object can be used in the side, angle and movable\n * pad object definitions to allow for customization of specific sides,\n * angles and movable pads.\n *\n * Each side, angle and movable pad has an 0 based index associated with it.\n * The zero index pad is associated with the first point of the polyline. The\n * zero index side is between the first and second point of the polyline, and\n * the zero index angle is between the first, second and third point of the\n * polyline.\n *\n * By default, any properties defined for <a href=\"adv_polyline#pad\">pad</a>\n * will be applied to all pads of the polyline. To customize the first pad in\n * the polyline, an object property with name `'0'` can be used with a value\n * that includes the options object properties that should be customized.\n * Similary, for side and angle annotations, keys with the index name can be\n * used in their options objects to customize specific sides and angles.\n *\n * The `show` and `hide` properties can be used to show and hide specific sides\n * and angles.\n *\n * See {@link OBJ_PulseWidthAnimationStep} for pulse angle animation step\n * options.\n *\n * @property {Array<number>} [show] list of indexes to show\n * @property {Array<number>} [hide] list of indexes to hide\n * @property {COL_Angle | COL_Line | OBJ_PolylinePadSingle} [_index]\n * Customizations of annotation or pad by index where `_index` should be an\n * object key name that is the index\n *\n * @example\n * // Hide pad 0, and make pad 2 blue and not filled\n * figure.add({\n *   name: 'p',\n *   method: 'collections.polyline',\n *   options: {\n *     points: [[0, 0], [2, 0], [2, 2], [-2, 1]],\n *     pad: {\n *       radius: 0.2,            // OBJ_Polygon\n *       color: [1, 0, 0, 1],    // OBJ_Polygon\n *       touchBorder: 0.1,       // OBJ_Polygon\n *       isMovable: true,\n *       hide: [0],\n *       2: {                    // Custom pad 2 properties\n *         color: [0, 0, 1, 1],  // Make blue\n *         line: { width: 0.01 } // Use an outline instead of a fill\n *       },\n *     },\n *   }\n * });\n *\n * @example\n * // Customization of side and angle annotations\n * figure.add({\n *   name: 'p',\n *   method: 'collections.polyline',\n *   options: {\n *     points: [[0, 0], [1, 0], [1, 1], [0, 1]],\n *     close: true,\n *     side: {\n *       showLine: false,\n *       label: {\n *         text: null,                 // By default, sides are length values\n *         location: 'negative',\n *       },\n *       0: { label: { text: 'a' } },  // Side 0 is 'a' instead of length\n *     },\n *     angle: {\n *       label: {\n *         text: '?',\n *         offset: 0.05,\n *       },\n *       curve: {\n *         radius: 0.25,\n *       },\n *       direction: 'negative',\n *       show: [2],                   // Only show angle annotation for angle 2\n *     },\n *   }\n * });\n */\nexport type OBJ_PolylineCustomization = {\n  show?: Array<number>,\n  hide?: Array<number>,\n  _padIndex: OBJ_Polygon,\n};\n\n/**\n * When shapes get too small, angle and side annotations can start to draw on\n * each other. This object defines thresholds for when the angle and side\n * annotations should be hidden.\n *\n * @property {null | number} [minAngle]\n * @property {null | number} [maxAngle]\n * @property {null | number} [minSide]\n */\nexport type OBJ_ValidShapeHideThresholds = {\n  minAngle?: ?number,\n  maxAngle?: ?number,\n  minSide?: ?number,\n}\n\n\n/**\n * Makes the sides and angles of a closed polyline consistent. Also reverses\n * the point order if angles are on outside of shape instead of inside.\n *\n * Floating point rounding errors will sometimes result in angles\n * and side lengths being slightly larger or smaller than is possible.\n * For instance, for a triangle, there may be a rare case where the three\n * angles add up to 181 instead of 180 as a result of rounding the angle\n * labels to no decimal places.\n *\n * Making a shape consistent will go through all the side and angle labels\n * and correct them, displaying a value without rounding error.\n *\n * Currently, only `'triangle'` is supported.\n *\n * In addition, the angle and side annotations can be hidden if minimum\n * or maximum thresholds of angle and side values are crossed. For example,\n * for small triangles angle annotations may start to draw on top of each other\n * being messy.\n *\n * @property {'triangle'} [shape]\n * @property {OBJ_ValidShapeHideThresholds} [hide]\n */\nexport type OBJ_ValidShape = {\n  shape?: 'triangle',\n  hide?: OBJ_ValidShapeHideThresholds,\n};\n\n/**\n * @extends COL_Angle\n * @extends OBJ_PolylineCustomization\n */\nexport type OBJ_PolylineAngle = {}\n\n/**\n * @extends COL_Line\n * @extends OBJ_PolylineCustomization\n */\nexport type OBJ_PolylineSide = {}\n\n// /**\n//  * @extends OBJ_Polygon\n//  * @extends OBJ_PolylineCustomization\n//  */\n// export type COL_PolylinePad = {}\n\n/* eslint-disable max-len */\n/**\n * {@link CollectionsPolyline} options object that extends\n * {@link OBJ_Polyline} and {@link OBJ_Collection}\n * options object (without `parent`).\n *\n * The Collections Polyline is a convient and powerful polyline\n * {@link FigureElementCollection} that includes the polyline,\n * angle annotations, side label and arrow annotations, and movable\n * pads on each polyline point for the user to adjust dynamically.\n *\n * The polyline itself is defined with an {@link OBJ_Polyline} options Object.\n *\n * Angle and side annotations can be defined as {@link COL_Angle} and\n * {@link COL_Line}, and movable pads defined with\n * ({@link OBJ_Polygon} & {@link OBJ_PolylinePad}).\n *\n * Angles, sides and pads can all be defined either as an options object\n * or an array of options objects. If an array, then each element in the\n * array will correspond with a pad on the polyline. If there are less\n * elements in the array than pads on the polyline, then the elements\n * will recycle from the start.\n *\n * Using object definitions allows for a definition of all angles, sides and\n * pads. To customize for specific side, angle or pad indexes use =\n * {@link OBJ_PolylineCustomization}.\n *\n * @extends OBJ_Polyline\n * @extends OBJ_Collection\n *\n * @property {boolean} [showLine] `false` will hide the polyline's line (`true`)\n * @property {OBJ_PolylineAngle | Array<COL_Angle>} [angle] angle annotations - leave undefined for no angle annotations\n * @property {OBJ_PolylineSide | Array<COL_Line>} [side]\n * side annotations - leave undefined for no side annotations\n * @property {OBJ_PolylinePad | Array<OBJ_PolylinePadSingle>} [pad]\n * move pad - leave undefined for no move pads\n * @property {null | OBJ_ValidShapeHideThresholds} [makeValid] if defined, whenever\n * points are updated the shape will be checked to ensure consistency with\n * displayed labels of angles and sides.\n */\n/* eslint-enable max-len */\nexport type COL_Polyline = {\n  showLine?: boolean,\n  angle?: OBJ_PolylineAngle | Array<COL_Angle>,\n  side?: OBJ_PolylineSide | Array<COL_Line>,\n  pad?: OBJ_PolylinePad | Array<OBJ_PolylinePadSingle>,\n  makeValid?: ?OBJ_ValidShape,\n} & OBJ_Polyline & OBJ_Collection;\n\nfunction processArray(\n  toProcess: Object | Array<Object>,\n  defaultOptions: Object,\n  defaultLabelOptions: Object,\n  total: number,\n) {\n  if (Array.isArray(toProcess)) {\n    const out = [];\n    for (let i = 0; i < total; i += 1) {\n      const o = toProcess[i % toProcess.length];\n      if (o.label != null) {\n        out.push(joinObjects({}, defaultOptions, { label: defaultLabelOptions }, o));\n      } else {\n        out.push(joinObjects({}, defaultOptions, o));\n      }\n    }\n    return out;\n  }\n\n  const except = [];\n  for (let i = 0; i < total; i += 1) {\n    except.push(`${i}`);\n  }\n\n  const toProcessDefaults = joinObjectsWithOptions({ except }, {}, toProcess);\n  let labels = [];\n  if (\n    toProcessDefaults.label != null\n    && toProcessDefaults.label.text != null\n    && Array.isArray(toProcessDefaults.label.text)\n  ) {\n    labels = toProcessDefaults.label.text;\n  }\n\n  if (toProcessDefaults.label === null) {\n    toProcessDefaults.label = { text: null };\n  }\n  // console.log(toProcessDefaults, labels)\n\n  let show;\n  if (toProcessDefaults.show != null) {\n    ({ show } = toProcessDefaults);\n  } else if (total > 1) {\n    show = range(0, total - 1, 1);\n  } else {\n    show = [0];\n  }\n  if (toProcessDefaults.hide != null) {\n    toProcessDefaults.hide.forEach((index) => {\n      const i = show.indexOf(index);\n      if (i !== -1) {\n        show.splice(i, 1);\n      }\n    });\n  }\n  const out = [];\n  for (let i = 0; i < total; i += 1) {\n    if (show.indexOf(i) === -1) {\n      out.push(null);\n    } else {\n      const showIndex = show.indexOf(i);\n      const index = show[showIndex];\n      let indexOptions = {};\n      if (toProcess[`${index}`] != null) {\n        indexOptions = toProcess[`${index}`];\n      }\n      let labelDefaults = {};\n      if (labels.length > 0) {\n        const text = labels[showIndex % labels.length];\n        labelDefaults = { label: { text } };\n      }\n      // console.log(labelDefaults)\n      const o = joinObjects({}, defaultOptions, toProcessDefaults, labelDefaults, indexOptions);\n      if (o.label != null) {\n        out.push(joinObjects({}, { label: defaultLabelOptions }, o));\n      } else {\n        out.push(o);\n      }\n    }\n  }\n  return out;\n}\n\n/**\n * `'updatePoints'` subscription published whenever the Collections Polyline\n * points are updated. No payload is passed to subscriber.\n *\n * @typedef SUB_PolylineUpdatePoints\n */\nexport type SUB_PolylineUpdatePoints = [];\n\n/*\n..........########...#######..##.......##....##.##.......####.##....##.########\n..........##.....##.##.....##.##........##..##..##........##..###...##.##......\n..........##.....##.##.....##.##.........####...##........##..####..##.##......\n..........########..##.....##.##..........##....##........##..##.##.##.######..\n..........##........##.....##.##..........##....##........##..##..####.##......\n..........##........##.....##.##..........##....##........##..##...###.##......\n..........##.........#######..########....##....########.####.##....##.########\n*/\n\n/* eslint-disable max-len */\n/**\n * {@link FigureElementCollection} representing a polyline.\n *\n * ![](./apiassets/advpolyline_examples.png)\n *\n * <p class=\"inline_gif\"><img src=\"./apiassets/advpolyline_movepolyline.gif\" class=\"inline_gif_image\"></p>\n *\n * <p class=\"inline_gif\"><img src=\"./apiassets/advpolyline_movetri.gif\" class=\"inline_gif_image\"></p>\n *\n * This object defines a convient and powerful polyline\n * {@link FigureElementCollection} that includes a solid or dashed,\n * open or closed polyline, arrows, angle annotations for polyline corners,\n * side annotations for straight lines between points and move pads at polyline\n * points to dynamically adjust the polyline.\n *\n * See {@link COL_Polyline} for the options that can be used when creating the\n * line.\n *\n * Available subscriptions:\n *   - `'updatePoints'`: {@link SUB_PolylineUpdatePoints}\n *\n * @see\n * To test examples below, append them to the\n * <a href=\"#drawing-boilerplate\">boilerplate</a>.\n *\n *\n * @example\n * // Polyline with angle annotations\n * figure.add({\n *   name: 'p',\n *   method: 'collections.polyline',\n *   options: {\n *     points: [[1, 0], [0, 0], [0.5, 1], [1.5, 1]],\n *     arrow: 'triangle',\n *     angle: {\n *       label: null,\n *       curve: {\n *         radius: 0.3,\n *       },\n *     },\n *   }\n * });\n *\n * @example\n * // Triangle with unknown angle\n * figure.add({\n *   name: 'p',\n *   method: 'collections.polyline',\n *   options: {\n *     points: [[1, 1], [1, 0], [0, 0]],\n *     close: true,\n *     side: {\n *       label: null,\n *     },\n *     angle: {\n *       label: {\n *         text: '?',\n *         offset: 0.05,\n *       },\n *       curve: {\n *         radius: 0.4,\n *       },\n *       show: [1],\n *     },\n *   }\n * });\n *\n * @example\n * // Dimensioned square\n * figure.add({\n *   name: 'p',\n *   method: 'collections.polyline',\n *   options: {\n *     points: [[0, 1], [1, 1], [1, 0], [0, 0]],\n *     close: true,\n *     side: {\n *       showLine: true,\n *       offset: 0.2,\n *       color: [0, 0, 1, 1],\n *       arrow: 'barb',\n *       width: 0.01,\n *       label: null,\n *       dash: [0.05, 0.02],\n *       0: { label: { text: 'a' } },    // Customize side 0\n *     },\n *     angle: {\n *       curve: {\n *         autoRightAngle: true,\n *         radius: 0.3,\n *       },\n *     },\n *   }\n * });\n *\n * @example\n * // User adjustable polyline\n * figure.add({\n *   name: 'p',\n *   method: 'collections.polyline',\n *   options: {\n *     points: [[-0.5, 1], [1, 1], [0, 0], [1, -0.5]],\n *     dash: [0.05, 0.02],\n *     pad: {\n *       radius: 0.2,\n *       color: [1, 0, 0, 0.5],    // make alpha 0 to hide pad\n *       isMovable: true,\n *     },\n *   },\n * });\n *\n * @example\n * // Annotations that automatically updates as user changes triangle\n * figure.add({\n *   name: 'p',\n *   method: 'collections.polyline',\n *   options: {\n *     points: [[-1, 1], [1, 1], [0, 0]],\n *     close: true,\n *     makeValid: {\n *       shape: 'triangle',\n *       hide: {\n *         minAngle: Math.PI / 8,\n *       },\n *     },\n *     side: {\n *       showLine: true,\n *       offset: 0.2,\n *       color: [0.3, 0.6, 1, 1],\n *       arrow: 'barb',\n *       width: 0.01,\n *       label: {\n *         text: null,\n *       },\n *     },\n *     angle: {\n *       label: null,\n *       curve: { radius: 0.25 },\n *     },\n *     pad: {\n *       radius: 0.4,\n *       color: [1, 0, 0, 0.005],\n *       isMovable: true,\n *     },\n *   },\n * });\n */\n/* eslint-enable max-len */\nexport default class CollectionsPolyline extends FigureElementCollection {\n  collections: FigureCollections;\n  animateNextFrame: void => void;\n  isTouchDevice: boolean;\n  largerTouchBorder: boolean;\n  position: Point;\n  points: Array<Point>;\n  close: boolean;\n  _line: ?FigureElementPrimitive;\n  options: COL_Polyline;\n  updatePointsCallback: ?(string | (() => void));\n  reverse: boolean;\n  makeValid: ?{\n    shape: 'triangle';\n    hide: {\n      minAngle: ?number,\n      maxAngle: ?number,\n      minSide: ?number,\n    }\n  };\n\n  /**\n   * @hideconstructor\n   */\n  constructor(\n    collections: FigureCollections,\n    isTouchDevice: boolean,\n    animateNextFrame: void => void, // $FlowFixMe\n    options: COL_Polyline = {},\n  ) { // $FlowFixMe\n    const defaultOptions: COL_Polyline = {\n      color: collections.primitives.defaultColor, // $FlowFixMe\n      points: [new Point(1, 0), new Point(0, 0), new Point(0, 1)],\n      close: false,\n      showLine: true,\n      width: collections.primitives.defaultLineWidth,\n      reverse: false,\n      transform: new Transform('PolyLine').scale(1, 1).rotate(0).translate(0, 0),\n      makeValid: null,\n      limits: collections.primitives.limits,\n    };\n    if (options.makeValid != null && options.makeValid.shape != null && options.makeValid.shape === 'triangle') {\n      defaultOptions.makeValid = {\n        shape: 'triangle',\n        hide: {\n          minAngle: null,\n          maxAngle: null,\n          minSide: null,\n        },\n      };\n    }\n\n    const optionsToUse = joinObjects({}, defaultOptions, options);\n    super(optionsToUse);\n    this.setColor(optionsToUse.color);\n\n    this.collections = collections;\n    this.largerTouchBorder = optionsToUse.largerTouchBorder;\n    this.isTouchDevice = isTouchDevice;\n    this.animateNextFrame = animateNextFrame;\n    this.updatePointsCallback = null;\n\n    this.position = this.getPosition();\n    this.close = optionsToUse.close;\n    this.options = optionsToUse;\n    this.reverse = optionsToUse.reverse;\n    this.makeValid = optionsToUse.makeValid;\n\n    this.points = optionsToUse.points.map(p => getPoint(p));\n\n    // Add Pads first as they should be on the bottom of the drawing\n    if (optionsToUse.pad) {\n      this.addPads(optionsToUse.pad);\n    }\n\n    // Add Angles\n    if (optionsToUse.angle) {\n      this.addAngles(optionsToUse.angle, optionsToUse.close);\n    }\n\n    // Add Line\n    if (optionsToUse.showLine) {\n      const line = this.collections.primitives.polyline({\n        points: this.points,\n        width: options.width,\n        close: options.close,\n        widthIs: options.widthIs,\n        cornerStyle: options.cornerStyle,\n        cornerSize: options.cornerSize,\n        cornerSides: options.cornerSides,\n        minAutoCornerAngle: options.minAutoCornerAngle,\n        dash: options.dash,\n        color: options.color,\n        pulse: options.pulse,\n        arrow: options.arrow,\n        drawBorderBuffer: options.drawBorderBuffer,\n        touchBorder: 'buffer',\n      });\n      this.add('line', line);\n    }\n\n    if (optionsToUse.side) {\n      this.addSides(optionsToUse.side, optionsToUse.close);\n    }\n  }\n\n  addPads(pad: Object) {\n    const defaultPadOptions = {\n      sides: 20,\n      radius: 0.1,\n      color: this.color,\n      isMovable: false,\n      boundary: 'figure',\n    };\n    // const { pad } = optionsToUse;\n    const pCount = this.points.length;\n    // const padArray = makeArray(pad, pCount);\n    const padArray = processArray(pad, defaultPadOptions, {}, pCount);\n    for (let i = 0; i < pCount; i += 1) {\n      if (padArray[i] != null) {\n        const name = `pad${i}`;\n        const padOptions = joinObjects({}, {\n          transform: new Transform().translate(this.points[i]),\n        }, padArray[i]);\n        const padShape = this.collections.primitives.polygon(padOptions);\n        // $FlowFixMe\n        const { isMovable, boundary } = padArray[i];\n        if (isMovable) {\n          padShape.onAdd = () => {\n            padShape.setMovable();\n          };\n          if (boundary != null) {\n            padShape.move.sizeInBounds = true;\n            padShape.setMoveBounds(boundary);\n          }\n          const fnName = `_polyline_pad${i}`;\n          padShape.fnMap.add(\n            fnName,\n            (transform) => {\n              const index = parseInt(padShape.name.slice(3), 10);\n              const translation = transform.t();\n              if (translation != null) {\n                this.points[index] = translation._dup();\n                this.updatePoints(this.points);\n              }\n            },\n          );\n          padShape.setTransformCallback = fnName;\n        }\n        this.add(name, padShape);\n      }\n    }\n  }\n\n  addAngles(angle: Object, close: boolean) {\n    const defaultAngleOptions = {\n      color: this.color,\n      curve: {},\n      autoRightAngle: true,\n    };\n    const defaultAngleLabelOptions = {\n      text: null,\n      offset: 0.05,\n    };\n    let pCount = this.points.length;\n    if (close === false) {\n      pCount -= 2;\n    }\n    const angleArray = processArray(angle, defaultAngleOptions, defaultAngleLabelOptions, pCount);\n\n    for (let i = 0; i < pCount; i += 1) {\n      let p1 = i;\n      let p2 = i + 1;\n      let p3 = i + 2;\n      if (i === pCount - 2 && close) {\n        p3 = 0;\n      }\n      if (i === pCount - 1 && close) {\n        p2 = 0;\n        p3 = 1;\n      }\n      if (angleArray[i] != null) {\n        const name = `angle${i}`;\n        if (this.reverse) {\n          const newP1 = p3;\n          p3 = p1;\n          p1 = newP1;\n        }\n        const angleOptions = joinObjects({}, {\n          p1: this.points[p1],\n          p2: this.points[p2],\n          p3: this.points[p3],\n        }, angleArray[i]);\n        const angleAnnotation = this.collections.angle(angleOptions);\n        this.add(name, angleAnnotation);\n      }\n    }\n  }\n\n\n  addSides(side: Object, close: boolean) {\n    const defaultSideOptions = {\n      showLine: false,\n      offset: 0,\n      width: 0,\n      color: this.color,\n    };\n    const defaultSideLabelOptions = {\n      offset: 0.1,\n      text: null,\n      location: 'outside',\n      subLocation: 'top',\n      orientation: 'horizontal',\n      linePosition: 0.5,\n      scale: 0.7,\n    };\n    let pCount = this.points.length - 1;\n    if (close) {\n      pCount += 1;\n    }\n    const sideArray = processArray(side, defaultSideOptions, defaultSideLabelOptions, pCount);\n    for (let i = 0; i < pCount; i += 1) {\n      let j = i + 1;\n      if (i === pCount - 1 && close) {\n        j = 0;\n      }\n      if (sideArray[i] != null) {\n        const name = `side${i}${j}`;\n        let sideOptions = joinObjects({}, {\n          p1: this.points[i],\n          p2: this.points[j],\n        }, sideArray[i]);\n        if (this.reverse) {\n          sideOptions = joinObjects({}, {\n            p1: this.points[j],\n            p2: this.points[i],\n          }, sideArray[i]);\n        }\n        const sideLine = this.collections.line(sideOptions);\n        sideLine.custom.offset = sideOptions.offset;\n        this.add(name, sideLine);\n      }\n    }\n  }\n\n  _getStateProperties(options: Object) {  // eslint-disable-line class-methods-use-this\n    return [...super._getStateProperties(options),\n      'points',\n    ];\n  }\n\n  _fromState(state: Object) {\n    joinObjects(this, state);\n    this.updatePoints(this.points);\n    return this;\n  }\n\n  updateSideLabels(rotationOffset: number = 0) {\n    if (this.options.side != null) {\n      let pCount = this.points.length - 1;\n      if (this.close) {\n        pCount += 1;\n      }\n      for (let i = 0; i < pCount; i += 1) {\n        let j = i + 1;\n        if (i === pCount - 1 && this.close) {\n          j = 0;\n        }\n        const name = `side${i}${j}`;\n        if (this.elements[name] != null) {\n          const wasHidden = !this.elements[name].isShown;\n          this.elements[name].updateLabel(rotationOffset);\n          if (wasHidden) {\n            this.elements[name].hide();\n          }\n        }\n      }\n    }\n  }\n\n  updateAngleLabels(rotationOffset: number = 0) {\n    if (this.options.angle != null) {\n      let pCount = this.points.length;\n      if (this.close === false) {\n        pCount -= 2;\n      }\n      let firstIndex = 0;\n      if (this.close === false) {\n        firstIndex = 1;\n      }\n      for (let i = firstIndex; i < pCount + firstIndex; i += 1) {\n        const name = `angle${i}`;\n        if (this.elements[name] != null) {\n          const wasHidden = !this.elements[name].isShown;\n          this.elements[name].updateLabel(rotationOffset);\n          if (wasHidden) {\n            this.elements[name].hide();\n          }\n        }\n      }\n    }\n  }\n\n  /**\n   * Update the polyline with new point locations.\n   *\n   * Will publish {@link SUB_PolylineUpdatePoints} unless\n   * `doNotPublishUpdatePoints` is `true`.\n   */\n  updatePoints(newPointsIn: Array<Point>, doNotPublishUpdatePoints: boolean = false) {\n    const newPoints = newPointsIn.map(p => getPoint(p));\n    if (this._line != null) {\n      this._line.custom.updatePoints({ points: newPoints });\n    }\n\n    // Add Pads\n    let pCount = this.points.length;\n    if (this.options.pad) {\n      for (let i = 0; i < pCount; i += 1) {\n        const name = `pad${i}`;\n        if (this.elements[name]) {\n          // if (this.elements[name].isMovable === false) {\n          this.elements[name].transform.updateTranslation(newPoints[i]);\n          // }\n        }\n      }\n    }\n    if (this.options.side != null) {\n      pCount = this.points.length - 1;\n      if (this.close) {\n        pCount += 1;\n      }\n      for (let i = 0; i < pCount; i += 1) {\n        let j = i + 1;\n        if (i === pCount - 1 && this.close) {\n          j = 0;\n        }\n        const name = `side${i}${j}`;\n        if (this.elements[name] != null) {\n          const wasHidden = !this.elements[name].isShown;\n          if (this.reverse) {\n            this.elements[name].setEndPoints(\n              newPoints[j], newPoints[i], this.elements[name].custom.offset,\n            );\n          } else {\n            this.elements[name].setEndPoints(\n              newPoints[i], newPoints[j], this.elements[name].custom.offset,\n            );\n          }\n          if (wasHidden) {\n            this.elements[name].hide();\n          }\n        }\n      }\n    }\n\n    this.points = newPoints;\n    this.updateAngles();\n    if (this.makeValid != null && this.makeValid.shape === 'triangle' && !doNotPublishUpdatePoints) {\n      this.makeValidTriangle();\n    }\n    if (this.updatePointsCallback != null && !doNotPublishUpdatePoints) {\n      this.fnMap.exec(this.updatePointsCallback);\n      this.subscriptions.publish('updatePoints');\n    }\n  }\n\n  updateAngles() {\n    if (this.options.angle == null) {\n      return;\n    }\n    let pCount = this.points.length;\n    if (this.close === false) {\n      pCount -= 2;\n    }\n    for (let i = 0; i < pCount; i += 1) {\n      let p1 = i;\n      let p2 = i + 1;\n      let p3 = i + 2;\n      if (i === pCount - 2 && this.close) {\n        p3 = 0;\n      }\n      // let j = i + 1;\n      // let k = i - 1;\n      if (i === pCount - 1 && this.close) {\n        p2 = 0;\n        p3 = 1;\n      }\n      // if (i === 0 && this.close) {\n      //   k = pCount - 1;\n      // }\n      const name = `angle${i}`;\n      if (this.elements[name] != null) {\n        const wasHidden = !this.elements[name].isShown;\n        if (this.reverse) {\n          const newP1 = p3;\n          p3 = p1;\n          p1 = newP1;\n        }\n        this.elements[name].setAngle({\n          p1: this.points[p1],\n          p2: this.points[p2],\n          p3: this.points[p3],\n        });\n        if (wasHidden) {\n          this.elements[name].hide();\n        }\n      }\n    }\n  }\n\n\n  updateRotation(rotationOffset: number = 0) {\n    let i = 0;      // $FlowFixMe\n    let angle = this[`_angle${i}`];\n    while (angle != null) {\n      angle.update(this.getRotation() + rotationOffset);\n      i += 1;       // $FlowFixMe\n      angle = this[`_angle${i}`];\n    }\n\n    i = 0;          // $FlowFixMe\n    let side = this[`_side${i}${i + 1}`];\n    while (side != null) {\n      side.updateLabel(this.getRotation() + rotationOffset);\n      i += 1;       // $FlowFixMe\n      side = this[`_side${i}${i + 1}`];\n    }               // $FlowFixMe\n    side = this[`_side${i}${0}`];\n    if (side != null) {\n      side.updateLabel(this.getRotation() + rotationOffset);\n    }\n  }\n\n  /**\n   * Reverse points in the polyline.\n   *\n   * Will publish {@link SUBSCRIPTION_PolylineUpdatePoints} unless\n   * `doNotPublishUpdatePoints` is `true`.\n   *\n   * @param {boolean} doNotPublishUpdatePoints if `true` the `updatePoints`\n   * subscription will not be published.\n   */\n  reversePoints(doNotPublishUpdatePoints: boolean = true) {\n    const newPoints = [];\n    for (let i = 0; i < this.points.length; i += 1) {\n      newPoints.push(this.points[this.points.length - 1 - i]);\n    }\n    this.updatePoints(newPoints, doNotPublishUpdatePoints);\n  }\n\n  /**\n   * The Collections Polyline is a {@link FigureElementCollection}, with a\n   * transform that includes a translation, or position, transform element.\n   *\n   * Changing the position element of the transform would normally move\n   * everything in the collection. This method instead changes the position\n   * without moving everything by updating the polyline points with an\n   * offset that is the opposite new position.\n   *\n   * As an example, if a rotation around the second point of a polyline is\n   * desired, then setPositionWithoutMoving at the point before rotating.\n   */\n  setPositionWithoutMoving(\n    newPositionPointOrX: Point | number,\n    newPositionY: number = 0,\n  ) {\n    let newPosition = new Point(0, 0);\n    if (typeof newPositionPointOrX === 'number') {\n      newPosition.x = newPositionPointOrX;\n      newPosition.y = newPositionY;\n    } else {\n      newPosition = newPositionPointOrX;\n    }\n    const currentPosition = this.getPosition();\n    const delta = currentPosition.sub(newPosition);\n    this.setPosition(newPosition);\n    const newPoints = this.points.map(p => p.add(delta));\n    this.updatePoints(newPoints);\n  }\n\n  /**\n   * The Collections Polyline is a {@link FigureElementCollection}, with a\n   * transform that includes a rotation transform element.\n   *\n   * Changing the rotation element of the transform would normally rotate\n   * everything in the collection. This method instead changes the rotation\n   * without rotating everything by updating the polyline points with a\n   * rotation that is the negative of the `newRotation`.\n   */\n  setRotationWithoutMoving(newRotation: number) {\n    const currentRotation = this.getRotation();\n    const delta = currentRotation - newRotation;\n    const deltaMatrix = new Transform().rotate(delta).m();\n    this.setRotation(newRotation);\n    const newPoints = this.points.map(p => p.transformBy(deltaMatrix));\n    this.updatePoints(newPoints);\n  }\n\n  /**\n   * The Collections Polyline is a {@link FigureElementCollection}, with a\n   * transform that includes a scale transform element.\n   *\n   * Changing the scale element of the transform would normally scale\n   * everything in the collection. This method instead changes the scale\n   * without scaling everything by updating the polyline points with a\n   * scale that is the inverse of the new scale.\n   */\n  setScaleWithoutMoving(\n    newScalePointOrX: Point | number,\n    newScaleY: number = 0,\n  ) {\n    let newScale = new Point(0, 0);\n    if (typeof newScalePointOrX === 'number') {\n      newScale.x = newScalePointOrX;\n      newScale.y = newScaleY;\n    } else {\n      newScale = newScalePointOrX;\n    }\n    const currentScale = this.getScale();\n    const delta = new Point(\n      currentScale.x / newScale.x,\n      currentScale.y / newScale.y,\n    );\n    const deltaMatrix = new Transform().scale(delta).m();\n    this.setScale(newScale);\n    const newPoints = this.points.map(p => p.transformBy(deltaMatrix));\n    this.updatePoints(newPoints);\n  }\n\n  setShow(name: string, show: boolean) {\n    for (let i = 0; i < this.drawOrder.length; i += 1) {\n      const element = this.elements[this.drawOrder[i]];\n      if (element.name.startsWith(name)) {\n        if (show) {\n          element.showAll();\n        } else {\n          element.hide();\n        }\n      }\n    }\n  }\n\n  /**\n   * Hide all angle annotations.\n   */\n  hideAngles() {\n    this.setShow('angle', false);\n  }\n\n  /**\n   * Hide all side annotations.\n   */\n  hideSides() {\n    this.setShow('side', false);\n  }\n\n  /**\n   * Show all angle annotations.\n   */\n  showAngles() {\n    this.setShow('angle', true);\n  }\n\n  /**\n   * Hide all side annotations.\n   */\n  showSides() {\n    this.setShow('side', true);\n  }\n\n  updateLabels(rotationOffset: number = this.getRotation()) {\n    this.updateAngleLabels(rotationOffset);\n    this.updateSideLabels(rotationOffset);\n  }\n\n  makeValidTriangle() {\n    // $FlowFixMe\n    const angle0 = this._angle0;  // $FlowFixMe\n    const angle1 = this._angle1;  // $FlowFixMe\n    const angle2 = this._angle2;  // $FlowFixMe\n    const side01 = this._side01;  // $FlowFixMe\n    const side12 = this._side12;  // $FlowFixMe\n    const side20 = this._side20;\n    const anglePrecision = angle0.label.precision;\n    const sidePrecision = side01.label.precision;\n\n    // $FlowFixMe\n    const clipAngle0 = clipAngle(angle0.getAngle(), '0to360') * 180 / Math.PI;\n    const clipAngle1 = clipAngle(angle1.getAngle(), '0to360') * 180 / Math.PI;\n    const clipAngle2 = clipAngle(angle2.getAngle(), '0to360') * 180 / Math.PI;\n    let a0 = round(clipAngle0, anglePrecision);\n    let a1 = round(clipAngle1, anglePrecision);\n    let a2 = round(clipAngle2, anglePrecision);\n    let s01 = round(side01.getLength(), sidePrecision);\n    let s12 = round(side12.getLength(), sidePrecision);\n    let s20 = round(side20.getLength(), sidePrecision);\n\n    // Reverse the points if the angles are on the outside\n    if (a0 > 90 && a1 > 90 && a2 > 90) {\n      this.reverse = !this.reverse;\n      this.updatePoints(this.points, false);\n      a0 = round(clipAngle(angle0.getAngle(), '0to360') * 180 / Math.PI, anglePrecision);\n      a1 = round(clipAngle(angle1.getAngle(), '0to360') * 180 / Math.PI, anglePrecision);\n      a2 = round(clipAngle(angle2.getAngle(), '0to360') * 180 / Math.PI, anglePrecision);\n    }\n    // else {\n    // This is a weird case at the 0/360 transition\n    if (a0 > 180) {\n      a0 = 360 - angle0;\n    }\n    if (a1 > 180) {\n      a1 = 360 - angle1;\n    }\n    if (a2 > 180) {\n      a2 = 360 - angle2;\n    }\n\n    // Hide the angles if the triangle is thin or small enough\n    // if (\n    //   (angle0.label.autoHide > -1 && a0 > angle0.label.autoHide)\n    //   || (angle0.label.autoHideMax != null && angle0.label.autoHideMax < a0)\n    //   || (angle1.label.autoHide > -1 && a1 > angle1.label.autoHide)\n    //   || (angle1.label.autoHideMax != null && angle1.label.autoHideMax < a1)\n    //   || (angle2.label.autoHide > -1 && a2 > angle2.label.autoHide)\n    //   || (angle2.label.autoHideMax != null && angle2.label.autoHideMax < a2)\n    //   || s01 < 0.6 || s12 < 0.6 || s20 < 0.6\n    // ) {\n    // if (angle0.isShown) {\n    // Make angles consistent with 180\n    const tot = a0 + a1 + a2;\n    const diff = tot - 180;\n    // If the angles are > 180, then find the closet angle\n    // to rounding down and reduce it by diff\n    // If the angles are < 180 then find the closes angle\n    // to round down and round it down\n    const remainders = [\n      round(clipAngle0, anglePrecision + 1),\n      round(clipAngle1, anglePrecision + 1),\n      round(clipAngle2, anglePrecision + 1),\n    ].map(a => a - Math.floor(a * (10 ** anglePrecision)) / (10 ** anglePrecision));\n    const angles = [a0, a1, a2];\n    let indexToChange = 0;\n    if (tot > 180) {\n      indexToChange =\n        remainders.reduce((iMax, x, i, arr) => (x > arr[iMax] ? i : iMax), 0);\n    } else if (tot < 180) {\n      indexToChange =\n        remainders.reduce((iMin, x, i, arr) => (x < arr[iMin] ? i : iMin), 1);\n    }\n    angles[indexToChange] -= diff;\n    [a0, a1, a2] = angles;\n    angle0.setLabel(`${a0.toFixed(anglePrecision)}`);\n    angle1.setLabel(`${a1.toFixed(anglePrecision)}`);\n    angle2.setLabel(`${a2.toFixed(anglePrecision)}`);\n    angle0.checkLabelForRightAngle();\n    angle1.checkLabelForRightAngle();\n    angle2.checkLabelForRightAngle();\n\n    if (this.makeValid != null) {\n      const { minSide } = this.makeValid.hide;\n      let { minAngle, maxAngle } = this.makeValid.hide;\n      let hideAngles = false;\n      if (minAngle != null) {\n        minAngle *= 180 / Math.PI;\n        if (a0 < minAngle || a1 < minAngle || a2 < minAngle) {\n          hideAngles = true;\n        }\n      }\n      if (maxAngle != null) {\n        maxAngle *= 180 / Math.PI;\n        if (a0 > maxAngle || a1 > maxAngle || a2 > maxAngle) {\n          hideAngles = true;\n        }\n      }\n      if (\n        minSide != null && (s01 < minSide || s12 < minSide || s20 < minSide)\n      ) {\n        hideAngles = true;\n      }\n      if (hideAngles) {\n        this.hideAngles();\n      }\n    }\n\n    // Make sides consistent with equilateral or isosceles\n    if (\n      (side01.isShown || side12.isShown || side20.isShown)\n      && a0 > 0 && a0 < 180\n      && a1 > 0 && a1 < 180\n      && a2 > 0 && a2 < 180\n    ) {\n      // s12 = round(\n      //   s01 / Math.sin(a2 * Math.PI / 180) * Math.sin(a0 * Math.PI / 180),\n      //   sidePrecision,\n      // );\n      // s20 = round(\n      //   s01 / Math.sin(a2 * Math.PI / 180) * Math.sin(a1 * Math.PI / 180),\n      //   sidePrecision,\n      // );\n      const leastSigStep = 1 / (10 ** sidePrecision);\n      // If Equilateral, make all sides equal\n      if (a0 === 60 && a1 === 60 && a2 === 60) {\n        s12 = s01;\n        s20 = s01;\n      // If Isosceles possibility 1:\n      } else if (a0 === a1) {\n        s20 = s12;\n        if (s01 === s12) {\n          const moreAccurate = round(side01.getLength(), sidePrecision + 1);\n          if (moreAccurate < s01) {\n            s01 -= leastSigStep;\n          } else {\n            s01 += leastSigStep;\n          }\n        }\n      // If Isosceles possibility 2:\n      } else if (a0 === a2) {\n        s01 = s12;\n        if (s20 === s12) {\n          const moreAccurate = round(side20.getLength(), sidePrecision + 1);\n          if (moreAccurate < s20) {\n            s20 -= leastSigStep;\n          } else {\n            s20 += leastSigStep;\n          }\n        }\n      // If Isosceles possibility 3:\n      } else if (a1 === a2) {\n        s20 = s01;\n        if (s12 === s01) {\n          const moreAccurate = round(side12.getLength(), sidePrecision + 1);\n          if (moreAccurate < s12) {\n            s12 -= leastSigStep;\n          } else {\n            s12 += leastSigStep;\n          }\n        }\n      // If these are not equilateral, or isosceles, then all sides must be different length\n      }\n    }\n\n    // if (s01 === Infinity) {\n    //   s01 = round(side01.getLength(), sidePrecision);\n    // }\n    // if (s12 === Infinity) {\n    //   s12 = round(side12.getLength(), sidePrecision);\n    // }\n    // if (s20 === Infinity) {\n    //   s20 = round(side20.getLength(), sidePrecision);\n    // }\n    side01.setLabel(`${s01.toFixed(sidePrecision)}`);\n    side12.setLabel(`${s12.toFixed(sidePrecision)}`);\n    side20.setLabel(`${s20.toFixed(sidePrecision)}`);\n    // }\n  }\n\n  // _dup(exceptions: Array<string> = []) {\n  //   return super._dup([...exceptions, ...['collections']]);\n  // }\n}\n","// @flow\n\n// import Figure from '../Figure';\nimport {\n  Transform, Point, getBoundingRect,\n  // getPoint, getTransform,\n} from '../../tools/g2';\nimport type { TypeParsableBuffer } from '../../tools/g2';\n// import {\n//   round,\n// } from '../../tools/math';\nimport { joinObjects } from '../../tools/tools';\nimport {\n  FigureElementCollection, FigureElementPrimitive,\n} from '../Element';\nimport * as animation from '../Animation/Animation';\nimport type { OBJ_CustomAnimationStep } from '../Animation/Animation';\nimport type {\n  OBJ_LineStyleSimple, OBJ_Texture, OBJ_Collection, OBJ_TextLines,\n} from '../FigurePrimitives/FigurePrimitives';\nimport type {\n  TypeColor, OBJ_CurvedCorner,\n} from '../../tools/types';\nimport type { FigureElement } from '../Element';\nimport type FigureCollections from './FigureCollections';\n\n/**\n * Surround animation step.\n *\n * @property {FigureElement} [start] start element to surround (`this`)\n * @property {FigureElement} [target] target element to surround (`this`)\n * @property {TypeParsableBuffer} [space] space between rectangle and element (`0`)\n * @extends OBJ_CustomAnimationStep\n */\nexport type OBJ_SurroundAnimationStep = {\n  start?: number,\n  target?: number,\n} & OBJ_CustomAnimationStep;\n\n/**\n * Button colors when clicked.\n */\nexport type OBJ_ButtonColor = {\n  line?: TypeColor,\n  fill?: TypeColor,\n  label?: TypeColor,\n}\n\n/**\n * {@link CollectionsRectangle} options object that extends {@link OBJ_Collection}\n * options object (without `parent`).\n *\n * This rectangle is similar to {@link OBJ_Rectangle}, except it can accomodate\n * both a fill and a border or line simultaneously with different colors.\n *\n * @extends OBJ_Collection\n *\n * @property {number} [width] rectangle width\n * @property {number} [height] rectangle height\n * @property {'left' | 'center' | 'right' | number} [xAlign] horiztonal\n * alignment of the rectangle\n * @property {'bottom' | 'middle' | 'top' | number} [yAlign] vertical alignment\n* of the rectangle\n * @property {OBJ_LineStyleSimple} [line] lines style - leave empty if only\n * want fill\n * @property {TypeColor | OBJ_Texture} [fill] fill color or texture\n * @property {OBJ_CurvedCorner} [corner] corner style of rectangle\n * @property {OBJ_TextLines} [label] Rectangle label\n * @property {boolean | TypeColor | OBJ_ButtonColor} [button] `true` to\n * make the rectangle behave like a button when clicked. `TypeColor` to\n * make fill, line and label the same color when clicked or `OBJ_ButtonColor`\n * to specify click colors for each (`false`)\n */\nexport type COL_Rectangle = {\n  width?: number,\n  height?: number,\n  xAlign?: 'left' | 'center' | 'right' | number,\n  yAlign?: 'bottom' | 'middle' | 'top' | number,\n  line?: OBJ_LineStyleSimple,\n  fill?: TypeColor | OBJ_Texture,\n  corner?: OBJ_CurvedCorner,\n  label?: OBJ_TextLines,\n  button?: boolean | TypeColor | OBJ_ButtonColor,\n} & OBJ_Collection;\n\n/*\n..........########..########..######..########\n..........##.....##.##.......##....##....##...\n..........##.....##.##.......##..........##...\n..........########..######...##..........##...\n..........##...##...##.......##..........##...\n..........##....##..##.......##....##....##...\n..........##.....##.########..######.....##...\n*/\n/* eslint-disable max-len */\n/**\n * {@link FigureElementCollection} representing a rectangle.\n *\n * ![](./apiassets/advrectangle_ex1.png)\n * ![](./apiassets/advrectangle_ex2.png)\n *\n * <p class=\"inline_gif\"><img src=\"./apiassets/advrectangle.gif\" class=\"inline_gif_image\"></p>\n *\n * <p class=\"inline_gif\"><img src=\"./apiassets/advrectangle_button.gif\" class=\"inline_gif_image\"></p>\n *\n * This object defines a rectangle\n * {@link FigureElementCollection} that may include:\n * - border (line)\n * - fill\n * - label\n * - ability to surround another {@link FigureElement} with some space\n * - button behavior when clicked\n *\n * Surrounding another element can be executed through either the\n * <a href=\"#collectionsrectanglesurround\">surround</a> method\n * or the {@link OBJ_SurroundAnimationStep} found in the in\n * the animation manager ({@link FigureElement}.animations),\n * and in the animation builder\n * (<a href=\"#animationmanagernew\">animations.new</a>\n * and <a href=\"#animationmanagerbuilder\">animations.builder</a>).\n *\n * Button behavior means the button will temporarily change a different color\n * when it is clicked. By default, the button will become a little more\n * transparent, but colors for the fill, label and border can also be\n * specified.\n *\n * @see\n *\n * See {@link COL_Rectangle} for setup options.\n *\n * See {@link OBJ_SurroundAnimationStep} for surround animation step options.\n *\n * To test examples below, append them to the\n * <a href=\"#drawing-boilerplate\">boilerplate</a>.\n *\n * @example\n * // Simple rectangle\n * figure.add({\n *   name: 'rect',\n *   method: 'collections.rectangle',\n *   options: {\n *     width: 2,\n *     height: 1,\n *   },\n * });\n *\n * @example\n * // Round corner rectangle with fill and outside line\n * const rect = figure.collections.rectangle({\n *   width: 2,\n *   height: 1,\n *   line: {\n *     width: 0.02,\n *     widthIs: 'outside',\n *     dash: [0.1, 0.02],\n *   },\n *   corner: {\n *     radius: 0.2,\n *     sides: 10,\n *   },\n *   fill: [0.7, 0.7, 1, 1],\n * });\n * figure.add('rect', rect);\n *\n * @example\n * // Rectangle surrounds elements of an equation\n * figure.add([\n *   {\n *     name: 'rect',\n *     method: 'collections.rectangle',\n *     options: {\n *       color: [0.3, 0.3, 1, 1],\n *       line: { width: 0.01 },\n *     },\n *   },\n *   {\n *     name: 'eqn',\n *     method: 'equation',\n *     options: {\n *       forms: { 0: [{ frac: ['a', 'vinculum', 'b'] }, ' ', 'c'] },\n *       position: [1, 0],\n *       scale: 1.5,\n *     },\n *   }\n * ]);\n *\n * const rect = figure.getElement('rect');\n * const eqn = figure.getElement('eqn');\n *\n * rect.surround(eqn._a, 0.03);\n * rect.animations.new()\n *   .pulse({ delay: 1, scale: 1.5 })\n *   .surround({ target: eqn._b, space: 0.03, duration: 1 })\n *   .pulse({ delay: 1, scale: 1.5 })\n *   .surround({ target: eqn._c, space: 0.03, duration: 1 })\n *   .pulse({ delay: 1, scale: 1.5 })\n *   .start();\n *\n * @example\n * // Make a rectangle that behaves like a button\n * figure.add([\n *   {\n *     name: 'rect',\n *     method: 'collections.rectangle',\n *     options: {\n *       width: 0.5,\n *       height: 0.3,\n *       color: [0.3, 0.3, 0.3, 1],\n *       label: 'Save',\n *       corner: { radius: 0.05, sides: 10 },\n *       fill: [0.9, 0.9, 0.9, 1],\n *       button: {\n *         fill: [0.95, 0.95, 0.95, 1],\n *       },\n *     },\n *     mods: {\n *       isTouchable: true,\n *       onClick: () => console.log('clicked'),\n *     },\n *   },\n * ]);\n */\n/* eslint-enable max-len */\n// $FlowFixMe\nclass CollectionsRectangle extends FigureElementCollection {\n  _line: FigureElementPrimitive | null;\n  _fill: FigureElementPrimitive | null;\n  _label: FigureElementPrimitive | null;\n\n  width: number;\n  height: number;\n  xAlign: 'left' | 'center' | 'right' | number;\n  yAlign: 'bottom' | 'middle' | 'top' | number;\n  corner: OBJ_CurvedCorner;\n  labelOffset: Point;\n\n  animations: {\n    surround: (OBJ_SurroundAnimationStep) => animation.CustomAnimationStep,\n  } & animation.AnimationManager;\n\n  /**\n   * @hideconstructor\n   */\n  constructor(\n    collections: FigureCollections,\n    optionsIn: COL_Rectangle,\n  ) {\n    // super(new Transform('Plot')\n    //   .scale(1, 1)\n    //   .rotate(0)\n    //   .translate(0, 0), shapes.limits);\n\n    const defaultOptions = {\n      width: collections.primitives.defaultLength,\n      height: collections.primitives.defaultLength / 2,\n      xAlign: 'center',\n      yAlign: 'middle',\n      color: collections.primitives.defaultColor,\n      border: 'children',\n      touchBorder: 'border',\n      holeBorder: [[]],\n      corner: {\n        radius: 0,\n        sides: 1,\n      },\n      transform: new Transform('Rectangle').scale(1, 1).rotate(0).translate(0, 0),\n      limits: collections.primitives.limits,\n      // button: {},\n    };\n    const options = joinObjects({}, defaultOptions, optionsIn);\n    if (options.fill == null && options.line == null) {\n      options.fill = collections.primitives.defaultColor.slice();\n    }\n    super(options);\n    this.collections = collections;\n    this._line = null;\n    this._fill = null;\n    this._label = null;\n\n    this.width = options.width;\n    this.height = options.height;\n    this.xAlign = options.xAlign;\n    this.yAlign = options.yAlign;\n    this.border = options.border;\n    this.touchBorder = options.touchBorder;\n    this.holeBorder = options.holeBorder;\n    this.corner = options.corner;\n    this.labelOffset = new Point(0, 0);\n\n    // if (options.position != null) {\n    //   this.transform.updateTranslation(getPoint(options.position));\n    // }\n    // if (options.transform != null) {\n    //   this.transform = getTransform(options.transform);\n    // }\n\n    this.setColor(options.color);\n\n    if (options.fill != null) {\n      this.addRect(options.fill, 'fill', true);\n    }\n    if (options.line != null) {\n      this.addRect(options.line, 'line', false);\n    }\n    if (options.label != null) {\n      this.addlabel(options.label);\n    }\n    if (options.button) {\n      this.addButtonBehavior(options.button);\n    }\n\n    this.setPositions();\n\n    this.animations.surround = (...opt) => {\n      const o = joinObjects({}, { element: this, space: 0 }, ...opt);\n      let startPosition;\n      let startWidth;\n      let startHeight;\n      let targetPosition;\n      let targetWidth;\n      let targetHeight;\n      let deltaPosition;\n      let deltaWidth;\n      let deltaHeight;\n      let toSetup = true;\n      o.callback = (percentage) => {\n        if (toSetup) {\n          if (o.start == null) {\n            startPosition = this.getPosition('local');\n            startWidth = this.width;\n            startHeight = this.height;\n          } else {\n            [startPosition, startWidth, startHeight] = this.getSurround(o.start, o.space);\n          }\n          if (o.target == null) {\n            targetPosition = this.getPosition('local');\n            targetWidth = this.width;\n            targetHeight = this.height;\n          } else {\n            [targetPosition, targetWidth, targetHeight] = this.getSurround(o.target, o.space);\n          }\n          deltaPosition = targetPosition.sub(startPosition);\n          deltaWidth = targetWidth - startWidth;\n          deltaHeight = targetHeight - startHeight;\n          toSetup = false;\n        }\n        const newWidth = startWidth + deltaWidth * percentage;\n        const newHeight = startHeight + deltaHeight * percentage;\n        const newPosition = startPosition.add(deltaPosition.scale(percentage));\n        this.setSurround(newPosition, newWidth, newHeight);\n      };\n      return new animation.CustomAnimationStep(o);\n    };\n    this.animations.customSteps.push({\n      step: this.animations.surround.bind(this),\n      name: 'surround',\n    });\n  }\n\n  addButtonBehavior(onClickColors: {\n    line?: TypeColor,\n    fill?: TypeColor,\n    label?: TypeColor,\n  } | TypeColor | boolean) {\n    const click = (name) => {\n      const element = this.elements[name];\n      if (element == null) {\n        return;\n      }\n      const currentColor = element.color.slice();\n      let targetColor;\n      if (Array.isArray(onClickColors)) {\n        targetColor = onClickColors.slice();  // $FlowFixMe\n      } else if (onClickColors !== true && onClickColors[name] != null) {\n        targetColor = onClickColors[name].slice();\n      }\n      element.animations.new()\n        .trigger({\n          callback: () => {\n            if (targetColor == null) {\n              element.opacity = 0.8;\n            } else {\n              element.setColor(targetColor);\n            }\n          },\n          duration: 0.1,\n        })\n        .trigger({\n          callback: () => {\n            if (targetColor == null) {\n              element.opacity = 1;\n            } else {\n              element.setColor(currentColor);\n            }\n          },\n        })\n        .ifCanceledThenComplete()\n        .start();\n      // this.animateNextFrame();\n    };\n    this.subscriptions.add('onClick', () => {\n      click('line');\n      click('fill');\n      click('label');\n    });\n  }\n\n  addRect(rectOptions: OBJ_LineStyleSimple, name: string, fill: boolean) {\n    const defaultOptions = {\n      width: this.width,\n      height: this.height,\n      xAlign: 'center',\n      yAlign: 'middle',\n      color: this.color,\n      corner: this.corner,\n    };\n    if (!fill) {  // $FlowFixMe\n      defaultOptions.line = {\n        widthIs: 'inside',\n        cornerStyle: 'auto',\n        width: Math.max(\n          Math.min(this.width, this.height) / 100,\n          this.collections.primitives.defaultLineWidth,\n        ),\n      };\n      if (defaultOptions.line.width > this.width || defaultOptions.line.width > this.height) {\n        defaultOptions.line.widthIs = 'mid';\n      }\n    }\n    let optionsIn;\n    if (fill) {\n      if (Array.isArray(rectOptions)) {\n        optionsIn = { color: rectOptions };\n      } else {\n        optionsIn = { texture: rectOptions };\n      }\n    } else {\n      optionsIn = { line: rectOptions };\n    }\n    const o = joinObjects({}, defaultOptions, optionsIn); // $FlowFixMe\n    this[name] = o;\n    const rect = this.collections.primitives.rectangle(o);\n    this.add(name, rect);\n  }\n\n  setPositions() {\n    const bounds = { width: this.width, height: this.height };\n    const position = new Point(0, 0);\n    if (this.xAlign === 'left') {\n      position.x += bounds.width / 2;\n    } else if (this.xAlign === 'right') {\n      position.x -= bounds.width / 2;\n    } else if (typeof this.xAlign === 'number') {\n      position.x = position.x + bounds.width / 2 - this.xAlign * bounds.width;\n    }\n    if (this.yAlign === 'bottom') {\n      position.y += bounds.height / 2;\n    } else if (this.yAlign === 'top') {\n      position.y -= bounds.height / 2;\n    } else if (typeof this.yAlign === 'number') {\n      position.y = position.y + bounds.height / 2 - bounds.height * this.yAlign;\n    }\n    const { _line, _fill, _label } = this;\n    if (_line) {\n      _line.setPosition(position);\n    }\n    if (_fill) {\n      _fill.setPosition(position);\n    }\n    if (_label) {\n      // const delta = _label.getPosition('local');\n      _label.setPosition(position.add(this.labelOffset));\n      // const numLines = this._label.drawingObject.lines.length;\n      // const numText = this._label.drawingObject.text.length;\n      // if (numLines === 1 )\n      // if (numLines === 1) {}\n      // this._label.setPosition(position);\n    }\n    // return position;\n  }\n\n  addlabel(textOptions: OBJ_TextLines | string) {\n    const defaultOptions = {\n      font: joinObjects({}, this.collections.primitives.defaultFont),\n      xAlign: 'center',\n      yAlign: 'baseline',\n      justify: 'center',\n      color: this.color,\n    };\n    defaultOptions.font.size = this.height * 0.4;\n    defaultOptions.font.color = this.color;\n\n    let optionsIn;\n    if (typeof textOptions === 'string') {\n      optionsIn = { text: textOptions };\n    } else {\n      optionsIn = textOptions;\n    }\n    const o = joinObjects({}, defaultOptions, optionsIn);\n    this.labelOffset = new Point(0, -o.font.size / 2.5);\n    // if (o.position == null) {\n    //   o.position = new Point(0, -o.font.size / 2.5);\n    // }\n    // o.position = o.position.add(this.getAlignmentPosition());\n    const label = this.collections.primitives.textLines(o);\n    this.add('label', label);\n  }\n\n  getSurround(element: FigureElement | Array<FigureElement>, space: TypeParsableBuffer = 0) {\n    let bounds;\n    if (Array.isArray(element)) {\n      const borders: Array<Array<Point>> = [];\n      element.forEach((e) => {\n        const b = e.getBorder('figure');\n        borders.push(...b);\n      });\n      bounds = getBoundingRect(borders, space);\n    } else {\n      bounds = getBoundingRect(element.getBorder('figure'), space);\n    }\n    const matrix = this.spaceTransformMatrix('figure', 'draw');\n    const scale = matrix[0];\n    const newWidth = bounds.width * scale;\n    const newHeight = bounds.height * scale;\n    const center = new Point(\n      bounds.left + bounds.width / 2,\n      bounds.bottom + bounds.height / 2,\n    ).transformBy(this.spaceTransformMatrix('figure', 'local'));\n    const position = center;\n    if (this.xAlign === 'left') {\n      position.x -= newWidth / 2;\n    } else if (this.xAlign === 'right') {\n      position.x += newWidth / 2;\n    } else if (typeof this.xAlign === 'number') {\n      position.x = position.x - newWidth / 2 + this.xAlign * newWidth;\n    }\n    if (this.yAlign === 'bottom') {\n      position.y -= newHeight / 2;\n    } else if (this.yAlign === 'top') {\n      position.y += newHeight / 2;\n    } else if (typeof this.yAlign === 'number') {\n      position.y = position.y - newHeight / 2 + newHeight * this.yAlign;\n    }\n    return [position, newWidth, newHeight];\n  }\n\n  /**\n   * Surround element of elements with the rectangle.\n   */\n  surround(element: FigureElement | Array<FigureElement>, space: TypeParsableBuffer = 0) {\n    const [position, width, height] = this.getSurround(element, space);\n    this.setSurround(position, width, height);\n  }\n\n  setSurround(position: Point, width: number, height: number) {\n    this.width = width;\n    this.height = height;\n    if (this._line) {\n      this._line.custom.updatePoints({ width, height });\n    }\n    if (this._fill) {\n      this._fill.custom.updatePoints({ width, height });\n    }\n    // if (this._label) {\n    //   this._label.\n    // }\n    this.setPositions();\n    this.setPosition(position);\n  }\n\n  /**\n   * Set button label.\n   */\n  setLabel(text: string | OBJ_TextLines) {\n    if (this._label != null) {\n      let textToUse;\n      if (typeof text === 'string') {\n        textToUse = { text };\n      } else {\n        textToUse = text;\n      }\n      this._label.custom.updateText(textToUse);\n    }\n  }\n\n  /**\n   * Get button label.\n   */\n  getLabel() {\n    if (this._label != null) {  // $FlowFixMe\n      return this._label.drawingObject.text[0].text;\n    }\n    return '';\n  }\n}\n\nexport default CollectionsRectangle;\n","// @flow\n\n// import Figure from '../Figure';\nimport {\n  Transform,\n  // getPoint, getTransform,\n} from '../../tools/g2';\n// import {\n//   round,\n// } from '../../tools/math';\nimport { joinObjects } from '../../tools/tools';\nimport {\n  FigureElementCollection,\n} from '../Element';\nimport type { FigureElement } from '../Element';\nimport type {\n  OBJ_Collection, OBJ_TextLines, OBJ_Arrow,\n} from '../FigurePrimitives/FigurePrimitives';\nimport type FigureCollections from './FigureCollections';\nimport SlideNavigator from '../SlideNavigator';\nimport type { OBJ_SlideNavigatorSlide } from '../SlideNavigator';\nimport type { COL_Rectangle } from './Rectangle';\nimport type Figure from '../Figure';\nimport type { Equation } from '../Equation/Equation';\n\n\nexport type COL_SlideNavigatorButton = {\n  type: 'arrow' | 'rectangle'\n} & COL_Rectangle & OBJ_Arrow;\n\n/**\n * {@link CollectionsSlideNavigator} options object that extends\n * {@link OBJ_Collection} options object (without `parent`).\n *\n * This rectangle is similar to {@link OBJ_Rectangle}, except it can accomodate\n * both a fill and a border or line simultaneously with different colors.\n *\n * @extends OBJ_Collection\n *\n * @property {number} [width] rectangle width\n * @property {number} [height] rectangle height\n * @property {'left' | 'center' | 'right' | number} [xAlign] horiztonal\n * alignment of the rectangle\n * @property {'bottom' | 'middle' | 'top' | number} [yAlign] vertical alignment\n* of the rectangle\n * @property {OBJ_LineStyleSimple} [line] lines style - leave empty if only\n * want fill\n * @property {TypeColor | OBJ_Texture} [fill] fill color or texture\n * @property {OBJ_CurvedCorner} [corner] corner style of rectangle\n * @property {OBJ_TextLines} [label] Rectangle label\n * @property {boolean | TypeColor | OBJ_ButtonColor} [button] `true` to\n * make the rectangle behave like a button when clicked. `TypeColor` to\n * make fill, line and label the same color when clicked or `OBJ_ButtonColor`\n * to specify click colors for each (`false`)\n */\nexport type COL_SlideNavigator = {\n  collection: Figure | FigureElementCollection | string,\n  slides: Array<OBJ_SlideNavigatorSlide>,\n  prevButton?: COL_SlideNavigatorButton,\n  nextButton?: COL_SlideNavigatorButton,\n  text?: OBJ_TextLines,\n  equation?: Equation | string | Array<string | Equation>,\n  equationDefaults: {\n    duration?: number,\n    animate?: 'move' | 'dissolve' | 'instant',\n  },\n} & OBJ_Collection;\n\n\n/*\n.............##....##....###....##.....##\n.............###...##...##.##...##.....##\n.............####..##..##...##..##.....##\n.............##.##.##.##.....##.##.....##\n.............##..####.#########..##...##.\n.............##...###.##.....##...##.##..\n.............##....##.##.....##....###...\n*/\n/* eslint-disable max-len */\n/**\n * {@link FigureElementCollection} that creates elements to work with {@link SlideNavigator}.\n *\n * <p class=\"inline_gif\"><img src=\"./apiassets/slidenavigator1.gif\" class=\"inline_gif_image\"></p>\n *\n * <p class=\"inline_gif\"><img src=\"./apiassets/slidenavigator2.gif\" class=\"inline_gif_image\"></p>\n *\n * <p class=\"inline_gif\"><img src=\"./apiassets/slidenavigator3.gif\" class=\"inline_gif_image\"></p>\n *\n * This object defines a rectangle\n * {@link FigureElementCollection} that may include:\n * - previous button\n * - next button\n * - {@link OBJ_TextLines} object\n *\n *\n * @see\n *\n * See {@link SlideNavigator} for information about what a slide navigator is.\n *\n * To test examples below, append them to the\n * <a href=\"#equation-boilerplate\">boilerplate</a>.\n *\n * @example\n * // At its simplest, the SlideNavigator can be used to navigate an equation\n * figure.add([\n *   {\n *     name: 'eqn',\n *     method: 'equation',\n *     options: {\n *       formDefaults: { alignment: { xAlign: 'center' } },\n *       forms: {\n *         0: ['a', '_ + ', 'b', '_ = ', 'c'],\n *         1: ['a', '_ + ', 'b', '_ - b_1', '_ = ', 'c', '_ - ', 'b_2'],\n *         2: ['a', '_ = ', 'c', '_ - ', 'b_2'],\n *       },\n *       formSeries: ['0', '1', '2'],\n *     },\n *   },\n *   {\n *     name: 'nav',\n *     method: 'collections.slideNavigator',\n *     options: {\n *       equation: 'eqn',\n *     },\n *   },\n * ]);\n *\n * @example\n * // Text can be used to describe each slide\n * figure.add([\n *   {\n *     name: 'eqn',\n *     method: 'equation',\n *     options: {\n *       formDefaults: { alignment: { xAlign: 'center' } },\n *       forms: {\n *         0: ['a', '_ + ', 'b', '_ = ', 'c'],\n *         1: ['a', '_ + ', 'b', '_ - b_1', '_ = ', 'c', '_ - ', 'b_2'],\n *         2: ['a', '_ = ', 'c', '_ - ', 'b_2'],\n *       },\n *     },\n *   },\n *   {\n *     name: 'nav',\n *     method: 'collections.slideNavigator',\n *     options: {\n *       equation: 'eqn',\n *       text: { position: [0, 0.3] },\n *       slides: [\n *         { text: 'Start with the equation', form: '0' },\n *         { text: 'Subtract b from both sides' },\n *         { form: '1' },\n *         { text: 'The b terms cancel on the left hand side' },\n *         { form: '2' },\n *       ],\n *     },\n *   },\n * ]);\n *\n * @example\n * // This example creates a story by evolving a description, a diagram\n * // and an equation.\n * figure.add([\n *   {   // Square drawing\n *     name: 'square',\n *     method: 'primitives.rectangle',\n *     options: {\n *       width: 0.4,\n *       height: 0.4,\n *       line: { width: 0.005 },\n *     },\n *   },\n *   {   // Side length label\n *     name: 'label',\n *     method: 'text',\n *     options: {\n *       yAlign: 'middle',\n *       position: [0.3, 0],\n *     },\n *   },\n *   {   // Equation\n *     name: 'eqn',\n *     method: 'equation',\n *     options: {\n *       elements: {\n *         eq1: '  =  ',\n *         eq2: '  =  ',\n *         eq3: '  =  ',\n *       },\n *       phrases: {\n *         sideSqrd: { sup: ['side', '_2'] },\n *         areaEqSide: [{ bottomComment: ['Area', 'square'] }, 'eq1', 'sideSqrd'],\n *       },\n *       formDefaults: { alignment: { xAlign: 'center' } },\n *       forms: {\n *         0: ['areaEqSide'],\n *         1: ['areaEqSide', 'eq2', { sup: ['_1', '_2_1'] }, 'eq3', '_1_1'],\n *         2: ['areaEqSide', 'eq2', { sup: ['_2_2', '_2_1'] }, 'eq3', '4'],\n *       },\n *       position: [0, -0.8],\n *     },\n *   },\n *   {   // Slide Navigator\n *     name: 'nav',\n *     method: 'collections.slideNavigator',\n *     options: {\n *       equation: 'eqn',\n *       nextButton: { type: 'arrow', position: [1.2, -0.8] },\n *       prevButton: { type: 'arrow', position: [-1.2, -0.8] },\n *       text: { position: [0, 0.7], font: { size: 0.12 } },\n *     },\n *   },\n * ]);\n *\n * const square = figure.getElement('square');\n * const label = figure.getElement('label');\n *\n * // Update the square size, and side label for any sideLength\n * const update = (sideLength) => {\n *   square.custom.updatePoints({ width: sideLength, height: sideLength });\n *   label.setPosition(sideLength / 2 + 0.1, 0);\n *   label.custom.updateText({ text: `${(sideLength / 0.4).toFixed(1)}` });\n * };\n *\n * // Add slides to the navigator\n * figure.getElement('nav').loadSlides([\n *   {\n *     text: 'The area of a square is the side length squared',\n *     form: '0',\n *     steadyStateCommon: () => update(0.4),\n *   },\n *   { text: 'So for side length of 1 we have and area of 1' },\n *   { form: '1' },\n *   { form: null, text: 'What is the area for side length 2?' },\n *   {\n *     transition: (done) => {\n *       square.animations.new()\n *         .custom({\n *           duration: 1,\n *           callback: p => update(0.4 + p * 0.4),\n *         })\n *         .whenFinished(done)\n *         .start();\n *     },\n *     steadyStateCommon: () => update(0.4),\n *   },\n *   { form: '2' },\n * ]);\n */\n/* eslint-enable max-len */\nclass CollectionsSlideNavigator extends FigureElementCollection {\n  _nextButton: FigureElement | null;\n  _prevButton: FigureElement | null;\n  _text: FigureElement | null;\n\n  nav: SlideNavigator;\n\n  /**\n   * @hideconstructor\n   */\n  constructor(\n    collections: FigureCollections,\n    optionsIn: COL_SlideNavigator,\n  ) {\n    const defaultOptions = {\n      transform: new Transform('SlideNavigator').scale(1, 1).rotate(0).translate(0, 0),\n      limits: collections.primitives.limits,\n      // slides: [],\n      color: collections.primitives.defaultColor,\n    };\n    const o = joinObjects({}, defaultOptions, optionsIn);\n    super(o);\n\n    this.collections = collections;\n    this._nextButton = null;\n    this._prevButton = null;\n    this._text = null;\n    if (!o.prevButton !== null) {\n      this.addButton(o.prevButton || {}, 'Prev');\n    }\n    if (!o.nextButton !== null) {\n      this.addButton(o.nextButton || {}, 'Next');\n    }\n    if (!o.text !== null) {\n      this.addText(o.text || {});\n    }\n\n    this.nav = new SlideNavigator();\n    this.custom.options = o;\n    // this.nav = new SlideNavigator(joinObjects({}, {\n    //   collection: o.collection || this,\n    //   slides: o.slides,\n    //   equation: o.equation,\n    //   equationDefaults: o.equationDefaults,\n    //   prevButton: this._prevButton,\n    //   nextButton: this._nextButton,\n    //   text: this._text,\n    // }));\n\n    // if (o.collection == null) {\n    //   this.nav.collection = null;\n    // }\n    this.hasTouchableElements = true;\n    this.onAdd = () => {\n      this.nav.load({ // $FlowFixMe\n        collection: this.parent,\n        slides: o.slides,\n        equation: o.equation,\n        equationDefaults: o.equationDefaults,\n        prevButton: this._prevButton,\n        nextButton: this._nextButton,  // $FlowFixMe\n        text: this._text,\n      });\n      this.nav.goToSlide(0);\n      // if (this.nav.collection == null && this.parent != null) {\n      //   this.nav.equations =\n      //     Array.isArray(o.equation) ? o.equation : [o.equation];\n      //   this.nav.collection = this.parent;\n      //   this.nav.setEquations();\n      //   this.nav.goToSlide(0);\n      // }\n    };\n  }\n\n  /**\n   * Load slides into navigator\n   */\n  loadSlides(slides: Array<OBJ_SlideNavigatorSlide>) {\n    this.nav.slides = slides;\n    this.nav.goToSlide(0);\n  }\n\n  /**\n   * Jump to a specific slide.\n   */\n  goToSlide(slideIndex: number) {\n    this.nav.goToSlide(slideIndex);\n  }\n\n  /**\n   * Progress to the next slide.\n   */\n  nextSlide(ignoreTransition: boolean = false) {\n    this.nav.nextSlide(ignoreTransition);\n  }\n\n  /**\n   * Go to the previous slide.\n   */\n  prevSlide() {\n    this.nav.prevSlide();\n  }\n\n  // onAdd() {\n  //   console.log('asdf', this.parent)\n  //   if (this.nav.collection == null && this.parent != null) {\n  //     this.nav.collection = this.parent;\n  //     this.nav.setEquations();\n  //   }\n  // }\n\n  addText(textOptions: OBJ_TextLines | string) {\n    const defaultOptions = {\n      font: joinObjects({}, this.collections.primitives.defaultFont),\n      text: '',\n      xAlign: 'center',\n    };\n    // defaultOptions.font.size = this.collections.primti * 0.4;\n    defaultOptions.font.color = this.color;\n\n    let optionsIn;\n    if (typeof textOptions === 'string') {\n      optionsIn = { text: textOptions };\n    } else {\n      optionsIn = textOptions;\n    }\n    const o = joinObjects({}, defaultOptions, optionsIn);\n    const text = this.collections.primitives.textLines(o);\n    text.isTouchable = true;\n    this.add('text', text);\n  }\n\n  addButton(options: COL_SlideNavigatorButton, type: 'Next' | 'Prev') {\n    let button;\n    if (options.type === 'arrow') {\n      button = this.getArrowButton(options, type);\n    } else {\n      button = this.getRectangleButton(options, type);\n    }\n    button.isTouchable = true;\n    if (type === 'Next') {\n      this.add('nextButton', button);\n    } else {\n      this.add('prevButton', button);\n    }\n  }\n\n  getRectangleButton(options: COL_SlideNavigatorButton, type: 'Next' | 'Prev') {\n    const length = this.collections.primitives.defaultLength;\n    const x = type === 'Next' ? length / 3 : -length / 3;\n\n    const defaultButtonOptions = {\n      width: length / 3,\n      height: length / 5,\n      line: { width: this.collections.primitives.defaultLineWidth },\n      corner: { radius: length / 30, sides: 10 },\n      button: true,\n      label: type,\n      position: [x, -length / 4],\n    };\n    const buttonOptions = joinObjects({}, defaultButtonOptions, options);\n    return this.collections.rectangle(buttonOptions);\n  }\n\n  getArrowButton(options: COL_SlideNavigatorButton, type: 'Next' | 'Prev') {\n    const length = this.collections.primitives.defaultLength / 4;\n    let angle = 0;\n    let x = length;\n    if (type === 'Prev') {\n      angle = Math.PI;\n      x = -x;\n    }\n\n    const defaultButtonOptions = {\n      head: 'triangle',\n      length,\n      width: length,\n      angle,\n      position: [x, -length],\n      align: 'mid',\n    };\n    const buttonOptions = joinObjects({}, defaultButtonOptions, options);\n    return this.collections.primitives.arrow(buttonOptions);\n  }\n}\n\nexport default CollectionsSlideNavigator;\n","// @flow\n\n// import Figure from '../Figure';\nimport {\n  Transform, Point, Line,\n  getPoints,\n} from '../../tools/g2';\nimport type { TypeParsablePoint } from '../../tools/g2';\n// import {\n//   round, range,\n// } from '../../tools/math';\nimport { joinObjects } from '../../tools/tools';\nimport {\n  FigureElementCollection, FigureElementPrimitive,\n} from '../Element';\nimport type CollectionsAxis, { COL_Axis } from './Axis';\nimport type {\n  OBJ_Line, OBJ_Polygon, OBJ_Star, OBJ_LineStyleSimple, OBJ_Collection,\n} from '../FigurePrimitives/FigurePrimitives';\nimport type { TypeColor, OBJ_Font_Fixed } from '../../tools/types';\nimport type { CPY_Steps } from '../geometries/copy/copy';\nimport type FigureCollections from './FigureCollections';\n\n/**\n * {@link CollectionsTrace} options object that extends {@link OBJ_Collection}\n * options object (without `parent`).\n *\n * A plot trace is a set of (x, y) points associated with an\n * x and y axis.\n *\n * The trace and can be drawn with either a set of\n * `markers` at each point, or a `line` between each pair of adjacent points.\n *\n * The axes are used to plot the trace - the trace\n * can only appear within the bounds of the axes, and the axes\n * provide the mapping from axis value to draw space so the trace\n * can be drawn. Points that lie outside the axis will not be draw,\n * and lines between pairs of points where one is outside will be interpolated.\n *\n * While FigureOne isn't designed to process very large numbers of points,\n * some steps can be taken to improve performance when large numbers of points\n * are being used (tens of thousands or more):\n * - Turn off corner interpolation between line segments in `line`:\n *   `{ line: { corner: 'none` } }`\n * - Use `xSampleDistance` and `ySampleDistance` to not draw points that are\n *   too close to each other\n * - If using markers, use polygons with smaller numbers of sides, and use fills\n *   instead of outlines\n *\n * Even using these methods, it can take up to a second to render a trace with\n * hundreds of thousands of points (depending on the client device).\n *\n * @extends OBJ_Collection\n *\n * @property {Array<TypeParsablePoint>} points the x points of the trace\n * @property {COL_Axis | string} [xAxis] The x axis associated with the trace,\n * if this is a string, the trace must be part of a plot with an axis with the\n * same name. In plots, this will default to the string `'x'`.\n * @property {COL_Axis | string} [yAxis] The y axis associated with the trace,\n * if this is a string, the trace must be part of a plot with an axis with the\n * same name. In plots, this will default to the string `'y'`.\n * @property {OBJ_LineStyleSimple} [line] line style of the trace - if neither `line` nor\n * `markers` is defined, then `line` will default to a solid line. If `line`\n * is not defined, but `markers` is, then only markers will be used to represent\n * the line\n * @property {OBJ_Polygon | OBJ_Star} [markers] marker style of the trace\n * @property {TypeColor} [color] color of the trace\n * @property {string} [name] name of the trace used in plot legends\n * @property {number} [xSampleDistance] If x distance between points is less\n * than this value, then the later point will not be plotted. By default this is\n * 1/4000th the range of the x axis\n * @property {number} [ySampleDistance] If y distance between points is less\n * than this value, then the later point will not be plotted. By default this is\n * 1/4000th the range of the y axis\n *\n * @see\n * For more examples on using traces, see {@link CollectionsPlot}\n *\n * To test examples below, append them to the\n * <a href=\"#drawing-boilerplate\">boilerplate</a>.\n *\n */\nexport type COL_Trace = {\n  points: Array<TypeParsablePoint>,\n  xAxis?: COL_Axis | string,\n  yAxis?: COL_Axis | string,\n  x?: Array<TypeParsablePoint>,\n  y?: Array<TypeParsablePoint>,\n  line?: OBJ_LineStyleSimple,\n  markers?: OBJ_Polygon | OBJ_Star,\n  color?: TypeColor,\n  name?: string,\n  xSampleDistance?: number,\n  ySampleDistance?: number,\n} & OBJ_Collection;\n\n/**\n * {@link FigureElementCollection} representing a trace.\n *\n * ![](./apiassets/advtrace_ex1.png)\n * ![](./apiassets/advtrace_ex2.png)\n *\n * ![](./apiassets/advtrace_ex3.png)\n * ![](./apiassets/advtrace_ex4.png)\n *\n * ![](./apiassets/advtrace_ex5.png)\n * ![](./apiassets/advtrace_ex6.png)\n *\n * This object defines a trace in an {@link CollectionsPlot}.\n *\n * The trace includes all the points of the trace, and the axes that it\n * should be drawn against and is defined using the {@link COL_PlotTrace}\n * options object.\n *\n * To test examples below, append them to the\n * <a href=\"#drawing-boilerplate\">boilerplate</a>.\n *\n * All examples below also use this power function to generate the traces:\n * ```javascript\n * const pow = (pow = 2, stop = 10, step = 0.05) => {\n *   const xValues = Fig.tools.math.range(0, stop, step);\n *   return xValues.map(x => new Fig.Point(x, x ** pow));\n * }\n * ```\n *\n * @example\n * // When plotting a single trace, just the points are required. By default\n * // the line will be solid, and it will be plotted against the 'x' and 'y' axes.\n * figure.add({\n *   name: 'plot',\n *   method: 'collections.plot',\n *   options: {\n *     trace: pow(),\n *   },\n * });\n *\n * @example\n * // Change the thickness and color of the line\n * figure.add({\n *   name: 'plot',\n *   method: 'collections.plot',\n *   options: {\n *     trace: {\n *       points: pow(),\n *       line: {\n *         width: 0.03,\n *         color: [0, 0.8, 0.4, 1],\n *       }\n *     },\n *   },\n * });\n *\n * @example\n * // Default Markers\n * figure.add({\n *   name: 'plot',\n *   method: 'collections.plot',\n *   options: {\n *     trace: {\n *       points: pow(2, 10, 1),\n *       markers: true,\n *     },\n *   },\n * });\n *\n * @example\n * // Custom Markers\n * figure.add({\n *   name: 'plot',\n *   method: 'collections.plot',\n *   options: {\n *     trace: {\n *       points: pow(2, 10, 1),\n *       markers: {\n *         radius: 0.035,\n *         sides: 20,\n *         line: { width: 0.01 },\n *       },\n *     },\n *   },\n * });\n *\n * @example\n * // Line and markers\n * figure.add({\n *   name: 'plot',\n *   method: 'collections.plot',\n *   options: {\n *     trace: {\n *       points: pow(2, 10, 1),\n *       line: { width: 0.01, dash: [0.02, 0.01] },\n *       markers: {\n *         radius: 0.035,\n *         sides: 20,\n *       },\n *     },\n *   },\n * });\n *\n * @example\n * // Use names in trace definitions to customize legend\n * figure.add({\n *   name: 'plot',\n *   method: 'collections.plot',\n *   options: {\n *     trace: [\n *       pow(2),\n *       { points: pow(2.5), name: 'Power 2.5' },\n *       {\n *         points: pow(3, 10, 1),\n *         name: 'Power 3',\n *         markers: { radius: 0.03 },\n *         line: { width: 0.01 },\n *       },\n *     ],\n *     legend: true,\n *   },\n * });\n */\n// $FlowFixMe\nclass CollectionsTrace extends FigureElementCollection {\n  // Figure elements\n  _line: ?FigureElementPrimitive;\n\n  points: Array<Point>;\n  drawPoints: Array<Point>;\n  polylines: Array<Array<Point>>;\n\n  xAxis: CollectionsAxis;\n  yAxis: CollectionsAxis;\n\n  line: OBJ_Line;\n  defaultFont: OBJ_Font_Fixed;\n  xSampleDistance: number;\n  ySampleDistance: number;\n  markers: (OBJ_Polygon | OBJ_Star) & { copy: CPY_Steps };\n\n  name: string;\n\n  /**\n   * @hideconstructor\n   */\n  constructor(\n    collections: FigureCollections,\n    optionsIn: COL_Trace,\n  ) {\n    const defaultOptions = {\n      color: collections.primitives.defaultColor,\n      font: {\n        family: 'Times New Roman',\n        size: 0.1,\n        style: 'normal',\n        weight: 'normal',\n        color: collections.primitives.defaultColor,\n        opacity: 1,\n      },\n      name: '',\n      transform: new Transform('Trace').scale(1, 1).rotate(0).translate(0, 0),\n      limits: collections.primitives.limits,\n    };\n    const options = joinObjects({}, defaultOptions, optionsIn);\n    if (options.markers == null && options.line === undefined) {\n      options.line = {};\n    }\n    super(options);\n    this.collections = collections;\n    this.defaultFont = options.font;\n    this.points = getPoints(options.points);\n    this.xAxis = options.xAxis;\n    this.yAxis = options.yAxis;\n    this.name = options.name;\n    this.setColor(options.color);\n    if (options.xSampleDistance == null) {\n      options.xSampleDistance = (this.xAxis.stopValue - this.xAxis.startValue) / 4000;\n    }\n    if (options.ySampleDistance == null) {\n      options.ySampleDistance = (this.yAxis.stopValue - this.yAxis.startValue) / 4000;\n    }\n    this.xSampleDistance = options.xSampleDistance;\n    this.ySampleDistance = options.ySampleDistance;\n\n    if (options.line != null) {\n      this.addLine(options.line);\n    }\n    if (options.markers != null) {\n      this.addMarkers(options.markers);\n    }\n  }\n\n  /**\n   * Update the trace with a new set of points.\n   * @param {Array<TypeParsablePoint>} points\n   */\n  update(points: Array<TypeParsablePoint>) {\n    this.removeLine();\n    this.removeMarkers();\n    this.points = getPoints(points);\n    if (this.line != null) {\n      this.addLine(this.line);\n    }\n    if (this.markers != null) {\n      this.markers.copy = [];\n      this.addMarkers(this.markers);\n    }\n    // if (this._line != null) {\n    //   this._line.updatePoints({ points: this.points });\n    // }\n  }\n\n  pointToDraw(p: Point) {\n    return new Point(this.xAxis.valueToDraw(p.x), this.yAxis.valueToDraw(p.y));\n  }\n\n  inAxes(p: Point) {\n    if (this.xAxis.inAxis(p.x) && this.yAxis.inAxis(p.y)) {\n      return true;\n    }\n    return false;\n  }\n\n  intersect(p1: Point, p2: Point) {\n    if (p1.x < 0 && p2.x < 0) {\n      return { result: false };\n    }\n    if (p1.y < 0 && p2.y < 0) {\n      return { result: false };\n    }\n    if (p1.x > this.xAxis.length && p2.x > this.xAxis.length) {\n      return { result: false };\n    }\n    if (p1.y > this.yAxis.length && p2.y > this.yAxis.length) {\n      return { result: false };\n    }\n    const line = new Line(p1, p2);\n    let result = false;\n    const intersect = [];\n    const bounds = [\n      new Line([0, 0], [0, this.yAxis.length]),\n      new Line([this.xAxis.length, 0], [this.xAxis.length, this.yAxis.length]),\n      new Line([0, 0], [this.xAxis.length, 0]),\n      new Line([0, this.yAxis.length], [this.xAxis.length, this.yAxis.length]),\n    ];\n    bounds.forEach((bound) => {\n      const i = line.intersectsWith(bound);\n      if (i.withinLine) {\n        result = true;\n        intersect.push(i.intersect);\n      }\n    });\n    return { result, intersect };\n  }\n\n  updatePoints() {\n    this.polylines = [];\n    this.drawPoints = this.points.map(p => this.pointToDraw(p));\n    this.drawPoints = [];\n    let sampling = false;\n    if (this.xSampleDistance != null && this.ySampleDistance != null) {\n      sampling = true;\n    }\n    let lastPoint;\n    const drawIndexes = [];\n    for (let i = 0; i < this.points.length; i += 1) {\n      if (sampling && lastPoint != null) {\n        if (\n          Math.abs(this.points[i].x - lastPoint.x) >= this.xSampleDistance\n          || Math.abs(this.points[i].y - lastPoint.y) >= this.ySampleDistance\n        ) {\n          this.drawPoints.push(this.pointToDraw(this.points[i]));\n          lastPoint = this.points[i];\n          drawIndexes.push(i);\n        }\n      } else {\n        this.drawPoints.push(this.pointToDraw(this.points[i]));\n        lastPoint = this.points[i];\n        drawIndexes.push(i);\n      }\n    }\n    const inX = [];\n    const inY = [];\n    for (let i = 0; i < drawIndexes.length; i += 1) {\n      inX.push(this.xAxis.inAxis(this.points[drawIndexes[i]].x));\n      inY.push(this.yAxis.inAxis(this.points[drawIndexes[i]].y));\n    }\n\n    let inLine = false;\n    let polyline = [];\n    for (let i = 0; i < this.drawPoints.length; i += 1) {\n      if (inX[i] && inY[i]) {\n        inLine = true;\n        polyline.push(this.drawPoints[i]);\n      }\n      // This point is the last point\n      if (inLine && i === this.drawPoints.length - 1) {\n        this.polylines.push(polyline);\n        polyline = [];\n      // Next point is within axes\n      } else if (inLine && inX[i + 1] && inY[i + 1]) {\n        // this.polylines.push(polyline);\n        // polyline\n      // Next point leaving the axes\n      } else if (inLine && (inX[i + 1] === false || inY[i + 1] === false)) {\n        const intersect = this.intersect(this.drawPoints[i], this.drawPoints[i + 1]);\n        if (intersect.result) {\n          polyline.push(...intersect.intersect);\n        }\n        this.polylines.push(polyline);\n        polyline = [];\n        inLine = false;\n      // This point is out of axes, and next point is in axes\n      } else if (inLine === false && inX[i + 1] && inY[i + 1]) {\n        const intersect = this.intersect(this.drawPoints[i], this.drawPoints[i + 1]);\n        if (intersect.result) {\n          polyline.push(...intersect.intersect);\n        }\n      // This point is out of axes, and next point is out of axes, but\n      // the line between points may cross over into the axes\n      } else if (inLine === false && i < this.drawPoints.length - 1) {\n        const intersect = this.intersect(this.drawPoints[i], this.drawPoints[i + 1]);\n        if (intersect.result) {\n          this.polylines.push(intersect.intersect.map(p => p._dup()));\n        }\n      }\n    }\n  }\n\n  addLine(options: OBJ_LineStyleSimple) {\n    const defaultOptions = {\n      color: this.color,\n      width: this.collections.primitives.defaultLineWidth,\n    };\n    this.updatePoints();\n    this.line = joinObjects({}, defaultOptions, options);\n    this.polylines.forEach((points, index) => {\n      const line = this.collections.primitives.polyline(joinObjects({}, this.line, { points }));\n      this.add(`line${index}`, line);\n    });\n  }\n\n  removeLine() {\n    const lines = this.drawOrder.filter(e => e.startsWith('line'));\n    lines.forEach((elementName) => {\n      this.remove(elementName);\n    });\n  }\n\n  removeMarkers() {\n    // const index = this.drawOrder.indexOf('markers');\n    // if (index !== -1) {\n    //   this.remove('markers');\n    // }\n    const markers = this.drawOrder.filter(e => e.startsWith('markers'));\n    markers.forEach((elementName) => {\n      this.remove(elementName);\n    });\n  }\n\n  addMarkers(options: OBJ_Polygon | OBJ_Star) {\n    const defaultOptions = {\n      radius: 0.02,\n      color: this.color,\n    };\n    const markers = this.points.filter(p => this.inAxes(p));\n    const o = joinObjects({}, defaultOptions, options);\n    this.markers = o;\n    if (markers.length === 0) {\n      return;\n    }\n    if (o.copy == null) {\n      o.copy = [];\n    } else if (Array.isArray(o.copy) === false) {\n      o.copy = [o.copy];\n    }\n    o.copy.push({\n      to: markers.map(p => this.pointToDraw(p)),\n      original: false,\n    });\n    this.add('markers', this.collections.primitives.polygon(o));\n  }\n\n  _getStateProperties(options: Object) {  // eslint-disable-line class-methods-use-this\n    return [...super._getStateProperties(options),\n      // 'angle',\n      // 'lastLabelRotationOffset',\n    ];\n  }\n\n  // _fromState(state: Object) {\n  //   joinObjects(this, state);\n  //   this.setAngle({\n  //     angle: this.angle,\n  //     rotationOffset: this.lastLabelRotationOffset,\n  //   });\n  //   return this;\n  // }\n}\n\nexport default CollectionsTrace;\n","// @flow\n/* eslint-disable no-param-reassign */\nimport {\n  Rect, Point, Transform, getPoint, getRect, getTransform,\n  getBorder, getPoints,\n  getBoundingBorder, isBuffer,\n} from '../../tools/g2';\n// import {\n//   round\n// } from '../../tools/math';\nimport type {\n  TypeParsablePoint, TypeParsableRect, TypeParsableTransform,\n  TypeParsableBorder, TypeParsableBuffer,\n} from '../../tools/g2';\nimport { setHTML } from '../../tools/htmlGenerator';\nimport {\n  FigureElementPrimitive, FigureElement,\n} from '../Element';\nimport WebGLInstance from '../webgl/webgl';\nimport DrawContext2D from '../DrawContext2D';\nimport * as tools from '../../tools/math';\nimport { generateUniqueId, joinObjects } from '../../tools/tools';\nimport DrawingObject from '../DrawingObjects/DrawingObject';\n// import VertexObject from '../DrawingObjects/VertexObject/VertexObject';\n// import {\n//   PolyLine, PolyLineCorners,\n// } from '../FigureElements/PolyLine';\n// import Fan from '../FigureElements/Fan';\n// import {\n//   Polygon, PolygonFilled, PolygonLine,\n// } from '../FigureElements/Polygon';\n// import RadialLines from '../FigureElements/RadialLines';\n// import HorizontalLine from '../FigureElements/HorizontalLine';\n// import DashedLine from '../FigureElements/DashedLine';\n// import RectangleFilled from '../FigureElements/RectangleFilled';\n// import Rectangle from '../FigureElements/Rectangle';\nimport Generic from './Generic';\n// import Box from '../FigureElements/Box';\n// import type { TypeRectangleFilledReference } from '../FigureElements/RectangleFilled';\n// import Lines from '../FigureElements/Lines';\n// import Arrow from '../FigureElements/Arrow';\n// import { AxisProperties } from '../FigureElements/Plot/AxisProperties';\n// import Axis from '../FigureElements/Plot/Axis';\nimport Text from './Text';\n// import {\n//   FigureText, FigureFont, TextObject, LinesObject,\n// } from '../DrawingObjects/TextObject/TextObject';\n\nimport {\n  TextObject, TextLineObject, TextLinesObject,\n} from '../DrawingObjects/TextObject/TextObject';\nimport HTMLObject from '../DrawingObjects/HTMLObject/HTMLObject';\nimport type { OBJ_SpaceTransforms } from '../Figure';\nimport { makePolyLine, makePolyLineCorners, makeFastPolyLine } from '../geometries/lines/lines';\nimport { getPolygonPoints, getTrisFillPolygon } from '../geometries/polygon/polygon';\nimport { rectangleBorderToTris, getRectangleBorder } from '../geometries/rectangle';\nimport { ellipseBorderToTris, getEllipseBorder } from '../geometries/ellipse';\nimport type { OBJ_Ellipse_Defined } from '../geometries/ellipse';\nimport { getTriangleBorder, getTriangleDirection } from '../geometries/triangle';\nimport type { OBJ_Triangle_Defined } from '../geometries/triangle';\nimport { getArrow, defaultArrowOptions, getArrowTris } from '../geometries/arrow';\nimport type { OBJ_LineArrows, TypeArrowHead } from '../geometries/arrow';\nimport getLine from '../geometries/line';\n// import type {\n//   OBJ_Copy,\n// } from './FigurePrimitiveTypes';\nimport { copyPoints } from '../geometries/copy/copy';\nimport type { CPY_Step } from '../geometries/copy/copy';\nimport type {\n  TypeColor, TypeDash, OBJ_CurvedCorner, OBJ_Font,\n} from '../../tools/types';\nimport { getBufferBorder } from '../geometries/buffer';\n\n/**\n * Line style definition object.\n * @property {'mid' | 'outside' | 'inside' | 'positive' | 'negative' | number} [widthIs]\n * defines how the width is grown from the polyline's points. When using\n * `number`, 0 is the equivalent of 'inside' and 1 is the equivalent of\n * 'outside'.\n * @property {number} [width] line width\n * @property {TypeDash} [dash] select solid or dashed line\n * @property {TypeColor} [color] line color\n */\nexport type OBJ_LineStyleSimple = {\n  widthIs?: 'mid' | 'outside' | 'inside' | 'positive' | 'negative' | number,\n  width?: number,\n  dash?: TypeDash,\n  color?: TypeColor,\n};\n\nexport type OBJ_LineStyleSimple_Defined = {\n  widthIs: 'mid' | 'outside' | 'inside' | 'positive' | 'negative' | number,\n  width: number,\n  dash?: TypeDash,\n  color?: TypeColor,\n}\n\n/**\n * {@link FigureElementCollection} options object.\n *\n * <p class=\"inline_gif\"><img src=\"./apiassets/collection.gif\" class=\"inline_gif_image\"></p>\n *\n * A collection is a group of other {@link FigureElement}s that will all\n * inherit the parent collections transform.\n *\n * @property {TypeParsableTransform} [transform]\n * @property {TypeParsablePoint} [position] if defined, will overwrite first\n * translation of `transform`\n * @property {TypeColor} [color] default color\n * @property {FigureElement | null} [parent] parent of collection\n * @property {TypeParsableBorder | 'children' | 'rect' | number} [border]\n * defines border of collection. Use `'children'` for the borders of the\n * children. Use 'rect' for bounding rectangle of children. Use `number`\n * for the bounding rectangle with some buffer. Use\n * `Array<Array<TypeParsablePoint>` for a custom border. (`'children'`)\n * @property {TypeParsableBorder | 'border' | number | 'rect'} [touchBorder]\n * defines the touch border of the collection. Use `'border'` to use the same\n * as the border of the collection. Use `'rect'` for the bounding rectangle\n * of the border. Use `number` for the bounding rectangle of the border plus\n * some buffer. Use `Array<Array<TypeParsablePoint>` for a custom touch\n * border (`'border'`).\n * @property {TypeParsableBorder | 'children'} [holeBorder] Hole\n * border of the collection. Use `'children'` to use the children element hole\n * borders, otherwise use `Array<Array<TypeParsablePoint>` for a customizable\n * border.\n *\n * @example\n * figure.add(\n *   {\n *     name: 'c',\n *     method: 'collection',\n *     elements: [         // add two elements to the collection\n *       {\n *         name: 'hex',\n *         method: 'polygon',\n *         options: {\n *           sides: 6,\n *           radius: 0.5,\n *         },\n *       },\n *       {\n *         name: 'text',\n *         method: 'text',\n *         options: {\n *           text: 'hexagon',\n *           position: [0, -0.8],\n *           xAlign: 'center',\n *           font: { size: 0.3 },\n *         },\n *       },\n *     ],\n *   },\n * );\n *\n * // When a collection rotates, then so does all its elements\n * figure.getElement('c').animations.new()\n *   .rotation({ target: Math.PI * 1.999, direction: 1, duration: 5 })\n *   .start();\n *\n * @example\n * // Collections and primitives can also be created from `figure.collections`\n * // and `figure.primitives`.\n * const c = figure.collections.collection();\n * const hex = figure.primitives.polygon({\n *   sides: 6,\n *   radius: 0.5,\n * });\n * const text = figure.primitives.text({\n *   text: 'hexagon',\n *   position: [0, -0.8],\n *   xAlign: 'center',\n *   font: { size: 0.3 },\n * });\n * c.add('hex', hex);\n * c.add('text', text);\n * figure.add('c', c);\n *\n * // When a collection rotates, then so does all its elements\n * c.animations.new()\n *   .delay(1)\n *   .rotation({ target: Math.PI * 1.999, direction: 1, duration: 5 })\n *   .start();\n */\nexport type OBJ_Collection = {\n  transform?: TypeParsableTransform,\n  position?: TypeParsablePoint,\n  color?: TypeColor,\n  parent?: FigureElement | null,\n  border?: TypeParsableBorder | 'children' | 'rect' | number,\n  touchBorder?: TypeParsableBorder | 'border' | number | 'rect',\n  holeBorder?: TypeParsableBorder | 'children',\n};\n\n/**\n * Texture definition object\n *\n * A texture file is an image file like a jpg, or png.\n *\n * Textures can be used instead of colors to fill a shape in WebGL.\n *\n * Textures are effectively overlaid on a shape. Therefore, to overlay the\n * texture with the correct offset, magnification and aspect ratio of the\n * texture must be mapped to the space the shape's vertices are defined in\n * (draw space).\n *\n * This is done by defining a window, or rectangle, for the texture file\n * (`mapFrom`) and a similar window in draw space (`mapTo`).\n * The texture is then offset and scaled such that its window aligns with the\n * draw space window.\n *\n * The texture file has coordinates of (0, 0) in the bottom left corner and\n * (1, 1) in the top right corner.\n *\n * Therefore, to make a 1000 x 500 image fill a 2 x 1 rectangle in draw space\n * centered at (0, 0) you would define:\n *\n * ```\n * mapFrom: new Rect(0, 0, 1, 1)\n * mapTo: new Rect(-1, -0.5, 2, 1)\n * ```\n *\n * If instead you wanted to zoom the image in the same rectange by a factor of 2\n * you could either:\n *\n * ```\n * mapFrom: new Rect(0.25, 0.25, 0.5, 0.5)\n * mapTo: new Rect(-1, -0.5, 2, 1)\n * ```\n *\n * or\n *\n * ```\n * mapFrom: new Rect(0, 0, 1, 1)\n * mapTo: new Rect(-2, -1, 4, 2)\n * ```\n *\n * Two ways of doing this are provided as sometimes it is more convenient to\n * think about the window on the image, and other times the window in draw\n * space.\n *\n * If the shape has fill outside the texture boundaries then either the\n * texture can be repeated, or a pixel from the border (edge) of the image is\n * used (called clamping to edge).\n * WebGL only allows images that are square with a side length that is a\n * power of 2 (such as 16, 32, 64, 128 etc) to be repeated. All other images\n * can only be clamped to their edge.\n *\n * To repeat all other image resolutions, a texture can be mapped to a rectangle\n * and then the rectangle repeated throughout the figure.\n *\n * @property {string} src The url or location of the image\n * @property {TypeParsableRect} [mapTo] draw space window (`new TypeParsableRect(-1, -1, 2, 2)`)\n * @property {TypeParsableRect} [mapFrom] image space window (`new Rect(0, 0, 1, 1)`)\n * @property {boolean} [repeat] `true` will tile the image. Only works with\n * images that are square whose number of side pixels is a power of 2 (`false`)\n * @property {() => void} [onLoad] textures are loaded asynchronously, so this\n * callback can be used to execute code after the texture is loaded. At a\n * minimum, any custom function here should include a call to animate the next\n * frame (`figure.animateNextFrame`)\n */\nexport type OBJ_Texture = {\n  src?: string,\n  mapTo?: Rect,\n  mapFrom?: Rect,\n  repeat?: boolean,\n  onLoad?: () => void,\n}\n\n/**\n * Pulse options object\n *\n * @property {number} [scale] scale to pulse\n * @property {number} [duration] duration to pulse\n * @property {number} [frequency] frequency to pulse where 0\n */\nexport type OBJ_PulseScale = {\n  duration?: number,\n  scale?: number,\n  frequency?: number,\n};\n\n/* eslint-disable max-len */\n/**\n * ![](./apiassets/generic.png)\n *\n * Options object for a {@link FigureElementPrimitive} of a generic shape\n *\n * `points` will define either triangles or lines which combine\n * to make the shape.\n *\n * `drawType` defines what sort of triangles or lines the `points` make\n * and is analagous to WebGL [drawing primitives](https://webglfundamentals.org/webgl/lessons/webgl-points-lines-triangles.html)\n * where the mapping between the two are:\n * - `'triangles'`: TRIANGLES\n * - `'strip'`: TRIANGLE_STRIP\n * - `'fan'`: TRIANGLE_FAN\n * - `'lines'`: LINES\n *\n * The most useful, common and generic `drawType` is `'triangles'`\n * which can be used to create any shape.\n *\n * The shape's points can be duplicated using the `copy` property\n * to conveniently create multiple copies (like grids) of shapes.\n *\n * The shape is colored with either `color` or `texture`.\n *\n * When shapes move, or are touched, borders are needed to bound their\n * movement, and figure out if a touch happened within the shape. Shapes\n * that do not move, or are not interactive, do not need borders.\n *\n * A shape can have several kinds of borders. \"Draw borders\" (`drawBorder` and\n * `drawBorderBuffer`) are sets of points that define reference\n * borders for a shape. The shapes higher level borders `border` and\n * `touchBorder` may then use these draw borders to define how a shape will\n * interact with a figure's bounds, or where a shape can be touched.\n *\n * `drawBorder` and `drawBorderBuffer` are each point arrays\n * that define the outer limits of the shape. For non-contigous shapes\n * (like islands of shapes), an array of point arrays can be used.\n * Both borders can be anything, but typically a `drawBorder` would define the\n * border of the visible shape, and a `drawBorderBuffer` would define some\n * extra space, or buffer, around the visible shape (particulaly useful for\n * defining the `touchBorder` later).\n *\n * `border` is used for checking if the shape is within some bounds. When\n * shapes are moved, if their bounds are limited, this border will define when\n * the shape is at a limit. The `border` property can be:\n * - `draw`: use `drawBorder` points\n * - `buffer`: use `drawBorderBuffer` points\n * - `rect`: use a rectangle bounding `drawBorder`\n * - `number`: use a rectangle that is `number` larger than the rectangle\n *    bounding `drawBorder`\n * - `Array<TypeParsablePoint>`: a custom contiguous border\n * - `Array<Array<TypeParsablePoint>>`: a custom border of several contiguous\n *    portions\n *\n * `touchBorder` is used for checking if a shape is touched. The `touchBorder`\n * property can be:\n * - `draw`: use `drawBorder` points\n * - `buffer`: use `drawBorderBuffer` points\n * - `border`: use same as `border`\n * - `rect`: use a rectangle bounding `border`\n * - `number`: use a rectangle that is `number` larger than the rectangle\n *    bounding `border`\n * - `Array<TypeParsablePoint>`: a custom contiguous border\n * - `Array<Array<TypeParsablePoint>>`: a custom border of several contiguous\n *    portions\n *\n * A `holeBorder` can be used to override the `touchBorder` with areas where\n * touch is disabled.\n *\n * @property {Array<TypeParsablePoint>} points\n * @property {'triangles' | 'strip' | 'fan' | 'lines'} [drawType]\n * (`'triangles'`)\n * @property {Array<CPY_Step | string> | CPY_Step} [copy] use `drawType` as\n * `'triangles'` when using copy (`[]`)\n * @property {TypeColor} [color] (`[1, 0, 0, 1])\n * @property {OBJ_Texture} [texture] override `color` with a texture if defined\n * @property {TypeParsableBorder} [drawBorder],\n * @property {TypeParsableBorder} [drawBorderBuffer],\n * @property {TypeParsableBorder | 'buffer' | 'draw' | 'rect' | number} [border]\n * border used for\n * keeping shape within limits\n * @property {TypeParsableBorder | 'rect' | 'border' | 'buffer' | number | 'draw'} [touchBorder]\n * border used for determining shape was touched\n * @property {TypeParsableBorder} [holeBorder] areas where\n * touching is disabled\n * @property {TypeParsablePoint} [position] will overwrite first translation\n * transform of `transform` chain\n * @property {Transform} [transform]\n * @property {OBJ_PulseScale | number} [pulse] set default scale pulse options\n * (`OBJ_PulseScale`) or pulse scale directly (`number`)\n *\n * @see To test examples, append them to the\n * <a href=\"#drawing-boilerplate\">boilerplate</a>\n *\n * @example\n * // Square and triangle\n * figure.add({\n *   name: 'squareAndTri',\n *   method: 'generic',\n *   options: {\n *     points: [\n *       [-1, 0.5], [-1, -0.5], [0, 0.5],\n *       [0, 0.5], [-1, -0.5], [0, -0.5],\n *       [0, -0.5], [1, 0.5], [1, -0.5],\n *     ],\n *   },\n * });\n * @example\n * // rhombus with larger touch borders\n * figure.add({\n *   name: 'rhombus',\n *   method: 'generic',\n *   options: {\n *     points: [\n *       [-0.5, -0.5], [0, 0.5], [1, 0.5],\n *       [-0.5, -0.5], [1, 0.5], [0.5, -0.5],\n *     ],\n *     border: [[\n *       [-1, -1], [-0.5, 1], [1.5, 1], [1, -1],\n *     ]],\n *   },\n *   mods: {\n *     isMovable: true,\n *     move: {\n *       bounds: 'figure',\n *     },\n *   },\n * });\n *\n * @example\n * // Grid of triangles\n * figure.add({\n *   name: 'gridOfTris',\n *   method: 'generic',\n *   options: {\n *     points: [\n *       [-1, -1], [-0.7, -1], [-1, -0.7],\n *     ],\n *     copy: [\n *       { along: 'x', num: 5, step: 0.4 },\n *       { along: 'y', num: 5, step: 0.4 },\n *     ],\n *   },\n * });\n */\n/* eslint-enable max-len */\nexport type OBJ_Generic = {\n  points?: Array<TypeParsablePoint> | Array<Point>,\n  drawType?: 'triangles' | 'strip' | 'fan' | 'lines',\n  copy?: Array<CPY_Step | string> | CPY_Step,\n  color?: TypeColor,\n  texture?: OBJ_Texture,\n  drawBorder?: TypeParsableBorder,\n  drawBorderBuffer?: TypeParsableBorder,\n  border?: TypeParsableBorder | 'buffer' | 'draw' | 'rect' | number,\n  touchBorder?: TypeParsableBorder | 'rect' | 'border' | 'buffer' | number | 'draw',\n  holeBorder?: TypeParsableBorder,\n  position?: TypeParsablePoint,\n  transform?: TypeParsableTransform,\n  pulse?: number,\n}\n\n/**\n * Polyline shape options object that extends {@link OBJ_Generic} (without\n * `drawType`)\n *\n * ![](./apiassets/polyline.png)\n *\n * A polyline is a series of lines that are connected end to end. It is defined\n * by a series of points which are the ends and corners of the polyline.\n *\n * The series of points is a zero width ideal polyline, and so to see it we must\n * give it some `width`. This width can either be grown on one side of the\n * ideal polyline or grown on both sides of it equally using `widthIs`.\n *\n * A polyline can have a \"positive\" or \"negative\" side, and an \"inside\" or \"outside\".\n *\n * If a line is defined from p1 to p2, then the *positive* side is the\n * side where the line moves if it is rotated around p1 in the positive (counter\n * clockwise) direction. Thus the order of the points that define the line\n * defines which side is positive and negative. A polyline is made up of many\n * lines end to end, and thus itself will have a positive and negative side\n * dependent on the order of points.\n *\n * Similarly we can define a line's side as either *inside* or *outside*. Each\n * corner in the polyline will have an angle on the negative side of the line\n * and a explementary angle on the positive side of the line. The *inside* side\n * of the line is the same as the *negative* side if the sum of all the negative\n * side angles is smaller than the sum of all *positive* side angles.\n *\n * Both positive/negative and inside/outside are provided to define a line's\n * side as different situations make different side definitions more intuitive.\n * For instance, a closed, simple polygon has an obvious \"inside\" and \"outside\",\n * but how the points are ordered would define if the \"inside\" is \"positive\" or\n * \"negative\". In comparison, it would be more intuitive to use \"positive\" or\n * \"negative\" for a polyline that has an overall trend in a single direction.\n *\n * Therefore, the polyline width can be grown on either the `'positive'`,\n * `'negative'`, `'inside'`, or `'outside'` side of the line or around the\n * middle of the line with `'mid'`. In addition, a `number` between 0 and 1 can\n * be used where `0` is the same as `'positive'`, `1` the same as `'negative'`\n * and `0.5` the same as `'mid'`.\n *\n * Each point, or line connection, creates a corner that will have an *inside*\n * angle (<180) and an *outside* angle (>180 or reflex angle).\n *\n * Growing width on an outside corner can be challenging. As the corner becomes\n * sharper, the outside width joins at a point further and further from the\n * ideal corner. Eventually trucating the corner makes more visual sense\n * and therefore, a minimum angle (`minAutoCornerAngle`) is used to\n * specify when the corner should be drawn, and when it should be truncated.\n *\n * By default, the border of the polyline is the line itself (`border` =\n * `'line'`). The border can also just be the points on the positive side of\n * the line, or the negative side of the line. This is useful for caturing\n * the hole shape of a closed polyline within a border. The border can also\n * be the encompassing rectangle of the polyline (`border` = `'rect'`) or\n * defined as a custom set of points.\n *\n * The touch border can either be the same as the border (`'border'`), the\n * encompassing rect (`'rect'`), a custom set of points, or the same as the\n * line but with some buffer that effectively increases the width on both sides\n * of the line.\n *\n * @property {Array<TypeParsablePoint>} points\n * @property {number} [width] (`0.01`)\n * @property {boolean} [close] close the polyline on itself (`false`)\n * @property {boolean} [simple] simple and minimum computation polyline. Good\n * for large numbers of points that need to be updated every animation frame.\n * `widthIs`, `dash`, `arrow` and all corner and line primitive properties are\n * not available when a polyline is simple. (`false`)\n * @property {'mid' | 'outside' | 'inside' | 'positive' | 'negative' | number} [widthIs]\n * defines how the width is grown from the polyline's points.\n * Only `\"mid\"` is fully compatible with all options in\n * `cornerStyle` and `dash`. (`\"mid\"`)\n * @property {'line' | 'positive' | 'negative' | TypeParsableBorder} [drawBorder]\n * override OBJ_Generic `drawBorder` with `'line'` to make the drawBorder just\n * the line itself, `'positive'` to make the drawBorder the positive side\n * of the line, and `'negative'` to make the drawBorder the negative side\n * of the line. Use array definition for custom drawBorder (`'line'`)\n * @property {number | TypeParsableBorder} [drawBorderBuffer]\n * override OBJ_Generic `drawBorderBuffer` with `number` to make the\n * drawBorderBuffer the same as the line with additional `number` thickness\n * on either side (`0`)\n * @property {'auto' | 'none' | 'radius' | 'fill'} [cornerStyle] - `\"auto\"`:\n * sharp corners sharp when angle is less than `minAutoCornerAngle`, `\"none\"`: no\n * corners, `\"radius\"`: curved corners, `\"fill\"`: fills the gapes between the line\n * ends, (`\"auto\"`)\n * @property {number} [cornerSize] only used when `cornerStyle` = `radius` (`0.01`)\n * @property {number} [cornerSides] number of sides in curve - only used when\n *  `cornerStyle` = `radius` (`10`)\n * @property {boolean} [cornersOnly] draw only the corners with size `cornerSize` (`false`)\n * @property {number} [cornerLength] use only with `cornersOnly` = `true` -\n * length of corner to draw (`0.1`)\n * @property {number} [minAutoCornerAngle] see `cornerStyle` = `auto` (`/7`)\n * @property {TypeDash} [dash] leave empty for solid line - use array of\n * numbers for dash line where first number is length of line, second number is\n * length of gap and then the pattern repeats - can use more than one dash length\n * and gap  - e.g. [0.1, 0.01, 0.02, 0.01] produces a lines with a long dash,\n * short gap, short dash, short gap and then repeats.\n * @property {OBJ_LineArrows | TypeArrowHead} [arrow] either an object defining custom\n * arrows or a string representing the name of an arrow head style can be used.\n * If a string is used, then the line will have an arrow at both ends.\n * Arrows are only available for `close: false`,\n * `widthIs: 'mid'` and `linePrimitives: false`\n * @property {boolean} [linePrimitives] Use WebGL line primitives instead of\n * triangle primitives to draw the line (`false`)\n * @property {number} [lineNum] Number of line primitives to use when\n * `linePrimitivs`: `true` (`2`)\n *\n * @extends OBJ_Generic\n *\n * @see To test examples, append them to the\n * <a href=\"#drawing-boilerplate\">boilerplate</a>\n *\n * @example\n * // Line\n * figure.add(\n *   {\n *     name: 'p',\n *     method: 'polyline',\n *     options: {\n *       points: [[-0.5, -0.5], [-0.1, 0.5], [0.3, -0.2], [0.5, 0.5]],\n *       width: 0.05,\n *     },\n *   },\n * );\n *\n * @example\n * // Square with rounded corners and dot-dash line\n * figure.add(\n *   {\n *     name: 'p',\n *     method: 'polyline',\n *     options: {\n *       points: [[-0.5, -0.5], [0.5, -0.5], [0.5, 0.5], [-0.5, 0.5]],\n *       width: 0.05,\n *       dash: [0.17, 0.05, 0.05, 0.05],\n *       close: true,\n *       cornerStyle: 'radius',\n *       cornerSize: 0.1,\n *     },\n *   },\n * );\n * @example\n * // Corners only of a triangle\n * figure.add(\n *  {\n *    name: 'p',\n *    method: 'polyline',\n *    options: {\n *      points: [[-0.5, -0.5], [0.5, -0.5], [0, 0.5]],\n *      width: 0.05,\n *      close: true,\n *      cornersOnly: true,\n *      cornerLength: 0.2,\n *    },\n *  },\n *);\n * @example\n * // Zig zag with arrows\n * figure.add({\n *   name: 'arrowedLine',\n *   method: 'polyline',\n *   options: {\n *     points: [[0, 0], [1, 0], [0, 0.7], [1, 0.7]],\n *     width: 0.05,\n *     cornerStyle: 'fill',\n *     arrow: {\n *       scale: 0.7,\n *       start: {\n *         head: 'triangle',\n *         reverse: true,\n *       },\n *       end: 'barb',\n *     },\n *   },\n * });\n */\nexport type OBJ_Polyline = {\n  points?: Array<TypeParsablePoint> | Array<Point>,\n  width?: number,\n  close?: boolean,\n  simple?: boolean,\n  widthIs?: 'mid' | 'outside' | 'inside' | 'positive' | 'negative' | number,\n  drawBorder?: 'line' | 'positive' | 'negative' | TypeParsableBorder,\n  drawBorderBuffer?: number | TypeParsableBorder,\n  cornerStyle?: 'auto' | 'none' | 'radius' | 'fill',\n  cornerSize?: number,\n  cornerSides?: number,\n  cornersOnly?: boolean,\n  cornerLength?: number,\n  forceCornerLength?: boolean,\n  minAutoCornerAngle?: number,\n  dash?: TypeDash,\n  arrow?: OBJ_LineArrows | TypeArrowHead,\n  linePrimitives?: boolean,\n  lineNum?: number,\n} & OBJ_Generic;\n\n/**\n * Line style object\n *\n * These properties are a subset of {@link OBJ_Polyline} which has more details\n * on how a line is defined.\n *\n * @property {'mid' | 'outside' | 'inside' | 'positive' | 'negative'} [widthIs]\n * defines how the width is grown from the polyline's points.\n * Only `\"mid\"` is fully compatible with all options in\n * `cornerStyle` and `dash`. (`\"mid\"`)\n * @property {'auto' | 'none' | 'radius' | 'fill'} [cornerStyle] - `\"auto\"`:\n * sharp corners sharp when angle is less than `minAutoCornerAngle`, `\"none\"`: no\n * corners, `\"radius\"`: curved corners, `\"fill\"`: fills the gapes between the line\n * ends, (`\"auto\"`)\n * @property {number} [cornerSize] only used when `cornerStyle` = `radius` (`0.01`)\n * @property {number} [cornerSides] number of sides in curve - only used when\n *  `cornerStyle` = `radius` (`10`)\n * @property {boolean} [cornersOnly] draw only the corners with size `cornerSize` (`false`)\n * @property {number} [cornerLength] use only with `cornersOnly` = `true` -\n * length of corner to draw (`0.1`)\n * @property {number} [minAutoCornerAngle] see `cornerStyle` = `auto` (`/7`)\n * @property {Array<number>} [dash] leave empty for solid line - use array of\n * numbers for dash line where first number is length of line, second number is\n * length of gap and then the pattern repeats - can use more than one dash length\n * and gap  - e.g. [0.1, 0.01, 0.02, 0.01] produces a lines with a long dash,\n * short gap, short dash, short gap and then repeats.\n * @property {boolean} [linePrimitives] Use WebGL line primitives instead of\n * triangle primitives to draw the line (`false`)\n * @property {boolean} [lineNum] Number of line primitives to use when\n * `linePrimitivs`: `true` (`2`)\n */\nexport type OBJ_LineStyle = {\n  widthIs?: 'mid' | 'outside' | 'inside' | 'positive' | 'negative',\n  cornerStyle?: 'auto' | 'none' | 'radius' | 'fill',\n  cornerSize?: number,\n  cornerSides?: number,\n  cornersOnly?: boolean,\n  cornerLength?: number,\n  forceCornerLength?: boolean,\n  minAutoCornerAngle?: number,\n  dash?: Array<number>,\n  linePrimitives?: boolean,\n  lineNum?: number,\n};\n\n/**\n * Polygon or partial polygon shape options object that extends\n * {@link OBJ_Generic} (without `drawType`)\n *\n * ![](./apiassets/polygon.png)\n *\n * @property {number} [sides] (`4`)\n * @property {number} [radius] (`1`)\n * @property {number} [rotation] shape rotation during vertex definition\n * (different to a rotation step in a trasform) (`0`)\n * @property {TypeParsablePoint} [offset] shape center offset from origin\n * during vertex definition (different to a translation step in a transform)\n * (`[0, 0]`)\n * @property {number} [sidesToDraw] number of sides to draw (all sides)\n * @property {number} [angleToDraw] same as `sidesToDraw` but using angle for\n * the definition (`2`)\n * @property {-1 | 1} [direction] direction to draw polygon where 1 is\n * counter clockwise and -1 is clockwise (`1`)\n * center. This is different to position or transform as these translate the\n * vertices on each draw. (`[0, 0]`)\n * @property {OBJ_LineStyleSimple} [line] line style options\n * @property {number | TypeParsableBorder} [drawBorderBuffer]\n * override the OBJ_Generic `drawBorderBuffer` with `number` to make the\n * drawBorderBuffer a polygon that is wider by `number` (`0`)\n *\n * @extends OBJ_Generic\n *\n * @see To test examples, append them to the\n * <a href=\"#drawing-boilerplate\">boilerplate</a>\n *\n * @example\n * // Simple filled hexagon\n * figure.add({\n *   name: 'hexagon',\n *   method: 'polygon',\n *   options: {\n *     sides: 6,\n *     radius: 0.5,\n *   },\n * });\n *\n * @example\n * // Circle from dashed line\n * const circ = figure.primitives.polygon({\n *   sides: 100,\n *   radius: 0.5,\n *   line: {\n *     width: 0.03,\n *     dash: [0.1, 0.03 ],\n *   },\n * });\n * figure.elements.add('circle', circ);\n *\n * @example\n * // Half octagon rotated\n * figure.add({\n *   name: 'halfOctagon',\n *   method: 'polygon',\n *   options: {\n *     sides: 8,\n *     radius: 0.5,\n *     angleToDraw: Math.PI,\n *     line: {\n *       width: 0.03,\n *     },\n *     direction: -1,\n *     rotation: Math.PI / 2,\n *   },\n * });\n */\nexport type OBJ_Polygon = {\n  sides?: number,\n  radius?: number,\n  rotation?: number,\n  offset?: TypeParsablePoint,\n  sidesToDraw?: number,\n  angleToDraw?: number,\n  direction?: -1 | 1,\n  line?: OBJ_LineStyleSimple,\n  drawBorderBuffer?: number | TypeParsableBorder,\n} & OBJ_Generic;\n\ntype OBJ_Polygon_Defined = {\n  sides: number,\n  radius: number,\n  rotation: number,\n  offset: Point,\n  sidesToDraw: number,\n  angleToDraw: number,\n  direction: -1 | 1,\n  line?: OBJ_LineStyleSimple,\n  innerRadius?: number,\n  drawBorderBuffer: number | TypeParsableBorder,\n} & OBJ_Generic;\n\n/**\n * Star options object that extends {@link OBJ_Generic} (without\n * `drawType`)\n *\n * ![](./apiassets/star.png)\n *\n * @property {number} [sides] (`4`)\n * @property {number} [radius] (`1`)\n * @property {number} [innerRadius] (`radius / 2`)\n * @property {number} [rotation] shape rotation during vertex definition\n * (different to a rotation step in a trasform) (`0`)\n * @property {TypeParsablePoint} [offset] shape center offset from origin\n * during vertex definition (different to a translation step in a transform)\n * (`[0, 0]`)\n * @property {OBJ_LineStyleSimple} [line] line style options\n * @property {number | TypeParsableBorder} [drawBorderBuffer]\n * override the OBJ_Generic `drawBorderBuffer` with `number` to make the\n * drawBorderBuffer a polygon that is `number` thicker than the radius (`0`)\n *\n * @extends OBJ_Generic\n *\n * @see To test examples, append them to the\n * <a href=\"#drawing-boilerplate\">boilerplate</a>\n *\n * @example\n * // Simple 5 pointed star\n * figure.add({\n *   name: 's',\n *   method: 'star',\n *   options: {\n *     radius: 0.5,\n *     sides: 5,\n *   },\n * });\n *\n * @example\n * // 7 pointed dashed line star\n * figure.add({\n *   name: 's',\n *   method: 'star',\n *   options: {\n *     radius: 0.5,\n *     innerRadius: 0.3,\n *     sides: 7,\n *     line: {\n *       width: 0.02,\n *       dash: [0.05, 0.01],\n *     },\n *   },\n * });\n *\n * @example\n * // Star surrounded by stars\n * figure.add({\n *   name: 's',\n *   method: 'star',\n *   options: {\n *     radius: 0.1,\n *     sides: 5,\n *     rotation: -Math.PI / 2,\n *     // line: { width: 0.01 },\n *     copy: [\n *       {\n *         to: [0.6, 0],\n *         original: false,\n *       },\n *       {\n *         along: 'rotation',\n *         num: 16,\n *         step: Math.PI * 2 / 16,\n *         start: 1,\n *       },\n *       {\n *         to: new Fig.Transform().scale(3, 3).rotate(Math.PI / 2),\n *         start: 0,\n *         end: 1,\n *       },\n *     ],\n *   },\n * });\n */\nexport type OBJ_Star = {\n  sides?: number,\n  radius?: number,\n  innerRadius?: number,\n  rotation?: number,\n  offset?: TypeParsablePoint,\n  line?: OBJ_LineStyleSimple,\n  drawBorderBuffer?: TypeParsableBorder | number,\n} & OBJ_Generic;\n\nexport type OBJ_Star_Defined = {\n  sides: number,\n  radius: number,\n  innerRadius: number,\n  rotation: number,\n  offset: Point,\n  line?: OBJ_LineStyleSimple,\n  drawBorderBuffer: TypeParsableBorder | number,\n} & OBJ_Generic;\n\n/**\n * Rectangle shape options object that extends {@link OBJ_Generic} (without\n * `drawType)\n *\n * ![](./apiassets/rectangle.png)\n *\n * @property {number} [width] (`1`)\n * @property {number} [height] (`1`)\n * @property {'bottom' | 'middle' | 'top' | number} [yAlign] (`'middle'`)\n * @property {'left' | 'center' | 'right' | number} [xAlign] (`'center'`)\n * @property {OBJ_CurvedCorner} [corner] define for rounded corners\n * @property {OBJ_LineStyleSimple} [line] line style options\n * @property {number | TypeParsableBorder} [drawBorderBuffer]\n * override the OBJ_Generic `drawBorderBuffer` with `number` to make the\n * drawBorderBuffer a rectangle that is `number` wider and higher on each side\n * (`0`)\n * @property {TypeParsablePoint} [offset]\n *\n * @extends OBJ_Generic\n *\n * @see To test examples, append them to the\n * <a href=\"#drawing-boilerplate\">boilerplate</a>\n *\n * @example\n * // Filled rectangle\n * figure.add({\n *   name: 'r',\n *   method: 'rectangle',\n *   options: {\n *     width: 1,\n *     height: 0.5,\n *   },\n * });\n *\n * @example\n * // Corners with radius and dashed line\n * figure.add({\n *   name: 'r',\n *   method: 'rectangle',\n *   options: {\n *     width: 0.5,\n *     height: 0.5,\n *     line: {\n *       width: 0.02,\n *       dash: [0.05, 0.03]\n *     },\n *     corner: {\n *       radius: 0.1,\n *       sides: 10,\n *     },\n *   },\n * });\n *\n * @example\n * // Rectangle copies rotated\n * figure.add({\n *   name: 'r',\n *   method: 'rectangle',\n *   options: {\n *     width: 0.5,\n *     height: 0.5,\n *     line: {\n *       width: 0.01,\n *     },\n *     copy: {\n *       along: 'rotation',\n *       num: 3,\n *       step: Math.PI / 2 / 3\n *     },\n *   },\n * });\n */\nexport type OBJ_Rectangle = {\n  width?: number,\n  height?: number,\n  xAlign?: 'left' | 'center' | 'right' | number,\n  yAlign?: 'bottom' | 'middle' | 'top' | number,\n  corner?: OBJ_CurvedCorner,\n  line?: OBJ_LineStyleSimple,\n  drawBorderBuffer?: TypeParsableBorder | number,\n  offset: TypeParsablePoint,\n} & OBJ_Generic;\n\ntype OBJ_Rectangle_Defined = {\n  width: number,\n  height: number,\n  xAlign: 'left' | 'center' | 'right' | number,\n  yAlign: 'bottom' | 'middle' | 'top' | number,\n  corner: {\n    radius: number,\n    sides: number,\n  },\n  line?: {\n    widthIs: 'inside' | 'outside' | 'positive' | 'negative' | 'mid' | number,\n    width: number,\n  },\n  // border: 'rect' | 'outline' | Array<Array<Point>>,\n  drawBorderBuffer: number | Array<Array<Point>>,\n  offset: Point,\n} & OBJ_Generic;\n\n\n/**\n * Ellipse shape options object that extends {@link OBJ_Generic} (without\n * `drawType`)\n *\n * ![](./apiassets/ellipse.png)\n *\n * @property {number} [width] (`1`)\n * @property {number} [height] (`1`)\n * @property {'bottom' | 'middle' | 'top' | number} [yAlign] (`'middle'`)\n * @property {'left' | 'center' | 'right' | number} [xAlign] (`'center'`)\n * @property {number} [sides] number of sides to draw ellipse with (`20`)\n * @property {OBJ_LineStyleSimple} [line] line style options\n * @property {number | TypeParsableBorder} [drawBorderBuffer]\n * override the OBJ_Generic `drawBorderBuffer` with `number` to make the\n * drawBorderBuffer a ellipse that is `number` thicker around its border (`0`)\n *\n * @extends OBJ_Generic\n *\n * @see To test examples, append them to the\n * <a href=\"#drawing-boilerplate\">boilerplate</a>\n *\n * @example\n * // Filled ellipse\n * figure.add({\n *   name: 'e',\n *   method: 'ellipse',\n *   options: {\n *     height: 1,\n *     width: 0.5,\n *     sides: 100,\n *   },\n * });\n *\n * @example\n * // Dashed line circle\n * figure.add({\n *   name: 'e',\n *   method: 'ellipse',\n *   options: {\n *     height: 1,\n *     width: 1,\n *     sides: 100,\n *     line: {\n *       width: 0.02,\n *       dash: [0.05, 0.02],\n *     },\n *   },\n * });\n *\n * @example\n * // Ellipse grid\n * figure.add({\n *   name: 'e',\n *   method: 'ellipse',\n *   options: {\n *     height: 0.08,\n *     width: 0.2,\n *     sides: 20,\n *     copy: [\n *       { along: 'x', step: 0.25, num: 5 },\n *       { along: 'y', step: 0.15, num: 5 },\n *     ]\n *   },\n * });\n */\nexport type OBJ_Ellipse = {\n  width?: number,\n  height?: number,\n  xAlign?: 'left' | 'center' | 'right' | number,\n  yAlign?: 'bottom' | 'middle' | 'top' | number,\n  sides?: number,\n  line?: OBJ_LineStyleSimple,\n  drawBorderBuffer?: TypeParsableBorder | number,\n} & OBJ_Generic;\n\n/**\n * @property {'s1' | 's2' | 's3'} [side] ('s1')\n * @property {number} [angle] (0)\n */\nexport type OBJ_TriangleSideRotationAlignment = {\n  side?: 's1' | 's2' | 's3',\n  angle?: number,\n};\n\n/* eslint-disable max-len */\n/**\n * Triangle shape options object that extends {@link OBJ_Generic} (without\n * `drawType`)\n *\n * ![](./apiassets/triangle.png)\n *\n * The most generic way to define a triangle is with three points (`points`\n * property). When using `points`, all the other properties that can also\n * define a triangle are ignored: `width`, `height`, `top`,\n * `SSS`, `ASA`, `AAS`, `SAS`, `direction`, `rotation`, `xAlign` and `yAlign`.\n *\n * The other ways to define a triangle are (in order of highest override\n * preference to lowest if more than one is defined in the object):\n * - `ASA` or Angle-Side-Angle\n * - `SAS` or Side-Angle-Side\n * - `AAS` or Angle-Angle-Side\n * - `SSS` or Side-Side-Side\n * - `width`, `height` and `top` location\n *\n * All these methods also use `direction` to define the triangles, and\n * `rotation`, `xAlign` and `yAlign` to position the triangles. Each corner\n * and side of the triangle is indexed, and can be used for positioning.\n *\n * ![](./apiassets/triangle_definition.png)\n *\n * A triangle starts with an angle (a1) at (0, 0) and base side extending along\n * the x axis to a second angle a2. The base side is side 1 (s1).\n *\n * Angles a1 and a2 extend the triangle above s1 if `direction` is `1`, and\n * below s1 when `direction` is `-1`.\n *\n * s2, a3, and s3 are then the consecutive sides and angles.\n *\n * Triangles can be defined with a combination of side length and angle using\n * `ASA`, `SAS`, `AAS` and `SSS`, where the first side or angle is s1 or a1\n * respectively, and the subsequent sides and angles progress consecutively.\n * For instance, `ASA` defines the angle a1, then side length s1, then angle\n * a2. `SSS` defines the side lenghts s1, s2 then s3. All these combinations of\n * three properties are sufficient to define a unique triangle completely.\n *\n * When defining the triangle with `width`, `height` and `top`, the base side\n * s1 is the width, and the top point is either aligned with the `left`,\n * `center` or `right` of the base at some `height` above s1.\n *\n * When defined, a triangle's a1 corner will be at (0, 0), and s1 will be along\n * the x axis. Next, a `rotation` can be applied to the triangle. A `rotation`\n * can either be a `number` rotating it relative to its definition, or relative\n * to one of its sides: s1, s2 or s3.\n *\n * Finally, the triangle can be positioned (in draw space) using `xAlign` and\n * `yAlign`. An `xAlign` of `'left'` will position the triangle so that it's\n * left most point will be at (0, 0). Similarly, a `yAlign` of `'top'` will\n * position the triangle so its top most point is at (0, 0). Triangles\n * can also be aligned by angles (corners) and side mid points. For instance, an\n * `xAlign` of `'a2'`, will position the a2 corner at x = 0. Similarly a\n * `yAlign` of `'s3'` will position the triangle vertically such that the mid\n * point of s3 is at y = 0. `'centroid'` is relative to the geometric center of\n * the triangle.\n *\n * Once a triangle is defined and positioned in vertex space, it can then be\n * copied (`copy`) if more than one triangle is desired.\n *\n * The triangle(s) can then be positioned (`position`) or transformed\n * (`transform`) in the FigureElementPrimitive local space.\n *\n * Triangles can either be a solid fill, texture fill or outline. When `line`\n * is not defined, the triangle will be filled.\n *\n * @property {Array<Point>} [points] defining points will take precedence over\n * all other ways to define a triangle.\n * @property {number} [width] (`1`)\n * @property {number} [height] (`1`)\n * @property {'left' | 'right' | 'center'} [top] (`center`)\n * @property {[number, number, number]} [SSS]\n * @property {[number, number, number]} [ASA]\n * @property {[number, number, number]} [AAS]\n * @property {[number, number, number]} [SAS]\n * @property {1 | -1} [direction]\n * @property {number | 's1' | 's2' | 's3' | OBJ_TriangleSideRotationAlignment} [rotation]\n * @property {'left' | 'center' | 'right' | number | 'a1' | 'a2' | 'a3' | 's1' | 's2' | 's3' | 'centroid' | 'points'} [xAlign] (`'centroid'`)\n * @property {'bottom' | 'middle' | 'top' | number | 'a1' | 'a2' | 'a3' | 's1'| 's2' | 's3' | 'centroid' | 'points'} [yAlign] (`'centroid'`)\n * @property {OBJ_LineStyleSimple} [line] line style options - do not use any corner\n * options\n *\n * @extends OBJ_Generic\n *\n * @see To test examples, append them to the\n * <a href=\"#drawing-boilerplate\">boilerplate</a>\n *\n * @example\n * // Right angle triangle\n * figure.add({\n *   name: 't',\n *   method: 'triangle',\n *   options: {\n *     width: 0.5,\n *     height: 1,\n *     top: 'right',\n *   },\n * });\n *\n * @example\n * // 30-60-90 triangle with dashed line\n * const t = figure.primitives.triangle({\n *   options: {\n *     ASA: [Math.PI / 2, 1, Math.PI / 6],\n *     line: {\n *       width: 0.02,\n *       dash: [0.12, 0.04],\n *     },\n *   },\n * });\n * figure.elements.add('t', t);\n *\n * @example\n * // Star from 4 equilateral triangles\n * figure.add({\n *   name: 'star',\n *   method: 'triangle',\n *   options: {\n *     SSS: [1, 1, 1],\n *     xAlign: 'centroid',\n *     yAlign: 'centroid',\n *     copy: {\n *       along: 'rotation',\n *       num: 3,\n *       step: Math.PI / 6,\n *     },\n *   },\n * });\n */\nexport type OBJ_Triangle = {\n  width?: number,\n  height?: number,\n  top?: 'left' | 'right' | 'center',\n  SSS?: [number, number, number],\n  ASA?: [number, number, number],\n  AAS?: [number, number, number],\n  SAS?: [number, number, number],\n  direction?: 1 | -1,\n  points?: Array<Point>,\n  rotation?: number | 's1' | 's2' | 's3' | { side?: 's1' | 's2' | 's3', angle?: number },\n  xAlign: 'left' | 'center' | 'right' | number | 'c1' | 'c2' | 'c3' | 's1' | 's2' | 's3' | 'centroid' | 'points',\n  yAlign: 'bottom' | 'middle' | 'top' | number | 'c1' | 'c2' | 'c3' | 's1' | 's2' | 's3' | 'centroid' | 'points',\n  line?: OBJ_LineStyleSimple,\n} & OBJ_Generic;\n/* eslint-enable max-len */\n\n/**\n * Line definition options object that extends {@link OBJ_Generic} (without\n * `drawType`)\n *\n * ![](./apiassets/line.png)\n *\n * A line can either be defined as two points `p1` and `p2`, or\n * a single point `p1`, a `length` and an `angle`.\n *\n * The line has some `width` that will be filled on both sides\n * of the line points evenly (`'mid'`), or on one side only.\n * The line's `'positive'` side is the side to which it rotates toward\n * when rotating in the positive angle direction around `p1`.\n * Similarly the line's `'negative'` side is the opposite.\n *\n * The line can be solid or dashed using the `dash` property.\n *\n * The line can have arrows at one or both ends using the `arrow` property.\n *\n * @property {TypeParsablePoint} [p1] start point of line\n * @property {TypeParsablePoint} [p2] end point of line\n * @property {number} [length] length of line from `p1`\n * @property {number} [angle] angle of line from `p1`\n * @property {number} [width] (`0.01`)\n * @property {'mid' | 'positive' | 'negative' | number} [widthIs]\n * defines how the width is grown from the polyline's points.\n * Only `\"mid\"` is fully compatible with all options in\n * `arrow`. (`\"mid\"`)\n * @property {TypeDash} [dash] leave empty for solid line - use array of\n * numbers for dash line where first number is length of line, second number is\n * length of gap and then the pattern repeats - can use more than one dash length\n * and gap  - e.g. [0.1, 0.01, 0.02, 0.01] produces a lines with a long dash,\n * short gap, short dash, short gap and then repeats.\n * @property {OBJ_LineArrows | TypeArrowHead} [arrow] either an object defining custom\n * arrows or a string representing the name of an arrow head style can be used.\n * If a string is used, then the line will have an arrow at both ends.\n * Arrows are only available for `widthIs: 'mid'` and `linePrimitives: false`\n * @property {boolean} [linePrimitives] Use WebGL line primitives instead of\n * triangle primitives to draw the line (`false`)\n * @property {number} [lineNum] Number of line primitives to use when\n * `linePrimitivs`: `true` (`2`)\n * @property {number | TypeParsableBorder} [drawBorderBuffer]\n * override OBJ_Generic `drawBorderBuffer` with `number` to make the\n * drawBorderBuffer the same as the line with additional `number` thickness\n * on each side and the ends (`0`)\n *\n * @extends OBJ_Generic\n *\n * @see To test examples, append them to the\n * <a href=\"#drawing-boilerplate\">boilerplate</a>\n *\n * @example\n * // Simple line defined by two points\n * figure.add({\n *   name: 'l',\n *   method: 'line',\n *   options: {\n *     p1: [0, 0],\n *     p2: [0, 1],\n *     width: 0.02,\n *   },\n * });\n *\n * @example\n * // Dashed line defined by a point, a length and an angle\n * figure.add({\n *   name: 'l',\n *   method: 'line',\n *   options: {\n *     p1: [0, 0],\n *     length: 1,\n *     angle: Math.PI / 2,\n *     width: 0.03,\n *     dash: [0.1, 0.02, 0.03, 0.02],\n *   },\n * });\n *\n * @example\n * // Line with two different arrows on ends\n * figure.add({\n *   name: 'l',\n *   method: 'line',\n *   options: {\n *     p1: [0, 0],\n *     p2: [0, 1],\n *     width: 0.03,\n *     arrow: {\n *       start: 'rectangle',\n *       end: 'barb',\n *     },\n *   },\n * });\n */\nexport type OBJ_Line = {\n  p1?: TypeParsablePoint,\n  p2?: TypeParsablePoint,\n  length?: number,\n  angle?: number,\n  width?: number,\n  widthIs?: 'positive' | 'negative' | 'mid' | number,\n  dash?: TypeDash,\n  arrow?: OBJ_LineArrows | TypeArrowHead,\n  linePrimitives?: boolean,\n  lineNum?: number,\n  drawBorderBuffer?: number | TypeParsableBorder,\n} & OBJ_Generic;\n\n/**\n * Grid shape options object that extends {@link OBJ_Generic} (without\n * `drawType`)\n *\n * ![](./apiassets/grid.png)\n *\n * A grid is a rectangle divided into a series of vertical and horizontal lines.\n *\n * The rectangle is defined by `bounds`.\n *\n * `xNum` and `yNum` can be used to defined a number of equally spaced lines\n * in the rectangle (including the edges).\n *\n * Alternatively `xStep` and `yStep` can be used to define the spacing between\n * lines from the bottom left corner.\n *\n * The line width and style is defined with `line`.\n *\n * @property {TypeParsableRect} [bounds] rectangle definition\n * @property {number} [xStep] distance between vertical lines in grid from\n * left - use this instead of `xNum`.\n * @property {number} [yStep] distance between horizontal lines in grid from\n * bottom - use this instead of `yNum`\n * @property {number} [xNum] number of vertical lines in grid including top and\n * bottom lines - overrides xStep\n * @property {number} [yNum] number of horizontal lines in grid including left\n * and right lines - overrides yStep\n * @property {OBJ_LineStyle} [line] line style options - do not use any corner\n * options\n * @property {number | TypeParsableBorder} [drawBorderBuffer]\n * override OBJ_Generic `drawBorderBuffer` with `number` to make the\n * drawBorderBuffer the same as the grid outline with additional `number`\n * buffer each side (`0`)\n *\n * @extends OBJ_Generic\n *\n * @see To test examples, append them to the\n * <a href=\"#drawing-boilerplate\">boilerplate</a>\n *\n * @example\n * // Grid defined by xStep and yStep\n * figure.add({\n *   name: 'g',\n *   method: 'grid',\n *   options: {\n *     bounds: [-0.5, -0.5, 1, 1],\n *     xStep: 0.25,\n *     yStep: 0.25,\n *     line: {\n *       width: 0.03,\n *     },\n *   },\n * });\n *\n * @example\n * // Grid defined by xNum and yNum with dashed lines\n * const grid = figure.primitives.grid({\n *   bounds: [-0.5, -0.5, 1, 1],\n *   xNum: 4,\n *   yNum: 4,\n *   line: {\n *     width: 0.03,\n *     dash: [0.1, 0.02],\n *   },\n * });\n * figure.elements.add('g', grid);\n *\n * @example\n * // Grid of grids\n * figure.add({\n *   name: 'g',\n *   method: 'grid',\n *   options: {\n *     bounds: [-0.7, -0.7, 0.6, 0.6],\n *     xNum: 4,\n *     yNum: 4,\n *     line: {\n *       width: 0.03,\n *     },\n *     copy: [\n *       { along: 'x', num: 1, step: 0.8},\n *       { along: 'y', num: 1, step: 0.8},\n *     ],\n *   },\n * });\n */\nexport type OBJ_Grid = {\n  bounds?: TypeParsableRect,\n  xStep?: number,\n  yStep?: number,\n  xNum?: number,\n  yNum?: number,\n  line?: OBJ_LineStyleSimple,\n  drawBorderBuffer?: number | TypeParsableBorder,\n} & OBJ_Generic;\n\n/**\n * Arrow options object that extends {@link OBJ_Generic} (without\n * `drawType`)\n *\n * ![](./apiassets/arrow_heads.png)\n *\n * An arrow has a head, tail, length and width. The `head` defines the head\n * style of the arrow. The `length`, `width` (or `radius` for polygon and circle\n * head styles) define the size of the arrow and `tail` defines wether it has a\n * tail and how long it is.\n *\n * All properties have default values that can be scaled with the `scale`\n * property. So a `scale` of 2 will double the size of the default arrow.\n *\n * An arrow can be aligned and oriented with `align` and `angle`. `align`\n * positions the tip, start, tail or middle part of the arrow at (0, 0) in\n * draw space. This part of the arrow will therefore be at the `position`\n * or translation of the `transform`. `angle` then gives the arrow some drawn\n * rotation.\n *\n * Alignment definitions are:\n * - `tip`: arrow tip\n * - `start`: opposite side of `tip`\n * - `mid`: mid points between `start` and `tip` - useful for polygon, circle\n *   and bar arrows without tails when the head should be on a point, not next\n *   to it\n * - `tail`: the end of the tail when a tail exists, or where a tail would start\n *   if it doesn't exist.\n *\n * Setting the `tail` property to `false` will draw only the arrow head,\n * `true` will draw a tail of length 0, and a tail with a custom length\n * can be defined with a `number`. A tail length of 0 will only extend a tail\n * to the boundaries of the head. A positive tail, will extend it beyond the\n * boundaries.\n *\n * For arrow heads that use `length` and `width` properties, the `length` is the\n * dimension along the line. It includes both the head and the tail, so an arrow\n * with length 1 and tailLength 0.4 will have a head length of 0.6.\n *\n * For `polygon` and `circle` arrows, only `radius` and `tail` are used to\n * determine the dimension of the arrow (`length` and `width` are ignored).\n *\n * @property {TypeArrowHead} [head] head style (`'triangle'`)\n * @property {number} [scale] scale the default dimensions of the arrow\n * @property {number} [length] dimension of the arrow head along the line\n * @property {number} [width] dimension of the arrow head along the line width\n * @property {number} [rotation] rotation of the polygon when `head = 'polygon'`\n * @property {number} [sides] number of sides in polygon or circle arrow head\n * @property {number} [radius] radius of polygon or circle arrow head\n * @property {number} [barb] barb length (along the length of the line) of the\n * barb arrow head\n * @property {number} [tailWidth] width of the line that joins the arrow - if\n * defined this will create minimum dimensions for the arrow\n * @property {boolean | number} [tail] `true` includes a tail in the arrow of\n * with `tailWidth`. A `number` gives the tail a length where 0 will not\n * extend the tail beyond the boundaries of the head\n * @property {'tip' | 'start' | 'mid' | 'tail'} [align] define which part of\n * the arrow is aligned at (0, 0) in draw space (`'tip'`)\n * @property {number} [angle] angle the arrow is drawn at (`0`)\n *\n * @extends OBJ_Generic\n *\n * @example\n * // Triangle arrow with tail\n * figure.add({\n *   name: 'a',\n *   method: 'arrow',\n *   options: {\n *     head: 'triangle',\n *     tail: 0.15,\n *     length: 0.5,\n *   },\n * });\n *\n * @example\n * // Barb arrow with 0 tail\n * figure.add({\n *   name: 'a',\n *   method: 'arrow',\n *   options: {\n *     head: 'barb',\n *     angle: Math.PI / 2,\n *     tail: 0,\n *   },\n * });\n *\n * @example\n * // Create a vector map with arrows by copying an original arrow by a\n * // transforms defining the position, rotation and scale of the arrows\n *\n * // Create transforms to apply to each arrow\n * const r = Fig.range(0, Math.PI / 2, Math.PI / 18);\n * const x = [0, 1, 2, 0, 1, 2, 0, 1, 2];\n * const y = [0, 0, 0, 1, 1, 1, 2, 2, 2];\n * const s = [0.5, 0.8, 0.4, 0.6, 0.8, 0.6, 0.5, 0.8, 0.6];\n * const transforms = [];\n * for (let i = 0; i < 9; i += 1) {\n *   transforms.push(new Fig.Transform().scale(s[i], s[i]).rotate(r[i]).translate(x[i], y[i]));\n * }\n *\n * // Create arrow and copy to transforms\n * figure.add({\n *   name: 'a',\n *   method: 'arrow',\n *   options: {\n *     head: 'barb',\n *     align: 'mid',\n *     length: 0.7,\n *     copy: {\n *       to: transforms,\n *       original: false,\n *     },\n *   },\n * });\n */\nexport type OBJ_Arrow = {\n  head?: TypeArrowHead,\n  scale?: number,\n  length?: number,\n  width?: number,\n  rotation?: number,\n  sides?: number,\n  radius?: number,\n  barb?: number,\n  tailWidth?: number,\n  tail?: boolean,\n  align?: 'tip' | 'start' | 'mid' | 'tail',\n  angle?: number,\n} & OBJ_Generic;\n\n\n/**\n * Text Definition object\n *\n * Used within {@link OBJ_Text} to define a single string\n *\n * @property {string} text string to show\n * @property {OBJ_Font} [font] font to apply to string\n * @property {TypeParsablePoint} [location] vertex space location to draw text\n * (default: `[0, 0]`)\n * @property {'left' | 'right' | 'center'} [xAlign] how to align text\n * horizontally relative to `location` (default: from {@link OBJ_Text})\n * @property {'bottom' | 'baseline' | 'middle' | 'top'} [yAlign] how to align\n * text vertically relative to `location` (default: from {@link OBJ_Text})\n * @property {string | function(): void} [onClick] function to execute on click\n * within the `touchBorder`\n * @property {TypeParsableBuffer | Array<TypeParsablePoint>} [touchBorder]\n * touch border can be custom points (`Array<TypeParsablePoint>`), set to\n * or set to some buffer (`number`) around the rext (default: `0`)\n */\nexport type OBJ_TextDefinition = {\n  text: string,\n  font?: OBJ_Font,\n  location?: TypeParsablePoint,\n  xAlign?: 'left' | 'right' | 'center',\n  yAlign?: 'bottom' | 'baseline' | 'middle' | 'top',\n  onClick?: string | () => void,\n  touchBorder?: TypeParsableBuffer | Array<TypeParsablePoint>,\n};\n\n/**\n * One or more text strings.\n *\n * ![](./apiassets/text_ex1.png)\n *\n * ![](./apiassets/text_ex2.png)\n *\n * Simple text options object.\n *\n * Use this to make a {@link FigureElementPrimitive} that renders text.\n *\n * `text` can either be a single string, or an array of\n * {@link OBJ_TextDefinition} objects to define multiple strings. Each string\n * can have a different location, alignment (`xAlign`, `yAlign`) and formatting.\n *\n * {@link FigureElementPrimitive} objects allow for a callback to be defined\n * when they are touched by a user. In text {@link FigureElementPrimitive},\n * each string can have its own callback assigned using the `onClick` property\n * of {@link OBJ_TextDefinition}. In addition custom touch borders to make it\n * easier to click the strings can be defined.\n *\n * Note: there is a slight performance improvement in including multiple\n * strings at different locations in the same {@link FigureElementPrimitive},\n * rather than creating a {@link FigureElementPrimitive} for each string.\n *\n * @property {string | OBJ_TextDefinition | Array<string | OBJ_TextDefinition>} text\n * text to draw, either as a single string or multiple strings in an array\n * @property {OBJ_Font} [font] default font to apply to all text\n * @property {'left' | 'right' | 'center'} [xAlign] default horizontal text\n * alignment for `text` relative to `location` (default: `\"left\"`)\n * @property {'bottom' | 'baseline' | 'middle' | 'top'} [yAlign] default\n * vertical text alignment for `text` relative to `location` (default: `\"baseline\"`)\n * @property {TypeParsableBuffer} [defaultTextTouchBorder]?: default buffer for\n * `touchBorder` property in `text`\n * @property {TypeColor} [color] (default: `[1, 0, 0, 1`])\n * @property {TypeParsableBorder | 'buffer' | 'draw' | 'rect' | number} [border]\n * border used for keeping shape within limits (`'draw'`)\n * @property {TypeParsableBorder | 'rect' | 'border' | 'buffer' | number | 'draw'} [touchBorder]\n * border used for determining shape was touched. `number` and `'rect'` use\n * the the points in `'buffer'` to calculate the bounding rects (`'buffer'`).\n * @property {TypeParsablePoint} [position] if defined, overrides translation\n * in transform\n * @property {TypeParsableTransform} [transform]\n * (default: `Transform('text').standard()`)\n *\n * @see To test examples, append them to the\n * <a href=\"#text-boilerplate\">boilerplate</a>\n *\n * @example\n * // Single string\n * figure.add(\n *   {\n *     name: 't',\n *     method: 'text',\n *     options: {\n *       text: 'hello',\n *       xAlign: 'center',\n *       yAlign: 'middle',\n *     },\n *   },\n * );\n *\n * @example\n * // Multi string\n * figure.add(\n *   {\n *     name: 't',\n *     method: 'text',\n *     options: {\n *       text: [\n *         {\n *           text: 'hello',\n *           font: { style: 'italic', color: [0, 0.5, 1, 1], size: 0.1 },\n *           xAlign: 'left',\n *           yAlign: 'bottom',\n *           location: [-0.35, 0],\n *         },\n *         {\n *           text: 'world',\n *           location: [0, -0.1],\n *         },\n *       ],\n *       xAlign: 'center',\n *       yAlign: 'middle',\n *       font: { size: 0.3 },\n *       color: this.defaultColor,\n *     },\n *   },\n * );\n */\nexport type OBJ_Text = {\n  text: string | OBJ_TextDefinition | Array<string | OBJ_TextDefinition>;\n  font?: OBJ_Font,                    // default font\n  xAlign?: 'left' | 'right' | 'center',                // default xAlign\n  yAlign?: 'bottom' | 'baseline' | 'middle' | 'top',   // default yAlign\n  defaultTextTouchBorder?: TypeParsableBuffer,\n  color?: TypeColor,\n  border?: TypeParsableBorder | 'buffer' | 'draw' | 'rect' | number,\n  touchBorder?: TypeParsableBorder | 'rect' | 'border' | 'buffer' | number | 'draw',\n  position?: TypeParsablePoint,\n  transform?: TypeParsableTransform,\n}\n\n\n/**\n * Line Text Definition object\n *\n * Used to define a string within a text line primitive {@link OBJ_TextLine}.\n *\n * @property {string} [text] string to show\n * @property {OBJ_Font} [font] font to apply to string\n * @property {TypeParsablePoint} [offset] offset to draw text (default: `[0, 0]`)\n * @property {boolean} [followOffsetY] `true` will make any subsequent text\n * have the same y offset as a starting point (`false`)\n * @property {boolean} [inLine] `false` means next text will follow previous\n * and not this (default: `true`)\n * @property {string | function(): void} [onClick] function to execute on click\n * within the `touchBorder` of string\n * @property {TypeParsableBuffer | Array<TypeParsablePoint>} [touchBorder]\n * touch border can be custom (`Array<TypeParsablePoint>`), or be set to some\n * buffer (`TypeParsableBuffer`) around the rectangle (default: `'0'`)\n */\nexport type OBJ_TextLineDefinition = {\n  text: string,\n  font?: OBJ_Font,\n  offset?: TypeParsablePoint,\n  followOffsetY?: boolean,\n  inLine?: boolean,\n  onClick?: string | () => void,\n  touchBorder?: TypeParsableBuffer | Array<TypeParsablePoint>,\n};\n\n/**\n * Text Line\n *\n * ![](./apiassets/textLine.png)\n *\n * Array of strings that are arranged into a line. Each string is arranged so\n * that it is to the right of the previous string.\n *\n * Strings can be arranged out of the line flow by using the `inLine` property\n * in {@link OBJ_TextLineDefinition}.\n *\n * @property {Array<string | OBJ_TextLineDefinition>} [text] array of strings,\n * to layout into a line\n * @property {OBJ_Font} [font] Default font for strings in line\n * @property {TypeColor} [color] Default color for strings in line\n * (`[1, 0, 0, 1`])\n * @property {TypeParsableBuffer} [defaultTextTouchBorder]?: default buffer for\n * `touchBorder` property in `text`\n * @property {'left' | 'right' | 'center'} [xAlign] horizontal alignment of\n * line with `position` (`left`)\n * @property {'bottom' | 'baseline' | 'middle' | 'top'} [yAlign] vertical\n * alignment of line with `position` (`baseline`)\n * @property {TypeParsableBorder | 'buffer' | 'draw' | 'rect' | number} [border]\n * border used for keeping shape within limits (`'draw'`)\n * @property {TypeParsableBorder | 'rect' | 'border' | 'buffer' | number | 'draw'} [touchBorder]\n * border used for determining shape was touched. `number` and `'rect'` use\n * the the points in `'buffer'` to calculate the bounding rects (`'buffer'`).\n * @property {TypeParsablePoint} [position] if defined, overrides translation\n * in transform\n * @property {TypeParsableTransform} [transform]\n * (`Transform('text').standard()`)\n *\n * @see To test examples, append them to the\n * <a href=\"#text-boilerplate\">boilerplate</a>\n *\n * @example\n * // \"Hello to the world1\" with highlighted \"to the\" and superscript \"1\"\n * figure.add(\n *   {\n *     name: 'line',\n *     method: 'text.line',\n *     options: {\n *       text: [\n *         'Hello ',\n *         {\n *           text: 'to the',\n *           font: {\n *             style: 'italic',\n *             color: [0, 0.5, 1, 1],\n *           },\n *         },\n *         ' world',\n *         {\n *           text: '1',\n *           offset: [0, 0.1],\n *           font: { size: 0.1, color: [0, 0.6, 0, 1] },\n *         },\n *       ],\n *       xAlign: 'center',\n *       yAlign: 'bottom',\n *       font: {\n *         style: 'normal',\n *         size: 0.2,\n *       },\n *       color: this.defaultColor,\n *     },\n *   },\n * );\n */\nexport type OBJ_TextLine = {\n  text: Array<string | OBJ_TextLineDefinition>;\n  font: OBJ_Font,\n  color: TypeColor,\n  defaultTextTouchBorder?: TypeParsableBuffer,\n  xAlign: 'left' | 'right' | 'center',\n  yAlign: 'bottom' | 'baseline' | 'middle' | 'top',\n  border?: TypeParsableBorder | 'buffer' | 'draw' | 'rect' | number,\n  touchBorder?: TypeParsableBorder | 'rect' | 'border' | 'buffer' | number | 'draw',\n  position: TypeParsablePoint,\n  transform: TypeParsableTransform,\n}\n\n/**\n * Lines Text Definition object.\n *\n * Used to define a string within a text lines primitive {@link OBJ_TextLines}.\n *\n * @property {string} [text] string representing a line of text\n * @property {OBJ_Font} [font] line specific default font\n * @property {'left' | 'right' | 'center'} [justify] line specific justification\n * @property {number} [lineSpace] line specific separation from baseline of\n * this line to baseline of previous line\n */\nexport type OBJ_TextLinesDefinition = {\n  text: string,\n  font?: OBJ_Font,\n  justify?: 'left' | 'right' | 'center',\n  lineSpace?: number,\n};\n\n/**\n * Modifier Text Definition object.\n *\n * Used to define the modifiers of a string within a text lines primitive\n * {@link OBJ_TextLines}.\n *\n * @property {string} [text] text to replace `modifierId` with - if `undefined`\n * then `modifierId` is used\n * @property {TypeParsablePoint} [offset] text offset\n * @property {boolean} [followOffsetY] `true` will make any subsequent text\n * have the same y offset as a starting point (`false`)\n * @property {OBJ_Font} [font] font changes for modified text\n * @property {boolean} [inLine] `false` if modified text should not contribute\n * to line layout (defqult: `true`)\n * @property {string | function(): void} [onClick] function to execute on click\n * within the `touchBorder` of the modified text\n * @property {TypeParsableBuffer | Array<TypeParsablePoint>} [touchBorder]\n * touch border can be custom (`Array<TypeParsablePoint>`), or be set to some\n * buffer (`TypeParsableBuffer`) around the rectangle (default: `'0'`)\n */\nexport type OBJ_TextModifierDefinition = {\n  text?: string,\n  offset?: TypeParsablePoint,\n  inLine?: boolean,\n  font?: OBJ_Font,\n  touchBorder?: TypeParsableBuffer | Array<TypeParsablePoint>,\n  onClick?: string | () => void,\n  followOffsetY?: boolean,\n}\n\n/**\n * Modifier object.\n *\n * Used to define the modifiers of a string within a text lines primitive\n * {@link OBJ_TextLines}.\n *\n * @property {OBJ_TextModifiersDefinition} [modifierId] modifierId can be any\n * key\n */\nexport type OBJ_TextModifiersDefinition = {\n  [modifierId: string]: OBJ_TextModifierDefinition,\n}\n\n/**\n * Text Lines\n *\n * ![](./apiassets/textLines_ex1.png)\n *\n * ![](./apiassets/textLines_ex2.png)\n *\n * Layout multiple lines of text, justified to the `left`,\n * `center` or `right`.\n *\n * Each line is defined by a string in `lines`.\n *\n * A word or phrase within the line can have custom formatting by defining a\n * unique ID surrounded in | characters. The unique id is then used as a key\n * in the modifiers object to define the formatting and replacement text. By\n * default, the unique id will be used as the replacement text.\n *\n * Each line can have custom formatting or justification by defining a\n * {@link OBJ_TextLinesDefinition} object instead or a string in the lines\n * array.\n *\n * To escape the modifier special character \"|\", use a forward slash. e.g.\n *\n * `\"This line has a uses the special char: /|\"`\n *\n * @property {Array<string | OBJ_TextLinesDefinition>} [text] array of line\n * strings\n * @property {OBJ_TextModifiersDefinition} [modifiers] modifier definitions\n * @property {OBJ_Font} [font] Default font to use in lines\n * @property {TypeColor} [color] Default color to use in lines\n * (`[1, 0, 0, 1`])\n * @property {TypeParsableBuffer} [defaultTextTouchBorder]?: default buffer for\n * `touchBorder` property in `text`\n * @property {'left' | 'right' | 'center} [justify] justification of lines\n * (`left`)\n * @property {number} [lineSpace] Space between baselines of lines\n * (`font.size * 1.2`)\n * @property {'left' | 'right' | 'center'} [xAlign] horizontal alignment of\n * lines with `position` (`left`)\n * @property {'bottom' | 'baseline' | 'middle' | 'top'} [yAlign] vertical\n * alignment of lines with `position` (`baseline`)\n * @property {TypeParsableBorder | 'buffer' | 'draw' | 'rect' | number} [border]\n * border used for keeping shape within limits (`'draw'`)\n * @property {TypeParsableBorder | 'rect' | 'border' | 'buffer' | number | 'draw'} [touchBorder]\n * border used for determining shape was touched. `number` and `'rect'` use\n * the the points in `'buffer'` to calculate the bounding rects (`'buffer'`).\n * @property {TypeParsablePoint} [position] if defined, overrides translation\n * in transform\n * @property {TypeParsableTransform} [transform]\n * (`Transform('text').standard()`)\n *\n * @see To test examples, append them to the\n * <a href=\"#text-boilerplate\">boilerplate</a>\n *\n * @example\n * // \"Two justified lines\"\n * figure.add(\n *   {\n *     name: 't',\n *     method: 'text.lines',\n *     options: {\n *       text: [\n *         'First line',\n *         'This is the second line',\n *       ],\n *       font: {\n *         style: 'normal',\n *         size: 0.2,\n *       },\n *       justify: 'center',\n *       color: this.defaultColor,\n *     },\n *   },\n * );\n *\n * @example\n * // \"Example showing many features of textLines\"\n * figure.add(\n *   {\n *     name: 'lines',\n *     method: 'textLines',\n *     options: {\n *        text: [\n *          'Lines justified to the left',\n *          'A |line| with a |modified_phrase|',\n *          {\n *            text: 'A |line| with custom defaults',\n *            font: {\n *              style: 'italic',\n *              color: [0, 0.5, 1, 1],\n *            },\n *          },\n *        ],\n *        modifiers: {\n *          modified_phrase: {\n *            text: 'modified phrase',\n *            font: {\n *              style: 'italic',\n *              color: [0, 0.5, 1, 1],\n *            },\n *          },\n *          line: {\n *            font: {\n *              family: 'Times New Roman',\n *              color: [0, 0.6, 0, 1],\n *              style: 'italic',\n *            },\n *          },\n *        },\n *        font: {\n *          family: 'Helvetica Neue',\n *          weight: '200',\n *          style: 'normal',\n *          size: 0.2,\n *        },\n *        justify: 'left',\n *        lineSpace: -0.4,\n *        position: [-0.5, 0.1],\n *      },\n *   },\n * );\n */\nexport type OBJ_TextLines = {\n  text: Array<string | OBJ_TextLinesDefinition>,\n  modifiers: OBJ_TextModifiersDefinition,\n  font?: OBJ_Font,\n  defaultTextTouchBorder?: TypeParsableBuffer,\n  justify?: 'left' | 'center' | 'right',\n  lineSpace?: number,\n  xAlign: 'left' | 'right' | 'center',\n  yAlign: 'bottom' | 'baseline' | 'middle' | 'top',\n  color: TypeColor,\n  border?: TypeParsableBorder | 'buffer' | 'draw' | 'rect' | number,\n  touchBorder?: TypeParsableBorder | 'rect' | 'border' | 'buffer' | number | 'draw',\n  position: TypeParsablePoint,\n  transform: TypeParsableTransform,\n};\n\n// export type TypeGridOptions = {\n//   bounds?: Rect,\n//   xStep?: number,\n//   yStep?: number,\n//   numLinesThick?: number,\n//   color?: TypeColor,\n//   position?: Point,\n//   transform?: Transform,\n//   pulse?: number,\n// };\n\nexport type TypeRepeatPatternVertex = {\n  element?: FigureElementPrimitive,\n  xNum?: number,\n  yNum?: number,\n  xStep?: number,\n  yStep?: number,\n  pulse?: number;\n  position?: Point,\n  transform?: Transform,\n};\n\n\n// export type TypePointTransforms = {\n//   offset?: TypeParsablePoint,\n//   transform?: Transform,\n//   repeatRect?: {\n//     xNum?: number,\n//     xStep?: number,\n//     yNum?: number,\n//     yStep?: number,\n//   },\n//   repeatPolar?: {\n//     magNum?: number,\n//     magStep?: number,\n//     angleNum?: number,\n//     angleStep?: number,\n//     angleStart?: number,\n//   },\n//   repeatTransforms?: Array<Transform>,\n// };\n\n// export type TypeCopyLinear = {\n//   num?: number,\n//   step?: number,\n//   angle?: number,\n//   axis?: 'x' | 'y',\n// }\n\n// export type TypeCopyRadial = {\n//   numMag?: number,\n//   numAngle?: number,\n//   stepMag?: number,\n//   stepAngle?: number,\n//   startAngle?: number,\n// }\n\n// export type TypeCopyOffset = {\n//   offset: TypeParsablePoint,\n// };\n\n// export type TypeCopyTransform = {\n//   transform: Transform;\n// }\n\n// export type TypeCopy = Array<Transform> | Array<Point> | TypeCopyRadial\n//                        | TypeCopyLinear | Point | Transform | TypeCopyOffset\n//                        | TypeCopyTransform;\n\n// export type TypePointTransforms1 = {\n//   offset?: TypeParsablePoint,\n//   transform?: Transform,\n//   copy: {\n//     xNum?: number,\n//     xStep?: number,\n//     yNum?: number,\n//     yStep?: number,\n//     magNum?: number,\n//     magStep?: number,\n//     angleNum?: number,\n//     angleStep?: number,\n//     angleStart?: number,\n//     transforms?: Array<Transform>,\n//   },\n//   copy: TypeCopy | Array<TypeCopy>,\n// };\n\ntype OBJ_PolyLineTris = OBJ_LineStyleSimple & { drawBorderBuffer: number | Array<Array<Point>> };\n\n\nfunction parsePoints(\n  options: Object,\n  keysToParsePointsOrPointArrays: Array<string>,\n) {\n  const parseKey = (key) => {\n    const value = options[key];\n    if (value == null) {\n      return;\n    }\n    if (typeof value === 'string') {\n      return;\n    }\n    if (typeof value === 'number') {\n      return;\n    }\n    const processArray = (a) => {\n      for (let i = 0; i < a.length; i += 1) {\n        if (Array.isArray(a[i]) && !(typeof a[i][0] === 'number')) {\n          // eslint-disable-next-line no-param-reassign\n          a[i] = processArray(a[i]);\n        } else {\n          // eslint-disable-next-line no-param-reassign\n          a[i] = getPoint(a[i]);\n        }\n      }\n      return a;\n    };\n    if (Array.isArray(value) && !(typeof value[0] === 'number')) {\n      // eslint-disable-next-line no-param-reassign\n      options[key] = processArray(value); // value.map(p => getPoint(p));\n    } else {\n      // eslint-disable-next-line no-param-reassign\n      options[key] = getPoint(value);\n    }\n  };\n\n  if (typeof keysToParsePointsOrPointArrays === 'string') {\n    parseKey(keysToParsePointsOrPointArrays);\n  } else {\n    keysToParsePointsOrPointArrays.forEach(key => parseKey(key));\n  }\n}\n\n// function processOptions(...optionsIn: Array<Object>) {\n//   const options = joinObjects({}, ...optionsIn);\n//   if (options.position != null) {\n//     const p = getPoint(options.position);\n//     if (options.transform == null) {\n//       options.transform = new Transform('processOptions').translate(0, 0);\n//     }\n//     options.transform.updateTranslation(p);\n//   }\n//   return options;\n// }\n\nfunction setupPulse(element: FigureElement, options: Object) {\n  if (options.pulse != null) {\n    if (\n      typeof element.pulseDefault !== 'function'\n      && typeof element.pulseDefault !== 'string'\n    ) {\n      if (typeof options.pulse === 'number') {\n        // eslint-disable-next-line no-param-reassign\n        element.pulseDefault.scale = options.pulse;\n      } else {\n        // eslint-disable-next-line no-param-reassign\n        element.pulseDefault = joinObjects({}, element.pulseDefault, options.pulse);\n      }\n    }\n  }\n}\n\n/**\n * Built in figure primitives.\n *\n * Including simple shapes, grid and text.\n */\nexport default class FigurePrimitives {\n  webgl: Array<WebGLInstance>;\n  draw2D: Array<DrawContext2D>;\n  htmlCanvas: HTMLElement;\n  limits: Rect;\n  spaceTransforms: OBJ_SpaceTransforms;\n  animateNextFrame: Function;\n  draw2DFigures: Object;\n  defaultColor: Array<number>;\n  defaultDimColor: Array<number>;\n  defaultFont: OBJ_Font;\n  defaultLineWidth: number;\n  defaultLength: number;\n\n  /**\n    * @hideconstructor\n    */\n  constructor(\n    webgl: Array<WebGLInstance> | WebGLInstance,\n    draw2D: Array<DrawContext2D> | DrawContext2D,\n    // draw2DFigures: Object,\n    htmlCanvas: HTMLElement,\n    limits: Rect,\n    spaceTransforms: OBJ_SpaceTransforms,\n    animateNextFrame: Function,\n    defaultColor: Array<number>,\n    defaultDimColor: Array<number>,\n    defaultFont: OBJ_Font,\n    defaultLineWidth: number,\n    defaultLength: number,\n  ) {\n    if (Array.isArray(webgl)) {\n      this.webgl = webgl;\n    } else {\n      this.webgl = [webgl];\n    }\n\n    if (Array.isArray(draw2D)) {\n      this.draw2D = draw2D;\n    } else {\n      this.draw2D = [draw2D];\n    }\n    /**\n     * @private {htmlElement}\n     */\n    this.htmlCanvas = htmlCanvas;\n    this.limits = limits;\n    this.animateNextFrame = animateNextFrame;\n    this.spaceTransforms = spaceTransforms;\n    this.defaultColor = defaultColor;\n    this.defaultDimColor = defaultDimColor;\n    this.defaultFont = defaultFont;\n    this.defaultLineWidth = defaultLineWidth;\n    this.defaultLength = defaultLength;\n    // this.draw2DFigures = draw2DFigures;\n  }\n\n  /**\n   * {@link FigureElementPrimitive} that draws a generic shape.\n   * @see {@link OBJ_Generic} for options and examples.\n   */\n  generic(...optionsIn: Array<OBJ_Generic>) {\n    const defaultOptions = {\n      name: generateUniqueId('primitive_'),\n      color: this.defaultColor,\n      transform: new Transform('generic').standard(),\n      texture: {\n        src: '',\n        mapTo: new Rect(-1, -1, 2, 2),\n        mapFrom: new Rect(0, 0, 1, 1),\n        repeat: false,\n        onLoad: this.animateNextFrame,\n      },\n    };\n    const options = joinObjects({}, defaultOptions, ...optionsIn);\n    options.transform = getTransform(options.transform);\n    if (options.position != null) {\n      options.position = getPoint(options.position);\n      options.transform.updateTranslation(options.position);\n    }\n\n    const element = Generic(\n      this.webgl,\n      options.color,\n      options.transform,\n      this.limits,\n      options.texture.src,\n      options.texture.mapTo,\n      options.texture.mapFrom,\n      options.texture.repeat,\n      options.texture.onLoad,\n      options.name,\n    );\n    element.dimColor = this.defaultDimColor.slice();\n\n    element.custom.updateGeneric = function update(updateOptions: {\n      points?: Array<TypeParsablePoint>,\n      drawBorder?: TypeParsableBorder,\n      drawBorderBuffer?: TypeParsableBorder,\n      border?: TypeParsableBorder | 'draw' | 'buffer' | 'rect' | number,\n      touchBorder?: TypeParsableBorder | 'draw' | 'border' | 'rect' | number | 'buffer',\n      holeBorder?: TypeParsableBorder,\n      copy?: Array<CPY_Step>,\n      drawType?: 'triangles' | 'strip' | 'fan' | 'lines',\n    }) {\n      const o = updateOptions;\n      if (o.copy != null && !Array.isArray(o.copy)) {\n        o.copy = [o.copy];\n      }\n      if (o.points != null) { // $FlowFixMe\n        o.points = getPoints(o.points);\n      }\n      if (o.drawBorder != null) { // $FlowFixMe\n        element.drawBorder = getBorder(o.drawBorder);\n      } else if (o.points != null) {\n        element.drawBorder = [o.points];\n      }\n      if (o.drawBorderBuffer != null) { // $FlowFixMe\n        element.drawBorderBuffer = getBorder(o.drawBorderBuffer);\n      } else element.drawBorderBuffer = element.drawBorder;\n      if (o.border != null) { // $FlowFixMe\n        element.border = getBorder(o.border);\n      }\n      if (o.touchBorder != null) { // $FlowFixMe\n        element.touchBorder = getBorder(o.touchBorder);\n      }\n      if (o.holeBorder != null) { // $FlowFixMe\n        element.holeBorder = getBorder(o.holeBorder);\n      }\n      element.drawingObject.change(o);\n    };\n    element.custom.updateGeneric(options);\n    element.custom.updatePoints = element.custom.updateGeneric;\n    setupPulse(element, options);\n    return element;\n  }\n\n  getPolylineTris(\n    optionsIn: OBJ_PolyLineTris,\n  ) {\n    const defaultOptions = {\n      points: [[0, 0], [1, 0]],\n      width: this.defaultLineWidth,\n      color: this.defaultColor,\n      close: false,\n      widthIs: 'mid',\n      cornerStyle: 'auto',\n      cornerSize: 0.01,\n      cornerSides: 10,\n      cornersOnly: false,\n      cornerLength: 0.1,\n      minAutoCornerAngle: Math.PI / 7,\n      dash: [],\n      linePrimitives: false,\n      lineNum: 1,\n      drawBorder: 'negative',\n      holeBorder: [[]],\n      drawBorderBuffer: 0,\n      simple: false,\n    };\n    const o = joinObjects({}, defaultOptions, optionsIn);\n    if (o.linePrimitives === false) {\n      o.lineNum = 2;\n    }\n    parsePoints(o, ['points', 'border', 'holeBorder', 'touchBorder']);\n\n    let points;\n    let drawBorder;\n    let holeBorder;\n    let drawBorderBuffer;\n    if (o.simple) {\n      [points, drawBorder, drawBorderBuffer, holeBorder] = makeFastPolyLine(\n        o.points, o.width, o.close,\n      );\n    } else if (o.cornersOnly) {\n      [points, drawBorder, drawBorderBuffer, holeBorder] = makePolyLineCorners(\n        o.points, o.width, o.close, o.cornerLength, o.widthIs, o.cornerStyle,\n        o.cornerSize, o.cornerSides, o.minAutoCornerAngle, o.linePrimitives,\n        o.lineNum, o.drawBorderBuffer,\n      );\n    } else {\n      [points, drawBorder, drawBorderBuffer, holeBorder] = makePolyLine(\n        o.points, o.width, o.close, o.widthIs, o.cornerStyle, o.cornerSize,\n        o.cornerSides, o.minAutoCornerAngle, o.dash, o.linePrimitives,\n        o.lineNum, o.drawBorder, o.drawBorderBuffer, o.hole, o.arrow,\n      );\n    }\n    if (Array.isArray(o.drawBorderBuffer)) {\n      drawBorderBuffer = getBorder(o.drawBorderBuffer);\n    }\n    if (Array.isArray(o.drawBorder)) {\n      drawBorder = getBorder(o.drawBorder);\n    }\n    if (drawBorderBuffer == null) {\n      drawBorderBuffer = drawBorder;\n    }\n    if (o.holeBorder == null) {\n      o.holeBorder = holeBorder;\n    }\n    let drawType = 'triangles';\n    if (o.linePrimitives) {\n      drawType = 'lines';\n    }\n    if (o.simple) {\n      drawType = 'strip';\n    }\n    return [o, points, drawBorder, drawBorderBuffer, drawType];\n  }\n\n  /**\n   * {@link FigureElementPrimitive} that draws a polyline.\n   * @see {@link OBJ_Polyline} for options and examples.\n   */\n  polyline(...optionsIn: Array<OBJ_Polyline>) {\n    const options = joinObjects({}, ...optionsIn);\n    const element = this.generic({\n      transform: new Transform('polyline').standard(),\n      border: 'draw',\n      touchBorder: 'border',   // $FlowFixMe\n      holeBorder: [[]],\n    }, ...optionsIn);\n\n    element.custom.options = {\n      points: [[0, 0], [1, 0]],\n      width: this.defaultLineWidth,\n      color: this.defaultColor,\n      close: false,\n      widthIs: 'mid',\n      cornerStyle: 'auto',\n      cornerSize: 0.01,\n      cornerSides: 10,\n      cornersOnly: false,\n      cornerLength: 0.1,\n      minAutoCornerAngle: Math.PI / 7,\n      dash: [],\n      linePrimitives: false,\n      lineNum: 1,\n      drawBorder: 'line',\n      holeBorder: [[]],\n      drawBorderBuffer: 0,\n    };\n    element.custom.updatePoints = (updateOptions: OBJ_Polyline) => {\n      const [o, points, drawBorder, drawBorderBuffer, drawType] =\n        this.getPolylineTris(joinObjects({}, element.custom.options, updateOptions));\n      element.custom.options = o;\n      element.custom.updateGeneric(joinObjects({}, o, {\n        points, drawBorder, drawBorderBuffer, drawType,\n      }));\n    };\n\n    element.custom.updatePoints(options);\n\n    // getTris(options);\n    // setupPulse(element, options);\n    return element;\n  }\n\n  getPolygonBorder(optionsIn: OBJ_Polygon_Defined) {\n    const o = optionsIn;\n    parsePoints(o, ['offset']);\n    if (o.angleToDraw != null) {\n      o.sidesToDraw = Math.floor(\n        o.angleToDraw / (Math.PI * 2 / o.sides),\n      );\n    }\n    if (o.sidesToDraw == null) {\n      o.sidesToDraw = o.sides;\n    }\n    if (o.sidesToDraw > o.sides) {\n      o.sidesToDraw = o.sides;\n    }\n    const points = getPolygonPoints(o);\n    // let { drawBorderBuffer } = o;\n    let drawBorderOffset = 0;\n    let drawBorder;\n    if (o.line != null) {\n      o.line = joinObjects({}, {\n        width: this.defaultLineWidth,\n        widthIs: 'mid',\n      }, o.line);\n      if (o.line.widthIs === 'inside' && o.direction === 1) {\n        o.line.widthIs = 'positive';\n      } else if (o.line.widthIs === 'inside' && o.direction === -1) {\n        o.line.widthIs = 'negative';\n      }\n      if (o.line.widthIs === 'outside' && o.direction === 1) {\n        o.line.widthIs = 'negative';\n      } else if (o.line.widthIs === 'outside' && o.direction === -1) {\n        o.line.widthIs = 'positive';\n      }\n      const { width, widthIs } = o.line;\n      const dir = o.direction;\n      if (\n        (dir === 1 && (widthIs === 'negative' || widthIs === 'outside'))\n        || (dir === -1 && (widthIs === 'positive' || widthIs === 'inside'))\n      ) {\n        drawBorderOffset = width;\n      } else if (widthIs === 'mid') {\n        drawBorderOffset = width / 2;\n      }\n      if (drawBorderOffset > 0) {\n        const cornerAngle = (o.sides - 2) * Math.PI / o.sides;\n        drawBorderOffset /= Math.sin(cornerAngle / 2);\n      }\n      if (o.sidesToDraw === o.sides) {\n        o.line.close = true;\n      } else {\n        o.line.close = false;\n      }\n    } else if (o.sidesToDraw !== o.sides && o.line == null) {\n      points.push(o.offset);\n    }\n    if (drawBorderOffset === 0) {\n      drawBorder = [points];\n    } else {\n      drawBorder = [getPolygonPoints(joinObjects(\n        {}, o, { radius: o.radius + drawBorderOffset },\n      ))];\n    }\n    return [o, points, drawBorder, 'triangles'];\n  }\n\n\n  genericBase(\n    name: string,\n    defaultOptions: Object,\n    optionsIn: Object,\n  ) {\n    const element = this.generic({\n      transform: new Transform(name).standard(),\n      border: 'draw',\n      touchBorder: 'border',   // $FlowFixMe\n      holeBorder: [[]],\n    }, optionsIn);\n\n    element.custom.options = defaultOptions;\n\n    element.custom.getFill = () => [];\n    // element.custom.getLine = () => [];\n    element.custom.close = true;\n    element.custom.skipConcave = true;\n    element.custom.bufferOffset = 'negative';\n    element.custom.getLine = (o: OBJ_PolyLineTris) => {  // $FlowFixMe\n      if (!element.custom.close && o.drawBorder == null) {   // $FlowFixMe\n        o.drawBorder = 'line';\n      }\n      return this.getPolylineTris(o);\n    };\n    element.custom.getBorder = () => [];\n    element.custom.updatePoints = (updateOptions: Object) => {\n      const borderOptions = joinObjects({}, element.custom.options, updateOptions);\n      const [o, border] = element.custom.getBorder(borderOptions);\n      // console.log(element.custom.bufferOffset)\n      // if (element.custom.bufferOffset === 'positive') {\n      //   border.reverse();\n      // }\n      if (o.line == null) {\n        const [\n          points, drawType,\n        ] = element.custom.getFill(border, o);\n        element.custom.options = o;\n        element.custom.updateGeneric(joinObjects({}, o, {\n          points,\n          drawBorder: border,\n          drawBorderBuffer: getBufferBorder(\n            [border],\n            o.drawBorderBuffer,\n            element.custom.skipConcave,\n            element.custom.bufferOffset,\n          ),\n          drawType,\n        }));\n      } else {\n        if (\n          o.line.widthIs == null\n        ) {\n          o.line.widthIs = 'mid';\n        }\n        if (element.custom.close) {\n          o.line.close = true;\n        }\n        let bufferOffsetToUse = 'negative';\n        if (element.custom.bufferOffset === 'positive' && o.line.close) {\n          o.line.drawBorder = 'positive';\n          bufferOffsetToUse = 'positive';\n        }\n        // console.log(o)\n        const [\n          polylineOptions, points, drawBorder, , drawType,\n        ] = element.custom.getLine(joinObjects(\n          {},\n          o.line,\n          {\n            points: border,\n          },\n        ));\n        element.custom.options = o;\n        element.custom.options.line = polylineOptions;\n        if (element.custom.bufferOffset === 'positive') {\n          drawBorder.reverse();\n        }\n        // const drawBorder = newDrawBorder;\n        // console.log(element.custom.bufferOffset)\n        // console.log(newDrawBorder)\n        // const drawBorder = [];\n        // for (let i = 0; i < newDrawBorder[0].length; i += 1) {\n        //   if (\n        //     i === 0\n        //     || (\n        //       i < newDrawBorder[0].length - 1\n        //       && drawBorder.slice(-1)[0].isNotEqualTo(newDrawBorder[0][i])\n        //     )\n        //     || (\n        //       i === newDrawBorder[0].length - 1\n        //       && drawBorder[0].isNotEqualTo(newDrawBorder[0][i])\n        //     )\n        //   ) {\n        //     drawBorder.push(newDrawBorder[0][i]);\n        //   }\n        // }\n        // console.log(drawBorder)\n        const drawBorderBuffer = getBufferBorder(\n          drawBorder,\n          o.drawBorderBuffer,\n          element.custom.skipConcave,\n          bufferOffsetToUse,\n        );\n        // console.log(drawBorder, drawBorderBuffer);\n        element.custom.updateGeneric(joinObjects({}, o, {\n          points, drawBorder, drawBorderBuffer, drawType,\n        }));\n      }\n    };\n    return element;\n  }\n\n  /**\n   * {@link FigureElementPrimitive} that draws a regular polygon.\n   * @see {@link OBJ_Polygon} for options and examples.\n   */\n  polygon(...options: Array<OBJ_Polygon>) {\n    const element = this.genericBase('polygon', {\n      radius: 1,\n      sides: 4,\n      direction: 1,\n      rotation: 0,\n      offset: new Point(0, 0),\n    }, joinObjects({}, ...options));\n    element.custom.getBorder = (o: OBJ_Polygon_Defined) => {\n      const border = this.getPolygonBorder(o);\n      if (o.sidesToDraw !== o.sides) {\n        element.custom.close = false;\n      } else {\n        element.custom.close = true;\n      }\n      element.custom.skipConcave = false;\n      if (o.direction === -1) {\n        element.custom.bufferOffset = 'positive';\n      } else {\n        element.custom.bufferOffset = 'negative';\n      }\n      return border;\n    };\n    element.custom.getFill = (border: Array<Point>, fillOptions: OBJ_Polygon_Defined) => [\n      getTrisFillPolygon(\n        fillOptions.offset,\n        border,\n        fillOptions.sides, fillOptions.sidesToDraw,\n      ),\n      'triangles',\n    ];\n    // element.custom.getLine = (o: OBJ_PolyLineTris) => this.getPolylineTris(o);\n\n    // $FlowFixMe\n    element.drawingObject.getPointCountForAngle = (angle: number) => {\n      const optionsToUse = element.custom.options;\n      const sidesToDraw = Math.floor(\n        tools.round(angle, 8) / tools.round(Math.PI * 2, 8) * optionsToUse.sides,\n      );\n      if (optionsToUse.line == null) {\n        return sidesToDraw * 3;\n      }\n      if (optionsToUse.line && optionsToUse.line.linePrimitives) {\n        return sidesToDraw * optionsToUse.line.lineNum * 2;\n      }\n      return sidesToDraw * 6;\n    };\n    element.custom.updatePoints(joinObjects({}, ...options));\n    return element;\n  }\n\n  /**\n   * {@link FigureElementPrimitive} that draws a star.\n   * @see {@link OBJ_Star} for options and examples.\n   */\n  star(...options: Array<OBJ_Star>) {\n    const element = this.genericBase('star', {\n      radius: 1,\n      sides: 5,\n      direction: 1,\n      rotation: 0,\n      offset: new Point(0, 0),\n    }, joinObjects({}, ...options));\n    element.custom.getBorder = (o: OBJ_Polygon_Defined) => {\n      if (o.innerRadius == null) {\n        o.innerRadius = o.radius / 3;\n      }\n      o.rotation += Math.PI / 2;\n      o.sidesToDraw = o.sides;\n      const result = this.getPolygonBorder(o);\n      result[0].rotation -= Math.PI / 2;\n      return result;\n    };\n    element.custom.getFill = (border: Array<Point>, fillOptions: OBJ_Polygon_Defined) => [\n      getTrisFillPolygon(\n        fillOptions.offset, border,\n        fillOptions.sides, fillOptions.sidesToDraw,\n      ),\n      'triangles',\n    ];\n\n    element.custom.updatePoints(joinObjects({}, ...options));\n    return element;\n  }\n\n  /**\n   * {@link FigureElementPrimitive} that draws a rectangle.\n   * @see {@link OBJ_Rectangle} for options and examples.\n   */\n  rectangle(...options: Array<OBJ_Rectangle>) {\n    const element = this.genericBase('rectangle', {\n      width: this.defaultLength,\n      height: this.defaultLength / 2,\n      xAlign: 'center',\n      yAlign: 'middle',\n      corner: {\n        radius: 0,\n        sides: 1,\n      },\n      offset: [0, 0],\n    }, joinObjects({}, ...options));\n\n    element.custom.getBorder = (o: OBJ_Rectangle_Defined) => {\n      if (o.line != null && o.line.widthIs === 'inside') {\n        o.line.widthIs = 'positive';\n      }\n      if (o.line != null && o.line.widthIs === 'outside') {\n        o.line.widthIs = 'negative';\n      }\n      if (o.offset != null) {\n        o.offset = getPoint(o.offset);\n      }\n      return [o, getRectangleBorder(o)];\n    };\n    element.custom.getFill = (border: Array<Point>) => [\n      rectangleBorderToTris(border),\n      'triangles',\n    ];\n    // element.custom.getLine = (o: OBJ_PolyLineTris) => this.getPolylineTris(o);\n    element.custom.updatePoints(joinObjects({}, ...options));\n    return element;\n  }\n\n  /**\n   * {@link FigureElementPrimitive} that draws an ellipse.\n   * @see {@link OBJ_Ellipse} for options and examples.\n   */\n  ellipse(...options: Array<OBJ_Ellipse>) {\n    const element = this.genericBase('ellipse', {\n      width: this.defaultLength,\n      height: this.defaultLength / 2,\n      xAlign: 'center',\n      yAlign: 'middle',\n      sides: 20,\n    }, joinObjects({}, ...options));\n\n    element.custom.getBorder = (o: OBJ_Ellipse_Defined) => {\n      if (o.line != null && o.line.widthIs === 'inside') {\n        o.line.widthIs = 'positive';\n      }\n      if (o.line != null && o.line.widthIs === 'outside') {\n        o.line.widthIs = 'negative';\n      }\n      return [o, getEllipseBorder(o)];\n    };\n    element.custom.getFill = (border: Array<Point>) => [\n      ellipseBorderToTris(border),\n      'triangles',\n    ];\n    // element.custom.getLine = (o: OBJ_PolyLineTris) => this.getPolylineTris(o);\n    element.custom.updatePoints(joinObjects({}, ...options));\n    return element;\n  }\n\n  /**\n   * {@link FigureElementPrimitive} that draws a triangle.\n   * @see {@link OBJ_Triangle} for options and examples.\n   */\n  triangle(...options: Array<OBJ_Triangle>) {\n    const element = this.genericBase('triangle', {\n      width: this.defaultLength,\n      height: this.defaultLength,\n      // xAlign: 'centroid',\n      // yAlign: 'centroid',\n      top: 'center',\n      direction: 1,\n      rotation: 0,\n    }, joinObjects({}, ...options));\n\n    element.custom.getBorder = (o: OBJ_Triangle_Defined) => {\n      if (o.xAlign == null) {\n        if (o.points != null) {\n          o.xAlign = 'points';\n        } else {\n          o.xAlign = 'centroid';\n        }\n      }\n      if (o.yAlign == null) {\n        if (o.points != null) {\n          o.yAlign = 'points';\n        } else {\n          o.yAlign = 'centroid';\n        }\n      }\n      // if (o.line != null && o.line.widthIs === 'inside') {\n      //   o.line.widthIs = 'positive';\n      // }\n      // if (o.line != null && o.line.widthIs === 'outside') {\n      //   o.line.widthIs = 'negative';\n      // }\n      // if (o.direction === -1) {\n      //   element.custom.bufferOffset = 'positive';\n      // } else {\n      //   element.custom.bufferOffset = 'negative';\n      // }\n      const border = getTriangleBorder(o);\n      if (o.direction === -1 || getTriangleDirection(border) === -1) {\n        border.reverse();\n      }\n\n      return [o, border];\n    };\n\n    // element.custom.getBorder = (o: OBJ_Triangle_Defined) => [\n    //   o, ...getTriangleBorder(o),\n    // ];\n    element.custom.getFill = (border: Array<Point>) => [\n      border,\n      'triangles',\n    ];\n    element.custom.updatePoints(joinObjects({}, ...options));\n    return element;\n  }\n\n  /**\n   * {@link FigureElementPrimitive} that draws a line.\n   * @see {@link OBJ_Arrow} for options and examples.\n   */\n  arrow(...options: Array<OBJ_Arrow>) {\n    const element = this.genericBase('arrow', {\n      length: this.defaultLength / 2,\n      width: this.defaultLength / 2,\n      head: 'triangle',\n      sides: 20,\n      radius: this.defaultLength / 4,\n      rotation: 0,\n      angle: 0,\n      tail: false,\n      drawPosition: new Point(0, 0),\n      // barb: this.defaultLength / 8,\n    }, joinObjects({}, ...options));\n\n    element.custom.getBorder = (o: OBJ_Triangle_Defined) => {\n      if (o.line != null && o.line.widthIs === 'inside') {\n        o.line.widthIs = 'positive';\n      }\n      if (o.line != null && o.line.widthIs === 'outside') {\n        o.line.widthIs = 'negative';\n      }\n      const optionsWithDefaultArrow = defaultArrowOptions(o);\n      const [border, borderBuffer] = getArrow(optionsWithDefaultArrow);\n      return [\n        optionsWithDefaultArrow, border, borderBuffer,\n      ];\n    };\n    element.custom.getFill = (border: Array<Point>, o: Object) => [\n      getArrowTris(border, o),\n      'triangles',\n    ];\n    element.custom.updatePoints(joinObjects({}, ...options));\n    return element;\n  }\n\n  /**\n   * {@link FigureElementPrimitive} that draws a grid.\n   * @see {@link OBJ_Grid} for options and examples.\n   */\n  grid(...optionsIn: Array<OBJ_Grid>) {\n    const element = this.generic({\n      transform: new Transform('grid').standard(),\n      border: 'draw',\n      touchBorder: 'border', // $FlowFixMe\n      holeBorder: [[]],\n    }, ...optionsIn);\n\n    element.custom.options = {\n      bounds: new Rect(\n        this.limits.left + this.limits.width / 4,\n        this.limits.bottom + this.limits.height / 4,\n        this.limits.width / 2, this.limits.height / 2,\n      ),\n      line: {\n        linePrimitives: false,\n        width: this.defaultLineWidth,\n        lineNum: 2,\n        dash: [],\n      },\n    };\n\n    const getTris = points => makePolyLine(\n      points,\n      element.custom.options.line.width,\n      false,\n      'mid',\n      'auto', // cornerStyle doesn't matter\n      0.1,    // cornerSize doesn't matter\n      1,      // cornerSides,\n      Math.PI / 7, // minAutoCornerAngle,\n      element.custom.options.line.dash,\n      element.custom.options.line.linePrimitives,\n      element.custom.options.line.lineNum,\n      [[]],\n      0,\n    );\n\n    element.custom.updatePoints = (updateOptions: Object) => {\n      const o = joinObjects({}, element.custom.options, updateOptions);\n      element.custom.options = o;\n      // Prioritize Num over Step. Only define Num from Step if Num is undefined.\n      const bounds = getRect(o.bounds);\n      let {\n        xStep, xNum, yStep, yNum,\n      } = o;\n      let { width } = o.line;\n      if (o.line.linePrimitives && o.line.lineNum === 1) {\n        width = 0;\n      }\n      const totWidth = bounds.width;\n      const totHeight = bounds.height;\n      if (xStep != null && xNum == null) {\n        xNum = xStep === 0 ? 1 : 1 + Math.floor((totWidth + xStep * 0.1) / xStep);\n      }\n      if (yStep != null && yNum == null) {\n        yNum = yStep === 0 ? 1 : 1 + Math.floor((totHeight + yStep * 0.1) / yStep);\n      }\n\n      if (xNum == null) {\n        xNum = 2;\n      }\n      if (yNum == null) {\n        yNum = 2;\n      }\n      xStep = xNum < 2 ? 0 : totWidth / (xNum - 1);\n      yStep = yNum < 2 ? 0 : totHeight / (yNum - 1);\n\n      const start = new Point(\n        bounds.left,\n        bounds.bottom,\n      );\n      const xLineStart = start.add(-width / 2, 0);\n      const xLineStop = start.add(totWidth + width / 2, 0);\n      const yLineStart = start.add(0, -width / 2);\n      const yLineStop = start.add(0, totHeight + width / 2);\n\n      let xTris = [];\n      let yTris = [];\n      if (xNum > 0) {\n        const [yLine] = getTris([yLineStart, yLineStop]);\n        yTris = copyPoints(yLine, [\n          { along: 'x', num: xNum - 1, step: xStep },\n        ]);\n      }\n\n      if (yNum > 0) {\n        const [xLine] = getTris([xLineStart, xLineStop]);\n        xTris = copyPoints(xLine, [\n          { along: 'y', num: yNum - 1, step: yStep },\n        ]);\n      }\n      const border = [\n        start.add(-width / 2, -width / 2),\n        start.add(totWidth + width / 2, -width / 2),\n        start.add(totWidth + width / 2, totHeight + width / 2),\n        start.add(-width / 2, totHeight + width / 2),\n      ];\n      let drawBorder;\n      if (o.drawBorder != null) {\n        drawBorder = getBorder(o.drawBorder);\n      } else {\n        drawBorder = [border];\n      }\n      let { drawBorderBuffer } = o;\n      if (typeof o.drawBorderBuffer === 'number') {\n        drawBorderBuffer = drawBorder;\n        if (o.drawBorderBuffer !== 0) {\n          const buf = o.drawBorderBuffer;\n          drawBorderBuffer = [[\n            border[0].add(-buf, -buf),\n            border[1].add(buf, -buf),\n            border[2].add(buf, buf),\n            border[3].add(-buf, buf),\n          ]];\n        }\n      }\n      element.custom.updateGeneric(joinObjects({}, o, {\n        points: [...xTris, ...yTris],\n        drawBorder,\n        drawBorderBuffer,\n        drawType: o.line.linePrimitives ? 'lines' : 'triangles',\n      }));\n    };\n    element.custom.updatePoints(joinObjects({}, ...optionsIn));\n    return element;\n  }\n\n  /**\n   * {@link FigureElementPrimitive} that draws a line.\n   * @see {@link OBJ_Line} for options and examples.\n   */\n  line(...options: OBJ_Line) { // $FlowFixMe\n    const element = this.polyline(joinObjects(\n      {},\n      {\n        transform: new Transform('line').standard(),\n      },\n      ...options,\n      {\n        points: [[0, 0], [0, 1]],\n        dash: [],\n        arrow: null,\n      },\n    )); // $FlowFixMe\n    const joinedOptions = joinObjects({}, ...options);\n    element.custom.options = joinObjects(\n      {},\n      element.custom.options,\n      {\n        p1: [0, 0],\n        angle: 0,\n        length: this.defaultLength,\n        width: this.defaultLineWidth,\n      },\n    );\n\n    // element.custom.setupLine = (p, o) => {\n    //   if (o.dash.length > 1) {\n    //     const maxLength = p[0].distance(p[1]);\n    //     const dashCumLength = [];\n    //     let cumLength = 0;\n    //     if (o.dash) {\n    //       let dashToUse = o.dash;\n    //       let offset = 0;\n    //       if (o.dash % 2 === 1) {\n    //         dashToUse = o.dash.slice(1);\n    //         [offset] = o.dash;\n    //         // cumLength = offset;\n    //       }\n    //       while (cumLength < maxLength) {\n    //         for (let i = 0; i < dashToUse.length && cumLength < maxLength; i += 1) {\n    //           let length = dashToUse[i];\n    //           if (length + cumLength > maxLength) {\n    //             length = maxLength - cumLength;\n    //           }\n    //           cumLength += length;\n    //           dashCumLength.push(cumLength);\n    //         }\n    //       }\n    //       element.custom.dashCumLength = dashCumLength;\n    //       element.custom.maxLength = maxLength;\n    //     }\n    //   }\n    // };\n\n    element.custom.updatePolyline = element.custom.updatePoints;\n    element.custom.updatePoints = (updateOptions) => {\n      const o = joinObjects({}, element.custom.options, updateOptions);\n      const [updatedPoints, updatedBorder, updatedTouchBorder] = getLine(o);\n      // element.custom.setupLine(updatedPoints, o);\n      element.custom.updatePolyline(joinObjects({}, o, {\n        points: updatedPoints,\n        border: updatedBorder,\n        touchBorder: updatedTouchBorder,\n        holeBorder: o.holeBorder,\n      }));\n    };\n    // element.drawingObject.getPointCountForLength = (drawLength: number = this.maxLength) => {\n    //   if (drawLength >= element.custom.maxLength) { // $FlowFixMe\n    //     return element.drawingObject.numPoints;\n    //   }\n    //   if (drawLength < element.custom.dashCumLength[0]) {\n    //     return 0;\n    //   }\n    //   for (let i = 0; i < element.custom.dashCumLength.length; i += 1) {\n    //     const cumLength = element.custom.dashCumLength[i];\n    //     if (cumLength > drawLength) {\n    //       return (Math.floor((i - 1) / 2) + 1) * 6;\n    //     }\n    //   } // $FlowFixMe\n    //   return element.drawingObject.numPoints;\n    // };\n\n    element.custom.updatePoints(joinedOptions);\n    return element;\n  }\n\n\n  textGL(options: Object) {\n    return Text(\n      this.webgl,\n      this.limits,\n      options,\n    );\n  }\n\n\n  /*\n  .......########.########.##.....##.########\n  ..........##....##........##...##.....##...\n  ..........##....##.........##.##......##...\n  ..........##....######......###.......##...\n  ..........##....##.........##.##......##...\n  ..........##....##........##...##.....##...\n  ..........##....########.##.....##....##...\n  */\n  // eslint-disable-next-line class-methods-use-this\n  parseTextOptions(...optionsIn: Object) {\n    const defaultOptions = {\n      text: '',\n      font: {\n        family: this.defaultFont.family,\n        style: this.defaultFont.style,\n        size: this.defaultFont.size,\n        weight: this.defaultFont.weight,\n      },\n      xAlign: 'left',\n      yAlign: 'baseline',\n      border: 'draw',\n      touchBorder: 'buffer',\n      defaultTextTouchBorder: 0,\n    };\n    const options = joinObjects({}, defaultOptions, ...optionsIn);\n\n    // Make default color\n    if (options.color == null && options.font.color != null) {\n      options.color = options.font.color;\n    }\n    if (options.font.color == null && options.color != null) {\n      options.font.color = options.color;\n    }\n    if (options.color == null) {\n      options.color = this.defaultFont.color;\n    }\n\n    // // Define standard transform if no transform was input\n    // if (options.transform == null) {\n    //   options.transform = new Transform('text').standard();\n    // } else {\n    //   options.transform = getTransform(options.transform);\n    // }\n\n    // // Override transform if position is defined\n    // if (options.position != null) {\n    //   const p = getPoint(options.position);\n    //   options.transform.updateTranslation(p);\n    // }\n\n    if (options.text != null && !Array.isArray(options.text)) {\n      options.text = [options.text];\n    }\n    if (options.line != null && !Array.isArray(options.line)) {\n      options.line = [options.line];\n    }\n    if (options.lines != null && !Array.isArray(options.lines)) {\n      options.lines = [options.lines];\n    }\n\n    if (options.touchBorder != null && Array.isArray(options.touchBorder)) {\n      // parsePoints(options, ['touchBorder']);\n      options.touchBorder = getBorder(options.touchBorder);\n    }\n\n    if (options.border != null && Array.isArray(options.border)) {\n      // parsePoints(options, ['border']);\n      options.border = getBorder(options.border);\n    }\n\n    return options;\n  }\n\n  genericTextPrimitive(\n    drawingObject: DrawingObject, optionsIn: Object,\n  ) {\n    const options = optionsIn;\n    // Define standard transform if no transform was input\n    if (options.transform == null) {\n      options.transform = new Transform('text').standard();\n    } else {\n      options.transform = getTransform(options.transform);\n    }\n\n    // Override transform if position is defined\n    if (options.position != null) {\n      const p = getPoint(options.position);\n      options.transform.updateTranslation(p);\n    }\n\n    const element = new FigureElementPrimitive(\n      drawingObject,\n      options.transform,\n      options.color,\n      this.limits,\n    );\n\n    setupPulse(element, options);\n    if (options.mods != null && options.mods !== {}) {\n      element.setProperties(options.mods);\n    }\n    element.custom.updateBorders = (o) => {\n      element.drawBorder = element.drawingObject.textBorder;\n      if (o.drawBorder != null) {\n        element.drawBorder = o.drawBorder;\n      }\n      element.drawBorderBuffer = element.drawingObject.textBorderBuffer;\n      if (o.drawBorderBuffer != null) {\n        element.drawBorderBuffer = o.drawBorderBuffer;\n      }\n      if (o.border != null) {\n        element.border = o.border;\n      }\n      if (o.touchBorder != null) {\n        element.touchBorder = o.touchBorder;\n      }\n    }; // $FlowFixMe\n    element.getBorderPointsSuper = element.getBorderPoints; // $FlowFixMe\n    element.getBorderPoints = (border: 'border' | 'touchBorder' | 'holeBorder' = 'border') => {\n      if (border === 'border') { // $FlowFixMe\n        return element.getBorderPointsSuper(border);\n      }\n      if (border === 'touchBorder') {\n        if (element.touchBorder === 'draw') {\n          return element.drawBorder;\n        }\n        if (element.touchBorder === 'buffer') {\n          return element.drawBorderBuffer;\n        }\n        if (element.touchBorder === 'border') {\n          return element.getBorderPoints('border');\n        }\n        if (element.touchBorder === 'rect') {\n          return [getBoundingBorder(element.drawBorderBuffer)];\n        }\n        if (isBuffer(element.touchBorder)) {\n          const b = element.drawBorderBuffer; // $FlowFixMe\n          return [getBoundingBorder(b, element.touchBorder)];\n        }\n        return element.touchBorder;\n      }\n      return element.holeBorder;\n    };\n    element.custom.setText = (o: string | OBJ_TextDefinition, index: number = 0) => {\n      element.drawingObject.setText(o, index);\n      element.custom.updateBorders({});\n    };\n    return element;\n  }\n\n  /**\n   * {@link FigureElementPrimitive} that draws a line of text.\n   * @see {@link OBJ_TextLine} for options and examples.\n   */\n  textLine(...optionsIn: Array<OBJ_TextLine>) {\n    const options = this.parseTextOptions({ border: 'rect', touchBorder: 'rect' }, ...optionsIn);\n    const to = new TextLineObject(this.draw2D);\n    to.loadText(options);\n    const element = this.genericTextPrimitive(to, options);\n    element.custom.options = to;\n    element.custom.updateText = (o: OBJ_Text) => { // $FlowFixMe\n      element.drawingObject.clear();\n      const parsed = this.parseTextOptions(\n        { border: 'rect', touchBorder: 'rect' },\n        element.custom.options,\n        o,\n      ); // $FlowFixMe\n      element.drawingObject.loadText(parsed);\n      element.custom.options = parsed;\n      element.custom.updateBorders({});\n    };\n    element.custom.updateBorders(options);\n    return element;\n  }\n\n  /**\n   * {@link FigureElementPrimitive} that draws text lines.\n   * @see {@link OBJ_TextLines} for options and examples.\n   */\n  textLines(...optionsIn: Array<OBJ_TextLines | string>) {\n    const joinedOptions = joinObjects({}, ...optionsIn);\n    const to = new TextLinesObject(this.draw2D);\n    const element = this.genericTextPrimitive(to, joinedOptions);\n    element.custom.options = joinedOptions;\n    element.custom.updateText = (oIn: OBJ_Text) => {\n      // $FlowFixMe\n      element.drawingObject.clear();\n      let oToUse = oIn; // $FlowFixMe\n      if (oIn.length === 1 && typeof oIn[0] === 'string') {\n        oToUse = [{ text: [optionsIn[0]] }];\n      }\n      const o = this.parseTextOptions(\n        { border: 'rect', touchBorder: 'rect' },\n        element.custom.options,\n        oToUse,\n      );\n      if (o.justify == null) {\n        o.justify = 'left';\n      }\n      if (o.lineSpace == null) {\n        o.lineSpace = o.font.size * 1.2;\n      }\n      element.custom.options = o;  // $FlowFixMe\n      element.drawingObject.loadText(o);\n      element.custom.updateBorders(o);\n    };\n    element.custom.updateText(joinedOptions);\n    return element;\n  }\n\n  /**\n   * {@link FigureElementPrimitive} that draws text.\n   * @see {@link OBJ_Text} for options and examples.\n   */\n  text(...optionsIn: Array<OBJ_Text>) {\n    const options = this.parseTextOptions(...optionsIn);\n    const to = new TextObject(\n      this.draw2D,\n    );\n    to.loadText(options);\n    const element = this.genericTextPrimitive(to, options);\n    element.custom.options = options;\n    element.custom.updateText = (o: OBJ_Text) => { // $FlowFixMe\n      element.drawingObject.clear(); // $FlowFixMe\n      element.drawingObject.loadText(this.parseTextOptions(element.custom.options, o));\n      element.custom.updateBorders({});\n    };\n    element.custom.updateBorders(options);\n    return element;\n  }\n\n  html(optionsIn: {\n    element: HTMLElement | Array<HTMLElement>,\n    classes?: string,\n    position?: TypeParsablePoint,\n    xAlign?: 'left' | 'right' | 'center',\n    yAlign?: 'top' | 'bottom' | 'middle',\n    wrap?: boolean,\n    id?: string,\n  }) {\n    const defaultOptions = {\n      classes: '',\n      position: [0, 0],\n      xAlign: 'center',\n      yAlign: 'middle',\n      wrap: true,\n      id: `id__temp_${Math.round(Math.random() * 10000)}`,\n    };\n    const options = joinObjects({}, defaultOptions, optionsIn);\n    options.element = optionsIn.element;\n    let element;\n    let parent;\n    if (options.wrap || Array.isArray(options.element)) {\n      element = document.createElement('div');\n      element.setAttribute('id', options.id);\n      if (Array.isArray(options.element)) {\n        options.element.forEach(e => element.appendChild(e));\n      } else {\n        element.appendChild(options.element);\n      }\n      this.htmlCanvas.appendChild(element);\n      parent = this.htmlCanvas;\n    } else {\n      element = options.element;\n      const id = element.getAttribute('id');\n      if (id === '') {\n        element.setAttribute('id', options.id);\n      } else {\n        options.id = id;\n      }\n      parent = element.parentElement;\n    }\n    if (parent == null) {\n      parent = this.htmlCanvas;\n    }\n\n    const hT = new HTMLObject(  // $FlowFixMe\n      parent,\n      options.id,\n      new Point(0, 0),\n      options.yAlign,\n      options.xAlign,\n    );\n    const p = getPoint(options.position);\n    const figureElement = new FigureElementPrimitive(\n      hT,\n      new Transform().scale(1, 1).translate(p.x, p.y),\n      [1, 1, 1, 1],\n      this.limits,\n    );\n    return figureElement;\n  }\n\n  htmlElement(\n    elementToAdd: HTMLElement | Array<HTMLElement>,\n    id: string = `id__temp_${Math.round(Math.random() * 10000)}`,\n    classes: string = '',\n    location: Point = new Point(0, 0),\n    yAlign: 'top' | 'bottom' | 'middle' = 'middle',\n    xAlign: 'left' | 'right' | 'center' = 'left',\n  ) {\n    const element = document.createElement('div');\n    if (classes && element) {\n      const classArray = classes.split(' ');\n      classArray.forEach(c => element.classList.add(c.trim()));\n    }\n    if (Array.isArray(elementToAdd)) {\n      elementToAdd.forEach(e => element.appendChild(e));\n    } else {\n      element.appendChild(elementToAdd);\n    }\n    element.style.position = 'absolute';\n    element.setAttribute('id', id);\n    this.htmlCanvas.appendChild(element);\n    const hT = new HTMLObject(this.htmlCanvas, id, new Point(0, 0), yAlign, xAlign);\n    const figureElement = new FigureElementPrimitive(\n      hT,\n      new Transform().scale(1, 1).translate(location.x, location.y),\n      [1, 1, 1, 1],\n      this.limits,\n    );\n    // console.log('html', figureElement.transform.mat, location)\n    // figureElement.setFirstTransform();\n    return figureElement;\n  }\n\n  // htmlText(\n  //   textInput: string,\n  //   id: string = generateUniqueId('id__html_text_'),\n  //   classes: string = '',\n  //   location: Point = new Point(0, 0),\n  //   yAlign: 'top' | 'bottom' | 'middle' = 'middle',\n  //   xAlign: 'left' | 'right' | 'center' = 'left',\n  // ) {\n  //   // const inside = document.createTextNode(textInput);\n  //   const inside = document.createElement('div');\n  //   inside.innerHTML = textInput;\n  //   return this.htmlElement(inside, id, classes, location, yAlign, xAlign);\n  // }\n\n  htmlImage(...optionsIn: Array<{\n    id?: string,\n    classes?: string,\n    position?: Point,\n    yAlign?: 'top' | 'bottom' | 'middle',\n    xAlign?: 'left' | 'right' | 'center',\n    src?: string,\n    color?: TypeColor,\n    pulse?: number,\n  }>) {\n    const defaultOptions = {\n      id: generateUniqueId('id__html_image_'),\n      classes: '',\n      position: new Point(0, 0),\n      yAlign: 'middle',\n      xAlign: 'left',\n      src: '',\n      // color: this.defaultColor,\n    };\n    const options = joinObjects({}, defaultOptions, ...optionsIn);\n    const image = document.createElement('img');\n    image.src = options.src;\n\n    // setHTML(inside, options.text, options.modifiers);\n    const {\n      id, classes, position, yAlign, xAlign,\n    } = options;\n    const element = this.htmlElement(image, id, classes, getPoint(position), yAlign, xAlign);\n    if (options.color != null) {\n      element.setColor(options.color);\n    }\n    // if (options.pulse != null) {\n    //   if (typeof element.pulseDefault !== 'function') {\n    //     element.pulseDefault.scale = options.pulse;\n    //   }\n    // }\n    setupPulse(element, options);\n    return element;\n  }\n\n  htmlText(...optionsIn: Array<{\n    textInput?: string,\n    id?: string,\n    classes?: string,\n    position?: Point,\n    yAlign?: 'top' | 'bottom' | 'middle',\n    xAlign?: 'left' | 'right' | 'center',\n    modifiers: Object;\n    color?: TypeColor,\n    pulse?: number,\n  }>) {\n    const defaultOptions = {\n      text: '',\n      id: generateUniqueId('id__html_text_'),\n      classes: '',\n      position: new Point(0, 0),\n      yAlign: 'middle',\n      xAlign: 'left',\n      // color: this.defaultColor,\n    };\n    const options = joinObjects({}, defaultOptions, ...optionsIn);\n    const inside = document.createElement('div');\n    // const htmlText = toHTML(options.textInput, '', '', options.color);\n    // console.log(options.textInput, htmlText)\n    setHTML(inside, options.text, options.modifiers);\n    const {\n      id, classes, position, yAlign, xAlign,\n    } = options;\n    const element = this.htmlElement(inside, id, classes, getPoint(position), yAlign, xAlign);\n    if (options.color != null) {\n      element.setColor(options.color);\n    }\n    setupPulse(element, options);\n    return element;\n  }\n\n  // lines(\n  //   linePairs: Array<Array<Point>>,\n  //   numLinesThick: number = 1,\n  //   color: TypeColor,\n  //   transform: Transform | Point = new Transform(),\n  // ) {\n  //   return Lines(this.webgl, linePairs, numLinesThick, color, transform, this.limits);\n  // }\n\n  // gridLegacy(...optionsIn: Array<TypeGridOptions>) {\n  //   const defaultOptions = {\n  //     bounds: new Rect(-1, -1, 2, 2),\n  //     xStep: 0.1,\n  //     yStep: 0.1,\n  //     xOffset: 0,\n  //     yOffset: 0,\n  //     numLinesThick: 1,\n  //     color: this.defaultColor,\n  //     position: null,\n  //     transform: new Transform('grid').standard(),\n  //   };\n  //   const options = joinObjects({}, defaultOptions, ...optionsIn);\n  //   if (options.position != null) {\n  //     const point = getPoint(options.position);\n  //     options.transform.updateTranslation(point);\n  //   }\n  //   const linePairs = [];\n  //   // const xLimit = tools.roundNum(bounds.righ + xStep);\n  //   const {\n  //     bounds, xStep, xOffset, yStep, yOffset, color, numLinesThick, transform,\n  //   } = options;\n  //   if (options.xStep !== 0) {\n  //     for (let x = bounds.left + xOffset; tools.roundNum(x, 8) <= bounds.right; x += xStep) {\n  //       linePairs.push([new Point(x, bounds.top), new Point(x, bounds.bottom)]);\n  //     }\n  //   }\n  //   if (yStep !== 0) {\n  //     for (let y = bounds.bottom + yOffset; tools.roundNum(y, 8) <= bounds.top; y += yStep) {\n  //       linePairs.push([new Point(bounds.left, y), new Point(bounds.right, y)]);\n  //     }\n  //   }\n  //   const element = this.lines(linePairs, numLinesThick, color, transform);\n  //   if (options.pulse != null && typeof element.pulseDefault !== 'function') {\n  //     element.pulseDefault.scale = options.pulse;\n  //   }\n  //   return element;\n  // }\n\n  // horizontalLine(\n  //   start: Point,\n  //   length: number,\n  //   width: number,\n  //   rotation: number,\n  //   color: TypeColor,\n  //   transform: Transform | Point = new Transform(),\n  // ) {\n  //   return HorizontalLine(\n  //     this.webgl, start, length, width,\n  //     rotation, color, transform, this.limits,\n  //   );\n  // }\n\n  // dashedLine(...optionsIn: Array<{\n  //   start?: Point,\n  //   length?: number,\n  //   width?: number,\n  //   rotation?: number,\n  //   dashStyle?: Array<number>,\n  //   color?: TypeColor,\n  //   transform?: Transform,\n  //   position?: Point,\n  //   pulse?: number,\n  // }>) {\n  //   const defaultOptions = {\n  //     start: [0, 0],\n  //     length: 1,\n  //     width: 0.01,\n  //     rotation: 0,\n  //     dashStyle: [0.1, 0.1],\n  //     transform: new Transform('dashedLine').scale(1, 1).rotate(0).translate(0, 0),\n  //     position: null,\n  //   };\n  //   const options = joinObjects({}, defaultOptions, ...optionsIn);\n  //   if (options.position != null) {\n  //     options.transform.updateTranslation(getPoint(options.position));\n  //   }\n  //   const element = DashedLine(\n  //     this.webgl, getPoint(options.start), options.length, options.width,\n  //     options.rotation, options.dashStyle, options.color,\n  //     options.transform, this.limits,\n  //   );\n  //   setupPulse(element, options);\n  //   return element;\n  // }\n\n  // dashedLine(\n  //   start: Point,\n  //   length: number,\n  //   width: number,\n  //   rotation: number,\n  //   dashStyle: Array<number>,\n  //   color: TypeColor,\n  //   transform: Transform | Point = new Transform(),\n  // ) {\n  //   return DashedLine(\n  //     this.webgl, start, length, width,\n  //     rotation, dashStyle, color, transform, this.limits,\n  //   );\n  // }\n\n  // box(...optionsIn: Array<{\n  //   width?: number,\n  //   height?: number,\n  //   fill?: boolean,\n  //   lineWidth?: number,\n  //   colors?: Array<number>,\n  //   transform?: Transform,\n  //   position?: TypeParsablePoint,\n  //   pulse?: number,\n  // }>) {\n  //   const defaultOptions = {\n  //     width: 1,\n  //     height: 1,\n  //     fill: false,\n  //     lineWidth: 0.01,\n  //     color: this.defaultColor,\n  //     transform: new Transform().scale(1, 1).rotate(0).translate(0, 0),\n  //     position: null,\n  //   };\n  //   const options = joinObjects({}, defaultOptions, ...optionsIn);\n  //   if (options.position != null) {\n  //     options.transform.updateTranslation(getPoint(options.position));\n  //   }\n  //   if (typeof options.reference !== 'string') {\n  //     options.reference = getPoint(options.reference);\n  //   }\n  //   const element = Box(\n  //     this.webgl, options.width, options.height, options.lineWidth,\n  //     options.fill, options.color, options.transform, this.limits,\n  //   );\n  //   setupPulse(element, options);\n\n  //   return element;\n  // }\n\n  // radialLines(...optionsIn: Array<{\n  //   innerRadius?: number,\n  //   outerRadius?: number,\n  //   width?: number,\n  //   dAngle?: number,\n  //   angle?: number,\n  //   color?: TypeColor,\n  //   transform?: Transform,\n  //   position?: Point,\n  //   pulse?: number,\n  // }>) {\n  //   const defaultOptions = {\n  //     innerRadius: 0,\n  //     outerRadius: 1,\n  //     width: 0.05,\n  //     dAngle: Math.PI / 4,\n  //     angle: Math.PI * 2,\n  //     transform: new Transform().standard(),\n  //   };\n  //   const options = joinObjects({}, defaultOptions, ...optionsIn);\n  //   if (options.position != null) {\n  //     options.transform.updateTranslation(getPoint(options.position));\n  //   }\n  //   const element = RadialLines(\n  //     this.webgl, options.innerRadius, options.outerRadius,\n  //     options.width, options.dAngle, options.angle, options.color,\n  //     options.transform, this.limits,\n  //   );\n\n  //   setupPulse(element, options);\n\n\n  //   return element;\n  // }\n\n  // repeatPatternVertex(...optionsIn: Array<TypeRepeatPatternVertex>) {\n  //   const defaultOptions = {\n  //     element: null,\n  //     xNum: 2,\n  //     yNum: 2,\n  //     xStep: 1,\n  //     yStep: 1,\n  //     transform: new Transform('repeatPattern').standard(),\n  //   };\n  //   const options = joinObjects({}, defaultOptions, ...optionsIn);\n  //   if (options.position != null) {\n  //     options.transform.updateTranslation(getPoint(options.position));\n  //   }\n  //   const {\n  //     element, transform, xNum, yNum, xStep, yStep,\n  //   } = options;\n  //   if (element == null) {\n  //     return this.collection();\n  //   }\n  //   const copy = element._dup();\n  //   const { drawingObject } = element;\n  //   // console.log(element.drawingObject.points)\n  //   if (drawingObject instanceof VertexObject) {\n  //     copy.transform = transform._dup();\n  //     const newPoints = [];\n  //     const { points } = drawingObject;\n  //     for (let x = 0; x < xNum; x += 1) {\n  //       for (let y = 0; y < yNum; y += 1) {\n  //         for (let p = 0; p < points.length; p += 2) {\n  //           newPoints.push(new Point(\n  //             points[p] + x * xStep,\n  //             points[p + 1] + y * yStep,\n  //           ));\n  //           // console.log(points[p], points[p+1], newPoints.slice(-1))\n  //         }\n  //       }\n  //     }\n  //     // console.log(newPoints)\n  //     copy.drawingObject.changeVertices(newPoints);\n  //   }\n  //   if (options.pulse != null && typeof element.pulseDefault !== 'function') {\n  //     copy.pulseDefault.scale = options.pulse;\n  //   }\n  //   return copy;\n  // }\n\n  // repeatPattern(\n  //   element: FigureElementPrimitive,\n  //   xNum: number,\n  //   yNum: number,\n  //   xStep: number,\n  //   yStep: number,\n  //   transform: Transform | Point = new Transform(),\n  // ) {\n  //   let group;\n  //   if (transform instanceof Transform) {\n  //     group = this.collection({ transform });\n  //   } else {\n  //     group = this.collection({ transform: new Transform().translate(transform) });\n  //   }\n  //   let t = element.transform.t();\n  //   let transformToUse = element.transform._dup();\n  //   if (t === null) {\n  //     t = new Point(0, 0);\n  //     transformToUse = transformToUse.translate(0, 0);\n  //   }\n  //   if (t) {\n  //     for (let x = 0; x < xNum; x += 1) {\n  //       for (let y = 0; y < yNum; y += 1) {\n  //         const copy = element._dup();\n  //         copy.transform = transformToUse._dup();\n  //         copy.transform.updateTranslation(t.x + xStep * x, t.y + yStep * y);\n  //         group.add(`xy${x}${y}`, copy);\n  //       }\n  //     }\n  //   }\n  //   return group;\n  // }\n\n  // eslint-disable-next-line class-methods-use-this\n  // repeatPatternVertexLegacy(\n  //   element: FigureElementPrimitive,\n  //   xNum: number,\n  //   yNum: number,\n  //   xStep: number,\n  //   yStep: number,\n  //   transform: Transform | Point = new Transform(),\n  // ) {\n  //   const copy = element._dup();\n  //   const { drawingObject } = element;\n  //   // console.log(element.drawingObject.points)\n  //   if (drawingObject instanceof VertexObject) {\n  //     copy.transform = transform._dup();\n  //     const newPoints = [];\n  //     const { points } = drawingObject;\n  //     for (let x = 0; x < xNum; x += 1) {\n  //       for (let y = 0; y < yNum; y += 1) {\n  //         for (let p = 0; p < points.length; p += 2) {\n  //           newPoints.push(new Point(\n  //             points[p] + x * xStep,\n  //             points[p + 1] + y * yStep,\n  //           ));\n  //           // console.log(points[p], points[p+1], newPoints.slice(-1))\n  //         }\n  //       }\n  //     }\n  //     // console.log(newPoints)\n  //     copy.drawingObject.changeVertices(newPoints);\n  //   }\n  //   return copy;\n  // }\n\n  //   axes(...optionsIn: Array<{\n  //     width?: number,\n  //     height?: number,\n  //     limits?: Rect,\n  //     yAxisLocation?: number,\n  //     xAxisLocation?: number,\n  //     stepX?: number,\n  //     stepY?: number,\n  //     fontSize?: number,\n  //     showGrid?: boolean,\n  //     color?: TypeColor,\n  //     fontColor?: Array<number>,\n  //     gridColor?: Array<number>,\n  //     location?: Transform | Point,\n  //     decimalPlaces?: number,\n  //     lineWidth?: number,\n  //     pulse?: number,\n  //   }>) {\n  //     const defaultOptions = {\n  //       width: 1,\n  //       height: 1,\n  //       limits: new Rect(-1, -1, 2, 2),\n  //       yAxisLocation: 0,\n  //       xAxisLocation: 0,\n  //       stepX: 0.1,\n  //       stepY: 0.1,\n  //       fontSize: 0.13,\n  //       showGrid: true,\n  //       color: this.defaultColor,\n  //       location: new Transform(),\n  //       decimalPlaces: 1,\n  //       lineWidth: 0.01,\n  //     };\n  //     const options = joinObjects({}, defaultOptions, ...optionsIn);\n\n  //     if (options.fontColor == null) {\n  //       options.fontColor = options.color.slice();\n  //     }\n  //     if (options.gridColor == null) {\n  //       options.gridColor = options.color.slice();\n  //     }\n\n  //     const {\n  //       width, lineWidth, limits, color, stepX, decimalPlaces,\n  //       yAxisLocation, xAxisLocation, fontSize, height, stepY,\n  //       location, showGrid, gridColor, fontColor,\n  //     } = options;\n\n  //     const xProps = new AxisProperties('x', 0);\n\n  //     xProps.minorTicks.mode = 'off';\n  //     xProps.minorGrid.mode = 'off';\n  //     xProps.majorGrid.mode = 'off';\n\n  //     xProps.length = width;\n  //     xProps.width = lineWidth;\n  //     xProps.limits = { min: limits.left, max: limits.right };\n  //     xProps.color = color.slice();\n  //     xProps.title = '';\n\n  //     xProps.majorTicks.start = limits.left;\n  //     xProps.majorTicks.step = stepX;\n  //     xProps.majorTicks.length = lineWidth * 5;\n  //     xProps.majorTicks.offset = -xProps.majorTicks.length / 2;\n  //     xProps.majorTicks.width = lineWidth * 2;\n  //     xProps.majorTicks.labelMode = 'off';\n  //     xProps.majorTicks.color = color.slice();\n  //     xProps.majorTicks.labels = tools.range(\n  //       xProps.limits.min,\n  //       xProps.limits.max,\n  //       stepX,\n  //     ).map(v => v.toFixed(decimalPlaces)).map((v) => {\n  //       if (v === yAxisLocation.toString() && yAxisLocation === xAxisLocation) {\n  //         return `${v}     `;\n  //       }\n  //       return v;\n  //     });\n\n  //     // xProps.majorTicks.labels[xProps.majorTicks.labels / 2] = '   0';\n  //     xProps.majorTicks.labelOffset = new Point(\n  //       0,\n  //       xProps.majorTicks.offset - fontSize * 0.1,\n  //     );\n  //     xProps.majorTicks.labelsHAlign = 'center';\n  //     xProps.majorTicks.labelsVAlign = 'top';\n  //     xProps.majorTicks.fontColor = fontColor.slice();\n  //     xProps.majorTicks.fontSize = fontSize;\n  //     xProps.majorTicks.fontWeight = '400';\n\n  //     const xAxis = new Axis(\n  //       this.webgl, this.draw2D, xProps,\n  //       new Transform().scale(1, 1).rotate(0)\n  //         .translate(0, xAxisLocation - limits.bottom * height / 2),\n  //       this.limits,\n  //     );\n\n  //     const yProps = new AxisProperties('x', 0);\n  //     yProps.minorTicks.mode = 'off';\n  //     yProps.minorGrid.mode = 'off';\n  //     yProps.majorGrid.mode = 'off';\n\n  //     yProps.length = height;\n  //     yProps.width = xProps.width;\n  //     yProps.limits = { min: limits.bottom, max: limits.top };\n  //     yProps.color = xProps.color;\n  //     yProps.title = '';\n  //     yProps.rotation = Math.PI / 2;\n\n  //     yProps.majorTicks.step = stepY;\n  //     yProps.majorTicks.start = limits.bottom;\n  //     yProps.majorTicks.length = xProps.majorTicks.length;\n  //     yProps.majorTicks.offset = -yProps.majorTicks.length / 2;\n  //     yProps.majorTicks.width = xProps.majorTicks.width;\n  //     yProps.majorTicks.labelMode = 'off';\n  //     yProps.majorTicks.color = color.slice();\n  //     yProps.majorTicks.labels = tools.range(\n  //       yProps.limits.min,\n  //       yProps.limits.max,\n  //       stepY,\n  //     ).map(v => v.toFixed(decimalPlaces)).map((v) => {\n  //       if (v === xAxisLocation.toString() && yAxisLocation === xAxisLocation) {\n  //         return '';\n  //       }\n  //       return v;\n  //     });\n\n  //     // yProps.majorTicks.labels[3] = '';\n  //     yProps.majorTicks.labelOffset = new Point(\n  //       yProps.majorTicks.offset - fontSize * 0.2,\n  //       0,\n  //     );\n  //     yProps.majorTicks.labelsHAlign = 'right';\n  //     yProps.majorTicks.labelsVAlign = 'middle';\n  //     yProps.majorTicks.fontColor = xProps.majorTicks.fontColor;\n  //     yProps.majorTicks.fontSize = fontSize;\n  //     yProps.majorTicks.fontWeight = xProps.majorTicks.fontWeight;\n\n  //     const yAxis = new Axis(\n  //       this.webgl, this.draw2D, yProps,\n  //       new Transform().scale(1, 1).rotate(0)\n  //         .translate(yAxisLocation - limits.left * width / 2, 0),\n  //       this.limits,\n  //     );\n\n  //     let transform = new Transform();\n  //     if (location instanceof Point) {\n  //       transform = transform.translate(location.x, location.y);\n  //     } else {\n  //       transform = location._dup();\n  //     }\n  //     const xy = this.collection(transform);\n  //     if (showGrid) {\n  //       const gridLines = this.grid({\n  //         bounds: new Rect(0, 0, width, height),\n  //         xStep: tools.roundNum(stepX * width / limits.width, 8),\n  //         yStep: tools.roundNum(stepY * height / limits.height, 8),\n  //         numThickLines: 1,\n  //         // linePrimitives: true,\n  //         // lineNum: 2,\n  //         width: options.lineWidth * 0.6,\n  //         color: gridColor,\n  //         transform: new Transform().scale(1, 1).rotate(0).translate(0, 0),\n  //       });\n  //       xy.add('grid', gridLines);\n  //     }\n  //     xy.add('y', yAxis);\n  //     xy.add('x', xAxis);\n  //     if (\n  //       options.pulse != null\n  //       && typeof xy.pulseDefault !== 'function'\n  //       && typeof xy.pulseDefault !== 'string'\n  //     ) {\n  //       xy.pulseDefault.scale = options.pulse;\n  //     }\n  //     return xy;\n  //   }\n\n  //   parallelMarks(...optionsIn: Array<{\n  //     num?: number,\n  //     width?: number,\n  //     length?: number,\n  //     angle?: number,\n  //     step?: number,\n  //     rotation?: number,\n  //     color?: TypeColor,\n  //     pulse?: number,\n  //     transform?: Transform,\n  //     position?: Point,\n  //   }>) {\n  //     const defaultOptions = {\n  //       width: 0.01,\n  //       num: 1,\n  //       length: 0.1,\n  //       angle: Math.PI / 4,\n  //       step: 0.04,\n  //       rotation: 0,\n  //       color: this.defaultColor,\n  //       transform: new Transform().scale(1, 1).rotate(0).translate(0, 0),\n  //       position: null,\n  //     };\n  //     const options = joinObjects({}, defaultOptions, ...optionsIn);\n  //     if (options.position != null) {\n  //       options.transform.updateTranslation(getPoint(options.position));\n  //     }\n\n  //     const x = options.length * Math.cos(options.angle);\n  //     const y = options.length * Math.sin(options.angle);\n  //     const wx = Math.abs(options.width * Math.cos(options.angle + Math.PI / 2));\n  //     const wy = options.width * Math.sin(options.angle + Math.PI / 2);\n  //     const single = [\n  //       new Point(0, 0),\n  //       new Point(0 - x, 0 - y),\n  //       new Point(-x - wx, -y + wy),\n  //       new Point(-Math.abs(options.width / Math.cos(options.angle + Math.PI / 2)), 0),\n  //       new Point(-x - wx, y - wy),\n  //       new Point(0 - x, 0 + y),\n  //     ];\n\n  //     const collection = this.collection(\n  //       options.transform,\n  //     );\n  //     collection.setColor(options.color);\n  //     if (\n  //       options.pulse != null\n  //       && typeof collection.pulseDefault !== 'function'\n  //       && typeof collection.pulseDefault !== 'string'\n  //     ) {\n  //       collection.pulseDefault.scale = options.pulse;\n  //     }\n\n  //     const start = -((options.num - 1) / 2) * options.step;\n  //     for (let i = 0; i < options.num; i += 1) {\n  //       const points = single.map(\n  //         p => (new Point(p.x + start + i * options.step, p.y)).rotate(options.rotation),\n  //       );\n  //       collection.add(`${i}`, this.fan({\n  //         points,\n  //         color: options.color,\n  //       }));\n  //     }\n  //     return collection;\n  //   }\n\n  //   marks(...optionsIn: Array<{\n  //     num?: number,\n  //     width?: number,\n  //     length?: number,\n  //     angle?: number,\n  //     step?: number,\n  //     rotation?: number,\n  //     color?: TypeColor,\n  //     pulse?: number,\n  //     transform?: Transform,\n  //     position?: Point,\n  //   }>) {\n  //     const defaultOptions = {\n  //       width: 0.01,\n  //       num: 1,\n  //       length: 0.2,\n  //       angle: Math.PI / 2,\n  //       step: 0.04,\n  //       rotation: 0,\n  //       color: this.defaultColor,\n  //       transform: new Transform().scale(1, 1).rotate(0).translate(0, 0),\n  //       position: null,\n  //     };\n  //     const options = joinObjects({}, defaultOptions, ...optionsIn);\n  //     if (options.position != null) {\n  //       options.transform.updateTranslation(getPoint(options.position));\n  //     }\n\n  //     const single = [\n  //       new Point(options.length / 2, options.width / 2),\n  //       new Point(options.length / 2, -options.width / 2),\n  //       new Point(-options.length / 2, -options.width / 2),\n  //       new Point(-options.length / 2, options.width / 2),\n  //     ];\n\n  //     const collection = this.collection(\n  //       options.transform,\n  //     );\n  //     collection.setColor(options.color);\n  //     if (\n  //       options.pulse != null\n  //       && typeof collection.pulseDefault !== 'function'\n  //       && typeof collection.pulseDefault !== 'string'\n  //     ) {\n  //       collection.pulseDefault.scale = options.pulse;\n  //     }\n\n  //     const start = -((options.num - 1) / 2) * options.step;\n  //     for (let i = 0; i < options.num; i += 1) {\n  //       const t = new Transform()\n  //         .rotate(options.angle)\n  //         .translate(start + i * options.step, 0)\n  //         .rotate(options.rotation);\n\n  //       const points = single.map(\n  //         p => (p._dup().transformBy(t.matrix())),\n  //       );\n  //       collection.add(`${i}`, this.fan({\n  //         points,\n  //         color: options.color,\n  //       }));\n  //     }\n  //     return collection;\n  //   }\n}\n\nexport type TypeFigurePrimitives = FigurePrimitives;\n","// @flow\n\nimport VertexGeneric from '../DrawingObjects/VertexObject/VertexGeneric';\nimport { FigureElementPrimitive } from '../Element';\nimport {\n  Point, Transform, Rect, getRect,\n} from '../../tools/g2';\nimport WebGLInstance from '../webgl/webgl';\n// import type { CPY_Step } from '../geometries/copy/copy';\nimport type { TypeColor } from '../../tools/types';\n\nexport default function Generic(\n  webgl: Array<WebGLInstance>,\n  // vertices: Array<Point>,\n  // border: Array<Array<Point>> | 'points' | 'rect',\n  // touchBorder: Array<Array<Point>> | 'rect' | 'border' | 'none',\n  // holeBorder: Array<Array<Point>> | 'none',\n  // drawType: 'triangles' | 'strip' | 'fan' | 'lines',\n  color: TypeColor,\n  transformOrLocation: Transform | Point,\n  figureLimits: Rect,\n  textureLocation: string = '',\n  textureVertexSpace: Rect = new Rect(-1, -1, 2, 2),\n  textureCoords: Rect = new Rect(0, 0, 1, 1),\n  textureRepeat: boolean = false,\n  onLoad: ?() => void = null,\n  // copy: Array<CPY_Step>,\n  name: string = '',\n) {\n  const generic = new VertexGeneric(\n    webgl,\n    // vertices,\n    // border,\n    // touchBorder,\n    // holeBorder,\n    // drawType,\n    textureLocation,\n    getRect(textureVertexSpace),\n    getRect(textureCoords),\n    textureRepeat,\n    // copy,\n  );\n  if (textureLocation) {\n    generic.onLoad = onLoad;\n  }\n  let transform = new Transform();\n  if (transformOrLocation instanceof Point) {\n    transform = transform.translate(transformOrLocation.x, transformOrLocation.y);\n  } else {\n    transform = transformOrLocation._dup();\n  }\n  // $FlowFixMe\n  return new FigureElementPrimitive(generic, transform, color, figureLimits, null, name);\n}\n","// @flow\n\nimport VertexText from '../DrawingObjects/VertexObject/VertexText';\nimport { FigureElementPrimitive } from '../Element';\nimport {\n  Point, Transform, Rect,\n} from '../../tools/g2';\nimport WebGLInstance from '../webgl/webgl';\nimport { joinObjects } from '../../tools/tools';\n\ntype TypeTextInputOptions = {\n  text: ?string;\n  size: ?number;\n  family: ?string;\n  weight: ?number;\n  style: ?'normal' | 'italic',\n  xAlign: ?'left' | 'center' | 'right',\n  yAlign: ?'top' | 'bottom' | 'middle' | 'baseline',\n  color: ?Array<number>,\n  transform: ?Transform,\n  position: ?Point,\n};\n\nfunction Text(\n  webgl: Array<WebGLInstance>,\n  figureLimits: Rect,\n  optionsIn: TypeTextInputOptions,\n) {\n  const defaultOptions = {\n    position: new Point(0, 0),\n    color: [1, 0, 0, 1],\n  };\n  const options = joinObjects({}, defaultOptions, optionsIn);\n\n  if (options.transform == null) {\n    options.transform = new Transform('Text').translate(0, 0);\n  }\n\n  if (options.position != null) {\n    options.transform.updateTranslation(options.position);\n  }\n\n  const vertexText = new VertexText(\n    webgl,\n    options,\n  );\n  // let transform = new Transform();\n  // if (transformOrLocation instanceof Point) {\n  //   transform = transform.translate(transformOrLocation.x, transformOrLocation.y);\n  // } else {\n  //   transform = transformOrLocation._dup();\n  // }\n  return new FigureElementPrimitive(vertexText, options.transform, options.color, figureLimits);\n}\n\nexport default Text;\n","// @flow\n\nimport { Point } from '../tools/g2';\nimport type Figure from './Figure';\n\nclass Gesture {\n  previousPoint: Point;\n  figure: Figure;\n  mouseDown: boolean;\n  enable: boolean;\n  start: (Point) => boolean;\n  end: void => void;\n  move: (Point, Point) => boolean;\n  free: (Point) => void;\n  toggleCursor: () => void;\n  binds: {\n    mouseDownHandler: (MouseEvent) => void,\n    mouseUpHandler: (MouseEvent) => void,\n    mouseMoveHandler: (MouseEvent) => void,\n    touchStartHandler: (TouchEvent) => void,\n    touchEndHandler: (TouchEvent) => void,\n    touchMoveHandler: (TouchEvent) => void,\n  };\n\n  constructor(figure: Figure) {\n    this.figure = figure;\n\n    // Override these if you want to use your own touch handlers\n    this.start = this.figure.touchDownHandler.bind(this.figure);\n    this.end = this.figure.touchUpHandler.bind(this.figure);\n    this.move = this.figure.touchMoveHandler.bind(this.figure);\n    this.free = this.figure.touchFreeHandler.bind(this.figure);\n    this.toggleCursor = this.figure.toggleCursor.bind(this.figure);\n\n    this.binds = {\n      mouseDownHandler: this.mouseDownHandler.bind(this),\n      mouseUpHandler: this.mouseUpHandler.bind(this),\n      mouseMoveHandler: this.mouseMoveHandler.bind(this),\n      touchStartHandler: this.touchStartHandler.bind(this),\n      touchEndHandler: this.touchEndHandler.bind(this),\n      touchMoveHandler: this.touchMoveHandler.bind(this),\n    };\n\n    this.addEvent('mousedown', this.binds.mouseDownHandler, false);\n    this.addEvent('mouseup', this.binds.mouseUpHandler, false);\n    this.addEvent('mousemove', this.binds.mouseMoveHandler, false);\n    this.addEvent('touchstart', this.binds.touchStartHandler, false);\n    this.addEvent('touchend', this.binds.touchEndHandler, false);\n    this.addEvent('touchmove', this.binds.touchMoveHandler, false);\n    this.enable = true;\n  }\n\n  addEvent(event: string, method: Object, flag: boolean) {\n    this.figure.gestureCanvas.addEventListener(\n      event,\n      method.bind(this),\n      flag,\n    );\n  }\n\n  removeEvent(event: string, method: Object, flag: boolean) {\n    this.figure.gestureCanvas.removeEventListener(\n      event,\n      method.bind(this),\n      flag,\n    );\n  }\n\n  startHandler(point: Point) {\n    if (this.enable) {\n      this.mouseDown = true;\n      this.previousPoint = point;\n      return this.start(point);\n    }\n    return false;\n  }\n\n  endHandler() {\n    this.mouseDown = false;\n    this.end();\n  }\n\n  moveHandler(event: MouseEvent | TouchEvent, point: Point) {\n    if (this.enable && this.mouseDown) {\n      const disableEvent = this.move(this.previousPoint, point);\n      if (disableEvent) {\n        event.preventDefault();\n      }\n      this.previousPoint = point;\n    } else {\n      this.free(point);\n    }\n  }\n\n  touchStartHandler(event: TouchEvent) {\n    const touch = event.touches[0];\n    const disableEvent = this.startHandler(new Point(touch.clientX, touch.clientY));\n    if (disableEvent) {\n      event.preventDefault();\n    }\n  }\n\n  mouseDownHandler(event: MouseEvent) {\n    const disableEvent = this.startHandler(new Point(event.clientX, event.clientY));\n    if (disableEvent) {\n      event.preventDefault();\n    }\n  }\n\n  touchMoveHandler(event: TouchEvent) {\n    const touch = event.touches[0];\n    this.moveHandler(event, new Point(touch.clientX, touch.clientY));\n  }\n\n  mouseMoveHandler(event: MouseEvent) {\n    this.moveHandler(event, new Point(event.clientX, event.clientY));\n  }\n\n  mouseUpHandler() {\n    this.endHandler();\n  }\n\n  touchEndHandler() {\n    this.endHandler();\n  }\n\n  destroy() {\n    this.removeEvent('mousedown', this.binds.mouseDownHandler, false);\n    this.removeEvent('mouseup', this.binds.mouseUpHandler, false);\n    this.removeEvent('mousemove', this.binds.mouseMoveHandler, false);\n    this.removeEvent('touchstart', this.binds.touchStartHandler, false);\n    this.removeEvent('touchend', this.binds.touchEndHandler, false);\n    this.removeEvent('touchmove', this.binds.touchMoveHandler, false);\n  }\n}\n\nexport default Gesture;\n","// @flow\n// import type { Transform } from '../tools/g2';\nimport { Point } from '../../tools/g2';\nimport { round } from '../../tools/math';\nimport {\n  duplicate, minify, unminify, joinObjects,\n  ObjectTracker, download, SubscriptionManager,\n} from '../../tools/tools';\nimport GlobalAnimation from '../webgl/GlobalAnimation';\n// import type { FigureElement } from './Element';\nimport Worker from './recorder.worker';\nimport type Figure from '../Figure';\nimport type { OBJ_ScenarioVelocity } from '../Animation/AnimationStep/ElementAnimationStep/ScenarioAnimationStep';\n// import GlobalAnimation from './webgl/GlobalAnimation';\n// Singleton class that contains projects global variables\n\ntype TypeStateDiff = [number, string, Object];\n\ntype TypeEvent = [\n  number,\n  (Array<number | string | Object> | string | number | Object),\n  number,\n];\ntype TypeEvents = Array<TypeEvent>;\ntype TypeStateDiffs = Array<TypeStateDiff>;\n\n\nexport type TypePauseSettings = 'freeze' | 'cancel' | 'complete' | 'animateToComplete' | 'dissolveToComplete';\n\nexport type TypePlaySettings = {\n  how: 'dissolve' | 'animate' | 'instant',\n  duration?: number | {\n    dissovlveOut: ?number,\n    dissovlveIn: ?number,\n    delay: ?number,\n  },\n  velocity?: OBJ_ScenarioVelocity,\n  maxDuration?: number,\n  // minDuration?: number,\n  zeroDurationThreshold?: boolean,\n  allDurationsSame?: boolean,\n} | 'dissolve' | 'animate' | 'instant';\n\nfunction getIndexOfEarliestTime(\n  recordedData: TypeEvents | TypeStateDiffs,\n  index: number,\n) {\n  if (index < 1) {\n    return index;\n  }\n  let i = index;\n  let same = true;\n  const time = recordedData[index][0];\n  while (i > 0 && same) {\n    const prevTime = recordedData[i - 1][0];\n    if (prevTime !== time) {\n      same = false;\n    } else {\n      i -= 1;\n    }\n  }\n  return i;\n}\n\nfunction getIndexOfLatestTime(\n  recordedData: TypeEvents | TypeStateDiffs,\n  index: number,\n) {\n  const time = recordedData[index][0];\n  let i = index;\n  let loop = true;\n  while (loop) {\n    if (i === recordedData.length - 1) {\n      loop = false;\n    } else if (recordedData[i + 1][0] === time) {\n      i += 1;\n    } else {\n      loop = false;\n    }\n  }\n  return Math.max(i, index);\n}\n\n\nfunction getIndexRangeForTime(\n  recordedData: TypeEvents | TypeStateDiffs,\n  time: number,\n  startSearch: number = 0,\n  endSearch: number = recordedData.length - 1,\n) {\n  if (recordedData.length === 0) {\n    return [-1, -1];\n  }\n  const startTime = parseFloat(recordedData[startSearch][0]);\n  if (time === startTime) {\n    return [startSearch, startSearch];\n  }\n  if (time < startTime) {\n    return [-1, startSearch];\n  }\n\n  const endTime = parseFloat(recordedData[endSearch][0]);\n  if (time === endTime) {\n    return [endSearch, endSearch];\n  }\n  if (time > endTime) {\n    return [endSearch, -1];\n  }\n\n  const searchRange = endSearch - startSearch;\n\n  if (searchRange < 2) {\n    return [startSearch, endSearch];\n  }\n\n  const midSearch = startSearch + Math.floor(searchRange / 2);\n  const midTime = parseFloat(recordedData[midSearch][0]);\n  if (time === midTime) {\n    return [midSearch, midSearch];\n  }\n  if (time < midTime) {\n    return getIndexRangeForTime(recordedData, time, startSearch, midSearch);\n  }\n  return getIndexRangeForTime(recordedData, time, midSearch, endSearch);\n}\n\nfunction getNextIndexForTime(\n  recordedData: TypeEvents | TypeStateDiffs,\n  time: number,\n  startSearch: number = 0,\n  endSearch: number = recordedData.length - 1,\n  earliestTime: boolean = true,\n) {\n  const nextIndex = getIndexRangeForTime(recordedData, time, startSearch, endSearch)[1];\n  // console.log(nextIndex)\n  if (earliestTime) {\n    return getIndexOfEarliestTime(recordedData, nextIndex);\n  }\n  return getIndexOfLatestTime(recordedData, nextIndex);\n}\n\nfunction getPrevIndexForTime(\n  recordedData: TypeEvents | TypeStateDiffs,\n  time: number,\n  startSearch: number = 0,\n  endSearch: number = recordedData.length - 1,\n  earliestTime: boolean = true,\n) {\n  const prevIndex = getIndexRangeForTime(recordedData, time, startSearch, endSearch)[0];\n  if (earliestTime) {\n    return getIndexOfEarliestTime(recordedData, prevIndex);\n  }\n  return getIndexOfLatestTime(recordedData, prevIndex);\n}\n\n// function getTimeToIndex(\n//   recordedData: TypeEvents | TypeStateDiffs,\n//   eventIndex: number,\n//   time: number,\n// ) {\n//   if (eventIndex === -1 || eventIndex > recordedData.length - 1) {\n//     return -1;\n//   }\n//   const nextTime = recordedData[eventIndex][0];\n//   return nextTime - time;\n// }\n\n\nclass Recorder {\n  states: ObjectTracker;\n  events: {\n    [eventName: string]: {\n      setOnSeek: boolean,\n      playbackAction: () => void,\n      list: TypeEvents;\n    };\n  };\n\n  statesCache: ObjectTracker;\n  eventsCache: {\n    [eventName: string]: {\n      list: TypeEvents;\n    };\n  };\n\n  subscriptions: SubscriptionManager;\n\n  eventsToPlay: Array<string>;\n\n  state: 'recording' | 'playing' | 'idle' | 'preparingToPlay' | 'preparingToPause';\n  isAudioPlaying: boolean;\n  videoToNowDelta: number;     // performance.now() - deltaToNow = video time\n  currentTime: number;    // The current video time location\n  duration: number;       // The duration of the video\n  precision: number;      // The precision with which to record numbers\n\n  stateIndex: number;\n  eventIndex: {\n    [eventName: string]: number;\n  };\n\n  pauseState: ?Object;\n  startRecordingTime: number;\n\n  stateTimeStep: number;      // in seconds\n  figure: Figure;\n\n  timeoutID: ?TimeoutID;\n  timeUpdatesTimeoutID: ?TimeoutID;\n\n  // playbackStoppedCallback: ?() =>void;\n\n  lastRecordTime: ?number;\n  lastRecordTimeCount: number;\n\n  audio: ?HTMLAudioElement;\n  reference: string;\n  referenceIndex: number;\n  lastSeekTime: ?number;\n\n  settings: {\n    pause: 'freeze' | 'cancel' | 'complete' | 'animateToComplete' | 'dissolveToComplete',\n    play: TypePlaySettings,\n  };\n\n  worker: ?(typeof Worker);\n\n  static instance: Object;\n\n  // All slides, events and states are relative to 0, where 0 is the start of a recording.\n  // Slides, events and states do not have to have a 0 time,\n  // maybe the first event will not happen till 1s in\n  constructor(singleton: boolean = false) {\n    // If the instance alread exists, then don't create a new instance.\n    // If it doesn't, then setup some default values.\n    if (singleton) {\n      if (!Recorder.instance) {\n        this.initialize();\n      }\n      return Recorder.instance;\n    }\n    this.initialize();\n  }\n\n  initialize() {\n    this.subscriptions = new SubscriptionManager();\n    this.events = {};\n    this.eventsCache = {};\n    this.reset();\n    // default recording values\n    this.precision = 4;\n    this.stateTimeStep = 1;\n    this.audio = null;\n    // this.playbackStoppedCallback = null;\n    this.worker = null;\n    this.pauseState = null;\n    this.settings = {\n      pause: 'freeze',\n      play: 'instant',\n    };\n  }\n\n  // ////////////////////////////////////\n  // ////////////////////////////////////\n  // Time\n  // ////////////////////////////////////\n  // ////////////////////////////////////\n  timeStamp() {   // eslint-disable-line class-methods-use-this\n    return new GlobalAnimation().now();\n  }\n\n  now() {   // eslint-disable-line class-methods-use-this\n    return round((this.timeStamp() - this.videoToNowDelta) / 1000, 8);\n  }\n\n  getCurrentTime() {\n    if (this.state !== 'idle') {\n      return this.now();\n    }\n    return this.currentTime;\n  }\n\n  getDeltaTime(delta: number = 0) {\n    const currentTime = this.getCurrentTime();\n    const newTime = currentTime + delta;\n    if (newTime > this.duration) {\n      return this.duration;\n    }\n    if (newTime < 0) {\n      return 0;\n    }\n    return newTime;\n  }\n\n  setCurrentTime(time: number) {\n    this.currentTime = time;\n    this.subscriptions.publish('timeUpdate', [time]);\n  }\n\n  setVideoToNowDeltaTime(videoSeekTime: number = 0) {\n    this.videoToNowDelta = this.timeStamp() - videoSeekTime * 1000;\n  }\n\n  calcDuration(cache: boolean = false) {\n    let eventsTime = 0;\n    let eventsCacheTime = 0;\n    let statesTime = 0;\n    let statesCacheTime = 0;\n    let audioTime = 0;\n    Object.keys(this.events).forEach((eventName) => {\n      const event = this.events[eventName];\n      if (event.list.length > 0) {\n        eventsTime = Math.max(eventsTime, event.list[event.list.length - 1][0]);\n      }\n    });\n    Object.keys(this.eventsCache).forEach((eventName) => {\n      const event = this.eventsCache[eventName];\n      if (event.list.length > 0) {\n        eventsCacheTime = Math.max(eventsCacheTime, event.list[event.list.length - 1][0]);\n      }\n    });\n    if (this.states.diffs.length > 0) {\n      [statesTime] = this.states.diffs[this.states.diffs.length - 1];\n    }\n    if (this.statesCache.diffs.length > 0) {\n      [statesCacheTime] = this.statesCache.diffs[this.statesCache.diffs.length - 1];\n    }\n    // eslint-disable-next-line no-restricted-globals\n    if (this.audio != null && !isNaN(this.audio.duration)) {\n      audioTime = this.audio.duration;\n    }\n    if (cache) {\n      return Math.max(eventsCacheTime, statesCacheTime);\n    }\n    return Math.max(eventsTime, eventsCacheTime, statesTime, statesCacheTime, audioTime);\n  }\n\n  // ////////////////////////////////////\n  // ////////////////////////////////////\n  // Initialization\n  // ////////////////////////////////////\n  // ////////////////////////////////////\n  reset() {\n    this.states = new ObjectTracker(this.precision);\n    this.statesCache = new ObjectTracker(this.precision);\n    Object.keys(this.events).forEach((eventName) => {\n      this.events[eventName].list = [];\n    });\n    // this.events.list = [];\n    this.eventsCache = {};\n    this.stateIndex = -1;\n    this.eventIndex = {};\n    this.stopTimeouts();\n    this.videoToNowDelta = 0;\n    this.state = 'idle';\n    this.isAudioPlaying = false;\n    // this.currentTime = 0;\n    this.setCurrentTime(0);\n    this.duration = 0;\n    this.reference = '__base';\n    this.lastRecordTimeCount = 0;\n    this.lastRecordTime = null;\n    this.eventsToPlay = [];\n    this.lastSeekTime = null;\n  }\n\n  loadAudio(audio: HTMLAudioElement) {\n    this.audio = audio;\n    this.audio.onloadedmetadata = () => {\n      this.duration = this.calcDuration();\n    };\n    this.subscriptions.publish('audioLoaded');\n  }\n\n  loadEvents(\n    encodedEventsList: Object | Array<TypeEvents>,\n    isMinified: boolean = true,\n  ) { // $FlowFixMe\n    const lists = this.decodeEvents(encodedEventsList, isMinified);\n\n    // Loading, Decoding, Enconding events and states is a flow mess\n    // $FlowFixMe\n    Object.keys(lists).forEach((eventName) => {\n      if (this.events[eventName] == null) {\n        return;\n      }  // $FlowFixMe\n      this.events[eventName].list = lists[eventName];\n    });\n    this.duration = this.calcDuration();\n    this.subscriptions.publish('eventsLoaded');\n  }\n\n  loadStates(\n    statesIn: Object,\n    isMinified: boolean = true,\n    isObjectForm: boolean = true,\n  ) {\n    this.states = this.decodeStates(statesIn, isMinified, isObjectForm);\n    this.duration = this.calcDuration();\n    this.subscriptions.publish('statesLoaded');\n  }\n\n  encodeEvents(\n    minifyEvents: boolean = true,\n  ) {\n    const lists = {};\n    const events = duplicate(this.events);\n    // $FlowFixMe\n    Object.keys(events).forEach((eventName) => {  // $FlowFixMe\n      lists[eventName] = events[eventName].list;\n    });\n    if (minifyEvents) {\n      return minify(lists);\n    }\n    return duplicate(lists);\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  decodeEvents(\n    lists: Object,\n    isMinified: boolean = true,\n  ) {\n    if (isMinified) {\n      return unminify(lists);\n    }\n    return duplicate(lists);\n  }\n\n\n  encodeStates(\n    minifyStates: boolean = true,\n    asObject: boolean = true,\n    precision: ?number = this.precision,\n  ) {\n    let states;\n    if (asObject) {\n      states = this.states.toObj();\n    } else {\n      states = duplicate(this.states);\n    }\n    if (minifyStates) {\n      return minify(states, precision);\n    }\n    return states;\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  decodeStates(\n    statesIn: Object,\n    isMinified: boolean = true,\n    asObject: boolean = true,\n  ) {\n    let statesToUse: Object = statesIn;\n    if (isMinified) {\n      statesToUse = unminify(statesIn);\n    }\n    if (asObject) {\n      const states1 = new ObjectTracker();\n      states1.setFromObj(statesToUse);\n      statesToUse = states1;\n    }\n    const states = new ObjectTracker();\n    states.diffs = statesToUse.diffs;\n    states.baseReference = statesToUse.baseReference;\n    states.references = statesToUse.references;\n    states.precision = statesToUse.precision;\n    return states;\n  }\n\n  // ////////////////////////////////////\n  // ////////////////////////////////////\n  // Editing\n  // ////////////////////////////////////\n  // ////////////////////////////////////\n  // Remove selected events in time range\n  // set all state diffs to be the same in time range\n  // eslint-disable-next-line class-methods-use-this\n  clearListOrDiffs(\n    listOrDiffs: TypeEvents | TypeStateDiffs,\n    startTime: number,\n    stopTime: number,\n  ) {\n    const startIndex = getNextIndexForTime(listOrDiffs, startTime);\n    const stopIndex = getPrevIndexForTime(listOrDiffs, stopTime);\n    let newListOrDiffs = [];\n    if (startIndex > 0) { // $FlowFixMe\n      newListOrDiffs = listOrDiffs.slice(0, startIndex);\n    }\n    if (stopIndex > -1 && stopIndex + 1 <= listOrDiffs.length - 1) {\n      newListOrDiffs = [...newListOrDiffs, ...listOrDiffs.slice(stopIndex + 1)];\n    }\n    return newListOrDiffs;\n  }\n\n  clear(startTime: number, stopTime: number) {\n    Object.keys(this.events).forEach((eventName) => {\n      const event = this.events[eventName]; // $FlowFixMe\n      event.list = this.clearListOrDiffs(event.list, startTime, stopTime);\n    }); // $FlowFixMe\n    this.states.diffs = this.clearListOrDiffs(this.states.diffs, startTime, stopTime);\n  }\n\n  // ////////////////////////////////////\n  // ////////////////////////////////////\n  // Recording\n  // ////////////////////////////////////\n  // ////////////////////////////////////\n  startRecording(fromTime: number = 0, whilePlaying: Array<string> = []) {\n    // if (fromTime > 0) {\n    this.state = 'recording';\n    this.lastSeekTime = null;\n    this.setVideoToNowDeltaTime(fromTime);\n    if (this.states.diffs.length > 0) {\n      this.setToTime(fromTime, true);\n    }\n\n    this.states.precision = this.precision;\n\n    if (fromTime === 0 && this.states.baseReference == null) {\n      this.states.setBaseReference(this.figure.getState({\n        precision: this.precision,\n        ignoreShown: true,\n      }));\n    }\n\n    this.startWorker();\n    if (this.worker != null) {\n      this.worker.postMessage({\n        message: 'reset',\n        payload: {\n          baseReference: this.states.baseReference,\n          references: this.states.references,\n        },\n      });\n    }\n\n    this.eventsCache = {};\n\n    // this.figure.unpause();\n\n\n    this.lastRecordTime = null;\n    this.duration = this.calcDuration();\n\n    this.queueRecordState(fromTime % this.stateTimeStep);\n\n    this.eventsToPlay = whilePlaying;\n    // this.initializePlayback(fromTime);\n    this.startEventsPlayback(fromTime);\n    this.startAudioPlayback(fromTime);\n    this.subscriptions.publish('startRecording');\n    this.startRecordingTime = fromTime;\n    this.startTimeUpdates();\n    // console.log('recorder is', this.state);\n  }\n\n  startWorker() {\n    if (this.worker == null) {\n      this.worker = new Worker();\n      this.worker.addEventListener('message', this.parseMessage.bind(this));\n    }\n  }\n\n  // $FlowFixMe\n  parseMessage(event) {\n    const { message, payload } = event.data;\n    // if (message === 'duration')\n    if (message === 'cache') {\n      this.statesCache = new ObjectTracker();\n      this.statesCache.diffs = payload.diffs;\n      this.statesCache.baseReference = payload.baseReference;\n      this.statesCache.references = payload.references;\n      this.mergeEventsCache();\n      this.mergeStatesCache();\n      this.duration = this.calcDuration();\n      if (this.duration % 1 > 0) {\n        const lastIndex = this.states.diffs.length - 1;\n        const [, ref, diff] = this.states.diffs[lastIndex];\n        this.states.diffs.push([Math.ceil(this.duration), ref, duplicate(diff), 0]);\n      }\n      this.duration = this.calcDuration();\n      // console.log(this)\n    }\n  }\n\n  addCurrentStateAsReference() {\n    this.referenceIndex += 1;\n    this.reference = `ref${this.referenceIndex}`;\n    const state = this.figure.getState({\n      precision: this.precision,\n      ignoreShown: true,\n    });\n    if (this.state === 'recording') {\n      // this.statesCache.addReference(state, this.reference);\n      if (this.worker != null) {\n        this.worker.postMessage({\n          message: 'addReference',\n          payload: {\n            state,\n            refName: this.reference,\n            basedOn: '__base',\n          },\n        });\n      }\n    } else {\n      this.states.addReference(state, this.reference);\n    }\n  }\n\n  getCacheStartTime() {\n    let time = null;\n    if (this.statesCache.diffs.length > 0) {\n      time = this.statesCache.diffs[0][0];  // eslint-disable-line prefer-destructuring\n    }\n    Object.keys(this.eventsCache).forEach((eventName) => {\n      const event = this.eventsCache[eventName];\n      if (event.list.length > 0) {\n        const [eventTime] = event.list[0];\n        if (time == null) {\n          time = eventTime;\n        } else {\n          time = Math.min(eventTime, time);\n        }\n      }\n    });\n    return time;\n  }\n\n  getCacheEndTime() {\n    return this.calcDuration(true);\n  }\n\n  getMergedCacheArray(\n    eventListOrStatesDiff: TypeEvents | TypeStateDiffs,\n    cacheArray: TypeEvents | TypeStateDiffs,\n  ) {\n    // const startTime = this.getCacheStartTime();\n    // const endTime = this.getCacheEndTime();\n    const startTime = this.startRecordingTime;\n    const endTime = this.currentTime;\n    if (startTime == null || endTime === 0) {\n      return [];\n    }\n    let sliceStart = getPrevIndexForTime(eventListOrStatesDiff, startTime);\n    if (sliceStart > -1 && eventListOrStatesDiff[sliceStart][0] === startTime) {\n      sliceStart = getIndexOfEarliestTime(eventListOrStatesDiff, sliceStart) - 1;\n      if (sliceStart < 0) {\n        sliceStart = -1;\n      }\n    }\n    let sliceEnd = getNextIndexForTime(eventListOrStatesDiff, endTime);\n    if (sliceEnd > -1 && eventListOrStatesDiff[sliceEnd][0] === endTime) {\n      sliceEnd = getIndexOfLatestTime(eventListOrStatesDiff, sliceEnd) + 1;\n      if (sliceEnd > eventListOrStatesDiff.length - 1) {\n        sliceEnd = -1;\n      }\n    }\n    // console.log(sliceStart, sliceEnd)\n    let beforeEvents = [];\n    let afterEvents = [];\n    if (sliceStart >= 0) {\n      beforeEvents = eventListOrStatesDiff.slice(0, sliceStart + 1);\n    }\n    if (sliceEnd >= 0) {\n      afterEvents = eventListOrStatesDiff.slice(sliceEnd);\n    }\n    return [...beforeEvents, ...cacheArray, ...afterEvents];\n  }\n\n  mergeEventsCache() {\n    // Object.keys(this.eventsCache).forEach((eventName) => {\n    //   const merged = this.getMergedCacheArray(\n    //     this.events[eventName].list, this.eventsCache[eventName].list,\n    //   );\n    //   if (merged.length === 0) {\n    //     return;\n    //   }\n    //   this.events[eventName].list = merged;\n    // });\n    const allEventNames = {};\n    Object.keys(this.events).forEach((eventName) => {\n      allEventNames[eventName] = null;\n    });\n    Object.keys(this.eventsCache).forEach((eventName) => {\n      allEventNames[eventName] = null;\n    });\n    Object.keys(allEventNames).forEach((eventName) => {\n      let eventsCacheList = [];\n      if (this.eventsCache[eventName] != null) {\n        eventsCacheList = this.eventsCache[eventName].list;\n      }\n      let eventsList = [];\n      if (this.events[eventName] != null) {\n        eventsList = this.events[eventName].list;\n      }\n      // console.log(eventName)\n      const merged = this.getMergedCacheArray(  // $FlowFixMe\n        eventsList, eventsCacheList,\n      );\n      if (merged.length === 0) {\n        return;\n      }\n      // $FlowFixMe\n      this.events[eventName].list = merged;\n    });\n  }\n\n  mergeStatesCache() {\n    const merged = this.getMergedCacheArray(    // $FlowFixMe\n      this.states.diffs, this.statesCache.diffs,\n    );\n    if (merged.length === 0) {\n      return;\n    }   // $FlowFixMe\n    this.states.diffs = merged;\n    // this.states.baseReference = duplicate(this.statesCache.baseReference);\n    // $FlowFixMe\n    this.states.references = duplicate(this.statesCache.references);\n  }\n\n  stopTimeouts() {\n    // if (this.timeoutID != null) {\n    //   clearTimeout(this.timeoutID);\n    //   this.timeoutID = null;\n    // }\n    new GlobalAnimation().clearTimeout(this.timeoutID);\n    new GlobalAnimation().clearTimeout(this.timeUpdatesTimeoutID);\n    this.timeoutID = null;\n    this.timeUpdatesTimeoutID = null;\n    // if (this.timeUpdatesTimeoutID != null) {\n    //   clearTimeout(this.timeUpdatesTimeoutID);\n    //   this.timeUpdatesTimeoutID = null;\n    // }\n  }\n\n  stopRecording() {\n    // this.currentTime = this.getCurrentTime();\n    this.setCurrentTime(this.getCurrentTime());\n    this.state = 'idle';\n    this.stopTimeouts();\n\n    // $FlowFixMe\n    this.worker.postMessage({ message: 'get' });\n    if (this.audio) {\n      this.audio.pause();\n      this.isAudioPlaying = false;\n    }\n    this.lastSeekTime = null;\n    this.subscriptions.publish('stopRecording');\n    // this.mergeEventsCache();\n    // this.mergeStatesCache();\n    // this.duration = this.calcDuration();\n    // if (this.duration % 1 > 0) {\n    //   const lastIndex = this.states.diffs.length - 1;\n    //   const [, ref, diff] = this.states.diffs[lastIndex];\n    //   this.states.diffs.push([Math.ceil(this.duration), ref, duplicate(diff), 0]);\n    // }\n    // this.duration = this.calcDuration();\n    // console.log(this)\n  }\n\n  addEventType(\n    eventName: string,\n    playbackAction: (any) => void,\n    setOnSeek: boolean = true,\n  ) {\n    this.events[eventName] = {\n      setOnSeek,\n      list: [],\n      playbackAction,\n    };\n    this.eventIndex[eventName] = -1;\n    // this.timeoutID[eventName] = null;\n  }\n\n  recordState(state: Object, time: number = this.getCurrentTime()) {\n    // const now = this.now();\n    const now = time;\n    if (this.lastRecordTime == null || now > this.lastRecordTime) {\n      this.lastRecordTime = now;\n      this.lastRecordTimeCount = 0;\n    }\n    // const start = performance.now();\n    // if (this.worker != null) {\n    //   this.worker.postMessage(state);\n    // }\n    if (this.worker != null) {\n      this.worker.postMessage({\n        message: 'add',\n        payload: {\n          now,\n          state,\n          reference: this.reference,\n          lastRecordTimeCount: this.lastRecordTimeCount,\n        },\n      });\n    }\n    // this.statesCache.add(now, state, this.reference, this.lastRecordTimeCount);\n    // console.log('add', performance.now() - start);\n    // this.duration = this.calcDuration();\n    // if (now > this.duration) {\n    //   this.duration = now;\n    // }\n    this.lastRecordTimeCount += 1;\n    if (now > this.duration) {\n      this.duration = now;\n    }\n  }\n\n  recordCurrentState(time: number = this.getCurrentTime()) {\n    // const start = performance.now();\n    // if (window.asdf) {\n    //   console.log('recording state', time);\n    // }\n    const state = this.figure.getState({ precision: this.precision, ignoreShown: true });\n    // const start1 = performance.now();\n    // const str = JSON.stringify(state);\n    // console.log('stringify', str.length, performance.now() - start);\n    // console.log(state)\n    // console.log(str)\n    // const unStr = JSON.parse(str)\n    // console.log(unStr)\n    // console.log(unStr == state)\n    this.recordState(state, time);\n    // console.log('recordState', performance.now() - start);\n  }\n\n  recordCurrentStateAsReference(refName: string, basedOn: '__base') {\n    const state = this.figure.getState({\n      precision: this.precision,\n      ignoreShown: true,\n    });\n    if (this.worker != null) {\n      this.worker.postMessage({\n        message: 'addReference',\n        payload: {\n          state,\n          refName,\n          basedOn,\n        },\n      });\n    }\n    // this.statesCache.addReference(this.figure.getState({\n    //   precision: this.precision,\n    //   ignoreShown: true,\n    // }), refName, basedOn);\n  }\n\n  recordEvent(\n    eventName: string,\n    payload: Array<string | number | Object>,\n    time: number = this.now(),\n  ) {\n    // console.log(time)\n    if (this.events[eventName] == null) {\n      return;\n    }\n    if (this.eventsCache[eventName] == null) {\n      this.eventsCache[eventName] = {\n        list: [],\n      };\n    }\n    // const now = this.now();\n    if (this.lastRecordTime == null || time > this.lastRecordTime) {\n      this.lastRecordTime = time;\n      this.lastRecordTimeCount = 0;\n    }\n    this.eventsCache[eventName].list.push(\n      [time, payload, this.lastRecordTimeCount],\n    );\n    this.lastRecordTimeCount += 1;\n    if (time > this.duration) {\n      this.duration = time;\n    }\n  }\n\n  // States are recorded every second\n  queueRecordState(time: number = 0) {\n    // console.log(time)\n    const recordAndQueue = () => {\n      if (this.state === 'recording') {\n        if (this.figure.getIsInTransition() === false) {\n          this.recordCurrentState();\n        }\n        this.queueRecordState(this.stateTimeStep - this.getCurrentTime() % this.stateTimeStep);\n      }\n    };\n    if (round(time, 4) === 0) {\n      recordAndQueue();\n      return;\n    }\n    // if (time < 1) {\n    //   return\n    // }\n    this.timeoutID = new GlobalAnimation().setTimeout(() => {\n      recordAndQueue();\n    }, round(time * 1000, 0));\n  }\n\n  save() {\n    const dateStr = new Date().toISOString();\n    const location = (window.location.pathname).replace('/', '_');\n    const encodedStates = this.encodeStates();\n    const encodedEvents = this.encodeEvents();\n    if (encodedStates != null) {\n      download(`${dateStr} ${location}.vidstates.json`, JSON.stringify(encodedStates));\n    }\n    if (encodedEvents != null) {\n      download(`${dateStr} ${location}.videvents.json`, JSON.stringify(encodedEvents));\n    }\n  }\n\n  show() {\n    const toJsonHtml = (obj) => {\n      let s = JSON.stringify(obj, null, 2);\n      s = s.replace(/\\n/g, '<br>');\n      s = s.replace(/ /g, '&nbsp');\n      return s;\n    };\n    const wnd = window.open('about:blank', '', '_blank');\n    // this.slides.forEach((slide) => {\n    //   wnd.document.write(JSON.stringify(slide), '<br>');\n    // });\n\n    wnd.document.write('<br><br>');\n    wnd.document.write(`// ${'/'.repeat(500)}<br>`);\n    wnd.document.write(`// ${'/'.repeat(500)}<br>`);\n    wnd.document.write('<br><br>');\n\n    // Object.keys(this.events).forEach((eventName) => {\n    //   const event = this.events[eventName];\n    //   // const rounded = event.map((e) => {\n    //   //   if (typeof e === 'number') {\n    //   //     return round(e, this.precision);\n    //   //   }\n    //   //   return e;\n    //   // });\n    //   wnd.document.write('<br><br>');\n    //   wnd.document.write(`${eventName}`);\n    //   wnd.document.write(JSON.stringify(event, null, 2), '<br>');\n    // });\n    wnd.document.write(toJsonHtml(this.events), '<br>');\n    wnd.document.write('<br><br>');\n    wnd.document.write(`// ${'/'.repeat(500)}<br>`);\n    wnd.document.write(`// ${'/'.repeat(500)}<br>`);\n    wnd.document.write('<br><br>');\n    wnd.document.write(toJsonHtml(this.states.diffs), '<br>');\n    wnd.document.write(toJsonHtml(this.states.references), '<br>');\n    // this.states.diffs.forEach((state) => {\n    //   wnd.document.write(JSON.stringify(state, null, 2), '<br>');\n    // });\n  }\n\n  // ////////////////////////////////////\n  // ////////////////////////////////////\n  // Seeking\n  // ////////////////////////////////////\n  // ////////////////////////////////////\n  seekToPercent(percentTime: number) {\n    const duration = this.calcDuration();\n    this.seek(duration * percentTime);\n  }\n\n  seek(timeIn: number) {\n    // console.log('called seek', timeIn)\n    this.pauseState = null;\n    let time = timeIn;\n    if (time < 0) {\n      time = 0;\n    }\n    if (this.states.diffs.length === 0) {\n      return;\n    }\n    if (this.state === 'recording') {\n      this.stopRecording();\n    } else if (this.state === 'playing') {\n      this.pausePlayback('freeze');\n    }\n    // console.log(time)\n    this.setToTime(time);\n    // this.figure.pause({\n    //   animation: 'freeze',\n    //   pulse: 'freeze',\n    //   movingFreely: 'freeze',\n    // });\n    this.figure.stop('freeze');\n    // console.log('last seek time', this.lastSeekTime)\n  }\n\n  setToTime(timeIn: number, force: boolean = false) {\n    if (timeIn === 0 && this.states.diffs.length > 0) {\n      this.stateIndex = 0;\n    } else {  // $FlowFixMe\n      this.stateIndex = getPrevIndexForTime(this.states.diffs, timeIn);\n    }\n    // console.log(this.stateIndex)\n    let stateTime = 0;\n    let stateTimeCount = 0;\n    if (this.stateIndex !== -1) {\n      [stateTime, , , stateTimeCount] = this.states.diffs[this.stateIndex];\n    }\n\n    if (stateTime === this.lastSeekTime && !force) {\n      // console.log('setting to time - no change');\n      return;\n    }\n    const time = stateTime;\n\n    this.lastSeekTime = stateTime;\n    // console.log('setting to time', timeIn, stateTime);\n    // For each eventName, if it is to be set on seek, then get the previous\n    // index (or multiple indexes if multiple are set for the same time)\n    // and add them to an eventsToExecuteArray\n    const eventsToSetBeforeState = [];\n    const eventsToSetAfterState = [];\n    Object.keys(this.events).forEach((eventName) => {\n      const event = this.events[eventName];\n      if (event.setOnSeek === false) {\n        return;\n      }\n      const firstIndex = getPrevIndexForTime(event.list, time);\n      if (firstIndex === -1) {\n        return;\n      }\n      const lastIndex = getIndexOfLatestTime(\n        event.list,\n        getPrevIndexForTime(event.list, timeIn),\n      );\n      // const lastIndex = getIndexOfLatestTime(event.list, firstIndex);\n      for (let i = firstIndex; i <= lastIndex; i += 1) {\n        const [eventTime, , timeCount] = event.list[i];\n        if (\n          this.stateIndex === -1\n          || eventTime < stateTime\n          || (eventTime === stateTime && timeCount < stateTimeCount)\n        ) {\n          eventsToSetBeforeState.push([eventName, i, eventTime, timeCount]);\n        } else if (\n          eventTime > stateTime\n          || (eventTime === stateTime && timeCount > stateTimeCount)\n        ) {\n          eventsToSetAfterState.push([eventName, i, eventTime, timeCount]);\n        }\n      }\n    });\n\n    const sortTimes = arrayToSort => arrayToSort.sort((a, b) => {\n      if (a[2] < b[2] || (a[2] === b[2] && a[3] < b[3])) {\n        return -1;\n      }\n      if (a[2] > b[2] || (a[2] === b[2] && a[3] > b[3])) {\n        return 1;\n      }\n      return 0;\n    });\n    // console.log(eventsToSetBeforeState);\n    // Sort the eventsToSet arrays in time\n    sortTimes(eventsToSetBeforeState);\n    sortTimes(eventsToSetAfterState);\n    const playEvents = (events) => {\n      events.forEach((event) => {\n        const [eventName, index] = event;\n        // if (eventName === 'slide') {\n        //   debugger;\n        // }\n        this.setEvent(eventName, index);\n      });\n    };\n    // console.log('before')\n    playEvents(eventsToSetBeforeState);\n    // console.log('state')\n    // console.log(this.stateIndex)\n    if (this.stateIndex !== -1) {\n      this.setState(this.stateIndex);\n    }\n    // console.log('after')\n    playEvents(eventsToSetAfterState);\n    // console.log('done')\n    if (this.audio) {\n      this.audio.currentTime = time;\n    }\n    this.setCurrentTime(time);\n    // this.currentTime = time;\n\n    this.setCursor(time);\n    this.figure.animateNextFrame();\n    // console.log(this.figure.getElement('a').getRotation())\n  }\n\n  setCursor(time: number) {\n    const cursorState = this.getCursorState(time);\n    if (cursorState == null) {\n      return;\n    }\n    const { show, up, position } = cursorState;\n    if (show && up) {\n      this.figure.showCursor('up', position);\n    } else if (show && up === false) {\n      this.figure.showCursor('down', position);\n    } else {\n      this.figure.showCursor('hide');\n    }\n  }\n\n  getCursorState(atTime: number) {\n    if (\n      this.events.touch == null\n      || this.events.cursor == null\n      || this.events.cursorMove == null\n    ) {\n      return null;\n    }\n\n    const cursorIndex = getPrevIndexForTime(this.events.cursor.list, atTime);\n    const touchIndex = getPrevIndexForTime(this.events.touch.list, atTime);\n    const cursorMoveIndex = getPrevIndexForTime(this.events.cursorMove.list, atTime);\n\n    let touchUp = null;\n    let showCursor = null;\n    let cursorPosition = null;\n    let cursorTime = null;\n    let cursorTimeCount = null;\n    if (touchIndex !== -1) {\n      const event = this.events.touch.list[touchIndex]; // $FlowFixMe\n      const [time, [upOrDown, x, y], timeCount] = event;\n      if (upOrDown === 'down') {\n        touchUp = false;\n        cursorTime = time;\n        cursorTimeCount = timeCount; // $FlowFixMe\n        cursorPosition = new Point(x, y);\n      } else {\n        touchUp = true;\n      }\n    }\n\n    if (cursorIndex !== -1) {\n      const event = this.events.cursor.list[cursorIndex]; // $FlowFixMe\n      const [time, [showOrHide, x, y], timeCount] = event;\n      if (showOrHide === 'show') {\n        showCursor = true;\n        if (\n          cursorTime == null\n          || time > cursorTime // $FlowFixMe\n          || (time === cursorTime && timeCount > cursorTimeCount)\n        ) {\n          cursorTime = time;\n          cursorTimeCount = timeCount; // $FlowFixMe\n          cursorPosition = new Point(x, y);\n        }\n      } else {\n        showCursor = false;\n      }\n    }\n\n    if (cursorMoveIndex !== -1) {\n      const event = this.events.cursorMove.list[cursorMoveIndex]; // $FlowFixMe\n      const [time, [x, y], timeCount] = event;\n      if (\n        cursorTime == null\n        || time > cursorTime // $FlowFixMe\n        || (time === cursorTime && timeCount > cursorTimeCount)\n      ) { // $FlowFixMe\n        cursorPosition = new Point(x, y);\n      }\n    }\n\n    return {\n      show: showCursor == null ? false : showCursor,\n      up: touchUp == null ? true : touchUp,\n      position: cursorPosition == null ? new Point(0, 0) : cursorPosition,\n    };\n  }\n\n\n  // ////////////////////////////////////\n  // ////////////////////////////////////\n  // Playback\n  // ////////////////////////////////////\n  // ////////////////////////////////////\n  startPlayback(\n    fromTimeIn: number = this.lastSeekTime || 0,\n    forceStart: boolean = true,\n    events: ?Array<string> = null,\n  ) {\n    let fromTime = fromTimeIn;\n    if (fromTimeIn == null || fromTimeIn >= this.duration) {\n      fromTime = 0;\n    }\n    if (events == null) {\n      this.eventsToPlay = Object.keys(this.events);\n    } else {\n      this.eventsToPlay = events;\n    }\n\n    // this.figure.unpause();\n    // this.setVideoToNowDeltaTime(this.currentTime);\n\n    let stateToStartFrom = this.getStateForTime(fromTime);\n    if (\n      !forceStart\n      && this.pauseState != null\n    ) {\n      stateToStartFrom = this.pauseState;\n    }\n\n    const finished = () => {\n      if (this.pauseState == null) {\n        this.setToTime(fromTime, true);\n      } else {\n        // this.figure.setState(this.pauseState, 'instant');\n        this.pauseState = null;\n      }\n      this.state = 'playing';\n      this.setVideoToNowDeltaTime(fromTime);\n      // this.currentTime = fromTime;\n      this.setCurrentTime(fromTime);\n      this.startTimeUpdates();\n      this.startEventsPlayback(fromTime);\n      this.startAudioPlayback(fromTime);\n      this.figure.animateNextFrame();\n      if (this.areEventsPlaying() === false && this.isAudioPlaying === false) {\n        this.finishPlaying();\n      }\n      this.subscriptions.publish('playbackStarted');\n    };\n\n    // console.log(this.settings.play)\n    this.figure.setState(stateToStartFrom, this.settings.play);\n    if (this.figure.state.preparingToSetState) {\n      this.state = 'preparingToPlay';\n      this.subscriptions.publish('preparingToPlay');\n      this.figure.subscriptions.add('stateSet', finished, 1);\n      // console.log(this.figure.subscriptions.subscriptions.stateSet)\n    } else {\n      finished();\n    }\n  }\n\n\n  getPlaySettings() {\n    let onResume = {\n      how: 'instant',\n      maxDuration: 6,\n      velocity: {\n        position: 2,\n        rotation: Math.PI * 2 / 2,\n        scale: 1,\n        opacity: 0.8,\n        color: 0.8,\n      },\n      allDurationsSame: true,\n      zeroDurationThreshold: 0.00001,\n      // minDuration: 0,\n      duration: 0,\n    };\n    // console.log(resumeSettings)\n    if (typeof this.settings.play === 'string') {\n      onResume.how = this.settings.play;\n    } else {\n      onResume = joinObjects({}, onResume, this.settings.play);\n      // velocity trumps duration by default, but if only duration is defined by the\n      // user, then remove velocity;\n      // if (this.settings.resume.duration != null && this.settings.resume.velocity == null) {\n      //   onResume.velocity = undefined;\n      // }\n    }\n    if (onResume.how === 'dissolve') {\n      const defaultDuration = {\n        dissolveIn: 0.8,\n        dissolveOut: 0.8,\n        delay: 0.2,\n      };\n      if (onResume.duration === 0) {\n        onResume.duration = defaultDuration;\n      } else if (typeof onResume.duration === 'number') {\n        onResume.duration = {\n          dissolveOut: onResume.duration / 10 * 4.5,\n          dissolveIn: onResume.duration / 10 * 4.5,\n          delay: onResume.duration / 10 * 1,\n        };\n      } else {\n        onResume.duration = joinObjects({}, defaultDuration, onResume.duration);\n      }\n    } else if (onResume.duration != null && typeof onResume.duration !== 'number') {\n      onResume.duration = 1;\n    }\n    return onResume;\n  }\n\n  resumePlayback() {\n    this.startPlayback(this.currentTime, false);\n  }\n  // resumePlayback(delta: number = 0) {\n  //   if (delta > 0) {\n  //     this.pauseState = null;\n  //   }\n  //   const resumeTime = Math.min(\n  //     Math.max(this.currentTime + delta, 0),\n  //     this.duration,\n  //   );\n  //   this.startPlayback(resumeTime, false);\n  // }\n\n  startAudioPlayback(fromTime: number) {\n    if (this.audio) {\n      this.isAudioPlaying = true;\n      this.audio.currentTime = fromTime;\n      this.audio.play();\n      const audioEnded = () => {\n        this.isAudioPlaying = false;\n        if (this.state === 'playing') {\n          this.finishPlaying();\n        }\n      };\n      const { audio } = this;\n      if (audio != null) {\n        audio.removeEventListener('ended', audioEnded.bind(this), false);\n        audio.addEventListener('ended', audioEnded.bind(this), false);\n      }\n    }\n  }\n\n  startTimeUpdates() {\n    this.timeUpdatesTimeoutID = new GlobalAnimation().setTimeout(\n      () => {\n        this.setCurrentTime(this.getCurrentTime());\n        this.subscriptions.publish('timeUpdate', [this.getCurrentTime()]);\n        this.startTimeUpdates();\n      },\n      100,\n    );\n  }\n\n  startEventsPlayback(fromTime: number) {\n    this.eventsToPlay.forEach((eventName) => {\n      if (this.events[eventName].list.length === 0) {\n        return;\n      }\n      const event = this.events[eventName];\n      let index = getNextIndexForTime(event.list, fromTime);\n      if (index === -1) {\n        this.eventIndex[eventName] = -1;\n        return;\n      }\n      const [eventTime] = event.list[index];\n      if (eventTime === fromTime) {\n        index = getIndexOfLatestTime(event.list, index) + 1;\n      }\n      if (index > event.list.length - 1) {\n        this.eventIndex[eventName] = -1;\n      } else {\n        this.eventIndex[eventName] = index;\n      }\n    });\n    const nextEventName = this.getNextEvent();\n    if (this.events[nextEventName] != null) {\n      this.playbackEvent(nextEventName);\n    }\n  }\n\n  getNextEvent() {\n    let nextEventName = '';\n    let nextTime = null;\n    let nextTimeCount = null;\n    this.eventsToPlay.forEach((eventName) => {\n      if (\n        this.eventIndex[eventName] == null\n        || this.eventIndex[eventName] === -1\n        || this.events[eventName].list.length <= this.eventIndex[eventName]\n      ) {\n        return;\n      }\n      const [time, , timeCount] = this.events[eventName].list[this.eventIndex[eventName]];\n      if (\n        nextTime == null\n        || time < nextTime // $FlowFixMe\n        || (time === nextTime && timeCount < nextTimeCount)\n      ) {\n        nextTime = time;\n        nextTimeCount = timeCount;\n        nextEventName = eventName;\n      }\n    });\n    return nextEventName;\n  }\n\n  playbackEvent(eventName: string) {\n    const index = this.eventIndex[eventName];\n    const delay = round(this.events[eventName].list[index][0] - this.getCurrentTime(), 8);\n\n    if (delay > 0.0001) {\n      this.timeoutID = new GlobalAnimation().setTimeout(\n        this.playbackEvent.bind(this, eventName), round(delay * 1000, 0),\n      );\n      return;\n    }\n\n    // const index = this.eventIndex[eventName];\n    this.setEvent(eventName, index);\n    this.figure.animateNextFrame();\n    if (index + 1 === this.events[eventName].list.length) {\n      this.eventIndex[eventName] = -1;\n      if (this.areEventsPlaying() === false && this.isAudioPlaying === false) {\n        this.finishPlaying();\n        return;\n      }\n    } else {\n      this.eventIndex[eventName] = index + 1;\n    }\n    const nextEvent = this.getNextEvent();\n    if (nextEvent != null && this.events[nextEvent]) {\n      this.playbackEvent(nextEvent);\n    }\n  }\n\n  areEventsPlaying() {\n    // const eventNames = Object.keys(this.eventIndex)\n    for (let i = 0; i < this.eventsToPlay.length; i += 1) {\n      const eventName = this.eventsToPlay[i];\n      if (\n        this.eventIndex[eventName] < this.events[eventName].list.length\n        && this.eventIndex[eventName] > -1\n      ) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  finishPlaying() {\n    if (this.areEventsPlaying()) {\n      return false;\n    }\n\n    const remainingTime = this.duration - this.getCurrentTime();\n    if (remainingTime > 0.0001) {\n      this.timeoutID = new GlobalAnimation().setTimeout(() => {\n        this.finishPlaying();\n      }, round(remainingTime * 1000, 0));\n      return false;\n    }\n\n    if (this.isAudioPlaying) {\n      return false;\n    }\n    // this.pausePlayback('cancel');\n    // this.currentTime = this.getCurrentTime();\n    this.setCurrentTime(this.getCurrentTime());\n    // console.log(this.currentTime)\n    this.stop();\n    return true;\n  }\n\n  // clearPlaybackTimeouts() {\n  //   this.timeoutID = null;\n  // }\n\n  // animateToState() {\n\n  // }\n\n  stop() {\n    this.stopTimeouts();\n    if (this.audio) {\n      this.audio.pause();\n      this.isAudioPlaying = false;\n    }\n    this.state = 'idle';\n    this.subscriptions.publish('playbackStopped');\n  }\n\n  // On pause, animations and pauses can complete and clear:\n  // Complete  Clear\n  // True      True     Animations finish and nextFrame nothing will happen\n  // True      False    Animations finish and nextFrame nothing will happen\n  //                    as by completing animations they will naturally clear\n  // False     True     Animations freeze and nextFrame nothing will happen\n  // False     False    Animations freeze and nextFrame will continue\n  //\n  // Pulse\n  // True      True     Pulse finish and nextFrame nothing will happen\n  // True      False    Pulse finish and nextFrame nothing will happen\n  //                    as by completing animations they will naturally clear\n  // False     True     Pulse freeze and nextFrame nothing will happen\n  // False     False    Pulse freeze and nextFrame will continue\n  pausePlayback(how: 'freeze' | 'cancel' | 'complete' | 'animateToComplete' | 'dissolveToComplete' = this.settings.pause) {\n    // this.currentTime = this.getCurrentTime();\n    this.setCurrentTime(this.getCurrentTime());\n\n    this.pauseState = this.figure.getState({\n      precision: this.precision,\n      ignoreShown: true,\n    });\n\n    const pause = () => {\n      this.state = 'idle';\n      this.subscriptions.publish('playbackStopped');\n      // this.figure.stop();\n    };\n    this.stopTimeouts();\n    if (this.audio) {\n      this.audio.pause();\n      this.isAudioPlaying = false;\n    }\n\n    this.figure.subscriptions.add('stopped', pause, 1);\n    this.figure.stop(how);\n    if (this.figure.state.preparingToStop) {\n      this.subscriptions.publish('preparingToPause');\n      this.state = 'preparingToPause';\n      // console.log('recorder prep to pause')\n      // this.figure.subscriptions.add('animationsFinished', pause, 1);\n    }\n    // if (this.figure.isAnimating()) {\n    //   this.subscriptions.publish('preparingToPause');\n    //   this.state = 'preparingToPause';\n    //   // console.log('recorder prep to pause')\n    //   this.figure.subscriptions.add('animationsFinished', pause, 1);\n    // } else {\n    //   pause();\n    // }\n  }\n\n\n  setEvent(eventName: string, index: number) {\n    const event = this.events[eventName];\n    if (event == null) {\n      return;\n    }\n    // $FlowFixMe\n    event.playbackAction(event.list[index][1], event.list[index][0]);\n  }\n\n\n  // queuePlaybackState(delay: number = 0) {\n  //   const incrementIndexAndPlayState = () => {\n  //     if (this.state === 'playing') {\n  //       this.stateIndex += 1;\n  //       this.playbackState();\n  //     }\n  //   }\n  //   if (delay === 0) {\n  //     incrementIndexAndPlayState();\n  //     return;\n  //   }\n  //   this.nextStateTimeout = setTimeout(incrementIndexAndPlayState, delay);\n  // }\n\n  // playbackState() {\n  //   if (this.stateIndex > this.states.diffs.length - 1) {\n  //     this.finishPlaying();\n  //     return;\n  //   }\n  //   this.setState(this.stateIndex);\n  //   this.figure.animateNextFrame();\n  //   if (this.stateIndex + 1 === this.states.diffs.length) {\n  //     this.finishPlaying();\n  //     return;\n  //   }\n  //   const nextTime = (this.states.diffs[this.stateIndex + 1][0] - this.getCurrentTime()) * 1000;\n  //   this.queuePlaybackState(nextTime);\n  // }\n\n  setState(index: number) {\n    if (index > this.states.diffs.length - 1) {\n      return;\n    }\n    const state = this.states.getFromIndex(index);\n    this.figure.setState(state);\n  }\n\n  getState(index: number) {\n    if (index > this.states.diffs.length - 1) {\n      return {};\n    }\n    return this.states.getFromIndex(index);\n  }\n\n  getStateForTime(timeIn: number) {\n    let stateIndex;\n    if (timeIn === 0 && this.states.diffs.length > 0) {\n      stateIndex = 0;\n    } else {  // $FlowFixMe\n      stateIndex = getPrevIndexForTime(this.states.diffs, timeIn);\n    }\n    return this.getState(stateIndex);\n  }\n}\n\nexport {\n  Recorder,\n  getIndexOfEarliestTime,\n  download,\n  getIndexOfLatestTime,\n  getNextIndexForTime,\n  getPrevIndexForTime,\n};\n","// @flow\nimport {\n  PositionAnimationStep, AnimationBuilder, RotationAnimationStep,\n  ScaleAnimationStep, TransformAnimationStep, ColorAnimationStep,\n  OpacityAnimationStep, PulseAnimationStep, CustomAnimationStep,\n  DelayAnimationStep, ParallelAnimationStep, SerialAnimationStep,\n  TriggerAnimationStep, ScenarioAnimationStep,\n} from '../Animation/Animation';\n\nimport type Figure from '../Figure';\n\nimport {\n  getPoint, getTransform, getRect, getLine, Translation, Rotation, Scale,\n  getBounds,\n} from '../../tools/g2';\n\nfunction assignAsLinkOnly(obj: Object) {\n  if (obj != null) {\n    // eslint-disable-next-line no-param-reassign\n    obj._assignAsLinkOnly = true;\n  }\n  return obj;\n}\n\nfunction parseState(state: Object, figure: Figure) {\n  if (typeof state === 'number') {\n    return state;\n  }\n  if (typeof state === 'string') {\n    return state;\n  }\n  if (typeof state === 'boolean') {\n    return state;\n  }\n  if (state == null) {\n    return state;\n  }\n\n  if (Array.isArray(state)) {\n    const out = [];\n    state.forEach((stateElement) => {\n      out.push(parseState(stateElement, figure));\n    });\n    return out;\n  }\n  if (state.f1Type != null) {\n    if (state.f1Type === 'rect') {\n      return getRect(state);\n    }\n    if (state.f1Type === 'p') {\n      return getPoint(state);\n    }\n    if (state.f1Type === 'tf') {\n      return getTransform(state);\n    }\n    if (state.f1Type === 't') {\n      return new Translation(state);\n    }\n    if (state.f1Type === 's') {\n      return new Scale(state);\n    }\n    if (state.f1Type === 'r') {\n      return new Rotation(state);\n    }\n    if (state.f1Type === 'l') {\n      return getLine(state);\n    }\n    if (state.f1Type === 'rangeBounds') {\n      return getBounds(state);\n    }\n    if (state.f1Type === 'rectBounds') {\n      return getBounds(state);\n    }\n    if (state.f1Type === 'lineBounds') {\n      return getBounds(state);\n    }\n    if (state.f1Type === 'transformBounds') {\n      return getBounds(state);\n    }\n    if (state.f1Type === 'de') {\n      return assignAsLinkOnly(figure.getElement(state.state));\n    }\n    if (state.f1Type === 'positionAnimationStep') {\n      return new PositionAnimationStep()._fromState(\n        parseState(state.state, figure),\n        figure.getElement.bind(figure),\n      );\n    }\n    if (state.f1Type === 'rotationAnimationStep') {\n      return new RotationAnimationStep()._fromState(\n        parseState(state.state, figure),\n        figure.getElement.bind(figure),\n      );\n    }\n    if (state.f1Type === 'scaleAnimationStep') {\n      return new ScaleAnimationStep()._fromState(\n        parseState(state.state, figure),\n        figure.getElement.bind(figure),\n      );\n    }\n    if (state.f1Type === 'transformAnimationStep') {\n      return new TransformAnimationStep()._fromState(\n        parseState(state.state, figure),\n        figure.getElement.bind(figure),\n      );\n    }\n    if (state.f1Type === 'scenarioAnimationStep') {\n      return new ScenarioAnimationStep()._fromState(\n        parseState(state.state, figure),\n        figure.getElement.bind(figure),\n      );\n    }\n    if (state.f1Type === 'colorAnimationStep') {\n      return new ColorAnimationStep()._fromState(\n        parseState(state.state, figure),\n        figure.getElement.bind(figure),\n      );\n    }\n    if (state.f1Type === 'opacityAnimationStep') {\n      return new OpacityAnimationStep()._fromState(\n        parseState(state.state, figure),\n        figure.getElement.bind(figure),\n      );\n    }\n    if (state.f1Type === 'pulseAnimationStep') {\n      return new PulseAnimationStep()._fromState(\n        parseState(state.state, figure),\n        figure.getElement.bind(figure),\n      );\n    }\n    if (state.f1Type === 'customAnimationStep') {\n      return new CustomAnimationStep()._fromState(\n        parseState(state.state, figure),\n        figure.getElement.bind(figure),\n      );\n    }\n    if (state.f1Type === 'delayAnimationStep') {\n      return new DelayAnimationStep()._fromState(\n        parseState(state.state, figure),\n        figure.getElement.bind(figure),\n      );\n    }\n    if (state.f1Type === 'parallelAnimationStep') {\n      return new ParallelAnimationStep()._fromState(\n        parseState(state.state, figure),\n        figure.getElement.bind(figure),\n      );\n    }\n    if (state.f1Type === 'serialAnimationStep') {\n      return new SerialAnimationStep()._fromState(\n        parseState(state.state, figure),\n        figure.getElement.bind(figure),\n      );\n    }\n    if (state.f1Type === 'triggerAnimationStep') {\n      return new TriggerAnimationStep()._fromState(\n        parseState(state.state, figure),\n        figure.getElement.bind(figure),\n      );\n    }\n    if (state.f1Type === 'animationBuilder') {\n      return new AnimationBuilder()._fromState(\n        parseState(state.state, figure),\n        figure.getElement.bind(figure),\n      );\n    }\n  }\n  const out = {};\n  Object.keys(state).forEach((property) => {\n    // console.log('prop', state, property)\n    // if (property === 'element') {\n    //   console.log(state[property].name)\n    // }\n    // console.log(property)\n    out[property] = parseState(state[property], figure);\n  });\n  return out;\n}\n\nexport default parseState;\n","module.exports = function() {\n  return new Worker(\"/static/workers/\" + \"d938525d8a3791514061.worker.js\");\n};","// @flow\n// import {\n//   PositionAnimationStep, AnimationBuilder,\n// } from './Animation/Animation';\n\n// import type Figure from './Figure';\n\n// import {\n//   getPoint, getTransform, getRect, getLine, Translation, Rotation, Scale,\n// } from '../tools/g2';\n// import parseState from './parseState';\n\nimport {\n  joinObjects,\n} from '../../tools/tools';\n\n// import parseState from './parseState';\n\n\nfunction getState(\n  obj: Object,\n  stateProperties: Array<string>,\n  optionsIn: {\n    precision?: number,\n    ignoreShown?: boolean,\n    min?: boolean,\n  },\n  // precision: number = 5,\n  // payload: any,\n) {\n  // const stateProperties = this._getStateProperties();\n  // const path = this.getPath();\n  const defaultOptions = {\n    precision: 5,\n    ignoreShown: false,\n    min: false,\n  };\n  const options = joinObjects({}, defaultOptions, optionsIn);\n  const { precision } = options;\n  const state: Object = {};\n  const processValue = (value) => {\n    if (typeof value === 'string') {\n      return value;\n    }\n    if (typeof value === 'number') {\n      return value;\n    }\n    if (typeof value === 'boolean') {\n      return value;\n    }\n    if (value == null) {\n      return value;\n    }\n    if (value._def != null) {\n      return value._def(precision);\n    }\n    if (value._state != null) {\n      return value._state(options);\n    }\n    if (Array.isArray(value)) {\n      const dupArray = [];\n      value.forEach((v) => {\n        // console.log('array v', v);\n        dupArray.push(processValue(v));\n      });\n      return dupArray;\n    }\n    // if (value._getState != null) {\n    //   console.log('v', value)\n    //   return value._getState();\n    // }\n    if (value._dup != null) {\n      return value._dup();\n    }\n    const out = {};\n    let keys = Object.keys(value);\n    if (value._stateKeys) {\n      keys = value._stateKeys();\n    }\n    let keysToUse = keys;\n    if (value._excludeStateKeys) {\n      keysToUse = [];\n      const excludedKeys = value._excludeStateKeys();\n      keys.forEach((key) => {\n        if (excludedKeys.indexOf(key) === -1) {\n          keysToUse.push(key);\n        }\n      });\n    }\n    keysToUse.forEach((key) => {\n      out[key] = processValue(value[key]);\n    });\n    return out;\n    // return joinObjects({}, value);\n  };\n  // console.log(stateProperties)\n  stateProperties.forEach((prop) => {\n    const processPath = (currentState, currentObj, remainingPath) => {\n      const [nextLevel] = remainingPath;\n      if (remainingPath.length === 1) {\n        return [currentState, currentObj, remainingPath[0]];\n      }\n      if (currentState[nextLevel] == null) {\n        currentState[nextLevel] = {}; // eslint-disable-line no-param-reassign\n      }\n      if (currentObj[nextLevel] == null) {\n        return null;\n      }\n      return processPath(currentState[nextLevel], currentObj[nextLevel], remainingPath.slice(1));\n    };\n    const result = processPath(state, obj, prop.split('.'));\n    if (result == null) {\n      return;\n    }\n    const [statePath, objPath, remainingProp] = result;\n    statePath[remainingProp] = processValue(objPath[remainingProp]);\n  });\n  return state;\n}\n\n// function parseState(state: Object, figure: Figure) {\n//   if (typeof state === 'number') {\n//     return state;\n//   }\n//   if (typeof state === 'string') {\n//     return state;\n//   }\n//   if (typeof state === 'boolean') {\n//     return state;\n//   }\n//   if (state == null) {\n//     return state;\n//   }\n\n//   if (Array.isArray(state)) {\n//     const out = [];\n//     state.forEach((stateElement) => {\n//       out.push(parseState(stateElement, figure));\n//     });\n//     return out;\n//   }\n//   if (state.f1Type != null) {\n//     if (state.f1Type === 'rect') {\n//       return getRect(state);\n//     }\n//     if (state.f1Type === 'p') {\n//       return getPoint(state);\n//     }\n//     if (state.f1Type === 'tf') {\n//       return getTransform(state);\n//     }\n//     if (state.f1Type === 't') {\n//       return new Translation(state);\n//     }\n//     if (state.f1Type === 's') {\n//       return new Scale(state);\n//     }\n//     if (state.f1Type === 'r') {\n//       return new Rotation(state);\n//     }\n//     if (state.f1Type === 'l') {\n//       return getLine(state);\n//     }\n//     if (state.f1Type === 'de') {\n//       return figure.getElement(state.state);\n//     }\n//     if (state.f1Type === 'positionAnimationStep') {\n//       return new PositionAnimationStep()._fromState(\n//         parseState(state.state, figure),\n//         figure.getElement.bind(figure),\n//       );\n//     }\n//     if (state.f1Type === 'animationBuilder') {\n//       return new AnimationBuilder()._fromState(\n//         parseState(state.state, figure),\n//         figure.getElement.bind(figure),\n//       );\n//     }\n//   }\n//   const out = {};\n//   Object.keys(state).forEach((property) => {\n//     out[property] = parseState(state[property], figure);\n//   });\n//   return out;\n// }\n\n// function assignStateToObject(\n//   state: Object,\n//   obj: Object,\n//   exceptIn: Array<string> | string = [],\n//   parentPath: string = '',\n//   figure: Figure,\n// ) {\n//   const except = typeof exceptIn === 'string' ? [exceptIn] : exceptIn;\n//   Object.keys(state).forEach((key) => {\n//     const keyPath = parentPath !== '' ? `${parentPath}.${key}` : key;\n//     if (except.indexOf(keyPath) !== -1) {\n//       return;\n//     }\n//     const value = state[key];\n//     if (typeof value === 'number'\n//       || typeof value === 'boolean'\n//       || typeof value === 'string'\n//       || value == null\n//       || typeof value === 'function'\n//       || Array.isArray(value)\n//     ) {\n//       // Only assign the value if:\n//       //    * Value is not undefined OR\n//       //    * Value is undefined and toObject[key] is undefined\n//       if (value !== undefined || obj[key] === undefined) {\n//         obj[key] = value;\n//       }\n//       return;\n//     }\n//     if (value.f1Type != null) {\n//       obj[key] = parseState(value, figure);\n//       return;\n//     }\n//     // If the fromObject[key] value is an object, but the toObject[key] value\n//     // is not an object, but then make toObject[key] an empty object\n//     const toValue = obj[key];\n//     if (typeof toValue === 'number'\n//       || typeof toValue === 'boolean'\n//       || typeof toValue === 'string'\n//       || toValue == null\n//       || typeof toValue === 'function'\n//       || Array.isArray(toValue)\n//     ) {\n//       // eslint-disable-next-line no-param-reassign\n//       obj[key] = {};\n//     }\n//     assignStateToObject(value, obj[key], except, keyPath, figure);\n//   });\n// }\nfunction setState(obj: Object, stateIn: Object) {\n  joinObjects(obj, stateIn);\n  // assignStateToObject(stateIn, obj, [], '', figure);\n  // const state = getDef(stateIn);\n\n  // Object.keys(state).forEach((prop) => {\n  //   const value = state[prop];\n  //   if (\n  //     typeof value === 'string'\n  //     || typeof value === 'number'\n  //     || typeof value === 'boolean'\n  //     || value === null) {\n  //   ) {\n  //     obj[prop] = value;\n  //   }\n  //   if (Array.isArray(value) && Array.isArray) {\n  //     for (let i = 0; i < value.length; i += 1)\n  //   }\n  //   if (obj[prop] != null && obj[prop]._setState != null) {\n  //     obj[prop]._setState(getDef(state[prop]));\n  //   } else {\n  //     setState(obj[prop], def())\n  //   }\n  // });\n}\n\n// function setState(obj: Object, state: Object) {\n//   const processValue = (value) => {\n//     if (\n//       typeof value === 'number'\n//       || typeof value === 'string'\n//       || typeof value === 'boolean'\n//       || value == null\n//     ) {\n//       return value;\n//     }\n//     if (Array.isArray(value)) {\n//       const out = [];\n//       value.forEach((v) => {\n//         out.push(processValue);\n//       });\n//       return out;\n//     }\n//     if (value._setState)\n//   };\n\n//   Object.keys(state).forEach((prop) => {\n//     const value = state[prop];\n//     if (\n//       typeof value === 'number'\n//       || typeof value === 'string'\n//       || typeof value === 'boolean'\n//       || value == null\n//     ) {\n//       obj[prop] = value; // eslint-disable-line no-param-reassign\n//       return;\n//     }\n//     if (Array.isArray(value)) {\n//       for (let i = 0; i < obj[prop].length; i += 1) {\n//         // eslint-disable-next-line no-param-reassign\n//         obj[prop][i] = setState(obj[prop][i], value);\n//       }\n//       return;\n//     }\n//     if (obj[prop]._setState != null) {\n//       obj[prop]._setState(value);\n//       return;\n//     }\n//     obj[prop] = setState(obj[prop], value); // eslint-disable-line no-param-reassign\n//   });\n// }\n\nexport { setState, getState };\n","// @flow\nimport { joinObjects } from '../tools/tools';\nimport { FigureElementCollection } from './Element';\nimport type { FigureElement, TypeElementPath } from './Element';\nimport type {\n  OBJ_Collection, OBJ_TextModifiersDefinition, OBJ_TextLines,\n} from './FigurePrimitives/FigurePrimitives';\nimport type Figure from './Figure';\nimport { Equation } from './Equation/Equation';\n// enterStateCommon\n// enterState\n// showCommon\n// show\n// transition\n// showForm\n// steadyStateCommon\n// steadyState\n// leaveStateCommon\n// leaveState\n\n/**\n * Last slide shown\n *\n * `'next'` | `'prev'` | number\n */\nexport type TypeSlideFrom = 'next' | 'prev' | number;\n\n/**\n * `(currentIndex: number, nextIndex: number) => void`\n */\nexport type TypeSlideLeaveStateCallback = (number, TypeSlideFrom) => void;\n\n/**\n * `(currentIndex: number, from: `{@link TypeSlideFrom}`) => void`\n */\nexport type TypeSlideStateCallback = (number, TypeSlideFrom) => void;\n\n/**\n * `(done: () => void, currentIndex: number, from: `{@link TypeSlideFrom}`) => void`\n *\n * The `done` parameter must be called at the end of the transition.\n */\nexport type TypeSlideTransitionCallback = (() => void, number, TypeSlideFrom) => void;\n\n/**\n * Slide definition options object.\n *\n * This object defines the state the figure should be set to when this slide\n * is navigated to.\n *\n * A slide definition has several callback properties that can be used to set\n * figure state including:\n *  - enterState: set an initial state\n *  - transition: define an animation for when moving to this slide\n *  - steadyState: set steady state, then wait for next navigation event\n *  - leaveState: set leave state when moving to another another slide\n *\n * It is good practice to try and make each slide's state independant of other\n * slides. If a square is shown on slides 4 and 5, then it should be explicitly\n * shown on both slides. If it is only shown on slide 4, then it will be fine\n * when the user navigates from slide 4 to 5, but will not be shown if the user\n * is navigating from slide 6 to 5. Allowing users to go to specific slides out\n * of order makes slide dependencies even more difficult.\n *\n * Therefore, the enter, steady and leave states above should be used to fully\n * define the figure's state on each slide.\n *\n * However, while this approach will yield a good user experience, developing\n * many slides, complex figures or numerous equation forms can make slide\n * definition verbose. Even though each slide is different, many slides may\n * share largely the same state, all of which needs to be explicitly defined\n * for each slide.\n *\n * The SlideNavigator tries to manage this by providing the fundamental state\n * callbacks above, as well as properties that can be defined once, and shared\n * between slides. Slides with shared, or common properties make copies of all\n * the properties so each slide is independant, but require the developer to\n * define them just once. If a slide doesn't define a common property, then it\n * will use the definition in the last slide that defined it.\n *\n * For example, the `enterStateCommon` property is a common property. If it is\n * defined in slides 4 and 7, then slides 0-3 will not have the property, slides\n * 4-6 will use the slide 4 definition, and slides 7 and after will all use\n * slide 7's definition.\n *\n * Common state properties include:\n * - enterStateCommon\n * - steadyStateCommon\n * - leaveStateCommon\n *\n * The reason some states have both a common and slide specific property\n * (such as steadyState and steadyStateCommon) is so the common property can\n * be best leveraged. If all properties were common, then they would need to be\n * redefined every time a small change was made. Having both common and slide\n * specific properties allows a balance of defining some state for a group of\n * slides once, while allowing specific changes to that state where needed.\n *\n * In addition to the above state properties, there are a number of short-cut\n * properties, that make it easy to set state for common figure elements. When\n * a SlideNavigator is instantiated, a text figure element, a figure collection\n * and one or more equation elements can be associated with it.\n *\n * The `text`, `modifier` and `modifierCommon` properties can be used to set\n * the text of the text figure element associated with the SlideNavigator.\n * `text` and `modifierCommon` are common properties.\n *\n * The `form` property is also common and can be used to automatically set the\n * form of the associated equation elements. A SlideNavigator can be associated\n * with one or more equations. The `form` property defines the form each of the\n * equations should be set to on this slide. If there is just one equation, then\n * the form property can be a string that is the form name. For two or more\n * equations, the form property should be an array of strings where each element\n * is the form name for the corresponding equation. The order of equations\n * passed into the SlideNavigator, needs to be the same as the order of strings\n * in the `form` array. To hide an equation, use a `null` instead of a string.\n * If the `form` property has less forms than equations, then all remaining\n * equations will be hidden.\n *\n * The `form` property is a short cut with several consequences:\n * - All equations with `null` forms will be hidden prior to the `enterState`s.\n * - If the slide doesn't have a `transition` defined, and if an equation form\n *   is changed, then a transition will be added that animates the equation form\n *   change. If `transition` is defined, and equation animation is required,\n *   then it needs to be defined in the `transition` property explicity.\n * - Each equation with a defined form will have `showForm` called on that form\n *   prior to the `steadyState`s.\n *\n * The life cycle of a slide change is:\n * - `leaveStateCommon` (for current slide)\n * - `leaveState` (for current slide)\n * - stop all animations\n * - Update associated text element with `text` property\n * - Hide all elements in associated collection\n * - `showCommon`\n * - `show`\n * - `hideCommon`\n * - `hide`\n * - `scenarioCommon`\n * - `scenario`\n * - Show navigator buttons, text element and equations with defined forms\n * - `enterStateCommon` (for new slide)\n * - `enterState`\n * - show `fromForm`\n * - `transition` or '`fromForm` to `form` animations\n * - show `form`\n * - `steadyStateCommon`\n * - `steadyState`\n * - Wait for next navigation event\n *\n * @property {OBJ_TextLines} [text] common property - With `modifiersCommon` and\n * `modifiers` define the text for the text element associated with the\n * SlideNavigator\n * @property {OBJ_TextModifiersDefinition} [modifiersCommon] common property\n * @property {OBJ_TextModifiersDefinition} [modifiers] will\n * overwrite any keys from `modifiersCommon` with the same name\n * @property {TypeElementPath} [showCommon] common property\n * @property {TypeElementPath} [show]\n * @property {TypeElementPath} [hideCommon] common property\n * @property {TypeElementPath} [hide]\n * @property {TypeSlideStateCallback} [enterStateCommon] common property\n * @property {TypeSlideStateCallback} [enterState]\n * @property {TypeSlideTransitionCallback} [transition] transititions are\n * only called when moving between adjacent slides in the forward direction.\n * Progressing backwards, or skipping around with `goToSlide` will not call\n * `transition`. A transition is a callback where animations can be defined. A\n * `done` function is passed to the callback and must be called at the end of\n * the animation to allow slide steadyStates to be set.\n * @property {TypeSlideStateCallback} [steadyStateCommon] common property\n * @property {TypeSlideStateCallback} [steadyState]\n * @property {TypeSlideLeaveStateCallback} [leaveStateCommon] common property\n * @property {TypeSlideLeaveStateCallback} [leaveState]\n * @property {string | Array<string | null> | null} [form] common property\n * @property {string | Array<string | null> | null} [fromForm]\n * @property {string | Array<string>} [scenarioCommon] common property\n * @property {string | Array<string>} [scenario]\n */\nexport type OBJ_SlideNavigatorSlide = {\n  text?: OBJ_TextLines,\n  modifiersCommon?: OBJ_TextModifiersDefinition;\n  modifiers?: OBJ_TextModifiersDefinition;\n  showCommon?: TypeElementPath;\n  show?: TypeElementPath;\n  hideCommon?: TypeElementPath;\n  hide?: TypeElementPath;\n  enterStateCommon?: TypeSlideStateCallback,\n  enterState?: TypeSlideStateCallback,\n  transition?: TypeSlideTransitionCallback;\n  steadyStateCommon?: TypeSlideStateCallback;\n  steadyState?: TypeSlideStateCallback;\n  leaveStateCommon?: TypeSlideLeaveStateCallback;\n  leaveState?: TypeSlideLeaveStateCallback;\n  fromForm?: string | Array<string | null> | null;\n  form?: string | Array<string | null> | null;\n  scenarioCommon?: string | Array<string>;\n  scenario?: string | Array<string>;\n}\n\n/**\n * Default equation animation properties for the {@link SlideNavigator}\n * @property {number} [duration] default duration of equation animation\n * @property {\"move\" | \"dissolve\" | \"moveFrom\" | \"pulse\" | \"dissolveInThenMove\"} [animate]\n   default style of equation animation\n */\nexport type OBJ_EquationDefaults = {\n  duration?: number,\n  animate?: \"move\" | \"dissolve\" | \"moveFrom\" | \"pulse\" | \"dissolveInThenMove\",\n};\n\n/**\n * SlideNavigator options object\n *\n * The options here associate a number of {@link FigureElement}s with the\n * {@link SlideNavigator}, which will be ustilized by the slide definitions in\n * {@link OBJ_SlideNavigatorSlide}.\n *\n * The `collection` property associates a {@link FigureElementCollection}. If a\n * {@link Figure} is passed in, then the root level collection will be\n * used. All animations in slide `transitions` should be attached to\n * this collection or its children as this is the collection that will be\n * stopped when skipping slides. All string definitions of other elements\n * will be relative to this collection, and therefore must be children of\n * this collection. A collection must be passed in.\n *\n * `prevButton` and `nextButton` are buttons that can be used to progress\n * backwards and forwards through the slides. The SlideNavigator will\n * disable `prevButton` on the first slide and update `nextButton` label\n * (if it exists) with `'restart'` when at the last slide.\n *\n * `text` is a {@link OBJ_TextLines} figure element that will be updated\n * with the `text` property in {@link OBJ_SlideNavigatorSlide}\n *\n * `equation` is one or more {@link Equation} elements to associate with the\n * SlideNavigator. Each associated equation will be operated on by the `form`\n * property in {@link OBJ_SlideNavigatorSlide}. Use `OBJ_EquationDefaults` to\n * set default equation animation properties when `form` creates slide\n * transitions.\n *\n * @property {Figure | FigureElementCollection} collection\n * @property {Array<OBJ_NavigatorSlide>} [slides]\n * @property {null | FigureElement | string} [prevButton]\n * @property {null | FigureElement | string} [nextButton]\n * @property {null | string | FigureElementCollection} [text]\n * @property {Equation | string | Array<string | Equation>} [equation]\n * @property {OBJ_EquationDefaults} [equationDefaults]\n */\nexport type OBJ_SlideNavigator = {\n  collection: Figure | FigureElementCollection,\n  slides?: Array<OBJ_SlideNavigatorSlide>,\n  prevButton?: ?FigureElement | string,\n  nextButton?: ?FigureElement | string,\n  text?: string | FigureElementCollection,\n  equation?: Equation | string | Array<string | Equation>,\n  equationDefaults?: OBJ_EquationDefaults,\n} & OBJ_Collection;\n\n/**\n * Slide Navigator\n *\n * It is sometimes useful to break down a visualization into easier to consume\n * parts.\n *\n * For example, a complex figure or concept can be made easier if built up\n * from a simple begining. Each step along the way might change the elements\n * within the figure, or the form of an equation, and be accompanied by a\n * corresponding description giving context, reasoning or next steps.\n *\n * An analogy to this is a story or presentation, where each step along the way\n * is a presentation slide.\n *\n * This class is a simple slide navigator, providing a convenient way to define\n * slides and step through them.\n *\n * {@link CollectionsSlideNavigator} creates the navigation buttons, and\n * `textElement` automatically, and will usually be more convenient than\n * manually creating thema (unless custom buttons are needed).\n *\n * @see {@link CollectionsSlideNavigator} for examples.\n */\nexport default class SlideNavigator {\n  currentSlideIndex: number;\n  slides: Array<OBJ_SlideNavigatorSlide>;\n  prevButton: ?FigureElement;\n  nextButton: ?FigureElement;\n  textElement: ?FigureElement;\n  inTransition: boolean;\n  equations: Array<FigureElement>;\n  collection: FigureElementCollection;\n  equationDefaults: {\n    duration: number,\n    animate: \"move\" | \"dissolve\" | \"moveFrom\" | \"pulse\" | \"dissolveInThenMove\",\n  };\n\n  /**\n   * @param {OBJ_SlideNavigator | null} options use `null` to load options later\n   * with the `load` method. Options should only be loaded when an instantiated\n   * {@link FigureElementCollection} is available for the `collections`\n   * property.\n   */\n  constructor(options: OBJ_SlideNavigator | null = null) {\n    if (options != null) {\n      this.load(options);\n    }\n  }\n\n  /**\n   * Load options after object instantiation. Usefull for if the\n   * `collection`, `prevButton`, `nextButton`, `equation` and/or `text` figure\n   * elements are not available at instantiation.\n   *\n   * @param {OBJ_SlideNavigator} options\n   */\n  load(options: OBJ_SlideNavigator) {\n    const o = options;\n    if (o.collection instanceof FigureElementCollection) {\n      this.collection = o.collection;\n    } else if (o.collection != null && o.collection.elements != null) {\n      this.collection = o.collection.elements;\n    }\n    if (o.slides != null) {\n      this.slides = o.slides;\n    }\n    if (typeof o.text === 'string') {\n      this.textElement = this.collection.getElement(o.text);\n    } else if (o.text != null) {\n      this.textElement = o.text;\n    } else {\n      this.textElement = null;\n    }\n    let equations = [];\n    if (Array.isArray(o.equation)) {\n      equations = o.equation;\n    } else if (o.equation != null) {\n      equations = [o.equation];\n    }\n    this.setEquations(equations);\n    this.equationDefaults = joinObjects({}, {\n      duration: 1,\n      animate: 'move',\n    }, o.equationDefaults || {});\n    if (o.prevButton) {\n      this.prevButton = this.collection.getElement(o.prevButton);\n    }\n    if (o.nextButton) {\n      this.nextButton = this.collection.getElement(o.nextButton);\n    }\n    this.currentSlideIndex = 0;\n    this.inTransition = false;\n    const { prevButton, nextButton } = this;\n    if (prevButton != null) {\n      prevButton.onClick = this.prevSlide.bind(this);\n    }\n    if (nextButton != null) {\n      nextButton.onClick = this.nextSlide.bind(this, false);\n    }\n\n    if (this.slides == null && this.equations.length === 1) {\n      const [equation] = this.equations;\n      if (equation instanceof Equation) {\n        const { eqn } = equation;\n        if (eqn.currentFormSeries != null && eqn.currentFormSeries.length > 0) {\n          this.slides = [];\n          eqn.currentFormSeries.forEach(f => this.slides.push({ form: `${f}` }));\n        }\n      }\n    }\n  }\n\n  setEquations(equationsIn: Array<string | Equation>) {\n    const equations = [];\n    equationsIn.forEach((e) => {\n      const element = this.collection.getElement(e);\n      if (element != null) {\n        equations.push(element);\n      }\n    });\n    this.equations = equations;\n  }\n\n  getProperty(property: string, indexIn: number, defaultValue: any = null) {\n    let index = indexIn;\n    let prop = this.slides[index][property];\n    while (prop === undefined && index > 0) {\n      index -= 1;\n      prop = this.slides[index][property];\n    }\n    if (prop === undefined) {\n      return defaultValue;\n    }\n    return prop;\n  }\n\n  getText(index: number) {\n    return this.getProperty('text', index, '');\n  }\n\n  getForm(index: number) {\n    const forms = this.getProperty('form', index, null);\n    if (forms === undefined) {\n      return [];\n    }\n    if (!Array.isArray(forms)) {\n      return [forms];\n    }\n    return forms;\n  }\n\n  getFromForm(index: number): Array<string | null> {\n    const { fromForm } = this.slides[index];\n    if (fromForm === undefined) {\n      return [];\n    }\n    if (Array.isArray(fromForm)) {\n      return fromForm;\n    }\n    return [fromForm];\n  }\n\n  showForms(forms: Array<string | null>, hideOnly: boolean = false) {\n    for (let i = 0; i < this.equations.length; i += 1) {\n      const e = this.collection.getElement(this.equations[i]);\n      if (e != null) {\n        if (forms.length > i && forms[i] != null) {\n          if (!hideOnly) {  // $FlowFixMe\n            e.showForm(forms[i]);\n          }\n        } else {\n          e.hide();\n        }\n      }\n    }\n  }\n\n  setSteadyState(from: 'next' | 'prev' | number) {\n    const index = this.currentSlideIndex;\n    const slide = this.slides[index];\n    const form = this.getForm(index);\n    this.showForms(form);\n    this.getProperty('steadyStateCommon', index, () => {})(index, from);\n    if (slide.steadyState != null) {\n      slide.steadyState(index, from);\n    }\n    const { prevButton, nextButton } = this;\n    if (prevButton != null) {\n      if (this.currentSlideIndex === 0) {\n        prevButton.setOpacity(0.7);\n        prevButton.isTouchable = false;\n      } else if (prevButton.isTouchable === false) {\n        prevButton.setOpacity(1);\n        prevButton.isTouchable = true;\n      }\n    }\n    if (nextButton != null) {\n      if (this.currentSlideIndex === this.slides.length - 1) {  // $FlowFixMe\n        nextButton.setLabel('Restart');\n      } else {  // $FlowFixMe\n        nextButton.setLabel('Next');\n      }\n    }\n  }\n\n  transition(from: 'next' | 'prev' | number) {\n    let done = () => {\n      this.setSteadyState(from);\n      this.inTransition = false;\n    };\n    if (from !== 'prev') {\n      return done();\n    }\n    this.inTransition = true;\n    const slide = this.slides[this.currentSlideIndex];\n    if (typeof slide.transition === 'function') {\n      return slide.transition(done, this.currentSlideIndex, from);\n    }\n\n    const forms = this.getForm(this.currentSlideIndex);\n    const fromForms = this.getFromForm(this.currentSlideIndex);\n    if (forms.length === 0 || fromForms.length === 0) {\n      return done();\n    }\n    for (let i = 0; i < this.equations.length; i += 1) {\n      const e = this.collection.getElement(this.equations[i]);\n      if (\n        e != null\n        && e instanceof Equation\n        && forms.length > i\n        && fromForms.length > i\n        && forms[i] != null\n        && fromForms[i] !== forms[i]\n      ) {\n        const form = forms[i];\n        const fromForm = fromForms[i];\n        if (fromForm === null) {\n          e.showForm(form);\n          e.animations.new()\n            .dissolveIn(0.4)\n            // .inParallel([\n            //   e.animations.dissolveIn({ duration: 0.2 }),\n            //   e.animations.trigger({\n            //     callback: () => {\n            //       e.showForm(form);\n            //     },\n            //   }),\n            // ])\n            .whenFinished(done)\n            .start();\n          done = null;\n        } else if (fromForm !== null) {\n          const { animate, duration } = this.equationDefaults;\n          e.animations.new()\n            .goToForm({ target: form, animate, duration })\n            .whenFinished(done)\n            .start();\n          done = null;\n        }\n      }\n    }\n    if (done != null) {\n      return done();\n    }\n    return null;\n  }\n\n  setText(index: number) {\n    const { textElement } = this;\n    if (textElement == null) {\n      return;\n    }\n    const mods = this.getProperty('modifiers', index, {});\n    const commonMods = this.getProperty('modifiersCommon', index, {});\n    const text = this.getText(index) || ' ';\n    textElement.custom.updateText({\n      text,\n      modifiers: joinObjects({}, commonMods, mods),\n    });\n  }\n\n  showElements(index: number) {\n    const showCommon = this.getProperty('showCommon', index, []);\n    const show = this.slides[index].show || [];\n    this.collection.show(showCommon);\n    this.collection.show(show);\n    if (show != null && Array.isArray(show)) {\n      this.collection.show();\n    }\n    if (this.nextButton != null) {\n      this.nextButton.showAll();\n    }\n    if (this.prevButton != null) {\n      this.prevButton.showAll();\n    }\n    if (this.textElement != null) {\n      this.textElement.showAll();\n    }\n  }\n\n  hideElements(index: number) {\n    const hideCommon = this.getProperty('hideCommon', index, []);\n    const hide = this.slides[index].hide || [];\n    this.collection.hide(hideCommon);\n    this.collection.hide(hide);\n  }\n\n  /**\n   * @param {number} index slide index to go to\n   * @param {'next' | 'prev' | number} from this should generally not be used\n   * and will be set automatically\n   */\n  goToSlide(index: number, from?: 'next' | 'prev' | number) {\n    if (this.slides == null || this.slides.length === 0) {\n      return;\n    }\n    let fromToUse = from;\n    if (fromToUse == null) {\n      fromToUse = this.currentSlideIndex;\n      if (index === this.currentSlideIndex + 1) {\n        fromToUse = 'prev';\n      } else if (index === this.currentSlideIndex - 1) {\n        fromToUse = 'next';\n      }\n    }\n\n    // Leave States\n    this.getProperty('leaveStateCommon', this.currentSlideIndex, () => {})(this.currentSlideIndex, index);\n    if (this.slides[this.currentSlideIndex].leaveState != null) {\n      this.slides[this.currentSlideIndex].leaveState(this.currentSlideIndex, index);\n    }\n\n    // Reset and Set Text\n    this.collection.stop('complete');\n    const { textElement } = this;\n    if (textElement != null) {\n      this.setText(index);\n      if (fromToUse === 'prev') {\n        const oldText = this.getText(this.currentSlideIndex);\n        const newText = this.getText(index);\n        if (JSON.stringify(newText) !== JSON.stringify(oldText)) {\n          textElement.animations.new()\n            .dissolveIn(0.2)\n            .start();\n        }\n      }\n    }\n\n    // Enter new slide\n    this.currentSlideIndex = index;\n    const slide = this.slides[index];\n    this.collection.hideAll();\n    this.showElements(index);\n    this.hideElements(index);\n    this.collection.setScenarios(this.getProperty('scenarioCommon', index, []));\n    this.collection.setScenarios(slide.scenario || []);\n    this.getProperty('enterStateCommon', index, () => {})(index, fromToUse);\n    if (slide.enterState != null) {\n      slide.enterState(index, fromToUse);\n    }\n    const fromForm = this.getFromForm(index);\n    this.showForms(fromForm);\n    // Move to transition\n    this.transition(fromToUse);\n  }\n\n  /**\n   * Progress to next slide.\n   *\n   * @param {boolean} ignoreTransition when `false`, if the slide is still in\n   * a transition when nextSlide is called, then the transition will skip\n   * through to the end, without moving to the next slide - effectively skipping\n   * through to the steady state of the current slide. If `true`, then the\n   * transition will instantly complete, setState and leaveStates called and the\n   * next slide will be progressed to.\n   */\n  nextSlide(ignoreTransition: boolean = false) {\n    if (this.inTransition) {\n      this.collection.stop('complete');\n      if (!ignoreTransition) {\n        return;\n      }\n    }\n    const nextSlideIndex = (this.currentSlideIndex + 1) % this.slides.length;\n    this.goToSlide(nextSlideIndex);\n    this.collection.animateNextFrame();\n  }\n\n  /**\n   * Progress to the previous slide.\n   */\n  prevSlide() {\n    this.collection.stop('complete');\n    let prevSlideIndex = this.currentSlideIndex - 1;\n    if (prevSlideIndex < 0) {\n      prevSlideIndex = this.slides.length - 1;\n    }\n    this.goToSlide(prevSlideIndex);\n    this.collection.animateNextFrame();\n  }\n}\n\n","// @flow\nimport {\n  Point, Line, Transform, getPoint,\n} from '../../tools/g2';\nimport {\n  joinObjects, joinObjectsWithOptions,\n} from '../../tools/tools';\nimport { getPolygonPoints } from './polygon/polygon';\nimport type { OBJ_Arrow } from '../FigurePrimitives/FigurePrimitives';\n// import { makePolyLine } from './lines/lines';\n\n/**\n * Arrow heads\n *\n * `'triangle' | 'circle' | 'line' | 'barb' | 'bar' | 'polygon' | 'rectangle'`\n *\n * @see {@link OBJ_Arrow} for properties related to each arrow head\n */\nexport type TypeArrowHead = 'triangle' | 'circle' | 'line' | 'barb' | 'bar' | 'polygon' | 'reverseTriangle' | 'rectangle';\n\n\n/**\n * Arrow end for a line or polyline.\n *\n * ![](./apiassets/arrow_line.png)\n *\n * Arrows on the end of lines have many of the same properties as stand\n * alone arrows {@link OBJ_Arrow}.\n *\n * The `align` property descripes where the line stops relative to the arrow.\n * `'start'` will be most useful for pointed arrows. When there is no tail, or\n * a zero length tail, `'mid'` can be useful with '`polygon`', '`circle`' and\n * '`bar`' as then the shapes will be centered on the end of the line. Note\n * that in this case the shape will extend past the line.\n *\n * @property {TypeArrowHead} [head] head style (`'triangle'`)\n * @property {number} [scale] scale the default dimensions of the arrow\n * @property {number} [length] dimension of the arrow head along the line\n * @property {number} [width] dimension of the arrow head along the line width\n * @property {number} [rotation] rotation of the polygon when `head = 'polygon'`\n * @property {number} [sides] number of sides in polygon or circle arrow head\n * @property {number} [radius] radius of polygon or circle arrow head\n * @property {number} [barb] barb length (along the length of the line) of the\n * barb arrow head\n * @property {boolean | number} [tail] `true` includes a tail in the arrow of\n * with `tailWidth`. A `number` gives the tail a length where 0 will not\n * extend the tail beyond the boundaries of the head\n * @property {'start' | 'mid'} [align] define which part of\n * the arrow is aligned at (0, 0) in draw space (`'start'`)\n *\n * @example\n * // Line with triangle arrows on both ends\n * figure.add({\n *   name: 'a',\n *   method: 'polyline',\n *   options: {\n *     points: [[0, 0], [1, 0]],\n *     width: 0.02,\n *     arrow: 'triangle',\n *   },\n * });\n *\n * @example\n * // Line with customized barb arrow at end only\n * figure.add({\n *   name: 'a',\n *   method: 'shapes.line',\n *   options: {\n *     p1: [0, 0],\n *     p2: [0, 1],\n *     width: 0.02,\n *     arrow: {\n *       end: {\n *         head: 'barb',\n *         width: 0.15,\n *         length: 0.25,\n *         barb: 0.05,\n *         scale: 2\n *       },\n *     },\n *     dash: [0.02, 0.02],\n *   },\n * });\n *\n * @example\n * // Three lines showing the difference between mid align and start align for\n * // circle heads\n * figure.add([\n *   {\n *     name: 'reference',\n *     method: 'polyline',\n *     options: {\n *       points: [[0, 0.3], [0.5, 0.3]],\n *     },\n *   },\n *   {\n *     name: 'start',\n *     method: 'polyline',\n *     options: {\n *       points: [[0, 0], [0.5, 0]],\n *       arrow: {\n *         head: 'circle',\n *         radius: 0.1,\n *       },\n *     },\n *   },\n *   {\n *     name: 'mid',\n *     method: 'polyline',\n *     options: {\n *       points: [[0, -0.3], [0.5, -0.3]],\n *       arrow: {\n *         head: 'circle',\n *         radius: 0.1,\n *         align: 'mid',     // circle mid point is at line end\n *       },\n *     },\n *   },\n * ]);\n */\nexport type OBJ_LineArrow = {\n  head?: TypeArrowHead,\n  scale?: number,\n  length?: number,\n  width?: number,\n  rotation?: number,\n  sides?: number,\n  radius?: number,\n  barb?: number,\n  tail?: boolean,\n  align?: 'start' | 'mid',\n}\n\n\n/**\n * Line end's arrow definition options object.\n *\n * `start` and `end` define the properties of the arrows at the start and\n * end of the line. Instead of defining {@link OBJ_LineArrow} objects for the\n * start and end, a string that is the arrow's `head` property can also be\n * used and the size dimensions will be the default.\n *\n * All other properties will be used as the default for the `start` and\n * `end` objects.\n *\n * If any of the default properties are defined, then the line will have\n * both a start and end arrow.\n *\n * If only one end of the line is to have an arrow, then define only the\n * `start` or `end` properties and no others.\n *\n * @property {OBJ_LineArrow | TypeArrowHead} [start] arrow at start of line\n * @property {OBJ_LineArrow | TypeArrowHead} [end] arrow at end of line\n * @property {TypeArrowHead} [head] default head to use for start and end arrow\n * @property {number} [scale] default scale to use for start and end arrow\n * @property {number} [length] default length to use for start and end arrow\n * @property {number} [width] default width to use for start and end arrow\n * @property {number} [rotation] default rotation to use for start and end arrow\n * @property {number} [sides] default sides to use for start and end arrow\n * @property {number} [radius] default radius to use for start and end arrow\n * @property {number} [barb] default barb to use for start and end arrow\n * @property {number} [tailWidth] width of the line that joins the arrow - if\n * defined this will create minimum dimensions for the arrow\n * @property {boolean | number} [tail] `true` includes a tail in the arrow of\n * with `tailWidth`. A `number` gives the tail a length where 0 will not\n * extend the tail beyond the boundaries of the head\n * @property {'start' | 'mid'} [align] define which part of\n * the arrow is aligned at (0, 0) in draw space (`'start'`)\n */\nexport type OBJ_LineArrows = {\n  start: OBJ_LineArrow | TypeArrowHead,\n  end: OBJ_LineArrow | TypeArrowHead,\n  head?: TypeArrowHead,\n  scale?: number,\n  length?: number,\n  width?: number,\n  rotation?: number,\n  sides?: number,\n  radius?: number,\n  barb?: number,\n  tailWidth?: number,\n  tail?: boolean | number,\n  align?: 'start' | 'mid',\n};\n\n\nfunction orientArrow(\n  // points: Array<Point>,\n  border: Array<Point>,\n  touchBorder: Array<Point>,\n  tail: Array<Point>,\n  length: number,\n  joinLength: number,\n  options: {\n    drawPosition: Point,\n    align: 'tip' | 'start' | 'mid' | 'tail',\n    angle: number,\n  },\n) {\n  let matrix;\n  // console.log(options.drawPosition)\n  if (options.align === 'start') {\n    matrix = new Transform()\n      .translate(length, 0)\n      .rotate(options.angle)\n      .translate(options.drawPosition)\n      .matrix();\n  } else if (options.align === 'tip') {\n    matrix = new Transform()\n      .rotate(options.angle)\n      .translate(options.drawPosition)\n      .matrix();\n  } else if (options.align === 'mid') {\n    matrix = new Transform()\n      .translate(length / 2, 0)\n      .rotate(options.angle)\n      .translate(options.drawPosition)\n      .matrix();\n  } else {\n    matrix = new Transform()\n      .translate(joinLength, 0)\n      .rotate(options.angle)\n      .translate(options.drawPosition)\n      .matrix();\n  }\n  // const line = new Line(start, end);\n  // const matrix = new Transform().rotate(line.angle()).translate(start).matrix();\n  // const newPoints: Array<Point> = points.map(p => p.transformBy(matrix));\n  const newBorder: Array<Point> = border.map(p => p.transformBy(matrix));\n  const newTouchBorder: Array<Point> = touchBorder.map(p => p.transformBy(matrix));\n  const newTail: Array<Point> = tail.map(p => p.transformBy(matrix));\n  return [\n    // newPoints,\n    newBorder, newTouchBorder, newTail,\n    // points.length,\n  ];\n}\n\nfunction getTouchBorder(l, w, buffer) {\n  return [\n    new Point(-l - buffer, -w / 2 - buffer),\n    new Point(buffer, -w / 2 - buffer),\n    new Point(buffer, w / 2 + buffer),\n    new Point(-l - buffer, w / 2 + buffer),\n  ];\n}\n\nfunction dup(pnts: Array<Point>): Array<Point> {\n  return pnts.map(p => p._dup());\n}\n/*\n.########.########..####....###....##....##..######...##.......########\n....##....##.....##..##....##.##...###...##.##....##..##.......##......\n....##....##.....##..##...##...##..####..##.##........##.......##......\n....##....########...##..##.....##.##.##.##.##...####.##.......######..\n....##....##...##....##..#########.##..####.##....##..##.......##......\n....##....##....##...##..##.....##.##...###.##....##..##.......##......\n....##....##.....##.####.##.....##.##....##..######...########.########\n*/\n//                    ...............\n//                    A              |\\\n//                    :              |  \\\n//                    :              |    \\\n//                    :              |      \\\n//                    :              |        \\\n//            width   :              |          \\\n//                    :              |            \\\n//                    :              |              \\  (0, 0)\n//    . . . . . . . . : . . . . . . .| . . . . . . . * . . . . . . . . . . . .\n//                    :         end  |              / tip\n//                    :              |            /\n//                    :              |          /\n//                    :              |        /\n//                    :              |      /\n//                    :              |    /\n//                    :              |  /   length\n//                    V..............|/<------------->\n//\n//\nfunction getTriangleArrowTail(o: {\n  length: number,\n  width: number,\n  tailWidth: number,\n  tail: boolean | number,\n}) {\n  let t = 0;\n  if (typeof o.tail === 'number') {\n    t = o.tail;\n  }\n  t = Math.max(0, t);\n  let headX = -o.length;\n  if (t > 0) {\n    headX = -(o.length - t);\n  }\n  const tailX = -o.length;\n  return [new Point(tailX, o.tailWidth / 2), headX, tailX];\n}\n\n\nfunction getTriangleArrowLength(o: {\n  length: number,\n  width: number,\n  tailWidth: number,\n  tail: boolean | number,\n}) {\n  return [o.length, o.length, o.length];\n}\n\nfunction getTriangleDefaults(o: {\n  length?: number,\n  width?: number,\n  tailWidth?: number,\n  scale?: number,\n}) {\n  let {\n    length, width, tailWidth, scale,\n  } = o;\n  scale = scale == null ? 1 : scale;\n\n  if (width == null) {\n    if (tailWidth != null) {\n      width = tailWidth * 6 * scale;\n    } else if (length != null) {\n      width = length;\n    } else {\n      width = 1;\n    }\n  }\n  if (length == null) {\n    length = width;\n  }\n  if (tailWidth == null) {\n    tailWidth = width / 6 / scale;\n  }\n  return {\n    width, length, tailWidth,\n  };\n}\n\nfunction getTriangleArrow(options: {\n  length: number,\n  width: number,\n  tailWidth: number,\n  drawBorderBuffer: number,\n  tail: boolean | number,\n  lineWidth: number,\n}) {\n  const {\n    length, drawBorderBuffer, tailWidth, width, tail,\n  } = options;\n  const [backIntersect, headX, tailX] = getTriangleArrowTail(options);\n  let arrowBorder;\n  // let points: Array<Point>;\n  if (tail === false || backIntersect.x >= headX) {\n    arrowBorder = [\n      new Point(-length, -width / 2),\n      new Point(0, 0),\n      new Point(-length, width / 2),\n    ];\n  } else {\n    arrowBorder = [\n      new Point(tailX, -tailWidth / 2),\n      new Point(headX, -tailWidth / 2),\n      new Point(headX, -width / 2),\n      new Point(0, 0),\n      new Point(headX, width / 2),\n      new Point(headX, tailWidth / 2),\n      new Point(tailX, tailWidth / 2),\n    ];\n    // points = [\n    //   arrowBorder[4]._dup(), arrowBorder[2]._dup(), arrowBorder[3]._dup(),\n    //   arrowBorder[6]._dup(), arrowBorder[0]._dup(), arrowBorder[1]._dup(),\n    //   arrowBorder[6]._dup(), arrowBorder[1]._dup(), arrowBorder[5]._dup(),\n    // ];\n  }\n  const joinTail = [\n    new Point(tailX, tailWidth / 2),\n    new Point(tailX, -tailWidth / 2),\n  ];\n  let touchBorder = arrowBorder;\n  if (drawBorderBuffer > 0) {\n    touchBorder = getTouchBorder(length, width, drawBorderBuffer);\n  }\n  return [arrowBorder, touchBorder, joinTail];\n}\n\nfunction getTriangleTris(b: Array<Point>) {\n  if (b.length === 3) {\n    return dup(b);\n  }\n  return dup([\n    b[4], b[2], b[3],\n    b[6], b[0], b[1],\n    b[6], b[1], b[5],\n  ]);\n}\n\n/*\n.......########..########.##.....##....########.########..####\n.......##.....##.##.......##.....##.......##....##.....##..##.\n.......##.....##.##.......##.....##.......##....##.....##..##.\n.......########..######...##.....##.......##....########...##.\n.......##...##...##........##...##........##....##...##....##.\n.......##....##..##.........##.##.........##....##....##...##.\n.......##.....##.########....###..........##....##.....##.####\n*/\nfunction getReverseTriTail(o: {\n  length: number,\n  width: number,\n  tailWidth: number,\n  tail: boolean | number,\n}) {\n  const hLine = new Line([-o.length, o.tailWidth / 2], 1, 0);\n  let headTop = new Line([-o.length, 0], [0, o.width / 2]);\n  let i = hLine.intersectsWith(headTop).intersect || new Point(-o.length, o.tailWidth / 2);\n  let t = 0;\n  if (typeof o.tail === 'number') {\n    t = o.tail;\n  }\n  t = Math.max(i.x, t);\n  let headX = -o.length;\n  if (t > 0) {\n    headX = -(o.length - t);\n    headTop = new Line([headX, 0], [0, o.width / 2]);\n    i = hLine.intersectsWith(headTop).intersect || new Point(-o.length + t, o.tailWidth / 2);\n  }\n  let tailX = -o.length;\n  if (t < 0) {\n    if (-o.length - t >= i.x) {\n      tailX = i.x;\n    } else {\n      tailX = -o.length - t;\n    }\n  }\n  return [i, headX, tailX];\n}\n\nfunction getReverseTriLength(o: {\n  length: number,\n  width: number,\n  tailWidth: number,\n  tail: boolean | number,\n}) {\n  const [, , tailX] = getReverseTriTail(o);\n  return [o.length, -tailX, o.length];\n}\n\nfunction getReverseTriDefaults(o: {\n  length?: number,\n  width?: number,\n  tailWidth?: number,\n  barb?: number,\n  scale?: number,\n  // tail?: number,\n}) {\n  let {\n    length, width, tailWidth, scale,\n  } = o;\n  scale = scale == null ? 1 : scale;\n\n  if (width == null) {\n    if (tailWidth != null) {\n      width = tailWidth * 6 * scale;\n    } else if (length != null) {\n      width = length;\n    } else {\n      width = 1;\n    }\n  }\n  if (length == null) {\n    length = width;\n  }\n  if (tailWidth == null) {\n    tailWidth = width / 6 / scale;\n  }\n  return {\n    width, length, tailWidth,\n  };\n}\n\nfunction getReverseTriangleArrow(options: {\n  length: number,\n  width: number,\n  tailWidth: number,\n  drawBorderBuffer: number,\n  tail: boolean | number,\n}) {\n  const {\n    length, drawBorderBuffer, tailWidth, width, tail,\n  } = options;\n  const [intersect, headX, tailX] = getReverseTriTail(options);\n  let arrowBorder;\n  // let points;\n  if (tail === false || tailX >= intersect.x) {\n    arrowBorder = [\n      new Point(0, -width / 2),\n      new Point(0, width / 2),\n      new Point(-length, 0),\n    ];\n    // points = arrowBorder.map(p => p._dup());\n  } else if (tailX > headX) {\n    const vLine = new Line([tailX, -tailWidth / 2], [tailX, 0]);\n    const topLine = new Line([-length, 0], [0, width / 2]);\n    const i = vLine.intersectsWith(topLine).intersect || new Point(tailX, -tailWidth / 2);\n    arrowBorder = [\n      new Point(0, -width / 2),\n      new Point(0, width / 2),\n      new Point(intersect.x, tailWidth / 2),\n      new Point(tailX, tailWidth / 2),\n      new Point(i.x, i.y),\n      new Point(-length, 0),\n      new Point(i.x, -i.y),\n      new Point(tailX, -tailWidth / 2),\n      new Point(intersect.x, -tailWidth / 2),\n    ];\n    // points = [\n    //   arrowBorder[0]._dup(), arrowBorder[1]._dup(), arrowBorder[2]._dup(),\n    //   arrowBorder[0]._dup(), arrowBorder[2]._dup(), arrowBorder[8]._dup(),\n    //   arrowBorder[8]._dup(), arrowBorder[2]._dup(), arrowBorder[3]._dup(),\n    //   arrowBorder[8]._dup(), arrowBorder[3]._dup(), arrowBorder[7]._dup(),\n    //   arrowBorder[6]._dup(), arrowBorder[4]._dup(), arrowBorder[5]._dup(),\n    // ];\n  } else {\n    arrowBorder = [\n      new Point(0, -width / 2),\n      new Point(0, width / 2),\n      new Point(intersect.x, tailWidth / 2),\n      new Point(-length, tailWidth / 2),\n      new Point(-length, -tailWidth / 2),\n      new Point(intersect.x, -tailWidth / 2),\n    ];\n    // points = [\n    //   arrowBorder[0]._dup(), arrowBorder[1]._dup(), arrowBorder[2]._dup(),\n    //   arrowBorder[0]._dup(), arrowBorder[2]._dup(), arrowBorder[5]._dup(),\n    //   arrowBorder[2]._dup(), arrowBorder[3]._dup(), arrowBorder[4]._dup(),\n    //   arrowBorder[5]._dup(), arrowBorder[2]._dup(), arrowBorder[4]._dup(),\n    // ];\n  }\n  const joinTail = [\n    new Point(tailX, tailWidth / 2),\n    new Point(tailX, -tailWidth / 2),\n  ];\n  let touchBorder = arrowBorder;\n  if (drawBorderBuffer > 0) {\n    touchBorder = getTouchBorder(length, width, drawBorderBuffer);\n  }\n  return [arrowBorder, touchBorder, joinTail];\n}\n\nfunction getReverseTriangleTris(b: Array<Point>) {\n  if (b.length === 3) {\n    return dup(b);\n  }\n  if (b.length === 9) {\n    return dup([\n      b[0], b[1], b[2],\n      b[0], b[2], b[8],\n      b[8], b[2], b[3],\n      b[8], b[3], b[7],\n      b[6], b[4], b[5],\n    ]);\n  }\n  return dup([\n    b[0], b[1], b[2],\n    b[0], b[2], b[5],\n    b[2], b[3], b[4],\n    b[5], b[2], b[4],\n  ]);\n}\n\n/*\n.............########.....###....########..########.\n.............##.....##...##.##...##.....##.##.....##\n.............##.....##..##...##..##.....##.##.....##\n.............########..##.....##.########..########.\n.............##.....##.#########.##...##...##.....##\n.............##.....##.##.....##.##....##..##.....##\n.............########..##.....##.##.....##.########.\n*/\nfunction getBarbTail(o: {\n  length: number,\n  width: number,\n  tailWidth: number,\n  tail: boolean | number,\n  barb: number,\n}) {\n  let t = 0;\n  if (typeof o.tail === 'number') {\n    t = o.tail;\n  }\n  t = Math.max(-o.barb, t);\n  let headX = -o.length;\n  if (t > 0) {\n    headX = -(o.length - t);\n  }\n  let tailX = -o.length;\n  if (t < 0) {\n    if (-t < o.barb) {\n      tailX = -o.length - t;\n    } else {\n      tailX = headX + o.barb;\n    }\n  }\n  if (o.tail === false) {\n    tailX = headX + o.barb;\n  }\n  const line1 = new Line([tailX, o.tailWidth / 2], 1, 0);\n  const back = new Line([headX + o.barb, 0], [headX, o.width / 2]);\n  const backIntersect = line1.intersectsWith(back);\n  let i = backIntersect.intersect || new Point(tailX, o.tailWidth / 2);\n  if (backIntersect.withinLine === false) {\n    i = new Point(headX + o.barb, o.tailWidth / 2);\n  }\n  return [i, headX, tailX];\n}\n\nfunction getBarbLength(o: {\n  length: number,\n  width: number,\n  tailWidth: number,\n  tail: boolean | number,\n  barb: number,\n}) {\n  const [, , tailX] = getBarbTail(o);\n  return [o.length, -tailX, o.length];\n}\n\nfunction getBarbDefaults(o: {\n  length?: number,\n  width?: number,\n  tailWidth?: number,\n  barb?: number,\n  scale?: number,\n  // tail?: number,\n}) {\n  let {\n    length, width, tailWidth, barb, scale,\n  } = o;\n  scale = scale == null ? 1 : scale;\n\n  if (width == null) {\n    if (tailWidth != null) {\n      width = tailWidth * 6 * scale;\n    } else if (length != null) {\n      width = length;\n    } else if (barb != null) {\n      width = barb * 6 * scale;\n    } else {\n      width = 1;\n    }\n  }\n  if (length == null) {\n    length = width;\n  }\n  if (tailWidth == null) {\n    tailWidth = width / 6 / scale;\n  }\n  if (barb == null) {\n    barb = tailWidth * scale;\n  }\n  return {\n    width, length, barb, tailWidth,\n  };\n}\n\nfunction getBarbArrow(options: {\n  length: number,\n  width: number,\n  barb: number,\n  drawBorderBuffer: number,\n  tailWidth: number,\n  tail: boolean | number,\n}) {\n  const {\n    length, drawBorderBuffer, tailWidth, barb, width, tail,\n  } = options;\n  const [backIntersect, headX, tailX] = getBarbTail(options);\n  let arrowBorder;\n  // let points;\n  if (tail === false || backIntersect.x >= headX + barb) {\n    arrowBorder = [\n      new Point(-length + barb, 0),\n      new Point(-length, -width / 2),\n      new Point(0, 0),\n      new Point(-length, width / 2),\n    ];\n    // points = [\n    //   arrowBorder[0]._dup(), arrowBorder[1]._dup(), arrowBorder[2]._dup(),\n    //   arrowBorder[0]._dup(), arrowBorder[2]._dup(), arrowBorder[3]._dup(),\n    // ];\n  } else {\n    arrowBorder = [\n      new Point(tailX, -tailWidth / 2),\n      new Point(backIntersect.x, -tailWidth / 2),\n      new Point(headX, -width / 2),\n      new Point(0, 0),\n      new Point(headX, width / 2),\n      new Point(backIntersect.x, tailWidth / 2),\n      new Point(tailX, tailWidth / 2),\n    ];\n    // points = [\n    //   arrowBorder[0]._dup(), arrowBorder[1]._dup(), arrowBorder[5]._dup(),\n    //   arrowBorder[0]._dup(), arrowBorder[5]._dup(), arrowBorder[6]._dup(),\n    //   arrowBorder[2]._dup(), arrowBorder[3]._dup(), arrowBorder[1]._dup(),\n    //   arrowBorder[5]._dup(), arrowBorder[1]._dup(), arrowBorder[3]._dup(),\n    //   arrowBorder[5]._dup(), arrowBorder[3]._dup(), arrowBorder[4]._dup(),\n    // ];\n  }\n  const joinTail = [\n    new Point(tailX, tailWidth / 2),\n    new Point(tailX, -tailWidth / 2),\n  ];\n  let touchBorder = arrowBorder;\n  if (drawBorderBuffer > 0) {\n    touchBorder = getTouchBorder(length, width, drawBorderBuffer);\n  }\n  return [arrowBorder, touchBorder, joinTail];\n}\n\nfunction getBarbTris(b: Array<Point>) {\n  if (b.length === 4) {\n    return dup([\n      b[0], b[1], b[2],\n      b[0], b[2], b[3],\n    ]);\n  }\n  return dup([\n    b[0], b[1], b[5],\n    b[0], b[5], b[6],\n    b[2], b[3], b[1],\n    b[5], b[1], b[3],\n    b[5], b[3], b[4],\n  ]);\n}\n\n/*\n................########..########..######..########\n................##.....##.##.......##....##....##...\n................##.....##.##.......##..........##...\n................########..######...##..........##...\n................##...##...##.......##..........##...\n................##....##..##.......##....##....##...\n................##.....##.########..######.....##...\n*/\nfunction getRectTail(o: {\n  length: number,\n  width: number,\n  tailWidth: number,\n  tail: boolean | number,\n}) {\n  let t = 0;\n  if (typeof o.tail === 'number') {\n    t = o.tail;\n  }\n  t = Math.max(0, t);\n  let headX = -o.length;\n  if (t > 0) {\n    headX = -(o.length - t);\n  }\n  const tailX = -o.length;\n  return [new Point(tailX, o.tailWidth / 2), headX, tailX];\n}\n\nfunction getRectLength(o: {\n  length: number,\n  width: number,\n  tailWidth: number,\n  tail: boolean | number,\n  align: 'start' | 'mid',\n}) {\n  if (o.align === 'mid') {\n    return [o.length / 2, o.length / 2, o.length];\n  }\n  return [o.length, o.length, o.length];\n}\n\nfunction getRectDefaults(o: {\n  length?: number,\n  width?: number,\n  tailWidth?: number,\n  // barb?: number,\n  scale?: number,\n  // tail?: number,\n}) {\n  let {\n    length, width, tailWidth, scale,\n  } = o;\n  scale = scale == null ? 1 : scale;\n\n  if (width == null) {\n    if (tailWidth != null) {\n      width = tailWidth * 6 * scale;\n    } else if (length != null) {\n      width = length;\n    } else {\n      width = 1;\n    }\n  }\n  if (length == null) {\n    length = width;\n  }\n  if (tailWidth == null) {\n    tailWidth = width / 6 / scale;\n  }\n  return {\n    width, length, tailWidth,\n  };\n}\n\nfunction getBarDefaults(o: {\n  length?: number,\n  width?: number,\n  tailWidth?: number,\n  barb?: number,\n  scale?: number,\n  // tail?: number,\n}) {\n  let {\n    length, width, tailWidth, scale,\n  } = o;\n  scale = scale == null ? 1 : scale;\n\n  if (width == null) {\n    if (tailWidth != null) {\n      width = tailWidth * 6 * scale;\n    } else if (length != null) {\n      width = length * 6;\n    } else {\n      width = 1;\n    }\n  }\n  if (length == null) {\n    length = width / 6;\n  }\n  if (tailWidth == null) {\n    tailWidth = width / 6 / scale;\n  }\n  return {\n    width, length, tailWidth,\n  };\n}\n\nfunction getRectArrow(options: {\n  length: number,\n  width: number,\n  start: Point,\n  end: Point,\n  drawBorderBuffer: number,\n  tailWidth: number,\n  tail: number | boolean;\n}) {\n  const {\n    length, drawBorderBuffer, tailWidth, width, tail,\n  } = options;\n  const [backIntersect, headX, tailX] = getRectTail(options);\n  let arrowBorder;\n  // let points;\n  if (tail === false || backIntersect.x >= headX) {\n    arrowBorder = [\n      new Point(-length, -width / 2),\n      new Point(0, -width / 2),\n      new Point(0, width / 2),\n      new Point(-length, width / 2),\n    ];\n    // points = [\n    //   arrowBorder[0]._dup(), arrowBorder[1]._dup(), arrowBorder[2]._dup(),\n    //   arrowBorder[0]._dup(), arrowBorder[2]._dup(), arrowBorder[3]._dup(),\n    // ];\n  } else {\n    arrowBorder = [\n      new Point(tailX, -tailWidth / 2),\n      new Point(headX, -tailWidth / 2),\n      new Point(headX, -width / 2),\n      new Point(0, -width / 2),\n      new Point(0, width / 2),\n      new Point(headX, width / 2),\n      new Point(headX, tailWidth / 2),\n      new Point(tailX, tailWidth / 2),\n    ];\n    // points = [\n    //   arrowBorder[0]._dup(), arrowBorder[1]._dup(), arrowBorder[6]._dup(),\n    //   arrowBorder[0]._dup(), arrowBorder[6]._dup(), arrowBorder[7]._dup(),\n    //   arrowBorder[2]._dup(), arrowBorder[3]._dup(), arrowBorder[4]._dup(),\n    //   arrowBorder[2]._dup(), arrowBorder[4]._dup(), arrowBorder[5]._dup(),\n    // ];\n  }\n  const joinTail = [\n    new Point(tailX, tailWidth / 2),\n    new Point(tailX, -tailWidth / 2),\n  ];\n  let touchBorder = arrowBorder;\n  if (drawBorderBuffer > 0) {\n    touchBorder = getTouchBorder(length, width, drawBorderBuffer);\n  }\n\n  return [arrowBorder, touchBorder, joinTail];\n}\n\nfunction getRectTris(b: Array<Point>) {\n  if (b.length === 4) {\n    return dup([\n      b[0], b[1], b[2],\n      b[0], b[2], b[3],\n    ]);\n  }\n  return dup([\n    b[0], b[1], b[6],\n    b[0], b[6], b[7],\n    b[2], b[3], b[4],\n    b[2], b[4], b[5],\n  ]);\n}\n/*\n..........             ...##.......####.##....##.########\n..........             ...##........##..###...##.##......\n..........             ...##........##..####..##.##......\n..........             ...##........##..##.##.##.######..\n..........             ...##........##..##..####.##......\n..........             ...##........##..##...###.##......\n..........             ...########.####.##....##.########\n*/\n//              |\n//              |           \\      00000000000000\n//              |             \\  00000000000000\n//              |              00000000000000\n//              |            00000000000000\n//              |          00000000000000\n//              |        00000000000000\n//              |      00000000000000  \\\n//              |    00000000000000      \\ LineWidth\n//              |  00000000000000   o\n//           -- |00000000000000       o   theta\n//           A  |  0000000000          o\n//         b |  |    000000             o\n//           V  |    g 00               o\n//           --- -------------------------------\n//              |       |\n//              |<----->|\n//                  a\n//\n// theta = atan(height / width)\n//\n// angle g = 180 - theta - 90\n// b = lineWidth * sin(g)\n// a = lineWidth * cos(g)\nfunction getLineTail(o: {\n  length: number,\n  width: number,\n  tailWidth: number,\n  tail: boolean | number,\n}) {\n  let t = 0;\n  if (typeof o.tail === 'number') {\n    t = o.tail;\n  }\n\n  const theta = Math.atan(o.width / 2 / o.length);\n  const g = Math.PI - theta - Math.PI / 2;\n  const a = o.tailWidth * Math.cos(g);\n\n  let headX = -o.length;\n  let tailX = -o.length;\n  if (t > 0) {\n    headX = -(o.length - t);\n  }\n  const topOutsideLine = new Line([headX + a, o.width / 2], [0, 0]);\n  const topInsideLine = topOutsideLine.offset('bottom', o.tailWidth);\n  const line = new Line([headX, o.tailWidth / 2], 1, 0);\n  const outsideIntersect = topOutsideLine.intersectsWith(line).intersect\n    || new Point(headX, o.tailWidth / 2);\n  let insideIntersect = topInsideLine.intersectsWith(line).intersect\n    || new Point(headX, o.tailWidth / 2);\n  if (insideIntersect.x < -o.length) {\n    insideIntersect = new Point(-o.length, o.tailWidth / 2);\n  }\n  let zeroPoint;\n  const insideIntersectWithZero = topInsideLine\n    .intersectsWith(new Line([-o.length, 0], 1, 0));\n  if (!insideIntersectWithZero) {\n    zeroPoint = -o.length;\n  } else {\n    zeroPoint = insideIntersectWithZero.intersect.x;\n  }\n  if (!insideIntersectWithZero.isWithinLine || o.tail === false) {\n    tailX = -o.length;\n  }\n  let stubTail = false;\n  if (t < 0) {\n    if (-o.length - t > insideIntersect.x) {\n      tailX = insideIntersect.x;\n      stubTail = true;\n    } else {\n      tailX = -o.length - t;\n    }\n  }\n  if (o.tail === false) {\n    tailX = zeroPoint;\n  }\n  return [\n    new Point(outsideIntersect.x, o.tailWidth / 2),\n    headX, tailX, zeroPoint, topOutsideLine.p1, topInsideLine.p1,\n    stubTail, insideIntersect,\n  ];\n}\n\nfunction getLineLength(o: {\n  length: number,\n  width: number,\n  tailWidth: number,\n  tail: boolean | number,\n}) {\n  const [, , tailX] = getLineTail(o);\n  return [o.length, -tailX, o.length];\n}\n\nfunction getLineDefaults(o: {\n  length?: number,\n  width?: number,\n  tailWidth?: number,\n  barb?: number,\n  scale?: number,\n  // tail?: number,\n}) {\n  let {\n    length, width, tailWidth, scale,\n  } = o;\n  scale = scale == null ? 1 : scale;\n\n  if (width == null) {\n    if (tailWidth != null) {\n      width = tailWidth * 6 * scale;\n    } else if (length != null) {\n      width = length;\n    } else {\n      width = 1;\n    }\n  }\n  if (length == null) {\n    length = width;\n  }\n  if (tailWidth == null) {\n    tailWidth = width / 6 / scale;\n  }\n  return {\n    width, length, tailWidth,\n  };\n}\nfunction getLineArrow(options: {\n  length: number,\n  width: number,\n  start: Point,\n  end: Point,\n  drawBorderBuffer: number,\n  tailWidth: number,\n  tail: number | boolean,\n}) {\n  const {\n    length, drawBorderBuffer, tailWidth, width, tail,\n  } = options;\n\n  const [\n    frontIntersect, , tailX, zeroPoint, outsideTop, insideTop, stubTail,\n    insideIntersect,\n  ] = getLineTail(options);\n  let arrowBorder;\n  // let points;\n  if (tail === false || frontIntersect.x <= tailX) {\n    arrowBorder = [\n      new Point(outsideTop.x, -outsideTop.y),\n      new Point(0, 0),\n      new Point(outsideTop.x, outsideTop.y),\n      new Point(insideTop.x, insideTop.y),\n      new Point(zeroPoint, 0),\n      new Point(insideTop.x, -insideTop.y),\n    ];\n    // points = [\n    //   arrowBorder[0]._dup(), arrowBorder[1]._dup(), arrowBorder[5]._dup(),\n    //   arrowBorder[5]._dup(), arrowBorder[1]._dup(), arrowBorder[4]._dup(),\n    //   arrowBorder[4]._dup(), arrowBorder[1]._dup(), arrowBorder[3]._dup(),\n    //   arrowBorder[3]._dup(), arrowBorder[1]._dup(), arrowBorder[2]._dup(),\n    // ];\n  } else if (stubTail) {\n    arrowBorder = [\n      new Point(outsideTop.x, -outsideTop.y),\n      new Point(0, 0),\n      new Point(outsideTop.x, outsideTop.y),\n      new Point(insideTop.x, insideTop.y),\n      new Point(insideIntersect.x, insideIntersect.y),\n      new Point(insideIntersect.x, -insideIntersect.y),\n      new Point(insideTop.x, -insideTop.y),\n    ];\n    // points = [\n    //   arrowBorder[3]._dup(), arrowBorder[1]._dup(), arrowBorder[2]._dup(),\n    //   arrowBorder[3]._dup(), arrowBorder[4]._dup(), arrowBorder[1]._dup(),\n    //   arrowBorder[0]._dup(), arrowBorder[1]._dup(), arrowBorder[6]._dup(),\n    //   arrowBorder[6]._dup(), arrowBorder[1]._dup(), arrowBorder[5]._dup(),\n    //   arrowBorder[5]._dup(), arrowBorder[1]._dup(), arrowBorder[4]._dup(),\n    // ];\n  } else {\n    arrowBorder = [\n      new Point(outsideTop.x, -outsideTop.y),\n      new Point(0, 0),\n      new Point(outsideTop.x, outsideTop.y),\n      new Point(insideTop.x, insideTop.y),\n      new Point(insideIntersect.x, insideIntersect.y),\n      new Point(tailX, tailWidth / 2),\n      new Point(tailX, -tailWidth / 2),\n      new Point(insideIntersect.x, -insideIntersect.y),\n      new Point(insideTop.x, -insideTop.y),\n    ];\n    // points = [\n    //   arrowBorder[0]._dup(), arrowBorder[1]._dup(), arrowBorder[8]._dup(),\n    //   arrowBorder[8]._dup(), arrowBorder[1]._dup(), arrowBorder[7]._dup(),\n    //   arrowBorder[7]._dup(), arrowBorder[1]._dup(), arrowBorder[4]._dup(),\n    //   arrowBorder[4]._dup(), arrowBorder[1]._dup(), arrowBorder[2]._dup(),\n    //   arrowBorder[3]._dup(), arrowBorder[4]._dup(), arrowBorder[2]._dup(),\n    //   arrowBorder[5]._dup(), arrowBorder[7]._dup(), arrowBorder[4]._dup(),\n    //   arrowBorder[6]._dup(), arrowBorder[7]._dup(), arrowBorder[5]._dup(),\n    // ];\n  }\n  const joinTail = [\n    new Point(tailX, tailWidth / 2),\n    new Point(tailX, -tailWidth / 2),\n  ];\n  let touchBorder = arrowBorder;\n  if (drawBorderBuffer > 0) {\n    touchBorder = getTouchBorder(length, width, drawBorderBuffer);\n  }\n  return [arrowBorder, touchBorder, joinTail];\n}\n\nfunction getLineTris(b: Array<Point>) {\n  if (b.length === 6) {\n    return dup([\n      b[0]._dup(), b[1]._dup(), b[5]._dup(),\n      b[5]._dup(), b[1]._dup(), b[4]._dup(),\n      b[4]._dup(), b[1]._dup(), b[3]._dup(),\n      b[3]._dup(), b[1]._dup(), b[2]._dup(),\n    ]);\n  }\n  if (b.length === 7) {\n    return dup([\n      b[3]._dup(), b[1]._dup(), b[2]._dup(),\n      b[3]._dup(), b[4]._dup(), b[1]._dup(),\n      b[0]._dup(), b[1]._dup(), b[6]._dup(),\n      b[6]._dup(), b[1]._dup(), b[5]._dup(),\n      b[5]._dup(), b[1]._dup(), b[4]._dup(),\n    ]);\n  }\n  return dup([\n    b[0]._dup(), b[1]._dup(), b[8]._dup(),\n    b[8]._dup(), b[1]._dup(), b[7]._dup(),\n    b[7]._dup(), b[1]._dup(), b[4]._dup(),\n    b[4]._dup(), b[1]._dup(), b[2]._dup(),\n    b[3]._dup(), b[4]._dup(), b[2]._dup(),\n    b[5]._dup(), b[7]._dup(), b[4]._dup(),\n    b[6]._dup(), b[7]._dup(), b[5]._dup(),\n  ]);\n}\n\n/*\n.......########...#######..##.......##....##..######....#######..##....##\n.......##.....##.##.....##.##........##..##..##....##..##.....##.###...##\n.......##.....##.##.....##.##.........####...##........##.....##.####..##\n.......########..##.....##.##..........##....##...####.##.....##.##.##.##\n.......##........##.....##.##..........##....##....##..##.....##.##..####\n.......##........##.....##.##..........##....##....##..##.....##.##...###\n.......##.........#######..########....##.....######....#######..##....##\n*/\nfunction getPolygonTail(o: {\n  radius: number,\n  sides: number,\n  tailWidth: number,\n  rotation: number,\n  tail: boolean | number,\n}) {\n  if (o.tail === false) {\n    return getPolygonPoints({\n      radius: o.radius,\n      sides: o.sides,\n      sidesToDraw: o.sides,\n      rotation: 0,\n      offset: new Point(-o.radius, 0),\n      direction: 1,\n    });\n  }\n  let t = 0;\n  if (typeof o.tail === 'number') {\n    t = o.tail;\n  }\n  t = Math.max(0, t);\n  const topTheta = Math.PI - Math.asin(o.tailWidth / 2 / o.radius);\n  const bottomTheta = Math.PI + Math.asin(o.tailWidth / 2 / o.radius);\n  const sideAngle = Math.PI * 2 / o.sides;\n\n  const topSideNum = Math.floor(topTheta / sideAngle);\n  const bottomSideNum = Math.floor(bottomTheta / sideAngle);\n\n  const points = getPolygonPoints({\n    radius: o.radius,\n    sides: o.sides,\n    sidesToDraw: o.sides,\n    rotation: 0,\n    offset: new Point(-o.radius, 0),\n    direction: 1,\n  });\n  const topSide = new Line(\n    points[topSideNum], points[topSideNum + 1],\n  );\n  const bottomSide = new Line(\n    points[bottomSideNum], points[bottomSideNum + 1],\n  );\n  const hLineTop = new Line([-o.radius, o.tailWidth / 2], 1, 0);\n  const hLineBottom = new Line([-o.radius, -o.tailWidth / 2], 1, 0);\n\n  const topIntersect = hLineTop.intersectsWith(topSide).intersect\n    || new Point(-o.radius, o.tailWidth / 2);\n  const bottomIntersect = hLineBottom.intersectsWith(bottomSide).intersect\n    || new Point(-o.radius, -o.tailWidth / 2);\n  const outline = [\n    topIntersect,\n    new Point(-o.radius * 2 - t, o.tailWidth / 2),\n    new Point(-o.radius * 2 - t, -o.tailWidth / 2),\n    bottomIntersect,\n    ...points.slice(bottomSideNum + 1),\n    ...points.slice(0, topSideNum + 1),\n  ];\n  return outline;\n}\n\nfunction getPolygonLength(o: {\n  radius: number,\n  tail: boolean | number,\n  align: 'mid' | 'start',\n}) {\n  let t = 0;\n  if (typeof o.tail === 'number') {\n    t = Math.max(0, o.tail);\n  }\n  if (o.align === 'mid') {\n    if (o.tail === false) {\n      return [o.radius, o.radius, o.radius * 2 + t];\n    }\n    return [o.radius, o.radius, o.radius * 2 + t];\n  }\n  if (typeof o.tail === 'boolean') {\n    return [o.radius * 2, o.radius * 2, o.radius * 2];\n  }\n  const l = o.radius * 2 + t;\n  return [l, l, l];\n}\n\nfunction getPolygonDefaults(o: {\n  radius?: number,\n  sides?: number,\n  tailWidth?: number,\n  scale?: number,\n  // tail?: number,\n}) {\n  let {\n    radius, tailWidth, scale, sides,\n  } = o;\n  scale = scale == null ? 1 : scale;\n\n  if (radius == null) {\n    if (tailWidth != null) {\n      radius = tailWidth * 3 * scale;\n    } else {\n      radius = 1;\n    }\n  }\n  if (tailWidth == null) {\n    tailWidth = radius / 3 / scale;\n  }\n  if (sides == null) {\n    sides = 30;\n  }\n  return {\n    radius, tailWidth, sides,\n  };\n}\nfunction getPolygonArrow(options: {\n  // length: number,\n  // width: number,\n  radius: number,\n  start: Point,\n  end: Point,\n  drawBorderBuffer: number,\n  tailWidth: number,\n  sides: number,\n  rotation: number,\n  tail: number | boolean,\n}) {\n  const {\n    drawBorderBuffer, tailWidth, radius, tail,\n  } = options;\n\n  const outline = getPolygonTail(options);\n  // const points: Array<Point> = [];\n  // for (let i = 1; i < outline.length; i += 1) {\n  //   points.push(new Point(-radius, 0));\n  //   points.push(outline[i - 1]);\n  //   points.push(outline[i]);\n  // }\n  // points.push(new Point(-radius, 0));\n  // points.push(outline[outline.length - 1]);\n  // points.push(outline[0]);\n  let t = 0;\n  let tailJoin;\n  if (tail === false) {\n    tailJoin = [new Point(-radius * 2, tailWidth / 2), new Point(-radius * 2, -tailWidth / 2)];\n  } else {\n    if (typeof tail === 'number') {\n      t = Math.max(tail, 0);\n    }\n    tailJoin = [\n      new Point(-radius * 2 - t, tailWidth / 2),\n      new Point(-radius * 2 - t, -tailWidth / 2),\n    ];\n  }\n  let touchBorder = outline;\n  if (drawBorderBuffer > 0) {\n    touchBorder = getTouchBorder(radius * 2 + t, radius * 2, drawBorderBuffer);\n  }\n  return [outline, touchBorder, tailJoin];\n}\n\nfunction getPolygonTris(b: Array<Point>) {\n  const points: Array<Point> = [];\n  for (let i = 1; i < b.length; i += 1) {\n    points.push(b[0]);\n    points.push(b[i - 1]);\n    points.push(b[i]);\n  }\n  // console.log(points)\n  // points.push(new Point(-radius, 0));\n  // points.push(b[b.length - 1]);\n  // points.push(b[0]);\n  return points;\n}\n\n\nfunction getArrowLength(options: {\n  head: TypeArrowHead,\n  length: number,\n  tailWidth: number,\n  width: number,\n  radius: number,\n  align: 'mid' | 'start',\n  tail: number | boolean,\n  barb: number,\n  // reverse: boolean,\n}) {\n  const { head, length } = options;\n  if (head === 'circle' || head === 'polygon') {\n    return getPolygonLength(options);\n  }\n  if (head === 'line') {\n    // const line = new Line([0, -width / 2], [length, 0]);\n    // const horizontal = new Line([0, -tailWidth], [length, -tailWidth]);\n    // const i = horizontal.intersectsWith(line).intersect;\n    // return length - i.x;\n    return getLineLength(options);\n  }\n  if (head === 'reverseTriangle') {\n    return getReverseTriLength(options);\n  }\n  if (head === 'triangle') {\n    return getTriangleArrowLength(options);\n  }\n  if (head === 'barb') {\n    return getBarbLength(options);\n  }\n  if (head === 'rectangle' || head === 'bar') {\n    return getRectLength(options);\n  }\n  // if (head === 'triangle' && reverse) {\n  //   return 0;\n  // }\n  return [length, length, length];\n}\n\n\nfunction getArrow(options: {\n  head: TypeArrowHead,\n  length: number,\n  width: number,\n  barb: number,\n  start: Point,\n  end: Point,\n  drawBorderBuffer: number,\n  tailWidth: number,\n  radius: number,\n  rotation: number,\n  sides: number,\n  reverse: boolean,\n  tail: number | boolean,\n}) {\n  // let points;\n  let border;\n  let touchBorder;\n  let tail;\n  const o = joinObjects({}, options);\n  if (o.drawPosition != null) {\n    o.drawPosition = getPoint(o.drawPosition);\n  }\n  if (o.tailWidth > 0 && o.width < o.tailWidth) {\n    o.width = o.tailWidth * 0.001;\n  }\n  if (o.head === 'barb') {\n    [border, touchBorder, tail] = getBarbArrow(o);\n  } else if (o.head === 'rectangle' || o.head === 'bar') {\n    [border, touchBorder, tail] = getRectArrow(o);\n  } else if (o.head === 'line') {\n    [border, touchBorder, tail] = getLineArrow(o);\n  } else if (o.head === 'polygon' || o.head === 'circle') {\n    [border, touchBorder, tail] = getPolygonArrow(o);\n  } else if (o.head === 'reverseTriangle') {\n    [border, touchBorder, tail] = getReverseTriangleArrow(o);\n  } else {\n    [border, touchBorder, tail] = getTriangleArrow(o);\n  }\n  const [, joinLength, fullLength] = getArrowLength(o);\n  const [newBorder, borderBuffer, newTail] = orientArrow(\n    border, touchBorder, tail, fullLength, joinLength, o,\n  );\n  // const { line } = o;\n\n  // let lineDelta = 0;\n  // if (line != null && line.widthIs === 'mid') {\n  //   lineDelta = line.width / 2;\n  // }\n  // if (line != null && (line.widthIs === 'outside' || line.widthIs === 'negative')) {\n  //   lineDelta = line.width;\n  // }\n\n  // const increaseArrowByOffset = (pnts: Array<Point>, delta) => {\n  //   // if (delta > 0.01) {\n  //   //   debugger;\n  //   // }\n  //   const [, outline] = makePolyLine(\n  //     pnts, delta, true, 'negative', 'auto', 0.1,\n  //     10, Math.PI / 7, [], false,\n  //     2, 'negative', 0, [],\n  //   );\n  //   // return [outline[0][0], outline[0][1], outline[0][3]];\n  //   return outline[0];\n  // };\n\n  // let outline: Array<Point>;\n  // if (lineDelta > 0) {\n  //   outline = increaseArrowByOffset(newBorder, lineDelta);\n  // } else {  // $FlowFixMe\n  //   outline = newBorder.map(p => p._dup());\n  // }\n  // const borderOut = [outline];\n\n  // const { drawBorderBuffer } = o;\n  // let borderBuffer = drawBorderBuffer;\n  // if (typeof drawBorderBuffer === 'number') {\n  //   borderBuffer = [increaseArrowByOffset(border, lineDelta + drawBorderBuffer)];\n  // }\n\n  // let pointsToUse = newPoints;\n  // if (line != null) {\n  //   pointsToUse = newBorder;\n  // }\n  return [newBorder, [borderBuffer], newTail];\n}\n\nfunction getArrowTris(border: Array<Point>, options: { head: TypeArrowHead }) {\n  if (options.head === 'triangle') {\n    return getTriangleTris(border);\n  }\n  if (options.head === 'reverseTriangle') {\n    return getReverseTriangleTris(border);\n  }\n  if (options.head === 'barb') {\n    return getBarbTris(border);\n  }\n  if (options.head === 'rectangle' || options.head === 'bar') {\n    return getRectTris(border);\n  }\n  if (options.head === 'polygon' || options.head === 'circle') {\n    return getPolygonTris(border);\n  }\n  // if (options.head === 'line') {\n  return getLineTris(border);\n  // }\n}\n\nfunction defaultArrowOptions(\n  o: Object,\n) {\n  const defaults = {\n    align: 'tip',\n    tail: false,\n    angle: 0,\n    drawPosition: new Point(0, 0),\n    scale: 1,\n  };\n  if (o.head === 'triangle' || o.head == null) {\n    return joinObjects({}, defaults, o, getTriangleDefaults(o), {\n      head: 'triangle',\n    });\n  }\n  if (o.head === 'polygon' || o.head === 'circle') {\n    return joinObjects({}, defaults, o, getPolygonDefaults(o));\n  }\n  if (o.head === 'barb') {\n    return joinObjects({}, defaults, o, getBarbDefaults(o));\n  }\n  if (o.head === 'reverseTriangle') {\n    return joinObjects({}, defaults, o, getReverseTriDefaults(o));\n  }\n  if (o.head === 'bar') {\n    return joinObjects({}, defaults, o, getBarDefaults(o));\n  }\n  if (o.head === 'line') {\n    return joinObjects({}, defaults, o, getLineDefaults(o));\n  }\n  return joinObjects({}, defaults, o, getRectDefaults(o));\n}\n\nfunction simplifyArrowOptions(\n  arrowIn: null | TypeArrowHead | {\n    start: OBJ_Arrow | TypeArrowHead,\n    end: OBJ_Arrow | TypeArrowHead,\n  } & OBJ_Arrow,\n  tailWidth: number | null,\n  includeTailByDefault: boolean = false,\n) {\n  if (arrowIn == null) {\n    return undefined;\n  }\n  let arrow;\n  if (typeof arrowIn === 'string') {  // $FlowFixMe\n    arrow = { // $FlowFixMe\n      start: arrowIn, // $FlowFixMe\n      end: arrowIn,\n    };\n  } else {\n    arrow = arrowIn;\n  }\n  const optionsForBoth = joinObjectsWithOptions({ except: ['end', 'start'] }, {}, arrow);\n\n  const out = {};\n  const processEnd = (startOrEnd: 'start' | 'end') => {\n    if (typeof arrow[startOrEnd] === 'string') {  // $FlowFixMe\n      arrow[startOrEnd] = { // $FlowFixMe\n        head: arrow[startOrEnd],\n      };\n    }\n    if (Object.keys(optionsForBoth).length > 0) {\n      if (arrow[startOrEnd] == null) {\n        arrow[startOrEnd] = joinObjects({}, optionsForBoth);\n      } else {\n        arrow[startOrEnd] = joinObjects({}, optionsForBoth, arrow[startOrEnd]);\n      }\n    }\n    if (\n      arrow[startOrEnd] != null\n      || (arrow.start == null && arrow.end == null)\n    ) {\n      const defaults = {};\n      // let defaultTailWidth = {};\n      if (tailWidth != null) {\n        defaults.tailWidth = tailWidth;\n      }\n      if (includeTailByDefault) {\n        defaults.tail = true;\n      }\n      const o = joinObjectsWithOptions(\n        { except: ['end', 'start'] }, defaults, arrow[startOrEnd],\n      );\n      out[startOrEnd] = joinObjects(\n        defaultArrowOptions(o),\n        o,\n      );\n      out[startOrEnd].drawPosition = getPoint(out[startOrEnd].drawPosition);\n    }\n  };\n  processEnd('start');\n  processEnd('end');\n\n  if (Object.keys(out).length > 0) {\n    return out;\n  }\n  return undefined;\n}\n\nexport {\n  getTriangleArrow,\n  getBarbArrow,\n  getArrow,\n  getArrowLength,\n  simplifyArrowOptions,\n  defaultArrowOptions,\n  getArrowTris,\n};\n\n// // Draw examples of arrows\n\n// const figure = new Fig.Figure({ limits: [-3, -3, 6, 6]});\n\n// let y = 3;\n// let yStep = -0.7;\n// let xs = [-1, 0, 1];\n// let xStep = 1;\n// let index = 0;\n\n// const addArrow = (name, head, length, tail = false, align = 'tip', sides = 100) => {\n//   if (index % 3 === 0) {\n//     y += yStep;\n//   }\n//   x = xs[index % 3];\n//   index += 1;\n//   return {\n//     name,\n//     method: 'shapes.arrow',\n//     options: {\n//       head,\n//       length,\n//       radius: 0.25,\n//       tail,\n//       position: [x, y],\n//       width: 0.5,\n//       tailWidth: 0.1,\n//       sides,\n//       align,\n//     },\n//   };\n// }\n\n// figure.add([\n//   addArrow('t1', 'triangle', 0.5, false, 'tip'),\n//   addArrow('t2', 'triangle', 0.5, 0),\n//   addArrow('t3', 'triangle', 0.7, 0.2),\n//   addArrow('b1', 'barb', 0.5, false, 'tip'),\n//   addArrow('b2', 'barb', 0.5, 0),\n//   addArrow('b3', 'barb', 0.7, 0.2),\n//   addArrow('l1', 'line', 0.5, false, 'tip'),\n//   addArrow('l2', 'line', 0.5, 0),\n//   addArrow('l3', 'line', 0.7, 0.2),\n//   addArrow('bar1', 'bar', 0.1, false, 'tip'),\n//   addArrow('bar2', 'bar', 0.1, 0),\n//   addArrow('bar3', 'bar', 0.7, 0.6),\n//   addArrow('c1', 'circle', 1, false, 'tip'),\n//   addArrow('c2,', 'circle', 1, 0),\n//   addArrow('c3', 'circle', 1, 0.2),\n//   addArrow('p1', 'polygon', 1, false, 'tip', 6),\n//   addArrow('p2', 'polygon', 1, 0, 'tip', 6),\n//   addArrow('p3', 'polygon', 1, 0.2, 'tip', 6),\n//   addArrow('rt1', 'reverseTriangle', 0.5, false, 'tip'),\n//   addArrow('rt2', 'reverseTriangle', 0.5, 0),\n//   addArrow('rt3', 'reverseTriangle', 0.7, 0.2),\n// ])\n","// @flow\nimport {\n  Point, Line, threePointAngle,\n} from '../../tools/g2';\n\n\nfunction getBufferBorder(\n  bordersIn: Array<Array<Point>>,\n  buffer: number,\n  skipConcave: boolean = true,\n  bufferOffset: 'positive' | 'negative' = 'negative',\n) {\n  if (typeof buffer !== 'number') {\n    return buffer;\n  }\n  if (buffer === 0) {\n    return bordersIn;\n  }\n  const drawBorderBuffers = [];\n  bordersIn.forEach((borderIn) => {\n    // First remove all points that are >180\n    const border = [];\n    const borderIndex = [];\n    for (let i = 0; i < borderIn.length; i += 1) {\n      let prevPoint;\n      let nextPoint;\n      if (i === 0) {\n        prevPoint = borderIn[borderIn.length - 1];\n      } else {\n        prevPoint = borderIn[i - 1];\n      }\n      if (i === borderIn.length - 1) {\n        [nextPoint] = borderIn;\n      } else {\n        nextPoint = borderIn[i + 1];\n      }\n      const angle = threePointAngle(nextPoint, borderIn[i], prevPoint);\n      if (\n        ((skipConcave && angle < Math.PI) || skipConcave === false)\n        && (\n          border.length === 0\n          || borderIn[i].isNotEqualTo(border[border.length - 1])\n        )\n      ) {\n        border.push(borderIn[i]);\n        borderIndex.push(i);\n      }\n    }\n    const drawBorderBuffer = [];\n    const offsetLines = [];\n    for (let i = 0; i < border.length; i += 1) {\n      let line;\n      if (i === 0) {\n        line = new Line(border[border.length - 1], border[0]);\n      } else {\n        line = new Line(border[i - 1], border[i]);\n      }\n      // console.log(bufferOffset)\n      // offsetLines.push(line.offset('negative', buffer));\n      offsetLines.push(line.offset(bufferOffset, buffer));\n    }\n    for (let i = 0; i < offsetLines.length; i += 1) {\n      let prevLine;\n      // let nextLine;\n      if (i === 0) {\n        prevLine = offsetLines[offsetLines.length - 1];\n      } else {\n        prevLine = offsetLines[i - 1];\n      }\n      const currentLine = offsetLines[i];\n      const intersect = currentLine.intersectsWith(prevLine);\n      if (intersect.intersect != null) {\n        let borderPoint;\n        if (i === 0) {\n          borderPoint = border[border.length - 1];\n        } else {\n          borderPoint = border[i - 1];\n        }\n        if (intersect.intersect.distance(borderPoint) > buffer * 1.2) {\n          const borderToBuffer = new Line(borderPoint, intersect.intersect);\n          const perpLine = new Line(\n            borderToBuffer.pointAtLength(buffer * 1.2),\n            1,\n            borderToBuffer.angle() + Math.PI / 2,\n          );\n          const prevIntersect = prevLine.intersectsWith(perpLine);\n          const nextIntersect = currentLine.intersectsWith(perpLine);\n          if (prevIntersect.intersect != null && nextIntersect.intersect != null) {\n            drawBorderBuffer.push(prevIntersect.intersect);\n            drawBorderBuffer.push(nextIntersect.intersect);\n          } else {\n            drawBorderBuffer.push(intersect.intersect);\n          }\n        } else {\n          drawBorderBuffer.push(intersect.intersect);\n        }\n      }\n    }\n    drawBorderBuffers.push(drawBorderBuffer);\n  });\n\n  return drawBorderBuffers;\n}\n\nexport {  // eslint-disable-next-line import/prefer-default-export\n  getBufferBorder,\n};\n","\n// @flow\n/* eslint-disable camelcase */\nimport {\n  Transform, Point, polarToRect, getBoundingRect, getPoints, getPoint,\n} from '../../../tools/g2';\n\nimport type { TypeParsablePoint } from '../../../tools/g2';\n\nimport {\n  joinObjects,\n} from '../../../tools/tools';\n\n/* eslint-disable max-len */\n/**\n *\n * ![](./apiassets/copy.png)\n *\n * Copy Step options object\n *\n * A copy step defines how to copy existing points.\n *\n * An array of copy steps will cumulatively copy points from an original set of\n * points.\n *\n * So, if there are two copy steps then:\n * - the first step will copy the original points\n * - the second step will copy the original points and the first copy of the\n *   points\n *\n * For example, a grid of a shape can be made with two copy steps. The first\n * replicates the shape along the x axis, creating a line of shapes. The second\n * copy step then replicates the line of shapes in the y axis, creating a grid\n * of shapes.\n *\n * Each copy step appends its copied points onto an array of points that\n * started with the original points. By default, copy steps operate on all\n * points created in previous steps. However, the properties `start` and `end`\n * can be used to make the current step only operate on a subset of the points.\n *\n * `start` and `end` refer to the indexes of the copy steps where the original\n * points is at index 0, and the first copy step is at index 1. Copy step\n * arrays can also include *marker strings* which make defining `start` and\n * `end` more convient (see the third example below). These marker strings\n * can be used as `start` and `end` values. Marker strings are included\n * in the copy step indexing.\n *\n * There are two main ways to make a copy, either copy the points `to` a\n * location, or copy the points `along` a path.\n *\n * When using the `to` property, if a {@link Point} is defined\n * then the points will be copied to that point. If a {@link Transform} is\n * defined, then a copy of the points will be transformed by that transform. An\n * array of points and transforms can be defined to make multiple copies of the\n * points.\n *\n * When using the `along` property, the points are copied a number (`num`) of\n * times along a path with some `step`. The paths can be horiztonal (`'x'`),\n * vertical (`'y'`), at an angle (`number`) or through a `'rotation'` around\n * a `center` point.\n *\n * When copying along a line (`along` is `'x'`, `y'` or a `number`), then\n * `step` will be the distance offset along the line.\n *\n * When copying along a rotation (`along` is `'rotation'`), then `step` will be\n * the angular step in radians.\n *\n * Any step can use the `original` property - but it will only operate on the\n * last step that uses it. When `original` is `false`, then all points before\n * that copy step will not be included in the returned Point array.\n *\n * @property {TypeParsablePoint | TypeParsableTransform | Array<TypeParsablePoint | TypeParsableTransform>} [to] copy points to\n * a location or locations or transform a copy of the points\n * @property {'x' | 'y' | number | 'rotation' | 'moveOnly'} [along] copy points\n * along a linear path where `number` is a path at an angle in radians\n * @property {number} [num] the number of copies to make when copying `along` a\n * path\n * @property {number} [step] distance between copies if `along` is `'x'` or\n * `'y'` or a `number`, delta angle between copies if `along` is `'rotation'`\n * @property {TypeParsablePoint} [center] the center point about which to rotate\n * the copies when using `along` = `'rotation'`\n * @property {number | string} [start] copy step index or marker defining the\n * start of the points to copy\n * @property {number | string} [end] copy step index or marker defining the end\n * of the points to copy\n * @property {boolean} [original] `false` excludes all points before this step\n * in the final result (`true`)\n * @example\n * // Grid copy\n * figure.add({\n *   name: 'triGrid',\n *   method: 'polygon',\n *   options: {\n *     radius: 0.1,\n *     sides: 3,\n *     rotation: -Math.PI / 6,\n *     fill: 'tris',\n *     copy: [\n *       {\n *         along: 'x',\n *         num: 4,\n *         step: 0.3,\n *       },\n *       {\n *         along: 'y',\n *         num: 4,\n *         step: 0.3,\n *       },\n *     ],\n *   },\n * });\n *\n * @example\n * // Radial lines copy\n * figure.add({\n *   name: 'radialLines',\n *   method: 'generic',\n *   options: {\n *     points: [\n *       [-0.2, -0.1], [-0.2, 0.1], [0.2, 0.1],\n *       [-0.2, -0.1], [0.2, 0.1], [0.2, -0.1],\n *     ],\n *     copy: [\n *       {\n *         to: [[0.6, 0], [1.05, 0], [1.5, 0], [2.2, 0]],\n *       },\n *       {\n *         along: 'rotation',\n *         num: 5,\n *         step: Math.PI / 5,\n *         start: 1,              // only copy last step, not original points\n *       },\n *     ],\n *   },\n * });\n *\n * @example\n * // Ring copy (without original shape)\n * figure.add({\n *   name: 'halfRings',\n *   method: 'polygon',\n *   options: {\n *     radius: 0.1,\n *     sides: 20,\n *     fill: 'tris',\n *     copy: [\n *       'ring1',               // marker 1\n *       {\n *         to: [0.5, 0],\n *         original: false,     // don't include the original shape\n *       },\n *       {\n *         along: 'rotation',\n *         num: 7,\n *         step: Math.PI / 7,\n *         start: 'ring1',      // copy only from marker 1\n *       },\n *       'ring2',               // marker 2\n *       {\n *         to: [1, 0],\n *         start: 0,            // make a copy of the original shape only\n *         end: 1,\n *       },\n *       {\n *         along: 'rotation',\n *         num: 15,\n *         step: Math.PI / 15,\n *         start: 'ring2',      // copy points from Marker 2 only\n *       },\n *     ],\n *   },\n * });\n */\nexport type CPY_Step = {\n  to?: Point | [number, number] | Transform\n    | Array<Point | [number, number] | Transform> | Transform,\n  along?: 'x' | 'y' | number | 'rotation' | 'moveOnly',\n  num?: number,\n  step?: number,\n  center?: TypeParsablePoint,\n  start?: number | string,\n  end?: number | string,\n  original?: boolean,\n};\n/* eslint-enable max-len */\n\nexport type CPY_Steps = Array<CPY_Step>;\n\ntype CPY_Marks = { [markName: string]: number };\n\nfunction getPointsToCopy(\n  points: Array<Point>,\n  startIn: number | string,\n  endIn: number | string,\n  marks: CPY_Marks,\n) {\n  const out = [];\n  const start = marks[`${startIn}`];\n  let end;\n  if (endIn === 'end') {\n    end = points.length;\n  } else {\n    end = marks[`${endIn}`];\n  }\n  if (end == null) {\n    end = points.length;\n  }\n\n  for (let i = start; i < end; i += 1) {\n    out.push(points[i]._dup());\n  }\n  return out;\n}\n\nfunction copyOffset(\n  pointsToCopy: Array<Point>,\n  // initialPoints: Array<Point>,\n  optionsIn: CPY_Step,\n) {\n  const defaultOptions = {\n    to: [],\n  };\n  const options = joinObjects({}, defaultOptions, optionsIn);\n  options.to = getPoints(options.to);\n\n  let k = 0;\n  const out = Array(options.to.length * pointsToCopy.length);\n  for (let i = 0; i < options.to.length; i += 1) {\n    for (let j = 0; j < pointsToCopy.length; j += 1) {\n      out[k] = new Point(pointsToCopy[j].x + options.to[i].x, pointsToCopy[j].y + options.to[i].y);\n      k += 1;\n    }\n  }\n  return out;\n}\n\n// TODO Speedup like copyOFfset\nfunction copyTransform(\n  pointsToCopy: Array<Point>,\n  // initialPoints: Array<Point>,\n  optionsIn: CPY_Step,\n) {\n  const defaultOptions = {\n    to: [],\n  };\n  const options = joinObjects({}, defaultOptions, optionsIn);\n  if (options.to instanceof Transform\n  ) {\n    options.to = [optionsIn.to];\n  }\n\n  let out = [];\n  for (let i = 0; i < options.to.length; i += 1) {\n    // $FlowFixMe\n    const matrix = options.to[i].matrix();\n    out = [...out, ...pointsToCopy.map(p => p.transformBy((matrix)))];\n  }\n  return out;\n}\n\n// TODO Speedup like copyOFfset\nfunction copyLinear(\n  pointsToCopy: Array<Point>,\n  // initialPoints: Array<Point>,\n  optionsIn: CPY_Step,\n) {\n  if (optionsIn.along == null) {\n    return [];\n  }\n  const defaultOptions = {\n    num: 1,\n  };\n  let angle = 0;\n\n  const options = joinObjects({}, defaultOptions, optionsIn);\n\n  if (options.along === 'y') {\n    angle = Math.PI / 2;\n  } else if (options.along === 'x') {\n    angle = 0;\n  } else if (typeof options.along === 'number') {\n    angle = options.along;\n  }\n\n  if (options.step == null) {\n    const bounds = getBoundingRect(pointsToCopy);\n    options.step = Math.abs(bounds.height / Math.sin(angle));\n  }\n\n  let out = [];\n  for (let i = 1; i < options.num + 1; i += 1) {\n    const step = options.step * i;\n    out = [...out, ...pointsToCopy.map(p => p.add(polarToRect(step, angle)))];\n  }\n  return out;\n}\n\n// TODO Speedup like copyOFfset\nfunction copyAngle(\n  pointsToCopy: Array<Point>,\n  // initialPoints: Array<Point>,\n  optionsIn: CPY_Step,\n) {\n  const defaultOptions = {\n    num: 1,\n    step: Math.PI / 4,\n    center: [0, 0],\n  };\n\n  const options = joinObjects({}, defaultOptions, optionsIn);\n  options.center = getPoint(options.center);\n\n  let out = [];\n  const { center } = options;\n  for (let i = 1; i < options.num + 1; i += 1) {\n    const matrix = new Transform()\n      .translate(-center.x, -center.y)\n      .rotate(i * options.step)\n      .translate(center.x, center.y)\n      .matrix();\n    out = [...out, ...pointsToCopy.map(p => p.transformBy(matrix))];\n  }\n  return out;\n}\n\n// function copyArc(\n//   pointsToCopy: Array<Point>,\n//   initialPoints: Array<Point>,\n//   optionsIn: CPY_Arc,\n// ) {\n//   const defaultOptions = {\n//     num: 1,\n//     step: 0.1,\n//     angleStep: Math.PI / 4,\n//     // arcStep: 0.1,\n//     startAngle: 0,\n//     stopAngle: Math.PI * 2,\n//     center: [0, 0],\n//   };\n\n//   const options = joinObjects({}, defaultOptions, optionsIn);\n//   options.center = getPoint(options.center);\n\n//   let out = initialPoints;\n//   const { center } = options;\n//   for (let i = 1; i < options.num + 1; i += 1) {\n//     const matrix = new Transform()\n//       .translate(-center.x, -center.y)\n//       .rotate(i * options.step)\n//       .translate(center.x, center.y)\n//       .matrix();\n//     out = [...out, ...pointsToCopy.map(p => p.transformBy(matrix))];\n//   }\n//   return out;\n// }\n\n\nfunction copyStep(\n  points: Array<Point>,\n  copyStyle: 'linear' | 'to' | 'rotation' | 'x' | 'y' | number,\n  options: CPY_Step,\n  // marks: CPY_Marks,\n) {\n  // const out = [];\n\n  if (copyStyle === 'linear' || copyStyle === 'x' || copyStyle === 'y' || typeof copyStyle === 'number') {\n    return copyLinear(points, options);\n  }\n\n  if (copyStyle === 'to') {\n    if (options.to == null) {\n      return points;\n    }\n    if (Array.isArray(options.to) && options.to.length === 0) {\n      return points;\n    }\n\n    if (options.to instanceof Transform) {\n      return copyTransform(points, options);\n    }\n    if (Array.isArray(options.to) && options.to[0] instanceof Transform) {\n      return copyTransform(points, options);\n    }\n    return copyOffset(points, options);\n  }\n\n  if (copyStyle === 'rotation') {\n    return copyAngle(points, options);\n  }\n  return points;\n}\n\nfunction copyPoints(\n  points: Array<TypeParsablePoint> | Array<Point>,\n  chain: ?CPY_Step | CPY_Steps,\n) {\n  const marks = {};\n  // let out = [];\n  let startIndex = 0;\n  // let all = [];\n  // $FlowFixMe\n  let out = getPoints(points);\n  if (chain == null) {\n    return out;\n  }\n  let chainToUse = [];\n  if (!Array.isArray(chain)) {\n    chainToUse = [chain];\n  } else {\n    chainToUse = chain;\n  }\n  marks['0'] = 0;\n  // marks['1'] = points.length;\n\n  chainToUse.forEach((c, index) => {\n    marks[`${index + 1}`] = out.length;\n    if (typeof c === 'string') {\n      marks[c] = out.length;\n    } else {\n      const defaultOptions = {\n        start: startIndex,\n        end: 'end',\n        original: true,\n      };\n      const options = joinObjects({}, defaultOptions, c);\n      let copyStyle = 'to';\n      if (options.along != null) {\n        copyStyle = options.along;\n      }\n\n      const pointsToCopy = getPointsToCopy(out, options.start, options.end, marks);\n\n      if (options.original === false) {\n        startIndex = out.length;\n      }\n      out = [...out, ...copyStep(pointsToCopy, copyStyle, options)];\n    }\n  });\n\n  return [...out.slice(startIndex)];\n}\n\nexport {\n  copyPoints,\n  copyStep,\n};\n","// @flow\nimport {\n  Point,\n} from '../../tools/g2';\nimport type {\n  OBJ_Generic,\n} from '../FigurePrimitives/FigurePrimitives';\n\nexport type OBJ_Ellipse_Defined = {\n  width: number,\n  height: number,\n  xAlign: 'left' | 'center' | 'right' | number,\n  yAlign: 'bottom' | 'middle' | 'top' | number,\n  sides: number,\n  line?: {\n    widthIs: 'inside' | 'outside' | 'positive' | 'negative' | 'mid',\n    width: number,\n  },\n  drawBorderBuffer: number | Array<Array<Point>>\n} & OBJ_Generic;\n\n// import {\n//   round,\n// } from '../../../../tools/math';\n\nfunction getEllipsePoints(\n  width: number,\n  height: number,\n  sides: number,\n  x: number,\n  y: number,\n): Array<Point> {\n  const points = [];\n  const deltaAngle = Math.PI * 2 / sides;\n  for (let i = 0; i < sides; i += 1) {\n    points.push(new Point(\n      width / 2 * Math.cos(deltaAngle * i) + x,\n      height / 2 * Math.sin(deltaAngle * i) + y,\n    ));\n  }\n  return points;\n}\n\nfunction getEllipseBorder(options: OBJ_Ellipse_Defined) {\n  const {\n    width, height, xAlign, yAlign, sides,\n  } = options;\n  let x = 0;\n  let y = 0;\n  if (xAlign === 'left') {\n    x = width / 2;\n  } else if (xAlign === 'right') {\n    x = -width / 2;\n  } else if (typeof xAlign === 'number') {\n    x = width / 2 - width * xAlign;\n  }\n  if (yAlign === 'bottom') {\n    y = height / 2;\n  } else if (yAlign === 'top') {\n    y = -height / 2;\n  } else if (typeof yAlign === 'number') {\n    y = height / 2 - height * yAlign;\n  }\n\n  return getEllipsePoints(width, height, sides, x, y);\n  // let lineDelta = 0;\n  // if (line != null && line.widthIs === 'mid') {\n  //   lineDelta = line.width / 2;\n  // }\n  // if (line != null && (line.widthIs === 'outside' || line.widthIs === 'negative')) {\n  //   lineDelta = line.width;\n  // }\n  // let outline: Array<Point>;\n  // if (lineDelta > 0) {\n  //   outline = getEllipsePoints(\n  //     width + lineDelta * 2,\n  //     height + lineDelta * 2,\n  //     sides, x, y,\n  //   );\n  // } else {  // $FlowFixMe\n  //   outline = points.map(p => p._dup());\n  // }\n\n  // const border = [outline];\n  // const { drawBorderBuffer } = options;\n  // let borderBuffer = drawBorderBuffer;\n  // if (typeof drawBorderBuffer === 'number') {\n  //   borderBuffer = [getEllipsePoints(\n  //     width + lineDelta * 2 + drawBorderBuffer * 2,\n  //     height + lineDelta * 2 + drawBorderBuffer * 2,\n  //     sides, x, y,\n  //   )];\n  // }\n\n  // return [points;\n}\n\nfunction ellipseBorderToTris(border: Array<Point>) {\n  const points = [border[0]._dup(), border[1]._dup(), border[2]._dup()];\n  for (let i = 2; i < border.length - 1; i += 1) {\n    points.push(border[0]);\n    points.push(border[i]);\n    points.push(border[i + 1]);\n  }\n  return points;\n}\n\nexport {\n  getEllipseBorder,\n  ellipseBorderToTris,\n};\n\n","// @flow\nimport {\n  Point, Line, getPoint,\n} from '../../tools/g2';\nimport type { TypeParsablePoint } from '../../tools/g2';\n\n// import {\n//   round,\n// } from '../../../../tools/math';\n\n// function getLineBorder(options: {\n//   p1: Point,\n//   p2: Point,\n//   width: number,\n//   length: number | {\n//     p1: number,\n//     p2: number,\n//   },\n// }) {\n//   const {\n//     p1, p2, width, length,\n//   } = options;\n//   const line = new Line(p1, p2);\n//   let p1Length = 0;\n//   let p2Length = 0;\n//   if (typeof length === 'number') {\n//     const deltaLength = length - line.length();\n//     p1Length = -deltaLength / 2;\n//     p2Length = deltaLength / 2;\n//   } else {\n//     const p1L = length.p1;\n//     const p2L = length.p2;\n//     if (p1L != null) {\n//       p1Length = p1L;\n//     } else {\n//       p1Length = 0;\n//     }\n//     if (p2L != null) {\n//       p2Length = p2L;\n//     } else {\n//       p2Length = 0;\n//     }\n//   }\n//   const horizontalBorder = [\n//     new Point(p1Length, -width / 2),\n//     new Point(p1Length, width / 2),\n//     new Point(line.length() + p2Length, width / 2),\n//     new Point(line.length() + p2Length, -width / 2),\n//   ];\n\n//   const matrix = new Transform().rotate(line.angle()).translate(p1).matrix();\n//   return horizontalBorder.map(p => p.transformBy(matrix));\n// }\n\nfunction getLine(options: {\n  p1: Point,\n  p2?: Point,\n  length: number,\n  width: number,\n  angle: number,\n  widthIs: 'mid' | 'positive' | 'negative',\n  border: 'rect' | 'outline' | Array<Array<TypeParsablePoint>>,\n  touchBorder: 'rect' | 'border' | Array<Array<TypeParsablePoint>>,\n}) {\n  const {\n    p1, p2, length, width, angle, border, touchBorder, widthIs,\n  } = options;\n  const points = [getPoint(p1)];\n  if (p2 == null) {\n    points.push(new Point(\n      points[0].x + length * Math.cos(angle),\n      points[0].y + length * Math.sin(angle),\n    ));\n  } else {\n    points.push(getPoint(p2));\n  }\n\n  let borderToUse = border;\n  let touchBorderToUse = touchBorder;\n  if (border === 'outline') {\n    borderToUse = 'line';\n  }\n\n  if (typeof touchBorderToUse === 'number') {\n    const line = new Line(points[0], points[1]);\n    const extendedLine = new Line(\n      line.pointAtLength(-touchBorderToUse),\n      line.pointAtLength(line.length() + touchBorderToUse),\n    );\n    let negOffset;\n    let posOffset;\n    if (widthIs === 'positive') {\n      negOffset = extendedLine.offset('negative', touchBorderToUse);\n      posOffset = extendedLine.offset('positive', width + touchBorderToUse);\n    } else if (widthIs === 'negative') {\n      negOffset = extendedLine.offset('negative', width + touchBorderToUse);\n      posOffset = extendedLine.offset('positive', touchBorderToUse);\n    } else {\n      negOffset = extendedLine.offset('negative', width / 2 + touchBorderToUse);\n      posOffset = extendedLine.offset('positive', width / 2 + touchBorderToUse);\n    }\n    touchBorderToUse = [[negOffset.p1, negOffset.p2, posOffset.p2, posOffset.p1]];\n  }\n  return [points, borderToUse, touchBorderToUse];\n}\n\nexport default getLine;\n","// @flow\n\nimport {\n  Point, Line, threePointAngleMin,\n} from '../../../tools/g2';\n\n\n//\n// Make a circular corner between points - P2 and p3 must be the same\n// distance from p1\n//\n//               .....................................\n//          p3  0                                     0 center\n//              0                                  0  .\n//              0                               0   b .\n//              0                            0        .\n//              0                         0           .\n//              0                C     0              .\n//              0                   0                 .\n//              0                0                    .  A\n//              0             0                       .\n//              0          0                          .\n//              0       0                             .\n//              0    0                                .\n//              0 0  a                              c .\n//              000000000000000000000000000000000000000\n//          p1                     B                    p2\n//\n//\nfunction circleCorner(p2in: Point, p1: Point, p3in: Point, sides: number): Array<Point> {\n  // If sides is 0 or negative, then return the original points\n  if (sides < 1) {\n    return [p2in._dup(), p1._dup(), p3in._dup()];\n  }\n\n  // If sides is 1, then return the chamfer\n  if (sides === 1) {\n    return [p2in._dup(), p3in._dup()];\n  }\n\n  const p2 = p2in._dup();\n  const p3 = p3in._dup();\n  const points: Array<Point> = [];\n\n  let _2a = threePointAngleMin(p2, p1, p3);\n  if (_2a === Math.PI) {\n    points.push(p2in._dup());\n    for (let i = 0; i < sides - 2; i += 1) {\n      points.push(p1._dup());\n    }\n    points.push(p3in._dup());\n    return points;\n  }\n\n  // if equal to 0, that means the lines are going back on top of each other\n  // in which case we still want a radius at the end, so make it small and\n  // unnoticable\n  let isZero = false;\n  // let zeroMag = 0.0001;\n  if (_2a === 0) {\n    isZero = true;\n    _2a = 0.00001;\n  }\n  const direction = _2a / Math.abs(_2a);\n\n  const line12 = new Line(p1, p2);\n  const a = Math.abs(_2a / 2);\n  const c = Math.PI / 2;\n  const b = Math.PI - a - c;\n  const B = line12.length();\n  const C = Math.sin(c) / Math.sin(b) * B;\n  // const C = B / Math.cos(a);\n  const center = new Point(\n    p1.x + C * Math.cos(a * direction + line12.angle()),\n    p1.y + C * Math.sin(a * direction + line12.angle()),\n  );\n\n  const _2b = b * 2;\n  const delta = _2b / sides * direction * -1;\n  const lineC2 = new Line(center, p2);\n  const angleC2 = lineC2.angle();\n  const magC2 = lineC2.length();\n  points.push(p2);\n  // If the angle is zero, then we want to draw a pho (very small) polyline\n  // that will simulate a radius at the end\n  if (isZero) {\n    const mag = 0.0001;\n    const ang12 = line12.angle() + Math.PI / 2;\n    const deltaZero = Math.PI / sides;\n    for (let i = 0; i <= sides; i += 1) {\n      points.push(new Point(\n        center.x + mag * Math.cos(ang12 + deltaZero * i),\n        center.y + mag * Math.sin(ang12 + deltaZero * i),\n      ));\n    }\n  } else {\n    for (let i = 0; i < sides - 1; i += 1) {\n      const angle = angleC2 + (i + 1) * delta;\n      points.push(new Point(\n        center.x + magC2 * Math.cos(angle),\n        center.y + magC2 * Math.sin(angle),\n      ));\n    }\n  }\n  points.push(p3);\n  // if (reverse) {\n  //   return points.reverse();\n  // }\n  return points;\n}\n\nfunction cutCorner(\n  p2: Point, p1: Point, p3: Point,\n  sides: number, style: 'radius' | 'fromVertex' | 'max', value: number,\n): Array<Point> {\n  const line12 = new Line(p1, p2);\n  const line13 = new Line(p1, p3);\n  let cut;\n  if (style === 'fromVertex') {\n    cut = value;\n    cut = Math.min(cut, line12.length() / 2 * 0.99, line13.length() / 2 * 0.99);\n  } else if (style === 'radius') {\n    const angle = Math.abs(threePointAngleMin(p2, p1, p3)) / 2;\n    cut = value / Math.tan(angle);\n    cut = Math.min(cut, line12.length() / 2 * 0.99, line13.length() / 2 * 0.99);\n  } else { // if (style === 'max')\n    cut = Math.min(line12.length(), line13.length());\n  }\n  // cut = Math.min(cut, line12.length() / 2 * 0.99, line13.length() / 2 * 0.99);\n\n  const p2Max = line12.pointAtPercent(cut / line12.length());\n  const p3Max = line13.pointAtPercent(cut / line13.length());\n\n  return circleCorner(p2Max, p1, p3Max, sides);\n}\n\n\nfunction cornerLine(\n  pointsIn: Array<Point>,\n  close: boolean,\n  type: 'fromVertex' | 'radius',\n  sides: number,\n  size: number,\n) {\n  let points = [];\n  if (close) {\n    points = cutCorner(\n      pointsIn[pointsIn.length - 1], pointsIn[0], pointsIn[1],\n      sides, type, size,\n    );\n  } else {\n    points.push(pointsIn[0]);\n  }\n\n  for (let i = 1; i < pointsIn.length - 1; i += 1) {\n    const corner = cutCorner(\n      pointsIn[i - 1], pointsIn[i], pointsIn[i + 1],\n      sides, type, size,\n    );\n    points = [...points, ...corner];\n  }\n\n  if (close) {\n    points = [...points, ...cutCorner(\n      pointsIn[pointsIn.length - 2], pointsIn[pointsIn.length - 1], pointsIn[0],\n      sides, type, size,\n    )];\n  } else {\n    points.push(pointsIn[pointsIn.length - 1]._dup());\n  }\n  return points;\n}\n\nfunction makeCorner(\n  p2: Point, p1: Point, p3: Point, length: number, forceLength: boolean = false,\n) {\n  const line12 = new Line(p1, p2);\n  const line13 = new Line(p1, p3);\n  let newP2 = line12.pointAtPercent(length / line12.length());\n  let newP3 = line13.pointAtPercent(length / line13.length());\n  if (forceLength === false) {\n    if (length > line12.length()) {\n      newP2 = p2._dup();\n    }\n    if (length > line13.length()) {\n      newP3 = p3._dup();\n    }\n  }\n  return [newP2, p1._dup(), newP3];\n}\n\nfunction lineToCorners(\n  pointsIn: Array<Point>,\n  close: boolean,\n  length: number,\n  forceLength: boolean = false,\n) {\n  const corners = [];\n  for (let i = 1; i < pointsIn.length - 1; i += 1) {\n    corners.push(makeCorner(\n      pointsIn[i - 1], pointsIn[i], pointsIn[i + 1], length, forceLength,\n    ));\n  }\n  if (close) {\n    corners.push(makeCorner(\n      pointsIn[pointsIn.length - 2],\n      pointsIn[pointsIn.length - 1],\n      pointsIn[0], length, forceLength,\n    ));\n    corners.push(makeCorner(\n      pointsIn[pointsIn.length - 1],\n      pointsIn[0],\n      pointsIn[1], length, forceLength,\n    ));\n  }\n  return corners;\n}\n\nexport {\n  circleCorner,\n  cutCorner,\n  cornerLine,\n  makeCorner,\n  lineToCorners,\n};\n","// @flow\nimport {\n  Point, Line, distance,\n} from '../../../tools/g2';\nimport {\n  roundNum,\n} from '../../../tools/math';\nimport type { TypeDash } from '../../../tools/types';\n\n\nfunction makeDashDefinition(dashes: Array<number>) {\n  const cum = [];\n  const cycleLength = dashes.reduce((p, sum) => {\n    cum.push(p + sum);\n    return p + sum;\n  }, 0);\n  return {\n    definition: dashes,\n    sum: cycleLength,\n    cum,\n  };\n}\n\nfunction getDashElementAndRemainder(\n  dash: {\n    definition: Array<number>,\n    cum: Array<number>,\n    sum: number,\n  },\n  offset: number,\n  precision: number = 8,\n) {\n  let singleCycleOffset;\n  if (offset > dash.sum) {\n    singleCycleOffset = roundNum(offset % dash.sum, precision);\n  } else {\n    singleCycleOffset = offset;\n  }\n\n  for (let i = 0; i < dash.definition.length; i += 1) {\n    if (singleCycleOffset < dash.cum[i]) {\n      return [i, roundNum(dash.cum[i] - singleCycleOffset, precision)];\n    }\n    if (singleCycleOffset === dash.cum[i]) {\n      if (i + 1 < dash.definition.length) {\n        return [i + 1, roundNum(dash.cum[i + 1] - singleCycleOffset, precision)];\n      }\n      return [0, roundNum(dash.cum[0], precision)];\n    }\n  }\n  return [0, 0];\n}\n\nfunction makeDashes(\n  dash: {\n    definition: Array<number>,\n    cum: Array<number>,\n    sum: number,\n  },\n  p1: Point,\n  p2: Point,\n  offset: number,\n  precision: number = 8,\n) {\n  const points = [];\n  let cumDistance = 0;\n  // eslint-disable-next-line prefer-const\n  let [index, remainder] = getDashElementAndRemainder(dash, offset, precision);\n  let onLine = true;\n  const line12 = new Line(p1, p2);\n  const totLength = roundNum(line12.length(), precision);\n  let dashLength = roundNum(remainder, precision);\n  let lastIndex = index;\n  while (cumDistance < totLength) {\n    const isOnLine = index % 2 === 0;\n    onLine = isOnLine;\n    if (isOnLine) {\n      const q1 = line12.pointAtPercent(cumDistance / totLength);\n      let q2;\n      if (roundNum(cumDistance + dashLength, precision) <= totLength) {\n        q2 = line12.pointAtPercent((cumDistance + dashLength) / totLength);\n        cumDistance += dashLength;\n      } else {\n        q2 = p2._dup();\n        cumDistance += dashLength;\n      }\n      points.push([q1, q2]);\n    } else {\n      cumDistance += dashLength;\n    }\n    cumDistance = roundNum(cumDistance, precision);\n    lastIndex = index;\n    index = (index + 1) % dash.definition.length;\n    dashLength = roundNum(dash.definition[index], precision);\n  }\n\n  return {\n    points,\n    continues: cumDistance > totLength && lastIndex % 2 === 0,\n    onLine,\n  };\n}\n\nfunction lineToDash(\n  points: Array<Point>,\n  dash: TypeDash,\n  close: boolean = false,\n  // offset: number = 0,\n  precision: number = 8,\n) {\n  let dashToUse = dash;\n  let offset = 0;\n  if (dash.length % 2 === 1) {\n    dashToUse = dash.slice(1);\n    [offset] = dash;\n  }\n  let out = [];\n  const dd = makeDashDefinition(dashToUse);\n  let cumLength = offset;\n  let lastContinue = false;\n  let onLine = true;\n  const processLine = (p1, p2) => {\n    const dashes = makeDashes(dd, p1, p2, cumLength, precision);\n    ({ onLine } = dashes);\n    const dashLines = dashes.points;\n    const dashContinues = dashes.continues;\n    if (lastContinue && dashLines[0] != null) {\n      out[out.length - 1] = [...out[out.length - 1], ...dashLines[0].slice(1)];\n      out = [...out, ...dashLines.slice(1)];\n    } else {\n      out = [...out, ...dashLines];\n    }\n    lastContinue = dashContinues;\n    cumLength = roundNum(cumLength + distance(p1, p2), precision);\n  };\n\n  for (let i = 0; i < points.length - 1; i += 1) {\n    const p1 = points[i];\n    const p2 = points[i + 1];\n    processLine(p1, p2);\n  }\n  if (close) {\n    const p1 = points[points.length - 1];\n    const p2 = points[0];\n    processLine(p1, p2);\n    const [startIndex] = getDashElementAndRemainder(dd, offset);\n    // const startIsOnLine = startIndex % 2 === 0;\n    if (lastContinue && startIndex % 2 === 0 && out.length > 1) {\n      out[0] = [...out[out.length - 1], ...out[0].slice(1)];\n    }\n  }\n\n  return [out, onLine];\n}\n\nexport {\n  getDashElementAndRemainder,\n  makeDashDefinition,\n  makeDashes,\n  lineToDash,\n};\n","// @flow\nimport { cornerLine, lineToCorners } from './corners';\nimport { lineToDash } from './dashes';\nimport {\n  Line, Point, threePointAngleMin, threePointAngle,\n} from '../../../tools/g2';\nimport {\n  joinObjects,\n} from '../../../tools/tools';\nimport {\n  getArrow, getArrowLength, simplifyArrowOptions, getArrowTris,\n} from '../arrow';\nimport type { TypeDash } from '../../../tools/types';\nimport type { TypeArrowHead } from '../arrow';\nimport type { OBJ_Arrow } from '../../FigurePrimitives/FigurePrimitives';\n// import { getBufferBorder } from '../buffer';\n\n/* eslint-disable yoda */\n\n// A thick line is defined from:\n//  * A reference line\n//  * A width\n//  * Where the reference line is relative to the width\n//    ('mid', 'inside', 'outside')\n//  * How to deal with the corners in the line\n//\n\n// Convert line segments that define the outer boundaries of a line into\n// triangles for drawing in WebGL\n//\n//                        outside\n// p1    ----------------------------------------------   p2\n//       2, 4\n//\n//       1                                         3, 5\n// p1    ----------------------------------------------   p2\n//                        inside\n//\nfunction lineSegmentsToPoints(\n  lineSegments: Array<Array<Line>>,\n  linePrimitives: boolean,\n  borderIs: 'negative' | 'positive' | 'line' | Array<Array<Point>> = 'line',\n  holeIs: 'negative' | 'positive' | Array<Array<Point>> = [[]],\n  corner: 'auto' | 'fill' | 'none',\n  close: boolean,\n): [Array<Point>, Array<Array<Point>>, Array<Array<Point>>] {\n  const tris = [];\n  // let border = [];\n  // console.log(lineSegments)\n  let hole = [[]];\n  const positiveBorder = [];\n  const negativeBorder = [];\n  lineSegments.forEach((lineSegment, index) => {\n    const negative = lineSegment[0];\n    const positive = lineSegment.slice(-1)[0];\n    if (linePrimitives) {\n      for (let l = 0; l < lineSegment.length; l += 1) {\n        tris.push(lineSegment[l].p1._dup());\n        tris.push(lineSegment[l].p2._dup());\n      }\n    } else {\n      tris.push(positive.p1._dup());\n      tris.push(positive.p2._dup());\n      tris.push(negative.p1._dup());\n      tris.push(negative.p1._dup());\n      tris.push(positive.p2._dup());\n      tris.push(negative.p2._dup());\n    }\n    if (index === 0 || positiveBorder[positiveBorder.length - 1].isNotEqualTo(positive.p1)) {\n      positiveBorder.push(positive.p1._dup());\n    }\n    if (\n      close === false\n      || index < lineSegments.length - 1\n      || (\n        index === lineSegments.length - 1\n        && positiveBorder[0].isNotEqualTo(positive.p2)\n      )\n    ) {\n      positiveBorder.push(positive.p2._dup());\n    }\n    if (index === 0 || negativeBorder[negativeBorder.length - 1].isNotEqualTo(negative.p1)) {\n      negativeBorder.push(negative.p1._dup());\n    }\n    // negative.p2._dup();\n    if (\n      close === false\n      || index < lineSegments.length - 1\n      || (\n        index === lineSegments.length - 1\n        && negativeBorder[0].isNotEqualTo(negative.p2)\n      )\n    ) {\n      negativeBorder.push(negative.p2._dup());\n    }\n    // positiveBorder.push(positive.p1._dup(), positive.p2._dup());\n    // negativeBorder.push(negative.p1._dup(), negative.p2._dup());\n    if (corner === 'fill' || corner === 'auto') {\n      let nextLineSegment;\n      if (index < lineSegments.length - 1) {\n        nextLineSegment = lineSegments[index + 1];\n      } else if (close) {\n        [nextLineSegment] = lineSegments;\n      }\n      if (nextLineSegment != null) {\n        const nextNegative = nextLineSegment[0];\n        const nextPositive = nextLineSegment.slice(-1)[0];\n        if (linePrimitives) {\n          if (nextNegative.p1.isNotEqualTo(negative.p2, 10)) {\n            tris.push(negative.p2._dup());\n            tris.push(nextNegative.p1._dup());\n          }\n          if (nextPositive.p1.isNotEqualTo(positive.p2, 10)) {\n            tris.push(positive.p2._dup());\n            tris.push(nextPositive.p1._dup());\n          }\n        } else {\n          if (nextNegative.p1.isNotEqualTo(negative.p2, 10)) {\n            tris.push(negative.p2._dup());\n            tris.push(positive.p2._dup());\n            tris.push(nextNegative.p1._dup());\n          }\n          if (nextPositive.p1.isNotEqualTo(positive.p2, 10)) {\n            tris.push(positive.p2._dup());\n            tris.push(nextPositive.p1._dup());\n            tris.push(negative.p2._dup());\n          }\n        }\n      }\n    }\n    // if (borderIs === 'line') {\n    //   border.push([\n    //     negative.p1._dup(),\n    //     negative.p2._dup(),\n    //     positive.p2._dup(),\n    //     positive.p1._dup(),\n    //   ]);\n    // } else if (borderIs === 'negative') {\n    //   if (border.length === 0) {\n    //     border.push([]);\n    //   }\n    //   border[0].push(\n    //     negative.p1._dup(),\n    //     negative.p2._dup(),\n    //   );\n    // } else if (borderIs === 'positive') {\n    //   if (border.length === 0) {\n    //     border.push([]);\n    //   }\n    //   border[0].push(\n    //     positive.p1._dup(),\n    //     positive.p2._dup(),\n    //   );\n    // }\n    if (holeIs === 'positive') {\n      hole[0].push(positive.p1._dup(), positive.p2._dup());\n    } else if (holeIs === 'negative') {\n      hole[0].push(negative.p1._dup(), negative.p2._dup());\n    }\n  });\n  let border = [[]];\n  // console.log(borderIs)\n  if (borderIs === 'positive') {\n    border = [positiveBorder];\n  } else if (borderIs === 'negative') {\n    border = [negativeBorder];\n  } else if (borderIs === 'line') {\n    if (close === false) {\n      border = [[...negativeBorder, ...(positiveBorder.reverse())]];\n    } else {\n      border = [[\n        ...negativeBorder, negativeBorder[0],\n        positiveBorder[0], ...(positiveBorder.reverse()),\n      ]];\n    }\n  } else if (Array.isArray(borderIs)) {\n    border = borderIs;\n  }\n  // console.log(border)\n  if (Array.isArray(holeIs)) {\n    hole = holeIs;\n  }\n  // console.log(borderIs, border)\n  return [tris, border, hole];\n}\n\n// Extend two lines to their intersection point\nfunction joinLinesInPoint(\n  line1: Line,\n  lineNext: Line,\n  corner: 'fill' | 'auto' | 'none',\n) {\n  const intersect = line1.intersectsWith(lineNext);\n  if (!intersect.withinLine && corner === 'fill') {\n    return;\n  }\n  if (intersect.intersect != null) {\n    line1.setP2(intersect.intersect._dup());  // $FlowFixMe\n    lineNext.setP1(intersect.intersect._dup());\n  }\n}\n\n//                    2       2        2\n//                    N     o N        N\n//                       No      N        N\n//                      o   N       N        N\n//                    o        N       N        N\n//                   o            N       N        N\n//            angle o                N       N        N\n//                 o                    N       N        N        / Tangent\n//                 o                       N  1    N        N  1 /\n//                o                           N       N        N/\n//  in   000000000o000000000000000000000000000000        N  1  /\n//       1        o                            2            N /\n//  mid  0000000000000000000000000000000000000000000000000000/\n//       1                                                2 /\n//  out  00000000000000000000000000000000000000000000000000/\n//       1                                              2 /\n//                                                       /\n//\n// Note, for simplicity, both inside and outside can intercept with tangent\n// and geometry is valid.\nfunction joinLinesInTangent(\n  // inside: Line,\n  // insideNext: Line,\n  mid: Line,\n  midNext: Line,\n  outside: Line,\n  outsideNext: Line,\n  corner: 'fill' | 'auto' | 'none',\n) {\n  const angle = threePointAngleMin(mid.p1, mid.p2, midNext.p2);\n  const tangent = new Line(mid.p2, 1, mid.angle() + angle / 2 + Math.PI / 2);\n  const intercept = outside.intersectsWith(tangent);\n  const interceptNext = outsideNext.intersectsWith(tangent);\n  // if (intercept.withinLine === false && interceptNext.withinLine === false) {\n  //   const i = outside.intersectsWith(outsideNext);\n  //   if (i.intersect != null) {\n  //     outside.setP2(i.intersect);\n  //     outsideNext.setP1(interceptNext.intersect);\n  //     return;\n  //   }\n  // }\n  if (corner === 'fill') {\n    return;\n  }\n  // let intercept = tangent.intersectsWith(outside);\n  if (intercept.intersect != null) {\n    outside.setP2(intercept.intersect);\n  }\n\n  // intercept = tangent.intersectsWith(outsideNext);\n  if (interceptNext.intersect != null) {\n    outsideNext.setP1(interceptNext.intersect);\n  }\n}\n\nfunction joinLinesAcuteInside(\n  mid: Line,\n  midNext: Line,\n  inside: Line,\n  insideNext: Line,\n  linePrimitives: boolean,\n) {\n  const insideIntercept = inside.intersectsWith(insideNext);\n  const { withinLine, intersect } = insideIntercept;\n  if (withinLine && intersect != null) {\n    inside.setP2(intersect);\n    insideNext.setP1(intersect);\n    return;\n  }\n  if (!linePrimitives) {\n    let intercept = inside.intersectsWith(midNext);\n    if (intercept.intersect != null && intercept.withinLine) {\n      inside.setP2(intercept.intersect);\n    }\n    intercept = insideNext.intersectsWith(mid);\n    if (intercept.intersect != null && intercept.withinLine) {\n      insideNext.setP1(intercept.intersect);\n    }\n  }\n}\n\nfunction joinLinesObtuseInside(\n  mid: Line,\n  midNext: Line,\n  inside: Line,\n  insideNext: Line,\n) {\n  const insideIntercept = inside.intersectsWith(insideNext);\n  const { withinLine, intersect } = insideIntercept;\n  if (withinLine && intersect != null) {\n    inside.setP2(intersect);\n    insideNext.setP1(intersect);\n    return;\n  }\n  let intercept = inside.intersectsWith(midNext);\n  if (intercept.intersect != null && intercept.intersect.isWithinLine(midNext, 8)) {\n    inside.setP2(intercept.intersect);\n  }\n  intercept = insideNext.intersectsWith(mid);\n  if (intercept.intersect != null && intercept.intersect.isWithinLine(mid, 8)) {\n    insideNext.setP1(intercept.intersect);\n  }\n}\n\nfunction makeLineSegments(\n  points: Array<Point>,\n  width: number,\n  close: boolean,\n  cornerStyle: 'auto' | 'none' | 'fill',\n  widthIs: 'mid' | 'positive' | 'negative' | number,\n  isInside: boolean,\n  numLines: number = 2,\n): [Array<Line>, Array<Array<Line>>, Array<Array<'negative' | 'positive' | 'mid'>>] {\n  const idealLines = [];\n  const makeLine = (p1, p2) => new Line(p1, p2);\n  for (let i = 0; i < points.length - 1; i += 1) {\n    idealLines.push(makeLine(points[i], points[i + 1]));\n  }\n  if (close) {\n    idealLines.push(makeLine(points[points.length - 1], points[0]));\n  }\n  const segmentSides = [];\n  const neg = 'negative';\n  const pos = 'positive';\n  const mid = 'mid';\n\n  // lineSegments should be more negative to more positive\n  const lineSegments: Array<Array<Line>> = [];\n  const makeOffset = (prev, current, next, offset: number, index: number) => {\n    let minNegativeOffset = offset;\n    let minPositiveOffset = offset;\n    let prevAngle = Math.PI;\n    if (prev != null) {\n      prevAngle = threePointAngle(prev.p1, current.p1, current.p2);\n      const minPrevAngle = threePointAngleMin(prev.p1, current.p1, current.p2);\n      const minPrevOffset = current.distanceToPoint(prev.p1);\n      const minOffset = Math.min(\n        minPrevOffset, Math.tan(Math.abs(minPrevAngle)) * current.length(),\n      );\n      // Negative side is inside angle\n      if (prevAngle < Math.PI / 2) {\n        minNegativeOffset = Math.min(minNegativeOffset, minOffset);\n      } else if (prevAngle > Math.PI / 2 * 3) {\n        minPositiveOffset = Math.min(minPositiveOffset, minOffset);\n      }\n    }\n    let nextAngle = Math.PI;\n    if (next != null) {\n      nextAngle = threePointAngle(current.p1, current.p2, next.p2);\n      const minNextAngle = threePointAngleMin(current.p1, current.p2, next.p2);\n      const minNextOffset = current.distanceToPoint(next.p2);\n      const minOffset = Math.min(\n        minNextOffset, Math.tan(Math.abs(minNextAngle)) * current.length(),\n      );\n      if (nextAngle < Math.PI / 2) {\n        minNegativeOffset = Math.min(minNegativeOffset, minOffset);\n      } else if (nextAngle > Math.PI / 2 * 3) {\n        minPositiveOffset = Math.min(minPositiveOffset, minOffset);\n      }\n    }\n    // let negativeLine;\n    // let positiveLine;\n    let offsetLine;\n    // console.log(widthIs)\n    // console.log(prevAngle, nextAngle)\n    if (widthIs === 'negative') {\n      if (cornerStyle === 'auto' && (isInside || prevAngle < Math.PI || nextAngle < Math.PI)) {\n        offsetLine = current.offset('negative', minNegativeOffset);\n      } else {\n        offsetLine = current.offset('negative', offset);\n      }\n    } else if (widthIs === 'positive') {\n      if (cornerStyle === 'auto' && (isInside || prevAngle > Math.PI || nextAngle > Math.PI)) {\n        // console.log('min')\n        offsetLine = current.offset('positive', minPositiveOffset);\n      } else {\n        offsetLine = current.offset('positive', offset);\n      }\n    // otherwise widthIs === 'mid'\n    } else {\n      offsetLine = current.offset('positive', offset);\n    }\n    // if (cornerStyle === 'auto' && widthIs !== 'mid') {\n    //   negativeLine = current.offset('negative', minNegativeOffset);\n    //   positiveLine = current.offset('positive', minPositiveOffset);\n    // } else {\n    //   negativeLine = current.offset('negative', offset);\n    //   positiveLine = current.offset('positive', offset);\n    // }\n    lineSegments[index].push(offsetLine);\n  };\n\n  const step = width / (numLines - 1);\n  for (let i = 0; i < idealLines.length; i += 1) {\n    let prev = i > 0 ? idealLines[i - 1] : null;\n    const current = idealLines[i];\n    let next = i < idealLines.length - 1 ? idealLines[i + 1] : null;\n    if (close && i === 0) {\n      prev = idealLines[idealLines.length - 1];\n    }\n    if (close && i === idealLines.length - 1) {\n      // eslint-disable-next-line prefer-destructuring\n      next = idealLines[0];\n    }\n    lineSegments.push([]);\n    segmentSides.push([]);\n    if (widthIs === 'negative' || widthIs === 'positive') {\n      lineSegments[i].push(current._dup());\n      segmentSides[i].push(mid);\n    } else if (numLines === 1) {\n      lineSegments[i].push(current._dup());\n      segmentSides[i].push(mid);\n    } else if (typeof widthIs === 'number') {\n      const offsetLine = current.offset('negative', widthIs * width);\n      lineSegments[i].push(offsetLine);\n      segmentSides[i].push(neg);\n    } else {\n      const offsetLine = current.offset('negative', width / 2);\n      lineSegments[i].push(offsetLine);\n      segmentSides[i].push(neg);\n    }\n    for (let l = 1; l < numLines; l += 1) {\n      if (widthIs === 'negative') {\n        makeOffset(prev, current, next, l * step, i);\n        segmentSides[i].push(neg);\n      } else if (widthIs === 'positive') {\n        makeOffset(prev, current, next, l * step, i);\n        segmentSides[i].push(pos);\n      } else if (typeof widthIs === 'number') {\n        makeOffset(prev, current, next, -widthIs * width + l * step, i);\n        segmentSides[i].push(-widthIs * width + l * step > 0 ? pos : neg);\n      } else {\n        makeOffset(prev, current, next, -width / 2 + l * step, i);\n        segmentSides[i].push(-width / 2 + l * step > 0 ? pos : neg);\n      }\n    }\n    if (widthIs === 'negative') {\n      lineSegments[i].reverse();\n      segmentSides[i].reverse();\n    }\n  }\n  // console.log(idealLines, lineSegments, segmentSides)\n  return [idealLines, lineSegments, segmentSides];\n}\n\nfunction getWidthIs(\n  points: Array<Point>,\n  close: boolean,\n  widthIs: 'inside' | 'outside' | 'positive' | 'negative' | 'mid' | number,\n) {\n  if (widthIs === 'mid' || widthIs === 'negative' || widthIs === 'positive' || typeof widthIs === 'number') {\n    return widthIs;\n  }\n\n  let numInsideNegativeAngles = 0;\n  let totAngles = close ? points.length : points.length - 2;\n  const testAngle = (p2: Point, p1: Point, p3: Point) => {\n    const angle = threePointAngle(p2, p1, p3);\n    if (angle < Math.PI) {\n      numInsideNegativeAngles += 1;\n    }\n    if (angle === Math.PI) {\n      totAngles -= 1;\n    }\n  };\n  for (let i = 1; i < points.length - 1; i += 1) {\n    testAngle(points[i - 1], points[i], points[i + 1]);\n  }\n  if (close) {\n    testAngle(points[points.length - 1], points[0], points[1]);\n    testAngle(points[points.length - 2], points[points.length - 1], points[0]);\n  }\n\n  if (numInsideNegativeAngles >= totAngles / 2) {\n    if (widthIs === 'inside') {\n      return 'negative';\n    }\n    return 'positive';\n  }\n\n  if (widthIs === 'inside') {\n    return 'positive';\n  }\n  return 'negative';\n}\n\nfunction makeThickLine(\n  points: Array<Point>,\n  width: number = 0.01,\n  widthIsIn: 'mid' | 'negative' | 'positive' | number,\n  widthIsInside: boolean,\n  close: boolean = false,\n  corner: 'auto' | 'fill' | 'none',\n  minAngleIn: ?number = Math.PI / 7,\n  linePrimitives: boolean = false,\n  lineNum: number = 2,\n  borderIs: 'negative' | 'positive' | 'line' | Array<Array<Point>> = 'line',\n  holeIs: 'negative' | 'positive' | Array<Array<Point>> = [[]],\n): [Array<Point>, Array<Array<Point>>, Array<Array<Point>>] {\n  const widthToUse = width;\n  // if (widthIsIn === 'mid') {\n  //   widthToUse = width / 2;\n  // }\n  // let widthIs = getWidthIs(points, close, widthIsIn);\n  const [idealLines, lineSegments, segmentSides] = makeLineSegments(\n    points, widthToUse, close, corner, widthIsIn, widthIsInside, lineNum,\n  );\n  let widthIs = widthIsIn;\n  if (typeof widthIs === 'number') {\n    widthIs = 'mid';\n  }\n  // console.log(points, idealLines, lineSegments)\n\n  // Join line segments based on the angle between them\n  const minAngle = minAngleIn == null ? 0 : minAngleIn;\n  const joinLineSegments = (currentIndex: number, nextIndex: number, lineIndex: number) => {\n    const mid = idealLines[currentIndex];\n    const midNext = idealLines[nextIndex];\n    const lineSegment = lineSegments[currentIndex][lineIndex];\n    const lineSegmentNext = lineSegments[nextIndex][lineIndex];\n    // const [positive, mid, negative] = lineSegments[current];\n    // const [positiveNext, midNext, negativeNext] = lineSegments[next];\n    const angle = threePointAngle(mid.p1, mid.p2, midNext.p2);\n    // If the angle is less than 180, then the 'negative' line segments are\n    // on the outside of the angle.\n    // console.log(currentIndex, lineIndex, angle)\n    const segmentSide = segmentSides[currentIndex][lineIndex];\n    if (0 < angle && angle < minAngle) {\n      if (segmentSide === 'mid') {\n        joinLinesInTangent(mid, midNext, lineSegment, lineSegmentNext, corner);\n        // joinLinesInTangent(mid, midNext, positive, positiveNext);\n      } else if (segmentSide === 'negative') {\n        joinLinesAcuteInside(mid, midNext, lineSegment, lineSegmentNext, linePrimitives);\n      } else if (segmentSide === 'positive') {\n        joinLinesInTangent(mid, midNext, lineSegment, lineSegmentNext, corner);\n      }\n    } else if (minAngle <= angle && angle <= Math.PI / 2) {\n      if (segmentSide === 'mid') {\n        joinLinesInPoint(lineSegment, lineSegmentNext, corner);\n        // joinLinesInPoint(lineSegment, lineSegmentNext);\n      } else if (segmentSide === 'negative') {\n        joinLinesAcuteInside(mid, midNext, lineSegment, lineSegmentNext, linePrimitives);\n      } else if (segmentSide === 'positive') {\n        joinLinesInPoint(lineSegment, lineSegmentNext, corner);\n      }\n    // If the angle is greater than the minAngle, then the line segments can\n    // be connected directly\n    } else if (Math.PI / 2 <= angle && angle < Math.PI) {\n      if (segmentSide === 'mid' || typeof widthIs === 'number') {\n        joinLinesInPoint(lineSegment, lineSegmentNext, corner);\n        // joinLinesInPoint(lineSegment, lineSegmentNext);\n      } else if (segmentSide === 'negative') {\n        joinLinesObtuseInside(mid, midNext, lineSegment, lineSegmentNext);\n      } else if (segmentSide === 'positive') {\n        joinLinesInPoint(lineSegment, lineSegmentNext, corner);\n      }\n    } else if (angle === Math.PI) {\n      if (segmentSide === 'negative') {\n        // if (widthIsIn === 'inside') {\n        //   joinLinesObtuseInside(mid, midNext, lineSegment, lineSegmentNext);\n        // } else {\n        joinLinesInPoint(lineSegment, lineSegmentNext, corner);\n        // }\n      } else if (segmentSide === 'positive') {\n        // if (widthIsIn === 'inside') {\n        //   joinLinesObtuseInside(mid, midNext, lineSegment, lineSegmentNext);\n        // } else {\n        joinLinesInPoint(lineSegment, lineSegmentNext, corner);\n        // }\n      }\n    // If the angle is greater than 180, then the positive side is on the\n    // inside of the angle\n    } else if (Math.PI < angle && angle < Math.PI / 2 * 3) {\n      if (segmentSide === 'mid') {\n        joinLinesInPoint(lineSegment, lineSegmentNext, corner);\n        joinLinesInPoint(lineSegment, lineSegmentNext, corner);\n      } else if (segmentSide === 'negative') {\n        joinLinesInPoint(lineSegment, lineSegmentNext, corner);\n      } else if (segmentSide === 'positive') {\n        joinLinesObtuseInside(mid, midNext, lineSegment, lineSegmentNext);\n      }\n    //\n    } else if (Math.PI / 2 * 3 <= angle && angle <= Math.PI * 2 - minAngle) {\n      if (segmentSide === 'mid') {\n        joinLinesInPoint(lineSegment, lineSegmentNext, corner);\n        // joinLinesInPoint(lineSegment, lineSegmentNext);\n      } else if (segmentSide === 'negative') {\n        joinLinesInPoint(lineSegment, lineSegmentNext, corner);\n      } else if (segmentSide === 'positive') {\n        joinLinesAcuteInside(mid, midNext, lineSegment, lineSegmentNext, linePrimitives);\n      }\n    //\n    } else if (Math.PI * 2 - minAngle < angle && angle < Math.PI * 2) {\n      // console.log('asdf', segmentSide);\n      // console.log(segmentSide)\n      if (segmentSide === 'mid') {\n        joinLinesInTangent(mid, midNext, lineSegment, lineSegmentNext, corner);\n        // joinLinesInTangent(mid, midNext, lineSegment, lineSegmentNext);\n      } else if (segmentSide === 'negative') {\n        joinLinesInTangent(mid, midNext, lineSegment, lineSegmentNext, corner);\n      } else if (segmentSide === 'positive') {\n        joinLinesAcuteInside(mid, midNext, lineSegment, lineSegmentNext, linePrimitives);\n      }\n      // console.log(lineSegment)\n    } else if ((angle === Math.PI * 2 || angle === 0)) {\n      // do nothing\n\n      // if (widthIs === 'mid') {\n      //   joinLinesInPoint(lineSegment, lineSegmentNext);\n      //   // joinLinesInPoint(lineSegment, lineSegmentNext);\n      // } else if (widthIs === 'negative') {\n      //   joinLinesInPoint(lineSegment, lineSegmentNext);\n      // } else if (widthIs === 'positive') {\n      //   joinLinesInPoint(lineSegment, lineSegmentNext);\n      // }\n    }\n    // if (lineSegments.length >= 2) {\n    //   console.log(currentIndex, lineIndex, lineSegments[2][0]._dup())\n    // }\n  };\n\n  // Create fill triangles between the positive & mid, and negative and mid lines\n  const cornerFills = [];\n  // const createFill = (currentIndex, nextIndex) => {\n  //   const mid = idealLines[currentIndex];\n  //   const midNext = idealLines[nextIndex];\n  //   const positive = lineSegments[currentIndex].slice(-1)[0];\n  //   const positiveNext = lineSegments[nextIndex].slice(-1)[0];\n  //   const negative = lineSegments[currentIndex][0];\n  //   const negativeNext = lineSegments[nextIndex][0];\n  //   const angle = threePointAngle(mid.p1, mid.p2, midNext.p2);\n  //   if (linePrimitives) {\n  //     for (let i = 0; i < lineSegments[currentIndex].length; i += 1) {\n  //       cornerFills.push(lineSegments[currentIndex][i].p2._dup());\n  //       cornerFills.push(lineSegments[nextIndex][i].p1._dup());\n  //     }\n  //   } else if (angle < Math.PI) {\n  //     if (widthIsIn !== 'inside') {\n  //       cornerFills.push(positive.p2._dup());\n  //       cornerFills.push(mid.p2._dup());\n  //       cornerFills.push(positiveNext.p1._dup());\n  //     }\n  //   } else if (angle > Math.PI) {\n  //     if (widthIsIn !== 'inside') {\n  //       cornerFills.push(negative.p2._dup());\n  //       cornerFills.push(mid.p2._dup());\n  //       cornerFills.push(negativeNext.p1._dup());\n  //     }\n  //   }\n  // };\n\n  // NB: this all assumes the GL primitive is TRIANGLES. Thus the order the\n  // triangles is drawn is not important, and so fills can happen in chunks.\n  if (corner !== 'none') {\n    for (let l = 0; l < lineNum; l += 1) {\n      for (let i = 0; i < lineSegments.length - 1; i += 1) {\n        // if (l === 0 && linePrimitives) {\n        //   createFill(i, i + 1);\n        // } else {\n        joinLineSegments(i, i + 1, l);\n        // }\n        // if (corner === 'auto') {\n        //   joinLineSegments(i, i + 1, l);\n        // } else if (l === 0 && linePrimitives) {\n        //   createFill(i, i + 1);\n        // }\n      }\n      if (close) {\n        // if (l === 0 && linePrimitives) {\n        //   createFill(lineSegments.length - 1, 0);\n        // } else {\n        joinLineSegments(lineSegments.length - 1, 0, l);\n        // }\n        // if (corner === 'auto') {\n        //   joinLineSegments(lineSegments.length - 1, 0, l);\n        // } else if (l === 0 && linePrimitives) {\n        //   createFill(lineSegments.length - 1, 0);\n        // }\n      }\n    }\n  }\n  const [tris, border, hole] = lineSegmentsToPoints(\n    lineSegments, linePrimitives, borderIs, holeIs, corner, close,\n  );\n  // if (close === false) {\n  //   return [[...tris, ...cornerFills], [[...border[0]], [...hole]];\n  // }\n  return [[...tris, ...cornerFills], border, hole];\n}\n\n\n// from https://mathworld.wolfram.com/Circle-LineIntersection.html\nfunction circleLineIntersection(\n  center: Point,\n  radius: number,\n  lineIn: Line,\n) {\n  const offsetToZero = new Point(-center.x, -center.y);\n  const line = new Line(lineIn.p1.add(offsetToZero), lineIn.p2.add(offsetToZero));\n  const x1 = line.p1.x;\n  const y1 = line.p1.y;\n  const x2 = line.p2.x;\n  const y2 = line.p2.y;\n  const dx = x2 - x1;\n  const dy = y2 - y1;\n  const dr = Math.sqrt(dx * dx + dy * dy);\n  const D = x1 * y2 - x2 * y1;\n  const r = radius;\n  const sgn = value => (value < 0 ? -1 : 1);\n\n  const i1x = (D * dy + sgn(dy) * dx * Math.sqrt(r * r * dr * dr - D * D)) / (dr * dr);\n  const i2x = (D * dy - sgn(dy) * dx * Math.sqrt(r * r * dr * dr - D * D)) / (dr * dr);\n  const i1y = (-D * dx + Math.abs(dy) * Math.sqrt(r * r * dr * dr - D * D)) / (dr * dr);\n  const i2y = (-D * dx - Math.abs(dy) * Math.sqrt(r * r * dr * dr - D * D)) / (dr * dr);\n\n  const intersections = [];\n  // eslint-disable-next-line no-restricted-globals\n  if (!isNaN(i1x) && !isNaN(i1y)) {\n    const i = new Point(i1x, i1y).sub(offsetToZero);\n    if (lineIn.hasPointOn(i)) {\n      intersections.push(i);\n    }\n  }\n  // eslint-disable-next-line no-restricted-globals\n  if (!isNaN(i2x) && !isNaN(i2y)) {\n    const i = new Point(i2x, i2y).sub(offsetToZero);\n    if (lineIn.hasPointOn(i)) {\n      intersections.push(i);\n    }\n  }\n\n  return intersections;\n}\n\n\n// From end of line\n// Go back lines until distance to p1 is > arrow length\n// Find intersection between circle (arrow length) and line\n// That is the end of the line, and defines the arrow start\n\nfunction shortenLineForArrows(\n  points: Array<Point>,\n  arrow: {\n    start?: {\n      head: TypeArrowHead,\n      length: number,\n      width: number,\n      barb: number,\n      tailWidth: number,\n      align: 'mid' | 'start',\n      tail: number | boolean,\n      radius: number,\n    },\n    end?: {\n      head: TypeArrowHead,\n      length: number,\n      width: number,\n      barb: number,\n      tailWidth: number,\n      align: 'mid' | 'start',\n      tail: number | boolean,\n      radius: number,\n    },\n  },\n) {\n  const { start, end } = arrow;\n\n  let shortenedPoints = [];\n\n  // let addStartArrow = false;\n  if (start != null) {\n    const startPoint = points[0];\n    let index = 0;\n    const [, arrowLength] = getArrowLength(start);\n    let pointFound = false;\n    while (index < points.length - 1 && pointFound === false) {\n      index += 1;\n      const distanceToEnd = startPoint.distance(points[index]);\n      if (arrowLength < distanceToEnd) {\n        pointFound = true;\n      }\n    }\n\n    if (pointFound) {\n      const line = new Line(points[index - 1], points[index]);\n      const [intersect] = circleLineIntersection(startPoint, arrowLength, line);\n      if (intersect != null) {\n        shortenedPoints = [intersect, ...points.slice(index)];\n        // addStartArrow = true;\n      }\n    }\n  } else {\n    shortenedPoints = points;\n  }\n\n  // let addEndArrow = false;\n  if (end != null) {\n    const endPoint = points[points.length - 1];\n    let index = points.length - 1;\n    const [, arrowLength] = getArrowLength(end);\n    let pointFound = false;\n    while (index > 0 && pointFound === false) {\n      index -= 1;\n      const distanceToEnd = endPoint.distance(points[index]);\n      if (arrowLength < distanceToEnd) {\n        pointFound = true;\n      }\n    }\n    if (pointFound) {\n      const line = new Line(points[index + 1], points[index]);\n      const [intersect] = circleLineIntersection(endPoint, arrowLength, line);\n      if (intersect != null) {\n        shortenedPoints = [...shortenedPoints.slice(0, index + 1), intersect];\n        // addEndArrow = true;\n      }\n    }\n  }\n  return shortenedPoints;\n}\n\nfunction makePolyLine(\n  pointsIn: Array<Point>,\n  width: number = 0.01,\n  close: boolean = false,\n  widthIsIn: 'mid' | 'outside' | 'inside' | 'positive' | 'negative' | number = 'mid',\n  cornerStyle: 'auto' | 'none' | 'radius' | 'fill',\n  cornerSize: number = 0.1,\n  cornerSides: number = 10,\n  minAutoCornerAngle: number = Math.PI / 7,\n  dash: TypeDash = [],\n  linePrimitives: boolean = false,\n  lineNum: number = 2,\n  borderIs: 'positive' | 'negative' | 'line' | Array<Array<Point>> = 'line',\n  touchBorderBuffer: number = 0,\n  holeIs: 'positive' | 'negative' | Array<Array<Point>> = [[]],\n  arrowIn: null | TypeArrowHead | {\n    start: OBJ_Arrow | TypeArrowHead,\n    end: OBJ_Arrow | TypeArrowHead,\n  } & OBJ_Arrow = null,\n  precision: number = 8,\n): [Array<Point>, Array<Array<Point>>, Array<Array<Point>>, Array<Array<Point>>] {\n  let points = [];\n  let cornerStyleToUse;\n  let orderedPoints = pointsIn;\n\n  const arrow = simplifyArrowOptions(arrowIn, width, true);\n\n  if (close === false && arrowIn != null) { // $FlowFixMe\n    orderedPoints = shortenLineForArrows(pointsIn, arrow);\n  }\n  // console.log(orderedPoints)\n  // Convert line to line with corners\n  if (cornerStyle === 'auto') {\n    points = orderedPoints.map(p => p._dup());\n    cornerStyleToUse = 'auto';\n  } else if (cornerStyle === 'radius') {\n    points = cornerLine(orderedPoints, close, 'fromVertex', cornerSides, cornerSize);\n    cornerStyleToUse = 'fill';\n  } else {\n    cornerStyleToUse = cornerStyle;\n    points = orderedPoints.map(p => p._dup());\n  }\n\n  const widthIs = getWidthIs(points, close, widthIsIn);\n  // Convert line to dashed line\n  let dashedTris = [];\n  let onLine = true;\n  if (dash.length > 1) {\n    const [dashes, onDash] = lineToDash(points, dash, close, precision);\n    onLine = onDash;\n    let closeDashes = false;\n    if (dashes.length === 1) {\n      closeDashes = close;\n    }\n    dashes.forEach((d) => {\n      const [tris] = makeThickLine(\n        d, width, widthIs, widthIsIn === 'inside', closeDashes, cornerStyleToUse, minAutoCornerAngle,\n        linePrimitives, lineNum, borderIs, holeIs,\n      );\n      dashedTris = [...dashedTris, ...tris];\n    });\n  }\n\n  // Get tris and border of solid line\n  const [tris, border, hole] = makeThickLine(\n    points, width, widthIs, widthIsIn === 'inside', close, cornerStyleToUse, minAutoCornerAngle,\n    linePrimitives, lineNum, borderIs, holeIs,\n  );\n\n  // Get touch border if there is a buffer\n  let touchBorder = border;\n  if (typeof touchBorderBuffer === 'number' && touchBorderBuffer !== 0) {\n    // console.log(touchBorderBuffer)\n    touchBorder = [];\n    // for (let i = 0; i < border.length; i += 1) {\n    //   touchBorder.push(getBufferBorder(border[i], touchBorderBuffer));\n    // }\n    // touchBorder = getBufferBorder(border[0], touchBorderBuffer);\n    let widthIsBuffer = 0.5;\n    const widthBuffer = width + touchBorderBuffer * 2;\n    if (widthIs === 'positive') {\n      widthIsBuffer = touchBorderBuffer / widthBuffer;\n    } else if (widthIs === 'negative') {\n      widthIsBuffer = (touchBorderBuffer + width) / widthBuffer;\n    } else if (widthIs === 'mid') {\n      widthIsBuffer = 0.5;\n    } else {\n      widthIsBuffer = (touchBorderBuffer + widthIs * width) / widthBuffer;\n    }\n    let pointsToUse = points;\n    if (close === false) {\n      const firstLine = new Line(points[0], points[1]);\n      const firstPoint = firstLine.pointAtLength(-touchBorderBuffer);\n      const lastLine = new Line(points[points.length - 2], points[points.length - 1]);\n      const lastPoint = lastLine.pointAtLength(lastLine.length() + touchBorderBuffer);\n      pointsToUse = [firstPoint, ...points.slice(1, -1), lastPoint];\n    }\n    let borderIsToUse = borderIs;\n    if (Array.isArray(borderIs)) {\n      borderIsToUse = 'line';\n    }\n    [, touchBorder] = makeThickLine(\n      pointsToUse, widthBuffer, widthIsBuffer, widthIsIn === 'inside', close, cornerStyleToUse, minAutoCornerAngle,\n      linePrimitives, lineNum, borderIsToUse, holeIs,\n    );\n    // if (close === false) {\n\n    // }\n  }\n\n  const trisToUse = dash.length > 1 ? dashedTris : tris;\n  // if (dash.length > 1) {\n  //   if (arrow != null && close === false) {\n  //     return addArrows(arrow, dashedTris, border, touchBorder, hole);\n  //   }\n  //   return [dashedTris, border, touchBorder, hole];\n  // }\n  if (arrowIn != null && close === false) {\n    // eslint-disable-next-line no-use-before-define\n    return addArrows(\n      arrow,\n      [orderedPoints[0], pointsIn[0]],\n      [orderedPoints[orderedPoints.length - 1], pointsIn[pointsIn.length - 1]],\n      trisToUse, border, touchBorder, hole, touchBorderBuffer, width,\n      onLine,\n    );\n  }\n  // if (close === false) {\n\n  // }\n  return [trisToUse, border, touchBorder, hole];\n}\n\nfunction makePolyLineCorners(\n  pointsIn: Array<Point>,\n  width: number = 0.01,\n  close: boolean = false,\n  cornerLength: number,\n  // forceCornerLength: boolean,\n  widthIs: 'mid' | 'outside' | 'inside' | 'positive' | 'negative' = 'mid',\n  cornerStyle: 'auto' | 'none' | 'radius' | 'fill',\n  cornerSize: number,\n  cornerSides: number,\n  minAutoCornerAngle: number = Math.PI / 7,\n  linePrimitives: boolean = false,\n  lineNum: number = 1,\n  // borderIs: 'positive' | 'negative' | 'line' | Array<Array<Point>> = 'line',\n  drawBorderBuffer: number = 0,\n) {\n  // split line into corners\n  const corners = lineToCorners(pointsIn, close, cornerLength, false);\n\n  let tris = [];\n  let borders = [];\n  let holes = [];\n  let borderBuffers = [];\n  let drawBorderBufferToUse = 0;\n  if (typeof drawBorderBuffer === 'number') {\n    drawBorderBufferToUse = drawBorderBuffer;\n  }\n\n  corners.forEach((corner) => {\n    const [t, b, dbb, h] = makePolyLine(\n      corner, width, false, widthIs, cornerStyle, cornerSize,\n      cornerSides, minAutoCornerAngle, [], linePrimitives, lineNum, 'line', drawBorderBufferToUse, [[]],\n    );\n    tris = [...tris, ...t];\n    borders = [...borders, ...b];\n    borderBuffers = [...borderBuffers, ...dbb];\n    holes = [...holes, ...h];\n  });\n  return [tris, borders, borderBuffers, holes];\n}\n\nfunction addArrows(\n  arrowIn: ?{\n    start?: {\n      head: TypeArrowHead,\n      length: number,\n      width: number,\n      barb: number,\n      tailWidth: number,\n    },\n    end?: {\n      head: TypeArrowHead,\n      length: number,\n      width: number,\n      barb: number,\n      tailWidth: number,\n    },\n  },\n  startArrowIn: [Point, Point],\n  endArrowIn: [Point, Point],\n  existingTriangles: Array<Point>,\n  existingBorder: Array<Array<Point>>,\n  existingTouchBorder: Array<Array<Point>>,\n  holeBorder: Array<Array<Point>>,\n  drawBorderBuffer: number,\n  lineWidth: number,\n  onLine: boolean,\n) {\n  let arrow = {};\n  if (arrowIn != null) {\n    arrow = arrowIn;\n  }\n  let updatedTriangles = existingTriangles;\n  let updatedBorder = existingBorder;\n  let updatedTouchBorder = existingTouchBorder;\n  const count = updatedTriangles.length;\n  const { start } = arrow;\n  if (start != null) {\n    let startArrowLine = new Line(startArrowIn[0], startArrowIn[1]);\n    const startLineMid = new Line(updatedTriangles[0], updatedTriangles[2]).midPoint();\n    startArrowLine = new Line(startLineMid, startArrowLine.length(), startArrowLine.angle());\n    const startArrow = [startArrowLine.p1, startArrowLine.p2];\n    const [border, touchBorder, tail] = getArrow(joinObjects(\n      {},\n      start,\n      {\n        // start: startArrow[0],\n        // end: startArrow[1],\n        align: 'tail',\n        drawPosition: startArrow[0],\n        angle: new Line(startArrow[0], startArrow[1]).angle(),\n        drawBorderBuffer,\n        tailWidth: lineWidth,\n      },\n    ));\n    const points = getArrowTris(border, start);\n    updatedTriangles = [\n      ...updatedTriangles, ...points,\n      updatedTriangles[0]._dup(), updatedTriangles[2]._dup(), tail[0]._dup(),\n      tail[0]._dup(), updatedTriangles[2]._dup(), tail[1]._dup(),\n    ];\n    updatedBorder = [...updatedBorder, border];\n    updatedTouchBorder = [...updatedTouchBorder, touchBorder[0]];\n  }\n  const { end } = arrow;\n  if (end != null) {\n    const l = count;\n    let endArrowLine = new Line(endArrowIn[0], endArrowIn[1]);\n    const endLineMid = new Line(updatedTriangles[l - 2], updatedTriangles[l - 1]).midPoint();\n    endArrowLine = new Line(endLineMid, endArrowLine.length(), endArrowLine.angle());\n    const endArrow = [endArrowLine.p1, endArrowLine.p2];\n    const [border, touchBorder, tail] = getArrow(joinObjects(\n      {},\n      end,\n      {\n        // start: endArrow[0],\n        // end: endArrow[1],\n        align: 'tail',\n        drawPosition: endArrow[0],\n        angle: new Line(endArrow[0], endArrow[1]).angle(),\n        drawBorderBuffer,\n        tailWidth: lineWidth,\n      },\n    ));\n    const points = getArrowTris(border, end);\n    let connection = [];\n    if (onLine) {\n      connection = [\n        updatedTriangles[l - 2]._dup(), updatedTriangles[l - 1]._dup(), tail[0]._dup(),\n        tail[0]._dup(), updatedTriangles[l - 1]._dup(), tail[1]._dup(),\n      ];\n    }\n    updatedTriangles = [\n      ...updatedTriangles, ...points, ...connection,\n    ];\n    updatedBorder = [...updatedBorder, border];\n    updatedTouchBorder = [...updatedTouchBorder, touchBorder[0]];\n  }\n  return [\n    updatedTriangles,\n    updatedBorder,\n    updatedTouchBorder,\n    holeBorder,\n  ];\n}\n\nfunction makeFastPolyLine(\n  pointsIn: Array<Point>,\n  width: number,\n  close: boolean,\n) {\n  const len = close ? pointsIn.length * 4 + 2 : (pointsIn.length - 1) * 4;\n  const points = Array(len);\n  const half = width / 2;\n  const orth = Math.PI / 2;\n  const getPoints = (index1, index2) => {\n    const p1 = pointsIn[index1];\n    const p2 = pointsIn[index2];\n    const angle = Math.atan2(p2.y - p1.y, p2.x - p1.x);\n    const dx1 = half * Math.cos(angle - orth);\n    const dx2 = half * Math.cos(angle + orth);\n    const dy1 = half * Math.sin(angle - orth);\n    const dy2 = half * Math.sin(angle + orth);\n    return [\n      new Point(p1.x + dx1, p1.y + dy1),\n      new Point(p1.x + dx2, p1.y + dy2),\n      new Point(p2.x + dx1, p2.y + dy1),\n      new Point(p2.x + dx2, p2.y + dy2),\n    ];\n  };\n  for (let i = 0; i < pointsIn.length - 1; i += 1) {\n    const [p11, p12, p21, p22] = getPoints(i, i + 1);\n    points[i * 4] = p11;\n    points[i * 4 + 1] = p12;\n    points[i * 4 + 2] = p21;\n    points[i * 4 + 3] = p22;\n  }\n\n  if (close) {\n    const [p11, p12, p21, p22] = getPoints(pointsIn.length - 1, 0);\n    points[len - 6] = p11;\n    points[len - 5] = p12;\n    points[len - 4] = p21;\n    points[len - 3] = p22;\n    points[len - 2] = points[0]._dup();\n    points[len - 1] = points[1]._dup();\n  }\n  return [points, [[]], [[]], [[]]];\n}\n\nexport {\n  joinLinesInPoint,\n  lineSegmentsToPoints,\n  joinLinesInTangent,\n  // makeThickLineMid,\n  // makeThickLineInsideOutside,\n  makePolyLine,\n  makePolyLineCorners,\n  addArrows,\n  makeFastPolyLine,\n};\n\n\n// TODO\n// inside and dash\n// inside and radius\n\n\n// Inside and radius\n// const figure = new Fig.Figure();\n// const { Point } = Fig;\n\n// const line = [\n//     new Point(0.5, 0),\n//     new Point(0, 0.024286),\n//     new Point(-0.5, 0),\n//     // new Point(0, 1),\n// ];\n\n// figure.add([\n//   {\n//     name: 'pad',\n//     method: 'polygon',\n//     options: {\n//       radius: 0.2,\n//       color: [0.5, 0.5, 0.5, 0.5],\n//       sides: 100,\n//     },\n//   },\n//   {\n//     name: 'r',\n//     method: 'polyline',\n//     options: {\n//       points: line,\n//       width: 0.03,\n//       close: true,\n//       pointsAt: 'inside',\n//       cornerStyle: 'radius',\n//       cornerSize: 0.05,\n//       cornerSides: 10,\n//     },\n//   },\n//   {\n//     name: 'x2',\n//     method: 'line',\n//     options: {\n//       p1: [-1, 0],\n//       p2: [1, 0],\n//       width: 0.005,\n//       color: [0.5, 0.5, 0.5, 0.5],\n//     }\n//   },\n// ]);\n\n// const pad = figure.getElement('pad');\n// pad.setMovable();\n// pad.setTransformCallback = () => {\n//   line[1] = pad.getPosition();\n//   const r = figure.getElement('r');\n//   r.updatePoints(line);\n//   figure.animateNextFrame();\n// }\n// figure.initialize();\n// pad.setPosition(0, 0.1);\n\n\n// Inside and dash\n// {\n//   name: 'r',\n//   method: 'polyline',\n//   options: {\n//     points: line,\n//     width: 0.03,\n//     close: true,\n//     pointsAt: 'inside',\n//     dash: [0.1, 0.03],\n//   },\n// },\n","// @flow\nimport {\n  Point,\n} from '../../../tools/g2';\n\n// import {\n//   round,\n// } from '../../../../tools/math';\n\nfunction getPolygonPoints(options: {\n  radius: number,\n  innerRadius?: number,\n  rotation: number,\n  offset: Point,\n  sides: number,\n  sidesToDraw: number,\n  direction: 1 | -1,\n}): Array<Point> {\n  const {\n    radius, rotation, offset, sides, sidesToDraw, direction, innerRadius,\n  } = options;\n  let deltaAngle = Math.PI * 2 / sides;\n\n  let sidesMultiplier = 1;\n  if (innerRadius != null) {\n    deltaAngle /= 2;\n    sidesMultiplier = 2;\n  }\n  const points = [];\n  if (sidesToDraw === 0) {\n    return [];\n  }\n  for (let i = 0; i < sidesToDraw * sidesMultiplier; i += sidesMultiplier) {\n    points.push(new Point(\n      radius * Math.cos(deltaAngle * i * direction + rotation) + offset.x,\n      radius * Math.sin(deltaAngle * i * direction + rotation) + offset.y,\n    ));\n    if (innerRadius != null) {\n      points.push(new Point(\n        innerRadius * Math.cos(deltaAngle * (i + 1) * direction + rotation) + offset.x,\n        innerRadius * Math.sin(deltaAngle * (i + 1) * direction + rotation) + offset.y,\n      ));\n    }\n  }\n  if (sidesToDraw < sides) {\n    points.push(new Point(\n      radius * Math.cos(\n        deltaAngle * sidesToDraw * sidesMultiplier * direction + rotation,\n      ) + offset.x,\n      radius * Math.sin(\n        deltaAngle * sidesToDraw * sidesMultiplier * direction + rotation,\n      ) + offset.y,\n    ));\n  }\n  return points;\n}\n\n// function getFanTrisPolygon(\n//   radius: number,\n//   rotation: number,\n//   offset: Point,\n//   sides: number,\n//   sidesToDraw: number,\n//   direction: -1 | 1,\n// ): Array<Point> {\n//   const fan = [offset._dup(), ...getPolygonPoints(\n//     radius, rotation, offset, sides, sidesToDraw, direction,\n//   )];\n//   if (sides === sidesToDraw) {\n//     fan.push(fan[1]._dup());\n//   }\n//   return fan;\n// }\n\nfunction getTrisFillPolygon(\n  center: Point,\n  border: Array<Point>,\n  sides: number,\n  sidesToDraw: number,\n): Array<Point> {\n  const points = [];\n  // const center = border.slice(-1)[0];\n  for (let i = 1; i < border.length; i += 1) {\n    points.push(center._dup());\n    points.push(border[i]._dup());\n    points.push(border[i - 1]._dup());\n  }\n  if (sides === sidesToDraw) {\n    points.push(center._dup());\n    points.push(border[0]._dup());\n    points.push(border[border.length - 1]._dup());\n  }\n  return points;\n}\n\nexport {\n  getPolygonPoints,\n  // getFanTrisPolygon,\n  getTrisFillPolygon,\n};\n","// @flow\nimport {\n  Point,\n} from '../../tools/g2';\n\n// import {\n//   round,\n// } from '../../../../tools/math';\n\nfunction getRectPoints(\n  width: number,\n  height: number,\n  sides: number,\n  radius: number,\n  x: number,\n  y: number,\n  offset: Point = new Point(0, 0),\n) {\n  if (radius < 0.000000001) {\n    return [\n      new Point(x + offset.x, y + offset.y),\n      new Point(x + width + offset.x, y + offset.y),\n      new Point(x + width + offset.x, y + height + offset.y),\n      new Point(x + offset.x, y + height + offset.y),\n    ];\n  }\n  const points = [];\n  const deltaAngle = Math.PI / 2 / sides;\n  const r = Math.min(width / 2, height / 2, radius);\n  const corners = [\n    [x + r, y + r, Math.PI],\n    [x - r + width, y + r, Math.PI / 2 * 3],\n    [x - r + width, y - r + height, 0],\n    [x + r, y - r + height, Math.PI / 2],\n  ];\n  corners.forEach((corner) => {\n    const [cx, cy, angle] = corner;\n    for (let i = 0; i < sides + 1; i += 1) {\n      points.push(new Point(\n        cx + r * Math.cos(i * deltaAngle + angle),\n        cy + r * Math.sin(i * deltaAngle + angle),\n      ).add(offset));\n    }\n  });\n  return points;\n}\n\nfunction getRectangleBorder(\n  options: {\n    width: number,\n    height: number,\n    xAlign: 'left' | 'center' | 'right' | number,\n    yAlign: 'bottom' | 'middle' | 'top' | number,\n    corner: {\n      radius: number,\n      sides: number,\n    },\n    line?: {\n      widthIs: 'inside' | 'outside' | 'positive' | 'negative' | 'mid' | number,\n      width: number,\n    },\n    // border: 'rect' | 'outline' | Array<Array<Point>>,\n    drawBorderBuffer: number | Array<Array<Point>>,\n    offset: Point,\n  },\n) {\n  const {\n    width, height, xAlign, yAlign,\n  } = options;\n  // const { drawBorderBuffer } = options;\n  let x = 0;\n  let y = 0;\n  if (xAlign === 'center') {\n    x = -width / 2;\n  } else if (xAlign === 'right') {\n    x = -width;\n  } else if (typeof xAlign === 'number') {\n    x = -width * xAlign;\n  }\n  if (yAlign === 'middle') {\n    y = -height / 2;\n  } else if (yAlign === 'top') {\n    y = -height;\n  } else if (typeof yAlign === 'number') {\n    y = -height * yAlign;\n  }\n  const { radius, sides } = options.corner;\n  const points = getRectPoints(width, height, sides, radius, x, y, options.offset);\n  // let lineDelta = 0;\n  // if (line != null && line.widthIs === 'mid') {\n  //   lineDelta = line.width / 2;\n  // }\n  // if (line != null && (line.widthIs === 'outside' || line.widthIs === 'negative')) {\n  //   lineDelta = line.width;\n  // }\n  // let outline: Array<Point>;\n  // if (lineDelta > 0) {\n  //   outline = getRectPoints(\n  //     width + lineDelta * 2,\n  //     height + lineDelta * 2,\n  //     sides, radius, x - lineDelta, y - lineDelta, options.offset,\n  //   );\n  // } else {  // $FlowFixMe\n  //   outline = points.map(p => p._dup());\n  // }\n\n  // const border = [outline];\n\n  // let bufferBorder = border;\n  // if (typeof drawBorderBuffer === 'number') {\n  //   bufferBorder = [getRectPoints(\n  //     width + lineDelta * 2 + drawBorderBuffer * 2,\n  //     height + lineDelta * 2 + drawBorderBuffer * 2,\n  //     sides, radius, x - lineDelta - drawBorderBuffer, y - lineDelta - drawBorderBuffer,\n  //     options.offset,\n  //   )];\n  // } else {\n  //   bufferBorder = drawBorderBuffer;\n  // }\n  // console.log(points)\n  return points;\n}\n\nfunction rectangleBorderToTris(border: Array<Point>) {\n  const points = [border[0]._dup(), border[1]._dup(), border[2]._dup()];\n  for (let i = 2; i < border.length - 1; i += 1) {\n    points.push(border[0]);\n    points.push(border[i]);\n    points.push(border[i + 1]);\n  }\n  return points;\n}\n\nexport {\n  getRectangleBorder,\n  rectangleBorderToTris,\n};\n\n","// @flow\nimport {\n  Point, Transform, Line, minAngleDiff, threePointAngle, getPoints, getTriangleCenter,\n} from '../../tools/g2';\nimport {\n  joinObjects,\n} from '../../tools/tools';\n// import {\n//   makePolyLine,\n// } from './lines/lines';\nimport type { TypeParsablePoint } from '../../tools/g2';\n\n\nfunction getTriangleDirection(points: Array<Point>) {\n  const [p1, p2, p3] = points;\n  const angle = threePointAngle(p1, p2, p3);\n  if (angle > Math.PI) {\n    return 1;\n  }\n  return -1;\n}\n\n// function increaseTriangleByOffset(points: Array<Point>, delta) {\n//   const direction = getTriangleDirection(points);\n//   const [, , outline] = makePolyLine(\n//     points, delta, true, direction === -1 ? 'negative' : 'positive', 'auto', 0.1,\n//     10, Math.PI / 7, [], false,\n//     2, direction === -1 ? 'negative' : 'positive', 0, [],\n//   );\n//   return [outline[0][0], outline[0][1], outline[0][3]];\n// }\n\nfunction alignTriangle(\n  pointsIn: Array<Point>,\n  xAlign: 'left' | 'center' | 'right' | number | 'a1' | 'a2' | 'a3' | 's1' | 's2' | 's3' | 'centroid' | 'points',\n  yAlign: 'bottom' | 'middle' | 'top' | number | 'a1' | 'a2' | 'a3' | 's1' | 's2' | 's3' | 'centroid' | 'points',\n  rotation: number | 's1' | 's2' | 's3' | { side?: 's1' | 's2' | 's3', angle?: number },\n  // definedWithPoints: boolean,\n): Array<Point> {\n  let rotationMatrix;\n  if (typeof rotation === 'number') {\n    rotationMatrix = new Transform().rotate(rotation).matrix();\n  } else {\n    let side = 's1';\n    let angle = 0;\n    if (typeof rotation === 'string') {\n      side = rotation;\n    } else {\n      ({ side, angle } = joinObjects({}, { side: 's1', angle: 0 }, rotation));\n    }\n    let r = 0;\n    if (side === 's1') {\n      const sideRot = new Line(pointsIn[0], pointsIn[1]).angle();\n      r = minAngleDiff(angle, sideRot);\n    } else if (side === 's2') {\n      const sideRot = new Line(pointsIn[1], pointsIn[2]).angle();\n      r = minAngleDiff(angle, sideRot);\n    } else if (side === 's3') {\n      const sideRot = new Line(pointsIn[2], pointsIn[0]).angle();\n      r = minAngleDiff(angle, sideRot);\n    }\n    rotationMatrix = new Transform().rotate(r).matrix();\n  }\n  const points = pointsIn.map(p => p.transformBy(rotationMatrix));\n\n  const minX = Math.min(points[0].x, points[1].x, points[2].x);\n  const minY = Math.min(points[0].y, points[1].y, points[2].y);\n  const maxX = Math.max(points[0].x, points[1].x, points[2].x);\n  const maxY = Math.max(points[0].y, points[1].y, points[2].y);\n  const width = maxX - minX;\n  const height = maxY - minY;\n  const center = getTriangleCenter(points[0], points[1], points[2]);\n  const s1Center = new Line(points[0], points[1]).midPoint();\n  const s2Center = new Line(points[1], points[2]).midPoint();\n  const s3Center = new Line(points[2], points[0]).midPoint();\n  let x = 0;\n  let y = 0;\n  if (xAlign === 'left') {\n    x = -minX;\n  } else if (xAlign === 'center') {\n    x = -maxX + width / 2;\n  } else if (xAlign === 'right') {\n    x = -maxX;\n  } else if (xAlign === 'centroid') {\n    x = -center.x;\n  } else if (xAlign === 'a2') {\n    x = -points[1].x;\n  } else if (xAlign === 'a3') {\n    x = -points[2].x;\n  } else if (xAlign === 's1') {\n    x = -s1Center.x;\n  } else if (xAlign === 's2') {\n    x = -s2Center.x;\n  } else if (xAlign === 's3') {\n    x = -s3Center.x;\n  } else if (typeof xAlign === 'number') {\n    x = -minX - width * xAlign;\n  }\n\n  if (yAlign === 'bottom') {\n    y = -minY;\n  } else if (yAlign === 'middle') {\n    y = -maxY + height / 2;\n  } else if (yAlign === 'top') {\n    y = -maxY;\n  } else if (yAlign === 'centroid') {\n    y = -center.y;\n  } else if (yAlign === 'a2') {\n    y = -points[1].y;\n  } else if (yAlign === 'a3') {\n    y = -points[2].y;\n  } else if (yAlign === 's1') {\n    y = -s1Center.y;\n  } else if (yAlign === 's2') {\n    y = -s2Center.y;\n  } else if (yAlign === 's3') {\n    y = -s3Center.y;\n  } else if (typeof yAlign === 'number') {\n    y = -minY - height * yAlign;\n  }\n\n  return points.map(p => new Point(p.x + x, p.y + y));\n}\n\n//                             c3\n//                              .\n//                            .   .\n//                         .   a3   .\n//                       .            .\n//                s3   .                .   s2\n//                   .                    .\n//                 .                        .\n//               /                           \\\n//             /  a1                       a2  \\\n//         c1  ---------------------------------   c2\n//                           s1\n//\n//\nfunction getASAPoints(\n  ASA: [number, number, number],\n  direction: 1 | -1,\n) {\n  const [a1, s1, a2] = ASA;\n  const points = [new Point(0, 0), new Point(s1, 0)];\n  const a3 = Math.PI - a1 - a2;\n  const s2 = s1 / Math.sin(a3) * Math.sin(a1);\n  points.push(new Point(\n    s1 + s2 * Math.cos((Math.PI - a2) * direction),\n    0 + s2 * Math.sin((Math.PI - a2) * direction),\n  ));\n\n  return points;\n}\n\n//                             c3\n//                              .\n//                            .   \\\n//                         .   a3   \\\n//                       .            \\\n//                s3   .                \\   s2\n//                   .                    \\\n//                 .                       \\\n//               .                           \\\n//             .  a1                       a2  \\\n//         c1  ---------------------------------   c2\n//                           s1\n//\n//\nfunction getSASPoints(\n  SAS: [number, number, number],\n  direction: 1 | -1,\n) {\n  const [s1, a2, s2] = SAS;\n  const points = [new Point(0, 0), new Point(s1, 0)];\n  points.push(new Point(\n    s1 + s2 * Math.cos((Math.PI - a2) * direction),\n    0 + s2 * Math.sin((Math.PI - a2) * direction),\n  ));\n\n  return points;\n}\n\n\n//                             c3\n//                              .\n//                            .   \\\n//                         .   a3   \\\n//                       .            \\\n//                s3   .                \\   s2\n//                   .                    \\\n//                 .                       \\\n//               .                           \\\n//             .  a1                       a2  \\\n//         c1  . . . . . . . . . . . . . . . . . .  c2\n//                           s1\n//\n//\nfunction getAASPoints(\n  AAS: [number, number, number],\n  direction: 1 | -1,\n) {\n  const [a1, a2, s2] = AAS;\n  const a3 = Math.PI - a1 - a2;\n  const s1 = s2 / Math.sin(a1) * Math.sin(a3);\n  const points = [new Point(0, 0), new Point(s1, 0)];\n  points.push(new Point(\n    s1 + s2 * Math.cos((Math.PI - a2) * direction),\n    0 + s2 * Math.sin((Math.PI - a2) * direction),\n  ));\n\n  return points;\n}\n\n//                             c3\n//                              .\n//                            /   \\\n//                         /   a3   \\\n//                       /            \\\n//                s3   /                \\   s2\n//                   /                    \\\n//                 /                       \\\n//               /                           \\\n//             /  a1                       a2  \\\n//         c1  ----------------------------------   c2\n//                           s1\n//\n//\nfunction getSSSPoints(\n  SSS: [number, number, number],\n  direction: 1 | -1,\n) {\n  const [s1, s2, s3] = SSS;\n  const a2 = Math.acos((s1 * s1 + s2 * s2 - s3 * s3) / (2 * s1 * s2));\n  const points = [new Point(0, 0), new Point(s1, 0)];\n  points.push(new Point(\n    s1 + s2 * Math.cos((Math.PI - a2) * direction),\n    0 + s2 * Math.sin((Math.PI - a2) * direction),\n  ));\n  return points;\n}\n\nexport type OBJ_Triangle_Defined = {\n  width: number,\n  height: number,\n  // xAlign: 'left' | 'center' | 'right' | number,\n  // yAlign: 'bottom' | 'middle' | 'top' | number,\n  top: 'left' | 'right' | 'center',\n  points?: Array<TypeParsablePoint>,\n  SSS?: [number, number, number],\n  ASA?: [number, number, number],\n  AAS?: [number, number, number],\n  SAS?: [number, number, number],\n  direction: 1 | -1,\n  // rotation: number | { side: number, angle: number },\n  xAlign: 'left' | 'center' | 'right' | number | 'a1' | 'a2' | 'a3' | 's1' | 's2' | 's3' | 'centroid' | 'points',\n  yAlign: 'bottom' | 'middle' | 'top' | number | 'a1' | 'a2' | 'a3' | 's1' | 's2' | 's3' | 'centroid' | 'points',\n  rotation: number | 's1' | 's2' | 's3' | { side?: 's1' | 's2' | 's3', angle?: number },\n  line?: {\n    widthIs: 'inside' | 'outside' | 'positive' | 'negative' | 'mid',\n    width: number,\n  },\n  drawBorderBuffer: number | Array<Array<TypeParsablePoint>>\n};\n\nfunction getTriangleBorder(options: OBJ_Triangle_Defined) {\n  let points;\n  const { direction } = options;\n  if (options.points != null) {\n    points = getPoints(options.points);\n  } else if (options.ASA != null) {\n    points = getASAPoints(options.ASA, direction);\n  } else if (options.SAS != null) {\n    points = getSASPoints(options.SAS, direction);\n  } else if (options.AAS != null) {\n    points = getAASPoints(options.AAS, direction);\n  } else if (options.SSS != null) {\n    points = getSSSPoints(options.SSS, direction);\n  } else {\n    const { width, height, top } = options;\n    points = [\n      new Point(0, 0),\n      new Point(width, 0),\n    ];\n    if (top === 'left') {\n      points.push(new Point(0, height * direction));\n    } else if (top === 'center') {\n      points.push(new Point(width / 2, height * direction));\n    } else if (top === 'right') {\n      points.push(new Point(width, height * direction));\n    }\n  }\n\n  return alignTriangle(points, options.xAlign, options.yAlign, options.rotation);\n}\n\nexport {\n  getTriangleBorder,\n  getTriangleDirection,\n};\n","// @flow\n\n/**\n * `'nextFrame'` | `'prevFrame'` | `'syncNow'` | `'now'`\n *\n *\n * `'syncNow'` is a synchronized 'now' time. The\n * first time 'syncNow' is used, the current time will be stored and used\n * for all subsequent calls to 'syncNow'. 'syncNow' is reset every\n * time a new animation frame is drawn, or 100ms after a first syncNow call\n * has been made after a reset.\n *\n * 'now' is the instantaneous time\n *\n * `'nextFrame'` will be the time of the next animation frame\n *\n * `'prevFrame'` is the time of the last animation frame\n * @typedef {'now' | 'nextFrame' | 'prevFrame' | 'syncNow'} TypeWhen\n */\nexport type TypeWhen = 'now' | 'nextFrame' | 'prevFrame' | 'syncNow';\n\n// Singleton class that contains projects global variables\nclass GlobalAnimation {\n  // Method for requesting the next animation frame\n  requestNextAnimationFrame: (()=>mixed) => AnimationFrameID;\n  animationId: AnimationFrameID;    // used to cancel animation frames\n  static instance: Object;\n  drawQueue: Array<(number) => void>;\n  nextDrawQueue: Array<(number) => void>;\n  lastFrame: ?number;\n  debug: boolean;\n  simulatedFPS: number;\n  debugFrameTime: ?number;\n  nowTime: number;\n  now: function;\n  timeoutId: ?TimeoutID;\n  speed: number;\n  // syncNow: () => number;\n  synchronizedNow: number;\n  updateSyncNow: boolean;\n  timers: Array<TimeoutID>;\n  syncNowTimer: TimeoutID;\n  manual: boolean;\n\n  constructor() {\n    // If the instance alread exists, then don't create a new instance.\n    // If it doesn't, then setup some default values.\n    if (!GlobalAnimation.instance) {\n      this.requestNextAnimationFrame = (\n        window.requestAnimationFrame\n        || window.mozRequestAnimationFrame\n        || window.webkitRequestAnimationFrame\n        || window.msRequestAnimationFrame\n      );\n      GlobalAnimation.instance = this;\n      this.reset();\n    }\n    return GlobalAnimation.instance;\n  }\n\n  reset() {\n    this.drawQueue = [];\n    this.nextDrawQueue = [];\n    this.lastFrame = null;\n    this.debug = false;\n    this.simulatedFPS = 60;\n    this.debugFrameTime = 0.5;\n    if (this.timers != null && this.timers.length > 0) {\n      this.timers.forEach(id => clearTimeout(id));\n    }\n    this.timers = [];\n    if (this.timeoutId != null) {\n      clearTimeout(this.timeoutId);\n    }\n    this.timeoutId = null;\n    this.now = () => performance.now();\n    this.updateSyncNow = true;\n    this.manual = false;\n  }\n\n  getWhen(when: TypeWhen) {\n    if (when === 'now') {\n      return this.now();\n    }\n    if (when === 'prevFrame') {\n      return this.lastFrame;\n    }\n    if (when === 'syncNow') {\n      return this.syncNow();\n    }\n    return null;\n  }\n\n  syncNow() {\n    if (this.updateSyncNow) {\n      this.updateSyncNow = false;\n      this.synchronizedNow = this.now();\n      this.syncNowTimer = setTimeout(() => { this.updateSyncNow = true; }, 100);\n    }\n    return this.synchronizedNow;\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  now() {\n    return performance.now();\n  }\n\n  setDebugFrameRate(simulatedFPS: number = 60, frameTime: ?number = 1) {\n    if (this.timeoutId != null) {\n      clearTimeout(this.timeoutId);\n    }\n    cancelAnimationFrame(this.animationId);\n    this.simulatedFPS = simulatedFPS;\n    this.debugFrameTime = frameTime;\n    this.debug = true;\n    this.nowTime = performance.now();\n    this.now = () => this.nowTime;\n    this.queueNextDebugFrame();\n  }\n\n  setManualFrames() {\n    this.manual = true;\n    this.nowTime = performance.now();\n    this.now = () => this.nowTime;\n  }\n\n  endManualFrames() {\n    this.manual = false;\n    this.now = () => performance.now;\n  }\n\n  frame(duration: number) {\n    this.nowTime += duration * 1000;\n    this.draw(this.nowTime);\n  }\n\n  queueNextDebugFrame() {\n    if (this.debugFrameTime != null) {\n      this.timeoutId = setTimeout(() => {\n        this.nowTime += 1 / this.simulatedFPS * 1000;\n        if (this.nextDrawQueue.length > 0) {\n          this.draw(this.now());\n        }\n        this.queueNextDebugFrame();\n      }, this.debugFrameTime * 1000);\n    } else {\n      this.nowTime += 1 / this.simulatedFPS * 1000;\n      if (this.nextDrawQueue.length > 0) {\n        this.draw(this.now());\n      }\n    }\n  }\n\n  setTimeout(f: function, time: number): TimeoutID {\n    if (this.debug) {\n      let timeScale = 0;\n      if (this.debugFrameTime != null) {\n        timeScale = (this.debugFrameTime || 0) / (1 / this.simulatedFPS);\n      }\n      // console.log('setTimeout', time, timeScale)\n      if (timeScale > 0) {\n        const id = setTimeout(f, time * timeScale);\n        this.timers.push(id);\n        return id;\n      }\n      const id = setTimeout(f, 0);\n      this.timers.push(id);\n      return id;\n    }\n    const id = setTimeout(f, time);\n    this.timers.push(id);\n    return id;\n  }\n\n  clearTimeout(id: TimeoutID | null) {\n    if (id == null) {\n      return;\n    }\n    clearTimeout(id);\n\n    const index = this.timers.indexOf(id);\n    if (index > -1) {\n      this.timers.splice(index, 1);\n    }\n  }\n\n  disableDebugFrameRate() {\n    if (this.timeoutId != null) {\n      clearTimeout(this.timeoutId);\n    }\n    this.timeoutId = null;\n    this.debug = false;\n    if (this.nextDrawQueue.length > 0) {\n      this.animateNextFrame();\n    }\n  }\n\n  draw(now: number) {\n    clearTimeout(this.syncNowTimer);\n    this.updateSyncNow = true;\n    this.drawQueue = this.nextDrawQueue;\n    this.nextDrawQueue = [];\n    let nowSeconds = now * 0.001;\n    if (this.manual) {\n      nowSeconds = this.now() * 0.001;\n    }\n    for (let i = 0; i < this.drawQueue.length; i += 1) {\n      this.drawQueue[i](nowSeconds);\n    }\n    this.drawQueue = [];\n    this.lastFrame = now;\n  }\n\n  queueNextFrame(func: (?number) => void) {\n    // if (!(func in this.nextDrawQueue)) {\n    this.nextDrawQueue.push(func);\n    // }\n\n    // if (triggerFrameRequest) {\n    //   this.animateNextFrame();\n    // }\n    if (this.nextDrawQueue.length === 1) {\n      if (!this.debug) {\n        this.animateNextFrame();\n      }\n    }\n  }\n\n  // simulateNextFrame() {\n  //   if (this.timeoutId == null) {\n  //     this.queueNextDebugFrame();\n  //   }\n  // }\n\n  // Queue up an animation frame\n  animateNextFrame() {\n    cancelAnimationFrame(this.animationId);\n    // $FlowFixMe\n    const nextFrame = this.requestNextAnimationFrame.call(window, this.draw.bind(this));\n    this.animationId = nextFrame;\n  }\n}\n\n// Do not automatically create and instance and return it otherwise can't\n// mock elements in jest\n// // const globalvars: Object = new GlobalVariables();\n// // Object.freeze(globalvars);\n\nexport default GlobalAnimation;\n","// @flow\n\nconst vertex = {\n  simple: {\n    source:\n        'attribute vec2 a_position;'\n        + 'uniform mat3 u_matrix;'\n        + 'uniform float u_z;'\n        + 'void main() {'\n          + 'gl_Position = vec4((u_matrix * vec3(a_position, 1)).xy, u_z, 1);'\n        + '}',\n    varNames: ['a_position', 'u_matrix', 'u_z'],\n  },\n  withTexture: {\n    source:\n        'attribute vec2 a_position;'\n        + 'attribute vec2 a_texcoord;'\n        + 'uniform mat3 u_matrix;'\n        + 'uniform float u_z;'\n        + 'varying vec2 v_texcoord;'\n        + 'void main() {'\n          + 'gl_Position = vec4((u_matrix * vec3(a_position, 1)).xy, u_z, 1);'\n          + 'v_texcoord = a_texcoord;'\n        + '}',\n    varNames: ['a_position', 'a_texcoord', 'u_matrix', 'u_z'],\n  },\n};\n\nconst fragment = {\n  simple: {\n    source:\n      'precision mediump float;'\n      + 'uniform vec4 u_color;'\n      + 'void main() {'\n        + 'gl_FragColor = u_color;'\n      + '}',\n    varNames: ['u_color'],\n  },\n  withTexture: {\n    source:\n      'precision mediump float;'\n      + 'uniform vec4 u_color;'\n      + 'uniform int u_use_texture;'\n      + 'uniform sampler2D u_texture;'\n      + 'varying vec2 v_texcoord;'\n      + 'void main() {'\n        + 'if ( u_use_texture == 1) {'\n          + 'gl_FragColor = texture2D(u_texture, v_texcoord);'\n        + '} else {'\n          + 'gl_FragColor = u_color;'\n        + '}'\n      + '}',\n    varNames: ['u_color', 'u_use_texture', 'u_texture'],\n  },\n  text: {\n    source:\n      'precision mediump float;'\n      + 'uniform vec4 u_color;'\n      + 'uniform sampler2D u_texture;'\n      + 'varying vec2 v_texcoord;'\n      + 'void main() {'\n        // + 'float a = texture2D(u_texture, v_texcoord).a;'\n        // + 'if ( a < 0.2 ) {'\n        //   + 'a = a / 1.2;'\n        // + '}'\n        // + 'gl_FragColor = vec4(u_color.rgb, min(a * 1.2, 1.0) * u_color.a);'\n        // + '}'\n        // + 'gl_FragColor = a * u_color;'\n        + 'vec4 c = texture2D(u_texture, v_texcoord);'\n        + 'gl_FragColor = vec4(c.a * u_color.rgb, c.a * u_color.a);'\n      + '}',\n    varNames: ['u_color', 'u_texture'],\n  },\n};\n\nconst getShaders = (vName: string = 'simple', fName: string = 'simple') => {\n  if (Object.hasOwnProperty.call(vertex, vName) && Object.hasOwnProperty.call(fragment, fName)) {\n    return {\n      vertexSource: vertex[vName].source,\n      fragmentSource: fragment[fName].source,\n      varNames: vertex[vName].varNames.concat(fragment[fName].varNames),\n    };\n  }\n  return {\n    vertexSource: '',\n    fragmentSource: '',\n    varNames: [],\n  };\n};\n\nexport default getShaders;\n\n","// @flow\n\nimport getShaders from './shaders';\n\nconst glMock = {\n  TRIANGLES: 1,\n  TRIANGLE_STRIP: 2,\n  TRIANGLE_FAN: 3,\n  LINES: 4,\n  LINK_STATUS: 1,\n  VERTEX_SHADER: 1,\n  COMPILE_STATUS: 1,\n  FRAGMENT_SHADER: 1,\n  SRC_ALPHA: 1,\n  ONE_MINUS_SRC_ALPHA: 1,\n  BLEND: 1,\n  COLOR_BUFFER_BIT: 1,\n  TEXTURE_2D: 1,\n  RGBA: 1,\n  UNSIGNED_BYTE: 1,\n  TEXTURE_WRAP_S: 1,\n  CLAMP_TO_EDGE: 1,\n  TEXTURE_WRAP_T: 1,\n  TEXTURE_MIN_FILTER: 1,\n  LINEAR: 1,\n  ARRAY_BUFFER: 1,\n  STATIC_DRAW: 1,\n  FLOAT: 1,\n  UNPACK_PREMULTIPLY_ALPHA_WEBGL: 1,\n  createBuffer: () => {},\n  bindBuffer: () => {},\n  bufferData: () => {},\n  enableVertexAttribArray: () => {},\n  vertexAttribPointer: () => {},\n  disableVertexAttribArray: () => {},\n  uniformMatrix3fv: () => {},\n  uniform4f: () => {},\n  uniform1f: () => {},\n  uniform1i: () => {},\n  texParameteri: () => {},\n  drawArrays: () => {},\n  clearColor: () => {},\n  clear: () => {},\n  createTexture: () => {},\n  activeTexture: () => {},\n  bindTexture: () => {},\n  pixelStorei: () => {},\n  texImage2D: () => {},\n  blendFunc: () => {},\n  attachShader: () => {},\n  linkProgram: () => {},\n  getProgramParameter: () => {},\n  createProgram: () => {},\n  deleteProgram: () => {},\n  createShader: () => {},\n  shaderSource: () => {},\n  compileShader: () => {},\n  getShaderParameter: () => {},\n  getAttribLocation: () => {},\n  getUniformLocation: () => {},\n  enable: () => {},\n  map: () => {},\n  getExtension: () => ({\n    loseContext: () => {},\n  }),\n  disable: () => {},\n  deleteShader: () => {},\n  useProgram: () => {},\n  viewport: () => {},\n  canvas: ({\n    toDataURL: () => '',\n    width: 100,\n    clientHeight: 100,\n    height: 100,\n    style: {\n      top: 0,\n      visibility: 'visible',\n    },\n  }),\n\n};\n\nfunction createProgram(\n  gl: WebGLRenderingContext,\n  vertexShader: WebGLShader,\n  fragmentShader: WebGLShader,\n) {\n  const program = gl.createProgram();\n  gl.attachShader(program, vertexShader);\n  gl.attachShader(program, fragmentShader);\n  gl.linkProgram(program);\n  const success = gl.getProgramParameter(program, gl.LINK_STATUS);\n  if (success) {\n    return program;\n  }\n\n  gl.deleteProgram(program);\n  return null;\n}\n\n\nfunction createShader(gl: WebGLRenderingContext, type, source) {\n  const shader = gl.createShader(type);\n  gl.shaderSource(shader, source);\n  gl.compileShader(shader);\n  const success = gl.getShaderParameter(shader, gl.COMPILE_STATUS);\n  if (success) {\n    return shader;\n  }\n\n  gl.deleteShader(shader);\n  return null;\n}\n\n\nfunction createProgramFromScripts(\n  gl: WebGLRenderingContext,\n  vertexShaderSource: string,\n  fragmentShaderSource: string,\n) {\n  // Get the strings for our GLSL shaders\n  // const vertexShaderSource = document.getElementById(vertexScript).text;\n  // const fragmentShaderSource = document.getElementById(fragScript).text;\n  // create GLSL shaders, upload the GLSL source, compile the shaders\n  const vertexShader = createShader(gl, gl.VERTEX_SHADER, vertexShaderSource);\n  const fragmentShader = createShader(gl, gl.FRAGMENT_SHADER, fragmentShaderSource);\n\n  // Link the two shaders into a program\n  if (vertexShader && fragmentShader) {\n    return createProgram(gl, vertexShader, fragmentShader);\n  }\n  return null;\n}\n\nfunction getGLLocations(gl, program, locationsList) {\n  let i;\n  const newLocations = {};\n  let loc;\n  for (i = 0; i < locationsList.length; i += 1) {\n    loc = locationsList[i];\n    if (loc[0] === 'a') {\n      newLocations[loc] = gl.getAttribLocation(program, loc);\n    }\n    if (loc[0] === 'u') {\n      newLocations[loc] = gl.getUniformLocation(program, loc);\n    }\n  }\n  return newLocations;\n}\n\n// function resizeCanvasToDisplaySize(canvas) {\n//   // const mul = multiplier || 1;\n//   const mul = window.devicePixelRatio || 1;\n//   const width = canvas.clientWidth * mul || 0;\n//   const height = canvas.clientHeight * mul || 0;\n\n//   if (canvas.width !== width || canvas.height !== height) {\n//     canvas.width = width;     // eslint-disable-line no-param-reassign\n//     canvas.height = height;   // eslint-disable-line no-param-reassign\n//     return true;\n//   }\n//   return false;\n// }\n\n/* eslint-disable */\nfunction autoResize(event) {\n  // let contRect = document.getElementById('container').getBoundingClientRect();\n  // let diagRect = document.getElementById('figure').getBoundingClientRect();\n  // let textRect = document.getElementById('learning_text_container').getBoundingClientRect();\n  // let canvRect = this.gl.canvas.getBoundingClientRect();\n  // // console.log(contRect)\n  // console.log(this.gl.canvas.getBoundingClientRect());\n  // // this.gl.canvas.height = 500;\n  // // this.gl.canvas.width = 500;\n  // // this.gl.canvas.width=500;\n  // // this.gl.viewport(diagRect.left, canvRect.height+canvRect.top, textRect.width, textRect.height); \n  // // this.gl.viewport(0,0,100,100);\n  // // console.log(document.getElementById('Figure').left);\n}\n\n\nclass WebGLInstance {\n  gl: WebGLRenderingContext;\n  program: WebGLProgram;\n  // locations: Object;\n  lastUsedProgram: ?WebGLProgram;\n  textures: {\n    [name: string]: {\n      glTexture: WebGLTexture;\n      index: number;\n      type: 'image' | 'canvasText';\n      state: 'loading' | 'loaded';\n      onLoad: Array<() => void>\n    };\n  };\n  programs: Array<{\n    vertexShader: string,\n    fragmentShader: string,\n    locations: Object,\n    program: WebGLProgram;\n  }>;\n\n  addTexture(\n    id: string,\n    glTexture: WebGLTexture,\n    type: 'image' | 'canvasText',\n  ) {\n    if (this.textures[id] && this.textures[id].glTexture != null) {\n      return this.textures[id].index;\n    }\n    let index = 0;\n    if (this.textures[id]) {\n      index = this.textures[id].index;\n    } else {\n      index = Object.keys(this.textures).length;\n    }\n    this.textures[id] = {\n      glTexture,\n      index,\n      type,\n      state: 'loaded',\n      onLoad: [],\n    };\n    return index;\n  }\n\n  onLoad(textureId: string) {\n    this.textures[textureId].onLoad.forEach(f => f());\n    this.textures[textureId].onLoad = [];\n  }\n\n  getProgram(\n    vertexShader: string,\n    fragmentShader: string,\n  ) {\n    for (let i = 0; i < this.programs.length; i += 1) {\n      const program = this.programs[i];\n      if (program.vertexShader === vertexShader\n        && program.fragmentShader === fragmentShader\n      ) {\n        return i;\n      }\n    }\n\n    const shaders = getShaders(vertexShader, fragmentShader);\n    const newProgram = createProgramFromScripts(\n      this.gl,\n      shaders.vertexSource,\n      shaders.fragmentSource,\n    );\n    const programDetails = {\n      vertexShader,\n      fragmentShader,\n      program: newProgram,\n      locations: getGLLocations(this.gl, newProgram, shaders.varNames),\n    };\n    this.programs.push(programDetails);\n    return this.programs.length - 1;\n  }\n\n  useProgram(programIndex: number) {\n    const program = this.programs[programIndex];\n    if (this.lastUsedProgram !== program) {\n      this.gl.useProgram(program.program);\n      this.lastUsedProgram = program.program;\n    }\n    return program.locations;\n  }\n\n  constructor(\n  canvas: HTMLCanvasElement,\n  // vertexSource: string,\n  // fragmentSource: string,\n  // shaderLocations: Array<string>,\n  backgroundColor: Array<number>,\n) {\n    let gl: ?WebGLRenderingContext = canvas.getContext('webgl', { antialias: true });\n    if (gl == null) {\n      // $FlowFixMe\n      gl = glMock;\n    }\n    this.programs = [];\n    this.lastUsedProgram = null;\n    this.textures = {};\n    if (gl != null) {\n      // $FlowFixMe\n      this.gl = gl;\n      \n      // this.program = createProgramFromScripts(\n      //   this.gl,\n      //   vertexSource,\n      //   fragmentSource,\n      // );\n\n      // this.locations = getGLLocations(this.gl, this.program, shaderLocations);\n\n      // Prep canvas\n      // resizeCanvasToDisplaySize(this.gl.canvas);\n      this.resize();\n\n\n      // Tell WebGL how to convert from clip space to pixels\n      // this.gl.viewport(0, 0, this.gl.canvas.width, this.gl.canvas.height);\n      // gl.viewport(0, 0, gl.drawingBufferWidth, gl.drawingBufferHeight);\n\n      // this.gl.viewport(0, 500, 500, 500);   // Tell WebGL how to convert from clip space to pixels\n\n      // Clear the canvas\n      // const bc = backgroundColor;\n      // this.gl.clearColor(bc[0], bc[1], bc[2], bc[3]);\n      this.gl.clearColor(0, 0, 0, 0);\n      this.gl.clear(this.gl.COLOR_BUFFER_BIT);\n      this.gl.disable(this.gl.DEPTH_TEST);\n      this.gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA)\n      this.gl.enable(gl.BLEND);\n      // this.gl.useProgram(this.program);\n\n      // window.addEventListener('resize', autoResize.bind(this, event));\n    }\n  }\n\n  resize() {\n    var realToCSSPixels = window.devicePixelRatio;\n    // console.log(\"asdf\");\n    // Lookup the size the browser is displaying the canvas in CSS pixels\n    // and compute a size needed to make our drawingbuffer match it in\n    // device pixels.\n    var displayWidth  =\n      Math.floor(this.gl.canvas.clientWidth  * realToCSSPixels);\n    var displayHeight =\n      Math.floor(this.gl.canvas.clientHeight * realToCSSPixels);\n    // console.log('in webgl', displayWidth)\n    // Check if the canvas is not the same size.\n    if (this.gl.canvas.width  !== displayWidth\n        || this.gl.canvas.height !== displayHeight) {\n\n      // Make the canvas the same size\n      this.gl.canvas.width  = displayWidth;\n      this.gl.canvas.height = displayHeight;\n    }\n\n    this.gl.viewport(0, 0, this.gl.drawingBufferWidth, this.gl.drawingBufferHeight);\n  }\n  // resize() {\n  //   var width = this.gl.canvas.clientWidth;\n  //   var height = this.gl.canvas.clientHeight;\n  //   if (this.gl.canvas.width != width ||\n  //       this.gl.canvas.height != height) {\n  //      this.gl.canvas.width = width;\n  //      this.gl.canvas.height = height;\n  //      return true;\n  //   }\n  //   return false;\n  // }\n\n  // var needToRender = true;  // draw at least once\n  // function checkRender() {\n  //    if (resize() || needToRender) {\n  //      needToRender = false;\n  //      drawStuff();\n  //    }\n  //    requestAnimationFrame(checkRender);\n  // }\n  // checkRender();\n}\n\n\nexport default WebGLInstance;\n","// @flow\n// import type { Transform } from '../tools/g2';\n// import { Point, getTransform, Transform } from '../tools/g2';\n// import { round } from '../tools/math';\n// import type { FigureElement } from './Element';\n// import GlobalAnimation from './webgl/GlobalAnimation';\n\n// Singleton class that contains projects global functions\n\nclass GeneralFunctionMap {\n  map: { [id: string]: {\n    fn: Function,\n  }}\n\n  constructor() {\n    this.map = {};\n  }\n\n  add(id: string, fn: Function) {\n    if (this.map == null) {\n      this.map = {};\n    }\n    this.map[id] = {\n      fn,\n    };\n  }\n\n  exec(idOrFn: string | Function | null, ...args: any) {\n    if (idOrFn == null) {\n      return null;\n    }\n    if (typeof idOrFn === 'string') {\n      // return this.fnMap.exec(fn, ...args);\n      if (this.map[idOrFn] != null) {\n        if (args.length === 0) {\n          return this.map[idOrFn].fn();\n        }\n        return this.map[idOrFn].fn(...args);\n      }\n    }\n    if (typeof idOrFn === 'function') {\n      return idOrFn(...args);\n    }\n    return null;\n  }\n\n  execOnMaps(idOrFn: string | Function | null, mapsIn: Array<Object>, ...args: any) {\n    if (idOrFn == null) {\n      return null;\n    }\n    if (typeof idOrFn === 'string') {\n      const maps = [this.map, ...mapsIn];\n      for (let i = 0; i < maps.length; i += 1) {\n        const map = maps[i];\n        if (map[idOrFn] != null) {\n          if (args.length === 0) {\n            return map[idOrFn].fn();\n          }\n          return map[idOrFn].fn(...args);\n        }\n      }\n    }\n    if (typeof idOrFn === 'function') {\n      return idOrFn(...args);\n    }\n    return null;\n  }\n}\n\n\nclass GlobalFunctionMap extends GeneralFunctionMap {\n  static instance: Object;\n  constructor() {\n    // If the instance alread exists, then don't create a new instance.\n    // If it doesn't, then setup some default values.\n    if (!GlobalFunctionMap.instance) {\n      super();\n      GlobalFunctionMap.instance = this;\n      this.map = {};\n    }\n    return GlobalFunctionMap.instance;\n  }\n}\n\nclass FunctionMap extends GeneralFunctionMap {\n  map: { [id: string]: {\n    fn: Function,\n  }}\n\n  global: GlobalFunctionMap;\n\n  constructor() {\n    super();\n    this.global = new GlobalFunctionMap();\n  }\n\n  exec(idOrFn: string | Function | null, ...args: any) {\n    // const result = super.exec(idOrFn, ...args);\n    // if (result === null) {\n    //   return this.global.exec(idOrFn, ...args);\n    // }\n    // return result;\n    return this.execOnMaps(idOrFn, [this.global.map], ...args);\n  }\n\n  execOnMaps(idOrFn: string | Function | null, mapsIn: Array<Object>, ...args: any) {\n    return super.execOnMaps(idOrFn, [...mapsIn, this.global.map], ...args);\n  }\n}\n\nexport { FunctionMap, GlobalFunctionMap };\n","// @flow\n\nimport colorNames from './colorNames';  // official css color names\n// eslint-disable-next-line import/no-cycle\nimport getCSSColors from './getCssColors';\nimport { round } from './math';\nimport type { TypeColor } from './types';\n\n// Function that converts any rgb or rgba string to an array of rgba numbers\n// between 0 and 1\nfunction RGBToArray(color: string): Array<number> {\n  // Reduce the rgb(a) string to just numbers\n  let colString: string = color;\n  colString = colString.replace(/.*\\(/i, '');\n  colString = colString.replace(/\\)/i, '');\n  const strArray = colString.split(',');\n  // Go through each rgb(a) value and normalize to 1.0\n  const value: Array<number> = strArray.map((x, index) => {\n    if (index < 3) {\n      return parseInt(x, 10) / 255.0;\n    }\n    return parseFloat(x);\n  });\n\n  // If an alpha value isn't included, then include it with default value 1.0\n  if (value.length === 3) {\n    value.push(1);\n  }\n  return value;\n}\n\n\n// Function that converts any hex color string to an array of rgba numbers\n// between 0 and 1 (where alpha is always 1)\nfunction HexToArray(color: string): Array<number> {\n  let colHex: string = color.slice(1);\n  if (colHex.length < 6) {\n    colHex =\n      `${colHex[0]}${colHex[0]}${colHex[1]}${colHex[1]}${colHex[2]}${colHex[2]}`;\n  }\n  const col: Array<number> = [\n    parseInt(colHex.slice(0, 2), 16) / 255.0,\n    parseInt(colHex.slice(2, 4), 16) / 255.0,\n    parseInt(colHex.slice(4, 6), 16) / 255.0,\n    1,\n  ];\n  return col;\n}\n\nfunction cssColorToArray(cssColorString: string): Array<number> | null {\n  const oNames = colorNames();               // Official css color names\n  let color = cssColorString.slice(0);\n\n  // If the color is an official name, then replace it with the hex rgb\n  // equivalent\n  if (color in oNames) {\n    color = oNames[color];\n  }\n\n  // colorValue is the rgba array of colors between 0 and 1\n  let colorValue: Array<number> = [];\n\n  // If color string starts with 'rgb' (and therefore also 'rgba')\n  if (color.toLowerCase().startsWith('rgb')) {\n    colorValue = RGBToArray(color);\n\n  // If color string starts with '#' it is hex\n  } else if (color.startsWith('#')) {\n    colorValue = HexToArray(color);\n  }\n\n  // If the color value array is defined, then add it to the final\n  // dictionary\n  if (colorValue.length > 0) {\n    return colorValue;\n  }\n  return null;\n}\n\nfunction colorArrayToRGBA(color: TypeColor) {\n  return `rgba(${\n    Math.floor(color[0] * 255)},${\n    Math.floor(color[1] * 255)},${\n    Math.floor(color[2] * 255)},${\n    color[3]})`;\n}\n\nfunction colorArrayToRGB(color: TypeColor) {\n  return `rgb(${\n    Math.floor(color[0] * 255)},${\n    Math.floor(color[1] * 255)},${\n    Math.floor(color[2] * 255)})`;\n}\n\nfunction areColorsSame(color1: TypeColor, color2: TypeColor, precision: number = 5) {\n  if (color1.length !== color2.length) {\n    return false;\n  }\n  for (let i = 0; i < color1.length; i += 1) {\n    if (round(color1[i], precision) !== round(color2[i], precision)) {\n      return false;\n    }\n  }\n  return true;\n}\n\nfunction areColorsWithinDelta(color1: TypeColor, color2: TypeColor, delta: number = 0.001) {\n  if (color1.length !== color2.length) {\n    return false;\n  }\n  for (let i = 0; i < color1.length; i += 1) {\n    const dC = Math.abs(color1[i] - color2[i]);\n    if (dC > delta) {\n      return false;\n    }\n  }\n  return true;\n}\n\nexport {\n  RGBToArray, HexToArray, cssColorToArray, colorArrayToRGB,\n  colorArrayToRGBA, getCSSColors, areColorsSame, areColorsWithinDelta,\n};\n","// @ flow\n\nfunction colorNames() {\n  return {\n    aliceblue: '#f0f8ff',\n    antiquewhite: '#faebd7',\n    aqua: '#00ffff',\n    aquamarine: '#7fffd4',\n    azure: '#f0ffff',\n    beige: '#f5f5dc',\n    bisque: '#ffe4c4',\n    black: '#000000',\n    blanchedalmond: '#ffebcd',\n    blue: '#0000ff',\n    blueviolet: '#8a2be2',\n    brown: '#a52a2a',\n    burlywood: '#deb887',\n    cadetblue: '#5f9ea0',\n    chartreuse: '#7fff00',\n    chocolate: '#d2691e',\n    coral: '#ff7f50',\n    cornflowerblue: '#6495ed',\n    cornsilk: '#fff8dc',\n    crimson: '#dc143c',\n    cyan: '#00ffff',\n    darkblue: '#00008b',\n    darkcyan: '#008b8b',\n    darkgoldenrod: '#b8860b',\n    darkgray: '#a9a9a9',\n    darkgrey: '#a9a9a9',\n    darkgreen: '#006400',\n    darkkhaki: '#bdb76b',\n    darkmagenta: '#8b008b',\n    darkolivegreen: '#556b2f',\n    darkorange: '#ff8c00',\n    darkorchid: '#9932cc',\n    darkred: '#8b0000',\n    darksalmon: '#e9967a',\n    darkseagreen: '#8fbc8f',\n    darkslateblue: '#483d8b',\n    darkslategray: '#2f4f4f',\n    darkslategrey: '#2f4f4f',\n    darkturquoise: '#00ced1',\n    darkviolet: '#9400d3',\n    deeppink: '#ff1493',\n    deepskyblue: '#00bfff',\n    dimgray: '#696969',\n    dimgrey: '#696969',\n    dodgerblue: '#1e90ff',\n    firebrick: '#b22222',\n    floralwhite: '#fffaf0',\n    forestgreen: '#228b22',\n    fuchsia: '#ff00ff',\n    gainsboro: '#dcdcdc',\n    ghostwhite: '#f8f8ff',\n    gold: '#ffd700',\n    goldenrod: '#daa520',\n    gray: '#808080',\n    grey: '#808080',\n    green: '#008000',\n    greenyellow: '#adff2f',\n    honeydew: '#f0fff0',\n    hotpink: '#ff69b4',\n    indianred: '#cd5c5c',\n    indigo: '#4b0082',\n    ivory: '#fffff0',\n    khaki: '#f0e68c',\n    lavender: '#e6e6fa',\n    lavenderblush: '#fff0f5',\n    lawngreen: '#7cfc00',\n    lemonchiffon: '#fffacd',\n    lightblue: '#add8e6',\n    lightcoral: '#f08080',\n    lightcyan: '#e0ffff',\n    lightgoldenrodyellow: '#fafad2',\n    lightgray: '#d3d3d3',\n    lightgrey: '#d3d3d3',\n    lightgreen: '#90ee90',\n    lightpink: '#ffb6c1',\n    lightsalmon: '#ffa07a',\n    lightseagreen: '#20b2aa',\n    lightskyblue: '#87cefa',\n    lightslategray: '#778899',\n    lightslategrey: '#778899',\n    lightsteelblue: '#b0c4de',\n    lightyellow: '#ffffe0',\n    lime: '#00ff00',\n    limegreen: '#32cd32',\n    linen: '#faf0e6',\n    magenta: '#ff00ff',\n    maroon: '#800000',\n    mediumaquamarine: '#66cdaa',\n    mediumblue: '#0000cd',\n    mediumorchid: '#ba55d3',\n    mediumpurple: '#9370db',\n    mediumseagreen: '#3cb371',\n    mediumslateblue: '#7b68ee',\n    mediumspringgreen: '#00fa9a',\n    mediumturquoise: '#48d1cc',\n    mediumvioletred: '#c71585',\n    midnightblue: '#191970',\n    mintcream: '#f5fffa',\n    mistyrose: '#ffe4e1',\n    moccasin: '#ffe4b5',\n    navajowhite: '#ffdead',\n    navy: '#000080',\n    oldlace: '#fdf5e6',\n    olive: '#808000',\n    olivedrab: '#6b8e23',\n    orange: '#ffa500',\n    orangered: '#ff4500',\n    orchid: '#da70d6',\n    palegoldenrod: '#eee8aa',\n    palegreen: '#98fb98',\n    paleturquoise: '#afeeee',\n    palevioletred: '#db7093',\n    papayawhip: '#ffefd5',\n    peachpuff: '#ffdab9',\n    peru: '#cd853f',\n    pink: '#ffc0cb',\n    plum: '#dda0dd',\n    powderblue: '#b0e0e6',\n    purple: '#800080',\n    rebeccapurple: '#663399',\n    red: '#ff0000',\n    rosybrown: '#bc8f8f',\n    royalblue: '#4169e1',\n    saddlebrown: '#8b4513',\n    salmon: '#fa8072',\n    sandybrown: '#f4a460',\n    seagreen: '#2e8b57',\n    seashell: '#fff5ee',\n    sienna: '#a0522d',\n    silver: '#c0c0c0',\n    skyblue: '#87ceeb',\n    slateblue: '#6a5acd',\n    slategray: '#708090',\n    slategrey: '#708090',\n    snow: '#fffafa',\n    springgreen: '#00ff7f',\n    steelblue: '#4682b4',\n    tan: '#d2b48c',\n    teal: '#008080',\n    thistle: '#d8bfd8',\n    tomato: '#ff6347',\n    turquoise: '#40e0d0',\n    violet: '#ee82ee',\n    wheat: '#f5deb3',\n    white: '#ffffff',\n    whitesmoke: '#f5f5f5',\n    yellow: '#ffff00',\n    yellowgreen: '#9acd32',\n  };\n}\n\n// function a(input) {\n//   console.log(input);\n// }\nexport default colorNames;\n","// @flow\n/* eslint-disable no-use-before-define */\nimport {\n  roundNum, clipMag, clipValue, rand2D, round,\n} from './math';\nimport { joinObjects } from './tools';\nimport * as m2 from './m2';\n// import { joinObjects } from './tools';\n\n\nfunction quadraticBezier(P0: number, P1: number, P2: number, t: number) {\n  return (1 - t) * ((1 - t) * P0 + t * P1) + t * ((1 - t) * P1 + t * P2);\n}\n\n/**\n * Clip and angle between 0 and 2 (`'0to360'`) or - to  (`'-180to180'`).\n * `null` will return the angle between -2 to 2.\n * @example\n * const clipAngle = Fig.clipAngle\n *\n * const a1 = clipAngle(Math.PI / 2 * 5, '0to360');\n * console.log(a1);\n * // 1.5707963267948966\n *\n * const a2 = clipAngle(Math.PI / 4 * 5, '-180to180');\n * console.log(a2);\n * // -2.356194490192345\n *\n * const a3 = clipAngle(-Math.PI / 4 * 10, null);\n * console.log(a3);\n * // -1.5707963267948966\n */\nfunction clipAngle(\n  angleToClip: number,\n  clipTo: '0to360' | '-180to180' | null | '-360to360' | '-360to0',\n) {\n  if (clipTo === null) {\n    return angleToClip;\n  }\n  // Modular 2 gives -360to360\n  let angle = angleToClip % (Math.PI * 2);\n  if (clipTo === '0to360') {\n    if (angle < 0) {\n      angle += Math.PI * 2;\n    }\n    if (angle >= Math.PI * 2) {\n      angle -= Math.PI * 2;\n    }\n  }\n  if (clipTo === '-180to180') {\n    if (angle < -Math.PI) {\n      angle += Math.PI * 2;\n    }\n    if (angle >= Math.PI) {\n      angle -= Math.PI * 2;\n    }\n  }\n  if (clipTo === '-360to0') {\n    if (angle > 0) {\n      angle -= Math.PI * 2;\n    }\n    if (angle <= -Math.PI * 2) {\n      angle += Math.PI * 2;\n    }\n  }\n  return angle;\n}\n\nfunction getPrecision(\n  options?: { precision: number },\n  defaultPrecision: number = 8,\n) {\n  let precision;\n  if (options) {\n    ({ precision } = options);\n  }\n  let precisionToUse = defaultPrecision;\n  if (precision != null) {\n    precisionToUse = precision;\n  }\n  return precisionToUse;\n}\n\ntype TypeF1DefPoint = {\n  f1Type: 'p',\n  state: [number, number],\n};\n\n/**\n * A {@link Point} can be defined in several ways\n * - As a Point: new Point()\n * - As an x, y tuple: [number, number]\n * - As an x, y string: '[number, number]'\n * - As a definition object: { f1Type: 'p', state: [number, number] }\n }\n * @example\n * // p1, p2, p3 and p4 are all the same when parsed by `getPoint`\n * p1 = new Point(2, 3);\n * p2 = [2, 3];\n * p3 = '[2, 3]';\n * p4 = { f1Type: 'p', state: [2, 3] };\n */\nexport type TypeParsablePoint = [number, number]\n                                | Point\n                                // | { x: number, y: number}\n                                | string\n                                | TypeF1DefPoint;\n// point can be defined as:\n//    - Point instance\n//    - [1, 1]\n//    - { f1Type: 'p', def: [1, 1]}\nfunction parsePoint<T>(pIn: TypeParsablePoint, onFail: T): Point | T | null {\n  if (pIn instanceof Point) {\n    return pIn;\n  }\n  let onFailToUse = onFail;\n  if (onFailToUse == null) {\n    onFailToUse = null;\n  }\n  if (pIn == null) {\n    return onFailToUse;\n  }\n\n  let p = pIn;\n  if (typeof p === 'string') {\n    try {\n      p = JSON.parse(p);\n    } catch {\n      return onFailToUse;\n    }\n  }\n\n  if (Array.isArray(p)) {\n    if (p.length === 2 && typeof p[0] === 'number' && typeof p[1] === 'number') {\n      return new Point(p[0], p[1]);\n    }\n    return onFailToUse;\n  }\n\n  if (p.f1Type != null) {\n    if (\n      p.f1Type === 'p'\n      && p.state != null\n      && Array.isArray([p.state])\n      && p.state.length === 2\n    ) {\n      const [x, y] = p.state;\n      return new Point(x, y);\n    }\n    return onFailToUse;\n  }\n  if (typeof p === 'number') {\n    return new Point(p, p);\n  }\n  // if (typeof (p) === 'object') {\n  //   const keys = Object.keys(p);\n  //   if (keys.indexOf('x') > -1 && keys.indexOf('y') > -1) {\n  //     return new Point(p.x, p.y);\n  //   }\n  // }\n  return onFailToUse;\n}\n\n/**\n * Parse a {@link TypeParsablePoint} and return a {@link Point}.\n * @return {Point}\n */\nfunction getPoint(p: TypeParsablePoint): Point {\n  let parsedPoint = parsePoint(p);\n  if (parsedPoint == null) {\n    parsedPoint = new Point(0, 0);\n  }\n  return parsedPoint;\n}\n\n\n/**\n * Parse an array of parsable point definitions ({@link TypeParsablePoint})\n * returning an array of points.\n * @return {Array<Point>}\n */\nfunction getPoints(points: TypeParsablePoint | Array<TypeParsablePoint>): Array<Point> {\n  if (Array.isArray(points)) {\n    if (points.length === 2 && typeof points[0] === 'number') { // $FlowFixMe\n      return [getPoint(points)];\n    } // $FlowFixMe\n    return points.map(p => getPoint(p));\n  }\n  return [getPoint(points)];\n}\n\n/**\n * Parse a scale definition and return a {@link Point} representing the scale\n * in x and y.\n * Scale can either be defined as a {@link TypeParsablePoint} or a `number` if\n * the x and y scale is equal.\n * @return {Point} x and y scale\n */\nfunction getScale(s: TypeParsablePoint | number) {\n  let parsedPoint;\n  if (typeof s === 'number') {\n    parsedPoint = new Point(s, s);\n  } else {\n    parsedPoint = getPoint(s);\n  }\n  return parsedPoint;\n}\n\n/**\n * An object representing a rectangle.\n *\n * @example\n * // get Rect from Fig\n * const { Rect } = Fig;\n *\n * // define a rect centered at origin with width 4 and height 2\n * const r = new Rect(-2, -1, 4, 2);\n */\nclass Rect {\n  left: number;\n  top: number;\n  width: number;\n  height: number;\n  bottom: number;\n  right: number;\n\n  /**\n   * Constructor\n   * @constructor\n   * @param {number} left - left location\n   * @param {number} bottom - bottom location\n   * @param {number} width - rectangle width\n   * @param {number} height - rectangle height\n   */\n  constructor(left: number, bottom: number, width: number, height: number) {\n    /**\n      Left side x coordinate\n     */\n    this.left = left;\n    /**\n      Rectange width\n     */\n    this.width = width;\n    /**\n      Rectangle height\n     */\n    this.height = height;\n    /**\n      Bottom side y coordinate\n     */\n    this.bottom = bottom;\n    /**\n      Top side y coordinate\n     */\n    this.top = bottom + height;\n    /**\n      Right side x coordinate\n     */\n    this.right = left + width;\n  }\n\n  /**\n   * Return a duplicate rectangle object\n   */\n  _dup() {\n    return new Rect(this.left, this.bottom, this.width, this.height);\n  }\n\n  _state(options: { precision: number}) {\n    // const { precision } = options;\n    const precision = getPrecision(options);\n    return {\n      f1Type: 'rect',\n      state: [\n        roundNum(this.left, precision),\n        roundNum(this.bottom, precision),\n        roundNum(this.width, precision),\n        roundNum(this.height, precision),\n      ],\n    };\n  }\n\n  /**\n   * Returns `true` if `point` is within on on the border of the rectangle\n   * @param {TypeParsablePoint} point point to test\n   * @param {number} precision precision to test\n   * @example\n   * const r = new Rect(-2, -1, 4, 2);\n   *\n   * // check if point is within the rectangle (will return `true`)\n   * const result = r.isPointInside([0, 1]);\n   */\n  isPointInside(point: TypeParsablePoint, precision: number = 8) {\n    const p = getPoint(point).round(precision);\n    const top = roundNum(this.top, precision);\n    const bottom = roundNum(this.bottom, precision);\n    const left = roundNum(this.left, precision);\n    const right = roundNum(this.right, precision);\n    if (p.x < left || p.x > right || p.y < bottom || p.y > top) {\n      return false;\n    }\n    return true;\n  }\n\n  /**\n   * Returns a rectangle with coordinates rounded to `precision`\n   * @param {number} precision precision to test\n   */\n  round(precision: number = 8) {\n    const newRect = new Rect(\n      roundNum(this.left, precision), roundNum(this.bottom, precision),\n      roundNum(this.width, precision), roundNum(this.height, precision),\n    );\n    newRect.width = roundNum(newRect.width, precision);\n    newRect.height = roundNum(newRect.height, precision);\n    newRect.top = roundNum(newRect.top, precision);\n    newRect.right = roundNum(newRect.right, precision);\n    return newRect;\n  }\n}\n\n// /**\n//  JSON definition of a rect.\n//  @property {'rect'} f1Type rect identifier\n//  @property {[number, number, number, number]} state left, bottom, width\n//  * and height definition\n//  */\ntype TypeF1DefRect = {\n  f1Type: 'rect',\n  state: [number, number, number, number],\n};\n\n/**\n * A [Rectangle]{@link Rect} can be defined as either as an\n * - Array (left, bottom, width, height)\n * - a {@link Rect} class\n * - a string representing the json definition of the\n *   array form, or a {@link TypeF1DefRect}.\n *\n * @example\n * // All rectangles are the same when parsed by `getRect` and have a lower\n * left corner of `(-2, -1)`, a width of `4`, and a height of `2`\n * const r1 = [-2, -1, 4, 2];\n * const r2 = new Fig.Rect(-2, -1, 4, 2);\n * const r3 = '[-2, -1, 4, 2]';\n * const r4 = {\n *   f1Type: 'rect',\n *   state: [-2, -1, 4, 2],\n * };\n */\nexport type TypeParsableRect = [number, number, number, number]\n                               | Rect\n                               | TypeF1DefRect\n                               | string;\n\n\nfunction parseRect<T>(rIn: TypeParsableRect, onFail: T): Rect | T | null {\n  if (rIn instanceof Rect) {\n    return rIn;\n  }\n\n  let onFailToUse = onFail;\n  if (onFailToUse == null) {\n    onFailToUse = null;\n  }\n\n  if (rIn == null) {\n    return onFailToUse;\n  }\n\n  let r = rIn;\n  if (typeof r === 'string') {\n    try {\n      r = JSON.parse(r);\n    } catch {\n      return onFailToUse;\n    }\n  }\n\n  if (Array.isArray(r) && r.length === 4) {\n    return new Rect(r[0], r[1], r[2], r[3]);\n  }\n  const { f1Type, state } = r;\n\n  if (f1Type != null\n      && f1Type === 'rect'\n      && state != null\n      && Array.isArray([state])\n      && state.length === 4\n  ) {\n    const [l, b, w, h] = state;\n    return new Rect(l, b, w, h);\n  }\n\n  return onFailToUse;\n}\n\n/**\n * Convert a parsable rectangle definition to a {@link Rect}.\n * @param {TypeParsableRect} r parsable rectangle definition\n * @return {Rect} rectangle object\n */\nfunction getRect(r: TypeParsableRect): Rect {\n  let parsedRect = parseRect(r);\n  if (parsedRect == null) {\n    parsedRect = new Rect(0, 0, 1, 1);\n  }\n  return parsedRect;\n}\n\n\n/* eslint-disable comma-dangle */\n/**\n * Object representing a point.\n *\n * Contains methods that makes it conventient to add, subtract and\n * transform points.\n *\n * @example\n * // get Point from Fig\n * const { Point } = Fig;\n *\n * // define a point at (0, 2)\n * const p = new Point(0, 2);\n *\n * // find the distance to another point (0, 1) which will be 1\n * const d = p.distance([0, 1]);\n *\n * // add to another point (3, 1) which will result in (3, 3)\n * const q = p.add(3, 1);\n */\nclass Point {\n  /**\n   * x value of point\n  */\n  x: number;\n\n  /** y value of point */\n  y: number;\n  _type: 'point';\n\n  /**\n   * Return a point at (0, 0)\n   */\n  static zero(): Point {\n    return new Point(0, 0);\n  }\n\n  /**\n   * Return a point at (1, 1)\n   */\n  static Unity(): Point {\n    return new Point(1, 1);\n  }\n\n  /**\n   * Constructor\n   * @constructor\n   * @param x x coordinate of point\n   * @param y y coordinate of point\n   */\n  constructor(x: number, y: number) {\n    this.x = x;\n    this.y = y;\n    this._type = 'point';\n  }\n\n  _state(options: { precision: number }) {\n    // const { precision } = options;\n    const precision = getPrecision(options);\n    return {\n      f1Type: 'p',\n      state: [\n        roundNum(this.x, precision),\n        roundNum(this.y, precision),\n      ],\n    };\n  }\n\n  /**\n   * Return a duplicate of the {@link Point} object\n   */\n  _dup(): Point {\n    return new Point(this.x, this.y);\n  }\n\n  /**\n   * Scale x and y values of point by scalar\n   * @example\n   * p = new Point(1, 1);\n   * s = p.scale(3);\n   * // s = Point{x: 3, y: 3};\n   */\n  scale(scalar: number): Point {\n    return new Point(this.x * scalar, this.y * scalar);\n  }\n\n  /**\n   * Subtract (x, y) values or a {@link Point} and return the difference as a new {@link Point}\n   * @example\n   * p = new Point(3, 3);\n   * d = p.sub(1, 1)\n   * // d = Point{x: 2, y: 2}\n   *\n   * p = new Point(3, 3);\n   * q = new Point(1, 1);\n   * d = p.sub(q)\n   * // d = Point{x: 2, y: 2}\n   */\n  sub(pointOrX: Point | number, y: number = 0): Point {\n    if (pointOrX instanceof Point) {\n      return new Point(this.x - pointOrX.x, this.y - pointOrX.y);\n    }\n    return new Point(this.x - pointOrX, this.y - y);\n  }\n\n  /**\n   * Add (x, y) values or a {@link Point} and return the sum as a new {@link Point}\n   * @example\n   * p = new Point(3, 3);\n   * d = p.add(1, 1)\n   * // d = Point{x: 4, y: 4}\n   *\n   * p = new Point(3, 3);\n   * q = new Point(1, 1);\n   * d = p.add(q)\n   * // d = Point{x: 4, y: 4}\n   */\n  add(pointOrX: Point | number, y: number = 0): Point {\n    if (pointOrX instanceof Point) {\n      return new Point(this.x + pointOrX.x, this.y + pointOrX.y);\n    }\n    return new Point(this.x + pointOrX, this.y + y);\n  }\n\n  /**\n   * Return the distance between the point and the origin\n   * @example\n   * p = new Point(1, 1);\n   * d = p.distance();\n   * // d = 1.4142135623730951\n   */\n  distance(toPointIn: TypeParsablePoint | null = null): number {\n    if (toPointIn == null) {\n      return Math.sqrt(this.x * this.x + this.y * this.y);\n    }\n    const toPoint = getPoint(toPointIn);\n    if (toPoint == null) {\n      return this.distance();\n    }\n    return this.sub(toPoint).distance();\n  }\n\n  /**\n   * Return a new point with (x, y) values rounded to some precision\n   * @example\n   * p = new Point(1.234, 1.234);\n   * q = p.round(2);\n   * // q = Point{x: 1.23, y: 1.23}\n   */\n  round(precision: number = 8): Point {\n    return new Point(roundNum(this.x, precision), roundNum(this.y, precision));\n  }\n\n  /**\n   * Return a new point that is clipped to min and max values from the origin.\n   *\n   * Use a point as a parameter to define different (x, y) min/max values,\n   * a number to define the same (x, y) min/max values, or null to have no\n   * min/max values.\n   * @example\n   * p = new Point(2, 2);\n   * q = p.clip(1, 1);\n   * // q = Point{x: 1, y: 1}\n   *\n   * p = new Point(2, 2);\n   * q = p.clip(1, null);\n   * // q = Point{x: 1, y: 2}\n   *\n   * p = new Point(-2, -2);\n   * minClip = new Point(-1, -1.5);\n   * q = p.clip(minClip, null);\n   * // q = Point{x: -1, y: -1.5}\n   */\n  clip(min: Point | number | null, max: Point | number | null): Point {\n    let minX;\n    let minY;\n    let maxX;\n    let maxY;\n    if (min instanceof Point) {\n      minX = min.x;\n      minY = min.y;\n    } else {\n      minX = min;\n      minY = min;\n    }\n    if (max instanceof Point) {\n      maxX = max.x;\n      maxY = max.y;\n    } else {\n      maxX = max;\n      maxY = max;\n    }\n    const x = clipValue(this.x, minX, maxX);\n    const y = clipValue(this.y, minY, maxY);\n    return new Point(x, y);\n  }\n\n  /**\n   * Transform the point with a 3x3 matrix (2 dimensional transform)\n   * @example\n   * // Transform a point with a (2, 2) translation then 90 rotation\n   * p = new Point(1, 1);\n   * m = new Transform().translate(2, 2).rotate(Math.PI / 2).matrix();\n   * // m = [0, -1, -2, 1, 0, 2, 0, 0, 1]\n   * q = p.transformBy(m)\n   * // q = Point{x: -3, y: 3}\n   */\n  transformBy(matrix: Array<number>): Point {\n    const transformedPoint = m2.transform(matrix, this.x, this.y);\n    return new Point(transformedPoint[0], transformedPoint[1]);\n  }\n\n  quadraticBezier(p1: Point, p2: Point, t: number) {\n    const bx = quadraticBezier(this.x, p1.x, p2.x, t);\n    const by = quadraticBezier(this.y, p1.y, p2.y, t);\n    return new Point(bx, by);\n  }\n\n  /**\n   * Rotate a point some angle around a center point\n   * @param angle - in radians\n   * @example\n   * // Rotate a point around the origin\n   * p = new Point(1, 0);\n   * q = p.rotate(Math.PI)\n   * // q = Point{x: -1, y: 0}\n   *\n   * // Rotate a point around (1, 1)\n   * p = new Point(2, 1);\n   * q = p.rotate(Math.PI, new Point(1, 1))\n   * // q = Point{x: 0, y: 1}\n   */\n  rotate(angle: number, center?: Point = new Point(0, 0)): Point {\n    const c = Math.cos(angle);\n    const s = Math.sin(angle);\n    const matrix = [c, -s,\n                    s, c]; // eslint-disable-line indent\n    const centerPoint = center;\n    const pt = this.sub(centerPoint);\n    return new Point(\n      matrix[0] * pt.x + matrix[1] * pt.y + centerPoint.x,\n      matrix[2] * pt.x + matrix[3] * pt.y + centerPoint.y\n    );\n  }\n\n  /* eslint-enable comma-dangle */\n\n  /**\n   * Compare two points for equality to some precision\n   * @example\n   * p = new Point(1.123, 1.123);\n   * q = new Point(1.124, 1.124);\n   * p.isEqualTo(q)\n   * // false\n   *\n   * p.isEqualTo(q, 2)\n   * // true\n   */\n  isEqualTo(p: Point, precision?: number = 8) {\n    let pr = this;\n    let qr = p;\n\n    if (typeof precision === 'number') {\n      pr = this.round(precision);\n      qr = qr.round(precision);\n    }\n    if (pr.x === qr.x && pr.y === qr.y) {\n      return true;\n    }\n    return false;\n  }\n\n  isWithinDelta(p: Point, delta: number = 0.0000001) {\n    const dX = Math.abs(this.x - p.x);\n    const dY = Math.abs(this.y - p.y);\n    if (dX > delta || dY > delta) {\n      return false;\n    }\n    return true;\n  }\n\n  /**\n   * Compare two points for unequality to some precision\n   * @example\n   * p = new Point(1.123, 1.123);\n   * q = new Point(1.124, 1.124);\n   * p.isNotEqualTo(q)\n   * // true\n   *\n   * p.isNotEqualTo(q, 2)\n   * // false\n   */\n  isNotEqualTo(p: Point, precision?: number) {\n    return !this.isEqualTo(p, precision);\n  }\n\n  isNotWithinDelta(p: Point, delta: number = 0.0000001) {\n    return !this.isWithinDelta(p, delta);\n  }\n\n  isWithinLine(l: Line, precision?: number) {\n    return l.hasPointOn(this, precision);\n  }\n\n  getShaddowOnLine(l: Line, precision: number = 8) {\n    const shaddow = new Line(this, 1, l.angle() + Math.PI / 2);\n    const { intersect } = shaddow.intersectsWith(l);\n    // console.log(intersect, inLine, alongLine, )\n    if (intersect != null && intersect.isWithinLine(l, precision)) {\n      return intersect;\n    }\n    return null;\n  }\n\n  shaddowIsOnLine(l: Line, precision: number = 8) {\n    const intersect = this.getShaddowOnLine(l, precision);\n    if (intersect != null) {\n      return true;\n    }\n    return false;\n  }\n\n  clipToLine(l: Line, precision: number = 8) {\n    if (l.hasPointOn(this, precision)) {\n      return this._dup();\n    }\n    const shaddow = this.getShaddowOnLine(l, precision);\n    if (shaddow != null) {\n      return shaddow;\n    }\n    const d1 = this.distance(l.p1);\n    const d2 = this.distance(l.p2);\n    if (d1 <= d2) {\n      return l.p1._dup();\n    }\n    return l.p2._dup();\n  }\n\n  isOnUnboundLine(l: Line, precision?: number) {\n    return l.hasPointAlong(this, precision);\n  }\n\n\n  static isLeft(p0: Point, p1: Point, p2: Point) {\n    return (\n      (p1.x - p0.x) * (p2.y - p0.y) - (p2.x - p0.x) * (p1.y - p0.y)\n    );\n  }\n\n  isInPolygon(polygonVertices: Array<Point>) {\n    let windingNumber = 0;\n    let n = polygonVertices.length - 1;\n    const v = polygonVertices.slice();\n    const p = this;\n    let popLastPoint = false;\n    // polygonVertices needs to have the last vertex the same as the first vertex\n    if (v[0].isNotEqualTo(v[n])) {\n      v.push(v[0]);\n      popLastPoint = true;\n      n += 1;\n    }\n    for (let i = 0; i < n; i += 1) {\n      if (v[i].y <= p.y) {\n        if (v[i + 1].y > p.y) {                // an upward crossing\n          if (Point.isLeft(v[i], v[i + 1], p) > 0) { // P left of  edge\n            windingNumber += 1;                // have  a valid up intersect\n          }\n        }\n      } else if (v[i + 1].y <= p.y) {           // start y > P.y (no test needed)\n        // a downward crossing\n        if (Point.isLeft(v[i], v[i + 1], p) < 0) {    // P right of  edge\n          windingNumber -= 1;      // have  a valid down intersect\n        }\n      }\n    }\n    if (popLastPoint) {\n      v.pop();\n    }\n    if (windingNumber === 0) {\n      return false;\n    }\n    return true;\n  }\n\n  isOnPolygon(polygonVertices: Array<Point>) {\n    let popLastPoint = false;\n    const p = this;\n    let n = polygonVertices.length - 1;   // Number of sides\n    const v = polygonVertices.slice();\n\n    // polygonVertices needs to have the last vertex the same as the first vertex\n    if (v[0].isNotEqualTo(v[n])) {\n      v.push(v[0]);\n      popLastPoint = true;\n      n += 1;\n    }\n\n    for (let i = 0; i < n; i += 1) {\n      // if(p.isEqualTo(v[i])) {\n      //   return true;\n      // }\n      const l = line(v[i], v[i + 1]);\n      if (p.isWithinLine(l)) {\n        if (popLastPoint) {\n          v.pop();\n        }\n        return true;\n      }\n    }\n    if (p.isInPolygon(polygonVertices)) {\n      if (popLastPoint) {\n        v.pop();\n      }\n      return true;\n    }\n\n    if (popLastPoint) {\n      v.pop();\n    }\n    return false;\n  }\n\n  toPolar() {\n    return {\n      mag: Math.sqrt(this.x ** 2 + this.y ** 2),\n      angle: Math.atan2(this.y, this.x),\n    };\n  }\n\n  toDelta(\n    delta: Point,\n    percent: number,\n    translationStyle: 'linear' | 'curved' | 'curve' = 'linear',  // $FlowFixMe\n    translationOptions: OBJ_TranslationPath = {\n      magnitude: 0.5,\n      offset: 0.5,\n      controlPoint: null,\n    },\n  ) {\n    const pathPoint = translationPath(\n      translationStyle,\n      this._dup(), delta, percent,\n      translationOptions,\n    );\n    return pathPoint;\n  }\n}\n\n\nfunction linearPath(\n  start: Point,\n  delta: Point,\n  percent: number,\n) {\n  return start.add(delta.x * percent, delta.y * percent);\n}\n\n// type linearPathOptionsType = {\n// };\n\n/**\n * Curved translation path options, that defineds the control\n * point of a quadratic bezier curve.\n *\n * Use `controlPoint` to define the control point directly. This\n * will override all other properties.\n *\n * Otherwise `direction`, `magnitude` and `offset` can be used\n * to calculate the control point based on the start and end\n * points of the curve.\n *\n * The control point is calculated by:\n * - Define a line from start to target - it will have length `d`\n * - Define a point `P` on the line\n * - Define a control line from point `P` with length `d` and some\n *   angle delta from the original line.\n *\n * The properties then customize this calculation:\n * - `magnitude` will scale the distance d\n * - `offset` will define where on the line point `P` is where `0.5` is\n *   the midpoint and `0.1` is 10% along the line from the start location\n * - `direction` will define which side of the line the control line should be\n *   drawn\n * - `angle` defines the angle delta between the line and the control line - by\n *    default this a right angle (Math.PI / 2)\n *\n * The directions `'up'`, `'down'`, `'left'`, `'right'` all reference the side\n * of the line. The `'positive'`\n * direction is the side of the line that the line would move toward when\n * rotated in the positive direction around the start point. The\n * '`negative`' side of the line is then the opposite side.\n *\n * These directions only work when the `angle` is between `0` and `Math.PI`.\n *\n * @property {TypeParsablePoint | null} controlPoint\n * @property {number} magnitude\n * @property {number} offset\n * @property {number} angle (`Math.PI / 2`)\n * @property {'positive' | 'negative' | 'up' | 'left' | 'down' | 'right'} direction\n */\nexport type OBJ_QuadraticBezier = {\n  // path: '(Point, Point, number) => Point';\n  controlPoint: TypeParsablePoint | null;\n  angle: number;\n  magnitude: number;\n  offset: number;\n  direction: 'up' | 'left' | 'down' | 'right' | 'positive' | 'negative';\n};\n\n/**\n * Translation path options object\n */\nexport type OBJ_TranslationPath = {\n  style: 'curve' | 'linear' | 'curved',\n  // curve options\n  angle?: number,\n  magnitude?: number,\n  offset?: number,\n  controlPoint?: TypeParsablePoint | null,\n  direction?: 'positive' | 'negative' | 'up' | 'down' | 'left' | 'right',\n}\n\n\n// export type pathOptionsType = OBJ_QuadraticBezier & linearPathOptionsType;\n\nfunction curvedPath(\n  start: Point,\n  delta: Point,\n  percent: number,\n  options: OBJ_TranslationPath,\n) {\n  const o = options;\n  // const angle = Math.atan2(delta.y, delta.x);\n  // const midPoint = start.add(new Point(delta.x * o.offset, delta.y * o.offset));\n  // const dist = delta.toPolar().mag * o.magnitude;\n\n  let { controlPoint } = options;\n\n  // const o = options;\n\n  // const dist = delta.toPolar().mag * o.magnitude;\n\n  if (controlPoint == null) {\n    // let angleDelta = Math.PI / 2;\n    // if (o.angle != null) {\n    //   angleDelta = o.angle;\n    // }\n    // const { direction } = options;\n    // let xDelta = Math.cos(angle + angleDelta);\n    // let yDelta = Math.sin(angle + angleDelta);\n    // if (direction === 'up') {\n    //   if (yDelta < 0) {\n    //     yDelta = Math.sin(angle + angleDelta + Math.PI);\n    //   }\n    //   if (xDelta < 0) {\n    //     xDelta = Math.cos(angle + angleDelta + Math.PI);\n    //   }\n    // } else if (direction === 'down') {\n    //   if (yDelta > 0) {\n    //     yDelta = Math.sin(angle + angleDelta + Math.PI);\n    //   }\n    //   if (xDelta > 0) {\n    //     xDelta = Math.cos(angle + angleDelta + Math.PI);\n    //   }\n    // } else if (direction === 'left') {\n    //   if (yDelta > 0) {\n    //     yDelta = Math.sin(angle + angleDelta + Math.PI);\n    //   }\n    //   if (xDelta > 0) {\n    //     xDelta = Math.cos(angle + angleDelta + Math.PI);\n    //   }\n    // } else if (direction === 'right') {\n    //   if (yDelta < 0) {\n    //     yDelta = Math.sin(angle + angleDelta + Math.PI);\n    //   }\n    //   if (xDelta < 0) {\n    //     xDelta = Math.cos(angle + angleDelta + Math.PI);\n    //   }\n    // }\n    let angleDelta = Math.PI / 2;\n    if (o.angle != null) {\n      angleDelta = o.angle;\n    }\n    let offsetToUse = 0;\n    if (o.offset != null) {\n      offsetToUse = o.offset;\n    }\n    if (o.direction == null) {\n      o.direction = 'positive';\n    }\n    let magToUse = 1;\n    if (o.magnitude != null) {\n      magToUse = o.magnitude;\n    }\n    const displacementLine = new Line(start, start.add(delta));\n    const lineAngle = clipAngle(displacementLine.angle(), '0to360');\n    const linePoint = start.add(new Point(delta.x * offsetToUse, delta.y * offsetToUse));\n\n    // norm line angle is between 0 and 180\n    let normLineAngle = lineAngle; // clipAngle(lineAngle, '0to360');\n    if (normLineAngle >= Math.PI) {\n      normLineAngle -= Math.PI;\n    }\n    // if (lineAngle < 0) {\n    //   lineAngle += Math.PI;\n    // }\n    let controlAngle = lineAngle + angleDelta;\n    const { direction } = o;\n\n    if (direction === 'positive') {\n      controlAngle = lineAngle + angleDelta;\n    } else if (direction === 'negative') {\n      controlAngle = lineAngle - angleDelta;\n    } else if (direction === 'up') {\n      if (lineAngle <= Math.PI / 2 || lineAngle >= Math.PI / 2 * 3) {\n        controlAngle = lineAngle + angleDelta;\n      } else {\n        controlAngle = lineAngle - angleDelta;\n      }\n    } else if (direction === 'down') {\n      if (lineAngle <= Math.PI / 2 || lineAngle >= Math.PI / 2 * 3) {\n        controlAngle = lineAngle - angleDelta;\n      } else {\n        controlAngle = lineAngle + angleDelta;\n      }\n    } else if (direction === 'left') {\n      if (lineAngle <= Math.PI) {\n        controlAngle = lineAngle + angleDelta;\n      } else {\n        controlAngle = lineAngle - angleDelta;\n      }\n    } else if (direction === 'right') {\n      if (lineAngle <= Math.PI) {\n        controlAngle = lineAngle - angleDelta;\n      } else {\n        controlAngle = lineAngle + angleDelta;\n      }\n    }\n\n    const dist = magToUse * displacementLine.length();\n    controlPoint = new Point(\n      linePoint.x + dist * Math.cos(controlAngle),\n      linePoint.y + dist * Math.sin(controlAngle),\n      // midPoint.x + dist * xDelta,\n      // midPoint.y + dist * yDelta,\n    );\n  }\n\n  const p0 = start;\n  const p1 = getPoint(controlPoint);\n  const p2 = start.add(delta);\n  const t = percent;\n  const bx = quadraticBezier(p0.x, p1.x, p2.x, t);\n  const by = quadraticBezier(p0.y, p1.y, p2.y, t);\n  return new Point(bx, by);\n}\n\n\nfunction translationPath(\n  pathType: 'linear' | 'curved' | 'curve' = 'linear',\n  start: Point,\n  delta: Point,\n  percent: number,\n  options: OBJ_TranslationPath,\n) {\n  if (pathType === 'linear') {\n    return linearPath(start, delta, percent);\n  }\n  if (pathType === 'curved' || pathType === 'curve') {\n    return curvedPath(start, delta, percent, options);\n  }\n  return new Point(0, 0);\n}\n\n// function point(x: number, y: number) {\n//   return new Point(x, y);\n// }\n\nfunction pointinRect(q: Point, p1: Point, p2: Point, precision?: number) {\n  if (precision === undefined || precision === null) {\n    if (q.x >= Math.min(p1.x, p2.x)\n      && q.x <= Math.max(p1.x, p2.x)\n      && q.y >= Math.min(p1.y, p2.y)\n      && q.y <= Math.max(p1.y, p2.y)) {\n      return true;\n    }\n  } else if (\n    roundNum(q.x, precision) >= roundNum(Math.min(p1.x, p2.x), precision)\n    && roundNum(q.x, precision) <= roundNum(Math.max(p1.x, p2.x), precision)\n    && roundNum(q.y, precision) >= roundNum(Math.min(p1.y, p2.y), precision)\n    && roundNum(q.y, precision) <= roundNum(Math.max(p1.y, p2.y), precision)) {\n    return true;\n  }\n  return false;\n}\n\nfunction distance(p1: Point, p2: Point) {\n  return Math.sqrt(((p2.x - p1.x) ** 2) + ((p2.y - p1.y) ** 2));\n}\nfunction deg(angle: number) {\n  return angle * 180 / Math.PI;\n}\n\n/**\n * Get the minimum absolute angle difference between two angles\n *\n * @example\n * const minAngleDiff = Fig.minAngleDiff;\n * const d1 = minAngleDiff(0.1, 0.2);\n * console.log(d1);\n * // -0.1\n *\n * const d2 = minAngleDiff(0.2, 0.1);\n * console.log(d2);\n * // 0.1\n *\n * const d3 = minAngleDiff(0.1, -0.1);\n * console.log(d3);\n * // 0.2\n */\nfunction minAngleDiff(angle1: number, angle2: number) {\n  if (angle1 === angle2) {\n    return 0;\n  }\n  return Math.atan2(Math.sin(angle1 - angle2), Math.cos(angle1 - angle2));\n}\n\nfunction normAngle(angle: number) {\n  let newAngle = angle;\n  while (newAngle >= Math.PI * 2.0) {\n    newAngle -= Math.PI * 2.0;\n  }\n  while (newAngle < 0) {\n    newAngle += Math.PI * 2.0;\n  }\n  return newAngle;\n}\n\nfunction normAngleTo90(angle: number) {\n  let newAngle = normAngle(angle);\n  if (newAngle > Math.PI / 2 && newAngle < Math.PI) {\n    newAngle += Math.PI;\n  }\n  if (newAngle === Math.PI) {\n    newAngle = 0;\n  }\n  if (newAngle > Math.PI && newAngle < Math.PI * 3 / 2) {\n    newAngle -= Math.PI;\n  }\n  return newAngle;\n}\n\nexport type TypeRotationDirection = 0 | 1 | 2 | -1;\n\n// 0 is quickest direction\n// 1 is positive direction CCW\n// -1 is negative direction CW\n// 2 is not through 0\n// 3 is numerical\nfunction getDeltaAngle(\n  startAngle: number,\n  targetAngle: number,\n  rotDirection: TypeRotationDirection = 0,\n) {\n  const start = normAngle(startAngle);\n  const target = normAngle(targetAngle);\n  let dir = rotDirection;\n\n  if (start === target) {\n    return 0;\n  }\n\n  if (dir === 2) {\n    if (start > target) {\n      dir = -1;\n    } else {\n      dir = 1;\n    }\n  }\n\n  if (dir === 0) {\n    return minAngleDiff(target, start);\n  }\n\n  if (dir === 1) {\n    if (start > target) {\n      return Math.PI * 2 - start + target;\n    }\n  }\n\n  if (dir === -1) {\n    if (target > start) {\n      return -start - (Math.PI * 2 - target);\n    }\n  }\n\n  return target - start;\n\n  // if (rotDirection === 2) {\n  //   if (target > start) {\n  //     return target - start;\n  //   }\n  // }\n  // if (rotDirection === 2) {\n  //   if (start + rotDiff < 0) {\n  //     rotDiff = Math.PI * 2 + rotDiff;\n  //   } else if (start + rotDiff > Math.PI * 2) {\n  //     rotDiff = -(Math.PI * 2 - rotDiff);\n  //   }\n  // } else if (rotDiff * rotDirection < 0) {\n  //   rotDiff = rotDirection * Math.PI * 2.0 + rotDiff;\n  // }\n  // return rotDiff;\n}\n\n// Line definition: Ax + By = C\n//\n// So if we have two points: (x1, y1) and (x2, y2) on the same line, they must\n// both satisfy the same equation:\n//\n//    Ax1 + By1 = C   - 1\n//    Ax2 + By2 = C   - 2\n//\n// Both 1 and 2 equal C, so can equate left hand sides:\n//    Ax1 + By1 = Ax2 + By2\n//    A(x1 - x2) = B(y2 - y1)\n//    A / B = (y2 - y1) / (x1 - x2)\n//\n//    So A = (y2 - y1) and B = x1 - x2\n//\n//  Then C from 1 is:\n//    C = (y2 - y1)x1 + (x1 - x2)y1\n//\n//  So calculating y from x:\n//    y = (C - Ax) / B   for B != 0\n//      If B == 0, then x1 == x2, and so we have a vertical line at x1\n//      and so y is not dependent on x\n//  And calculating x from y:\n//    x = (C - By) / A    for A != 0\n//      If A == 0, then y1 == y2, and so we have a horizontal line at y1\n//      and so x is not dependent on y\n//\n//  To find the y intercept:\n//    if B != 0: y intercept = Ax + By = C => y = C / B\n//    if B == 0, there is no single y intercept\n//      - is either no intercept, or along the y axis\n//\n//  To find the x intercept:\n//    if A != 0: x intercept = Ax + By = C => x = C / A\n//    if A == 0, there is no single x intercept\n//      - is either no intercept, or along the x axis\n//\n//  Another form of the line equation is y = mx + c where:\n//   - c is the y intercept (or C / B)\n//   - m = y2 - y1 / x2 - x1 = A / (-B) = - A / B\n//\n\n/**\n * Line intersection result object with keys:\n * @property {undefined | Point} intersect will be `undefined` if there is\n * no intersect\n * @property {boolean} alongLine `true` if `intersect` is along line calling\n * `intersectsWith`\n * @property {boolean} withinLine `true` if `intersect` is within line calling\n * `intersectsWith`\n */\ntype Intersect = {\n  intersect?: Point,\n  alongLine: boolean,\n  withinLine: boolean,\n}\n\n/**\n * Object representing a line.\n *\n * A line is defined by two points, or a point and the distance and\n * angle to another point.\n *\n * A finite line exists only between these two points.\n *\n * An infinite line can extend beyond either or both of the points to infinity.\n *\n * A line can also be defined as an infinite line by saying it extends beyond one\n * @example\n * // get Line from Fig\n * const { Line } = Fig;\n *\n * // define a finite line from [0, 0] to [1, 0] with a point, magnitude and\n * // angle\n * const l1 = new Line([0, 0], 1, 0)\n *\n * // define a finite line from [0, 0] to [1, 0] with two points\n * const l2 = new Line([0, 0], [1, 0])\n *\n * // define an infinite line from [0, 0], through [1, 0] and to infinity\n * const l3 = new Line([0, 0], [1, 0], 1)\n *\n * // define an infinite line trough [0, 0] and [1, 0]\n * const l4 = new Line([0, 0], [1, 0], 0)\n */\nclass Line {\n  p1: Point;\n  p2: Point;\n  ang: number;\n  A: number;\n  B: number;\n  C: number;\n  distance: number;\n  ends: 2 | 1 | 0;\n\n  /**\n   * @param {0 | 1 | 2} ends number of ends the line has. `2` ends is a finite\n   * line. `1` end is an infinite line that terminates at the first point, and\n   * goes through the second point to infinity. `0` ends is an infinite line\n   * that goes through both first and second points to infinity.\n   */\n  constructor(\n    p1: TypeParsablePoint,\n    p2OrMag: TypeParsablePoint | number | null,\n    angle: number = 0,\n    ends: 2 | 1 | 0 = 2,\n  ) {\n    this.p1 = getPoint(p1);\n    if (p2OrMag == null) {\n      this.ang = angle;\n      this.p2 = this.p1.add(1 * Math.cos(this.ang), 1 * Math.sin(this.ang));\n    } else if (typeof p2OrMag === 'number') {\n      this.p2 = this.p1.add(\n        p2OrMag * Math.cos(angle),\n        p2OrMag * Math.sin(angle),\n      );\n      this.ang = angle;\n    } else {\n      this.p2 = getPoint(p2OrMag);\n      this.ang = Math.atan2(this.p2.y - this.p1.y, this.p2.x - this.p1.x);\n    }\n    this.ends = ends;\n    this.setupLine();\n  }\n\n  _state(options: { precision: number }) {\n    // const { precision } = options;\n    const precision = getPrecision(options);\n    return {\n      f1Type: 'l',\n      state: [\n        [roundNum(this.p1.x, precision), roundNum(this.p1.y, precision)],\n        [roundNum(this.p2.x, precision), roundNum(this.p2.y, precision)],\n        this.ends,\n      ],\n    };\n  }\n\n  setupLine() {\n    this.A = this.p2.y - this.p1.y;\n    this.B = this.p1.x - this.p2.x;\n    this.C = this.A * this.p1.x + this.B * this.p1.y;\n    this.distance = distance(this.p1, this.p2);\n  }\n\n  _dup() {\n    return new Line(this.p1, this.p2, 0, this.ends);\n  }\n\n  /**\n   * Change p1 of the line\n   */\n  setP1(p1: TypeParsablePoint) {\n    this.p1 = getPoint(p1);\n    this.ang = Math.atan2(this.p2.y - this.p1.y, this.p2.x - this.p1.x);\n    this.setupLine();\n  }\n\n  /**\n   * Change p2 of the line\n   */\n  setP2(p2: Point | [number, number]) {\n    this.p2 = getPoint(p2);\n    this.ang = Math.atan2(this.p2.y - this.p1.y, this.p2.x - this.p1.x);\n    this.setupLine();\n  }\n\n  /**\n   * Get p1 or p2\n   * @return {Point}\n   */\n  getPoint(index: 1 | 2 = 1) {\n    if (index === 2) {\n      return this.p2;\n    }\n    return this.p1;\n  }\n\n  reverse() {\n    return new Line(this.p2, this.p1, 0, this.ends);\n  }\n\n  /**\n   * Get the y coordinate of a point on the line with a given x coordinate\n   * @return {number | null} where `null` is returned if the line is vertical\n   */\n  getYFromX(x: number) {\n    if (this.B !== 0) {\n      return (this.C - this.A * x) / this.B;\n    }\n    return null;\n  }\n\n  /**\n   * Get the x coordinate of a point on the line with a given y coordinate\n   * @return {number | null} where `null` is returned if the line is horiztonal\n   */\n  getXFromY(y: number) {\n    if (this.A !== 0) {\n      return (this.C - this.B * y) / this.A;\n    }\n    return null;\n  }\n\n  /**\n   * Get the y intercept (at x = 0) of line\n   * @return {number | null} where `null` is returned if the line is vertical\n   */\n  getYIntercept() {\n    return this.getYFromX(0);\n  }\n\n  /**\n   * Get the x intercept (at y = 0) of line\n   * @return {number | null} where `null` is returned if the line is horizontal\n   */\n  getXIntercept() {\n    return this.getXFromY(0);\n  }\n\n  /**\n   * Get the gradient of the line\n   * @return {number}\n   */\n  getGradient() {\n    if (this.B === 0) {\n      return null;\n    }\n    return -this.A / this.B;\n  }\n\n  /**\n   * Get the angle of the line from p1 to p2\n   * @return {number}\n   */\n  angle() {\n    return this.ang;\n  }\n\n  /**\n   * Return a duplicate line with values rounded to `precision`\n   * @return {Line}\n   */\n  round(precision?: number = 8) {\n    const lineRounded = new Line(this.p1, this.p2, 0, this.ends);\n    lineRounded.A = roundNum(lineRounded.A, precision);\n    lineRounded.B = roundNum(lineRounded.B, precision);\n    lineRounded.C = roundNum(lineRounded.C, precision);\n    lineRounded.ang = roundNum(lineRounded.ang, precision);\n    lineRounded.distance = roundNum(lineRounded.distance, precision);\n    return lineRounded;\n  }\n\n  /**\n   * Return the distance between p1 and p2. Note, for infinite lines\n   * this will still return the distance between p1 and p2 that defines\n   * the line.\n   * @return {number}\n   */\n  length() {\n    // return this.p1.sub(this.p2).distance();\n    return this.distance;\n  }\n\n  /* eslint-disable comma-dangle */\n  /**\n   * Return the midpoint between p1 and p2.\n   * @return {Point}\n   */\n  midPoint() {\n    // const length = this.length();\n    // const direction = this.p2.sub(this.p1);\n    // const angle = Math.atan2(direction.y, direction.x);\n    // const midPoint = point(\n    //   this.p1.x + length / 2 * Math.cos(angle),\n    //   this.p1.y + length / 2 * Math.sin(angle)\n    // );\n    // return midPoint;\n    return this.pointAtPercent(0.5);\n  }\n\n  /**\n   * Return the point along some percent of the distance between p1 and p2.\n   * @return {Point}\n   */\n  pointAtPercent(percent: number) {\n    const length = this.length();\n    const direction = this.p2.sub(this.p1);\n    const angle = Math.atan2(direction.y, direction.x);\n    const p = new Point(\n      this.p1.x + length * percent * Math.cos(angle),\n      this.p1.y + length * percent * Math.sin(angle)\n    );\n    return p;\n  }\n\n  /**\n   * Return the point along the line at some length from p1\n   * @return {Point}\n   */\n  pointAtLength(length: number) {\n    const totalLength = this.p2.sub(this.p1).distance();\n    return this.pointAtPercent(length / totalLength);\n    // const angle = Math.atan2(direction.y, direction.x);\n    // const p = new Point(\n    //   this.p1.x + length * Math.cos(angle),\n    //   this.p1.y + length * Math.sin(angle)\n    // );\n    // return p;\n  }\n  /* eslint-enable comma-dangle */\n\n  /**\n   * `true` if `point` is along the line extended to infinity on both ends\n   * @return {boolean}\n   */\n  hasPointAlong(point: TypeParsablePoint, precision?: number = 8) {\n    const p = getPoint(point);\n    if (precision === undefined || precision === null) {\n      if (this.C === this.A * p.x + this.B * p.y) {\n        return true;\n      }\n    } else if (\n      roundNum(this.C, precision) === roundNum(this.A * p.x + this.B * p.y, precision)\n    ) {\n      return true;\n    }\n    return false;\n  }\n\n\n  /**\n   * Perpendicular distance from `point` to line\n   * @return {number}\n   */\n  distanceToPoint(point: TypeParsablePoint, precision?: number = 8) {\n    const p = getPoint(point);\n    return roundNum(\n      Math.abs(this.A * p.x + this.B * p.y - this.C) / Math.sqrt(this.A ** 2 + this.B ** 2),\n      precision,\n    );\n  }\n\n  /**\n   * `true` if `point` is on the line.\n   *\n   * If the line has 2 or 1 finite ends, point must be on or between the\n   * defined ends.\n   * @return {boolean}\n   */\n  hasPointOn(point: TypeParsablePoint, precision?: number = 8) {\n    const p = getPoint(point);\n    if (this.hasPointAlong(p, precision)) {\n      if (this.ends === 2) {\n        if (pointinRect(p, this.p1, this.p2, precision)) {\n          return true;\n        }\n        return false;\n      }\n      if (this.ends === 1) {\n        if (this.p1.isEqualTo(p, precision)) {\n          return true;\n        }\n        const p1ToP = new Line(this.p1, p);\n        if (round(clipAngle(p1ToP.ang, '0to360'), precision) === round(clipAngle(this.ang, '0to360'), precision)) {\n          return true;\n        }\n        return false;\n      }\n      return true;  // if this.ends === 0 and point is along, then it is on.\n    }\n    return false;\n  }\n\n  /**\n   * `true` if two lines are equal to within some rounding `precision`.\n   * @return {boolean}\n   */\n  isEqualTo(line2: Line, precision?: number = 8) {\n    const l1 = this;\n    const l2 = line2;\n    if (l1.ends !== l2.ends) {\n      return false;\n    }\n    if (l1.ends === 2) {\n      if (l1.p1.isNotEqualTo(l2.p1, precision) && l1.p1.isNotEqualTo(l2.p2, precision)) {\n        return false;\n      }\n      if (l1.p2.isNotEqualTo(l2.p1, precision) && l1.p2.isNotEqualTo(l2.p2, precision)) {\n        return false;\n      }\n      return true;\n    }\n\n    if (l1.ends === 1) {\n      if (l1.p1.isNotEqualTo(l2.p1, precision)) {\n        return false;\n      }\n      if (!l1.hasPointOn(l2.p2, precision)) {\n        return false;\n      }\n      return true;\n    }\n\n    // otherwise ends === 0\n    if (!l1.hasPointOn(l2.p1)) {\n      return false;\n    }\n    return true;\n  }\n\n  /**\n   * `true` if two lines are within a delta of each other.\n   *\n   * This is distinct from a rounding precision as it is an absolute\n   * delta.\n   *\n   * @return {boolean}\n   */\n  isWithinDelta(line2: Line, delta: number = 0.00000001) {\n    const l1 = this;\n    const l2 = line2;\n    if (l1.ends !== l2.ends) {\n      return false;\n    }\n    if (l1.ends === 2) {\n      if (l1.p1.isNotWithinDelta(l2.p1, delta) && l1.p1.isNotWithinDelta(l2.p2, delta)) {\n        return false;\n      }\n      if (l1.p2.isNotWithinDelta(l2.p1, delta) && l1.p2.isNotWithinDelta(l2.p2, delta)) {\n        return false;\n      }\n      return true;\n    }\n\n    if (l1.ends === 1) {\n      if (l1.p1.isNotWithinDelta(l2.p1, delta)) {\n        return false;\n      }\n      if (!l1.hasPointOn(l2.p2, delta)) {\n        return false;\n      }\n      return true;\n    }\n\n    // otherwise ends === 0\n    if (!l1.hasPointOn(l2.p1)) {\n      return false;\n    }\n    return true;\n  }\n\n  // isWithinLine\n  // hasLineWithin\n  // isAlongLine\n  // isParrallelToLine\n  // isPerpendicularToLine\n\n  // hasLineOn(line2: Line, precision: number = 8) {\n  //   return line2.isOn(this, precision);\n  // }\n\n  /**\n   * `true` if this line is within `line2`\n   * @return {boolean}\n   */\n  hasLineWithin(line2: Line, precision: number = 8) {\n    return line2.isWithinLine(this, precision);\n  }\n\n  /**\n   * `true` if this line is along the infinite length of `line2`\n   * @return {boolean}\n   */\n  isAlongLine(line2: Line, precision: number = 8) {\n    const l1 = this.round(precision);\n    const l2 = line2.round(precision);\n    // If A and B are zero, then this is not a line\n    if ((l1.A === 0 && l1.B === 0)\n      || (l2.A === 0 && l2.B === 0)) {\n      return false;\n    }\n    // If A is 0, then it must be 0 on the other line. Similar with B\n    if (l1.A !== 0) {\n      const scale = l2.A / l1.A;\n      if (l1.B * scale !== l2.B) {\n        return false;\n      }\n      if (l1.C * scale !== l2.C) {\n        return false;\n      }\n      return true;\n    }\n    if (l2.A !== 0) {\n      const scale = l1.A / l2.A;\n      if (l2.B * scale !== l1.B) {\n        return false;\n      }\n      if (l2.C * scale !== l1.C) {\n        return false;\n      }\n      return true;\n    }\n    if (l1.B !== 0) {\n      const scale = l2.B / l1.B;\n      if (l1.A * scale !== l2.A) {\n        return false;\n      }\n      if (l1.C * scale !== l2.C) {\n        return false;\n      }\n      return true;\n    }\n    if (l2.B !== 0) {\n      const scale = l1.B / l2.B;\n      if (l2.A * scale !== l1.A) {\n        return false;\n      }\n      if (l2.C * scale !== l1.C) {\n        return false;\n      }\n      return true;\n    }\n    return true;\n  }\n\n  /**\n   * `true` if this line is contained within `line2`\n   * @return {boolean}\n   */\n  isWithinLine(line2: Line, precision: number = 8) {\n    const l1 = this.round(precision);\n    const l2 = line2.round(precision);\n    if (!l1.isAlongLine(l2, precision)) {\n      return false;\n    }\n    if (line2.ends === 0) {\n      return true;\n    }\n    const withinEnds = () => l2.hasPointOn(this.p1, precision) && l2.hasPointOn(this.p2, precision);\n    if (this.ends < line2.ends) {\n      return false;\n    }\n    if (this.ends === 2) {\n      return withinEnds();\n    }\n    return withinEnds();\n  }\n\n  // left, right, top, bottom is relative to cartesian coordinates\n  // 'outside' is the outside of a polygon defined in the positive direction\n  // (CCW).\n  /**\n   * Create a line that is offset by some distance from this line.\n   *\n   * `'left'`, `'right'`, `'top'` and `'bottom'` are relative to cartesian\n   * coordinates.\n   *\n   * `'positive'` to the right of a vertical line defined from bottom to top and\n   * above a horizontal line defined from right to left. Another way to think of\n   * it is if lines are used to create a polygon in the positive rotation\n   * direction (CCW), the the `'positive'` side will be on the outside of the\n   * polygon.\n   *\n   * `'negative'` is then the inside of the same polygon.\n   * @return  {Line}\n   */\n  offset(\n    direction: 'left' | 'right' | 'top' | 'bottom' | 'positive' | 'negative',\n    dist: number,\n  ) {\n    let normalizedAngle = this.ang;\n    if (normalizedAngle >= Math.PI) {\n      normalizedAngle -= Math.PI;\n    }\n    if (normalizedAngle < 0) {\n      normalizedAngle += Math.PI;\n    }\n    let offsetAngle = normalizedAngle - Math.PI / 2;\n    if (direction === 'positive') {\n      offsetAngle = clipAngle(this.ang, '0to360') + Math.PI / 2;\n    } else if (direction === 'negative') {\n      offsetAngle = clipAngle(this.ang, '0to360') - Math.PI / 2;\n    } else if (normalizedAngle < Math.PI / 2) {\n      if (direction === 'left' || direction === 'top') {\n        offsetAngle = normalizedAngle + Math.PI / 2;\n      }\n    } else if (direction === 'left' || direction === 'bottom') {\n      offsetAngle = normalizedAngle + Math.PI / 2;\n    }\n    const p1 = new Point(\n      this.p1.x + dist * Math.cos(offsetAngle),\n      this.p1.y + dist * Math.sin(offsetAngle),\n    );\n    const p2 = new Point(\n      this.p2.x + dist * Math.cos(offsetAngle),\n      this.p2.y + dist * Math.sin(offsetAngle),\n    );\n    return new Line(p1, p2, 0, this.ends);\n  }\n\n  // If two lines are parallel, their determinant is 0\n  /**\n   * `true` if this line is parralel with `line2`\n   * @return {boolean}\n   */\n  isParallelWith(line2: Line, precision: number = 8) {\n    const l2 = line2; // line2.round(precision);\n    const l1 = this;  // this.round(precision);\n    const det = l1.A * l2.B - l2.A * l1.B;\n    if (roundNum(det, precision) === 0) {\n      return true;\n    }\n    return false;\n  }\n\n  // This needs to be tested somewhere as p1ToShaddow = line was updated\n  shaddowOn(l: Line, precision: number = 8) {\n    const { intersect } = this.intersectsWith(l, precision);\n    if (intersect == null) {\n      return null;\n    }\n    const perpendicular = new Line(intersect, 1, l.ang + Math.PI / 2);\n    const shaddow = this.p1.getShaddowOnLine(perpendicular, precision);\n    const p1ToShaddow = new Line(this.p1, shaddow);\n    const dist = p1ToShaddow.distance;\n    // const distance = shaddow.distance(this.p1);\n    const projection = new Point(\n      this.p1.x + dist * 2 * Math.cos(p1ToShaddow.ang),\n      this.p1.y + dist * 2 * Math.sin(p1ToShaddow.ang),\n    );\n    return new Line(intersect, projection);\n  }\n\n  // At two lines intersection, the x and y values must be equal\n  //   A1x + B1y = C1 => y = -A1/B1x + C1/B1      - Eq 1\n  //   A2x + B2y = C2 => y = -A2/B2x + C2/B2      - Eq 2\n  // Right hand sides are equal:\n  //   -A1/B1x + C1/B1 = -A2/B2x + C2/B2\n  //   x(-A1/B1 + A2/B2) = C2/B2 - C1/B1\n  //   x(-A1B2 + A2B1)/B1B2 = (C2B1 - C1B2)/B1B2\n  //   x = (C2B1 - C1B2) / (-A1B2 + A2B1)\n  //   y = -A1/B1x + C1/B1\n  // If however B1 is 0, then y can be found from eqn 2\n  //   y = -A2/B2x + C2/B2\n\n  /**\n   * The intersection between this line and `line2`.\n   *\n   * The returned result is an {@link Intersect} object with keys `intersect`,\n   * `alongLine` and `withinLine`. The `intersect` is found by extending both\n   * lines to infinity and recording where they cross. If the two lines never\n   * cross, and are not collinear, then the result will be `undefined`.\n   * `alongLine` and `withinLine` can then be used as metadata to defermine if\n   * the intersection is within finite lines or not.\n   *\n   * The properties of the two lines, such as whether they have zero, finite,\n   * or infinite length, and are parallel or collinear will define the result.\n   *\n   * If the lines are not parallel and/or collinear then the returned intercept\n   * will be the point where the two lines, extended to infinity, cross. The\n   * `withinLine` returned property can then be used to determine if the\n   * intercept point is within this line.\n   *\n   * If one of the lines has zero length, then `intersect` will only be\n   * defined if p1 of the zero length line lies along the other line.\n   *\n   * If both of the lines have zero length, then `intersect` will only be\n   * defined if p1 of both lines is the same.\n   *\n   * If the lines are parallel and not collinear, then `intercept` will be\n   * undefined.\n   *\n   * If lines are collinear then the `intercept` point will be defined by how\n   * many finite ends the lines have and wheter the lines are overlapping or\n   * not\n   *\n   * Lines are equal:\n   *    - 0 ends: take the yIntercept (or xIntercept if vertical)\n   *    - 1 ends: take the p1 point\n   *    - 2 ends: take the midPoint\n   *\n   * One line within the other: take mid point between mid points\n   *    - 2 ends around 2 ends: take the midPoint of the two midPoints\n   *    - 0 ends around 2 ends: take the midPoint of the 2 ends\n   *    - 0 ends around 1 ends: take the p1 of the 1 ends\n   *    - 1 end around 1 end: take the midPoint between the p1s\n   *    - 1 end around 2 ends: take the midPoint of the two ends\n   *\n   * Lines are not overlapping:\n   *    - Both 2 ends - take midPoint between 2 closest ends\n   *    - Both 1 ends - take midPoint between 2 p1s\n   *    - One 1 end and 2 end - take midPoint between p1 and closest point\n   *\n   * Lines are partially overlapping:\n   *    - Both 2 ends - take midPoint between 2 overlapping ends\n   *    - Both 1 ends - take midPoint between both p1s\n   *    - One 1 end and 2 end - take midPoint between overlapping end and p1\n   * @return {Intersect}\n   */\n  intersectsWith(line2: Line, precision: number = 8): Intersect {\n    const l2 = line2; // line2.round(precision);\n    const l1 = this;  // this.round(precision);\n\n    const d1 = roundNum(this.distance, precision);\n    const d2 = roundNum(l2.distance, precision);\n    if (d1 === 0 || d2 === 0) {\n      let i;\n      let alongLine = false;\n      let withinLine = false;\n      if (d1 === 0 && d2 === 0) {\n        if (l1.p1.isEqualTo(l2.p1, precision)) {\n          i = l1.p1._dup();\n          alongLine = true;\n          withinLine = true;\n        }\n      }\n      if (d1 > 0) {\n        if (l1.hasPointOn(l2.p1, precision)) {\n          i = l2.p1._dup();\n          withinLine = true;\n          alongLine = true;\n        } else if (l1.hasPointAlong(l2.p1, precision)) {\n          i = l2.p1._dup();\n          alongLine = true;\n        }\n      }\n      if (d2 > 0) {\n        if (l2.hasPointOn(l1.p1, precision)) {\n          i = l1.p1._dup();\n          withinLine = true;\n          alongLine = true;\n        } else if (l2.hasPointAlong(l1.p1, precision)) {\n          i = l1.p1._dup();\n          alongLine = true;\n        }\n      }\n      return {\n        intersect: i,\n        alongLine,\n        withinLine,\n      };\n    }\n\n    if (!l1.isParallelWith(l2)) {\n      let i;\n      if (roundNum(l1.A, precision) === 0 && roundNum(l2.B, precision) === 0) {\n        i = new Point(l2.p1.x, l1.p1.y);\n      } else if (roundNum(l1.B, precision) === 0 && roundNum(l2.A, precision) === 0) {\n        i = new Point(l1.p1.x, l2.p1.y);\n      // if l1.B is 0, then l1 has constant x\n      } else if (roundNum(l1.B, precision) === 0) {\n        const x = (l2.C * l1.B - l1.C * l2.B) / (-l1.A * l2.B + l2.A * l1.B);\n        const y = -l2.A / l2.B * x + l2.C / l2.B;\n        i = new Point(x, y);\n      } else {\n        const x = (l2.C * l1.B - l1.C * l2.B) / (-l1.A * l2.B + l2.A * l1.B);\n        const y = -l1.A / l1.B * x + l1.C / l1.B;\n        i = new Point(x, y);\n      }\n      if (\n        l1.hasPointOn(i, precision) && l2.hasPointOn(i, precision)\n      ) {\n        return {\n          alongLine: true,\n          withinLine: true,\n          intersect: i,\n        };\n      }\n      return {\n        alongLine: true,\n        withinLine: false,\n        intersect: i,\n      };\n    }\n    if (!l1.isAlongLine(l2, precision)) {\n      return {\n        alongLine: false,\n        withinLine: false,\n        intersect: undefined,\n      };\n    }\n\n    // If lines are collinear they could be either:\n    //   - equal:\n    //      - 0 ends: take the yIntercept (or xIntercept if vertical)\n    //      - 1 ends: take the p1 point\n    //      - 2 ends: take the midPoint\n    //   - one within the other: take mid point between mid points\n    //      - 2 ends around 2 ends: take the midPoint of the two midPoints\n    //      - 0 ends around 2 ends: take the midPoint of the 2 ends\n    //      - 0 ends around 1 ends: take the p1 of the 1 ends\n    //      - 1 end around 1 end: take the midPoint between the p1s\n    //      - 1 end around 2 ends: take the midPoint of the two ends\n    //   - not overlapping:\n    //      - Both 2 ends - take midPoint between 2 closest ends\n    //      - Both 1 ends - take midPoint between 2 p1s\n    //      - One 1 end and 2 end - take midPoint between p1 and closest point\n    //   - partially overlapping:\n    //      - Both 2 ends - take midPoint between 2 overlapping ends\n    //      - Both 1 ends - take midPoint between both p1s\n    //      - One 1 end and 2 end - take midPoint between overlapping end and p1\n\n    // If Equal\n    const xIntercept = this.getXIntercept();\n    const yIntercept = this.getYIntercept();\n    let defaultIntercept;\n    if (yIntercept != null) {\n      defaultIntercept = new Point(0, yIntercept);\n    } else if (xIntercept != null) {\n      defaultIntercept = new Point(xIntercept, 0);\n    } else {\n      defaultIntercept = new Point(0, 0);\n    }\n    // const defaultIntercept = yIntercept == null ? new Point(\n    // xIntercept == null ? 0 : xIntercept, 0) : new Point(0, yIntercept);\n\n    if (l1.isEqualTo(l2, precision)) {\n      let i;\n      if (l1.ends === 2) {\n        i = l1.midPoint();\n      } else if (l1.ends === 1) {\n        i = l1.p1._dup();\n      } else {\n        i = defaultIntercept;\n      }\n      return {\n        alongLine: true,\n        withinLine: true,\n        intersect: i,\n      };\n    }\n\n    // If one line is fully within the other\n    let i;\n    const lineIsWithin = (li1, li2) => {\n      // If fully overlapping\n      if (li1.hasLineWithin(li2, precision)) {\n        if (li1.ends === 2) {\n          i = new Line(li1.midPoint(), li2.midPoint()).midPoint();\n        }\n        if (li1.ends === 1 && li2.ends === 1) {\n          i = new Line(li1.p1, li2.p1);\n        }\n        if (li1.ends === 1 && li2.ends === 2) {\n          i = li2.midPoint();\n        }\n        if (li1.ends === 0 && li2.ends === 2) {\n          i = li2.midPoint();\n        }\n        if (li1.ends === 0 && li2.ends === 1) {\n          i = li2.p1._dup();\n        }\n        if (li1.ends > li2.ends) {\n          if (li1.ends === 2) {\n            i = li1.midPoint();\n          } else {\n            i = li1.p1;\n          }\n        }\n        if (li1.ends === 1 && li2.ends === 1) {\n          i = new Line(li1.p1, li2.p1).midPoint();\n        }\n        return true;\n      }\n      return false;\n    };\n    if (lineIsWithin(l1, l2)) {\n      return { alongLine: true, withinLine: true, intersect: i };\n    }\n    if (lineIsWithin(l2, l1)) {\n      return { alongLine: true, withinLine: true, intersect: i };\n    }\n\n    // Two finite lines\n    if (l1.ends === 2 && l2.ends === 2) {\n      // Not overlapping\n      if (\n        !l1.p1.isWithinLine(l2, precision)\n        && !l1.p2.isWithinLine(l2, precision)\n        && !l2.p1.isWithinLine(l1, precision)\n        && !l2.p2.isWithinLine(l1, precision)\n      ) {\n        const line11 = new Line(l1.p1, l2.p1);\n        const line12 = new Line(l1.p1, l2.p2);\n        const line21 = new Line(l1.p2, l2.p1);\n        const line22 = new Line(l1.p2, l2.p2);\n\n        i = line11.midPoint();\n        let len = line11.length();\n        if (line12.length() < len) {\n          i = line12.midPoint();\n          len = line12.length();\n        }\n        if (line21.length() < len) {\n          i = line21.midPoint();\n          len = line21.length();\n        }\n        if (line22.length() < len) {\n          i = line22.midPoint();\n          len = line22.length();\n        }\n        return {\n          alongLine: true,\n          withinLine: false,\n          intersect: i,\n        };\n      }\n      // Partial overlap\n      if (l1.p1.isWithinLine(l2, precision)) {\n        if (l2.p1.isWithinLine(l1, precision)) {\n          i = new Line(l1.p1, l2.p1).midPoint();\n        } else {\n          i = new Line(l1.p1, l2.p2).midPoint();\n        }\n      } else if (l2.p1.isWithinLine(l1, precision)) {\n        i = new Line(l1.p2, l2.p1).midPoint();\n      } else {\n        i = new Line(l1.p2, l2.p2).midPoint();\n      }\n      return {\n        alongLine: true,\n        withinLine: true,\n        intersect: i,\n      };\n    }\n\n    // Two 1 end lines\n    if (l1.ends === 1 && l2.ends === 1) {\n      // Both not overlapping and partial overlap will have an intersect as\n      // the midPoint between the p1s\n      return {\n        alongLine: true,\n        withinLine: false,\n        intersect: new Line(l1.p1, l2.p1).midPoint(),\n      };\n    }\n\n    // One 1 end, one 2 end is the only remaining possibility\n    let withinLine = false;\n    const checkOverlap = (li1: Line, li2: Line) => {\n      // partial overlap\n      if (li1.p1.isWithinLine(li2)) {\n        withinLine = true;\n        if (li2.p1.isWithinLine(li1)) {\n          i = new Line(li1.p1, li2.p1).midPoint();\n        } else {\n          i = new Line(li1.p1, li2.p2).midPoint();\n        }\n      // No Overlap\n      } else {\n        withinLine = false;\n        const l11 = new Line(li1.p1, li2.p1);\n        const l12 = new Line(li1.p1, li2.p2);\n\n        if (l11.length() < l12.length()) {\n          i = l11.midPoint();\n        } else {\n          i = l12.midPoint();\n        }\n      }\n    };\n    if (l1.ends === 1 && l2.ends === 2) {\n      checkOverlap(l1, l2);\n    } else {\n      checkOverlap(l2, l1);\n    }\n    return {\n      alongLine: true,\n      withinLine,\n      intersect: i,\n    };\n  }\n}\n\nclass Vector extends Line {\n  i: number;\n  j: number;\n\n  constructor(\n    p1OrLine: TypeParsablePoint | Line,\n    p2OrMag: TypeParsablePoint | number,\n    angle: number = 0,\n  ) {\n    if (p1OrLine instanceof Line) {\n      super(p1OrLine.p1, p1OrLine.distance, p1OrLine.ang);\n    } else {\n      super(p1OrLine, p2OrMag, angle);\n    }\n    this.i = this.distance * Math.cos(this.ang);\n    this.j = this.distance * Math.sin(this.ang);\n  }\n\n  unit() {\n    return new Vector(this.p1, 1, this.ang);\n  }\n\n  dotProduct(v: Vector, precision: number = 8) {\n    return roundNum(this.i * v.i + this.j * v.j, precision);\n  }\n}\n\nfunction line(p1: Point, p2: Point) {\n  return new Line(p1, p2);\n}\n\n\ntype TypeF1DefLine = {\n  f1Type: 'l',\n  state: [[number, number], [number, number], 2 | 1 | 0],\n};\n\n\n/**\n * A {@link Line} is defined with either two points, or a point, magbintude and angle.\n * The end definitions define if the line is finite or infinite. And end\n * definition of `2` means both ends are finite and the line stops at its\n * definition. `1` means the first end is finite, and the line extends through\n * the second point to infinity. `0` means the line extends through both\n * points to infinite on either side.\n *\n * A line can be defined in several ways.\n *\n * As a Line: `new Line()`\n * - As two points: `[{@link TypeParsablePoint}, {@link TypeParsablePoint}]`\n * - As two points and end definitions:\n *   `[{@link TypeParsablePoint}, {@link TypeParsablePoint}, 2 | 1 | 0]`\n * - As a point, mag angle: `[{@link TypeParsablePoint}, number, number]`\n * - As a point, mag angle and end definitions: '[number, number, 2, 1, 0]'\n * - As a definition object where state is\n *   [[p1.x, p1.y], [p2.x, p2.y], endDefinition]:\n *   { f1Type: 'l', state: [[number, number], [number, number], 2 | 1 | 0 }\n * @example\n * // l1, l2, l3, l4, l5 and l6 are all the same if parsed by `getLine`\n * l1 = new Line([0, 0], [2, 2]);\n * l2 = new Line([0, 0], 2 * Math.sqrt(2), Math.PI / 4);\n * l3 = new Line([0, 0], [2, 2], 2);\n * l4 = [[0, 0], [2, 2]];\n * l5 = [[0, 0], 2 * Math.sqrt(2), Math.PI / 4];\n * l6 = [[0, 0], [2, 2], 2];\n */\nexport type TypeParsableLine = [TypeParsablePoint, TypeParsablePoint, 2 | 1 | 0]\n                                | [TypeParsablePoint, TypeParsablePoint]\n                                | [TypeParsablePoint, number, number, 2 | 1 | 0]\n                                | [TypeParsablePoint, number, number]\n                                | TypeF1DefLine\n                                | Line;\n// line can be defined as:\n//    - [[0, 0], [1, 0]]\n//    - [[0, 0], 1, 0]\n\nfunction parseLine<T>(lIn: TypeParsableLine, onFail: T): Line | T | null {\n  if (lIn instanceof Line) {\n    return lIn;\n  }\n  let onFailToUse = onFail;\n  if (onFailToUse == null) {\n    onFailToUse = null;\n  }\n\n  if (lIn == null) {\n    return onFailToUse;\n  }\n\n  let l = lIn;\n  if (typeof l === 'string') {\n    try {\n      l = JSON.parse(l);\n    } catch {\n      return onFailToUse;\n    }\n  }\n\n  if (Array.isArray(l)) {\n    if (l.length === 4) {\n      return new Line(getPoint(l[0]), l[1], l[2], l[3]);\n    }\n    if (l.length === 3) {\n      if (typeof l[1] === 'number') {\n        return new Line(getPoint(l[0]), l[1], l[2]);\n      } // $FlowFixMe\n      return new Line(getPoint(l[0]), getPoint(l[1]), 0, l[2]);\n    }\n    if (l.length === 2) {\n      return new Line(getPoint(l[0]), getPoint(l[1]));\n    }\n    return onFailToUse;\n  }\n  if (l.f1Type != null) {\n    if (\n      l.f1Type === 'l'\n      && l.state != null\n      && Array.isArray([l.state])\n      && l.state.length === 3\n    ) {\n      const [p1, p2, ends] = l.state;\n      return new Line(getPoint(p1), getPoint(p2), 0, ends);\n    }\n    return onFailToUse;\n  }\n  return onFailToUse;\n}\n\n/**\n * Convert a parsable line definition to a {@link Line}.\n * @param {TypeParsableLine} l parsable line definition\n * @return {Line} `Line` object\n */\nfunction getLine(l: TypeParsableLine): Line {\n  let parsedLine = parseLine(l);\n  if (parsedLine == null) {\n    parsedLine = new Line(new Point(0, 0), new Point(1, 0));\n  }\n  return parsedLine;\n}\n\ntype TypeF1DefRotation = {\n  f1Type: 'r',\n  state: [string, number],\n};\n\n/**\n * Rotation transform element\n */\nclass Rotation {\n  r: number;\n  name: string;\n  /**\n   * @param {number | string} rotationAngle\n   * @param {string} name name to give to rotation to identify it in a more\n   * complex {@link Transform}\n   */\n  constructor(rotationAngle: number | TypeF1DefRotation | string, name: string = '') {\n    let nameToUse: string = name;\n    let angle = rotationAngle;\n    if (typeof angle === 'string') {\n      try {\n        angle = JSON.parse(angle);\n      } catch {\n        angle = 0;\n      }\n    }\n\n    if (typeof angle === 'number') {\n      this.r = angle;\n    } else if (\n      angle.f1Type != null\n      && angle.f1Type === 'r'\n      && angle.state != null\n      && Array.isArray(angle.state)\n      && angle.state.length === 2\n    ) {\n      const [n, r] = angle.state;\n      nameToUse = n;\n      this.r = r;\n    } else {\n      this.r = 0;\n    }\n    this.name = nameToUse;\n  }\n\n  _state(options: { precision: number }) {\n    // const { precision } = options;\n    const precision = getPrecision(options);\n    return {\n      f1Type: 'r',\n      state: [this.name, roundNum(this.r, precision)],\n    };\n  }\n\n  /**\n   * Return a rotation matrix representing the rotation\n   * @return {Array<number>}\n   */\n  matrix(): Array<number> {\n    return m2.rotationMatrix(this.r);\n  }\n\n  /**\n   * Subtract `rotToSub` from this rotation\n   * @return {Rotation}\n   */\n  sub(rotToSub: Rotation = new Rotation(0, this.name)): Rotation {\n    return new Rotation(this.r - rotToSub.r, this.name);\n  }\n\n  /**\n   * Round this rotation to some `precision`\n   * @return {Rotation}\n   */\n  round(precision: number = 8): Rotation {\n    return new Rotation(roundNum(this.r, precision), this.name);\n  }\n\n  /**\n   * Add `rotToAdd` to this rotation\n   * @return {Rotation}\n   */\n  add(rotToAdd: Rotation = new Rotation(0, this.name)): Rotation {\n    return new Rotation(this.r + rotToAdd.r, this.name);\n  }\n\n  /**\n   * Multiply `rotToMul` to this rotation\n   * @return {Rotation}\n   */\n  mul(rotToMul: Rotation = new Rotation(1, this.name)): Rotation {\n    return new Rotation(this.r * rotToMul.r, this.name);\n  }\n\n  /**\n   * Return a duplicate rotation\n   * @return {Rotation}\n   */\n  _dup() {\n    return new Rotation(this.r, this.name);\n  }\n}\n\n\ntype TypeF1DefTranslation = {\n  f1Type: 't',\n  state: [string, number, number],\n};\n\n/**\n * Translation transform element\n */\nclass Translation extends Point {\n  x: number;\n  y: number;\n  name: string;\n\n  /**\n   * @param {Point | number} txOrTranslation translation or x value of\n   * translation\n   * @param {number} ty y value of translation (only used if `txOrTranslation`\n   * is a `number`)\n   * @param {string} name name to identify translation when included in a more\n   * complex {@link Transform}\n   */\n  constructor(\n    txOrTranslation: Point | number | TypeF1DefTranslation,\n    ty: number = 0,\n    name: string = '',\n  ) {\n    let nameToUse: string = name;\n    let tx = txOrTranslation;\n    let tyToUse = ty;\n    if (typeof tx === 'string') {\n      try {\n        tx = JSON.parse(tx);\n      } catch {\n        tx = 0;\n      }\n      if (Array.isArray(tx) && tx.length === 2) {\n        [tx, tyToUse] = tx;\n      }\n    }\n    if (tx instanceof Point) {\n      super(tx.x, tx.y);\n    } else if (typeof tx === 'number') {\n      super(tx, tyToUse);\n    } else if (\n      tx.f1Type != null\n      && tx.f1Type === 't'\n      && tx.state != null\n      && Array.isArray(tx.state)\n      && tx.state.length === 3\n    ) {\n      const [n, x, y] = tx.state;\n      nameToUse = n;\n      super(x, y);\n    } else {\n      super(0, 0);\n    }\n    this.name = nameToUse;\n  }\n\n  _state(options: { precision: number }) {\n    const precision = getPrecision(options);\n    return {\n      f1Type: 't',\n      state: [\n        this.name,\n        roundNum(this.x, precision),\n        roundNum(this.y, precision),\n      ],\n    };\n  }\n\n  /**\n   * Returns a translation matrix\n   * @return {Array<number>}\n   */\n  matrix(): Array<number> {\n    return m2.translationMatrix(this.x, this.y);\n  }\n\n  /**\n   * Subtract `translationToSub` from this translation\n   * @return {Translation}\n   */\n  sub(\n    translationToSub: Translation | Point | number = new Translation(0, 0),\n    y: number = 0,\n  ): Translation {\n    let t = new Point(0, 0);\n    if (typeof translationToSub === 'number') {\n      t = new Translation(translationToSub, y);\n    } else {\n      t = translationToSub;\n    }\n    return new Translation(\n      this.x - t.x,\n      this.y - t.y,\n      this.name,\n    );\n  }\n\n  /**\n   * Add `translationToAdd` to this translation\n   * @return {Translation}\n   */\n  add(\n    translationToAdd: Translation | Point | number = new Translation(0, 0),\n    y: number = 0,\n  ): Translation {\n    let t = new Point(0, 0);\n    if (typeof translationToAdd === 'number') {\n      t = new Translation(translationToAdd, y);\n    } else {\n      t = translationToAdd;\n    }\n    return new Translation(\n      this.x + t.x,\n      this.y + t.y,\n      this.name,\n    );\n  }\n\n  /**\n   * Multiply `translationToMul` to this translation\n   * @return {Translation}\n   */\n  mul(translationToMul: Translation = new Translation(1, 1)): Translation {\n    return new Translation(\n      this.x * translationToMul.x,\n      this.y * translationToMul.y,\n      this.name,\n    );\n  }\n\n  /**\n   * Round this translation to some `precision`\n   * @return {Translation}\n   */\n  round(precision: number = 8): Translation {\n    return new Translation(\n      roundNum(this.x, precision),\n      roundNum(this.y, precision),\n      this.name,\n    );\n  }\n\n  /**\n   * Return a duplicate translation\n   */\n  _dup() {\n    return new Translation(this.x, this.y, this.name);\n  }\n}\n\ntype TypeF1DefScale = {\n  f1Type: 't',\n  state: [string, number, number],\n};\n\n/**\n * Scale transform element\n */\nclass Scale extends Point {\n  x: number;\n  y: number;\n  name: string;\n\n  /**\n   * @param {Point | number} sxOrScale scale or x value of\n   * scale\n   * @param {number} ty y value of scale (only used if `sxOrScale`\n   * is a `number`)\n   * @param {string} name name to identify scale when included in a more\n   * complex {@link Transform}\n   */\n  constructor(sxOrScale: Point | number | TypeF1DefScale, sy: ?number, nameIn: string = '') {\n    let name: string = nameIn;\n    let sx = sxOrScale;\n    let syToUse = sy;\n    if (typeof sx === 'string') {\n      try {\n        sx = JSON.parse(sx);\n      } catch {\n        sx = 0;\n      }\n      if (Array.isArray(sx) && sx.length === 2) {\n        [sx, syToUse] = sx;\n      }\n    }\n    if (sx instanceof Point) {\n      super(sx.x, sx.y);\n    } else if (typeof sx === 'number') {\n      if (syToUse != null) {\n        super(sx, syToUse);\n      } else {\n        super(sx, sx);\n      }\n    } else if (\n      sx.f1Type != null\n      && sx.f1Type === 's'\n      && sx.state != null\n      && Array.isArray(sx.state)\n      && sx.state.length === 3\n    ) {\n      const [n, x, y] = sx.state;\n      name = n;\n      super(x, y);\n    } else {\n      super(1, 1);\n    }\n    this.name = name;\n  }\n\n  _state(options: { precision: number }) {\n    // const { precision } = options;\n    const precision = getPrecision(options);\n    return {\n      f1Type: 's',\n      state: [\n        this.name,\n        roundNum(this.x, precision),\n        roundNum(this.y, precision),\n      ],\n    };\n  }\n\n  /**\n   * Returns a scale matrix\n   * @return {Array<number>}\n   */\n  matrix(): Array<number> {\n    return m2.scaleMatrix(this.x, this.y);\n  }\n\n  /**\n   * Subtract `scaleToSub` from this scale\n   * @return {Scale}\n   */\n  sub(\n    scaleToSub: Scale | Point | number = new Scale(0, 0),\n    y: number = 0,\n  ): Scale {\n    let s = new Point(0, 0);\n    if (typeof scaleToSub === 'number') {\n      s = new Scale(scaleToSub, y);\n    } else {\n      s = scaleToSub;\n    }\n    return new Scale(\n      this.x - s.x,\n      this.y - s.y,\n      this.name,\n    );\n  }\n\n  /**\n   * Round this scale to some `precision`\n   * @return {Scale}\n   */\n  round(precision: number = 8): Scale {\n    return new Scale(\n      roundNum(this.x, precision),\n      roundNum(this.y, precision),\n      this.name,\n    );\n  }\n\n  /**\n   * Add `scaleToAdd` to this scale\n   * @return {Scale}\n   */\n  add(\n    scaleToAdd: Scale | Point | number = new Scale(0, 0),\n    y: number = 0,\n  ): Scale {\n    let s = new Point(0, 0);\n    if (typeof scaleToAdd === 'number') {\n      s = new Scale(scaleToAdd, y);\n    } else {\n      s = scaleToAdd;\n    }\n    return new Scale(\n      this.x + s.x,\n      this.y + s.y,\n      this.name,\n    );\n  }\n\n  /**\n   * Multiply `scaleToMul` to this scale\n   * @return {Scale}\n   */\n  mul(scaleToMul: Scale | Point | number = new Scale(1, 1)): Scale {\n    if (scaleToMul instanceof Scale || scaleToMul instanceof Point) {\n      return new Scale(\n        this.x * scaleToMul.x,\n        this.y * scaleToMul.y,\n      );\n    }\n    return new Scale(\n      this.x * scaleToMul,\n      this.y * scaleToMul,\n      this.name,\n    );\n  }\n\n  /**\n   * Return a duplicate of this scale\n   * @return {Scale}\n   */\n  _dup() {\n    return new Scale(this.x, this.y, this.name);\n  }\n}\n\nexport type TypeTransformValue = number | Array<number> | {\n  scale?: number,\n  position?: number,\n  translation?: number,\n  rotation?: number,\n};\n\n/**\n * Object that represents a chain of {@link Rotation}, {@link Translation} and\n * {@link Scale} transforms\n *\n * Use `translate`, `scale` and `rotate` methods to create chains (see example).\n *\n * @example\n * // Create a tranform that first scales, then rotates then translates\n * const t1 = new Transform().scale(2, 2).rotate(Math.PI).translate(1, 1)\n */\nclass Transform {\n  order: Array<Translation | Rotation | Scale>;\n  mat: Array<number>;\n  index: number;\n  name: string;\n  _type: 'transform';\n  custom: ?Object;\n\n  /**\n   * @param {Array<Translation | Rotation | Scale> | string} chainOrName chain\n   * of transforms to initialize this Transform with, or name of transform if\n   * not initializing with transforms.\n   * @param {string} name transform name if `chainOrName` defines initializing\n   * transforms\n   */\n  constructor(chainOrName: Array<Translation | Rotation | Scale> | string = [], name: string = '') {\n    if (typeof chainOrName === 'string') {\n      this.order = [];\n      this.name = chainOrName;\n    } else {\n      // for (let i = 0; i < orderOrName.length; i += 1 ) {\n      //   const t = orderOrName[i];\n      //   if (\n      //     !(t instanceof Translation)\n      //     && !(t instanceof Scale)\n      //     && !(t instanceof Rotation)\n      //   ) {\n      //     debugger;\n      //   }\n      // }\n      // debugger;\n      this.order = chainOrName.map(t => t._dup());\n      this.name = name;\n    }\n    // this.order = order.slice();\n    this.index = this.order.length;\n    this._type = 'transform';\n    this.calcAndSetMatrix();\n  }\n\n  _state(options: { precision: number } = { precision: 8 }) {\n    // const { precision } = options;\n    const out = [];\n    this.order.forEach((transformElement) => {\n      out.push(transformElement._state(options));\n    });\n    // if (this.name !== '') {\n    //   // return [this.name, ...out];\n    //   out = [this.name, ...out];\n    // }\n    return {\n      f1Type: 'tf',\n      state: [\n        this.name,\n        ...out,\n      ],\n    };\n  }\n\n  /**\n   * Return a standard unity transform chain that includes scale, rotation and\n   * translation blocks\n   * @return {Transform}\n   */\n  standard() {\n    return this.scale(1, 1).rotate(0).translate(0, 0);\n  }\n\n  /**\n   * Return a duplicate transform with an added {@link Translation} transform\n   * @param {number | Point} xOrTranslation\n   * @return {Transform}\n   */\n  translate(\n    xOrTranslation: number | Point | TypeF1DefTranslation,\n    y: number = 0,\n    name: string = this.name,\n  ) {\n    const translation = new Translation(xOrTranslation, y, name);\n    const order = this.order.slice();\n\n    if (this.index === this.order.length) {\n      order.push(translation);\n    } else {\n      this.order[this.index] = translation;\n      this.index += 1;\n      this.calcAndSetMatrix();\n      return this;\n    }\n    return new Transform(order, name);\n  }\n\n  /**\n   * Return a duplicate transform with an added {@link Rotation} transform\n   * @param {number} r\n   * @return {Transform}\n   */\n  rotate(r: number | TypeF1DefRotation, name: string = this.name) {\n    const rotation = new Rotation(r, name);\n    // rotation.name = name;\n    const order = this.order.slice();\n    if (this.index === this.order.length) {\n      order.push(rotation);\n    } else {\n      this.order[this.index] = rotation;\n      this.index += 1;\n      this.calcAndSetMatrix();\n      return this;\n    }\n    // this.order.push(new Rotation(r));\n    // this.calcMatrix();\n    return new Transform(order, name);\n  }\n\n  /**\n   * Return a duplicate transform with an added {@link Scale} transform\n   * @param {number | Point} xOrScale\n   * @return {Transform}\n   */\n  scale(xOrScale: number | Point | TypeF1DefScale, y: number = 0, name: string = this.name) {\n    const scale = new Scale(xOrScale, y, name);\n    const order = this.order.slice();\n\n    if (this.index === this.order.length) {\n      order.push(scale);\n    } else {\n      this.order[this.index] = scale;\n      this.index += 1;\n      this.calcAndSetMatrix();\n      return this;\n    }\n    return new Transform(order, name);\n  }\n\n  /**\n   * Remove some transforms from this transform chain\n   * @return {Transform}\n   */\n  remove(transformNames: string | Array<string>) {\n    const newOrder = [];\n    let names;\n    if (typeof transformNames === 'string') {\n      names = [transformNames];\n    } else {\n      names = transformNames;\n    }\n    this.order.forEach((transformElement) => {\n      if (names.indexOf(transformElement.name) === -1) {\n        newOrder.push(transformElement._dup());\n      }\n    });\n    return new Transform(newOrder, this.name);\n  }\n\n  /**\n   * Transform matrix of the transform chain\n   * @return {Array<number>}\n   */\n  calcMatrix(\n    orderStart: number = 0,\n    orderEnd: number = this.order.length - 1,\n  ) {\n    let orderEndToUse = orderEnd;\n    if (orderEnd < 0) {\n      orderEndToUse = this.order.length + orderEnd;\n    }\n    let m = m2.identity();\n    for (let i = orderEndToUse; i >= orderStart; i -= 1) {\n      m = m2.mul(m, this.order[i].matrix());\n    }\n    return m;\n    // this.mat = m2.copy(m);\n    // return m;\n    // this.mat = m;\n  }\n\n  calcAndSetMatrix() {\n    this.mat = this.calcMatrix();\n  }\n  // /**\n  //  * Transform matrix of the transform chain\n  //  * @return {Array<number>}\n  //  */\n  // calcMatrix(\n  //   orderStart: number = 0,\n  //   orderEnd: number = this.order.length - 1,\n  // ) {\n  //   let orderEndToUse = orderEnd;\n  //   if (orderEnd < 0) {\n  //     orderEndToUse = this.order.length + orderEnd;\n  //   }\n  //   let m = m2.identity();\n  //   for (let i = orderEndToUse; i >= orderStart; i -= 1) {\n  //     m = m2.mul(m, this.order[i].matrix());\n  //   }\n  //   // this.mat = m2.copy(m);\n  //   // return m;\n  //   this.mat = m;\n  // }\n\n\n  update(index: number) {\n    if (index < this.order.length) {\n      this.index = index;\n    }\n    return this;\n  }\n\n  /**\n   * Retrieve the nth {@link Translation} transform value from this transform\n   * chain where n = `translationIndex`. If `translationIndex` is invalid\n   * (like if it is larger than the number of `Translation` transforms available)\n   * then `null` will be returned.\n   * @return {Point | null}\n   */\n  t(translationIndex: number = 0): ?Point {\n    let count = 0;\n    for (let i = 0; i < this.order.length; i += 1) {\n      const t = this.order[i];\n      if (t instanceof Translation) {\n        if (count === translationIndex) {\n          return new Point(t.x, t.y);\n        }\n        count += 1;\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Clip all {@link Rotation} transforms within this transform chain to\n   * angles between 0-360, -180-180, or not at all (`null`)\n   */\n  clipRotation(clipTo: '0to360' | '-180to180' | null) {\n    for (let i = 0; i < this.order.length; i += 1) {\n      const transformStep = this.order[i];\n      if (transformStep instanceof Rotation) {\n        transformStep.r = clipAngle(transformStep.r, clipTo);\n      }\n    }\n  }\n\n  /**\n   * Return a duplicate transform chain with an updated the nth\n   * {@link Translation} transform where n = `index`\n   * @return {Transform}\n   */\n  updateTranslation(x: number | Point, yOrIndex: number = 0, index: number = 0) {\n    let count = 0;\n    let actualIndex = index;\n    if (x instanceof Point) {\n      actualIndex = yOrIndex;\n    }\n    for (let i = 0; i < this.order.length; i += 1) {\n      const t = this.order[i];\n      if (t instanceof Translation) {\n        if (count === actualIndex) {\n          this.order[i] = new Translation(x, yOrIndex, this.name);\n          this.calcAndSetMatrix();\n          return this;\n        }\n        count += 1;\n      }\n    }\n    return this;\n  }\n\n  /**\n   * Retrieve the nth {@link Scale} transform value from this transform\n   * chain where n = `scaleIndex`. If `scaleIndex` is invalid\n   * (like if it is larger than the number of `Scale` transforms available)\n   * then `null` will be returned.\n   * @return {Point | null}\n   */\n  s(scaleIndex: number = 0): ?Point {\n    let count = 0;\n    for (let i = 0; i < this.order.length; i += 1) {\n      const t = this.order[i];\n      if (t instanceof Scale) {\n        if (count === scaleIndex) {\n          return new Point(t.x, t.y);\n        }\n        count += 1;\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Return an interpolated transform between this transform and `delta` at\n   * some `percent` between the two.\n   *\n   * Interpolation can either be `'linear'` or '`curved'`.\n   * @return {Transform}\n   */\n  toDelta(\n    delta: Transform,\n    percent: number,\n    translationStyle: 'linear' | 'curved' | 'curve',\n    translationOptions: OBJ_TranslationPath,\n    // translationPath: (Point, Point, number, ?number, ?number) => Point,\n    // direction: number = 1,\n    // mag: number = 0.5,\n    // offset: number = 0.5,\n  ) {\n    const calcTransform = this._dup();\n    for (let i = 0; i < this.order.length; i += 1) {\n      const stepStart = this.order[i];\n      const stepDelta = delta.order[i];\n      if (stepStart instanceof Scale && stepDelta instanceof Scale) {\n        calcTransform.order[i] = stepStart.add(stepDelta.mul(percent));\n      }\n      if (stepStart instanceof Rotation && stepDelta instanceof Rotation) {\n        calcTransform.order[i] = new Rotation(stepStart.r + stepDelta.r * percent, stepStart.name);\n      }\n      if (stepStart instanceof Translation && stepDelta instanceof Translation) {\n        calcTransform.order[i] =\n          new Translation(translationPath(\n            translationStyle,\n            stepStart, stepDelta, percent,\n            translationOptions,\n          ), 0, stepStart.name);\n      }\n    }\n    return calcTransform;\n  }\n\n  /**\n   * Return a duplicate transform chain with an updated the nth\n   * {@link Scale} transform where n = `index`\n   * @return {Transform}\n   */\n  updateScale(x: number | Point, yOrIndex: ?number = null, index: number = 0) {\n    let count = 0;\n    let actualIndex = index;\n    let scale = new Point(1, 1);\n    if (x instanceof Point) {\n      if (yOrIndex == null) {\n        actualIndex = 0;\n      } else {\n        actualIndex = yOrIndex;\n      }\n      scale = x;\n    } else if (yOrIndex == null) {\n      scale.x = x;\n      scale.y = x;\n    } else {\n      scale.x = x;\n      scale.y = yOrIndex;\n    }\n    for (let i = 0; i < this.order.length; i += 1) {\n      const t = this.order[i];\n      if (t instanceof Scale) {\n        if (count === actualIndex) {\n          this.order[i] = new Scale(scale.x, scale.y, this.name);\n          this.calcAndSetMatrix();\n          return this;\n        }\n        count += 1;\n      }\n    }\n    return this;\n  }\n\n  /**\n   * Retrieve the nth {@link Rotation} transform value from this transform\n   * chain where n = `rotationIndex`. If `scaleIndex` is invalid\n   * (like if it is larger than the number of `Rotation` transforms available)\n   * then `null` will be returned.\n   * @return {Point | null}\n   */\n  r(rotationIndex: number = 0): ?number {\n    let count = 0;\n    for (let i = 0; i < this.order.length; i += 1) {\n      const t = this.order[i];\n      if (t instanceof Rotation) {\n        if (count === rotationIndex) {\n          return t.r;\n        }\n        count += 1;\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Return a duplicate transform chain with an updated the nth\n   * {@link Rotation} transform where n = `index`\n   * @return {Transform}\n   */\n  updateRotation(r: number, index: number = 0) {\n    let count = 0;\n    for (let i = 0; i < this.order.length; i += 1) {\n      const t = this.order[i];\n      if (t instanceof Rotation) {\n        if (count === index) {\n          this.order[i] = new Rotation(r, this.name);\n          this.calcAndSetMatrix();\n          return this;\n        }\n        count += 1;\n      }\n    }\n    return this;\n  }\n\n  /**\n   * Return the matrix that respresents the cascaded transform chain\n   * @return {Array<number>}\n   */\n  m(): Array<number> {\n    return this.mat;\n  }\n\n  /**\n   * Return the matrix that respresents the cascaded transform chain\n   * @return {Array<number>}\n   */\n  matrix(): Array<number> {\n    return this.mat;\n  }\n\n  /**\n   * `true` if `transformToCompare` has the same order of {@link Rotation},\n   * {@link Scale} and {@link Translation} transform elements in the transform\n   * chain.\n   * @return {boolean}\n   */\n  isSimilarTo(transformToCompare: Transform): boolean {\n    if (transformToCompare.order.length !== this.order.length) {\n      return false;\n    }\n    for (let i = 0; i < this.order.length; i += 1) {\n      if (this.order[i].constructor.name !==\n          transformToCompare.order[i].constructor.name) {\n        return false;\n      }\n    }\n    return true;\n  }\n\n  /**\n   * `true` if `transformToCompare` is equal to this transform within some\n   * `precision`.\n   * @return {boolean}\n   */\n  isEqualTo(transformToCompare: Transform, precision: number = 8): boolean {\n    // if (transformToCompare.order.length !== this.order.length) {\n    //   return false;\n    // }\n    if (!this.isSimilarTo(transformToCompare)) {\n      return false;\n    }\n    for (let i = 0; i < this.order.length; i += 1) {\n      const compare = transformToCompare.order[i];\n      const thisTrans = this.order[i];\n      if (thisTrans.constructor.name !== compare.constructor.name) {\n        return false;\n      }\n      if ((thisTrans instanceof Translation && compare instanceof Translation\n      ) || (\n        thisTrans instanceof Scale && compare instanceof Scale\n      )) {\n        if (compare.isNotEqualTo(thisTrans, precision)) {\n          return false;\n        }\n      }\n      if (thisTrans instanceof Rotation) {  // $FlowFixMe\n        if (roundNum(compare.r, precision) !== roundNum(thisTrans.r, precision)) {\n          return false;\n        }\n      }\n    }\n    return true;\n  }\n\n  /**\n   * `true` if `transformToCompare` is wihtin some `delta` of this transform.\n   * `isEqualTo` rounds the values to some precision to compare values. In\n   * comparison this will directly compare the delta between values. This may\n   * be more useful than rounding when values are close to rounding thresholds.\n   * @return {boolean}\n   */\n  isWithinDelta(transformToCompare: Transform, delta: number = 0.00000001) {\n    if (!this.isSimilarTo(transformToCompare)) {\n      return false;\n    }\n    for (let i = 0; i < this.order.length; i += 1) {\n      const compare = transformToCompare.order[i];\n      const thisTrans = this.order[i];\n      if (thisTrans.constructor.name !== compare.constructor.name) {\n        return false;\n      }\n      if ((thisTrans instanceof Translation && compare instanceof Translation\n      ) || (\n        thisTrans instanceof Scale && compare instanceof Scale\n      )) {\n        if (compare.isNotWithinDelta(thisTrans, delta)) {\n          return false;\n        }\n      }\n      if (thisTrans instanceof Rotation) {  // $FlowFixMe\n        const dR = Math.abs(compare.r - thisTrans.r);\n        if (dR > delta) {\n          return false;\n        }\n      }\n    }\n    return true;\n  }\n\n  // Subtract a transform from the current one.\n  // If the two transforms have different order types, then just return\n  // the current transform.\n  /**\n   * Subtract each chain element in `transformToSubtract` from each chain\n   * element in this transform chain. Both transform\n   * chains must be similar and have the same order of {@link Rotation},\n   * {@link Scale} and {@link Translation} transform elements\n   * @see <a href=\"#transformissimilarto\">Transform.isSimilarTo</a>\n   */\n  sub(transformToSubtract: Transform = new Transform()): Transform {\n    if (!this.isSimilarTo(transformToSubtract)) {\n      return new Transform(this.order, this.name);\n    }\n    const order = [];\n    for (let i = 0; i < this.order.length; i += 1) {\n      // $FlowFixMe (this is already fixed in isSimilarTo check above)\n      order.push(this.order[i].sub(transformToSubtract.order[i]));\n    }\n    return new Transform(order, this.name);\n  }\n\n  // Add a transform to the current one.\n  // If the two transforms have different order types, then just return\n  // the current transform.\n  /**\n   * Add each chain element in `transformToSubtract` to each chain\n   * element in this transform chain. Both transform\n   * chains must be similar and have the same order of {@link Rotation},\n   * {@link Scale} and {@link Translation} transform elements\n   * @see <a href=\"#transformissimilarto\">Transform.isSimilarTo</a>\n   */\n  add(transformToAdd: Transform = new Transform()): Transform {\n    if (!this.isSimilarTo(transformToAdd)) {\n      return new Transform(this.order, this.name);\n    }\n    const order = [];\n    for (let i = 0; i < this.order.length; i += 1) {\n      // $FlowFixMe (this is already fixed in isSimilarTo check above)\n      order.push(this.order[i].add(transformToAdd.order[i]));\n    }\n    return new Transform(order, this.name);\n  }\n\n  // transform step wise multiplication\n  /**\n   * Multiply each chain element in `transformToSubtract` with each chain\n   * element in this transform chain. Both transform\n   * chains must be similar and have the same order of {@link Rotation},\n   * {@link Scale} and {@link Translation} transform elements\n   * @see <a href=\"#transformissimilarto\">Transform.isSimilarTo</a>\n   */\n  mul(transformToMul: Transform = new Transform()): Transform {\n    if (!this.isSimilarTo(transformToMul)) {\n      return new Transform(this.order, this.name);\n    }\n    const order = [];\n    for (let i = 0; i < this.order.length; i += 1) {\n      // $FlowFixMe (this is already fixed in isSimilarTo check above)\n      order.push(this.order[i].mul(transformToMul.order[i]));\n    }\n    return new Transform(order, this.name);\n  }\n\n  /**\n   * Return a transform chain whose order is `initialTransform` and then this\n   * transform chain\n   * @return {Transform}\n   * @example\n   * // rotate and then translate\n   * const rotation = new Transform().rotate(Math.PI / 2);\n   * const translation = new Transform().translate(0.5, 0);\n   * const t = translation.transform(rotation)\n   */\n  transform(initialTransform: Transform) {\n    const t = new Transform([], this.name);\n    t.order = initialTransform.order.concat(this.order);\n    t.mat = m2.mul(this.matrix(), initialTransform.matrix());\n    return t;\n  }\n\n  /**\n   * Return a transform chain whose order is this transform chain, then the\n   * `t` chain.\n   * @return {Transform}\n   * @example\n   * // rotate and then translate\n   * const rotation = new Transform().rotate(Math.PI / 2);\n   * const translation = new Transform().translate(0.5, 0);\n   * const t = rotation.transformBy(translation)\n   */\n  transformBy(t: Transform): Transform {\n    const t1 = new Transform([], this.name);\n    t1.order = this.order.concat(t.order);\n    t1.mat = m2.mul(t.matrix(), this.matrix());\n    return t1;\n  }\n\n  /**\n   * Return a duplicate transform with all values rounded\n   */\n  round(precision: number = 8): Transform {\n    const order = [];\n    for (let i = 0; i < this.order.length; i += 1) {\n      order.push(this.order[i].round(precision));\n    }\n    return new Transform(order, this.name);\n  }\n\n  /**\n   * Return a duplicate transform that is clipped to `minTransform` and\n   * `maxTransform`. Both `minTransform` and `maxTransform` must be similar\n   * to this transform meaning they must all share the same order of\n   * {@link Rotation}, {@link Scale} and {@link Translation} transform elements.\n   *\n   * Use `limitLine` to clip the first {@link Translation} transform in the\n   * chain to within a {@link Line}.\n   * @see <a href=\"#transformissimilarto\">Transform.isSimilarTo</a>\n   */\n  clip(\n    minTransform: Transform,\n    maxTransform: Transform,\n    limitLine: null | Line,\n  ) {\n    if (!this.isSimilarTo(minTransform) || !this.isSimilarTo(maxTransform)) {\n      return this._dup();\n    }\n    const order = [];\n    for (let i = 0; i < this.order.length; i += 1) {\n      const t = this.order[i];\n      const min = minTransform.order[i];\n      const max = maxTransform.order[i];\n      if (t instanceof Translation\n          && min instanceof Translation\n          && max instanceof Translation) {\n        const x = clipValue(t.x, min.x, max.x);\n        const y = clipValue(t.y, min.y, max.y);\n        order.push(new Translation(x, y, this.name));\n      } else if (t instanceof Rotation\n                 && min instanceof Rotation\n                 && max instanceof Rotation) {\n        order.push(new Rotation(clipValue(t.r, min.r, max.r), this.name));\n      } else if (t instanceof Scale\n                 && min instanceof Scale\n                 && max instanceof Scale) {\n        const x = clipValue(t.x, min.x, max.x);\n        const y = clipValue(t.y, min.y, max.y);\n        order.push(new Scale(x, y, this.name));\n      }\n    }\n\n    const clippedTransform = new Transform(order, this.name);\n    if (limitLine != null) {\n      const t = clippedTransform.t();\n      if (t != null) {\n        const perpLine = new Line(t, 1, limitLine.angle() + Math.PI / 2);\n        const { intersect } = perpLine.intersectsWith(limitLine);\n        if (intersect) {\n          if (intersect.isWithinLine(limitLine, 4)) {\n            clippedTransform.updateTranslation(intersect);\n          } else {\n            const p1Dist = distance(intersect, limitLine.p1);\n            const p2Dist = distance(intersect, limitLine.p2);\n            if (p1Dist < p2Dist) {\n              clippedTransform.updateTranslation(limitLine.p1);\n            } else {\n              clippedTransform.updateTranslation(limitLine.p2);\n            }\n          }\n        }\n      }\n    }\n    return clippedTransform;\n  }\n\n  clipMag(\n    zeroThresholdTransform: TypeTransformValue,\n    maxTransform: TypeTransformValue,\n    vector: boolean = true,\n  ): Transform {\n    // const min = 0.00001;\n    // const max = 1 / min;\n    // const zeroS = zeroThresholdTransform.s() || new Point(min, min);\n    // const zeroR = zeroThresholdTransform.r() || min;\n    // const zeroT = zeroThresholdTransform.t() || new Point(min, min);\n    // const maxS = maxTransform.s() || new Point(max, max);\n    // const maxR = maxTransform.r() || max;\n    // const maxT = maxTransform.t() || new Point(max, max);\n    // if (!this.isSimilarTo(zeroThresholdTransform) ||\n    //     !this.isSimilarTo(maxTransform)) {\n    //   return new Transform(this.order);\n    // }\n    const order = [];\n    const z = transformValueToArray(zeroThresholdTransform, this);\n    // const max = maxTransform;\n    const max = transformValueToArray(maxTransform, this);\n\n    for (let i = 0; i < this.order.length; i += 1) {\n      const t = this.order[i];\n      if (t instanceof Translation) {\n        if (vector) {\n          const { mag, angle } = t.toPolar();\n          const clipM = clipMag(mag, z[i], max[i]);\n          order.push(new Translation(\n            clipM * Math.cos(angle),\n            clipM * Math.sin(angle),\n            this.name,\n          ));\n        } else {\n          const x = clipMag(t.x, z[i], max[i]);\n          const y = clipMag(t.y, z[i], max[i]);\n          order.push(new Translation(x, y, this.name));\n        }\n      } else if (t instanceof Rotation) {\n        const r = clipMag(t.r, z[i], max[i]);\n        order.push(new Rotation(r, this.name));\n      } else if (t instanceof Scale) {\n        const x = clipMag(t.x, z[i], max[i]);\n        const y = clipMag(t.y, z[i], max[i]);\n        order.push(new Scale(x, y, this.name));\n      }\n    }\n    return new Transform(order, this.name);\n  }\n\n  constant(constant: number = 0): Transform {\n    const order = [];\n    for (let i = 0; i < this.order.length; i += 1) {\n      const t = this.order[i];\n      if (t instanceof Translation) {\n        order.push(new Translation(constant, constant, this.name));\n      } else if (t instanceof Rotation) {\n        order.push(new Rotation(constant, this.name));\n      } else if (t instanceof Scale) {\n        order.push(new Scale(constant, constant, this.name));\n      }\n    }\n    return new Transform(order, this.name);\n  }\n\n  zero(): Transform {\n    return this.constant(0);\n  }\n\n  /**\n   * `true` if all transforms within the transform chain are below the\n   * `zeroThreshold`\n   */\n  isZero(zeroThreshold: number = 0): boolean {\n    for (let i = 0; i < this.order.length; i += 1) {\n      const t = this.order[i];\n      if (t instanceof Translation || t instanceof Scale) {\n        if (Math.abs(t.x) > zeroThreshold || Math.abs(t.y) > zeroThreshold) {\n          return false;\n        }\n      } else if (t instanceof Rotation) {\n        if (clipAngle(t.r, '0to360') > zeroThreshold) {\n          return false;\n        }\n      }\n    }\n    return true;\n  }\n\n  /**\n   * Return a duplicate transform.\n   */\n  _dup(): Transform {\n    const t = new Transform(this.order, this.name);\n    t.index = this.index;\n    return t;\n  }\n\n  decelerate(\n    velocity: Transform,\n    decelerationIn: TypeTransformValue,\n    deltaTime: number | null,\n    boundsIn: TypeTransformBounds | TypeTransformBoundsDefinition | 'none',\n    bounceLossIn: TypeTransformValue,\n    zeroVelocityThresholdIn: TypeTransformValue,\n    precision: number = 8,\n  ): { velocity: Transform, transform: Transform, duration: number } {\n    const deceleration = transformValueToArray(decelerationIn, this);\n    const bounceLoss = transformValueToArray(bounceLossIn, this);\n    const zeroVelocityThreshold = transformValueToArray(zeroVelocityThresholdIn, this);\n    let bounds;\n    if (boundsIn instanceof TransformBounds) {\n      bounds = boundsIn;\n    } else if (boundsIn === 'none') {\n      bounds = new TransformBounds(this);\n    } else {\n      bounds = new TransformBounds(this, boundsIn);\n    }\n    // const bounds = getTransformBoundsLimit(boundsIn, this);\n    const result = decelerateTransform(\n      this, velocity, deceleration, deltaTime, bounds, bounceLoss, zeroVelocityThreshold, precision,\n    );\n    return {\n      velocity: result.velocity,\n      transform: result.transform,\n      duration: result.duration,\n    };\n  }\n\n  timeToZeroV(\n    velocity: Transform,\n    deceleration: TypeTransformValue,\n    bounds: TypeTransformBounds | TypeTransformBoundsDefinition,\n    bounceLoss: TypeTransformValue,\n    zeroVelocityThreshold: TypeTransformValue,\n    precision: number = 8,\n  ): { velocity: Transform, transform: Transform, duration: number } {\n    return this.decelerate(\n      velocity, deceleration, null, bounds, bounceLoss, zeroVelocityThreshold,\n      precision,\n    );\n  }\n\n  // Return the velocity of each element in the transform\n  // If the current and previous transforms are inconsistent in type order,\n  // then a transform of value 0, but with the same type order as \"this\" will\n  // be returned.\n  velocity(\n    previousTransform: Transform,\n    deltaTime: number,\n    zeroThreshold: TypeTransformValue,\n    maxTransform: TypeTransformValue,\n  ): Transform {\n    const order = [];\n    if (!this.isSimilarTo(previousTransform)) {\n      return this.zero();\n    }\n\n    const deltaTransform = this.sub(previousTransform);\n    for (let i = 0; i < deltaTransform.order.length; i += 1) {\n      const t = deltaTransform.order[i];\n      if (t instanceof Translation) {\n        order.push(new Translation(t.x / deltaTime, t.y / deltaTime));\n      } else if (t instanceof Rotation) {\n        order.push(new Rotation(t.r / deltaTime));\n      } else if (t instanceof Scale) {\n        order.push(new Scale(t.x / deltaTime, t.y / deltaTime));\n      }\n    }\n    const v = new Transform(order);\n\n    return v.clipMag(zeroThreshold, maxTransform);\n  }\n\n  /**\n   * Return a duplicate transform chain where all transforms are\n   * identity transforms.\n   */\n  identity() {\n    const order = [];\n    for (let i = 0; i < this.order.length; i += 1) {\n      const t = this.order[i];\n      if (t instanceof Translation) {\n        order.push(new Translation(0, 0, this.name));\n      } else if (t instanceof Rotation) {\n        order.push(new Rotation(0, this.name));\n      } else if (t instanceof Scale) {\n        order.push(new Scale(1, 1, this.name));\n      }\n    }\n    return new Transform(order, this.name);\n  }\n}\n\nexport type TypeF1DefTransform = {\n  f1Type: 'tf',\n  state: Array<string | TypeF1DefTranslation | TypeF1DefRotation | TypeF1DefScale>,\n};\n\n/**\n * A {@link Transform} can be defined in several ways\n * As a Transform: new Transform()\n * As an array of ['s', number, number], ['r', number] and/or ['t', number, number] arrays\n * As a string representing the JSON of the array form\n }\n * @example\n * // t1, t2, and t3 are all the same when parsed by `getTransform`\n * t1 = new Transform().scale(1, 1).rotate(0).translate(2, 2);\n * t2 = [['s', 1, 1], ['r', 0], ['t', 2, 2]];\n * t3 = '[['s', 1, 1], ['r', 0], ['t', 2, 2]]';\n */\nexport type TypeParsableTransform = Array<string | ['s', number, number] | ['r', number] | ['t', number, number]> | string | Transform | TypeF1DefTransform;\n\nfunction parseTransform<T>(inTransform: TypeParsableTransform, onFail: T): Transform | T | null {\n  if (inTransform instanceof Transform) {\n    return inTransform;\n  }\n  let onFailToUse = onFail;\n  if (onFailToUse == null) {\n    onFailToUse = null;\n  }\n  if (inTransform == null) {\n    return onFailToUse;\n  }\n\n  let tToUse = inTransform;\n  if (typeof tToUse === 'string') {\n    try {\n      tToUse = JSON.parse(tToUse);\n    } catch {\n      return onFailToUse;\n    }\n  }\n\n  if (Array.isArray(tToUse)) {\n    let t = new Transform();\n    tToUse.forEach((transformElement) => {\n      if (typeof transformElement === 'string') {\n        t.name = transformElement;\n        return;\n      }\n      if (transformElement.length === 3) {\n        const [type, x, y] = transformElement;\n        if (type === 's') {\n          t = t.scale(x, y);\n        } else {\n          t = t.translate(x, y);\n        }\n        return;\n      }\n      const [type, value] = transformElement;\n      if (type === 's') {\n        t = t.scale(value, value);\n      } else if (type === 't') {\n        t = t.translate(value, value);\n      } else {\n        t = t.rotate(value);\n      }\n    });\n    return t;\n  }\n  const { f1Type, state } = tToUse;\n  if (\n    f1Type != null\n    && f1Type === 'tf'\n    && state != null\n    && Array.isArray(state)\n  ) {\n    let t = new Transform();\n    tToUse.state.forEach((transformElement) => {\n      if (typeof transformElement === 'string') {\n        t.name = transformElement;\n        return;\n      }\n      const teF1Type = transformElement.f1Type;\n      if (teF1Type != null) {\n        if (teF1Type === 's') {  // $FlowFixMe\n          t = t.scale(transformElement);\n        } else if (teF1Type === 't') {  // $FlowFixMe\n          t = t.translate(transformElement);\n        } else if (teF1Type === 'r') {  // $FlowFixMe\n          t = t.rotate(transformElement);\n        }\n      }\n    });\n    return t;\n  }\n  return onFailToUse;\n}\n\n/**\n * Convert a parsable transform definition to a {@link Transform}.\n * @param {TypeParsableTransform} t parsable transform definition\n * @return {Transform} transform object\n */\nfunction getTransform(t: TypeParsableTransform): Transform {\n  let parsedTransform = parseTransform(t);\n  if (parsedTransform == null) {\n    parsedTransform = new Transform();\n  }\n  return parsedTransform;\n}\n\n\nfunction spaceToSpaceTransform(\n  s1: {\n    x: {bottomLeft: number, width: number},\n    y: {bottomLeft: number, height: number}\n  },\n  s2: {\n    x: {bottomLeft: number, width: number},\n    y: {bottomLeft: number, height: number}\n  },\n  name: string = '',\n) {\n  const xScale = s2.x.width / s1.x.width;\n  const yScale = s2.y.height / s1.y.height;\n  const t = new Transform(name)\n    .scale(xScale, yScale)\n    .translate(\n      s2.x.bottomLeft - s1.x.bottomLeft * xScale,\n      s2.y.bottomLeft - s1.y.bottomLeft * yScale,\n    );\n  return t;\n}\n\nfunction spaceToSpaceScale(\n  s1: {\n    x: {bottomLeft: number, width: number},\n    y: {bottomLeft: number, height: number}\n  },\n  s2: {\n    x: {bottomLeft: number, width: number},\n    y: {bottomLeft: number, height: number}\n  },\n) {\n  const xScale = s2.x.width / s1.x.width;\n  const yScale = s2.y.height / s1.y.height;\n  return new Point(xScale, yScale);\n}\n\nfunction comparePoints(\n  p: Point,\n  currentMin: Point,\n  currentMax: Point,\n  firstPoint: boolean,\n) {\n  const min = new Point(0, 0);\n  const max = new Point(0, 0);\n  if (firstPoint) {\n    min.x = p.x;\n    min.y = p.y;\n    max.x = p.x;\n    max.y = p.y;\n  } else {\n    min.x = p.x < currentMin.x ? p.x : currentMin.x;\n    min.y = p.y < currentMin.y ? p.y : currentMin.y;\n    max.x = p.x > currentMax.x ? p.x : currentMax.x;\n    max.y = p.y > currentMax.y ? p.y : currentMax.y;\n  }\n  return { min, max };\n}\n\n/**\n * Polar coordinates to cartesian coordinates conversion\n *\n * @example\n * const polarToRect = Fig.polarToRect;\n * const p = polarToRect(Math.sqrt(2), Math.PI / 4);\n * console.log(p);\n * // Point {x: 1, y: 1)\n */\nfunction polarToRect(mag: number, angle: number) {\n  return new Point(\n    mag * Math.cos(angle),\n    mag * Math.sin(angle),\n  );\n}\n\n/**\n * Cartesian coordinates to polar coordinates conversion\n *\n * @example\n* const rectToPolar = Fig.rectToPolar;\n* const p = rectToPolar(0, 1);\n* console.log(p);\n* // {mag: 1, angle: 1.5707963267948966}\n */\nfunction rectToPolar(x: number | Point, y: number = 0) {\n  let rect;\n  if (typeof x === 'number') {\n    rect = new Point(x, y);\n  } else {\n    rect = x;\n  }\n  const mag = rect.distance();\n  let angle = Math.atan2(rect.y, rect.x);\n  if (angle < 0) {\n    angle += Math.PI * 2;\n  }\n  return {\n    mag,\n    angle,\n  };\n}\n\n/**\n * Buffer for rectangle, where `left`, `bottom`, `right` and `top` are\n * the buffer values for a rectangle's left, bottom, right and top sides\n * respectively.\n */\nexport type OBJ_Buffer = {\n  left: number,\n  bottom: number,\n  right: number,\n  top: number,\n};\n\n/**\n * Buffer for rectangle can be:\n *\n * - `number`: left, bottom, right, top buffer all the same\n * - [`number`, `number`]: left/right and bottom/top buffer values\n * - [`number`, `number`, `number`, `number`]: left, bottom, right,\n *   top buffer values\n * - `{ left? number, bottom?: number, right?: number, top?: number}`:\n *   object definition where default values are `0`.\n *\n * Can use {@link getBuffer} to convert the parsable buffer into\n */\nexport type TypeParsableBuffer = number\n  | [number, number]\n  | [number, number, number, number]\n  | {\n    left?: number,\n    right?: number,\n    top?: number,\n    bottom?: number,\n  };\n\n/**\n * Convert a parsable buffer into a buffer.\n * @return {OBJ_Buffer}\n */\nfunction getBuffer(buffer: TypeParsableBuffer): OBJ_Buffer {\n  let left;\n  let right;\n  let top;\n  let bottom;\n  if (typeof buffer === 'number') {\n    left = buffer;\n    right = buffer;\n    top = buffer;\n    bottom = buffer;\n  } else if (Array.isArray(buffer)) {\n    if (buffer.length === 2) {\n      [left, top] = buffer;\n      right = left;\n      bottom = top;\n    } else {\n      [left, bottom, right, top] = buffer;\n    }\n  } else {\n    const o = joinObjects({\n      left: 0,\n      right: 0,\n      top: 0,\n      bottom: 0,\n    }, buffer);\n    ({\n      left, right, top, bottom,\n    } = o);\n  }\n  return {\n    left, right, top, bottom,\n  };\n}\n\nfunction isBuffer(input: any) {\n  if (typeof input === 'number') {\n    return true;\n  }\n  if (Array.isArray(input)) {\n    if (\n      (input.length === 4 || input.length === 2)\n      && typeof input[0] === 'number'\n    ) {\n      return true;\n    }\n  } else {\n    return false;\n  }\n  if (typeof input === 'object') {\n    const keys = Object.keys(input);\n    if (keys.length > 4) {\n      return false;\n    }\n    for (let i = 0; i < keys.length; i += 1) {\n      const key = keys[i];\n      if (\n        key !== 'left'\n        && key !== 'right'\n        && key !== 'top'\n        && key !== 'bottom'\n      ) {\n        return false;\n      }\n    }\n    return true;\n  }\n  return false;\n}\n\nfunction getBoundingRect(\n  pointArrays: Array<Point> | Array<Array<Point>>,\n  buffer: TypeParsableBuffer = 0,\n) {\n  let firstPoint = true;\n  let result = { min: new Point(0, 0), max: new Point(0, 0) };\n\n  pointArrays.forEach((pointOrArray) => {\n    if (Array.isArray(pointOrArray)) {\n      pointOrArray.forEach((p) => {\n        result = comparePoints(p, result.min, result.max, firstPoint);\n        firstPoint = false;\n      });\n    } else {\n      result = comparePoints(pointOrArray, result.min, result.max, firstPoint);\n    }\n\n    firstPoint = false;\n  });\n  const {\n    left, right, top, bottom,\n  } = getBuffer(buffer);\n\n  return new Rect(\n    result.min.x - left,\n    result.min.y - bottom,\n    result.max.x - result.min.x + right + left,\n    result.max.y - result.min.y + top + bottom,\n  );\n}\n\nfunction getBoundingBorder(\n  pointArrays: Array<Point> | Array<Array<Point>>,\n  buffer: TypeParsableBuffer = 0,\n) {\n  const r = getBoundingRect(pointArrays, buffer);\n  return [\n    new Point(r.left, r.bottom),\n    new Point(r.right, r.bottom),\n    new Point(r.right, r.top),\n    new Point(r.left, r.top),\n  ];\n}\n\n// // Finds the min angle between three points\n// function threePointAngleMin(p2: Point, p1: Point, p3: Point) {\n//   const p12 = distance(p1, p2);\n//   const p13 = distance(p1, p3);\n//   const p23 = distance(p2, p3);\n//   return Math.acos((p12 ** 2 + p13 ** 2 - p23 ** 2) / (2 * p12 * p13));\n// }\n\n// Finds the angle between three points for p12 to p13 in the positive\n// angle direction\n\n/**\n * Returns the angle from the line (p1, p2) to the line (p1, p3) in the positive\n * rotation direction and normalized from 0 to Math.PI * 2.\n *\n * @example\n * const threePointAngle = Fig.threePointAngle;\n * const getPoint = Fig.getPoint;\n *\n * const p1 = threePointAngle(getPoint([1, 0]), getPoint([0, 0]), getPoint([0, 1]));\n * console.log(p1);\n * // 1.5707963267948966\n *\n * const p2 = threePointAngle(getPoint([0, 1]), getPoint([0, 0]), getPoint([1, 0]));\n * console.log(p2);\n * // 4.71238898038469\n */\nfunction threePointAngle(p2: Point, p1: Point, p3: Point) {\n  const r12 = p2.sub(p1);\n  const r13 = p3.sub(p1);\n  // const p12 = distance(p1, p2);\n  // const p13 = distance(p1, p3);\n  // const p23 = distance(p2, p3);\n  // const minAngle = Math.acos((p12 ** 2 + p13 ** 2 - p23 ** 2) / (2 * p12 * p13));\n  let angle12 = r12.toPolar().angle;\n  let angle13 = r13.toPolar().angle;\n  angle13 -= angle12;\n  angle12 = 0;\n  return clipAngle(angle13, '0to360');\n}\n\n/**\n * Returns the minimum angle from the line (p1, p2) to the line (p1, p3).\n *\n * @example\n * const threePointAngleMin = Fig.threePointAngleMin;\n * const getPoint = Fig.getPoint;\n *\n * const p1 = threePointAngleMin(getPoint([1, 0]), getPoint([0, 0]), getPoint([0, 1]));\n * console.log(p1);\n// 1.5707963267948966\n *\n * const p2 = threePointAngleMin(getPoint([0, 1]), getPoint([0, 0]), getPoint([1, 0]));\n * console.log(p2);\n * // -1.5707963267948966\n */\nfunction threePointAngleMin(p2: Point, p1: Point, p3: Point) {\n  const a12 = clipAngle(Math.atan2(p2.y - p1.y, p2.x - p1.x), '0to360');\n  const a13 = clipAngle(Math.atan2(p3.y - p1.y, p3.x - p1.x), '0to360');\n  let delta = a13 - a12;\n  if (delta > Math.PI) {\n    delta = -(Math.PI * 2 - delta);\n  } else if (delta < -Math.PI) {\n    delta = Math.PI * 2 + delta;\n  }\n  return delta;\n}\n\nfunction randomPoint(withinRect: Rect) {\n  const randPoint = rand2D(\n    withinRect.left,\n    withinRect.bottom,\n    withinRect.right,\n    withinRect.top,\n  );\n  return new Point(randPoint.x, randPoint.y);\n}\n\nfunction getMaxTimeFromVelocity(\n  startTransform: Transform,\n  stopTransform: Transform,\n  velocityTransform: Transform | number,\n  rotDirection: 0 | 1 | -1 | 2 = 0,\n) {\n  const deltaTransform = stopTransform.sub(startTransform);\n  let time = 0;\n  let velocityTransformToUse;\n  if (typeof velocityTransform === 'number') {\n    velocityTransformToUse = startTransform._dup().constant(velocityTransform);\n  } else {\n    velocityTransformToUse = velocityTransform;\n  }\n  deltaTransform.order.forEach((delta, index) => {\n    if (delta instanceof Translation || delta instanceof Scale) {\n      const v = velocityTransformToUse.order[index];\n      if (\n        (v instanceof Translation || v instanceof Scale)\n        && v.x !== 0\n        && v.y !== 0\n      ) {\n        const xTime = Math.abs(delta.x / v.x);\n        const yTime = Math.abs(delta.y / v.y);\n        time = xTime > time ? xTime : time;\n        time = yTime > time ? yTime : time;\n      }\n    }\n    const start = startTransform.order[index];\n    const target = stopTransform.order[index];\n    if (delta instanceof Rotation\n        && start instanceof Rotation\n        && target instanceof Rotation) {\n      const rotDiff = getDeltaAngle(start.r, target.r, rotDirection);\n      // eslint-disable-next-line no-param-reassign\n      delta.r = rotDiff;\n      const v = velocityTransformToUse.order[index];\n      if (v instanceof Rotation && v !== 0) {\n        const rTime = Math.abs(delta.r / v.r);\n        time = rTime > time ? rTime : time;\n      }\n    }\n  });\n  return time;\n}\n\nfunction getMoveTime(\n  startTransform: Transform | Array<Transform>,\n  stopTransform: Transform | Array<Transform>,\n  rotDirection: 0 | 1 | -1 | 2 = 0,\n  translationVelocity: Point = new Point(0.25, 0.25),   // 0.5 figure units/s\n  rotationVelocity: number = 2 * Math.PI / 6,    // 60/s\n  scaleVelocity: Point = new Point(1, 1),   // 100%/s\n) {\n  let startTransforms: Array<Transform>;\n  if (startTransform instanceof Transform) {\n    startTransforms = [startTransform];\n  } else {\n    startTransforms = startTransform;\n  }\n  let stopTransforms: Array<Transform>;\n  if (stopTransform instanceof Transform) {\n    stopTransforms = [stopTransform];\n  } else {\n    stopTransforms = stopTransform;\n  }\n  if (stopTransforms.length !== startTransforms.length) {\n    return 0;\n  }\n  let maxDuration = 0;\n  startTransforms.forEach((startT, index) => {\n    const stopT = stopTransforms[index];\n    const velocity = startT._dup();\n    for (let i = 0; i < velocity.order.length; i += 1) {\n      const v = velocity.order[i];\n      if (v instanceof Translation) {\n        v.x = translationVelocity.x;\n        v.y = translationVelocity.y;\n      } else if (v instanceof Rotation) {\n        v.r = rotationVelocity;\n      } else {\n        v.x = scaleVelocity.x;\n        v.y = scaleVelocity.y;\n      }\n    }\n    const time = getMaxTimeFromVelocity(\n      startT, stopT, velocity, rotDirection,\n    );\n    if (time > maxDuration) {\n      maxDuration = time;\n    }\n  });\n  return maxDuration;\n}\n\n\nfunction quadBezierPoints(p0: Point, p1: Point, p2: Point, sides: number) {\n  const step = 1 / sides;\n  if (sides === 0 || sides === 1 || sides === 2) {\n    return [p0, p1, p2];\n  }\n  const points = [];\n  for (let i = 0; i < sides + 1; i += 1) {\n    const t = 0 + i * step;\n    points.push(new Point(\n      (1 - t) ** 2 * p0.x + 2 * (1 - t) * t * p1.x + t * t * p2.x,\n      (1 - t) ** 2 * p0.y + 2 * (1 - t) * t * p1.y + t * t * p2.y,\n    ));\n  }\n  return points;\n}\n\nclass Bounds {\n  boundary: Object;\n  precision: number;\n  bounds: 'inside' | 'outside';\n\n  constructor(\n    boundary: Object,\n    bounds: 'inside' | 'outside' = 'inside',\n    precision: number = 8,\n  ) {\n    this.boundary = boundary;\n    this.bounds = bounds;\n    this.precision = precision;\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  _dup() {\n    return new Bounds();\n  }\n\n  // eslint-disable-next-line class-methods-use-this, no-unused-vars\n  _state(options: { precision: number }) {\n    return {\n      f1Type: 'bounds',\n      state: [\n      ],\n    };\n  }\n\n  // eslint-disable-next-line class-methods-use-this, no-unused-vars\n  contains(position: number | TypeParsablePoint) {\n    return true;\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  intersect(position: number | TypeParsablePoint, direction: number = 0) {\n    if (typeof position === 'number') {\n      return {\n        intersect: position,\n        distance: 0,\n        reflection: direction + Math.PI,\n      };\n    }\n    return {\n      intersect: getPoint(position),\n      distance: 0,\n      reflection: direction + Math.PI,\n    };\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  clip(position: number | TypeParsablePoint) {\n    if (typeof position === 'number') {\n      return position;\n    }\n    return getPoint(position);\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  // clipVelocity(velocity: TypeParsablePoint | number) {\n  //   if (typeof velocity === 'number') {\n  //     return velocity;\n  //   }\n  //   return getPoint(velocity);\n  // }\n}\n\n// class ValueBounds extends Bounds {\n//   boundary: ?number;\n// }\nexport type TypeRangeBoundsDefinition = {\n  min?: number | null,\n  max?: number | null,\n  precision?: number,\n  bounds?: 'inside' | 'outside',\n};\n\ntype TypeF1DefRangeBounds = {\n  f1Type: 'rangeBounds',\n  state: ['outside' | 'inside', number, number | null, number | null],\n};\n\nclass RangeBounds extends Bounds {\n  boundary: { min: number | null, max: number | null };\n\n  constructor(optionsIn: TypeRangeBoundsDefinition) {\n    const defaultOptions = {\n      bounds: 'inside',\n      precision: 8,\n      min: null,\n      max: null,\n    };\n    const options = joinObjects({}, defaultOptions, optionsIn);\n    const boundary = {\n      min: options.min,\n      max: options.max,\n    };\n    super(boundary, options.bounds, options.precision);\n  }\n\n  _dup() {\n    return new RangeBounds({\n      bounds: this.bounds,\n      precision: this.precision,\n      min: this.boundary.min,\n      max: this.boundary.max,\n    });\n  }\n\n  _state(options: { precision: number }) {\n    // const { precision } = options;\n    const precision = getPrecision(options);\n    return {\n      f1Type: 'rangeBounds',\n      state: [\n        this.bounds,\n        this.precision,\n        this.boundary.min != null ? roundNum(this.boundary.min, precision) : null,\n        this.boundary.max != null ? roundNum(this.boundary.max, precision) : null,\n      ],\n    };\n  }\n\n  contains(position: number | TypeParsablePoint) {\n    if (typeof position === 'number') {\n      const p = roundNum(position, this.precision);\n      if (\n        (\n          this.boundary.min == null\n          || p >= roundNum(this.boundary.min, this.precision)\n        )\n        && (\n          this.boundary.max == null\n          || p <= roundNum(this.boundary.max, this.precision)\n        )\n      ) {\n        return true;\n      }\n      return false;\n    }\n    const p = getPoint(position);\n    if (this.contains(p.x) && this.contains(p.y)) {\n      return true;\n    }\n    return false;\n    // const p = getPoint(position);\n    // if (\n    //   (this.boundary.min == null\n    //     || (p.x >= this.boundary.min && p.y >= this.boundary.min))\n    //   && (this.boundary.max == null\n    //     || (p.x <= this.boundary.max && p.y <= this.boundary.max))\n    // ) {\n    //   return true;\n    // }\n    // return false;\n  }\n\n  intersect(\n    position: number | TypeParsablePoint,\n    direction: number = 1,\n  ) {\n    const reflection = direction * -1;\n    const { min, max } = this.boundary;\n    if (!(typeof position === 'number')) {\n      return {\n        intersect: null,\n        distance: 0,\n        reflection: direction,\n      };\n    }\n\n    if (this.contains(position)) {\n      if (\n        max != null\n        && round(position, this.precision) === round(max, this.precision)\n        && this.bounds === 'outside'\n      ) {\n        if (direction === -1) {\n          return { intersect: max, distance: 0, reflection: 1 };\n        }\n        return { intersect: null, distance: 0, reflection: 1 };\n      }\n      if (\n        min != null\n        && round(position, this.precision) === round(min, this.precision)\n        && this.bounds === 'outside'\n      ) {\n        if (direction === 1) {\n          return { intersect: min, distance: 0, reflection: -1 };\n        }\n        return { intersect: null, distance: 0, reflection: -1 };\n      }\n      if (direction === 1) {\n        if (max == null) {\n          return { intersect: null, distance: 0, reflection: direction };\n        }\n        return {\n          intersect: max,\n          distance: Math.abs(position - max),\n          reflection: -1,\n        };\n      }\n      if (min == null) {\n        return { intersect: null, distance: 0, reflection: direction };\n      }\n      return {\n        intersect: min,\n        distance: Math.abs(position - min),\n        reflection: 1,\n      };\n    }\n    if (\n      min != null\n      && position < min\n      && direction === 1\n    ) {\n      return {\n        intersect: min,\n        distance: Math.abs(position - min),\n        reflection,\n      };\n    }\n    if (\n      max != null\n      && position > max\n      && direction === -1\n    ) {\n      return {\n        intersect: max,\n        distance: Math.abs(position - max),\n        reflection,\n      };\n    }\n    return {\n      intersect: null,\n      distance: 0,\n      reflection: direction,\n    };\n  }\n\n  clip(position: number | TypeParsablePoint) {\n    if (typeof position === 'number') {\n      return clipValue(position, this.boundary.min, this.boundary.max);\n    }\n    const p = getPoint(position);\n    const clipped = p._dup();\n    clipped.x = clipValue(p.x, this.boundary.min, this.boundary.max);\n    clipped.y = clipValue(p.y, this.boundary.min, this.boundary.max);\n    return clipped;\n  }\n}\n\nexport type TypeRectBoundsDefinition = {\n  left?: number | null,\n  bottom?: number | null,\n  right?: number | null,\n  top?: number | null,\n  bounds?: 'inside' | 'outside',\n  precision?: number,\n} | Rect;\n\n\nexport type TypeF1DefRectBounds = {\n  f1Type: 'rectBounds',\n  state: ['outside' | 'inside', number, number | null, number | null, number | null, number | null],\n};\n\nclass RectBounds extends Bounds {\n  boundary: {\n    left: null | number,\n    right: null | number,\n    bottom: null | number,\n    top: null | number,\n  };\n\n  constructor(optionsOrRect: TypeRectBoundsDefinition) {\n    const defaultOptions = {\n      left: null,\n      right: null,\n      top: null,\n      bottom: null,\n      bounds: 'inside',\n      precision: 8,\n    };\n\n    const options = joinObjects({}, defaultOptions, optionsOrRect);\n\n    const boundary = {\n      left: options.left,\n      right: options.right,\n      top: options.top,\n      bottom: options.bottom,\n    };\n    super(boundary, options.bounds, options.precision);\n  }\n\n  _dup() {\n    return new RectBounds({\n      bounds: this.bounds,\n      precision: this.precision,\n      left: this.boundary.left,\n      right: this.boundary.right,\n      top: this.boundary.top,\n      bottom: this.boundary.bottom,\n    });\n  }\n\n  _state(options: { precision: number }) {\n    // const { precision } = options;\n    const precision = getPrecision(options);\n    return {\n      f1Type: 'rectBounds',\n      state: [\n        this.bounds,\n        this.precision,\n        this.boundary.left != null ? roundNum(this.boundary.left, precision) : null,\n        this.boundary.bottom != null ? roundNum(this.boundary.bottom, precision) : null,\n        this.boundary.right != null ? roundNum(this.boundary.right, precision) : null,\n        this.boundary.top != null ? roundNum(this.boundary.top, precision) : null,\n      ],\n    };\n  }\n\n  contains(position: number | TypeParsablePoint) {\n    if (typeof position === 'number') {\n      return false;\n    }\n    const p = getPoint(position).round(this.precision);\n    if (this.boundary.left != null && p.x < roundNum(this.boundary.left, this.precision)) {\n      return false;\n    }\n    if (this.boundary.right != null && p.x > roundNum(this.boundary.right, this.precision)) {\n      return false;\n    }\n    if (this.boundary.bottom != null && p.y < roundNum(this.boundary.bottom, this.precision)) {\n      return false;\n    }\n    if (this.boundary.top != null && p.y > roundNum(this.boundary.top, this.precision)) {\n      return false;\n    }\n    return true;\n  }\n\n  clip(position: number | TypeParsablePoint) {\n    if (typeof position === 'number') {\n      return position;\n    }\n    const clipped = getPoint(position);\n    if (this.boundary.left != null && clipped.x < this.boundary.left) {\n      clipped.x = this.boundary.left;\n    }\n    if (this.boundary.right != null && clipped.x > this.boundary.right) {\n      clipped.x = this.boundary.right;\n    }\n    if (this.boundary.bottom != null && clipped.y < this.boundary.bottom) {\n      clipped.y = this.boundary.bottom;\n    }\n    if (this.boundary.top != null && clipped.y > this.boundary.top) {\n      clipped.y = this.boundary.top;\n    }\n    return clipped;\n  }\n\n  intersect(position: number | TypeParsablePoint, direction: number = 0) {\n    if (typeof position === 'number') {\n      return {\n        intersect: null,\n        distance: 0,\n        reflection: direction,\n      };\n    }\n    const a = roundNum(clipAngle(direction, '0to360'), this.precision);\n    const pi = roundNum(Math.PI, this.precision);\n    const threePiOnTwo = roundNum(3 * Math.PI / 2, this.precision);\n    const piOnTwo = roundNum(Math.PI / 2, this.precision);\n    const p = getPoint(position);\n    const {\n      top, bottom, left, right,\n    } = this.boundary;\n\n    // let zeroHeight = false;\n    // if (\n    //   top != null && bottom != null\n    //   && roundNum(top, this.precision) === roundNum(bottom, this.precision)\n    // ) {\n    //   zeroHeight = true;\n    // }\n    // let zeroWdith = false;\n    // if (\n    //   left != null && right != null\n    //   && roundNum(left, this.precision) === roundNum(right, this.precision)\n    // ) {\n    //   zeroWdith = true;\n    // }\n    const calcHBound = (h) => {\n      if (h != null) {\n        if (bottom != null && top != null) {\n          return new Line([h, bottom], [h, top]);\n        }\n        if (bottom == null && top != null) {\n          return new Line([h, top], null, -Math.PI / 2, 1);\n        }\n        if (bottom != null && top == null) {\n          return new Line([h, bottom], null, Math.PI / 2, 1);\n        }\n        if (bottom == null && top == null) {\n          return new Line([h, 0], null, Math.PI / 2, 0);\n        }\n      }\n      return null;\n    };\n    const calcVBound = (v) => {\n      if (v != null) {\n        if (left != null && right != null) {\n          return new Line([left, v], [right, v]);\n        }\n        if (left == null && right != null) {\n          return new Line([right, v], null, -Math.PI, 1);\n        }\n        if (left != null && right == null) {\n          return new Line([left, v], null, 0, 1);\n        }\n        if (left == null && right == null) {\n          return new Line([0, v], null, Math.PI, 0);\n        }\n      }\n      return null;\n    };\n\n    // Get the lines for each bound\n    const boundBottom = calcVBound(bottom);\n    const boundTop = calcVBound(top);\n    const boundLeft = calcHBound(left);\n    const boundRight = calcHBound(right);\n\n    // Get the closest boundary intersect\n    const trajectory = new Line(p, null, direction, 1);\n    const getIntersect = (boundLine: Line | null, id) => {\n      if (boundLine == null) {\n        return null;\n      }\n      if (boundLine.hasPointOn(p, this.precision)) {\n        return {\n          intersect: p._dup(),\n          distance: 0,\n          id,\n        };\n      }\n      const result = trajectory.intersectsWith(boundLine, this.precision);\n      if (result.withinLine && result.intersect != null) {\n        return {\n          intersect: result.intersect,\n          distance: round(p.distance(result.intersect), this.precision),\n          id,\n        };\n      }\n      return null;\n    };\n\n    const bottomIntersect = getIntersect(boundBottom, 'bottom');\n    const topIntersect = getIntersect(boundTop, 'top');\n    const leftIntersect = getIntersect(boundLeft, 'left');\n    const rightIntersect = getIntersect(boundRight, 'right');\n\n    const getClosestIntersect = (intersect1, intersect2) => {\n      let closestIntersect = null;\n      if (intersect1 != null && intersect2 != null) {\n        if (intersect1.distance === 0 && this.bounds === 'inside') {\n          closestIntersect = intersect2;\n        } else if (intersect2.distance === 0 && this.bounds === 'inside') {\n          closestIntersect = intersect1;\n        } else if (intersect1.distance < intersect2.distance) {\n          closestIntersect = intersect1;\n        } else {\n          closestIntersect = intersect2;\n        }\n      } else if (intersect1 != null) {\n        closestIntersect = intersect1;\n      } else if (intersect2 != null) {\n        closestIntersect = intersect2;\n      }\n      return closestIntersect;\n    };\n\n    const vIntersect = getClosestIntersect(bottomIntersect, topIntersect);\n    const hIntersect = getClosestIntersect(leftIntersect, rightIntersect);\n\n    let intersects = [];\n    if (\n      vIntersect != null\n      && hIntersect != null\n      && vIntersect.distance === hIntersect.distance\n    ) {\n      intersects = [vIntersect, hIntersect];\n    } else {\n      const result = getClosestIntersect(vIntersect, hIntersect);\n      if (result != null) {\n        intersects = [result];\n      }\n    }\n\n    if (intersects.length === 0) {\n      return { intersect: null, distance: 0, reflection: direction };\n    }\n\n    let i;\n    let d = 0;\n    let xMirror = 1;\n    let yMirror = 1;\n    intersects.forEach((intersect) => {\n      if (intersect.id === 'left' || intersect.id === 'right') {\n        xMirror = -1;\n      } else {\n        yMirror = -1;\n      }\n      i = intersect.intersect;\n      d = intersect.distance;\n    });\n    const reflection = polarToRect(1, direction);\n    if (xMirror === -1) {\n      reflection.x *= -1;\n    }\n    if (yMirror === -1) {\n      reflection.y *= -1;\n    }\n\n    if (d === 0) {\n      i = p;\n    }\n\n    let r = rectToPolar(reflection).angle;\n    let noIntersect = false;\n\n    // Test for if the point is on the border, trajectory is along the border\n    // and the cross bound is null\n    if (d === 0 && this.bounds === 'inside' && intersects.length === 1) {\n      if (\n        (intersects[0].id === 'bottom' || intersects[0].id === 'top')\n        && (this.boundary.left == null || this.boundary.right == null)\n        && (a === 0 || a === pi)\n      ) {\n        noIntersect = true;\n      }\n      if (\n        (intersects[0].id === 'right' || intersects[0].id === 'left')\n        && (this.boundary.top == null || this.boundary.bottom == null)\n        && (a === piOnTwo || a === threePiOnTwo)\n      ) {\n        noIntersect = true;\n      }\n      if (\n        intersects[0].id === 'right'\n        && (this.boundary.left == null)\n        && (a === pi)\n      ) {\n        noIntersect = true;\n      }\n      if (\n        intersects[0].id === 'left'\n        && (this.boundary.right == null)\n        && (a === 0)\n      ) {\n        noIntersect = true;\n      }\n      if (\n        intersects[0].id === 'top'\n        && (this.boundary.bottom == null)\n        && (a === threePiOnTwo)\n      ) {\n        noIntersect = true;\n      }\n      if (\n        intersects[0].id === 'bottom'\n        && (this.boundary.top == null)\n        && (a === piOnTwo)\n      ) {\n        noIntersect = true;\n      }\n    }\n\n    if (d === 0 && this.bounds === 'inside' && intersects.length === 2) {\n      if (\n        intersects[0].id === 'bottom'\n        && intersects[1].id === 'left'\n        && this.boundary.right == null\n        && a === 0\n      ) {\n        noIntersect = true;\n      }\n      if (\n        intersects[0].id === 'bottom'\n        && intersects[1].id === 'left'\n        && this.boundary.top == null\n        && a === piOnTwo\n      ) {\n        noIntersect = true;\n      }\n      if (\n        intersects[0].id === 'top'\n        && intersects[1].id === 'left'\n        && this.boundary.right == null\n        && a === 0\n      ) {\n        noIntersect = true;\n      }\n      if (\n        intersects[0].id === 'top'\n        && intersects[1].id === 'left'\n        && this.boundary.bottom == null\n        && a === threePiOnTwo\n      ) {\n        noIntersect = true;\n      }\n      if (\n        intersects[0].id === 'top'\n        && intersects[1].id === 'right'\n        && this.boundary.left == null\n        && a === pi\n      ) {\n        noIntersect = true;\n      }\n      if (\n        intersects[0].id === 'top'\n        && intersects[1].id === 'right'\n        && this.boundary.bottom == null\n        && a === threePiOnTwo\n      ) {\n        noIntersect = true;\n      }\n      if (\n        intersects[0].id === 'bottom'\n        && intersects[1].id === 'right'\n        && this.boundary.left == null\n        && a === pi\n      ) {\n        noIntersect = true;\n      }\n      if (\n        intersects[0].id === 'bottom'\n        && intersects[1].id === 'right'\n        && this.boundary.top == null\n        && a === piOnTwo\n      ) {\n        noIntersect = true;\n      }\n    }\n\n    // Test for if the point is on the border, bounds is outside, and the\n    // trajectory is away from the border\n    if (d === 0 && this.bounds === 'outside' && intersects.length === 2) {\n      if (\n        intersects[0].id === 'bottom'\n        && intersects[1].id === 'left'\n        && (a >= piOnTwo || a === 0)\n      ) {\n        noIntersect = true;\n      }\n      if (\n        intersects[0].id === 'top'\n        && intersects[1].id === 'left'\n        && a >= 0 && a <= threePiOnTwo\n      ) {\n        noIntersect = true;\n      }\n\n      if (\n        intersects[0].id === 'top'\n        && intersects[1].id === 'right'\n        && (a <= pi || a >= threePiOnTwo)\n      ) {\n        noIntersect = true;\n      }\n      if (\n        intersects[0].id === 'bottom'\n        && intersects[1].id === 'right'\n        && (a <= piOnTwo || a >= pi)\n      ) {\n        noIntersect = true;\n      }\n    }\n    if (d === 0 && this.bounds === 'outside' && intersects.length === 1) {\n      const [intersect] = intersects;\n      if (\n        intersect.id === 'left'\n        && a >= piOnTwo && a <= threePiOnTwo\n      ) {\n        noIntersect = true;\n      }\n      if (\n        intersect.id === 'right'\n        && (a <= piOnTwo || a >= threePiOnTwo)\n      ) {\n        noIntersect = true;\n      }\n      if (\n        intersect.id === 'bottom'\n        && (a >= pi || a === 0)\n      ) {\n        noIntersect = true;\n      }\n      if (\n        intersect.id === 'top'\n        && a <= pi\n      ) {\n        noIntersect = true;\n      }\n    }\n    if (noIntersect) {\n      i = null;\n      r = direction;\n    }\n\n    return {\n      intersect: i,\n      distance: d,\n      reflection: r,\n    };\n  }\n}\n\nexport type TypeLineBoundsDefinition = {\n  p1?: TypeParsablePoint,\n  p2?: TypeParsablePoint,\n  line?: TypeParsableLine,\n  mag?: number,\n  angle?: number,\n  bounds?: 'inside' | 'outside',\n  ends?: 2 | 1 | 0,\n  precision?: number,\n};\n\nexport type TypeF1DefLineBounds = {\n  f1Type: 'lineBounds',\n  state: ['outside' | 'inside', number, number, number, number, number, 2 | 1 | 0],\n};\n\nclass LineBounds extends Bounds {\n  boundary: Line;\n\n  constructor(optionsIn: TypeLineBoundsDefinition) {\n    let boundary;\n    const defaultOptions = {\n      angle: 0,\n      mag: 1,\n      bounds: 'inside',\n      precision: 8,\n      ends: 2,\n    };\n    const options = joinObjects({}, defaultOptions, optionsIn);\n    if (options.line != null) {\n      boundary = getLine(options.line);\n    } else if (options.p1 != null && options.p2 != null) {\n      boundary = new Line(options.p1, options.p2, 0, options.ends);\n    } else if (options.p1 != null) {\n      boundary = new Line(options.p1, options.mag, options.angle, options.ends);\n    }\n    super(boundary, options.bounds, options.precision);\n  }\n\n  _dup() {\n    return new LineBounds({\n      bounds: this.bounds,\n      precision: this.precision,\n      p1: this.boundary.p1._dup(),\n      p2: this.boundary.p2._dup(),\n      mag: this.boundary.distance,\n      angle: this.boundary.ang,\n      ends: this.boundary.ends,\n    });\n  }\n\n  _state(options: { precision: number }) {\n    // const { precision } = options;\n    const precision = getPrecision(options);\n    return {\n      f1Type: 'lineBounds',\n      state: [\n        this.bounds,\n        this.precision,\n        roundNum(this.boundary.p1.x, precision),\n        roundNum(this.boundary.p1.y, precision),\n        roundNum(this.boundary.p2.x, precision),\n        roundNum(this.boundary.p2.y, precision),\n        this.boundary.ends,\n      ],\n    };\n  }\n\n  contains(position: number | TypeParsablePoint) {\n    if (typeof position === 'number') {\n      return false;\n    }\n    const p = getPoint(position);\n    return p.isWithinLine(this.boundary, this.precision);\n  }\n\n  clip(position: number | TypeParsablePoint) {\n    if (typeof position === 'number') {\n      return position;\n    }\n    const p = getPoint(position);\n    // if (window.asdf) {\n    //   console.log(position, p)\n    // }\n    return p.clipToLine(this.boundary, this.precision);\n  }\n\n  // The intersect of a Line Boundary can be its finite end points\n  //  - p1 only if 1 ended\n  //  - p1 or p2 if 2 ended\n  intersect(position: number | TypeParsablePoint, direction: number = 0) {\n    if (\n      typeof position === 'number'\n      || this.boundary.ends === 0   // Unbounded line will have no intersect\n    ) {\n      return {\n        intersect: null,\n        distance: 0,\n        reflection: direction,\n      };\n    }\n\n    // If the point is not along the line, then it is invalid\n    const p = getPoint(position);\n\n    if (!this.boundary.hasPointAlong(p, this.precision)) {\n      return {\n        intersect: null,\n        distance: 0,\n        reflection: direction,\n      };\n    }\n\n    let onLine = false;\n    if (this.boundary.hasPointOn(p, this.precision)) {\n      onLine = true;\n    }\n\n    const b = this.boundary;\n    const p1 = this.boundary.p1._dup();\n    const p2 = this.boundary.p2._dup();\n    const angleDelta = round(Math.abs(clipAngle(direction, '0to360') - clipAngle(b.ang, '0to360')), this.precision);\n\n    const d1 = p.distance(p1);\n    const d2 = p.distance(p2);\n\n    // If the point is on p1, unless it is inside and going towards p2 the\n    // result can be given immediately\n    if (p.isEqualTo(p1, this.precision)) {\n      if (this.bounds === 'inside' && angleDelta !== 0) {\n        return { intersect: p1, distance: 0, reflection: b.ang };\n      }\n      if (this.bounds === 'outside' && angleDelta !== 0) {\n        return { intersect: null, distance: 0, reflection: direction };\n      }\n      if (this.bounds === 'outside' && angleDelta === 0) {\n        return { intersect: p1, distance: 0, reflection: b.ang + Math.PI };\n      }\n    }\n\n    // If it is a one ended line, then only p1 is an intersect\n    if (b.ends === 1) {\n      if (\n        (onLine === true && angleDelta === 0)\n        || (onLine === false && angleDelta !== 0)\n      ) {\n        return { intersect: null, distance: 0, reflection: direction };\n      }\n      return { intersect: p1, distance: d1, reflection: direction + Math.PI };\n    }\n\n    // We are now left with a two ended line\n    // So if the point is on p2, then unless it is inside and going toward\n    // p1, the answer can be given now\n    if (p.isEqualTo(p2, this.precision)) {\n      if (this.bounds === 'inside' && angleDelta === 0) {\n        return { intersect: p2, distance: 0, reflection: b.ang + Math.PI };\n      }\n      if (this.bounds === 'outside' && angleDelta === 0) {\n        return { intersect: null, distance: 0, reflection: direction };\n      }\n      if (this.bounds === 'outside' && angleDelta !== 0) {\n        return { intersect: p2, distance: 0, reflection: b.ang };\n      }\n      // return { intersect: p2, distance: 0, reflection };\n    }\n\n    if (onLine && angleDelta === 0) {\n      return { intersect: p2, distance: d2, reflection: direction + Math.PI };\n    }\n\n    if (onLine) {\n      return { intersect: p1, distance: d1, reflection: direction + Math.PI };\n    }\n\n    // We now know the point is off a 2 ended line\n    let i;\n    let d;\n    if (d1 < d2 && angleDelta === 0) {\n      i = p1;\n      d = d1;\n    } else if (d2 < d1 && angleDelta !== 0) {\n      i = p2;\n      d = d2;\n    } else {\n      return { intersect: null, distance: 0, reflection: direction };\n    }\n    return { intersect: i, distance: d, reflection: direction + Math.PI };\n  }\n\n  clipVelocity(velocity: number | TypeParsablePoint) {\n    if (typeof velocity === 'number') {\n      return velocity;\n    }\n    if (this.boundary == null) {\n      return velocity;\n    }\n    const v = getPoint(velocity); // $FlowFixMe\n    const unitVector = new Vector(this.boundary).unit();\n    let projection = unitVector.dotProduct(new Vector([0, 0], v));\n    let { ang } = this.boundary;\n    if (projection < -1) {\n      ang += Math.PI;\n      projection = -projection;\n    }\n    return polarToRect(projection, ang);\n  }\n}\n\nexport type TypeBoundsDefinition = Bounds | null | TypeRectBoundsDefinition\n  | TypeLineBoundsDefinition | TypeRangeBoundsDefinition\n  | { type: 'rect', bounds: TypeRectBoundsDefinition }\n  | { type: 'range', bounds: TypeRangeBoundsDefinition }\n  | { type: 'line', bounds: TypeLineBoundsDefinition }\n  | TypeTransformBoundsDefinition\n  | { type: 'transform', bounds: TypeTransformBoundsDefinition }\n  | TypeF1DefRangeBounds | TypeF1DefRectBounds | TypeF1DefLineBounds;\n\nfunction getBounds(\n  bounds: TypeBoundsDefinition,\n  type: 'rect' | 'range' | 'line' | 'transform' | null = null,\n  transform: Transform = new Transform(),\n) {\n  if (bounds == null) {\n    return new Bounds();\n  }\n  if (bounds instanceof Bounds) {\n    return bounds;\n  }\n  if (bounds.type != null) {  // $FlowFixMe\n    return getBounds(bounds.bounds, bounds.type);\n  }\n  if (type === 'rect') {  // $FlowFixMe\n    return new RectBounds(bounds);\n  }\n  if (type === 'range') {  // $FlowFixMe\n    return new RangeBounds(bounds);\n  }\n  if (type === 'line') {  // $FlowFixMe\n    return new LineBounds(bounds);\n  }\n  if (type === 'transform') {  // $FlowFixMe\n    return new TransformBounds(transform, bounds);\n  }\n  if (bounds.min !== undefined || bounds.max !== undefined) {\n    return getBounds(bounds, 'range');\n  }\n  if (bounds instanceof Rect) {\n    return new RectBounds(bounds);\n  }\n  if (bounds instanceof Line) {\n    return new LineBounds({ line: bounds });\n  }\n  if (\n    bounds.left !== undefined\n    || bounds.right !== undefined\n    || bounds.top !== undefined\n    || bounds.bottom !== undefined\n  ) {\n    return getBounds(bounds, 'rect');\n  }\n  if (\n    bounds.line !== undefined\n    || bounds.p1 !== undefined\n    || bounds.p2 !== undefined\n    || bounds.angle !== undefined\n    || bounds.mag !== undefined\n    || bounds.ends !== undefined\n  ) {\n    return getBounds(bounds, 'line');\n  }\n  if (\n    bounds.translation !== undefined\n    || bounds.scale !== undefined\n    || bounds.rotation !== undefined\n  ) {\n    return getBounds(bounds, 'transform', transform);\n  }\n\n  if (bounds.f1Type !== undefined && bounds.state != null) {\n    const { f1Type, state } = bounds;\n    if (f1Type != null\n      && f1Type === 'rangeBounds'\n      && state != null\n      && Array.isArray([state])\n      && state.length === 4\n    ) { // $FlowFixMe\n      const [b, precision, min, max] = state;\n      return new RangeBounds({\n        bounds: b, precision, min, max,\n      });\n    }\n    if (f1Type != null\n      && f1Type === 'rectBounds'\n      && state != null\n      && Array.isArray([state])\n      && state.length === 6\n    ) { // $FlowFixMe\n      const [b, precision, left, bottom, right, top] = state;\n      return new RectBounds({\n        bounds: b, precision, left, bottom, right, top,\n      });\n    }\n    if (f1Type != null\n      && f1Type === 'lineBounds'\n      && state != null\n      && Array.isArray([state])\n      && state.length === 7\n    ) { // $FlowFixMe\n      const [b, precision, x, y, x2, y2, ends] = state;\n      return new LineBounds({\n        bounds: b,\n        precision,\n        p1: new Point(x, y),\n        p2: new Point(x2, y2),\n        ends,\n      });\n    }\n\n    if (f1Type != null\n      && f1Type === 'transformBounds'\n      && state != null\n      && Array.isArray([state])\n      && state.length === 3\n    ) { // $FlowFixMe\n      const [precision, order, boundsArray] = state;\n      const t = new TransformBounds(new Transform(), {}, precision);\n      t.order = order.slice();\n      const boundary = [];\n      boundsArray.forEach((b) => {\n        if (b == null) {\n          boundary.push(null);\n        } else {\n          boundary.push(getBounds(b));\n        }\n      });\n      t.boundary = boundary;\n      return t;\n    }\n  }\n  return null;\n}\n\n\nfunction transformValueToArray(\n  transformValue: TypeTransformValue,\n  transform: Transform,\n  // defaultTransformationValue: TypeTransformValue = {},\n): Array<number> {\n  if (Array.isArray(transformValue)) {\n    return transformValue;\n  }\n  const order = [];\n  // debugger;\n  if (typeof transformValue === 'number') {\n    for (let i = 0; i < transform.order.length; i += 1) {\n      order.push(transformValue);\n    }\n    return order;\n  }\n\n  for (let i = 0; i < transform.order.length; i += 1) {\n    const transformation = transform.order[i];\n    if (transformation instanceof Translation) {\n      let value = 0;\n      if (transformValue.position != null) {\n        value = transformValue.position;\n      }\n      if (transformValue.translation != null) {\n        value = transformValue.translation;\n      }\n      order.push(value);\n    } else if (transformation instanceof Scale) {\n      let value = 0;\n      if (transformValue.scale != null) {\n        value = transformValue.scale;\n      }\n      order.push(value);\n    } else if (transformation instanceof Rotation) {\n      let value = 0;\n      if (transformValue.rotation != null) {\n        value = transformValue.rotation;\n      }\n      order.push(value);\n    }\n  }\n  return order;\n}\n\n// bounds: null\n// bounds: { translation: [-1, -1, 2, 2], scale: [-1, 1], rotation: [-1, 1] }\n// bounds: 'figure',\n// bounds: new TransformBounds(transform, [null, null] | { translation: null })\n// bounds: [null, [-1, -1, 2, 2], null]\n// bounds: [null, [null, -1, null, 2], null]\n// bounds: TransformBounds | Rect | Array<number> | 'figure',\n\n// type TypeBoundsDefinition = null | ;\n\ntype TypeTranslationBoundsDefinition = Bounds\n                                       | TypeRectBoundsDefinition\n                                       | TypeLineBoundsDefinition\n                                       | TypeRangeBoundsDefinition;\ntype TypeRotationBoundsDefinition = Bounds | TypeRangeBoundsDefinition;\ntype TypeScaleBoundsDefinition = Bounds | TypeRangeBoundsDefinition | TypeRectBoundsDefinition;\n\nexport type TypeTransformBoundsDefinition = Array<Bounds | null> | {\n  position?: TypeTranslationBoundsDefinition;\n  translation?: TypeTranslationBoundsDefinition;\n  rotation?: TypeRotationBoundsDefinition;\n  scale?: TypeScaleBoundsDefinition;\n};\n\nexport type TypeF1DefTransformBounds = {\n  f1Type: 'transformBounds',\n  state: [number, Array<'s' | 'r' | 'r'>, Array<TypeF1DefLineBounds | TypeF1DefRectBounds | TypeF1DefRangeBounds>],\n};\n\nclass TransformBounds extends Bounds {\n  boundary: Array<Bounds | null>;\n  order: Array<'t' | 'r' | 's'>;\n\n  constructor(\n    transform: Transform,\n    bounds: TypeTransformBoundsDefinition = {},\n    precision: number = 8,\n  ) {\n    // let boundary = [];\n    const order = [];\n    for (let i = 0; i < transform.order.length; i += 1) {\n      const transformation = transform.order[i];\n      if (transformation instanceof Translation) {\n        order.push('t');\n      } else if (transformation instanceof Scale) {\n        order.push('s');\n      } else {\n        order.push('r');\n      }\n    }\n    super([], 'inside', precision);\n    this.order = order;\n    this.createBounds(bounds);\n  }\n\n  isUnbounded() {\n    for (let i = 0; i < this.boundary.length; i += 1) {\n      if (this.boundary[i] !== null) {\n        return false;\n      }\n    }\n    return true;\n  }\n\n  _dup() {\n    const t = new TransformBounds(new Transform(), {}, this.precision);\n    t.order = this.order.slice();\n    t.boundary = [];\n    this.boundary.forEach((b) => {\n      if (b == null) {\n        t.boundary.push(null);\n      } else {\n        t.boundary.push(b._dup());\n      }\n    });\n    return t;\n  }\n\n  _state(options: { precision: number }) {\n    // const { precision } = options;\n    const precision = getPrecision(options);\n    const bounds = [];\n    this.boundary.forEach((b) => {\n      if (b == null) {\n        bounds.push(null);\n      } else {\n        bounds.push(b._state({ precision }));\n      }\n    });\n    return {\n      f1Type: 'transformBounds',\n      state: [\n        this.precision,\n        this.order.slice(),\n        bounds,\n      ],\n    };\n  }\n\n  createBounds(\n    bounds: TypeTransformBoundsDefinition | Bounds | null,\n    index: number = 0,\n  ) {\n    if (bounds == null || bounds instanceof Bounds) {\n      this.boundary[index] = bounds;\n      return;\n    }\n    if (Array.isArray(bounds)) {\n      this.boundary = bounds;\n      return;\n    }\n    const boundary = [];\n    this.order.forEach((o) => {\n      let bound = null;\n      if (o === 't' && bounds.position != null) {\n        bound = getBounds(bounds.position);\n      }\n      if (o === 't' && bounds.translation != null) {\n        bound = getBounds(bounds.translation);\n      }\n      if (o === 'r' && bounds.rotation != null) {\n        bound = getBounds(bounds.rotation);\n      }\n      if (o === 's' && bounds.scale != null) {\n        bound = getBounds(bounds.scale);\n      }\n      boundary.push(bound);\n    });\n    this.boundary = boundary;\n  }\n\n  update(\n    type: 'r' | 's' | 't',\n    bound: TypeBoundsDefinition,\n    typeIndex: ?number = 0,\n  ) {\n    let index = 0;\n    for (let i = 0; i < this.order.length; i += 1) {\n      const o = this.order[i];\n      if (o === type) {\n        if (typeIndex == null || typeIndex === index) {\n          this.boundary[i] = getBounds(bound);\n        }\n        index += 1;\n      }\n      // if (o === type && (typeIndex == null || typeIndex === index)) {\n      //   this.boundary[i] = getBounds(bound);\n      //   index += 1;\n      // }\n    }\n  }\n\n  updateTranslation(\n    bound: Bounds | TypeTranslationBoundsDefinition,\n    translationIndex: ?number = 0,\n  ) {\n    let b = getBounds(bound);\n    if (b instanceof RangeBounds) {\n      b = new RectBounds({\n        left: b.boundary.min,\n        bottom: b.boundary.min,\n        top: b.boundary.max,\n        right: b.boundary.max,\n      });\n    }\n    this.update('t', b, translationIndex);\n  }\n\n  updateRotation(\n    bound: Bounds | TypeRotationBoundsDefinition,\n    translationIndex: ?number = 0,\n  ) {\n    this.update('r', bound, translationIndex);\n  }\n\n  updateScale(\n    bound: Bounds | TypeScaleBoundsDefinition,\n    translationIndex: ?number = 0,\n  ) {\n    this.update('s', bound, translationIndex);\n  }\n\n  getBound(type: 'r' | 's' | 't', index: number = 0) {\n    let typeIndex = 0;\n    for (let i = 0; i < this.order.length; i += 1) {\n      const o = this.order[i];\n      if (o === type) {\n        if (typeIndex === index) {\n          return this.boundary[i];\n        }\n        typeIndex += 1;\n      }\n    }\n    return null;\n  }\n\n  getTranslation(index: number = 0) {\n    return this.getBound('t', index);\n  }\n\n  getScale(index: number = 0) {\n    return this.getBound('s', index);\n  }\n\n  getRotation(index: number = 0) {\n    return this.getBound('r', index);\n  }\n\n  // $FlowFixMe\n  contains(t: Transform) {\n    for (let i = 0; i < t.order.length; i += 1) {\n      const transformElement = t.order[i];\n      const b = this.boundary[i];                       // $FlowFixMe\n      if (transformElement instanceof Rotation) {\n        if (b != null && !b.contains(transformElement.r)) {\n          return false;\n        }\n      } else if (b != null && !b.contains(new Point(transformElement.x, transformElement.y))) {\n        return false;\n      }\n    }\n    return true;\n  }\n\n  // $FlowFixMe\n  clip(t: Transform) {\n    const order = [];\n    for (let i = 0; i < t.order.length; i += 1) {\n      const transformElement = t.order[i];\n      const b = this.boundary[i];\n      if (b != null) {\n        let clipped;\n        if (transformElement instanceof Rotation) {\n          clipped = b.clip(transformElement.r);\n        } else {\n          clipped = b.clip(new Point(transformElement.x, transformElement.y));\n        }\n        let newElement;\n        if (transformElement instanceof Translation) {\n          newElement = new Translation(clipped.x, clipped.y, transformElement.name);\n        } else if (transformElement instanceof Scale) {\n          newElement = new Scale(clipped.x, clipped.y, transformElement.name);\n        } else {\n          newElement = new Rotation(clipped, transformElement.name);\n        }\n\n        // clipped.name = transformElement.name;\n        order.push(newElement);\n      } else {\n        order.push(transformElement._dup());\n      }\n    }\n    return new Transform(order, t.name);\n  }\n}\n\nfunction deceleratePoint(\n  positionIn: Point,\n  velocityIn: Point,\n  deceleration: number,\n  deltaTimeIn: number | null = null,\n  boundsIn: ?Bounds = null,  // ?(Rect | Line) = null,\n  bounceLossIn: number = 0,\n  zeroVelocityThreshold: number = 0,\n  precision: number = 8,\n): {\n  velocity: Point,\n  duration: number,\n  position: Point,\n} {\n  let bounds;\n  if (boundsIn instanceof RangeBounds) {\n    bounds = new RectBounds({\n      left: boundsIn.boundary.min,\n      right: boundsIn.boundary.max,\n      bottom: boundsIn.boundary.min,\n      top: boundsIn.boundary.max,\n    });\n  } else {\n    bounds = boundsIn;\n  }\n  // clip velocity to the dimension of interest\n  let velocity = velocityIn;    // $FlowFixMe\n  if (bounds != null && bounds.clipVelocity != null) {  // $FlowFixMe\n    velocity = bounds.clipVelocity(velocityIn);\n  }\n  // const velocity = velocityIn;\n\n  let stopFlag = false;\n  if (deltaTimeIn == null) {\n    stopFlag = true;\n  }\n\n  // Get the mag and angle of the velocity and check if under the zero threshold\n  const { mag, angle } = velocity.toPolar();\n  if (mag <= zeroVelocityThreshold) {\n    return {\n      velocity: new Point(0, 0),\n      position: positionIn,\n      duration: 0,\n    };\n  }\n\n  // Clip position in the bounds\n  let position = positionIn._dup();\n  if (bounds != null) {\n    position = bounds.clip(positionIn);\n    // try {\n    //   position = bounds.clip(positionIn);\n    // } catch(error) {\n    //   console.log('error', error)\n    //   console.log('error - data', positionIn)\n    //   console.log('error - data', bounds)\n    //   debugger;\n    // }\n  }\n\n  // Initial Velocity\n  const v0 = mag;\n  // Total change in velocity to go to zero threshold\n  const deltaV = Math.abs(v0) - zeroVelocityThreshold;\n\n  let deltaTime = deltaTimeIn;\n\n  if (deltaTime == null || deltaTime > Math.abs(deltaV / deceleration)) {\n    deltaTime = Math.abs(deltaV / deceleration);\n  }\n\n  // Calculate distance traveeled over time and so find the new Position\n  const distanceTravelled = v0 * deltaTime - 0.5 * deceleration * (deltaTime ** 2);\n  const newPosition = polarToRect(distanceTravelled, angle).add(position);\n\n  // If the new position is within the bounds, then can return the result.\n  if (bounds == null || bounds.contains(newPosition)) {\n    if (stopFlag) {\n      return {\n        duration: deltaTime,\n        position: newPosition,\n        velocity: new Point(0, 0),\n      };\n    }\n    let v1 = v0 - deceleration * deltaTime;\n    if (round(v1, precision) <= round(zeroVelocityThreshold, precision)) {\n      v1 = 0;\n    }\n    return {\n      position: newPosition,\n      velocity: polarToRect(v1, angle),\n      duration: deltaTime,\n    };\n  }\n\n  // if we got here, the new position is out of bounds\n  const bounceScaler = 1 - bounceLossIn;\n  // let result;\n  // try {\n  //   result = bounds.intersect(position, clipAngle(angle, '0to360'));\n  // } catch(error) {\n  //   console.log(error)\n  //   debugger;\n  // }\n  const result = bounds.intersect(position, clipAngle(angle, '0to360'));\n\n  // if newPosition is not contained within bounds, but the intersect distance\n  // is larger than the distance travelled in deltaTime, then there is likely a\n  // rounding error...\n  if (result.distance != null && result.distance > distanceTravelled) {\n    throw new Error('Error in calculating intersect');\n  }\n\n  let intersectPoint;\n  if (typeof result.intersect === 'number') {\n    intersectPoint = new Point(result.intersect, 0);\n  } else if (result.intersect == null) {\n    return {\n      position: newPosition,\n      velocity: new Point(0, 0),\n      duration: deltaTime,\n    };\n  } else {\n    intersectPoint = result.intersect;\n  }\n  // const intersectPoint = result.position;\n  const distanceToBound = result.distance;\n  const reflectionAngle = result.reflection;\n\n  // if (intersectPoint == null) {\n  //   return {\n  //     duration: timeToZeroV,\n  //     position: newPosition,\n  //   };\n  // }\n\n  // Calculate the time to the intersect point\n  const acc = -v0 / Math.abs(v0) * deceleration;\n  const s = distanceToBound;\n  const b = v0;\n  const a = 0.5 * acc;\n  const c = -s;\n  const t = (-b + Math.sqrt(b ** 2 - 4 * a * c)) / (2 * a);\n\n  // If there is no bounce (all energy is lost) then return the result\n  if (bounceLossIn === 1) {\n    return {\n      velocity: new Point(0, 0),\n      position: intersectPoint,\n      duration: t,\n    };\n  }\n\n  const velocityAtIntersect = v0 + acc * t; // (s - 0.5 * a * (t ** 2)) / t;\n  const bounceVelocity = velocityAtIntersect * bounceScaler;\n  const rectBounceVelocity = new Point(\n    bounceVelocity * Math.cos(reflectionAngle),\n    bounceVelocity * Math.sin(reflectionAngle),\n  );\n\n  if (stopFlag) {\n    const newStop = deceleratePoint(\n      intersectPoint, rectBounceVelocity, deceleration, deltaTimeIn,\n      bounds, bounceLossIn, zeroVelocityThreshold, precision,\n    );\n    return {\n      duration: t + newStop.duration,\n      position: newStop.position,\n      velocity: new Point(0, 0),\n    };\n  }\n  return deceleratePoint(\n    intersectPoint, rectBounceVelocity, deceleration, deltaTime - t, bounds,\n    bounceLossIn, zeroVelocityThreshold, precision,\n  );\n}\n\nfunction decelerateValue(\n  value: number,\n  velocity: number,\n  deceleration: number,\n  deltaTime: number | null = null,\n  boundsIn: ?RangeBounds = null,\n  bounceLoss: number = 0,\n  zeroVelocityThreshold: number = 0,\n  precision: number = 8,\n) {\n  let bounds = boundsIn;\n  if (boundsIn != null) {\n    // let { min, max } = boundsIn.boundary;\n    // if (min == null) {\n    // }\n    bounds = new LineBounds({\n      p1: [boundsIn.boundary.min != null ? boundsIn.boundary.min : 0, 0],\n      p2: [boundsIn.boundary.max != null ? boundsIn.boundary.max : 0, 0],\n    });\n  }\n  const result = deceleratePoint(\n    new Point(value, 0),\n    new Point(velocity, 0),\n    deceleration,\n    deltaTime,\n    bounds,\n    bounceLoss,\n    zeroVelocityThreshold,\n    precision,\n  );\n\n  return {\n    duration: result.duration,\n    value: result.position.x,\n    velocity: result.velocity.x,\n  };\n}\n\nfunction decelerateIndependantPoint(\n  value: Point,\n  velocity: Point,\n  deceleration: number,\n  deltaTime: number | null = null,\n  boundsIn: ?RectBounds = null,\n  bounceLoss: number = 0,\n  zeroVelocityThreshold: number = 0,\n  precision: number = 8,\n) {\n  let xBounds = null;\n  let yBounds = null;\n  if (boundsIn != null) {\n    xBounds = new RangeBounds({\n      min: boundsIn.boundary.left, max: boundsIn.boundary.right,\n    });\n    yBounds = new RangeBounds({\n      min: boundsIn.boundary.bottom, max: boundsIn.boundary.top,\n    });\n  }\n\n  const xResult = decelerateValue(\n    value.x, velocity.x, deceleration, deltaTime,\n    xBounds, bounceLoss, zeroVelocityThreshold, precision,\n  );\n  const yResult = decelerateValue(\n    value.y, velocity.y, deceleration, deltaTime,\n    yBounds, bounceLoss, zeroVelocityThreshold, precision,\n  );\n\n  return {\n    duration: Math.max(xResult.duration, yResult.duration),\n    point: new Point(xResult.value, yResult.value),\n    velocity: new Point(xResult.velocity, yResult.velocity),\n  };\n}\n\nexport type TypeTransformationValue = {\n  rotation?: number;\n  position?: number;\n  translation?: number;\n  scale?: number;\n}\n\n// type TypeTransformationBoundsDefinition = {\n//   rotation?: RangeBounds | TypeParsablePoint;\n//   position?: RectBounds | TypeParsableRect;\n//   translation?: RectBounds | TypeParsableRect;\n//   scale?: RectBounds | TypeParsablePoint;\n// }\n\ntype TypeTransformDeceleration = Array<number>;\ntype TypeTransformBounds = Array<Bounds | null>;\ntype TypeTransformZeroThreshold = Array<number>;\ntype TypeTransformBounce = Array<number>;\n\n\n// function getTransformBoundsLimit(\n//   boundsDefinition: TypeTransformLinkBoundsDefinition | TypeTransformBounds,\n//   transform: Transform,\n// ): TypeTransformBounds {\n//   if (Array.isArray(boundsDefinition)) {\n//     return boundsDefinition;\n//   }\n//   const order = [];\n//   for (let i = 0; i < transform.order.length; i += 1) {\n//     const transformation = transform.order[i];\n//     if (transformation instanceof Translation) {\n//       let position = null;\n//       if (boundsDefinition.position != null) {\n//         ({ position } = boundsDefinition);\n//       }\n//       if (boundsDefinition.translation != null) {\n//         position = boundsDefinition.translation;\n//       }\n//       order.push(position);\n//     } else if (transformation instanceof Scale) {\n//       let scale = null;\n//       if (boundsDefinition.scale != null) {\n//         ({ scale } = boundsDefinition);\n//       }\n//       order.push(scale);\n//     } else if (transformation instanceof Rotation) {\n//       let rotation = null;\n//       if (boundsDefinition.rotation != null) {\n//         ({ rotation } = boundsDefinition);\n//       }\n//       order.push(rotation);\n//     }\n//   }\n//   return order;\n// }\n\nfunction decelerateTransform(\n  transform: Transform,\n  velocity: Transform,\n  deceleration: TypeTransformDeceleration,\n  deltaTime: number | null,\n  boundsIn: TransformBounds | TypeTransformBoundsDefinition,\n  bounceLoss: TypeTransformBounce,\n  zeroVelocityThreshold: TypeTransformZeroThreshold,\n  precision: number = 8,\n) {\n  let duration = 0;\n  const newOrder = [];\n  const newVOrder = [];\n\n  let bounds;\n  if (boundsIn instanceof TransformBounds) {\n    bounds = boundsIn;\n  } else {\n    bounds = new TransformBounds(transform, boundsIn);\n  }\n  for (let i = 0; i < transform.order.length; i += 1) {\n    const transformation = transform.order[i];\n    let result;\n    let newTransformation;\n    let newVTransformation;\n    if (transformation instanceof Translation) {\n      result = deceleratePoint( // $FlowFixMe\n        transformation, velocity.order[i], deceleration[i], deltaTime,\n        bounds.boundary[i], bounceLoss[i], zeroVelocityThreshold[i],\n        precision,\n      );\n      newTransformation = new Translation(result.position.x, result.position.y);\n      newVTransformation = new Translation(result.velocity.x, result.velocity.y);\n    } else if (transformation instanceof Scale) {\n      result = decelerateIndependantPoint( // $FlowFixMe\n        transformation, velocity.order[i], deceleration[i], deltaTime, // $FlowFixMe\n        bounds.boundary[i], bounceLoss[i], zeroVelocityThreshold[i],\n        precision,\n      );\n      newTransformation = new Scale(result.point.x, result.point.y);\n      newVTransformation = new Scale(result.velocity.x, result.velocity.y);\n    } else {\n      result = decelerateValue( // $FlowFixMe\n        transformation.r, velocity.order[i].r, deceleration[i], deltaTime,   // $FlowFixMe\n        bounds.boundary[i], bounceLoss[i], zeroVelocityThreshold[i],\n        precision,\n      );\n      newTransformation = new Rotation(result.value);\n      newVTransformation = new Rotation(result.velocity);\n    }\n    if (deltaTime === null) {\n      if (result.duration > duration) {\n        ({ duration } = result);\n      }\n    }\n    newVOrder.push(newVTransformation);\n    newOrder.push(newTransformation);\n  }\n\n  if (deltaTime != null) {\n    duration = deltaTime;\n  }\n  return {\n    transform: new Transform(newOrder),\n    velocity: new Transform(newVOrder),\n    duration,\n  };\n}\n\n/**\n * Get center of a triangle\n *\n * @example\n * const getTriangleCenter = Fig.getTriangleCenter;\n *\n * const center = getTriangleCenter([0, 0], [1, 0], [0, 1]);\n * console.log(center);\n * // Point {x: 0.3333333333333333, y: 0.3333333333333333}\n */\nfunction getTriangleCenter(\n  p1: TypeParsablePoint,\n  p2: TypeParsablePoint,\n  p3: TypeParsablePoint,\n) {\n  const A = getPoint(p1);\n  const B = getPoint(p2);\n  const C = getPoint(p3);\n  const Ox = (A.x + B.x + C.x) / 3;\n  const Oy = (A.y + B.y + C.y) / 3;\n  return new Point(Ox, Oy);\n}\n\nfunction isParsablePoint(value: any) {\n  if (\n    Array.isArray(value) && value.length === 2\n    && typeof value[0] === 'number'\n    && typeof value[1] === 'number'\n  ) {\n    return true;\n  }\n  if (value instanceof Point) {\n    return true;\n  }\n  if (value.f1Type != null && value.f1Type === 'p') {\n    return true;\n  }\n  if (typeof value === 'string' && value.charAt(0) === '[') {\n    let newValue;\n    try {\n      newValue = JSON.parse(value);\n    } catch {\n      return false;\n    }\n    return isParsablePoint(newValue);\n  }\n  return false;\n}\n\n\n/**\n * A border is an array of points defining a contigous, closed border.\n *\n * `Array<TypeParsablePoint> | Array<Array<TypeParsablePoint>>`\n *\n * If a border is not contigous, but rather is several \"islands\" of contigous,\n * closed borders, then an array of point arrays can be used, where each point\n * array is one island.\n */\nexport type TypeParsableBorder = Array<TypeParsablePoint> | Array<Array<TypeParsablePoint>>;\n\n/**\n * A border is an array of point arrays. Each point array is a contigous, closed\n * border. Several pointa arrays represent a border that is several separate\n * borders.\n */\nexport type TypeBorder = Array<Array<Point>>;\n\nfunction getBorder(\n  border: Array<TypeParsablePoint> | Array<Array<TypeParsablePoint>>\n          | string | number,\n): Array<Array<Point>> | string | number {\n  if (typeof border === 'string' || typeof border === 'number') {\n    return border;\n  } // $FlowFixMe\n  if (isParsablePoint(border[0])) {  // $FlowFixMe\n    return [border.map(p => getPoint(p))];\n  } // $FlowFixMe\n  return border.map(b => b.map(p => getPoint(p)));\n}\n\nexport type TypeXAlign = 'left' | 'right' | 'center' | 'string' | number;\n\nexport type TypeYAlign = 'bottom' | 'top' | 'middle' | 'string' | number;\n\nfunction getPositionInRect(\n  r: TypeParsableRect,\n  xAlign: TypeXAlign = 0,\n  yAlign: TypeYAlign = 0,\n  // offset: TypeParsablePoint = new Point(0, 0),\n) {\n  const rect = getRect(r);\n  const position = new Point(rect.left, rect.bottom);\n  if (xAlign === 'center') {\n    position.x += rect.width / 2;\n  } else if (xAlign === 'right') {\n    position.x = rect.right;\n  } else if (typeof xAlign === 'number') {\n    position.x += rect.width * xAlign;\n  } else if (xAlign.startsWith('o')) {\n    position.x += parseFloat(xAlign.slice(1));\n  }\n  if (yAlign === 'middle') {\n    position.y += rect.height / 2;\n  } else if (yAlign === 'top') {\n    position.y = rect.top;\n  } else if (typeof yAlign === 'number') {\n    position.y += rect.height * yAlign;\n  } else if (yAlign.startsWith('o')) {\n    position.y += parseFloat(yAlign.slice(1));\n  }\n  return position;\n}\n// function getBorder(borders: Array<Array<TypeParsablePoint>>) {\n//   if (!Array.isArray(borders)) {\n//     return borders;\n//   }\n//   const borderOut: Array<Array<Point>> = [];\n//   borders.forEach((b) => {\n//     borderOut.push(b.map((bElement: TypeParsablePoint) => getPoint(bElement)));\n//   });\n//   return borderOut;\n// }\n\nexport {\n  // point,\n  Point,\n  line,\n  Line,\n  distance,\n  minAngleDiff,\n  deg,\n  normAngle,\n  Transform,\n  Rect,\n  Translation,\n  Scale,\n  Rotation,\n  spaceToSpaceTransform,\n  getBoundingRect,\n  linearPath,\n  curvedPath,\n  quadraticBezier,\n  translationPath,\n  polarToRect,\n  rectToPolar,\n  getDeltaAngle,\n  normAngleTo90,\n  threePointAngle,\n  threePointAngleMin,\n  randomPoint,\n  getMaxTimeFromVelocity,\n  getMoveTime,\n  parsePoint,\n  clipAngle,\n  spaceToSpaceScale,\n  getPoint,\n  getScale,\n  getPoints,\n  quadBezierPoints,\n  getRect,\n  getTransform,\n  getLine,\n  deceleratePoint,\n  decelerateValue,\n  decelerateTransform,\n  RectBounds,\n  LineBounds,\n  RangeBounds,\n  // ValueBounds,\n  TransformBounds,\n  Vector,\n  transformValueToArray,\n  getBounds,\n  Bounds,\n  getTriangleCenter,\n  getBoundingBorder,\n  getBorder,\n  comparePoints,\n  isBuffer,\n  getPositionInRect,\n};\n","// @flow\n// eslint-disable-next-line import/no-cycle\nimport { cssColorToArray } from './color';\nimport { getDefinedCSSVariables } from './getCssVariables';\n\nconst baseColors = [\n  'blue',\n  'red',\n  'yellow',\n  'green',\n  'cyan',\n  'brown',\n  'orange',\n  'violet',\n  'grey',\n  'black',\n  'white',\n];\n\nconst shades = [\n  'base',\n  'lighter',\n  'light',\n  'dark',\n  'darker',\n  'higher',\n  'high',\n  'low',\n  'lower',\n];\n\nconst paletteColorNames = [];\nbaseColors.forEach((color) => {\n  shades.forEach((shade) => {\n    paletteColorNames.push(`--palette-${color}-${shade}`);\n  });\n});\n\nconst figureColorNames = [\n  '--figure-background',\n  '--figure-primary',\n  '--figure-warning',\n  '--figure-safe',\n  '--figure-passive',\n  '--figure-construction1',\n  '--figure-construction2',\n  '--figure-construction3',\n  '--figure-construction4',\n  '--figure-construction5',\n  '--figure-construction6',\n  '--figure-construction7',\n  '--figure-construction8',\n  '--figure-construction9',\n  '--figure-disabled',\n  '--figure-disabledDark',\n  '--figure-disabledDarker',\n  '--figure-disabledDarkest',\n  '--figure-push',\n  '--figure-action',\n  '--figure-text-base',\n  '--figure-text-warning',\n  '--figure-text-plot',\n  '--figure-text-keyword',\n  '--figure-text-keyword2',\n  '--figure-text-latin',\n  '--figure-text-greek',\n  '--figure-text-english',\n  '--figure-text-note',\n  '--figure-qr-background',\n];\n\nexport default function getCSSColors(customColorNames: Array<string> = []): Object {\n  let colors: Object = {};\n  let paletteColors: Object = {};\n  let figureColors: Object = {};\n  const colorNames = customColorNames.map(name => `--colors-${name}`);\n\n  const { body } = document;\n  if (body) {\n    colors = getDefinedCSSVariables(\n      body, colorNames, '--colors-', false,\n      // $FlowFixMe\n      cssColorToArray,\n    );\n\n    paletteColors = getDefinedCSSVariables(\n      body, paletteColorNames, '--palette-', false,\n      // $FlowFixMe\n      cssColorToArray,\n    );\n\n    figureColors = getDefinedCSSVariables(\n      body, figureColorNames, '--figure-', false,\n      // $FlowFixMe\n      cssColorToArray,\n    );\n  }\n\n  colors.palette = paletteColors;\n  colors.figure = figureColors;\n  return colors;\n}\n\n","// @flow\nimport { addToObject } from './tools';\n\nfunction searchObject(obj: Object, path: string, text: string) {\n  let results = [];\n  Object.keys(obj).forEach((key) => {\n    const newPath = `${path}.${key}`;\n    if (key.includes(text)) {\n      results.push(newPath);\n    } else if (typeof obj[key] === 'object') {\n      const newResult = searchObject(obj[key], newPath, text);\n      if (newResult) {\n        results = results.concat(newResult);\n      }\n    } else if (typeof obj[key] === 'string') {\n      if (obj[key].includes(text)) {\n        results.push(newPath);\n      }\n    }\n  });\n  return results;\n}\n\nfunction toCamelCase(input: string, prefix) {\n  const rePrefix = new RegExp(prefix, 'g');\n  const reCamelCase1 = /-[a-z]/g;\n  const reCamelCase2 = /_[a-z]/g;\n  const repl = str => str[1].toUpperCase();\n  const noPrefix = input.replace(rePrefix, '');\n  const camelCase1 = noPrefix.replace(reCamelCase1, repl);\n  const camelCase2 = camelCase1.replace(reCamelCase2, repl);\n  const noDash = camelCase2.replace(/-/g, '');\n  return noDash;\n}\n\nfunction getDefinedCSSVariables(\n  idOrElement: string | HTMLElement,\n  propertyNames: Array<string>,\n  prefix: string = '',\n  makeFlat: boolean = true,\n  modifier: (string | number) => string | number = a => a,\n) {\n  const variables = {};\n  let elem = idOrElement;\n  if (typeof idOrElement === 'string') {\n    elem = document.getElementById(idOrElement);\n  }\n  if (elem instanceof HTMLElement) {\n    const style = window.getComputedStyle(elem);\n    if (style) {\n      propertyNames.forEach((propertyName) => {\n        let value = style.getPropertyValue(propertyName);\n        if (value == null) {\n          return;\n        }\n        value = value.trim();\n        const fValue = parseFloat(value);\n        let valueToAdd = value;\n        if (!Number.isNaN(fValue)) {\n          valueToAdd = fValue;\n        }\n        valueToAdd = modifier(valueToAdd);\n        if (makeFlat) {\n          const shortName = toCamelCase(propertyName, prefix);\n          variables[shortName] = valueToAdd;\n        } else {\n          const rePrefix = new RegExp(prefix, 'g');\n          const noPrefix = propertyName.replace(rePrefix, '');\n          addToObject(variables, noPrefix, valueToAdd, '-');\n        }\n      });\n    }\n  }\n  return variables;\n}\n\nfunction getCSSVariables(\n  idOrElement: string | HTMLElement,\n  prefix: string = '',\n  makeFlat: boolean = true,\n): Object {\n  const variables = {};\n  let elem = idOrElement;\n  if (typeof idOrElement === 'string') {\n    elem = document.getElementById(idOrElement);\n  }\n  if (elem instanceof HTMLElement) {\n    const style = window.getComputedStyle(elem);\n\n    if (style) {\n      const numProperties = style.length;\n      for (let i = 0; i < numProperties; i += 1) {\n        const propertyName = style[i];\n        if (prefix === '' || propertyName.startsWith(prefix)) {\n          let value = style.getPropertyValue(propertyName);\n          if (value != null) {\n            value = value.trim();\n            const fValue = parseFloat(value);\n            let valueToAdd = value;\n            if (!Number.isNaN(fValue)) {\n              valueToAdd = fValue;\n            }\n            if (makeFlat) {\n              const shortName = toCamelCase(propertyName, prefix);\n              variables[shortName] = valueToAdd;\n            } else {\n              const rePrefix = new RegExp(prefix, 'g');\n              const noPrefix = propertyName.replace(rePrefix, '');\n              addToObject(variables, noPrefix, valueToAdd, '-');\n            }\n          }\n        }\n      }\n    }\n  }\n  return variables;\n}\n\nexport { getCSSVariables, getDefinedCSSVariables, searchObject };\n","// @flow\nimport { colorArrayToRGBA } from './color';\nimport { generateUniqueId, joinObjects } from './tools';\nimport { Recorder } from '../figure/Recorder/Recorder';\nimport type { TypeColor } from './types';\n\nfunction convertTextArrayToParagraphs(\n  text: string | Array<string>,\n  firstParagraphMargin: number | null = null,\n) {\n  let textToUse = '';\n  let firstPStyle = '';\n  if (firstParagraphMargin != null) {\n    firstPStyle = ` style=\"margin-top:${firstParagraphMargin}%\"`;\n  }\n  if (Array.isArray(text)) {\n    text.forEach((t, index) => {\n      if (t.startsWith('<')) {\n        textToUse += t;\n      } else if (index === 0) {\n        textToUse += `<p style=\"margin-top:${firstPStyle}\">${t}</p>`;\n      } else {\n        textToUse += `<p>${t}</p>`;\n      }\n    });\n    // textToUse = `<p${style}>${text.join('</p><p>')}</p>`;\n  } else {\n    textToUse = text;\n  }\n  return textToUse;\n}\n\nfunction withClass(text: string | Array<string> = '', classText: string) {\n  const textToUse = convertTextArrayToParagraphs(text);\n  return `<div class=\"${classText}\">${textToUse}</div>`;\n}\n\nfunction centerV(text: string | Array<string> = '') {\n  const textToUse = convertTextArrayToParagraphs(text, 0);\n  return `<div style=\"display: table; height: 100%; width: 100%;\">\n        <div style=\"display: table-cell; vertical-align: middle; height: 100%; width: 100%;\">\n        ${textToUse}</div></div>`;\n}\n\nfunction centerVH(text: string | Array<string> = '') {\n  const textToUse = convertTextArrayToParagraphs(text, 0);\n  return `<div style=\"display: table; height: 100%; text-align:center; width:100%;\">\n        <div style=\"display: table-cell; vertical-align: middle; height: 100%; width: 100%;\">\n        ${textToUse}</div></div>`;\n}\n\nfunction centerH(text: string | Array<string> = '') {\n  const textToUse = convertTextArrayToParagraphs(text);\n  return `<div style=\"text-align:center;\">\n        ${textToUse}</div>`;\n}\n\nfunction style(\n  options: number | {\n    left?: number,\n    top?: number,\n    line?: number,\n    right?: number,\n    size?: number,\n    className?: string,\n    color?: TypeColor,\n    centerV?: boolean,\n    centerH?: boolean,\n    list?: ?'ordered' | 'unordered',\n    listStyleType?: string,  // css styes\n    id?: string,\n  } = 0,\n  text: string | Array<string> = '',\n) {\n  let marginLeft = '';\n  let marginRight = '';\n  let marginTop = '';\n  let marginLine = '';\n  let size = '';\n  let className = '';\n  let color = '';\n  let listStyleType = '';\n  let id = '';\n  if (typeof options === 'number') {\n    marginTop = `margin-top:${options}%`;\n  } else {\n    if (options.left != null) {\n      marginLeft = `margin-left:${options.left}%;`;\n    }\n    if (options.right != null) {\n      marginRight = `margin-right:${options.right}%;`;\n    }\n    if (options.centerV) {\n      marginTop = 'margin-top:0;';\n    }\n    if (options.top != null) {\n      marginTop = `margin-top:${options.top}%;`;\n    }\n    if (options.line != null) {\n      marginLine = `margin-top:${options.line}%;`;\n    }\n    if (options.size != null) {\n      size = `font-size:${options.size}em;`;\n    }\n    if (options.className) {\n      className = `class=\"${options.className}\"`;\n    }\n    if (options.color) {\n      color = `color:${colorArrayToRGBA(options.color)};`;\n    }\n    if (options.listStyleType) {\n      listStyleType = `list-style-type:${options.listStyleType};`;\n    }\n    if (options.id) {\n      id = `id=\"${options.id}\"`;\n    }\n  }\n\n  const p = `<p style=\"${marginLeft}${marginRight}${marginLine}${size}${color}\"${className}>`;\n  const pFirst = `<p style=\"${marginLeft}${marginRight}${marginTop}${size}${color}\"${className}${id}>`;\n\n  const li = `<li style=\"${marginLeft}${marginRight}${marginLine}${size}${color}${listStyleType}\"${className}>`;\n  const ul = `<ul style=\"${marginLeft}${marginRight}${marginTop}${size}${color}\"${className}${id}>`;\n  const ol = `<ol style=\"${marginLeft}${marginRight}${marginTop}${size}${color}\"${className}${id}>`;\n\n  let textToUse;\n  if (options.list != null) {\n    if (Array.isArray(text)) {\n      textToUse = text.join(`</li>${li}`);\n    } else {\n      textToUse = text;\n    }\n    if (options.list === 'unordered') {\n      textToUse = `${ul}${li}${textToUse}</ul>`;\n    } else {\n      textToUse = `${ol}${li}${textToUse}</ol>`;\n    }\n  } else {\n    if (Array.isArray(text)) {\n      textToUse = text.join(`</p>${p}`);\n    } else {\n      textToUse = text;\n    }\n    textToUse = `${pFirst}${textToUse}</p>`;\n  }\n  if (options.centerH) {\n    textToUse = centerH(textToUse);\n  }\n  if (options.centerV) {\n    textToUse = centerV(textToUse);\n  }\n  return textToUse;\n}\n\nfunction itemSelector(\n  items: Array<string> = [''],\n  classes: string = '',\n  selectorIndex: number = 0,\n) {\n  let outStr = `<ul id=\"id__figureone_item_selector_${selectorIndex}\" \n                    class=${classes}>`;\n  items.forEach((item, index) => {\n    outStr += `<li id=\"id__figureone_item_selector_${index}\">${item}</li>`;\n  });\n  outStr += '</ul>';\n  return outStr;\n}\n\nconst unit = (deg: string, rad: string) => `<span class=\"figureone__unit_deg\">${deg}</span><span class=\"figureone__unit_rad\">${rad}</span>\n  `;\n\n\nfunction toHTML(\n  text: string = '',\n  id: string = '',\n  classes: string = '',\n  color: TypeColor | null = null,\n) {\n  let idStr = '';\n  if (id) {\n    idStr = ` id=\"${id}\"`;\n  }\n  let classStr = '';\n  if (classes) {\n    classStr = ` class=\"${classes}\"`;\n  }\n  let colorStr = '';\n  if (color) {\n    colorStr = ` style=\"color:${colorArrayToRGBA(color)};\"`;\n  }\n  return {\n    replacementText: `<span${idStr}${classStr}\"${colorStr}>${text.replace(RegExp(/_/, 'gi'), ' ').trim()}</span>`,\n  };\n}\n\nfunction highlight(classesOrColor: string | Array<number> = '') {\n  let classStr = 'highlight_word';\n  if (typeof classesOrColor === 'string') {\n    classStr = `${classesOrColor} ${classStr}`;\n  }\n  let color = null;\n  if (Array.isArray(classesOrColor)) {\n    color = classesOrColor;\n  }\n  return {\n    replacementText: (text: string) => toHTML(text, '', classStr, color),\n  };\n}\n\nfunction link(\n  linkStr: string,\n  colorOrOptions: Array<number> | {\n    color?: ?Array<number>,\n    id?: string,\n    classes?: string,\n    text?: ?string,\n    newTab?: ?boolean,\n  } | null = null,\n) {\n  let classStr = 'action_word interactive_word';\n  let colorToUse = null;\n  const defaultOptions = {\n    color: null,\n    id: `figureone__id_${generateUniqueId()}`,\n    interactive: true,\n    classes: '',\n    text: null,\n    newTab: true,\n  };\n  let options = defaultOptions;\n  if (Array.isArray(colorOrOptions)) {\n    colorToUse = colorOrOptions;\n  } else if (colorOrOptions != null) {\n    options = joinObjects(defaultOptions, colorOrOptions);\n  }\n  const {\n    color, id, classes, text,\n  } = options;\n  if (color != null) {\n    colorToUse = color;\n  }\n\n  if (classes !== '') {\n    classStr = `${classStr} ${classes}`;\n  }\n\n  const target = options.newTab ? ' target=\"_blank\"' : '';\n  const idToUse = () => id;\n  return {\n    replacementText: (textIn: string) => {\n      const idStr = id ? ` id=\"${id}\"` : '';\n      const colorStr = colorToUse ? ` style=\"color:${colorArrayToRGBA(colorToUse)};\"` : '';\n      return {\n        replacementText: `<a href=${linkStr}${idStr}class=\"${classStr}\"${colorStr} rel=\"noreferrer noopener\"${target}>${(text || textIn).trim()}</a>`,\n      };\n    },\n    id: idToUse,\n  };\n}\n\nfunction highlightWord(text: string, classesOrColor: string | Array<number> = '') {\n  let classStr = 'highlight_word';\n  if (typeof classesOrColor === 'string') {\n    classStr = `${classesOrColor} ${classStr}`;\n  }\n  let color = null;\n  if (Array.isArray(classesOrColor)) {\n    color = classesOrColor;\n  }\n  return {\n    replacementText: toHTML(text, '', classStr, color).replacementText,\n  };\n}\n\nfunction addClass(classes: string = '') {\n  return {\n    replacementText: (text: string) => toHTML(text, '', classes),\n    // id: '',\n  };\n}\n\nfunction addId(id: string = '') {\n  return {\n    replacementText: (text: string) => toHTML(text, id),\n    // id: '',\n  };\n}\n\nfunction click(\n  actionMethod: Function,\n  bind: Array<mixed>,\n  colorOrOptions: Array<number> | {\n    color?: ?Array<number>,\n    interactive?: boolean,\n    id?: string,\n    classes?: string,\n    text?: ?string,\n  } | null = null,\n) {\n  let classStr = 'action_word';\n  let colorToUse = null;\n  const defaultOptions = {\n    color: null,\n    id: `figureone__id_${generateUniqueId()}`,\n    interactive: true,\n    classes: '',\n    text: null,\n  };\n  let options = defaultOptions;\n  if (Array.isArray(colorOrOptions)) {\n    colorToUse = colorOrOptions;\n  } else if (colorOrOptions != null) {\n    options = joinObjects(defaultOptions, colorOrOptions);\n  }\n  const {\n    interactive, color, id, classes, text,\n  } = options;\n  if (color != null) {\n    colorToUse = color;\n  }\n  if (interactive) {\n    classStr = `${classStr} interactive_word`;\n  }\n  if (classes !== '') {\n    classStr = `${classStr} ${classes}`;\n  }\n  const idToUse = () => id;\n  return {\n    replacementText: (textIn: string) => toHTML(text || textIn, idToUse(), classStr, colorToUse),\n    id: idToUse,\n    actionMethod,\n    bind,\n  };\n}\n\nfunction clickW(\n  textToUse: string,\n  actionMethod: Function,\n  bind: Array<mixed>,\n  color: TypeColor | null = null,\n) {\n  return click(actionMethod, bind, {\n    color,\n    text: textToUse,\n  });\n}\n\nfunction actionWord(\n  text: string,\n  id: string = generateUniqueId(),\n  classesOrColor: string | Array<number> | null = null,\n  interactive: boolean = true,\n) {\n  let classStr = 'action_word';\n  if (interactive) {\n    classStr = `${classStr} interactive_word`;\n  }\n  if (typeof classesOrColor === 'string') {\n    classStr = `${classesOrColor} ${classStr}`;\n  }\n  let color = null;\n  if (Array.isArray(classesOrColor)) {\n    color = classesOrColor;\n  }\n  return {\n    replacementText: toHTML(text, id, classStr, color).replacementText,\n    id,\n  };\n}\n\nfunction modifyText(\n  text: string,\n  key: string,\n  mod: Object,\n): string {\n  let outText = '';\n  const expression = new RegExp(`\\\\|${key}\\\\|`, 'gi');\n  let replacement = '';\n  if (typeof mod === 'string') {\n    replacement = mod;\n  } else if (typeof mod.replacementText === 'string') {\n    replacement = mod.replacementText;\n  } else {\n    replacement = mod.replacementText(key).replacementText;\n  }\n  outText = text.replace(expression, replacement);\n  return outText;\n}\n\nfunction onClickId(\n  id: string,\n  actionMethod: Function,\n  bind: Array<mixed>,\n  additionalClassesToAdd: string = '',\n  recorder: Recorder = new Recorder(),\n) {\n  const element = document.getElementById(id);\n  if (element) {\n    element.classList.add('action_word_enabled');\n    additionalClassesToAdd.split(' ').forEach((classString) => {\n      if (classString) {\n        element.classList.add(classString);\n      }\n    });\n    const onClickFn = () => {\n      // const recorder = new Recorder();\n      if (recorder.state === 'recording') {\n        recorder.recordEvent('click', [id]);\n      }\n      actionMethod.bind(...bind)();\n    };\n    element.onclick = onClickFn;\n  }\n}\n\nfunction applyModifiers(\n  text: string,\n  modifiers: Object,\n  highlightClass: string = 'highlight_word',\n  monochrome: boolean = false,\n) {\n  let outText = text;\n  Object.keys(modifiers).forEach((key) => {\n    const mod = modifiers[key];\n    // if (mod.replacementText != null) {\n    outText = modifyText(outText, key, mod);\n    // }\n  });\n  const r = RegExp(/\\|([^|]*)\\|/gi);\n  outText = outText.replace(r, `<span class=\"${highlightClass}\">$1</span>`);\n  if (monochrome) {\n    const c = RegExp(/style=\"color:rgba\\([^)]*\\);\"/gi);\n    outText = outText.replace(c, '');\n    const h = RegExp(/highlight_word/gi);\n    outText = outText.replace(h, '');\n    const i = RegExp(/interactive_word/gi);\n    outText = outText.replace(i, '');\n    const id = RegExp(/id=\"[^\"]*\"/gi);\n    outText = outText.replace(id, '');\n  }\n  return outText;\n}\n\nfunction setOnClicks(\n  modifiers: Object,\n  additionalClassesToAdd: string = '',\n  recorder: Recorder = new Recorder(),\n) {\n  Object.keys(modifiers).forEach((key) => {\n    const mod = modifiers[key];\n    if (typeof mod !== 'string' && 'actionMethod' in mod) {\n      onClickId(\n        typeof mod.id === 'string' ? mod.id : mod.id(key),\n        mod.actionMethod,\n        mod.bind,\n        additionalClassesToAdd,\n        recorder,\n      );\n    }\n  });\n}\n\nfunction setHTML(\n  element: HTMLElement,\n  text: string,\n  modifiers: Object = {},\n  classesToAdd: string = '',\n) {\n  const modifiedText = applyModifiers(text, modifiers);\n  // eslint-disable-next-line no-param-reassign\n  element.innerHTML = modifiedText;\n  setOnClicks(modifiers, classesToAdd);\n}\n\nexport {\n  actionWord, click, highlight, addClass, addId,\n  onClickId, highlightWord, centerV, centerH, centerVH, toHTML,\n  itemSelector, unit, applyModifiers,\n  setOnClicks, setHTML, withClass, style, clickW, link,\n};\n","// @flow\n\n// 2D Matrix functions\n\nfunction mul(a: Array<number>, b: Array<number>) {\n  return [\n    (a[0] * b[0]) + (a[1] * b[3]) + (a[2] * b[6]),\n    (a[0] * b[1]) + (a[1] * b[4]) + (a[2] * b[7]),\n    (a[0] * b[2]) + (a[1] * b[5]) + (a[2] * b[8]),\n    (a[3] * b[0]) + (a[4] * b[3]) + (a[5] * b[6]),\n    (a[3] * b[1]) + (a[4] * b[4]) + (a[5] * b[7]),\n    (a[3] * b[2]) + (a[4] * b[5]) + (a[5] * b[8]),\n    (a[6] * b[0]) + (a[7] * b[3]) + (a[8] * b[6]),\n    (a[6] * b[1]) + (a[7] * b[4]) + (a[8] * b[7]),\n    (a[6] * b[2]) + (a[7] * b[5]) + (a[8] * b[8]),\n  ];\n}\nfunction t(a: Array<number>) {\n  return [\n    a[0], a[3], a[6],\n    a[1], a[4], a[7],\n    a[2], a[5], a[8],\n  ];\n}\nfunction identity() {\n  return [\n    1, 0, 0,\n    0, 1, 0,\n    0, 0, 1,\n  ];\n}\nfunction copy(a: Array<number>) {\n  return [\n    a[0], a[1], a[2],\n    a[3], a[4], a[5],\n    a[6], a[7], a[8],\n  ];\n}\nfunction translationMatrix(tx: number, ty: number) {\n  return [\n    1, 0, tx,\n    0, 1, ty,\n    0, 0, 1,\n  ];\n}\nfunction translate(m: Array<number>, tx: number, ty: number) {\n  return mul(m, translationMatrix(tx, ty));\n}\nfunction rotationMatrix(angle: number) {\n  const c = Math.cos(angle);\n  const s = Math.sin(angle);\n  return [\n    c, -s, 0,\n    s, c, 0,\n    0, 0, 1,\n  ];\n}\nfunction rotate(m: Array<number>, angle: number) {\n  return mul(m, rotationMatrix(angle));\n}\n\nfunction scaleMatrix(sx: number, sy: number) {\n  return [\n    sx, 0, 0,\n    0, sy, 0,\n    0, 0, 1,\n  ];\n}\n\nfunction scale(m: Array<number>, sx: number, sy: number) {\n  return mul(m, scaleMatrix(sx, sy));\n}\n\nfunction transform(m: Array<number>, px: number, py: number) {\n  return [\n    (m[0] * px) + (m[1] * py) + m[2],\n    (m[3] * px) + (m[4] * py) + m[5],\n  ];\n}\n\nfunction inverse(m: Array<number>) {\n  const det = (m[0] * ((m[4] * m[8]) - (m[7] * m[5]))) - // eslint-disable-line\n              (m[1] * ((m[3] * m[8]) - (m[5] * m[6]))) + // eslint-disable-line\n              (m[2] * ((m[3] * m[7]) - (m[4] * m[6])));\n  const invdet = 1 / det;\n\n  const minv00 = ((m[4] * m[8]) - (m[7] * m[5])) * invdet;\n  const minv01 = ((m[2] * m[7]) - (m[1] * m[8])) * invdet;\n  const minv02 = ((m[1] * m[5]) - (m[2] * m[4])) * invdet;\n  const minv10 = ((m[5] * m[6]) - (m[3] * m[8])) * invdet;\n  const minv11 = ((m[0] * m[8]) - (m[2] * m[6])) * invdet;\n  const minv12 = ((m[3] * m[2]) - (m[0] * m[5])) * invdet;\n  const minv20 = ((m[3] * m[7]) - (m[6] * m[4])) * invdet;\n  const minv21 = ((m[6] * m[1]) - (m[0] * m[7])) * invdet;\n  const minv22 = ((m[0] * m[4]) - (m[3] * m[1])) * invdet;\n\n  return [\n    minv00, minv01, minv02,\n    minv10, minv11, minv12,\n    minv20, minv21, minv22,\n  ];\n}\n\nexport {\n  mul,\n  identity,\n  t,\n  copy,\n  translate,\n  rotate,\n  transform,\n  scale,\n  inverse,\n  rotationMatrix,\n  translationMatrix,\n  scaleMatrix,\n};\n","// @flow\n\nconst roundNum = (value: number, precision: number = 5): number => {\n  const multiplier = 10 ** precision;\n  let result = Math.round(value * multiplier) / multiplier;\n  // if (Object.is(result, -0)) {\n  // if (result === -0) {\n  //   result = 0;\n  // }\n  const objectIsPolyfill = (x, y) => {\n    if (x === y) {\n      // 0 === -0, but they are not identical\n      return x !== 0 || 1 / x === 1 / y;\n    }\n    // NaN !== NaN, but they are identical.\n    // NaNs are the only non-reflexive value, i.e., if x !== x,\n    // then x is a NaN.\n    // isNaN is broken: it converts its argument to number, so\n    // isNaN(\"foo\") => true\n    // eslint-disable-next-line no-self-compare\n    return x !== x && y !== y;\n  };\n  if (objectIsPolyfill(result, -0)) {\n    result = 0;\n  }\n  // if (result === -0) {\n  //   // 0 === -0, but they are not identical\n  //   return result !== 0 || 1 / x === 1 / y;\n  // }\n\n  return result;\n};\n\ntype TypeRoundObject = {\n  round?: (number) => TypeRoundObject;\n} & Object;\n/**\n * Rounds a number or numbers in an array\n * @method\n * @param {number | Array<number>} arrayOrValue - Value or array of values to be rounded\n * @param {number} precision - Number of decimal places to round to\n * @returns {number | Array<number>} Rounded value or array of values\n */\nfunction round<T: number | TypeRoundObject | Array<number | TypeRoundObject>>(\n  arrayOrValue: T,\n  precision: number = 5,\n): T {\n  let result = 0;\n  if (Array.isArray(arrayOrValue)) {\n    return arrayOrValue.map(elem => round(elem, precision));\n  }\n  if (typeof arrayOrValue === 'number') {\n    result = roundNum(arrayOrValue, precision);\n  } else if (arrayOrValue != null && arrayOrValue.round != null) {\n    result = arrayOrValue.round(precision);\n  }\n  // $FlowFixMe\n  return result;\n}\n\n\n// // clipValue clips a value to either 0 if it's small enough, or to a max value\n// // Value, and maxValue are sign independent. e.g.\n// //    * value, maxValue = 2, 1 => clips to 1\n// //    * value, maxValue = -2, -1 => clips to -1\n// //    * value, maxValue = -2, 1 => clips to -1\n// //    * value, maxValue = 2, -1 => clips to 1\n// function clipValue(\n//   value: number,\n//   zeroThreshold: number,\n//   maxValue: number = 0,\n// ) {\n//   let result = value;\n//   let zero = zeroThreshold;\n//   if (zero < 0) {\n//     zero = -zero;\n//   }\n//   if (value > -zero && value < zero) {\n//     return 0;\n//   }\n//   let max = maxValue;\n//   if (max < 0) {\n//     max = -max;\n//   }\n\n//   if (value > max) {\n//     result = max;\n//   }\n//   if (value < -max) {\n//     result = -max;\n//   }\n//   return result;\n// }\n\n\n// Clip a value to either max velocity, or 0 once under the minimum\n// threashold.\n//  * velocity: can be positive or negative\n//  * maxVelocity will clip velocity to:\n//      * |maxVelocity| if velocity > 0\n//      * -|maxVelocity| if velcity < 0\n//  * zeroThreshold will clip velocity to:\n//       * 0 if velocity is larger than -|zeroThreshold| and smaller than\n//         |zeroThreshold|.\nfunction clipMag(\n  value: number,\n  zeroThreshold: number | null,\n  maxValue: number | null,\n): number {\n  let result = value;\n  let zeroT = zeroThreshold;\n  let maxV = maxValue;\n\n  if (zeroT === null) {\n    zeroT = 0;\n  }\n  if (zeroT < 0) {\n    zeroT = -zeroT;\n  }\n  if (maxV === null) {\n    return result;\n  }\n  if (maxV < 0) {\n    maxV = -maxV;\n  }\n  if (value >= -zeroT && value <= zeroT) {\n    result = 0;\n  }\n  if (value > maxV) {\n    result = maxV;\n  }\n  if (value < -maxV) {\n    result = -maxV;\n  }\n  return result;\n}\n\nfunction clipValue(\n  value: number,\n  minValue: number | null,\n  maxValue: number | null,\n): number {\n  let clipped = value;\n  if (minValue !== null) {\n    if (value < minValue) {\n      clipped = minValue;\n    }\n  }\n\n  if (maxValue !== null) {\n    if (value > maxValue) {\n      clipped = maxValue;\n    }\n  }\n  return clipped;\n}\n\nconst decelerate = function getPositionVelocityFromDecAndTime(\n  position: number,\n  velocity: number,\n  magDeceleration: number | null,\n  time: number,\n  zeroThreshold: number | null,\n) {\n  let zeroT: number = 0;\n  if (zeroThreshold !== null) {\n    zeroT = zeroThreshold;\n  }\n  let decel: number = 0;\n  if (magDeceleration !== null) {\n    decel = magDeceleration;\n  }\n  // If the velocity is currently 0, then no further deceleration can occur, so\n  // return the current velocity and position\n  const v = clipMag(velocity, zeroT, velocity);\n  if (v === 0) {\n    return {\n      p: position,\n      v: 0,\n    };\n  }\n\n  let d = decel;\n  if (decel < 0) {\n    d = -d;\n  }\n  // If there is some initial velocity, then calc its sign and\n  const sign = velocity / Math.abs(velocity);\n  let newVelocity = velocity - sign * d * time;\n\n  // if the new velocity changes sign, then it should go to 0. If it doesn't\n  // change sign, then clip incase it should go to 0 because it is below\n  // the zero velocity threshold.\n  const newSign = newVelocity / Math.abs(newVelocity);\n  if (newSign !== sign) {\n    newVelocity = 0;\n  } else {\n    newVelocity = clipMag(newVelocity, zeroT, newVelocity);\n  }\n\n  // If the new velocity is clipped, then we need to use the time to where the\n  // velocity crosses the clipping point.\n  // v_new = v_init + a*t\n  // Therefore, if v_new = zeroT: t = (zeroT - vi)/a\n  let t = time;\n  if (newVelocity === 0) {\n    let z = zeroT;\n    const zSign = z / Math.abs(z);\n    if (zSign !== sign) {\n      z = -z;\n    }\n    t = Math.abs((z - velocity) / d);\n  }\n  // Now can calculate the new position\n  const newPosition = position + velocity * t - sign * 0.5 * d * t * t;\n\n  return {\n    p: newPosition,\n    v: newVelocity,\n  };\n};\n\n\nconst linear = (percentTime: number, invert: ?boolean = false) => {\n  if (invert) {\n    return percentTime;\n  }\n  return percentTime;\n};\n\nfunction triangle(\n  deltaTime: number = 1,\n  frequency: number = 1,\n  bias: number = 0,\n  mag: number = 1,\n  phaseOffset: number = 0,\n) {\n  return bias + 2 * mag / Math.PI\n    * Math.asin(Math.sin(2 * Math.PI * frequency * deltaTime + phaseOffset));\n  // return bias + mag * Math.sin(deltaTime * frequency * 2.0 * Math.PI + phaseOffset);\n}\n\nconst easeinout = (percentTime: number, invert: ?boolean = false) => {\n  if (invert) {\n    if (percentTime === 0.5) {\n      return 0.5;\n    }\n    const a = percentTime;\n    return (2 * a - Math.sqrt(-4 * a * a + 4 * a)) / (4 * a - 2);\n  }\n  const x = percentTime;\n  const percentDistance = (x ** 2) / ((x ** 2) + ((1 - x) ** 2));\n  return percentDistance;\n};\n\nfunction easeout(percentTime: number, invert: ?boolean = false) {\n  if (invert) {\n    if (percentTime === 0) {\n      return 0;\n    }\n    const a = percentTime / 2 + 0.5;\n    const b = (2 * a - Math.sqrt(-4 * a * a + 4 * a)) / (4 * a - 2);\n    return (b - 0.5) * 2;\n  }\n  const x = 0.5 + percentTime / 2;\n  const power = 2;\n  const percentDistance = (x ** power) / ((x ** power) + ((1 - x) ** power));\n  return (percentDistance - 0.5) * 2;\n}\n\nfunction easein(percentTime: number, invert: ?boolean = false) {\n  if (invert) {\n    if (percentTime === 1) {\n      return 1;\n    }\n    const a = percentTime / 2;\n    const b = (2 * a - Math.sqrt(-4 * a * a + 4 * a)) / (4 * a - 2);\n    return b * 2;\n  }\n  const x = percentTime / 2;\n  const power = 2;\n  const percentDistance = (x ** power) / ((x ** power) + ((1 - x) ** power));\n  return percentDistance * 2;\n}\n\nfunction sinusoid(\n  deltaTime: number = 1,\n  frequency: number = 1,\n  bias: number = 0,\n  mag: number = 1,\n  phaseOffset: number = 0,\n) {\n  return bias + mag * Math.sin(deltaTime * frequency * 2.0 * Math.PI + phaseOffset);\n}\n\nfunction sinusoidAbs(\n  deltaTime: number = 1,\n  frequency: number = 1,\n  bias: number = 0,\n  mag: number = 1,\n  phaseOffset: number = 0,\n) {\n  return bias + Math.abs(mag * Math.sin(deltaTime * frequency * 2.0 * Math.PI + phaseOffset));\n}\n\n// const animationPhase = (transform, time, rotDirection = 0, animationStyle = easeinout) => {\n//     return {\n//         transform: transform._dup(),\n//         time: time,\n//         rotDirection: rotDirection,\n//         animationStyle: animationStyle,\n//     }\n// }\n\n\n/**\n * Creates an array with a range of numbers\n * @param start - Range start\n * @param stop - Range stop\n * @param step - Range step\n * @returns {Array<number>} Range of numbers in an array\n */\nfunction range(start: number, stop: number, step: number = 1, precision: number = 8) {\n  const out = [];\n  if (stop > start) {\n    for (let i = start; i <= stop; i = round(i + step, precision)) {\n      out.push(i);\n    }\n  } else {\n    for (let i = start; i >= stop; i = round(i + step, precision)) {\n      out.push(i);\n    }\n  }\n  return out;\n}\n\n/**\n * Return a -1 or 1 randomly\n * @return {number} -1 or 1\n */\nfunction randSign() {\n  return Math.random() > 0.5 ? 1 : -1;\n}\n\n/**\n * Return a random int.\n *\n * If a `max = null`, then the returned integer will be in the range of 0 to\n * `minOrMax`.\n *\n * Otherwise the returned value is in the range of `minOrMax` to `max`.\n *\n * Use `sign` to also return a random sign (negative or positive);\n *\n * @return {number} random integer\n */\nfunction randInt(minOrMax: number, max: ?number = null, sign: boolean = false) {\n  let r = 0;\n  if (max != null) {\n    const min = minOrMax;\n    r = Math.floor(Math.random() * Math.floor((max - min)) + Math.floor(min));\n  } else {\n    r = Math.floor(Math.random() * Math.floor(minOrMax));\n  }\n  if (sign) {\n    r *= randSign();\n  }\n  return r;\n}\n\n/**\n * Return a random number.\n *\n * If a `max = null`, then the returned number will be in the range of 0 to\n * `minOrMax`.\n *\n * Otherwise the returned value is in the range of `minOrMax` to `max`.\n *\n * Use `sign` to also return a random sign (negative or positive);\n *\n * @return {number} random number\n */\nfunction rand(minOrMax: number, max: ?number = null, plusOrMinus: boolean = false) {\n  let r = 0;\n  if (max != null) {\n    const min = minOrMax;\n    r = Math.random() * (max - min) + min;\n  } else {\n    r = Math.random() * minOrMax;\n  }\n  if (plusOrMinus) {\n    r *= randSign();\n  }\n  return r;\n}\n\n/**\n * Get a random element from an array.\n */\nfunction randElement<T>(inputArray: Array<T>): T {\n  const index = randInt(inputArray.length);\n  return inputArray[index];\n}\n\n/**\n * Remove and return random element from an array.\n */\nfunction removeRandElement<T>(inputArray: Array<T>): T {\n  const index = rand(inputArray.length);\n  return inputArray.splice(index, 1)[0];\n}\n\n/**\n * Get a number of random elements from an array.\n */\nfunction randElements<T>(num: number, inputArray: Array<T>): Array<T> {\n  const possibleIndeces = range(0, inputArray.length - 1, 1);\n  const elements = [];\n  for (let i = 0; i < num; i += 1) {\n    const index = removeRandElement(possibleIndeces);\n    elements.push(inputArray[index]);\n  }\n  return elements;\n}\n\nfunction rand2D(minX: number, minY: number, maxX: number, maxY: number) {\n  return {\n    x: rand(minX, maxX),\n    y: rand(minY, maxY),\n  };\n}\n\nexport {\n  round,\n  roundNum,\n  decelerate,\n  easeinout,\n  easeout,\n  easein,\n  sinusoid,\n  sinusoidAbs,\n  linear,\n  triangle,\n  clipMag,\n  clipValue,\n  range,\n  randInt,\n  rand,\n  randElement,\n  removeRandElement,\n  randElements,\n  rand2D,\n  randSign,\n};\n\n","// @flow\n\nimport {\n  getCSSVariables, getDefinedCSSVariables, searchObject,\n} from './getCssVariables';\nimport getCSSColors from './getCssColors';\n\nexport {\n  getCSSVariables, getDefinedCSSVariables, searchObject, getCSSColors,\n};\n","// @flow\nimport { roundNum } from './math';\nimport { FunctionMap } from './FunctionMap';\n// import Worker from '../figure/recorder.worker.js';\n\nconst Console = (text: string) => {\n  console.log(text); // eslint-disable-line no-console\n};\n\n// function add(a: number, b: number): number {\n//   return a + b;\n// }\n\n// function mulToString(a: number, b: number): string {\n//   return (a * b).toString();\n// }\n\n// const divide = (a: number, b: number): number => a / b;\n\nconst classify = (key: string, value: string) => {\n  const nonEmpty = value || key;\n  const withKey = nonEmpty[0] === '-' || nonEmpty.startsWith(`${key}-`)\n    ? `${key} ${nonEmpty}` : nonEmpty;\n  const joinStr = ` ${key}-`;\n  return `${withKey.split(' -').join(joinStr)}`;\n};\n\nclass ObjectKeyPointer {\n  object: Object;\n  key: string;\n  constructor(object: Object, key: string) {\n    this.object = object;\n    this.key = '';\n    if (key in object) {\n      this.key = key;\n    }\n  }\n\n  setValue(value: mixed) {\n    if (this.key) {\n      this.object[this.key] = value;\n    }\n  }\n\n  execute(...args: mixed) {\n    if (this.key) {\n      return this.object[this.key].apply(null, args);\n    }\n    return undefined;\n  }\n\n  value() {\n    if (this.key) {\n      return this.object[this.key];\n    }\n    return undefined;\n  }\n}\n//\nfunction extractFrom(\n  objectToExtractFrom: Object,\n  keyValues: Object | Array<any> | string,\n  keyPrefix: string = '',\n  keySeparator: string = '_',\n) {\n  const out = [];\n  if (typeof keyValues === 'string') {\n    if (keyPrefix + keyValues in objectToExtractFrom) {\n      return new ObjectKeyPointer(objectToExtractFrom, keyPrefix + keyValues);\n    }\n    const keyHeirarchy = keyValues.split(keySeparator);\n    const keys = keyHeirarchy.filter(k => k.length > 0);\n    const prefixAndKey = `${keyPrefix}${keys[0]}`;\n    if (keys.length > 1) {\n      if (prefixAndKey in objectToExtractFrom) {\n        return extractFrom(\n          objectToExtractFrom[prefixAndKey],\n          keys.slice(1).join(keySeparator),\n          keyPrefix,\n          keySeparator,\n        );\n      }\n    } else if (keys.length === 1) {\n      if (prefixAndKey in objectToExtractFrom) {\n        return new ObjectKeyPointer(objectToExtractFrom, prefixAndKey);\n      }\n    }\n    return undefined;\n  }\n\n  if (Array.isArray(keyValues)) {\n    keyValues.forEach((kv) => {\n      const result = extractFrom(objectToExtractFrom, kv, keyPrefix, keySeparator);\n      if (result !== undefined) {\n        out.push(result);\n      }\n    });\n  } else {\n    Object.keys(keyValues).forEach((key) => {\n      if (keyPrefix + key in objectToExtractFrom) {\n        out.push({\n          obj: new ObjectKeyPointer(objectToExtractFrom, keyPrefix + key),\n          // $FlowFixMe\n          value: keyValues[key],\n        });\n      }\n    });\n  }\n  return out;\n}\n\nfunction getFromObject(\n  objectToGetFrom: Object,\n  keyPath: string,\n  levelSeparator: string = '.',\n) {\n  if (keyPath.length === 0 || keyPath === levelSeparator) {\n    return objectToGetFrom;\n  }\n  const result = extractFrom(objectToGetFrom, keyPath, '', levelSeparator);\n  if (result === undefined) {\n    return undefined;\n  }\n  // $FlowFixMe\n  return result.value();\n}\n\n// function getObjectValueFromPath(\n//   objectToExtractFrom: Object,\n//   path: string,\n//   pathSeparator: string = '.',\n// ) {\n//   const result = extractFrom(objectToExtractFrom, path, '', pathSeparator);\n//   if (result === undefined) {\n//     return undefined;\n//   }\n//   if (Array.isArray(result)) {\n//     return result[0].value();\n//   }\n//   return result.value();\n// }\n\nfunction getElement(\n  collection: Object,\n  keyValues: Object | Array<any> | string,\n) {\n  return extractFrom(collection, keyValues, '_', '_');\n}\n\n\nfunction addToObject(\n  obj: Object,\n  keyPath: string,\n  valueToAdd: mixed,\n  levelSeparator: string = '.',\n) {\n  const levels = keyPath.split(levelSeparator).filter(a => a.length > 0);\n  let currentLevel: Object = obj;\n  levels.forEach((level, index) => {\n    if (index === levels.length - 1) {\n      currentLevel[level] = valueToAdd;\n      return;\n    }\n    if (!Object.prototype.hasOwnProperty.call(currentLevel, level)) {\n      currentLevel[level] = {};\n    }\n    currentLevel = currentLevel[level];\n  });\n}\n\n// function duplicateFromTo(\n//   fromObject: Object,\n//   toObject: Object,\n//   exceptKeys: Array<string> = [],\n// ) {\n//   const copyValue = (value) => {\n//     if (typeof value === 'number'\n//         || typeof value === 'boolean'\n//         || typeof value === 'string'\n//         || value == null\n//         || typeof value === 'function') {\n//       return value;\n//     }\n//     if (typeof value._dup === 'function') {\n//       return value._dup();\n//     }\n//     if (Array.isArray(value)) {\n//       const arrayCopy = [];\n//       value.forEach(arrayElement => arrayCopy.push(copyValue(arrayElement)));\n//       return arrayCopy;\n//     }\n//     if (typeof value === 'object') {\n//       const objectCopy = {};\n//       Object.keys(value).forEach((key) => {\n//         const v = copyValue(value[key]);\n//         objectCopy[key] = v;\n//       });\n//       return objectCopy;\n//     }\n//     return value;\n//   };\n\n//   Object.keys(fromObject).forEach((key) => {\n//     if (exceptKeys.indexOf(key) === -1) {\n//       // eslint-disable-next-line no-param-reassign\n//       toObject[key] = copyValue(fromObject[key]);\n//     }\n//   });\n// }\n\nfunction duplicate(value: ?(number | boolean | string | Object)) {\n  if (typeof value === 'number'\n      || typeof value === 'boolean'\n      || typeof value === 'string'\n      || value == null\n      || value === NaN  // eslint-disable-line\n      || typeof value === 'function') {\n    return value;\n  }\n  if (typeof value._dup === 'function') {\n    return value._dup();\n  }\n  if (Array.isArray(value)) {\n    const arrayDup = [];\n    value.forEach(arrayElement => arrayDup.push(duplicate(arrayElement)));\n    return arrayDup;\n  }\n  // if (typeof value === 'object') {\n  const objectDup = {};\n  Object.keys(value).forEach((key) => {\n    const v = duplicate(value[key]);\n    objectDup[key] = v;\n  });\n  return objectDup;\n  // }\n  // return value;\n}\n\nfunction assignObjectFromTo(\n  fromObject: Object,\n  toObject: Object,\n  exceptIn: Array<string> | string = [],\n  duplicateValues: boolean = false,\n  parentPath: string = '',\n) {\n  const except = typeof exceptIn === 'string' ? [exceptIn] : exceptIn;\n  Object.keys(fromObject).forEach((key) => {\n    // debugger;\n    const keyPath = parentPath !== '' ? `${parentPath}.${key}` : key;\n    if (except.indexOf(keyPath) !== -1) {\n      return;\n    }\n    const value = fromObject[key];\n    if (typeof value === 'object' && value != null && value._assignAsLinkOnly) {\n      // eslint-disable-next-line no-param-reassign\n      toObject[key] = fromObject[key];\n      return;\n    }\n    if (typeof value === 'number'\n      || typeof value === 'boolean'\n      || typeof value === 'string'\n      || value == null\n      || typeof value === 'function'\n      || typeof value._dup === 'function'\n      || Array.isArray(value)\n    ) {\n      // Only assign the value if:\n      //    * Value is not undefined OR\n      //    * Value is undefined and toObject[key] is undefined\n      if (value !== undefined || toObject[key] === undefined) {\n        if (duplicateValues) {     // eslint-disable-next-line no-param-reassign\n          toObject[key] = duplicate(value);\n        } else {                   // eslint-disable-next-line no-param-reassign\n          toObject[key] = value;\n        }\n      }\n    } else {\n      // If the fromObject[key] value is an object, but the toObject[key] value\n      // is not an object, but then make toObject[key] an empty object\n      const toValue = toObject[key];\n      if (typeof toValue === 'number'\n        || typeof toValue === 'boolean'\n        || typeof toValue === 'string'\n        || toValue == null\n        || typeof toValue === 'function'\n        || Array.isArray(toValue)\n      ) {\n        // eslint-disable-next-line no-param-reassign\n        toObject[key] = {};\n      }\n      assignObjectFromTo(value, toObject[key], except, duplicateValues, keyPath);\n    }\n  });\n}\n\nfunction joinObjectsWithOptions(options: {\n  duplicate?: boolean,\n  except?: Array<string> | string,\n}, ...objects: Array<Object>): Object {\n  let { except } = options;\n  let dup = options.duplicate;\n  if (except == null) {\n    except = [];\n  }\n  if (dup == null) {\n    dup = false;\n  }\n\n  const num = objects.length;\n  const out = objects[0];\n  for (let i = 1; i < num; i += 1) {\n    const o = objects[i];\n    if (o != null) {\n      assignObjectFromTo(o, out, except, dup, '');\n    }\n  }\n  return out;\n}\n\n// joins objects like object.assign but goes as many levels deep as the object\n// is. Objects later in the arrawy overwrite objects earlier.\nfunction joinObjects(...objects: Array<Object>): Object {\n  return joinObjectsWithOptions({}, ...objects);\n}\n\nfunction duplicateFromTo(\n  fromObject: Object,\n  toObject: Object,\n  exceptKeys: Array<string> = [],\n) {\n  joinObjectsWithOptions({ except: exceptKeys, duplicate: true }, toObject, fromObject);\n}\n\nfunction generateUniqueId(seed: string = '') {\n  const randomString = s => `${s}${Math.floor(Math.random() * 1000000)}`;\n  let seedToUse = seed;\n  if (seedToUse.length === 0) {\n    seedToUse = 'id_random_';\n  }\n  let idExists = true;\n  let newId = randomString(seedToUse);\n  while (idExists) {\n    newId = randomString(seedToUse);\n    const element = document.getElementById(newId);\n    if (element == null) {\n      idExists = false;\n    }\n  }\n  return newId;\n}\n\nfunction isTouchDevice() {\n  const prefixes = ' -webkit- -moz- -o- -ms- '.split(' ');\n  const mq = query => window.matchMedia(query).matches;\n\n  /* eslint-disable no-undef, no-mixed-operators */\n  // $FlowFixMe\n  if (('ontouchstart' in window) || window.DocumentTouch && document instanceof DocumentTouch) {\n    return true;\n  }\n  /* eslint-enable no-undef, no-mixed-operators */\n\n  // include the 'heartz' as a way to have a non matching MQ to help terminate the join\n  // https://git.io/vznFH\n  const query = ['(', prefixes.join('touch-enabled),('), 'heartz', ')'].join('');\n  return mq(query);\n}\n\nfunction loadRemote(\n  scriptId: string,\n  url: string,\n  callback: null | (string, string) => void = null,\n) {\n  const existingScript = document.getElementById(scriptId);\n  if (!existingScript) {\n    const script = document.createElement('script');\n    script.type = 'text/javascript';\n    script.src = url;\n    script.id = scriptId; // e.g., googleMaps or stripe\n    if (document.body) {\n      document.body.appendChild(script);\n    }\n    script.onload = () => {\n      if (callback != null) {\n        callback(scriptId, url);\n      }\n    };\n  } else if (callback != null) {\n    callback(scriptId, url);\n  }\n}\n\nfunction loadRemoteCSS(\n  id: string,\n  url: string,\n  callback: null | (string, string) => void = null,\n) {\n  const existingScript = document.getElementById(id);\n  if (!existingScript) {\n    const link = document.createElement('link');\n    link.rel = 'stylesheet';\n    link.type = 'text/css';\n    link.href = url;\n    link.id = id; // e.g., googleMaps or stripe\n    if (document.body) {\n      document.body.appendChild(link);\n    }\n    link.onload = () => {\n      if (callback != null) {\n        callback(id, url);\n      }\n    };\n  } else if (callback != null) {\n    callback(id, url);\n  }\n}\n\n// function remoteLoadToObject(\n//   scriptId: string,\n//   url: string,\n//   toObject: {},\n//   callback: null | (string, string) => void = null,\n// ) {\n//   loadRemote(scriptId, url, callback);\n\n// }\n\nconst cleanUIDs = (objectToClean: Object) => {\n  const genericUID = '0000000000';\n  if (objectToClean == null) {\n    return;\n  }\n  if ('uid' in objectToClean) {\n    if (objectToClean.uid === genericUID) {\n      return;\n    }\n    // eslint-disable-next-line no-param-reassign\n    objectToClean.uid = genericUID;\n  }\n  const keys = Object.keys(objectToClean);\n  for (let i = 0; i < keys.length; i += 1) {\n    const key = keys[i];\n    const value = objectToClean[key];\n    if (\n      typeof value === 'object'\n      && !Array.isArray(value)\n      && value != null\n      && typeof value !== 'function'\n      && typeof value !== 'number'\n      && typeof value !== 'boolean'\n      && typeof value !== 'string'\n    ) {\n      cleanUIDs(value);\n    }\n  }\n};\n\nfunction deleteKeys(obj: Object, keys: Array<string>) {\n  keys.forEach((key) => {\n    if (obj[key] !== undefined) {\n      // eslint-disable-next-line no-param-reassign\n      delete obj[key];\n    }\n  });\n}\n\nfunction copyKeysFromTo(source: Object, destination: Object, keys: Array<string>) {\n  keys.forEach((key) => {\n    if (source[key] !== undefined) {\n      // eslint-disable-next-line no-param-reassign\n      destination[key] = source[key];\n    }\n  });\n}\n\nfunction generateRandomString() {\n  return (Math.random() * 1e18).toString(36);\n}\n\nclass UniqueMap {\n  map: Object;\n  inverseMap: Object;\n  index: number;\n  letters: string;\n  undefinedCode: string;\n\n  constructor() {\n    this.map = {};\n    this.index = 1;\n    this.inverseMap = {};\n    this.letters = '0abcdefghijklmnopqrstuvwxz';\n    this.undefinedCode = '.a';\n  }\n\n  reset() {\n    this.index = 1;\n    this.map = {};\n  }\n\n  add(pathStr: string) {\n    if (this.map[pathStr] != null) {\n      return this.map[pathStr];\n    }\n    const unique = this.getNextUniqueString();\n    this.map[pathStr] = unique;\n    return unique;\n  }\n\n  getNextUniqueString() {\n    if (this.index === 0) {\n      return 'a';\n    }\n    const order = Math.floor(Math.log(this.index) / Math.log(this.letters.length));\n    let remainder = this.index;\n    let out = '';\n    for (let i = order; i >= 0; i -= 1) {\n      const factor = Math.floor(remainder / this.letters.length ** i);\n      remainder -= factor * this.letters.length ** i;\n      out = `${out}${this.letters[factor]}`;\n    }\n    this.index += 1;\n    return out;\n  }\n\n  makeInverseMap() {\n    this.inverseMap = {};\n    Object.keys(this.map).forEach((key) => {\n      const uniqueStr = this.map[key];\n      this.inverseMap[uniqueStr] = key;\n    });\n  }\n\n  get(uniqueStr: string) {\n    if (uniqueStr === this.undefinedCode) {\n      return undefined;\n    }\n    if (this.inverseMap[uniqueStr] != null) {\n      return this.inverseMap[uniqueStr];\n    }\n    return uniqueStr;\n  }\n}\n\nfunction compressObject(\n  obj: any,\n  map: UniqueMap,\n  keys: boolean = true,\n  strValues: boolean = true,\n  precision: ?number = null,\n  uncompress: boolean = false,\n) {\n  if (typeof obj === 'string') {\n    // if (obj === 'do') {\n    //   console.log(obj, strValues, uncompress, map.get(obj))\n    // }\n    if (strValues && uncompress) {\n      return map.get(obj);\n    }\n    if (strValues) {\n      return map.add(obj);\n    }\n    return obj;\n  }\n  if (typeof obj === 'number') {\n    if (precision === null || uncompress) {\n      return obj;\n    }\n    return roundNum(obj, precision);\n  }\n  if (\n    typeof obj === 'boolean'\n    || typeof obj === 'function'\n    || obj === null\n  ) {\n    return obj;\n  }\n\n  if (obj === undefined) {\n    return map.undefinedCode;\n  }\n\n  if (Array.isArray(obj)) {\n    for (let i = 0; i < obj.length; i += 1) {\n      // eslint-disable-next-line no-param-reassign\n      obj[i] = compressObject(obj[i], map, keys, strValues, precision, uncompress);\n    }\n    return obj;\n  }\n\n  if (typeof obj === 'object') {\n    const objKeys = Object.keys(obj);\n    const obj2 = {};\n    for (let i = 0; i < objKeys.length; i += 1) {\n      const k = objKeys[i];\n      // eslint-disable-next-line no-param-reassign\n      obj[k] = compressObject(obj[k], map, keys, strValues, precision, uncompress);\n      if (keys && uncompress) {\n        const value = map.get(k);\n        if (value != null) {\n          obj2[value] = obj[k];\n        }\n      } else if (keys) {\n        obj2[map.add(k)] = obj[k];\n      } else {\n        obj2[k] = obj[k];\n      }\n    }\n    if (keys) {\n      return obj2;\n    }\n    return obj2;\n  }\n  return obj;\n}\n\nfunction uncompressObject(\n  obj: any,\n  map: UniqueMap,\n  keys: boolean = true,\n  strValues: boolean = true,\n) {\n  return compressObject(obj, map, keys, strValues, null, true);\n}\n\nfunction minify(objectOrArray: any, precision: ?number = 4) {\n  const map = new UniqueMap();\n  return {\n    minified: compressObject(objectOrArray, map, true, true, precision),\n    map,\n  };\n}\n\nfunction unminify(minObjectOrArray: {\n  map: Object | UniqueMap,\n  minified: Object,\n}) {\n  let { map } = minObjectOrArray;\n  if (!(map instanceof UniqueMap)) {\n    const uMap = new UniqueMap();\n    uMap.map = map.map;\n    uMap.index = map.index;\n    uMap.letters = map.letters;\n    map = uMap;\n  }\n  map.makeInverseMap();\n  return uncompressObject(minObjectOrArray.minified, map, true, true);\n}\n\nfunction objectToPaths(\n  obj: any,\n  path: string = '',\n  pathObj: Object = {},\n  precision: ?number = null,\n) {\n  if (\n    typeof obj === 'string'\n    // || typeof obj === 'number'\n    || typeof obj === 'boolean'\n    || typeof obj === 'function'\n  ) {\n    pathObj[`${path}`] = obj; // eslint-disable-line no-param-reassign\n    return pathObj;\n  }\n  if (typeof obj === 'number') {\n    if (precision != null) {\n      pathObj[`${path}`] = roundNum(obj, precision); // eslint-disable-line no-param-reassign\n    } else {\n      pathObj[`${path}`] = obj; // eslint-disable-line no-param-reassign\n    }\n    return pathObj;\n  }\n  if (obj === null) {\n    pathObj[`${path}`] = null; // eslint-disable-line no-param-reassign\n    return pathObj;\n  }\n  if (obj === undefined) {\n    // pathObj[`${path}`] = undefined; // eslint-disable-line no-param-reassign\n    return pathObj;\n  }\n  if (Array.isArray(obj)) {\n    obj.forEach((o, index) => {\n      objectToPaths(o, `${path}[${index}]`, pathObj, precision);\n    });\n    return pathObj;\n  }\n  Object.keys(obj).forEach((key) => {\n    objectToPaths(obj[key], `${path}.${key}`, pathObj, precision);\n  });\n  return pathObj;\n}\n\nfunction getObjectDiff(\n  obj1In: Object,\n  diffs: Array<Object>,\n  obj2: Object,\n  precision: ?number = null,\n  debug: boolean = false,\n) {\n  // const pathMap = {};\n  let obj1 = obj1In;\n  if (diffs.length > 0) { // eslint-disable-next-line no-use-before-define\n    obj1 = refAndDiffToObject(obj1In, ...diffs);\n  }\n  const paths1 = objectToPaths(obj1, '', {}, precision);\n  const paths2 = objectToPaths(obj2, '', {}, precision);\n  const added = {};\n  const diff = {};\n  const removed = {};\n  Object.keys(paths1).forEach((key1) => {\n    if (paths2[key1] === undefined) {\n      removed[key1] = paths1[key1];\n      return;\n    }\n    if (paths1[key1] !== paths2[key1]) {\n      if (debug) {\n        diff[key1] = [paths1[key1], paths2[key1]];\n      } else {\n        diff[key1] = paths2[key1];\n      }\n    }\n  });\n  Object.keys(paths2).forEach((key2) => {\n    if (paths1[key2] === undefined) {\n      added[key2] = paths2[key2];\n    }\n  });\n  const out = {};\n  if (Object.keys(diff).length > 0) {\n    out.diff = diff;\n  }\n  if (Object.keys(added).length > 0) {\n    out.added = added;\n  }\n  if (Object.keys(removed).length > 0) {\n    out.removed = removed;\n  }\n  return out;\n}\n\nfunction updateObjFromPath(\n  remainingPath: Array<string>,\n  obj: Object,\n  value: any,\n  remove: boolean = false,\n) {\n  // console.log(remainingPath)\n  const fullP = remainingPath[0];\n  if (fullP.length === 0) {\n    return;\n  }\n  const arrayStringIndeces = fullP.match(/\\[[^\\]]*\\]/g);\n  const p = fullP.replace(/\\[.*/, '');\n  if (remainingPath.length === 1 && remove && !arrayStringIndeces) {\n    // eslint-disable-next-line no-param-reassign\n    delete obj[p];\n    return;\n  }\n  if (arrayStringIndeces) {\n    const arrayIndeces = arrayStringIndeces.map(e => parseInt(e.replace(/\\[|\\]/g, ''), 10));\n    // console.log(arrayIndeces)\n    // return;\n    if (obj[p] == null || !Array.isArray(obj[p])) {\n      obj[p] = [];  // eslint-disable-line no-param-reassign\n    }\n    // console.log(obj)\n    // return\n    let currentArray = obj[p];\n    let index = 0;\n    for (let i = 0; i < arrayIndeces.length; i += 1) {\n      index = arrayIndeces[i];\n      if (currentArray.length <= index) {\n        for (let j = currentArray.length; j < index - currentArray.length + 1; j += 1) {\n          currentArray.push(undefined);\n        }\n      }\n      if (i < arrayIndeces.length - 1) {\n        // currentArray[index] = currentArray[index][i];\n        if (!Array.isArray(currentArray[index])) {\n          currentArray[index] = [];\n        }\n        currentArray = currentArray[index];\n      }\n    }\n    if (remainingPath.length === 1 && remove) {\n      currentArray[index] = undefined;\n      return;\n    }\n    if (remainingPath.length === 1) {\n      currentArray[index] = value;\n      return;\n    }\n    if (currentArray[index] == null || typeof currentArray[index] !== 'object') {\n      currentArray[index] = {};\n    }\n    updateObjFromPath(remainingPath.slice(1), currentArray[index], value, remove);\n    return;\n  }\n\n  // if (remainingPath.length === 1 && remove) {\n  //   console.log('asdf')\n  //   obj[p] = undefined;\n  // }\n  if (remainingPath.length === 1) {\n    obj[p] = value;  // eslint-disable-line no-param-reassign\n    return;\n  }\n  if (obj[p] == null) {\n    obj[p] = {};  // eslint-disable-line no-param-reassign\n  }\n  updateObjFromPath(remainingPath.slice(1), obj[p], value, remove);\n}\n\nfunction pathsToObj(paths: Object) {\n  const obj = {};\n  Object.keys(paths).forEach((key) => {\n    const path = key.split('.').filter(p => p.length > 0);\n    const value = paths[key];\n    if (Array.isArray(value)) {\n      updateObjFromPath(path, obj, value.slice(-1)[0]);\n    } else {\n      updateObjFromPath(path, obj, value);\n    }\n  });\n  return obj;\n}\n\nfunction refAndDiffToObject(\n  referenceIn: Object,\n  ...diffsIn: Array<{\n    added: Object,\n    diff: Object,\n    removed: Object,\n  }>\n) {\n  const ref = duplicate(referenceIn);\n  const processPaths = (paths: Object, remove: boolean = false) => {\n    // console.log(paths)\n    Object.keys(paths).forEach((pathStr) => {\n      // console.log(pathStr)\n      const path = pathStr.split('.').filter(p => p.length > 0);\n      const value = paths[pathStr];\n      if (Array.isArray(value)) {\n        updateObjFromPath(path, ref, value.slice(-1)[0], remove);\n      } else {\n        updateObjFromPath(path, ref, value, remove);\n      }\n    });\n  };\n  // console.log(diffsIn)\n  diffsIn.forEach((diffIn) => {\n    // console.log(diffIn)\n    const { added, removed, diff } = diffIn;\n    // console.log(1, removed)\n    if (removed != null) {\n      processPaths(removed, true);\n    }\n    // console.log(2)\n    if (added != null) {\n      processPaths(added);\n    }\n    // console.log(3)\n    if (diff != null) {\n      processPaths(diff);\n    }\n  });\n  return ref;\n}\n\nfunction diffPathsToObj(diff: { added: Object, removed: Object, diff: Object }) {\n  const out = {};\n  if (diff.diff && Object.keys(diff.diff).length > 0) {\n    out.diff = pathsToObj(diff.diff);\n  }\n  if (diff.added && Object.keys(diff.added).length > 0) {\n    out.added = pathsToObj(diff.added);\n  }\n  if (diff.removed && Object.keys(diff.removed).length > 0) {\n    out.removed = pathsToObj(diff.removed);\n  }\n  return out;\n}\n\nfunction diffObjToPaths(diff: { added: Object, removed: Object, diff: Object }) {\n  const out = {};\n  if (diff.diff && Object.keys(diff.diff).length > 0) {\n    out.diff = objectToPaths(diff.diff);\n  }\n  if (diff.added && Object.keys(diff.added).length > 0) {\n    out.added = objectToPaths(diff.added);\n  }\n  if (diff.removed && Object.keys(diff.removed).length > 0) {\n    out.removed = objectToPaths(diff.removed);\n  }\n  return out;\n}\n\n// Class that can track an object's differences over time\nclass ObjectTracker {\n  baseReference: ?Object;\n  references: {\n    [refName: string]: {\n      basedOn: string,\n      diff: Object,\n    },\n  };\n\n  precision: number;\n  worker: typeof Worker;\n\n  //             time   refName  diff\n  diffs: Array<[number, string, Object, number]>\n\n  lastReferenceName: string;\n\n  constructor(precision: number = 8) {\n    this.precision = precision;\n    this.reset();\n  }\n\n  toObj() {\n    const references = {};\n    Object.keys(this.references).forEach((refName) => {\n      references[refName] = {\n        basedOn: this.references[refName].basedOn,\n        diff: diffPathsToObj(this.references[refName].diff),\n      };\n    });\n    // $FlowFixMe\n    const diffs = this.diffs.map(d => [d[0], d[1], diffPathsToObj(d[2]), d[3]]);\n    return {\n      baseReference: duplicate(this.baseReference),\n      diffs,\n      references,\n      precision: this.precision,\n      lastReferenceName: this.lastReferenceName,\n    };\n  }\n\n  setFromObj(obj: Object) {\n    const references = {};\n    Object.keys(obj.references).forEach((refName) => {\n      references[refName] = {\n        basedOn: obj.references[refName].basedOn,\n        diff: diffObjToPaths(obj.references[refName].diff),\n      };\n    });\n    this.references = references;\n    this.baseReference = duplicate(obj.baseReference);\n    this.precision = obj.precision;\n    this.diffs = obj.diffs.map(d => [d[0], d[1], diffObjToPaths(d[2]), d[3]]);\n    this.lastReferenceName = obj.lastReferenceName;\n  }\n\n  reset() {\n    this.baseReference = null;\n    this.references = {};\n    this.diffs = [];\n    this.lastReferenceName = '__base';\n  }\n\n  setBaseReference(obj: Object) {\n    this.baseReference = duplicate(obj);\n    this.lastReferenceName = '__base';\n  }\n\n  addReference(\n    obj: Object,\n    refName: string,\n    basedOn: string = '__base',\n  ) {\n    if (this.baseReference == null || refName === '__base') {\n      this.setBaseReference(obj);\n    }\n    if (refName !== '__base') {\n      this.references[refName] = {\n        diff: this.getDiffToReference(obj, basedOn),\n        basedOn,\n      };\n      this.lastReferenceName = refName;\n    }\n  }\n\n  getReferenceChain(name: string, chain: Array<Object>) {\n    if (name === '__base') {\n      return chain;\n    }\n    if (this.references[name] == null) {\n      return chain;\n    }\n    return this.getReferenceChain(\n      this.references[name].basedOn, [this.references[name].diff, ...chain],\n    );\n  }\n\n  getReference(refName: string) {\n    const referenceChain = this.getReferenceChain(refName, []);\n    return refAndDiffToObject(this.baseReference, ...referenceChain);\n  }\n\n  getDiffToReference(\n    obj: Object,\n    refName: string,\n  ) {\n    // const s1 = performance.now()\n    const referenceChain = this.getReferenceChain(refName, []);\n    // console.log('ref Chain', performance.now() - s1);\n    // const s2 = performance.now()\n    const diff = getObjectDiff(this.baseReference, referenceChain, obj, this.precision);\n    // console.log('s2', performance.now() - s2);\n    return diff;\n  }\n\n  getObjFromDiffAndReference(\n    diff: Object,\n    refName: string,\n  ) {\n    const referenceChain = this.getReferenceChain(refName, []);\n    const diffs = [...referenceChain, diff];\n    return refAndDiffToObject(this.baseReference, ...diffs);\n  }\n\n  add(time: number, obj: Object, refName: string = this.lastReferenceName, timeCount: number = 0) {\n    if (this.baseReference == null) {\n      this.setBaseReference(obj);\n    }\n    const diff = this.getDiffToReference(obj, refName);\n    this.diffs.push([time, refName, diff, timeCount]);\n  }\n\n  addWithWorker(\n    time: number,\n    obj: Object,\n    refName: string = this.lastReferenceName,\n    timeCount: number = 0,\n  ) {\n    if (this.baseReference == null) {\n      this.setBaseReference(obj);\n    }\n    this.startWorker();\n    if (this.worker != null) {  // $FlowFixMe\n      this.worker.postMessage([time, refName, obj, timeCount]);\n    }\n  }\n\n  startWorker() {\n    if (this.worker != null) {\n      return;\n    }\n    // $FlowFixMe\n    this.worker = new Worker();\n\n    // // $FlowFixMe\n    // this.worker.addEventListener('message', function (event) {\n    //   console.log(event.data)\n    // });\n  }\n\n  getFromIndex(index: number) {\n    if (index > this.diffs.length) {\n      return null;\n    }\n    const [, basedOn, diff] = this.diffs[index];\n    return this.getObjFromDiffAndReference(diff, basedOn);\n  }\n}\n\nclass Subscriber {\n  fnMap: FunctionMap;\n  subscribers: {\n    [id: string]: {\n      callback: string | () => void;\n      num: number;\n    }\n  };\n\n  order: Array<string>;\n\n  nextId: number;\n\n  constructor(fnMap: FunctionMap = new FunctionMap()) {\n    this.fnMap = fnMap;\n    this.subscribers = {};\n    this.nextId = 0;\n    this.order = [];\n  }\n\n  add(callback: string | () => void, numberOfSubscriptions: number = -1) {\n    this.subscribers[`${this.nextId}`] = {\n      callback,\n      num: numberOfSubscriptions,\n    };\n    this.order.push(`${this.nextId}`);\n    this.nextId += 1;\n    return this.nextId - 1;\n  }\n\n  publish(payload: any) {\n    const subscribersToRemove = [];\n    for (let i = 0; i < this.order.length; i += 1) {\n      const id = this.order[i];\n      const { callback, num } = this.subscribers[id];\n      // if (callback != null) {\n      //   callback(payload);\n      // }\n      if (num === 1) {\n        subscribersToRemove.push(id);\n      }\n      let publishOk = false;\n      if (num !== 0) {\n        publishOk = true;\n        // subscribersToRemove.push(id);\n      }\n      if (num > 0) {\n        this.subscribers[`${id}`].num = num - 1;\n      }\n\n      // if (num > 0) {\n      // }\n      // else if (num > 1) {\n      //   publishOk = true;\n      //   this.subscribers[`${id}`].num = num - 1;\n      // }\n      // if (this.subscribers[`${id}`].num > 0) {\n      if (publishOk) {\n        this.fnMap.exec(callback, payload);\n      }\n    }\n    subscribersToRemove.forEach((id) => { this.remove(id); });\n  }\n\n  remove(idIn: string | number) {\n    const id = `${idIn}`;\n    if (this.subscribers[id] != null) {\n      delete this.subscribers[id];\n    }\n    const index = this.order.indexOf(id);\n    if (index > -1) {\n      this.order.splice(index, 1);\n    }\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  _excludeStateKeys() {\n    return ['fnMap'];\n  }\n}\n\nclass SubscriptionManager {\n  fnMap: FunctionMap;\n  subscriptions: {\n    [subscriptionName: string]: Subscriber;\n  }\n\n  constructor(fnMap: FunctionMap = new FunctionMap()) {\n    this.subscriptions = {};\n    this.fnMap = fnMap;\n  }\n\n  add(\n    subscriptionName: string,\n    callback: string | () => void,\n    numberOfSubscriptions: number = -1,\n  ) {\n    if (this.subscriptions[subscriptionName] == null) {\n      this.subscriptions[subscriptionName] = new Subscriber(this.fnMap);\n    }\n    return this.subscriptions[subscriptionName].add(callback, numberOfSubscriptions);\n  }\n\n  publish(subscriptionName: string, payload: any) {\n    if (this.subscriptions[subscriptionName] != null) {\n      this.subscriptions[subscriptionName].publish(payload);\n    }\n  }\n\n  remove(subscriptionName: string, id: string | number) {\n    if (this.subscriptions[subscriptionName] != null) {\n      const subscription = this.subscriptions[subscriptionName];\n      subscription.remove(id);\n      if (subscription.order.length === 0) {\n        delete this.subscriptions[subscriptionName];\n      }\n    }\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  _excludeStateKeys() {\n    return ['fnMap'];\n  }\n}\n\nfunction download(filename: string, text: string) {\n  const element = document.createElement('a');\n  element.setAttribute(\n    'href',\n    `data:text/plain;charset=utf-8,${encodeURIComponent(text)}`,\n  );\n  element.setAttribute('download', filename);\n  element.style.display = 'none';\n  const { body } = document;\n  if (body != null) {\n    body.appendChild(element);\n    element.click();\n    body.removeChild(element);\n  }\n}\n\nfunction splitString(str: string, token: string = '|', escape: string = '') {\n  const letters = str.split('');\n  const split = [];\n  let currentSplit = [];\n  let escaped = false;\n  let escapedEscape = false;\n  let tokenStringIndex = 0;\n  letters.forEach((letter) => {\n    currentSplit.push(letter);\n    if (tokenStringIndex === 0 && letter === escape && escaped === false) {\n      escaped = true;\n    } else if (letter === escape && tokenStringIndex === 0 && escaped) {\n      escapedEscape = true;\n    } else if (letter === token[tokenStringIndex]) {\n      tokenStringIndex += 1;\n    } else {\n      tokenStringIndex = 0;\n      escaped = false;\n    }\n    if (tokenStringIndex === token.length) {\n      if (!escaped) {\n        const newSplitString = currentSplit.slice(0, -token.length).join('');\n        if (newSplitString.length > 0) {\n          split.push(newSplitString);\n        }\n        currentSplit = [];\n      } else {\n        const preEscape = currentSplit.slice(0, -token.length - escape.length);\n        const postEscape = currentSplit.slice(-token.length);\n        currentSplit = [...preEscape, ...postEscape];\n      }\n      escaped = false;\n      tokenStringIndex = 0;\n    }\n    if (escapedEscape) {\n      escapedEscape = false;\n      escaped = false;\n      currentSplit = currentSplit.slice(0, -1);\n    }\n  });\n  if (currentSplit.length > 0) {\n    split.push(currentSplit.join(''));\n  }\n  return split;\n}\n\nexport {\n  diffPathsToObj, diffObjToPaths,\n  Console,\n  classify, extractFrom, ObjectKeyPointer, getElement,\n  addToObject, duplicateFromTo, isTouchDevice,\n  generateUniqueId, joinObjects, cleanUIDs, loadRemote, loadRemoteCSS,\n  deleteKeys, copyKeysFromTo, generateRandomString,\n  duplicate, assignObjectFromTo, joinObjectsWithOptions,\n  objectToPaths, getObjectDiff, updateObjFromPath, pathsToObj,\n  UniqueMap, compressObject, refAndDiffToObject, uncompressObject,\n  unminify, minify, ObjectTracker,\n  download,\n  Subscriber,\n  SubscriptionManager,\n  getFromObject,\n  splitString,\n};\n\n","// @flow\n\n/**\n * Defines whether a line is solid or dashed.\n *\n * `Array<number>`\n *\n * Leave empty for solid line.\n *\n * Use array of numbers for a dashed line where indexes 0, 2, 4... are line\n * lengths and indexes 1, 3, 5... are gap lengths. If line is longer than\n * cumulative length of line and gap lengths, then pattern will repeat.\n *\n * If array length is odd, then the first element will be the offset of the\n * dash pattern - the length where the dash pattern starts. In this case index\n * 0 is the offset, indexes 1, 3, 5... are the dash lengths and indexes 2, 4,\n * 6... are the gap lengths.\n *\n * For example [0.1, 0.01, 0.02, 0.01] produces 0.1 length dash, then a 0.01\n * length gap, then a 0.02 length dash, then a 0.01 length gap. This pattern\n * will repeat for the length of the line.\n */\nexport type TypeDash = Array<number>;\n\n/**\n * Defines a color\n *\n * `[number, number, number, number]`\n *\n * Color is defined as an RGBA array with values between 0 and 1. The alpha\n * channel defines the transparency or opacity of the color where\n * 1 is fully opaque and 0 is fully transparent.\n */\nexport type TypeColor = Array<number>;\n\n/**\n  Curved Corner Definition\n */\nexport type OBJ_CurvedCorner = {\n  radius?: number,\n  sides?: number,\n};\n\n/* eslint-disable max-len */\n/**\n * Font definition object.\n *\n * Text is drawn in a [Context2D canvas](https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D) and so `family`, `style` and `weight` are any valid [options](https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/font).\n *\n * `size` is the vertex space size of the font.\n *\n * @property {string} [family] The font family (`Times New Roman`)\n * @property {`normal` | `italic`} [style] (`normal`)\n * @property {number} [size] size of font in vertex space (`0.2`)\n * @property {'normal' | 'bold' | 'lighter' | 'bolder' | '100' | '200' | '300' | '400' | '500' | '600' | '700' | '800' | '900'} [weight]\n * font weight (`200`)\n * @property {[number, number, number, number]} [color] Font color\n * [red, green, blue, alpha] between 0 and 1 - (`[1, 0, 0, 1]`)\n * @property {number} [opacity] opacity multiplier (final opacity will be\n * `opacity` * `color` alpha) [`1`]\n * @example\n * // Full font definition\n * const font = new FigureFont({\n *   family: 'Helvetica',\n *   style: 'italic',\n *   weight: 'bold',\n *   color: [1, 1, 0, 1],\n *   opacity: 1,\n * });\n * @example\n * // Define style only, remaining properties are defaults\n * const font = new FigureFont({\n *   style: 'italic',\n * });\n */\nexport type OBJ_Font = {\n  family?: string,\n  style?: 'normal' | 'italic',\n  size?: number,\n  weight?: 'normal' | 'bold' | 'lighter' | 'bolder' | '100' | '200' | '300' | '400' | '500' | '600' | '700' | '800' | '900',\n  color?: TypeColor | null,\n  opacity?: number,\n};\n\nexport type OBJ_Font_Fixed = {\n  family: string,\n  style: 'normal' | 'italic',\n  size: number,\n  weight: 'normal' | 'bold' | 'lighter' | 'bolder' | '100' | '200' | '300' | '400' | '500' | '600' | '700' | '800' | '900',\n  color: TypeColor | null,\n  opacity: number,\n};\n\nconst doNothing = 1;\nexport default doNothing;\n"],"sourceRoot":""}