!function(e){var n={};function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:r})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(t.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var i in e)t.d(r,i,function(n){return e[n]}.bind(null,i));return r},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="",t(t.s=0)}([function(e,n,t){"use strict";t.r(n);var r=function(e,n){var t=1<arguments.length&&void 0!==n?n:5,r=Math.pow(10,t),i=Math.round(e*r)/r;return-0!==i||0===i&&1/i!=-1/0||(i=0),i};function i(e){return function(e){if(Array.isArray(e))return f(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||o(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,n){if(e){if("string"==typeof e)return f(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?f(e,n):void 0}}function f(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e){if("number"==typeof e||"boolean"==typeof e||"string"==typeof e||null==e||NaN===e||"function"==typeof e)return e;if("function"==typeof e._dup)return e._dup();if(Array.isArray(e)){var n=[];return e.forEach((function(e){return n.push(c(e))})),n}var t={};return Object.keys(e).forEach((function(n){var r=c(e[n]);t[n]=r})),t}function s(e,n,t,i){var o=1<arguments.length&&void 0!==n?n:"",f=2<arguments.length&&void 0!==t?t:{},a=3<arguments.length&&void 0!==i?i:null;return"string"==typeof e||"boolean"==typeof e||"function"==typeof e?f["".concat(o)]=e:"number"==typeof e?f["".concat(o)]=null!=a?r(e,a):e:null===e?f["".concat(o)]=null:void 0===e||(Array.isArray(e)?e.forEach((function(e,n){s(e,"".concat(o,"[").concat(n,"]"),f,a)})):Object.keys(e).forEach((function(n){s(e[n],"".concat(o,".").concat(n),f,a)}))),f}function u(e,n,t,r){var i=3<arguments.length&&void 0!==r&&r,o=e[0];if(0!==o.length){var f=o.match(/\[[^\]]*\]/g),c=o.replace(/\[.*/,"");if(1!==e.length||!i||f){if(f){var s=f.map((function(e){return parseInt(e.replace(/\[|\]/g,""),10)}));null!=n[c]&&Array.isArray(n[c])||(n[c]=[]);for(var l=n[c],d=0,h=0;h<s.length;h+=1){if(d=s[h],l.length<=d)for(var y=l.length;y<d-l.length+1;y+=1)l.push(void 0);h<s.length-1&&(Array.isArray(l[d])||(l[d]=[]),l=l[d])}return 1===e.length&&i?void(l[d]=void 0):1===e.length?void(l[d]=t):(null!=l[d]&&"object"===a(l[d])||(l[d]={}),void u(e.slice(1),l[d],t,i))}1!==e.length?(null==n[c]&&(n[c]={}),u(e.slice(1),n[c],t,i)):n[c]=t}else delete n[c]}}function l(e){var n={};return Object.keys(e).forEach((function(t){var r=t.split(".").filter((function(e){return 0<e.length})),i=e[t];Array.isArray(i)?u(r,n,i.slice(-1)[0]):u(r,n,i)})),n}function d(e){for(var n=c(e),t=function(e,t){var r=1<arguments.length&&void 0!==t&&t;Object.keys(e).forEach((function(t){var i=t.split(".").filter((function(e){return 0<e.length})),o=e[t];Array.isArray(o)?u(i,n,o.slice(-1)[0],r):u(i,n,o,r)}))},r=arguments.length,i=new Array(1<r?r-1:0),o=1;o<r;o++)i[o-1]=arguments[o];return i.forEach((function(e){var n=e.added,r=e.removed,i=e.diff;null!=r&&t(r,!0),null!=n&&t(n),null!=i&&t(i)})),n}function h(e){var n={};return e.diff&&0<Object.keys(e.diff).length&&(n.diff=l(e.diff)),e.added&&0<Object.keys(e.added).length&&(n.added=l(e.added)),e.removed&&0<Object.keys(e.removed).length&&(n.removed=l(e.removed)),n}function y(e){var n={};return e.diff&&0<Object.keys(e.diff).length&&(n.diff=s(e.diff)),e.added&&0<Object.keys(e.added).length&&(n.added=s(e.added)),e.removed&&0<Object.keys(e.removed).length&&(n.removed=s(e.removed)),n}var v=function(){function e(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:8;(function(n){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")})(this),this.precision=n,this.reset()}return function(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(e.prototype,[{key:"toObj",value:function(){var e=this,n={};Object.keys(this.references).forEach((function(t){n[t]={basedOn:e.references[t].basedOn,diff:h(e.references[t].diff)}}));var t=this.diffs.map((function(e){return[e[0],e[1],h(e[2]),e[3]]}));return{baseReference:c(this.baseReference),diffs:t,references:n,precision:this.precision,lastReferenceName:this.lastReferenceName}}},{key:"setFromObj",value:function(e){var n={};Object.keys(e.references).forEach((function(t){n[t]={basedOn:e.references[t].basedOn,diff:y(e.references[t].diff)}})),this.references=n,this.baseReference=c(e.baseReference),this.precision=e.precision,this.diffs=e.diffs.map((function(e){return[e[0],e[1],y(e[2]),e[3]]})),this.lastReferenceName=e.lastReferenceName}},{key:"reset",value:function(){this.baseReference=null,this.references={},this.diffs=[],this.lastReferenceName="__base"}},{key:"setBaseReference",value:function(e){this.baseReference=c(e),this.lastReferenceName="__base"}},{key:"addReference",value:function(e,n,t){var r=2<arguments.length&&void 0!==t?t:"__base";null!=this.baseReference&&"__base"!==n||this.setBaseReference(e),"__base"!==n&&(this.references[n]={diff:this.getDiffToReference(e,r),basedOn:r},this.lastReferenceName=n)}},{key:"getReferenceChain",value:function(e,n){return"__base"===e||null==this.references[e]?n:this.getReferenceChain(this.references[e].basedOn,[this.references[e].diff].concat(i(n)))}},{key:"getReference",value:function(e){var n=this.getReferenceChain(e,[]);return d.apply(void 0,[this.baseReference].concat(i(n)))}},{key:"getDiffToReference",value:function(e,n){var t=this.getReferenceChain(n,[]);return function(e,n,t,r,o){var f=3<arguments.length&&void 0!==r?r:null,a=4<arguments.length&&!1,c=e;0<n.length&&(c=d.apply(void 0,[e].concat(i(n))));var u=s(c,"",{},f),l=s(t,"",{},f),h={},y={},v={};Object.keys(u).forEach((function(e){void 0!==l[e]?u[e]!==l[e]&&(y[e]=a?[u[e],l[e]]:l[e]):v[e]=u[e]})),Object.keys(l).forEach((function(e){void 0===u[e]&&(h[e]=l[e])}));var b={};return 0<Object.keys(y).length&&(b.diff=y),0<Object.keys(h).length&&(b.added=h),0<Object.keys(v).length&&(b.removed=v),b}(this.baseReference,t,e,this.precision)}},{key:"getObjFromDiffAndReference",value:function(e,n){var t=this.getReferenceChain(n,[]),r=[].concat(i(t),[e]);return d.apply(void 0,[this.baseReference].concat(i(r)))}},{key:"add",value:function(e,n,t,r){var i=2<arguments.length&&void 0!==t?t:this.lastReferenceName,o=3<arguments.length&&void 0!==r?r:0;null==this.baseReference&&this.setBaseReference(n);var f=this.getDiffToReference(n,i);this.diffs.push([e,i,f,o])}},{key:"addWithWorker",value:function(e,n,t,r){var i=2<arguments.length&&void 0!==t?t:this.lastReferenceName,o=3<arguments.length&&void 0!==r?r:0;null==this.baseReference&&this.setBaseReference(n),this.startWorker(),null!=this.worker&&this.worker.postMessage([e,i,n,o])}},{key:"startWorker",value:function(){null==this.worker&&(this.worker=new Worker)}},{key:"getFromIndex",value:function(e){if(e>this.diffs.length||0===this.diffs.length)return null;var n,t=function(e){if(Array.isArray(e))return e}(n=this.diffs[e])||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var n=[],t=!0,r=!1,i=void 0;try{for(var o,f=e[Symbol.iterator]();!(t=(o=f.next()).done)&&(n.push(o.value),3!==n.length);t=!0);}catch(e){r=!0,i=e}finally{try{t||null==f.return||f.return()}finally{if(r)throw i}}return n}}(n)||o(n,3)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),r=t[1],i=t[2];return this.getObjFromDiffAndReference(i,r)}}]),e}(),b=new v;addEventListener("message",(function(e){var n=e.data,t=n.message,r=n.payload;"reset"===t?((b=new v).baseReference=r.baseReference,b.references=r.references):"get"===t?postMessage({message:"cache",payload:{baseReferece:b.baseReference,references:b.references,diffs:b.diffs}}):"add"===t?b.add(r.now,r.state,r.reference,r.lastRecordTimeCount):"addReference"===t&&b.addReference(r.state,r.refName,r.basedOn)}))}]);