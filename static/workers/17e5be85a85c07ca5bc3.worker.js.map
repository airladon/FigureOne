{"version":3,"sources":["webpack://Fig/webpack/bootstrap","webpack://Fig/./src/js/figure/Recorder/recorder.worker.js","webpack://Fig/./src/js/tools/FunctionMap.js","webpack://Fig/./src/js/tools/math.js","webpack://Fig/./src/js/tools/tools.js"],"names":["cache","ObjectTracker","addEventListener","event","data","message","payload","baseReference","references","postMessage","baseReferece","diffs","add","now","state","reference","lastRecordTimeCount","addReference","refName","basedOn","GeneralFunctionMap","map","id","fn","idOrFn","args","length","mapsIn","maps","i","GlobalFunctionMap","instance","FunctionMap","global","execOnMaps","roundNum","value","precision","multiplier","result","Math","round","objectIsPolyfill","x","y","arrayOrValue","Array","isArray","elem","clipMag","zeroThreshold","maxValue","zeroT","maxV","clipValue","minValue","clipped","decelerate","getPositionVelocityFromDecAndTime","position","velocity","magDeceleration","time","decel","v","p","d","sign","abs","newVelocity","newSign","t","z","zSign","newPosition","linear","percentTime","invert","triangle","deltaTime","frequency","bias","mag","phaseOffset","PI","asin","sin","easeinout","a","sqrt","percentDistance","easeout","b","power","easein","sinusoid","sinusoidAbs","range","start","stop","step","out","push","randSign","random","randInt","minOrMax","max","r","min","floor","rand","plusOrMinus","randElement","inputArray","index","removeRandElement","splice","randElements","num","possibleIndeces","elements","rand2D","minX","minY","maxX","maxY","Console","console","log","classify","key","nonEmpty","withKey","startsWith","joinStr","split","join","ObjectKeyPointer","object","apply","undefined","extractFrom","objectToExtractFrom","keyValues","keyPrefix","keySeparator","keyHeirarchy","keys","filter","k","prefixAndKey","slice","forEach","kv","Object","obj","getFromObject","objectToGetFrom","keyPath","levelSeparator","getElement","collection","addToObject","valueToAdd","levels","currentLevel","level","prototype","hasOwnProperty","call","duplicate","NaN","_dup","arrayDup","arrayElement","objectDup","assignObjectFromTo","fromObject","toObject","exceptIn","duplicateValues","parentPath","except","indexOf","_assignAsLinkOnly","toValue","joinObjectsWithOptions","options","dup","o","joinObjects","objects","duplicateFromTo","exceptKeys","zeroPad","places","zero","toString","UniqueIdGenerator","singleton","initialize","seeds","seed","generateUniqueId","getId","isTouchDevice","prefixes","mq","query","window","matchMedia","matches","DocumentTouch","document","loadRemote","scriptId","url","callback","existingScript","getElementById","script","createElement","type","src","body","appendChild","onload","loadRemoteCSS","link","rel","href","cleanUIDs","objectToClean","genericUID","uid","deleteKeys","copyKeysFromTo","source","destination","generateRandomString","UniqueMap","inverseMap","letters","undefinedCode","pathStr","unique","getNextUniqueString","order","remainder","factor","uniqueStr","compressObject","strValues","uncompress","get","objKeys","obj2","uncompressObject","minify","objectOrArray","minified","unminify","minObjectOrArray","uMap","makeInverseMap","objectToPaths","path","pathObj","getObjectDiff","obj1In","debug","obj1","refAndDiffToObject","paths1","paths2","added","diff","removed","key1","key2","updateObjFromPath","remainingPath","remove","fullP","arrayStringIndeces","match","replace","arrayIndeces","e","parseInt","currentArray","j","pathsToObj","paths","referenceIn","ref","processPaths","diffsIn","diffIn","diffPathsToObj","diffObjToPaths","reset","lastReferenceName","setBaseReference","getDiffToReference","name","chain","getReferenceChain","referenceChain","timeCount","startWorker","worker","Worker","getObjFromDiffAndReference","Subscription","fnMap","subscribers","nextId","numberOfPublications","functionArgument","subscribersToRemove","publishOk","exec","subscirberId","NotificationManager","notifications","subscriptionName","numberOfSubscriptions","publish","subscriberId","subscription","download","filename","text","element","setAttribute","encodeURIComponent","style","display","click","removeChild","splitString","str","token","escape","currentSplit","escaped","escapedEscape","tokenStringIndex","letter","newSplitString","preEscape","postEscape","PerformanceTimer","stamps","performance","label","lastTime","cumTime","stamp","delta","figureOneDebug","misc","deltas"],"mappings":"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","file":"17e5be85a85c07ca5bc3.worker.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./node_modules/babel-loader/lib/index.js?!./src/js/figure/Recorder/recorder.worker.js\");\n","import {\n  ObjectTracker,\n} from '../../tools/tools';\n\nlet cache = new ObjectTracker();\n\n// eslint-disable-next-line no-restricted-globals\naddEventListener('message', (event) => {\n  const { message, payload } = event.data;\n  if (message === 'reset') {\n    cache = new ObjectTracker();\n    cache.baseReference = payload.baseReference;\n    cache.references = payload.references;\n  } else if (message === 'get') {\n    postMessage({\n      message: 'cache',\n      payload: {\n        baseReferece: cache.baseReference,\n        references: cache.references,\n        diffs: cache.diffs,\n      },\n    });\n  } else if (message === 'add') {\n    cache.add(payload.now, payload.state, payload.reference, payload.lastRecordTimeCount);\n  } else if (message === 'addReference') {\n    cache.addReference(payload.state, payload.refName, payload.basedOn);\n  }\n});\n","// @flow\n// import type { Transform } from '../tools/g2';\n// import { Point, getTransform, Transform } from '../tools/g2';\n// import { round } from '../tools/math';\n// import type { FigureElement } from './Element';\n// import GlobalAnimation from './webgl/GlobalAnimation';\n\n// Singleton class that contains projects global functions\n\nclass GeneralFunctionMap {\n  map: { [id: string]: {\n    fn: Function,\n  }}\n\n  constructor() {\n    this.map = {};\n  }\n\n  add(id: string, fn: Function) {\n    if (this.map == null) {\n      this.map = {};\n    }\n    this.map[id] = {\n      fn,\n    };\n  }\n\n  exec(idOrFn: string | Function | null, ...args: any) {\n    if (idOrFn == null) {\n      return null;\n    }\n    if (typeof idOrFn === 'string') {\n      // return this.fnMap.exec(fn, ...args);\n      if (this.map[idOrFn] != null) {\n        if (args.length === 0) {\n          return this.map[idOrFn].fn();\n        }\n        return this.map[idOrFn].fn(...args);\n      }\n    }\n    if (typeof idOrFn === 'function') {\n      return idOrFn(...args);\n    }\n    return null;\n  }\n\n  execOnMaps(idOrFn: string | Function | null, mapsIn: Array<Object>, ...args: any) {\n    if (idOrFn == null) {\n      return null;\n    }\n    if (typeof idOrFn === 'string') {\n      const maps = [this.map, ...mapsIn];\n      for (let i = 0; i < maps.length; i += 1) {\n        const map = maps[i];\n        if (map[idOrFn] != null) {\n          if (args.length === 0) {\n            return map[idOrFn].fn();\n          }\n          return map[idOrFn].fn(...args);\n        }\n      }\n    }\n    if (typeof idOrFn === 'function') {\n      return idOrFn(...args);\n    }\n    return null;\n  }\n}\n\n\nclass GlobalFunctionMap extends GeneralFunctionMap {\n  static instance: Object;\n  constructor() {\n    // If the instance alread exists, then don't create a new instance.\n    // If it doesn't, then setup some default values.\n    if (!GlobalFunctionMap.instance) {\n      super();\n      GlobalFunctionMap.instance = this;\n      this.map = {};\n    }\n    return GlobalFunctionMap.instance;\n  }\n}\n\n/**\n * Function Map\n *\n * In FigureOne {@link Recorder}, state is saved in stringified javascript\n * objects. When the state includes a function (like a trigger method in an\n * animation for example) then that function is referenced in the state object\n * as a unique string id.\n *\n * When a geometry is loaded, functions that will be captured in state objects\n * need to be added to a function map. Both {@link Figure} and\n * {@link FigureElement} have attached function maps as the property `fnMap`.\n * Therefore, the method is added to either the figure or element function map,\n * with an associated unique string id, and that string id is used when the\n * function is used. For example as defined callbacks, triggerAnimationStep and\n * customAnimationStep callbacks, or recorder slide definitions (`entryState`,\n * `steadyState`, `leaveState`, `exec`, `execDelta`).\n *\n * The funciton map has:\n * - A map of functions\n * - A link to a global map of functions (a singleton)\n * - The ability to execute a function within the map\n *\n * @property {FunctionMap} global global function map\n * @property {Object} map local function map where keys are unique identifiers\n * and values are the associated functions\n */\nclass FunctionMap extends GeneralFunctionMap {\n  map: { [id: string]: {\n    fn: Function,\n  }}\n\n  global: GlobalFunctionMap;\n\n  constructor() {\n    super();\n    this.global = new GlobalFunctionMap();\n  }\n\n  /**\n   * Execute function with arguments.\n   *\n   * @param {string | Function | null} idOrFn If `string`, then a function\n   * in the local map or global map will be executed (local map takes\n   * precedence). If `Function`, then the\n   * function will be exectuted. If `null`, then nothing will happen.\n   * @param {any} ...args arguments to pass to function.\n   */\n  exec(idOrFn: string | Function | null, ...args: any) {\n    return this.execOnMaps(idOrFn, [this.global.map], ...args);\n  }\n\n  execOnMaps(idOrFn: string | Function | null, mapsIn: Array<Object>, ...args: any) {\n    return super.execOnMaps(idOrFn, [...mapsIn, this.global.map], ...args);\n  }\n\n  /**\n   * Add a function to the map.\n   * @param {string} id unique identifier\n   * @param {Function} fn function to add\n   */\n  add(id: string, fn: Function) {\n    return super.add(id, fn);\n  }\n}\n\nexport { FunctionMap, GlobalFunctionMap };\n","// @flow\n\nconst roundNum = (value: number, precision: number = 5): number => {\n  const multiplier = 10 ** precision;\n  let result = Math.round(value * multiplier) / multiplier;\n  // if (Object.is(result, -0)) {\n  // if (result === -0) {\n  //   result = 0;\n  // }\n  const objectIsPolyfill = (x, y) => {\n    if (x === y) {\n      // 0 === -0, but they are not identical\n      return x !== 0 || 1 / x === 1 / y;\n    }\n    // NaN !== NaN, but they are identical.\n    // NaNs are the only non-reflexive value, i.e., if x !== x,\n    // then x is a NaN.\n    // isNaN is broken: it converts its argument to number, so\n    // isNaN(\"foo\") => true\n    // eslint-disable-next-line no-self-compare\n    return x !== x && y !== y;\n  };\n  if (objectIsPolyfill(result, -0)) {\n    result = 0;\n  }\n  // if (result === -0) {\n  //   // 0 === -0, but they are not identical\n  //   return result !== 0 || 1 / x === 1 / y;\n  // }\n\n  return result;\n};\n\ntype TypeRoundObject = {\n  round?: (number) => TypeRoundObject;\n} & Object;\n/**\n * Rounds a number or numbers in an array\n * @method\n * @param {number | Array<number>} arrayOrValue - Value or array of values to be rounded\n * @param {number} precision - Number of decimal places to round to\n * @returns {number | Array<number>} Rounded value or array of values\n */\nfunction round<T: number | TypeRoundObject | Array<number | TypeRoundObject>>(\n  arrayOrValue: T,\n  precision: number = 5,\n): T {\n  let result = 0;\n  if (Array.isArray(arrayOrValue)) {\n    return arrayOrValue.map(elem => round(elem, precision));\n  }\n  if (typeof arrayOrValue === 'number') {\n    result = roundNum(arrayOrValue, precision);\n  } else if (arrayOrValue != null && arrayOrValue.round != null) {\n    result = arrayOrValue.round(precision);\n  }\n  // $FlowFixMe\n  return result;\n}\n\n\n// // clipValue clips a value to either 0 if it's small enough, or to a max value\n// // Value, and maxValue are sign independent. e.g.\n// //    * value, maxValue = 2, 1 => clips to 1\n// //    * value, maxValue = -2, -1 => clips to -1\n// //    * value, maxValue = -2, 1 => clips to -1\n// //    * value, maxValue = 2, -1 => clips to 1\n// function clipValue(\n//   value: number,\n//   zeroThreshold: number,\n//   maxValue: number = 0,\n// ) {\n//   let result = value;\n//   let zero = zeroThreshold;\n//   if (zero < 0) {\n//     zero = -zero;\n//   }\n//   if (value > -zero && value < zero) {\n//     return 0;\n//   }\n//   let max = maxValue;\n//   if (max < 0) {\n//     max = -max;\n//   }\n\n//   if (value > max) {\n//     result = max;\n//   }\n//   if (value < -max) {\n//     result = -max;\n//   }\n//   return result;\n// }\n\n\n// Clip a value to either max velocity, or 0 once under the minimum\n// threashold.\n//  * velocity: can be positive or negative\n//  * maxVelocity will clip velocity to:\n//      * |maxVelocity| if velocity > 0\n//      * -|maxVelocity| if velcity < 0\n//  * zeroThreshold will clip velocity to:\n//       * 0 if velocity is larger than -|zeroThreshold| and smaller than\n//         |zeroThreshold|.\nfunction clipMag(\n  value: number,\n  zeroThreshold: number | null,\n  maxValue: number | null,\n): number {\n  let result = value;\n  let zeroT = zeroThreshold;\n  let maxV = maxValue;\n\n  if (zeroT === null) {\n    zeroT = 0;\n  }\n  if (zeroT < 0) {\n    zeroT = -zeroT;\n  }\n  if (maxV === null) {\n    return result;\n  }\n  if (maxV < 0) {\n    maxV = -maxV;\n  }\n  if (value >= -zeroT && value <= zeroT) {\n    result = 0;\n  }\n  if (value > maxV) {\n    result = maxV;\n  }\n  if (value < -maxV) {\n    result = -maxV;\n  }\n  return result;\n}\n\nfunction clipValue(\n  value: number,\n  minValue: number | null,\n  maxValue: number | null,\n): number {\n  let clipped = value;\n  if (minValue !== null) {\n    if (value < minValue) {\n      clipped = minValue;\n    }\n  }\n\n  if (maxValue !== null) {\n    if (value > maxValue) {\n      clipped = maxValue;\n    }\n  }\n  return clipped;\n}\n\nconst decelerate = function getPositionVelocityFromDecAndTime(\n  position: number,\n  velocity: number,\n  magDeceleration: number | null,\n  time: number,\n  zeroThreshold: number | null,\n) {\n  let zeroT: number = 0;\n  if (zeroThreshold !== null) {\n    zeroT = zeroThreshold;\n  }\n  let decel: number = 0;\n  if (magDeceleration !== null) {\n    decel = magDeceleration;\n  }\n  // If the velocity is currently 0, then no further deceleration can occur, so\n  // return the current velocity and position\n  const v = clipMag(velocity, zeroT, velocity);\n  if (v === 0) {\n    return {\n      p: position,\n      v: 0,\n    };\n  }\n\n  let d = decel;\n  if (decel < 0) {\n    d = -d;\n  }\n  // If there is some initial velocity, then calc its sign and\n  const sign = velocity / Math.abs(velocity);\n  let newVelocity = velocity - sign * d * time;\n\n  // if the new velocity changes sign, then it should go to 0. If it doesn't\n  // change sign, then clip incase it should go to 0 because it is below\n  // the zero velocity threshold.\n  const newSign = newVelocity / Math.abs(newVelocity);\n  if (newSign !== sign) {\n    newVelocity = 0;\n  } else {\n    newVelocity = clipMag(newVelocity, zeroT, newVelocity);\n  }\n\n  // If the new velocity is clipped, then we need to use the time to where the\n  // velocity crosses the clipping point.\n  // v_new = v_init + a*t\n  // Therefore, if v_new = zeroT: t = (zeroT - vi)/a\n  let t = time;\n  if (newVelocity === 0) {\n    let z = zeroT;\n    const zSign = z / Math.abs(z);\n    if (zSign !== sign) {\n      z = -z;\n    }\n    t = Math.abs((z - velocity) / d);\n  }\n  // Now can calculate the new position\n  const newPosition = position + velocity * t - sign * 0.5 * d * t * t;\n\n  return {\n    p: newPosition,\n    v: newVelocity,\n  };\n};\n\n\nconst linear = (percentTime: number, invert: ?boolean = false) => {\n  if (invert) {\n    return percentTime;\n  }\n  return percentTime;\n};\n\nfunction triangle(\n  deltaTime: number = 1,\n  frequency: number = 1,\n  bias: number = 0,\n  mag: number = 1,\n  phaseOffset: number = 0,\n) {\n  return bias + 2 * mag / Math.PI\n    * Math.asin(Math.sin(2 * Math.PI * frequency * deltaTime + phaseOffset));\n  // return bias + mag * Math.sin(deltaTime * frequency * 2.0 * Math.PI + phaseOffset);\n}\n\nconst easeinout = (percentTime: number, invert: ?boolean = false) => {\n  if (invert) {\n    if (percentTime === 0.5) {\n      return 0.5;\n    }\n    const a = percentTime;\n    return (2 * a - Math.sqrt(-4 * a * a + 4 * a)) / (4 * a - 2);\n  }\n  const x = percentTime;\n  const percentDistance = (x ** 2) / ((x ** 2) + ((1 - x) ** 2));\n  return percentDistance;\n};\n\nfunction easeout(percentTime: number, invert: ?boolean = false) {\n  if (invert) {\n    if (percentTime === 0) {\n      return 0;\n    }\n    const a = percentTime / 2 + 0.5;\n    const b = (2 * a - Math.sqrt(-4 * a * a + 4 * a)) / (4 * a - 2);\n    return (b - 0.5) * 2;\n  }\n  const x = 0.5 + percentTime / 2;\n  const power = 2;\n  const percentDistance = (x ** power) / ((x ** power) + ((1 - x) ** power));\n  return (percentDistance - 0.5) * 2;\n}\n\nfunction easein(percentTime: number, invert: ?boolean = false) {\n  if (invert) {\n    if (percentTime === 1) {\n      return 1;\n    }\n    const a = percentTime / 2;\n    const b = (2 * a - Math.sqrt(-4 * a * a + 4 * a)) / (4 * a - 2);\n    return b * 2;\n  }\n  const x = percentTime / 2;\n  const power = 2;\n  const percentDistance = (x ** power) / ((x ** power) + ((1 - x) ** power));\n  return percentDistance * 2;\n}\n\nfunction sinusoid(\n  deltaTime: number = 1,\n  frequency: number = 1,\n  bias: number = 0,\n  mag: number = 1,\n  phaseOffset: number = 0,\n) {\n  return bias + mag * Math.sin(deltaTime * frequency * 2.0 * Math.PI + phaseOffset);\n}\n\nfunction sinusoidAbs(\n  deltaTime: number = 1,\n  frequency: number = 1,\n  bias: number = 0,\n  mag: number = 1,\n  phaseOffset: number = 0,\n) {\n  return bias + Math.abs(mag * Math.sin(deltaTime * frequency * 2.0 * Math.PI + phaseOffset));\n}\n\n// const animationPhase = (transform, time, rotDirection = 0, animationStyle = easeinout) => {\n//     return {\n//         transform: transform._dup(),\n//         time: time,\n//         rotDirection: rotDirection,\n//         animationStyle: animationStyle,\n//     }\n// }\n\n\n/**\n * Creates an array with a range of numbers\n * @param start - Range start\n * @param stop - Range stop\n * @param step - Range step\n * @returns {Array<number>} Range of numbers in an array\n */\nfunction range(start: number, stop: number, step: number = 1, precision: number = 8) {\n  const out = [];\n  if (stop > start) {\n    for (let i = start; i <= stop; i = round(i + step, precision)) {\n      out.push(i);\n    }\n  } else {\n    for (let i = start; i >= stop; i = round(i + step, precision)) {\n      out.push(i);\n    }\n  }\n  return out;\n}\n\n/**\n * Return a -1 or 1 randomly\n * @return {number} -1 or 1\n */\nfunction randSign() {\n  return Math.random() > 0.5 ? 1 : -1;\n}\n\n/**\n * Return a random int.\n *\n * If a `max = null`, then the returned integer will be in the range of 0 to\n * `minOrMax`.\n *\n * Otherwise the returned value is in the range of `minOrMax` to `max`.\n *\n * Use `sign` to also return a random sign (negative or positive);\n *\n * @return {number} random integer\n */\nfunction randInt(minOrMax: number, max: ?number = null, sign: boolean = false) {\n  let r = 0;\n  if (max != null) {\n    const min = minOrMax;\n    r = Math.floor(Math.random() * Math.floor((max - min)) + Math.floor(min));\n  } else {\n    r = Math.floor(Math.random() * Math.floor(minOrMax));\n  }\n  if (sign) {\n    r *= randSign();\n  }\n  return r;\n}\n\n/**\n * Return a random number.\n *\n * If a `max = null`, then the returned number will be in the range of 0 to\n * `minOrMax`.\n *\n * Otherwise the returned value is in the range of `minOrMax` to `max`.\n *\n * Use `sign` to also return a random sign (negative or positive);\n *\n * @return {number} random number\n */\nfunction rand(minOrMax: number, max: ?number = null, plusOrMinus: boolean = false) {\n  let r = 0;\n  if (max != null) {\n    const min = minOrMax;\n    r = Math.random() * (max - min) + min;\n  } else {\n    r = Math.random() * minOrMax;\n  }\n  if (plusOrMinus) {\n    r *= randSign();\n  }\n  return r;\n}\n\n/**\n * Get a random element from an array.\n */\nfunction randElement<T>(inputArray: Array<T>): T {\n  const index = randInt(inputArray.length);\n  return inputArray[index];\n}\n\n/**\n * Remove and return random element from an array.\n */\nfunction removeRandElement<T>(inputArray: Array<T>): T {\n  const index = rand(inputArray.length);\n  return inputArray.splice(index, 1)[0];\n}\n\n/**\n * Get a number of random elements from an array.\n */\nfunction randElements<T>(num: number, inputArray: Array<T>): Array<T> {\n  const possibleIndeces = range(0, inputArray.length - 1, 1);\n  const elements = [];\n  for (let i = 0; i < num; i += 1) {\n    const index = removeRandElement(possibleIndeces);\n    elements.push(inputArray[index]);\n  }\n  return elements;\n}\n\nfunction rand2D(minX: number, minY: number, maxX: number, maxY: number) {\n  return {\n    x: rand(minX, maxX),\n    y: rand(minY, maxY),\n  };\n}\n\nexport {\n  round,\n  roundNum,\n  decelerate,\n  easeinout,\n  easeout,\n  easein,\n  sinusoid,\n  sinusoidAbs,\n  linear,\n  triangle,\n  clipMag,\n  clipValue,\n  range,\n  randInt,\n  rand,\n  randElement,\n  removeRandElement,\n  randElements,\n  rand2D,\n  randSign,\n};\n\n","// @flow\nimport { roundNum } from './math';\nimport { FunctionMap } from './FunctionMap';\n// import Worker from '../figure/recorder.worker.js';\n\nconst Console = (...msg: Array<any>) => {\n  console.log(...msg); // eslint-disable-line no-console\n};\n\n// function add(a: number, b: number): number {\n//   return a + b;\n// }\n\n// function mulToString(a: number, b: number): string {\n//   return (a * b).toString();\n// }\n\n// const divide = (a: number, b: number): number => a / b;\n\nconst classify = (key: string, value: string) => {\n  const nonEmpty = value || key;\n  const withKey = nonEmpty[0] === '-' || nonEmpty.startsWith(`${key}-`)\n    ? `${key} ${nonEmpty}` : nonEmpty;\n  const joinStr = ` ${key}-`;\n  return `${withKey.split(' -').join(joinStr)}`;\n};\n\nclass ObjectKeyPointer {\n  object: Object;\n  key: string;\n  constructor(object: Object, key: string) {\n    this.object = object;\n    this.key = '';\n    if (key in object) {\n      this.key = key;\n    }\n  }\n\n  setValue(value: mixed) {\n    if (this.key) {\n      this.object[this.key] = value;\n    }\n  }\n\n  execute(...args: mixed) {\n    if (this.key) {\n      return this.object[this.key].apply(null, args);\n    }\n    return undefined;\n  }\n\n  value() {\n    if (this.key) {\n      return this.object[this.key];\n    }\n    return undefined;\n  }\n}\n//\nfunction extractFrom(\n  objectToExtractFrom: Object,\n  keyValues: Object | Array<any> | string,\n  keyPrefix: string = '',\n  keySeparator: string = '_',\n) {\n  const out = [];\n  if (typeof keyValues === 'string') {\n    if (keyPrefix + keyValues in objectToExtractFrom) {\n      return new ObjectKeyPointer(objectToExtractFrom, keyPrefix + keyValues);\n    }\n    const keyHeirarchy = keyValues.split(keySeparator);\n    const keys = keyHeirarchy.filter(k => k.length > 0);\n    const prefixAndKey = `${keyPrefix}${keys[0]}`;\n    if (keys.length > 1) {\n      if (prefixAndKey in objectToExtractFrom) {\n        return extractFrom(\n          objectToExtractFrom[prefixAndKey],\n          keys.slice(1).join(keySeparator),\n          keyPrefix,\n          keySeparator,\n        );\n      }\n    } else if (keys.length === 1) {\n      if (prefixAndKey in objectToExtractFrom) {\n        return new ObjectKeyPointer(objectToExtractFrom, prefixAndKey);\n      }\n    }\n    return undefined;\n  }\n\n  if (Array.isArray(keyValues)) {\n    keyValues.forEach((kv) => {\n      const result = extractFrom(objectToExtractFrom, kv, keyPrefix, keySeparator);\n      if (result !== undefined) {\n        out.push(result);\n      }\n    });\n  } else {\n    Object.keys(keyValues).forEach((key) => {\n      if (keyPrefix + key in objectToExtractFrom) {\n        out.push({\n          obj: new ObjectKeyPointer(objectToExtractFrom, keyPrefix + key),\n          // $FlowFixMe\n          value: keyValues[key],\n        });\n      }\n    });\n  }\n  return out;\n}\n\nfunction getFromObject(\n  objectToGetFrom: Object,\n  keyPath: string,\n  levelSeparator: string = '.',\n) {\n  if (keyPath.length === 0 || keyPath === levelSeparator) {\n    return objectToGetFrom;\n  }\n  const result = extractFrom(objectToGetFrom, keyPath, '', levelSeparator);\n  if (result === undefined) {\n    return undefined;\n  }\n  // $FlowFixMe\n  return result.value();\n}\n\n// function getObjectValueFromPath(\n//   objectToExtractFrom: Object,\n//   path: string,\n//   pathSeparator: string = '.',\n// ) {\n//   const result = extractFrom(objectToExtractFrom, path, '', pathSeparator);\n//   if (result === undefined) {\n//     return undefined;\n//   }\n//   if (Array.isArray(result)) {\n//     return result[0].value();\n//   }\n//   return result.value();\n// }\n\nfunction getElement(\n  collection: Object,\n  keyValues: Object | Array<any> | string,\n) {\n  return extractFrom(collection, keyValues, '_', '_');\n}\n\n\nfunction addToObject(\n  obj: Object,\n  keyPath: string,\n  valueToAdd: mixed,\n  levelSeparator: string = '.',\n) {\n  const levels = keyPath.split(levelSeparator).filter(a => a.length > 0);\n  let currentLevel: Object = obj;\n  levels.forEach((level, index) => {\n    if (index === levels.length - 1) {\n      currentLevel[level] = valueToAdd;\n      return;\n    }\n    if (!Object.prototype.hasOwnProperty.call(currentLevel, level)) {\n      currentLevel[level] = {};\n    }\n    currentLevel = currentLevel[level];\n  });\n}\n\n// function duplicateFromTo(\n//   fromObject: Object,\n//   toObject: Object,\n//   exceptKeys: Array<string> = [],\n// ) {\n//   const copyValue = (value) => {\n//     if (typeof value === 'number'\n//         || typeof value === 'boolean'\n//         || typeof value === 'string'\n//         || value == null\n//         || typeof value === 'function') {\n//       return value;\n//     }\n//     if (typeof value._dup === 'function') {\n//       return value._dup();\n//     }\n//     if (Array.isArray(value)) {\n//       const arrayCopy = [];\n//       value.forEach(arrayElement => arrayCopy.push(copyValue(arrayElement)));\n//       return arrayCopy;\n//     }\n//     if (typeof value === 'object') {\n//       const objectCopy = {};\n//       Object.keys(value).forEach((key) => {\n//         const v = copyValue(value[key]);\n//         objectCopy[key] = v;\n//       });\n//       return objectCopy;\n//     }\n//     return value;\n//   };\n\n//   Object.keys(fromObject).forEach((key) => {\n//     if (exceptKeys.indexOf(key) === -1) {\n//       // eslint-disable-next-line no-param-reassign\n//       toObject[key] = copyValue(fromObject[key]);\n//     }\n//   });\n// }\n\nfunction duplicate(value: ?(number | boolean | string | Object)) {\n  if (typeof value === 'number'\n      || typeof value === 'boolean'\n      || typeof value === 'string'\n      || value == null\n      || value === NaN  // eslint-disable-line\n      || typeof value === 'function') {\n    return value;\n  }\n  if (typeof value._dup === 'function') {\n    return value._dup();\n  }\n  if (Array.isArray(value)) {\n    const arrayDup = [];\n    value.forEach(arrayElement => arrayDup.push(duplicate(arrayElement)));\n    return arrayDup;\n  }\n  // if (typeof value === 'object') {\n  const objectDup = {};\n  Object.keys(value).forEach((key) => {\n    const v = duplicate(value[key]);\n    objectDup[key] = v;\n  });\n  return objectDup;\n  // }\n  // return value;\n}\n\nfunction assignObjectFromTo(\n  fromObject: Object,\n  toObject: Object,\n  exceptIn: Array<string> | string = [],\n  duplicateValues: boolean = false,\n  parentPath: string = '',\n) {\n  const except = typeof exceptIn === 'string' ? [exceptIn] : exceptIn;\n  Object.keys(fromObject).forEach((key) => {\n    // debugger;\n    const keyPath = parentPath !== '' ? `${parentPath}.${key}` : key;\n    if (except.indexOf(keyPath) !== -1) {\n      return;\n    }\n    const value = fromObject[key];\n    if (typeof value === 'object' && value != null && value._assignAsLinkOnly) {\n      // eslint-disable-next-line no-param-reassign\n      toObject[key] = fromObject[key];\n      return;\n    }\n    if (typeof value === 'number'\n      || typeof value === 'boolean'\n      || typeof value === 'string'\n      || value == null\n      || typeof value === 'function'\n      || typeof value._dup === 'function'\n      || Array.isArray(value)\n    ) {\n      // Only assign the value if:\n      //    * Value is not undefined OR\n      //    * Value is undefined and toObject[key] is undefined\n      if (value !== undefined || toObject[key] === undefined) {\n        if (duplicateValues) {     // eslint-disable-next-line no-param-reassign\n          toObject[key] = duplicate(value);\n        } else {                   // eslint-disable-next-line no-param-reassign\n          toObject[key] = value;\n        }\n      }\n    } else {\n      // If the fromObject[key] value is an object, but the toObject[key] value\n      // is not an object, but then make toObject[key] an empty object\n      const toValue = toObject[key];\n      if (typeof toValue === 'number'\n        || typeof toValue === 'boolean'\n        || typeof toValue === 'string'\n        || toValue == null\n        || typeof toValue === 'function'\n        || Array.isArray(toValue)\n      ) {\n        // eslint-disable-next-line no-param-reassign\n        toObject[key] = {};\n      }\n      assignObjectFromTo(value, toObject[key], except, duplicateValues, keyPath);\n    }\n  });\n}\n\nfunction joinObjectsWithOptions(options: {\n  duplicate?: boolean,\n  except?: Array<string> | string,\n}, ...objects: Array<Object>): Object {\n  let { except } = options;\n  let dup = options.duplicate;\n  if (except == null) {\n    except = [];\n  }\n  if (dup == null) {\n    dup = false;\n  }\n\n  const num = objects.length;\n  const out = objects[0];\n  for (let i = 1; i < num; i += 1) {\n    const o = objects[i];\n    if (o != null) {\n      assignObjectFromTo(o, out, except, dup, '');\n    }\n  }\n  return out;\n}\n\n// joins objects like object.assign but goes as many levels deep as the object\n// is. Objects later in the arrawy overwrite objects earlier.\nfunction joinObjects(...objects: Array<Object>): Object {\n  return joinObjectsWithOptions({}, ...objects);\n}\n\nfunction duplicateFromTo(\n  fromObject: Object,\n  toObject: Object,\n  exceptKeys: Array<string> = [],\n) {\n  joinObjectsWithOptions({ except: exceptKeys, duplicate: true }, toObject, fromObject);\n}\n\nfunction zeroPad(num, places) {\n  const zero = places - num.toString().length + 1;\n  return Array(+(zero > 0 && zero)).join('0') + num;\n}\n\nclass UniqueIdGenerator {\n  static instance: Object;\n  seeds: {\n    [seedString: string]: number,\n  };\n\n  // All slides, events and states are relative to 0, where 0 is the start of a recording.\n  // Slides, events and states do not have to have a 0 time,\n  // maybe the first event will not happen till 1s in\n  constructor(singleton: boolean = true) {\n    // If the instance alread exists, then don't create a new instance.\n    // If it doesn't, then setup some default values.\n    if (singleton) {\n      if (!UniqueIdGenerator.instance) {\n        this.initialize();\n      }\n      return UniqueIdGenerator.instance;\n    }\n    this.initialize();\n  }\n\n  initialize() {\n    this.seeds = {};\n  }\n\n  getId(seed: string) {\n    if (this.seeds[seed] == null) {\n      this.seeds[seed] = 0;\n    }\n    const id = `${seed}${zeroPad(this.seeds[seed], 9)}`;\n    this.seeds[seed] += 1;\n    return id;\n  }\n}\n\nfunction generateUniqueId(seed: string = '') {\n  return new UniqueIdGenerator().getId(seed);\n  // const randomString = s => `${s}${Math.floor(Math.random() * 1000000)}`;\n  // let seedToUse = seed;\n  // if (seedToUse.length === 0) {\n  //   seedToUse = 'id_random_';\n  // }\n  // let idExists = true;\n  // let newId = randomString(seedToUse);\n  // while (idExists) {\n  //   newId = randomString(seedToUse);\n  //   const element = document.getElementById(newId);\n  //   if (element == null) {\n  //     idExists = false;\n  //   }\n  // }\n  // return newId;\n}\n\nfunction isTouchDevice() {\n  const prefixes = ' -webkit- -moz- -o- -ms- '.split(' ');\n  const mq = query => window.matchMedia(query).matches;\n\n  /* eslint-disable no-undef, no-mixed-operators */\n  // $FlowFixMe\n  if (('ontouchstart' in window) || window.DocumentTouch && document instanceof DocumentTouch) {\n    return true;\n  }\n  /* eslint-enable no-undef, no-mixed-operators */\n\n  // include the 'heartz' as a way to have a non matching MQ to help terminate the join\n  // https://git.io/vznFH\n  const query = ['(', prefixes.join('touch-enabled),('), 'heartz', ')'].join('');\n  return mq(query);\n}\n\nfunction loadRemote(\n  scriptId: string,\n  url: string,\n  callback: null | (string, string) => void = null,\n) {\n  const existingScript = document.getElementById(scriptId);\n  if (!existingScript) {\n    const script = document.createElement('script');\n    script.type = 'text/javascript';\n    script.src = url;\n    script.id = scriptId; // e.g., googleMaps or stripe\n    if (document.body) {\n      document.body.appendChild(script);\n    }\n    script.onload = () => {\n      if (callback != null) {\n        callback(scriptId, url);\n      }\n    };\n  } else if (callback != null) {\n    callback(scriptId, url);\n  }\n}\n\nfunction loadRemoteCSS(\n  id: string,\n  url: string,\n  callback: null | (string, string) => void = null,\n) {\n  const existingScript = document.getElementById(id);\n  if (!existingScript) {\n    const link = document.createElement('link');\n    link.rel = 'stylesheet';\n    link.type = 'text/css';\n    link.href = url;\n    link.id = id; // e.g., googleMaps or stripe\n    if (document.body) {\n      document.body.appendChild(link);\n    }\n    link.onload = () => {\n      if (callback != null) {\n        callback(id, url);\n      }\n    };\n  } else if (callback != null) {\n    callback(id, url);\n  }\n}\n\n// function remoteLoadToObject(\n//   scriptId: string,\n//   url: string,\n//   toObject: {},\n//   callback: null | (string, string) => void = null,\n// ) {\n//   loadRemote(scriptId, url, callback);\n\n// }\n\nconst cleanUIDs = (objectToClean: Object) => {\n  const genericUID = '0000000000';\n  if (objectToClean == null) {\n    return;\n  }\n  if ('uid' in objectToClean) {\n    if (objectToClean.uid === genericUID) {\n      return;\n    }\n    // eslint-disable-next-line no-param-reassign\n    objectToClean.uid = genericUID;\n  }\n  const keys = Object.keys(objectToClean);\n  for (let i = 0; i < keys.length; i += 1) {\n    const key = keys[i];\n    const value = objectToClean[key];\n    if (\n      typeof value === 'object'\n      && !Array.isArray(value)\n      && value != null\n      && typeof value !== 'function'\n      && typeof value !== 'number'\n      && typeof value !== 'boolean'\n      && typeof value !== 'string'\n    ) {\n      cleanUIDs(value);\n    }\n  }\n};\n\nfunction deleteKeys(obj: Object, keys: Array<string>) {\n  keys.forEach((key) => {\n    if (obj[key] !== undefined) {\n      // eslint-disable-next-line no-param-reassign\n      delete obj[key];\n    }\n  });\n}\n\nfunction copyKeysFromTo(source: Object, destination: Object, keys: Array<string>) {\n  keys.forEach((key) => {\n    if (source[key] !== undefined) {\n      // eslint-disable-next-line no-param-reassign\n      destination[key] = source[key];\n    }\n  });\n}\n\nfunction generateRandomString() {\n  return (Math.random() * 1e18).toString(36);\n}\n\nclass UniqueMap {\n  map: Object;\n  inverseMap: Object;\n  index: number;\n  letters: string;\n  undefinedCode: string;\n\n  constructor() {\n    this.map = {};\n    this.index = 1;\n    this.inverseMap = {};\n    this.letters = '0abcdefghijklmnopqrstuvwxz';\n    this.undefinedCode = '.a';\n  }\n\n  reset() {\n    this.index = 1;\n    this.map = {};\n  }\n\n  add(pathStr: string) {\n    if (this.map[pathStr] != null) {\n      return this.map[pathStr];\n    }\n    const unique = this.getNextUniqueString();\n    this.map[pathStr] = unique;\n    return unique;\n  }\n\n  getNextUniqueString() {\n    if (this.index === 0) {\n      return 'a';\n    }\n    const order = Math.floor(Math.log(this.index) / Math.log(this.letters.length));\n    let remainder = this.index;\n    let out = '';\n    for (let i = order; i >= 0; i -= 1) {\n      const factor = Math.floor(remainder / this.letters.length ** i);\n      remainder -= factor * this.letters.length ** i;\n      out = `${out}${this.letters[factor]}`;\n    }\n    this.index += 1;\n    return out;\n  }\n\n  makeInverseMap() {\n    this.inverseMap = {};\n    Object.keys(this.map).forEach((key) => {\n      const uniqueStr = this.map[key];\n      this.inverseMap[uniqueStr] = key;\n    });\n  }\n\n  get(uniqueStr: string) {\n    if (uniqueStr === this.undefinedCode) {\n      return undefined;\n    }\n    if (this.inverseMap[uniqueStr] != null) {\n      return this.inverseMap[uniqueStr];\n    }\n    return uniqueStr;\n  }\n}\n\nfunction compressObject(\n  obj: any,\n  map: UniqueMap,\n  keys: boolean = true,\n  strValues: boolean = true,\n  precision: ?number = null,\n  uncompress: boolean = false,\n) {\n  if (typeof obj === 'string') {\n    // if (obj === 'do') {\n    //   console.log(obj, strValues, uncompress, map.get(obj))\n    // }\n    if (strValues && uncompress) {\n      return map.get(obj);\n    }\n    if (strValues) {\n      return map.add(obj);\n    }\n    return obj;\n  }\n  if (typeof obj === 'number') {\n    if (precision === null || uncompress) {\n      return obj;\n    }\n    return roundNum(obj, precision);\n  }\n  if (\n    typeof obj === 'boolean'\n    || typeof obj === 'function'\n    || obj === null\n  ) {\n    return obj;\n  }\n\n  if (obj === undefined) {\n    return map.undefinedCode;\n  }\n\n  if (Array.isArray(obj)) {\n    for (let i = 0; i < obj.length; i += 1) {\n      // eslint-disable-next-line no-param-reassign\n      obj[i] = compressObject(obj[i], map, keys, strValues, precision, uncompress);\n    }\n    return obj;\n  }\n\n  if (typeof obj === 'object') {\n    const objKeys = Object.keys(obj);\n    const obj2 = {};\n    for (let i = 0; i < objKeys.length; i += 1) {\n      const k = objKeys[i];\n      // eslint-disable-next-line no-param-reassign\n      obj[k] = compressObject(obj[k], map, keys, strValues, precision, uncompress);\n      if (keys && uncompress) {\n        const value = map.get(k);\n        if (value != null) {\n          obj2[value] = obj[k];\n        }\n      } else if (keys) {\n        obj2[map.add(k)] = obj[k];\n      } else {\n        obj2[k] = obj[k];\n      }\n    }\n    if (keys) {\n      return obj2;\n    }\n    return obj2;\n  }\n  return obj;\n}\n\nfunction uncompressObject(\n  obj: any,\n  map: UniqueMap,\n  keys: boolean = true,\n  strValues: boolean = true,\n) {\n  return compressObject(obj, map, keys, strValues, null, true);\n}\n\nfunction minify(objectOrArray: any, precision: ?number = 4) {\n  const map = new UniqueMap();\n  return {\n    minified: compressObject(objectOrArray, map, true, true, precision),\n    map,\n  };\n}\n\nfunction unminify(minObjectOrArray: {\n  map: Object | UniqueMap,\n  minified: Object,\n}) {\n  let { map } = minObjectOrArray;\n  if (!(map instanceof UniqueMap)) {\n    const uMap = new UniqueMap();\n    uMap.map = map.map;\n    uMap.index = map.index;\n    uMap.letters = map.letters;\n    map = uMap;\n  }\n  map.makeInverseMap();\n  return uncompressObject(minObjectOrArray.minified, map, true, true);\n}\n\nfunction objectToPaths(\n  obj: any,\n  path: string = '',\n  pathObj: Object = {},\n  precision: ?number = null,\n) {\n  if (\n    typeof obj === 'string'\n    // || typeof obj === 'number'\n    || typeof obj === 'boolean'\n    || typeof obj === 'function'\n  ) {\n    pathObj[`${path}`] = obj; // eslint-disable-line no-param-reassign\n    return pathObj;\n  }\n  if (typeof obj === 'number') {\n    if (precision != null) {\n      pathObj[`${path}`] = roundNum(obj, precision); // eslint-disable-line no-param-reassign\n    } else {\n      pathObj[`${path}`] = obj; // eslint-disable-line no-param-reassign\n    }\n    return pathObj;\n  }\n  if (obj === null) {\n    pathObj[`${path}`] = null; // eslint-disable-line no-param-reassign\n    return pathObj;\n  }\n  if (obj === undefined) {\n    // pathObj[`${path}`] = undefined; // eslint-disable-line no-param-reassign\n    return pathObj;\n  }\n  if (Array.isArray(obj)) {\n    obj.forEach((o, index) => {\n      objectToPaths(o, `${path}[${index}]`, pathObj, precision);\n    });\n    return pathObj;\n  }\n  Object.keys(obj).forEach((key) => {\n    objectToPaths(obj[key], `${path}.${key}`, pathObj, precision);\n  });\n  return pathObj;\n}\n\nfunction getObjectDiff(\n  obj1In: Object,\n  diffs: Array<Object>,\n  obj2: Object,\n  precision: ?number = null,\n  debug: boolean = false,\n) {\n  // const pathMap = {};\n  let obj1 = obj1In;\n  if (diffs.length > 0) { // eslint-disable-next-line no-use-before-define\n    obj1 = refAndDiffToObject(obj1In, ...diffs);\n  }\n  const paths1 = objectToPaths(obj1, '', {}, precision);\n  const paths2 = objectToPaths(obj2, '', {}, precision);\n  const added = {};\n  const diff = {};\n  const removed = {};\n  Object.keys(paths1).forEach((key1) => {\n    if (paths2[key1] === undefined) {\n      removed[key1] = paths1[key1];\n      return;\n    }\n    if (paths1[key1] !== paths2[key1]) {\n      if (debug) {\n        diff[key1] = [paths1[key1], paths2[key1]];\n      } else {\n        diff[key1] = paths2[key1];\n      }\n    }\n  });\n  Object.keys(paths2).forEach((key2) => {\n    if (paths1[key2] === undefined) {\n      added[key2] = paths2[key2];\n    }\n  });\n  const out = {};\n  if (Object.keys(diff).length > 0) {\n    out.diff = diff;\n  }\n  if (Object.keys(added).length > 0) {\n    out.added = added;\n  }\n  if (Object.keys(removed).length > 0) {\n    out.removed = removed;\n  }\n  return out;\n}\n\nfunction updateObjFromPath(\n  remainingPath: Array<string>,\n  obj: Object,\n  value: any,\n  remove: boolean = false,\n) {\n  // console.log(remainingPath)\n  const fullP = remainingPath[0];\n  if (fullP.length === 0) {\n    return;\n  }\n  const arrayStringIndeces = fullP.match(/\\[[^\\]]*\\]/g);\n  const p = fullP.replace(/\\[.*/, '');\n  if (remainingPath.length === 1 && remove && !arrayStringIndeces) {\n    // eslint-disable-next-line no-param-reassign\n    delete obj[p];\n    return;\n  }\n  if (arrayStringIndeces) {\n    const arrayIndeces = arrayStringIndeces.map(e => parseInt(e.replace(/\\[|\\]/g, ''), 10));\n    // console.log(arrayIndeces)\n    // return;\n    if (obj[p] == null || !Array.isArray(obj[p])) {\n      obj[p] = [];  // eslint-disable-line no-param-reassign\n    }\n    // console.log(obj)\n    // return\n    let currentArray = obj[p];\n    let index = 0;\n    for (let i = 0; i < arrayIndeces.length; i += 1) {\n      index = arrayIndeces[i];\n      if (currentArray.length <= index) {\n        for (let j = currentArray.length; j < index - currentArray.length + 1; j += 1) {\n          currentArray.push(undefined);\n        }\n      }\n      if (i < arrayIndeces.length - 1) {\n        // currentArray[index] = currentArray[index][i];\n        if (!Array.isArray(currentArray[index])) {\n          currentArray[index] = [];\n        }\n        currentArray = currentArray[index];\n      }\n    }\n    if (remainingPath.length === 1 && remove) {\n      currentArray[index] = undefined;\n      return;\n    }\n    if (remainingPath.length === 1) {\n      currentArray[index] = value;\n      return;\n    }\n    if (currentArray[index] == null || typeof currentArray[index] !== 'object') {\n      currentArray[index] = {};\n    }\n    updateObjFromPath(remainingPath.slice(1), currentArray[index], value, remove);\n    return;\n  }\n\n  // if (remainingPath.length === 1 && remove) {\n  //   console.log('asdf')\n  //   obj[p] = undefined;\n  // }\n  if (remainingPath.length === 1) {\n    obj[p] = value;  // eslint-disable-line no-param-reassign\n    return;\n  }\n  if (obj[p] == null) {\n    obj[p] = {};  // eslint-disable-line no-param-reassign\n  }\n  updateObjFromPath(remainingPath.slice(1), obj[p], value, remove);\n}\n\nfunction pathsToObj(paths: Object) {\n  const obj = {};\n  Object.keys(paths).forEach((key) => {\n    const path = key.split('.').filter(p => p.length > 0);\n    const value = paths[key];\n    if (Array.isArray(value)) {\n      updateObjFromPath(path, obj, value.slice(-1)[0]);\n    } else {\n      updateObjFromPath(path, obj, value);\n    }\n  });\n  return obj;\n}\n\nfunction refAndDiffToObject(\n  referenceIn: Object,\n  ...diffsIn: Array<{\n    added: Object,\n    diff: Object,\n    removed: Object,\n  }>\n) {\n  const ref = duplicate(referenceIn);\n  const processPaths = (paths: Object, remove: boolean = false) => {\n    // console.log(paths)\n    Object.keys(paths).forEach((pathStr) => {\n      // console.log(pathStr)\n      const path = pathStr.split('.').filter(p => p.length > 0);\n      const value = paths[pathStr];\n      if (Array.isArray(value)) {\n        updateObjFromPath(path, ref, value.slice(-1)[0], remove);\n      } else {\n        updateObjFromPath(path, ref, value, remove);\n      }\n    });\n  };\n  // console.log(diffsIn)\n  diffsIn.forEach((diffIn) => {\n    // console.log(diffIn)\n    const { added, removed, diff } = diffIn;\n    // console.log(1, removed)\n    if (removed != null) {\n      processPaths(removed, true);\n    }\n    // console.log(2)\n    if (added != null) {\n      processPaths(added);\n    }\n    // console.log(3)\n    if (diff != null) {\n      processPaths(diff);\n    }\n  });\n  return ref;\n}\n\nfunction diffPathsToObj(diff: { added: Object, removed: Object, diff: Object }) {\n  const out = {};\n  if (diff.diff && Object.keys(diff.diff).length > 0) {\n    out.diff = pathsToObj(diff.diff);\n  }\n  if (diff.added && Object.keys(diff.added).length > 0) {\n    out.added = pathsToObj(diff.added);\n  }\n  if (diff.removed && Object.keys(diff.removed).length > 0) {\n    out.removed = pathsToObj(diff.removed);\n  }\n  return out;\n}\n\nfunction diffObjToPaths(diff: { added: Object, removed: Object, diff: Object }) {\n  const out = {};\n  if (diff.diff && Object.keys(diff.diff).length > 0) {\n    out.diff = objectToPaths(diff.diff);\n  }\n  if (diff.added && Object.keys(diff.added).length > 0) {\n    out.added = objectToPaths(diff.added);\n  }\n  if (diff.removed && Object.keys(diff.removed).length > 0) {\n    out.removed = objectToPaths(diff.removed);\n  }\n  return out;\n}\n\n// Class that can track an object's differences over time\nclass ObjectTracker {\n  baseReference: ?Object;\n  references: {\n    [refName: string]: {\n      basedOn: string,\n      diff: Object,\n    },\n  };\n\n  precision: number;\n  worker: typeof Worker;\n\n  //             time   refName  diff\n  diffs: Array<[number, string, Object, number]>\n\n  lastReferenceName: string;\n\n  constructor(precision: number = 8) {\n    this.precision = precision;\n    this.reset();\n  }\n\n  toObj() {\n    const references = {};\n    Object.keys(this.references).forEach((refName) => {\n      references[refName] = {\n        basedOn: this.references[refName].basedOn,\n        diff: diffPathsToObj(this.references[refName].diff),\n      };\n    });\n    // $FlowFixMe\n    const diffs = this.diffs.map(d => [d[0], d[1], diffPathsToObj(d[2]), d[3]]);\n    return {\n      baseReference: duplicate(this.baseReference),\n      diffs,\n      references,\n      precision: this.precision,\n      lastReferenceName: this.lastReferenceName,\n    };\n  }\n\n  setFromObj(obj: Object) {\n    const references = {};\n    Object.keys(obj.references).forEach((refName) => {\n      references[refName] = {\n        basedOn: obj.references[refName].basedOn,\n        diff: diffObjToPaths(obj.references[refName].diff),\n      };\n    });\n    this.references = references;\n    this.baseReference = duplicate(obj.baseReference);\n    this.precision = obj.precision;\n    this.diffs = obj.diffs.map(d => [d[0], d[1], diffObjToPaths(d[2]), d[3]]);\n    this.lastReferenceName = obj.lastReferenceName;\n  }\n\n  reset() {\n    this.baseReference = null;\n    this.references = {};\n    this.diffs = [];\n    this.lastReferenceName = '__base';\n  }\n\n  setBaseReference(obj: Object) {\n    this.baseReference = duplicate(obj);\n    this.lastReferenceName = '__base';\n  }\n\n  addReference(\n    obj: Object,\n    refName: string,\n    basedOn: string = '__base',\n  ) {\n    if (this.baseReference == null || refName === '__base') {\n      this.setBaseReference(obj);\n    }\n    if (refName !== '__base') {\n      this.references[refName] = {\n        diff: this.getDiffToReference(obj, basedOn),\n        basedOn,\n      };\n      this.lastReferenceName = refName;\n    }\n  }\n\n  getReferenceChain(name: string, chain: Array<Object>) {\n    if (name === '__base') {\n      return chain;\n    }\n    if (this.references[name] == null) {\n      return chain;\n    }\n    return this.getReferenceChain(\n      this.references[name].basedOn, [this.references[name].diff, ...chain],\n    );\n  }\n\n  getReference(refName: string) {\n    const referenceChain = this.getReferenceChain(refName, []);\n    return refAndDiffToObject(this.baseReference, ...referenceChain);\n  }\n\n  getDiffToReference(\n    obj: Object,\n    refName: string,\n  ) {\n    // const s1 = performance.now()\n    const referenceChain = this.getReferenceChain(refName, []);\n    // console.log('ref Chain', performance.now() - s1);\n    // const s2 = performance.now()\n    const diff = getObjectDiff(this.baseReference, referenceChain, obj, this.precision);\n    // console.log('s2', performance.now() - s2);\n    return diff;\n  }\n\n  getObjFromDiffAndReference(\n    diff: Object,\n    refName: string,\n  ) {\n    const referenceChain = this.getReferenceChain(refName, []);\n    const diffs = [...referenceChain, diff];\n    return refAndDiffToObject(this.baseReference, ...diffs);\n  }\n\n  add(time: number, obj: Object, refName: string = this.lastReferenceName, timeCount: number = 0) {\n    if (this.baseReference == null) {\n      this.setBaseReference(obj);\n    }\n    const diff = this.getDiffToReference(obj, refName);\n    this.diffs.push([time, refName, diff, timeCount]);\n  }\n\n  addWithWorker(\n    time: number,\n    obj: Object,\n    refName: string = this.lastReferenceName,\n    timeCount: number = 0,\n  ) {\n    if (this.baseReference == null) {\n      this.setBaseReference(obj);\n    }\n    this.startWorker();\n    if (this.worker != null) {  // $FlowFixMe\n      this.worker.postMessage([time, refName, obj, timeCount]);\n    }\n  }\n\n  startWorker() {\n    if (this.worker != null) {\n      return;\n    }\n    // $FlowFixMe\n    this.worker = new Worker();\n\n    // // $FlowFixMe\n    // this.worker.addEventListener('message', function (event) {\n    //   console.log(event.data)\n    // });\n  }\n\n  getFromIndex(index: number) {\n    if (index > this.diffs.length || this.diffs.length === 0) {\n      return null;\n    }\n    const [, basedOn, diff] = this.diffs[index];\n    return this.getObjFromDiffAndReference(diff, basedOn);\n  }\n}\n\n/**\n * Subscriber\n * @property {string | function(): void} callback callback to use when\n * subscription is published\n * @property {number} num number of notifications\n */\n type OBJ_Subscriber = {\n   callback: string | () => void;\n   num: number;\n };\n\n /**\n * Subscriber Map.\n *\n * @property {OBJ_Subscriber} [_id] each key in this object is a unique\n * identifier associated with a subscriber callback.\n */\n type OBJ_Subscribers = {\n  //  _id: OBJ_Subscriber;\n   [id: string]: OBJ_Subscriber;\n };\n\n/**\n * A single subscription\n *\n * @property {OBJ_Subscribers} subscribers\n * @property {FunctionMap} fnMap\n */\nclass Subscription {\n  fnMap: FunctionMap;\n  subscribers: OBJ_Subscribers;\n\n  order: Array<string>;\n\n  nextId: number;\n\n  /**\n   * @property {FunctionMap} fnMap Only needed for {@link Recorder}.\n   */\n  constructor(fnMap: FunctionMap = new FunctionMap()) {\n    this.fnMap = fnMap;\n    this.subscribers = {};\n    this.nextId = 0;\n    this.order = [];\n  }\n\n  /**\n   * Add a subscriber to an event.\n   * @param {string} subscriptionName event name\n   * @param {string | function(): void} callback to be called when events\n   * are published. If `string`, then {@link FunctionMap} of the {@link Figure}\n   * or {@link FigureElement} to which the subscription manager is a property\n   * of will be used.\n   * @param {number} numberOfSubscriptions how many publications the\n   * subscription will receive. `-1` is no limit (`-1`).\n   * @return {number} subscirber id\n   */\n  add(callback: string | () => void, numberOfPublications: number = -1) {\n    this.subscribers[`${this.nextId}`] = {\n      callback,\n      num: numberOfPublications,\n    };\n    this.order.push(`${this.nextId}`);\n    this.nextId += 1;\n    return this.nextId - 1;\n  }\n\n  /**\n   * Publish to all subscribers\n   *\n   * @param {any} functionArgument argument to pass to subscriber callback\n   */\n  publish(functionArgument: any) {\n    const subscribersToRemove = [];\n    for (let i = 0; i < this.order.length; i += 1) {\n      const id = this.order[i];\n      const { callback, num } = this.subscribers[id];\n      if (num === 1) {\n        subscribersToRemove.push(id);\n      }\n      let publishOk = false;\n      if (num !== 0) {\n        publishOk = true;\n      }\n      if (num > 0) {\n        this.subscribers[`${id}`].num = num - 1;\n      }\n      if (publishOk) {\n        this.fnMap.exec(callback, functionArgument);\n      }\n    }\n    subscribersToRemove.forEach((id) => { this.remove(id); });\n  }\n\n  /**\n   * Remove subscriber - the subscirber id is returned by this object's `add`\n   * method\n   */\n  remove(subscirberId: string | number) {\n    const id = `${subscirberId}`;\n    if (this.subscribers[id] != null) {\n      delete this.subscribers[id];\n    }\n    const index = this.order.indexOf(id);\n    if (index > -1) {\n      this.order.splice(index, 1);\n    }\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  _excludeStateKeys() {\n    return ['fnMap'];\n  }\n}\n\n /**\n * Subscription Map.\n *\n * @property {Subscription} [_subscriptionName] each key in this object is a\n * unique subscription name associated with a subscription.\n */\n type OBJ_Subscriptions = {\n   [subscriptionName: string]: Subscription;\n };\n/**\n * Subscription manager.\n *\n * Publishes notifications to event subscribers.\n *\n * {@link Figure}, {@link FigureElement}, {@link Recorder}, and\n * {@link SlideNavigator} all use subscription managers for event nofitications.\n *\n * Subscriptions managers can also be added to custom objects, but it will only\n * publish to subscribers when it is told to publish.\n *\n * @property {OBJ_Subscriptions} notifications\n * @property {FunctionMap} fnMap\n *\n * @example\n * // Subscribe to the `setTransform` subscription of `ball1` to move `ball2`\n *\n * // Add ball1 and ball2 to the figure\n * const [ball1, ball2] = figure.add([\n *   {\n *     name: 'ball1',\n *     method: 'primitives.polygon',\n *     options: {\n *       sides: 100, radius: 0.5, color: [1, 0, 0, 1],\n *     },\n *   },\n *   {\n *     name: 'ball2',\n *     method: 'primitives.polygon',\n *     options: {\n *       sides: 100, radius: 0.3, color: [0, 0, 1, 1],\n *     },\n *   },\n * ]);\n *\n * // Subscribe to ball1's `setTransform` publication, and use the set\n * transform to move ball2 with ball1\n * ball1.notifications.add('setTransform', (transform) => {\n *   ball2.setTransform(transform[0]);\n * });\n *\n * // Animate ball1 to show ball2 moves with it\n * ball1.animations.new()\n *   .position({ target: [1, 0], duration: 2 })\n *   .start();\n */\nclass NotificationManager {\n  fnMap: FunctionMap;\n  notifications: OBJ_Subscriptions;\n\n  /**\n   * @param {FunctionMap} fnMap default function map to use. Function maps\n   * need only be used with {@link Recorder}.\n   */\n  constructor(fnMap: FunctionMap = new FunctionMap()) {\n    this.notifications = {};\n    this.fnMap = fnMap;\n  }\n\n  /**\n   * Add a subscriber to an event.\n   * @param {string} subscriptionName event name\n   * @param {string | function(): void} callback to be called when events\n   * are published. If `string`, then {@link FunctionMap} of the {@link Figure}\n   * or {@link FigureElement} to which the subscription manager is a property\n   * of will be used.\n   * @param {number} numberOfSubscriptions how many publications the\n   * subscription will receive. `-1` is no limit (`-1`).\n   * @return {number} subscriber id\n   */\n  add(\n    subscriptionName: string,\n    callback: string | () => void,\n    numberOfSubscriptions: number = -1,\n  ) {\n    if (this.notifications[subscriptionName] == null) {\n      this.notifications[subscriptionName] = new Subscription(this.fnMap);\n    }\n    return this.notifications[subscriptionName].add(callback, numberOfSubscriptions);\n  }\n\n  /**\n   * Publish to all subscribers\n   *\n   * @param {string} subscriptionName\n   * @param {any} payload payload to pass to subscribers\n   */\n  publish(subscriptionName: string, payload: any) {\n    if (this.notifications[subscriptionName] != null) {\n      this.notifications[subscriptionName].publish(payload);\n    }\n  }\n\n  /**\n  * Remove subscriber from subscription\n   * @param {string} subsciptionName\n   * @param {string | number} subscriberId\n   */\n  remove(subscriptionName: string, subscriberId: string | number) {\n    if (this.notifications[subscriptionName] != null) {\n      const subscription = this.notifications[subscriptionName];\n      subscription.remove(subscriberId);\n      if (subscription.order.length === 0) {\n        delete this.notifications[subscriptionName];\n      }\n    }\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  _excludeStateKeys() {\n    return ['fnMap'];\n  }\n}\n\nfunction download(filename: string, text: string) {\n  const element = document.createElement('a');\n  element.setAttribute(\n    'href',\n    `data:text/plain;charset=utf-8,${encodeURIComponent(text)}`,\n  );\n  element.setAttribute('download', filename);\n  element.style.display = 'none';\n  const { body } = document;\n  if (body != null) {\n    body.appendChild(element);\n    element.click();\n    body.removeChild(element);\n  }\n}\n\nfunction splitString(str: string, token: string = '|', escape: string = '') {\n  const letters = str.split('');\n  const split = [];\n  let currentSplit = [];\n  let escaped = false;\n  let escapedEscape = false;\n  let tokenStringIndex = 0;\n  letters.forEach((letter) => {\n    currentSplit.push(letter);\n    if (tokenStringIndex === 0 && letter === escape && escaped === false) {\n      escaped = true;\n    } else if (letter === escape && tokenStringIndex === 0 && escaped) {\n      escapedEscape = true;\n    } else if (letter === token[tokenStringIndex]) {\n      tokenStringIndex += 1;\n    } else {\n      tokenStringIndex = 0;\n      escaped = false;\n    }\n    if (tokenStringIndex === token.length) {\n      if (!escaped) {\n        const newSplitString = currentSplit.slice(0, -token.length).join('');\n        if (newSplitString.length > 0) {\n          split.push(newSplitString);\n        }\n        currentSplit = [];\n      } else {\n        const preEscape = currentSplit.slice(0, -token.length - escape.length);\n        const postEscape = currentSplit.slice(-token.length);\n        currentSplit = [...preEscape, ...postEscape];\n      }\n      escaped = false;\n      tokenStringIndex = 0;\n    }\n    if (escapedEscape) {\n      escapedEscape = false;\n      escaped = false;\n      currentSplit = currentSplit.slice(0, -1);\n    }\n  });\n  if (currentSplit.length > 0) {\n    split.push(currentSplit.join(''));\n  }\n  return split;\n}\n\nclass PerformanceTimer {\n  stamps: Array<[number, string]>;\n  index: number;\n\n  constructor() {\n    this.reset();\n  }\n\n  reset() {\n    this.stamps = [[performance.now(), 'init']];\n    this.index = 1;\n  }\n\n  stamp(label: string = `m${this.index}`) {\n    this.stamps.push([performance.now(), label]);\n    this.index += 1;\n  }\n\n  deltas() {\n    let lastTime;\n    const out = [0];\n    let cumTime = 0;\n    this.stamps.forEach((stamp, i) => {\n      const [t, label] = stamp;\n      if (i > 0) {\n        const delta = t - lastTime;\n        out.push([label, Math.round(delta * 100) / 100]);\n        cumTime += delta;\n      }\n      lastTime = t;\n    });\n    out[0] = Math.round(cumTime * 100) / 100;\n    return out;\n  }\n\n  log() {\n    if (window.figureOneDebug == null) {\n      window.figureOneDebug = { misc: [] };\n    }\n    window.figureOneDebug.misc.push(this.deltas());\n  }\n}\n\nexport {\n  diffPathsToObj, diffObjToPaths,\n  Console,\n  classify, extractFrom, ObjectKeyPointer, getElement,\n  addToObject, duplicateFromTo, isTouchDevice,\n  generateUniqueId, joinObjects, cleanUIDs, loadRemote, loadRemoteCSS,\n  deleteKeys, copyKeysFromTo, generateRandomString,\n  duplicate, assignObjectFromTo, joinObjectsWithOptions,\n  objectToPaths, getObjectDiff, updateObjFromPath, pathsToObj,\n  UniqueMap, compressObject, refAndDiffToObject, uncompressObject,\n  unminify, minify, ObjectTracker,\n  download,\n  Subscription,\n  NotificationManager,\n  getFromObject,\n  splitString, PerformanceTimer,\n};\n\n"],"sourceRoot":""}